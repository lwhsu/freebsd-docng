<?xml version="1.0" encoding="koi8-r"?>
<!--
     The FreeBSD Russian Documentation Project

     $FreeBSD$

     Original revision: r43840
-->

<chapter xmlns="http://docbook.org/ns/docbook"
  xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
  xml:id="special">

  <title>Особые соглашения</title>

  <para>Имеется ещё несколько вещей, которые вы должны иметь в виду
    при создании порта.  Этот раздел описывает наиболее часто
    встречающиеся из них.</para>

  <sect1 xml:id="staging">
    <title>Staging</title>

    <para><filename>bsd.port.mk</filename> ожидает от портов работу с
      <quote>каталогом сборки</quote>.  Это означает, что порт должен
      устанавливать файлы не напрямую в назначенные каталоги (то
      есть, например, под <varname>PREFIX</varname>), а в отдельный
      каталог, из которого затем собирается пакет.  Во многих случаях
      привилегии root для этого не требуются, что делает возможным
      сборку пакетов из-под непривилегированного пользователя.  В
      режиме staging порт собирается и устанавливается в каталог
      сборки <varname>STAGEDIR</varname>.  Пакет создается из
      каталога сборки и затем устанавливается в систему.  В
      инструментарии automake такая концепция именуется
      <varname>DESTDIR</varname>; в прочем, в &os;
      <varname>DESTDIR</varname> имеет собственное значение (смотрите
      <xref linkend="porting-prefix"/>).</para>

    <para>Если для порта всё ещё требуются системные привилегии при
      выполнении цели <buildtarget>package</buildtarget>, то в
      <filename>Makefile</filename> должна быть добавлена следующая
      строка:</para>

    <programlisting>NEED_ROOT=	yes</programlisting>

    <para>Метапорты, то есть порты, которые не устанавливают файлы
      непосредственно, а только зависят от других портов, должны по
      возможности избегать распаковки &man.mtree.8; в каталог сборки.
      Это основная иерархия каталогов пакета, и эти пустые каталоги
      будут выглядеть лишними.  Для предотвращения распаковки
      &man.mtree.8; добавьте эту строку:</para>

    <programlisting>NO_MTREE=	yes</programlisting>

    <para>Staging задействуется посредством добавления переменной
      <varname>STAGEDIR</varname> слева от путей, которые
      используются в целях <buildtarget>pre-install</buildtarget>,
      <buildtarget>do-install</buildtarget> и
      <buildtarget>post-install</buildtarget> (смотрите примеры в
      книге).  Обычно сюда относятся <varname>PREFIX</varname>,
      <varname>ETCDIR</varname>, <varname>DATADIR</varname>,
      <varname>EXAMPLESDIR</varname>, <varname>MANPREFIX</varname>,
      <varname>DOCSDIR</varname> и так далее.  Каталоги должны
      создаваться при выполнении цели
      <buildtarget>post-install</buildtarget>.  Избегайте
      использования абсолютных путей, когда это возможно.</para>

    <para>При создании символический ссылки
      <varname>STAGEDIR</varname> должен ставиться только для пути
      назначения.  Например:</para>

    <programlisting>${LN} -sf libfoo.so.42 ${STAGEDIR}${PREFIX}/lib/libfoo.so</programlisting>

    <para>Первоначальный путь
      <filename>${PREFIX}/lib/libfoo.so.42</filename> выглядит
      нормально, но по факту может быть неправильным.  Абсолютные
      пути могут указывать на неподходящее место, например, когда
      удалённая файловая система смонтирована по
      <acronym>NFS</acronym> как непривилегированная точка
      монтирования.  Относительные пути реже подвержены проблемам и
      часто намного короче.</para>

    <para>Порты, устанавливающие модули ядра, должны предварять путь
      установки (по умолчанию <filename>/boot/modules</filename>)
      переменной <varname>STAGEDIR</varname>.</para>
  </sect1>

  <sect1 xml:id="porting-shlibs">
    <title>Динамические библиотеки</title>

    <para>Если ваш порт устанавливает одну или несколько динамических
      библиотек, определите переменную
      <varname>USE_LDCONFIG</varname>, которая приведёт к запуску из
      <filename>bsd.port.mk</filename> команды
      <literal>&dollar;{LDCONFIG} -m</literal> относительно каталога,
      в который устанавливается новая библиотека (как правило, это
      <filename>PREFIX/lib</filename>), во время выполнения цели
      <buildtarget>post-install</buildtarget> для её регистрации в
      кэше динамических библиотек.  Эта переменная, если она
      определена, также приведёт к добавлению соответствующей пары
      команд <literal>@exec /sbin/ldconfig -m</literal> и
      <literal>@unexec /sbin/ldconfig -R</literal> в ваш файл
      <filename>pkg-plist</filename>, так что пользователь,
      устанавливающий пакет, сможет сразу же использовать
      динамическую библиотеку, а удаление пакета не приведёт к тому,
      что система будет предполагать, что библиотека всё ещё имеется
      в наличии.</para>

    <programlisting>USE_LDCONFIG=	yes</programlisting>

    <para>Если нужно, вы можете переопределить каталог по умолчанию,
      задав значение <varname>USE_LDCONFIG</varname>, в котором
      должны быть перечислены каталоги, в которые устанавливаются
      динамические библиотеки.  Например, если ваш порт устанавливает
      динамические библиотеки в каталоги
      <filename>PREFIX/lib/foo</filename> и
      <filename>PREFIX/lib/bar</filename>, то вы можете в файле
      <filename>Makefile</filename> указать следующее:</para>

    <programlisting>USE_LDCONFIG=	${PREFIX}/lib/foo ${PREFIX}/lib/bar</programlisting>

    <para>Будьте добры перепроверить, т.к. часто это вовсе не
      является необходимым и может быть решено иначе с помощью
      <literal>-rpath</literal> или установки
      <envar>LD_RUN_PATH</envar> во время компоновки (для примера
      смотрите <package role="port">lang/moscow_ml</package>), или с
      помощью сценария-обёртки, который выставляет
      <varname>LD_LIBRARY_PATH</varname> перед запуском исполняемого
      файла как это делает <package
	role="port">www/seamonkey</package>.</para>

    <para>При установке 32-разрядных библиотек на 64-разрядной
      системе используйте вместо этого
      <varname>USE_LDCONFIG32</varname>.</para>

    <para>Постарайтесь сохранять номера версий динамических библиотек
      в формате <filename>libfoo.so.0</filename>.  Наш компоновщик
      позаботится только о старшем (первом) номере.</para>

    <para>Если при обновлении порта увеличивается старший номер
      версии библиотеки, то для всех портов, компонуемых с затронутой
      библиотекой, следует увеличить значение
      <varname>PORTREVISION</varname> для форсирования перекомпиляции
      с новой версией библиотеки.</para>
  </sect1>

  <sect1 xml:id="porting-restrictions">
    <title>Порты с ограничениями на распространение или с правовым
      обременением</title>

    <para>Лицензии бывают разных видов, и некоторые накладывают
      ограничение на то, как приложение может быть оформлено в виде
      пакета, может ли оно продаваться для извлечения коммерческой
      выгоды, и так далее.</para>

    <important>
      <para>На вас, как на человека, портирующего приложение, ложится
	обязанность прочесть лицензионные соглашения на программное
	обеспечение и удостовериться, что проект &os; не будет
	являться их нарушителем, если будет заниматься
	распространением исходного кода или в бинарном виде по
	FTP/HTTP или на CD-ROM.  Если у вас возникли сомнения, то,
	пожалуйста, обратитесь в &a.ports;.</para>
    </important>

    <para>В подобных ситуациях можно использовать переменные,
      описываемые в последующих разделах.</para>

    <sect2>
      <title><varname>NO_PACKAGE</varname></title>

      <para>Эта переменная указывает, что мы не можем создавать для
	приложения двоичный пакет.  К примеру, лицензия не позволяет
	бинарное распространение или она может запрещать
	распространение пакетов, созданных из изменённых
	исходников.</para>

      <para>Однако файлы <varname>DISTFILES</varname> могут свободно
	зеркалироваться по FTP/HTTP.  Они также могут
	распространяться, используя CD-ROM (или на похожих
	носителях), если не установлена переменная
	<varname>NO_CDROM</varname>.</para>

      <para><varname>NO_PACKAGE</varname> должна также
	использоваться, если двоичный пакет, как правило, бесполезен,
	а приложение должно всегда компилироваться из исходного кода.
	К примеру, если в приложение во время компиляции жёстко
	включается конфигурационная информация, привязанная к
	конкретной системе, то задайте переменную
	<varname>NO_PACKAGE</varname>.</para>

      <para>Значением переменной <varname>NO_PACKAGE</varname> должна
	быть строка, описывающая причину, по которой пакет не должен
	создаваться.</para>
    </sect2>

    <sect2>
      <title><varname>NO_CDROM</varname></title>

      <para>Эта переменная указывает на то, что, хотя мы имеем право
	создавать бинарные пакеты, мы не можем помещать эти пакеты
	или файлы <varname>DISTFILES</varname> порта на CD-ROM (или
	на похожие носители) для перепродажи.  Однако бинарные пакеты
	и файлы <varname>DISTFILES</varname> порта будут оставаться
	доступными посредством FTP/HTTP.</para>

      <para>Если эта переменная устанавливается вместе с
	<varname>NO_PACKAGE</varname>, то только файлы порта
	<varname>DISTFILES</varname> будут доступны, и только
	посредством FTP/HTTP.</para>

      <para>В качестве значения <varname>NO_CDROM</varname> должна
	указываться строка, описывающая причины, по которым порт не
	может распространяться на CD-ROM.  К примеру, это
	применяется, если лицензионное соглашение приложения
	предполагает только его <quote>некоммерческое</quote>
	использование.</para>
    </sect2>

    <sect2>
      <title><varname>NOFETCHFILES</varname></title>

      <para>Файлы, определенные в переменной
	<varname>NOFETCHFILES</varname>, не будут извлекаться ни из
	одного из <varname>MASTER_SITES</varname>.  Примером такого
	файла является файл, поставляемый на CD-ROM.</para>

      <para>Инструменты, проверяющие доступность этих файлов на
	<varname>MASTER_SITES</varname>, должны игнорировать эти
	файлы и не сообщать о них.</para>
    </sect2>

    <sect2>
      <title><varname>RESTRICTED</varname></title>

      <para>Задайте эту переменную, если лицензия на приложение не
	позволяет ни зеркалировать файлы
	<varname>DISTFILES</varname>, ни распространять бинарный
	пакет через FTP/HTTP или на CD-ROM.</para>

      <para>Ни <varname>NO_CDROM</varname>, ни
	<varname>NO_PACKAGE</varname> не стоит устанавливать вместе с
	<varname>RESTRICTED</varname>, так как последняя переменная
	подразумевает первые две.</para>

      <para>В качестве значения <varname>RESTRICTED</varname> должна
	указываться строка, описывающая причины, по которым порт
	нельзя распространять.  Обычно это означает, что порт
	использует закрытое программное обеспечение, а пользователь
	должен вручную сгрузить файлы <varname>DISTFILES</varname>,
	возможно, после заполнения регистрационной формы или
	подтверждения соглашения с условиями
	<acronym>EULA</acronym>.</para>
    </sect2>

    <sect2>
      <title><varname>RESTRICTED_FILES</varname></title>

      <para>Если заданы <varname>RESTRICTED</varname> или
	<varname>NO_CDROM</varname>, то значение этой переменной по
	умолчанию соответствует <literal>${DISTFILES}
	  ${PATCHFILES}</literal>, в противном случае она пуста.
	Если ограничены в распространении лишь некоторые из
	дистрибутивных файлов, то в этой переменной задаётся их
	список.</para>
    </sect2>

    <sect2>
      <title><varname>LEGAL_TEXT</varname></title>

      <para>Если порт имеет правовое обременение, которое не
	покрывается перечисленными выше переменными, то переменной
	<varname>LEGAL_TEXT</varname> следует присвоить строку с
	описанием данного обременения.  Например, если было получено
	особое разрешение для &os; на распространение двоичного
	файла, то эта переменная должна содержать соответствующее
	указание.</para>
    </sect2>

    <sect2>
      <title><filename>/usr/ports/LEGAL</filename> и
	<varname>LEGAL</varname></title>

      <para>Порт, содержащий любую из перечисленных выше переменных,
	также должен быть добавлен в
	<filename>/usr/ports/LEGAL</filename>.  Первый столбец
	содержит шаблон совпадения с дистрибутивными файлами,
	имеющими ограничения на распространение.  Второй столбец
	содержит корень порта.  Третий столбец содержит вывод
	<command>make -VLEGAL</command>.</para>
    </sect2>

    <sect2>
      <title>Примеры использования</title>

      <para>Предпочтительным способом реализации утверждения "архивы
	исходных текстов для этого порта должны загружаться
	самостоятельно" является следующее:</para>

      <programlisting>.if !exists(${DISTDIR}/${DISTNAME}${EXTRACT_SUFX})
IGNORE=	may not be redistributed because of licensing reasons. Please visit <replaceable>some-website</replaceable> to accept their license and download ${DISTFILES} into ${DISTDIR}
.endif</programlisting>

      <para>Это одновременно и информирует пользователя, и
	устанавливает нужные метаданные на пользовательской машине
	для использования автоматическими программами.</para>

      <para>Обратите внимание, что данная кляуза должна
	предшествовать подключению файла
	<filename>bsd.port.pre.mk</filename>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="building">
    <title>Механизмы построения</title>

    <sect2 xml:id="parallel-builds">
      <title>Параллельное построение портов</title>

      <para>Инфраструктура портов &os; поддерживает параллельное
	построение с использованием множественных подпроцессов
	<command>make</command>, что позволяет системам
	<acronym>SMP</acronym> задействовать всю доступную мощность
	<acronym>CPU</acronym>, тем самым делая построение портов
	более быстрым и эффективным.</para>

      <para>Это достигается путём передачи флага
	<varname>-jX</varname> команде &man.make.1;.  Такое
	построение портов является поведением по умолчанию.  К
	сожалению, не все порты поддерживают параллельную сборку
	достаточно хорошо, и поэтому может потребоваться выключить
	этот механизм явным образом путём добавления переменной
	<literal>MAKE_JOBS_UNSAFE=yes</literal>.  Эта переменная
	используется в случае, когда известно, что порт ломается с
	<varname>-jX</varname>.</para>
    </sect2>

    <sect2 xml:id="using-make">
      <title><command>make</command>, <command>gmake</command> и
	<command>imake</command></title>

      <para>Если ваш порт использует
	<application>GNU make</application>, то установите
	<literal>USES= gmake</literal>.</para>

      <table frame="none">
	<title>Переменные для портов, использующих
	  <application>gmake</application></title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Переменная</entry>
	      <entry>Значение</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><varname>USES= gmake</varname></entry>
	      <entry>Для сборки порта требуется
		<command>gmake</command>.</entry>
	    </row>

	    <row>
	      <entry><varname>GMAKE</varname></entry>
	      <entry>Полный путь к команде <command>gmake</command>,
		если отсутствует в <envar>PATH</envar>.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Если ваш порт является приложением X, которое создает
	файлы <filename>Makefile</filename> из
	<filename>Imakefile</filename>, используя
	<application>imake</application>, то установите
	<literal>USES= imake</literal>.  Это заставит стадию
	конфигурирования автоматически выполнить
	<command>xmkmf -a</command>.  Если флаг <option>-a</option>
	представляет для вашего порта проблему, то установите
	<literal>XMKMF=xmkmf</literal>.  Если порт использует
	<application>imake</application>, но не понимает цель
	<buildtarget>install.man</buildtarget>, то следует установить
	<literal>NO_INSTALL_MANPAGES=yes</literal>.</para>

      <para>Если исходный <filename>Makefile</filename> вашего порта
	имеет что-нибудь помимо <buildtarget>all</buildtarget> в
	качестве основной цели построения, то задайте соответствующее
	значение <varname>ALL_TARGET</varname>.  То же касается
	<buildtarget>install</buildtarget> и
	<varname>INSTALL_TARGET</varname>.</para>
    </sect2>

    <sect2 xml:id="using-configure">
      <title>Сценарий <command>configure</command></title>

      <para>Если ваш порт использует сценарий
	<command>configure</command> для получения файлов
	<filename>Makefile</filename> из файлов
	<filename>Makefile.in</filename>, то установите
	<literal>GNU_CONFIGURE=yes</literal>.  Если вы хотите дать
	дополнительные параметры сценарию
	<command>configure</command> (аргументом по умолчанию
	является <literal>--prefix=&dollar;{PREFIX}
	  --infodir=&dollar;{PREFIX}/&dollar;{INFO_PATH}
	  --mandir=&dollar;{MANPREFIX}/man
	  --build=&dollar;{CONFIGURE_TARGET}</literal>), установите
	эти параметры в <varname>CONFIGURE_ARGS</varname>.
	Дополнительные переменные окружения можно передать, используя
	переменную <varname>CONFIGURE_ENV</varname>.</para>

      <table frame="none">
	<title>Переменные для портов, использующих
	  <command>configure</command></title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Переменная</entry>
	      <entry>Значение</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><varname>GNU_CONFIGURE</varname></entry>
	      <entry>Порт использует сценарий
		<command>configure</command> для подготовки
		построения.</entry>
	    </row>

	    <row>
	      <entry><varname>HAS_CONFIGURE</varname></entry>
	      <entry>То же, что и <varname>GNU_CONFIGURE</varname>,
		кроме того, что цель configure по умолчанию не
		добавляется в
		<varname>CONFIGURE_ARGS</varname>.</entry>
	    </row>

	    <row>
	      <entry><varname>CONFIGURE_ARGS</varname></entry>
	      <entry>Дополнительные параметры, передаваемые сценарию
		<command>configure</command>.</entry>
	    </row>

	    <row>
	      <entry><varname>CONFIGURE_ENV</varname></entry>
	      <entry>Дополнительные переменные окружения, задаваемые
		для запуска сценария
		<command>configure</command>.</entry>
	    </row>

	    <row>
	      <entry><varname>CONFIGURE_TARGET</varname></entry>
	      <entry>Переопределить цель configure по умолчанию.
		Значением по умолчанию является
		<literal>&dollar;{MACHINE_ARCH}-portbld-freebsd&dollar;{OSREL}</literal>.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>
    </sect2>

    <sect2 xml:id="using-cmake">
      <title>Использование <command>cmake</command></title>

      <para>Если порт использует <application>CMake</application>,
	определите <literal>USES= cmake</literal> или
	<literal>USES= cmake:outsource</literal> для построения во
	внешнем каталоге (см. ниже).</para>

      <table frame="none">
	<title>Переменные для портов, использующих
	  <command>cmake</command></title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Переменная</entry>
	      <entry>Значение</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><varname>CMAKE_ARGS</varname></entry>
	      <entry>Специфичные для порта флаги
		<application>CMake</application>, передаваемые
		<command>cmake</command>.</entry>
	    </row>

	    <row>
	      <entry><varname>CMAKE_BUILD_TYPE</varname></entry>
	      <entry>Тип построения (предопределённые профили
		построения <application>CMake</application>).  По
		умолчанию <literal>Release</literal>,
		<literal>Debug</literal> при использовании
		<varname>WITH_DEBUG</varname>.</entry>
	    </row>

	    <row>
	      <entry><varname>CMAKE_ENV</varname></entry>
	      <entry>Переменные окружения для передачи
		<command>cmake</command>.  По умолчанию
		<literal>&dollar;{CONFIGURE_ENV}</literal>.</entry>
	    </row>

	    <row>
	      <entry><varname>CMAKE_SOURCE_PATH</varname></entry>
	      <entry>Путь к каталогу с исходным кодом.  По умолчанию
		<literal>&dollar;{WRKSRC}</literal>.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <table frame="none">
	<title>Переменные построения <command>cmake</command>,
	  устанавливаемые пользователем</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Переменная</entry>
	      <entry>Значение</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><varname>CMAKE_VERBOSE</varname></entry>
	      <entry>Разрешает подробный вывод сообщений при
		построении.  Значение по умолчанию не задано, если не
		заданы <varname>BATCH</varname> или
		<varname>PACKAGE_BUILDING</varname>.</entry>
	    </row>

	    <row>
	      <entry><varname>CMAKE_NOCOLOR</varname></entry>
	      <entry>Запрещает цветной вывод сообщений при
		построении.  Значение по умолчанию не задано, если не
		заданы <varname>BATCH</varname> или
		<varname>PACKAGE_BUILDING</varname>.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para><application>CMake</application> поддерживает следующие
	профили построения: <literal>Debug</literal>,
	<literal>Release</literal>, <literal>RelWithDebInfo</literal>
	и <literal>MinSizeRel</literal>.  Профили
	<literal>Debug</literal> и <literal>Release</literal>
	учитывают системные флаги <literal>*FLAGS</literal>;
	<literal>RelWithDebInfo</literal> и
	<literal>MinSizeRel</literal> соответственно определяют
	<varname>CFLAGS</varname> со значением
	<literal>-O2 -g</literal> и <literal>-Os -DNDEBUG</literal>.
	Значение <varname>CMAKE_BUILD_TYPE</varname> экспортируется в
	нижнем регистре в <varname>PLIST_SUB</varname> и должно
	использоваться, если порт устанавливает файлы
	<literal>*.cmake</literal> в зависимости от типа построения
	(для примера посмотрите на
	<package role="port">deskutils/strigi</package>).  Следует
	учитывать, что некоторые проекты могут определять собственные
	профили построения и/или форсировать конкретный тип
	построения через установку
	<literal>CMAKE_BUILD_TYPE</literal> в файлах
	<filename>CMakeLists.txt </filename> .  Для того чтобы порт
	для такого проекта учитывал <varname>CFLAGS</varname> и
	<varname>WITH_DEBUG</varname>, из этих файлов должны быть
	удалены значения <literal>CMAKE_BUILD_TYPE</literal>.</para>

      <para>Большинство проектов, основанных на
	<application>CMake</application>, поддерживают метод внешнего
	(out-of-source) построения.  Для порта внешнее построение
	можно запросить с использованием суффикса
	<literal>:outsource</literal>.  В этом случае
	<varname>CONFIGURE_WRKSRC</varname>,
	<varname>BUILD_WRKSRC</varname> и
	<varname>INSTALL_WRKSRC</varname> будут иметь значение
	<literal>&dollar;{WRKDIR}/.build</literal> для каталога,
	содержащего файлы, получаемые на этапах конфигурации и
	построения; при этом каталог с исходным кодом будет
	оставаться без изменений.</para>

      <example xml:id="using-cmake-example">
	<title>Пример для <literal>USES= cmake</literal></title>

	<para>Следующий отрывок демонстрирует использование
	  <application>CMake</application> для порта.
	  <varname>CMAKE_SOURCE_PATH</varname> обычно не требуется,
	  но может быть установлен, когда исходный код не находится
	  в верхнем каталоге или если порт используется для
	  построения части проекта.</para>

	<programlisting>USES=			cmake:outsource
CMAKE_SOURCE_PATH=	&dollar;{WRKSRC}/subproject</programlisting>
      </example>
    </sect2>

    <sect2 xml:id="using-scons">
      <title>Использование <command>scons</command></title>

      <para>Если ваш порт использует
	<application>SCons</application>, определите
	<literal>USE_SCONS=yes</literal>.</para>

      <table frame="none">
	<title>Переменные для портов, использующих
	  <command>scons</command></title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Переменная</entry>
	      <entry>Значение</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><varname>SCONS_ARGS</varname></entry>
	      <entry>Специфичные для порта флаги SCons, передаваемые
		окружению SCons.</entry>
	    </row>

	    <row>
	      <entry><varname>SCONS_BUILDENV</varname></entry>
	      <entry>Переменные для установки в системном
		окружении.</entry>
	    </row>

	    <row>
	      <entry><varname>SCONS_ENV</varname></entry>
	      <entry>Переменные для установки в окружении
		SCons.</entry>
	    </row>

	    <row>
	      <entry><varname>SCONS_TARGET</varname></entry>
	      <entry>Последний параметр для передачи SCons, похожий
		на <varname>MAKE_TARGET</varname>.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Для того, чтобы сторонний <filename>SConstruct</filename>
	соответствовал всему, что передается SCons в переменной
	<varname>SCONS_ENV</varname> (самое главное, это
	<varname>CC/CXX/CFLAGS/CXXFLAGS</varname>), примените патч к
	<filename>SConstruct</filename>, так чтобы переменная
	построения <literal>Environment</literal> выглядела следующим
	образом:</para>

      <programlisting>env = Environment(**ARGUMENTS)</programlisting>

      <para>В дальнейшем ее можно изменить при помощи
	<literal>env.Append</literal> и
	<literal>env.Replace</literal>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="using-autotools">
    <title>Использование GNU Autotools</title>

    <sect2 xml:id="using-autotools-introduction">
      <title>Введение</title>

      <para>Различные инструменты GNU autotools предоставляют
	механизм абстракции для построения частей программного
	обеспечения на широком наборе операционных систем и
	аппаратных архитектур.  Внутри Коллекции Портов отдельный
	порт может использовать эти инструменты при помощи простых
	конструкций:</para>

      <programlisting>USE_AUTOTOOLS=	<replaceable>tool</replaceable>:<replaceable>version</replaceable>[:<replaceable>operation</replaceable>] ...</programlisting>

      <para>К моменту написания <replaceable>tool</replaceable>
	может быть одним из <literal>libtool</literal>,
	<literal>libltdl</literal>, <literal>autoconf</literal>,
	<literal>autoheader</literal>, <literal>automake</literal>
	или <literal>aclocal</literal>.</para>

      <para><replaceable>version</replaceable> указывает конкретную
	версию используемого инструмента (смотрите
	<literal>devel/{automake,autoconf,libtool}[0-9]+</literal>
	для получения действительных версий).</para>

      <para><replaceable>operation</replaceable> является
	необязательным расширением и указывает на способ
	использования инструмента.</para>

      <para>Одновременно может быть указано несколько инструментов,
	добавляя их все на одной строке или используя конструкцию
	Makefile <literal>+=</literal>.</para>

      <para>В заключение, существует специальный инструмент по
	называнию <literal>autotools</literal>, который является
	удобной функцией при установке всех доступных версий
	autotools для возможности проведения кросс-разработки.  Это
	также может быть достигнуто путем установки порта
	<literal>devel/autotools</literal>.</para>
    </sect2>

    <sect2 xml:id="using-libtool">
      <title><command>libtool</command></title>

      <para>Динамические библиотеки, использующие инфраструктуру
	построения GNU, обычно используют
	<application>libtool</application> для настройки компиляции и
	установки динамических библиотек в соответствии с
	особенностями данной операционной системы.  В типичной
	практике используется копирование встроенного в приложение
	<command>libtool</command>.  Если вам нужно использовать
	внешнюю команду <command>libtool</command>, то вы можете
	использовать версию, поставляемую Коллекцией Портов:</para>

      <programlisting>USE_AUTOTOOLS=	libtool:<replaceable>version</replaceable>[:env]</programlisting>

      <para>При отсутствии дополнительных операций,
	<literal>libtool:version</literal> сообщает инфраструктуре
	построения о применении патча к сценарию configure с
	установленной в системе копией <command>libtool</command>.
	Означает использование <varname>GNU_CONFIGURE</varname>.
	Более того, некоторые переменные make и оболочки shell будут
	назначены для дальнейшего использования этим портом.
	Подробности смотрите в
	<filename>bsd.autotools.mk</filename>.</para>

      <para>При использовании операции <literal>:env</literal> будет
	настроено только окружение.</para>

      <para>Наконец, <varname>LIBTOOLFLAGS</varname> и
	<varname>LIBTOOLFILES</varname> можно установить по желанию,
	чтобы переопределить наиболее вероятные аргументы для
	<command>libtool</command> и файлы, предназначенные для
	изменения.  Большинству портов это скорее всего не
	понадобится.  Для дальнейших подробностей смотрите
	<filename>bsd.autotools.mk</filename>.</para>
    </sect2>

    <sect2 xml:id="using-libltdl">
      <title><command>libltdl</command></title>

      <para>Некоторые порты задействуют пакет с библиотекой
	<command>libltdl</command>, которая является частью комплекта
	<command>libtool</command>.  Использование этой библиотеки не
	вызывает автоматическое использование самой
	<command>libtool</command>, и, таким образом, обеспечивается
	отдельная конструкция.</para>

      <programlisting>USE_AUTOTOOLS=	libltdl:<replaceable>version</replaceable></programlisting>

      <para>Всё, что в настоящее время она делает, это добавление
	<varname>LIB_DEPENDS</varname> для подходящего порта
	<command>libltdl</command>, потому она предоставляется как
	удобная функция для помощи в устранении всяких зависимостей
	от портов autotools вне инфраструктуры
	<varname>USE_AUTOTOOLS</varname>.  Для этого инструмента не
	существует необязательных операций.</para>
    </sect2>

    <sect2 xml:id="using-autoconf">
      <title><command>autoconf</command> и
	<command>autoheader</command></title>

      <para>Вместо сценария configure некоторые порты содержат шаблон
	autoconf в файле <filename>configure.ac</filename>.  Вы
	можете использовать следующие присвоения, чтобы позволить
	<command>autoconf</command> создать сценарий configure, а
	<command>autoheader</command> создать заголовки шаблона для
	использования в сценарии configure.</para>

      <programlisting>USE_AUTOTOOLS=	autoconf:<replaceable>version</replaceable>[:env]</programlisting>

      <para>и</para>

      <programlisting>USE_AUTOTOOLS=	autoheader:<replaceable>version</replaceable></programlisting>

      <para>которые также подразумевают использование
	<literal>autoconf:version</literal>.</para>

      <para>Аналогично команде <command>libtool</command> включение
	необязательной операции <literal>:env</literal> всего лишь
	настраивает окружение для дальнейшего использования.  Без
	этого выполняется наложение патчей и переконфигурирование
	порта.</para>

      <para>Дополнительные необязательные переменные
	<varname>AUTOCONF_ARGS</varname> и
	<varname>AUTOHEADER_ARGS</varname> можно переопределить в
	<filename>Makefile</filename> порта, если указано явным
	образом.  Как и с эквивалентами <command>libtool</command>,
	большинству портов это вряд ли понадобится.</para>
    </sect2>

    <sect2 xml:id="using-automake">
      <title><command>automake</command> и
	<command>aclocal</command></title>

      <para>Некоторые пакеты содержат только файлы
	<filename>Makefile.am</filename>.  Они должны быть
	преобразованы в файлы <filename>Makefile.in</filename> с
	использованием <application>automake</application> и
	дальнейшей обработкой <command>configure</command> для
	получения настоящего <filename>Makefile</filename>.</para>

      <para>Аналогично, иногда пакеты не поставляются с вложенными
	файлами <filename>aclocal.m4</filename>, снова требуемых для
	построения программного обеспечения.  Их можно получить
	командой <command>aclocal</command>, которая просматривает
	<filename>configure.ac</filename> или
	<filename>configure.in</filename>.</para>

      <para><command>aclocal</command> имеет похожую связь с
	<command>automake</command>, как у
	<command>autoheader</command> с <command>autoconf</command>,
	что описано в предыдущей главе.  <command>aclocal</command>
	подразумевает использование <command>automake</command>,
	таким образом, мы имеем:</para>

      <programlisting>USE_AUTOTOOLS=	automake:<replaceable>version</replaceable>[:<replaceable>env</replaceable>]</programlisting>

      <para>и</para>

      <programlisting>USE_AUTOTOOLS=	aclocal:<replaceable>version</replaceable></programlisting>

      <para>которые также подразумевают использование
	<literal>automake:version</literal>.</para>

      <para>Также как и для <command>libtool</command> и
	<command>autoconf</command>, подключение необязательной
	операции <literal>:env</literal> всего лишь устанавливает
	окружение для дальнейшего пользования.  Без этого выполняется
	реконфигурирование этого порта.</para>

      <para>Как и в случае с <command>autoconf</command> и
	<command>autoheader</command>, обе команды
	<command>automake</command> и <command>aclocal</command>
	соответственно имеют необязательные переменные
	<varname>AUTOMAKE_ARGS</varname> и
	<varname>ACLOCAL_ARGS</varname>, которые при необходимости
	можно переопределить в <filename>Makefile</filename>
	порта.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="using-gettext">
    <title>Использование GNU <literal>gettext</literal></title>

    <sect2>
      <title>Простой вариант использования</title>

      <para>Если для вашего порта требуется
	<literal>gettext</literal>, добавьте
	<literal>USES= gettext</literal>, и ваш порт унаследует
	зависимость от <package role="port">devel/gettext</package>.
	<xref linkend="uses-values"/> содержит перечень других
	значений для использования <literal>gettext</literal>.</para>

      <para>Довольно распространенным случаем является использование
	в порте <literal>gettext</literal> и
	<command>configure</command>.  Как правило, GNU
	<command>configure</command> способен находить
	<literal>gettext</literal> автоматически.  Если он все же не
	сможет это сделать, то подсказки для размещения
	<literal>gettext</literal> можно передать через переменные
	окружения <envar>CPPFLAGS</envar> и
	<envar>LDFLAGS</envar>:</para>

      <programlisting>USES=	gettext
CPPFLAGS+=	-I${LOCALBASE}/include
LDFLAGS+=	-L${LOCALBASE}/lib

GNU_CONFIGURE=	yes</programlisting>

      <para>Конечно же, этот код можно записать в более компактном
	виде, если передавать флаги в <command>configure</command> не
	требуется:</para>

      <programlisting>USES=	gettext
GNU_CONFIGURE=	yes</programlisting>
    </sect2>

    <sect2>
      <title>Оптимальное использование</title>

      <para>Некоторые программные продукты позволяют отключать NLS,
	к примеру, передавая параметр <option>--disable-nls</option>
	сценарию <command>configure</command>.  В этом случае ваш
	порт должен использовать <literal>gettext</literal>, в
	зависимости от значения <varname>NLS</varname>.  Для портов
	небольшой или средней сложности вы можете полагаться на
	следующую идиому:</para>

      <programlisting>GNU_CONFIGURE=	yes

.include &lt;bsd.port.options.mk&gt;

.if ${PORT_OPTIONS:MNLS}
USES+=			gettext
PLIST_SUB+=		NLS=""
.else
CONFIGURE_ARGS+=	--disable-nls
PLIST_SUB+=		NLS="@comment "
.endif

.include &lt;bsd.port.mk&gt;</programlisting>

      <para>Следующий пункт в вашем списке дел разобраться, чтобы
	файлы каталога сообщения включались в список упаковки по
	условию.  Часть, входящая в <filename>Makefile</filename>,
	уже обеспечена этой идиомой.  Остальное объясняется в главе
	<link linkend="plist-sub">продвинутые практики
	  <filename>pkg-plist</filename></link>.  Вкратце, каждое
	вхождение <literal>%%NLS%%</literal> в
	<filename>pkg-plist</filename> будет заменено на
	<quote><literal>@comment&nbsp;</literal></quote>, если NLS
	выключен, или пустой строкой, если включен.  В результате
	строки, предваряемые <literal>%%NLS%%</literal>, станут
	комментариями в итоговом листе упаковки, если NLS выключен;
	иначе, префикс будет просто удален.  Всё, что вам нужно, это
	вставить <literal>%%NLS%%</literal> перед каждым путем к
	файлу каталога сообщений в <filename>pkg-plist</filename>.
	Например:</para>

      <programlisting>%%NLS%%share/locale/fr/LC_MESSAGES/foobar.mo
%%NLS%%share/locale/no/LC_MESSAGES/foobar.mo</programlisting>

      <para>В особо сложных случаях вам понадобиться использовать
	более продвинутые техники, чем данный рецепт, такие как <link
	  linkend="plist-dynamic">динамические списки
	  упаковки</link>.</para>
    </sect2>

    <sect2>
      <title>Управление каталогами сообщений</title>

      <para>Существует момент, который следует учитывать при
	установке файлов каталогов сообщений.  Целевые каталоги для
	размещения, расположенные под
	<filename>LOCALBASE/share/locale</filename>, редко когда
	должны создаваться и удаляться портом.  Для наиболее
	популярных языков имеются собственные каталоги, перечисленные
	в <filename>PORTSDIR/Templates/BSD.local.dist</filename>.
	Каталоги для множества других языков управляются с помощью
	порта <package role="port">devel/gettext</package>.  Обратите
	внимание на его <filename>pkg-plist</filename> и посмотрите,
	куда данный порт собирается установить файлы каталогов
	сообщений для единственного в своем роде языка.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="using-perl">
    <title>Использование <application>Perl</application></title>

    <para>Если <varname>MASTER_SITES</varname> установлена в значение
      <varname>MASTER_SITE_PERL_CPAN</varname>, то предпочтительным
      значением <varname>MASTER_SITE_SUBDIR</varname> является имя
      иерархии верхнего уровня.  Например, рекомендуемым значением
      для <literal>p5-Module-Name</literal> является
      <literal>Module</literal>.  Иерархию верхнего уровня можно
      посмотреть на сайте <link
	xlink:href="http://cpan.org/modules/by-module/">cpan.org</link>.
      Это поддерживает порт в рабочем состоянии при изменении модуля
      автором.</para>

    <para>Исключением этого правила является отсутствие
      соответствующего каталога или файла с дистрибутивом в этом
      каталоге.  В качестве <varname>MASTER_SITE_SUBDIR</varname> в
      этом случае разрешается использовать id автора.</para>

    <para>В качестве значения все из настраиваемых knobs ниже
      принимают <literal>YES</literal> или строку с версией вида
      <literal>5.8.0+</literal>.  <literal>YES</literal> означает,
      что данный порт можно использовать с любой из поддерживаемых
      версий Perl.  Если порт работает только с некоторыми версиями
      Perl, то это можно обозначить при помощи строки с версией,
      указывающей на минимальную версию (пример:
      <literal>5.7.3+</literal>), максимальную версию (пример:
      <literal>5.8.0-</literal>) или точную версию (пример:
      <literal>5.8.3</literal>).</para>

    <table frame="none">
      <title>Переменные для портов, использующих
	<application>Perl</application></title>

      <tgroup cols="2">
	<thead>
	  <row>
	    <entry>Переменная</entry>
	    <entry>Значение</entry>
	  </row>
	</thead>

	<tbody>
	  <row>
	    <entry><varname>USE_PERL5</varname></entry>
	    <entry>Perl 5 используется для построения и
	      работы.</entry>
	  </row>

	  <row>
	    <entry><varname>USE_PERL5_BUILD</varname></entry>
	    <entry>Perl 5 используется для построения.</entry>
	  </row>

	  <row>
	    <entry><varname>USE_PERL5_RUN</varname></entry>
	    <entry>Perl 5 используется во время работы.</entry>
	  </row>

	  <row>
	    <entry><varname>PERL</varname></entry>
	    <entry>Полный путь к интерпретатору Perl 5, либо в
	      системе, либо установленному из портов, но без номера
	      версии.  Используйте это, если вам нужно заменить
	      строки <quote><literal>#!</literal></quote> в
	      скриптах.</entry>
	  </row>

	  <row>
	    <entry><varname>PERL_CONFIGURE</varname></entry>
	    <entry>Конфигурация при помощи MakeMaker языка Perl.
	      Влечёт <varname>USE_PERL5</varname>.</entry>
	  </row>

	  <row>
	    <entry><varname>PERL_MODBUILD</varname></entry>
	    <entry>Конфигурация, построение и установка с
	      использованием Module::Build.  Влечёт
	      <varname>PERL_CONFIGURE</varname>.</entry>
	  </row>
	</tbody>
      </tgroup>

      <tgroup cols="2">
	<thead>
	  <row>
	    <entry>Переменные только для чтения</entry>
	    <entry>Значение</entry>
	  </row>
	</thead>

	<tbody>
	  <row>
	    <entry><varname>PERL_VERSION</varname></entry>
	    <entry>Полная версия установленного Perl
	      (например, <literal>5.8.9</literal>).</entry>
	  </row>

	  <row>
	    <entry><varname>PERL_LEVEL</varname></entry>
	    <entry>Установленная версия Perl в форме целого числа
	      вида <literal>MNNNPP</literal> (например,
	      <literal>500809</literal>).</entry>
	  </row>

	  <row>
	    <entry><varname>PERL_ARCH</varname></entry>
	    <entry>Место, в котором Perl хранит
	      архитектурно-зависимые библиотеки.  По умолчанию это
	      <literal>${ARCH}-freebsd</literal>.</entry>
	  </row>

	  <row>
	    <entry><varname>PERL_PORT</varname></entry>
	    <entry>Название установленного порта Perl, (к примеру,
	      <literal>perl5</literal>).</entry>
	  </row>

	  <row>
	    <entry><varname>SITE_PERL</varname></entry>
	    <entry>Имя каталога, куда помещаются специфичные для
	      сайта пакеты Perl.  Это значение добавляется к
	      <varname>PLIST_SUB</varname>.</entry>
	  </row>
	</tbody>
      </tgroup>
    </table>

    <note>
      <para>Порты для модулей Perl, которые не имеют официального
	вебсайта, должны указывать <systemitem>cpan.org</systemitem>
	в строке WWW в файле <filename>pkg-descr</filename>.
	Предпочтительная форма URL
	<literal>http://search.cpan.org/dist/Module-Name/</literal>
	(включая завершающий слэш).</para>
    </note>

    <note>
      <para>Не используйте <literal>${SITE_PERL}</literal> в
	объявлении зависимостей.  Использование этой конструкции
	подразумевает наличие подключенного
	<filename>bsd.perl.mk</filename>, что не всегда так.  Порты,
	зависимые от этого порта, получат неправильные зависимости,
	если файлы этого порта будут перемещены при последующем
	обновлении.  Правильный способ объявления зависимостей для
	модулей Perl показан в примере ниже.</para>
    </note>

    <example xml:id="use-perl-dependency-example">
      <title>Пример зависимости Perl</title>

      <programlisting>p5-IO-Tee&gt;=0.64:${PORTSDIR}/devel/p5-IO-Tee</programlisting>
    </example>

    <para>Для портов Perl, которые устанавливают страницы
      справочника, в <filename>pkg-plist</filename> можно
      использовать макрос
      <varname>PERL5_MAN<replaceable>x</replaceable></varname> (где
      <replaceable>x</replaceable> принимает значение от
      <literal>1</literal> до <literal>9</literal>).
      Например,</para>

    <programlisting>lib/perl5/5.14/man/man3/AnyEvent::I3.3.gz</programlisting>

    <para>можно заменить на</para>

    <programlisting>%%PERL5_MAN3%%/AnyEvent::I3.3.gz</programlisting>
  </sect1>

  <sect1 xml:id="using-x11">
    <title>Использование X11</title>

    <sect2 xml:id="x11-variables">
      <title>Компоненты X.Org</title>

      <para>X.Org является реализацией X11, доступной в Коллекции
	Портов.  Если ваше приложение зависит от компонентов X,
	установите в переменную <varname>USE_XORG</varname> в
	перечень требуемых компонентов.  К настоящему времени
	доступными компонентами являются:</para>

      <para><literal>bigreqsproto compositeproto damageproto dmx
	  dmxproto dri2proto evieproto fixesproto fontcacheproto
	  fontenc fontsproto fontutil glproto ice inputproto kbproto
	  libfs oldx pciaccess pixman printproto randrproto
	  recordproto renderproto resourceproto scrnsaverproto sm
	  trapproto videoproto x11 xau xaw xaw6 xaw7 xbitmaps
	  xcmiscproto xcomposite xcursor xdamage xdmcp xevie xext
	  xextproto xf86bigfontproto xf86dgaproto xf86driproto
	  xf86miscproto xf86rushproto xf86vidmodeproto xfixes xfont
	  xfontcache xft xi xinerama xineramaproto xkbfile xkbui xmu
	  xmuu xorg-server xp xpm xprintapputil xprintutil xproto
	  xproxymngproto xrandr xrender xres xscrnsaver xt xtrans
	  xtrap xtst xv xvmc xxf86dga xxf86misc
	  xxf86vm</literal>.</para>

      <para>Всегда актуальный перечень можно найти в
	<filename>/usr/ports/Mk/bsd.xorg.mk</filename>.</para>

      <para>Проект Mesa является попыткой обеспечить свободную
	реализацию OpenGL.  Вы можете указать зависимость от
	различных компонентов этого проекта при помощи переменной
	<varname>USE_GL</varname>.  Действительные опции:
	<literal>glut, glu, glw, glew, gl</literal> и
	<literal>linux</literal>.  Для обратной совместимости
	значение <literal>yes</literal> соответствует
	<literal>glu</literal>.</para>

      <example xml:id="use-xorg-example">
	<title>Пример для USE_XORG</title>

	<programlisting>USE_XORG=	xrender xft xkbfile xt xaw
USE_GL=		glu</programlisting>
      </example>

      <table frame="none">
	<title>Переменные для портов, использующих X</title>

	<tgroup cols="2">
	  <tbody>
	    <row>
	      <entry><varname>USES= imake</varname></entry>
	      <entry>Используется <command>imake</command>.</entry>
	    </row>

	    <row>
	      <entry><varname>XMKMF</varname></entry>
	      <entry>Задаёт маршрут до <command>xmkmf</command>, если
		он отсутствует в <envar>PATH</envar>.  По умолчанию
		это <literal>xmkmf -a</literal>.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <example xml:id="using-x11-vars">
	<title>Использование переменных X11 в порте</title>

	<programlisting># Использовать некоторые библиотеки X11
USE_XORG=	x11 xpm</programlisting>
      </example>
    </sect2>

    <sect2 xml:id="porting-motif">
      <title>Порты, которым требуется Motif</title>

      <para>Если вашему порту требуется Motif, задайте переменную
	<varname>USES= motif</varname> в файле
	<filename>Makefile</filename>.  Реализация Motif,
	используемая по умолчанию, находится в
	<package role="port">x11-toolkits/open-motif</package>.
	Пользователи вместо этого могут выбрать
	<package role="port">x11-toolkits/lesstif</package> через
	установку переменной <varname>WANT_LESSTIF</varname>.</para>

      <para>Переменная <varname>MOTIFLIB</varname> будет установлена
	в <filename>bsd.port.mk</filename>, чтобы ссылаться на
	соответствующую библиотеку Motif.  Пожалуйста, измените
	исходные тексты вашего порта на использование
	<literal>&dollar;{MOTIFLIB}</literal> везде, где упоминается
	библиотека Motif, в первоначальном
	<filename>Makefile</filename> или
	<filename>Imakefile</filename>.</para>

      <para>Существует два общих случая:</para>

      <itemizedlist>
	<listitem>
	  <para>Если порт обращается к библиотеке Motif как
	    <literal>-lXm</literal> в своих файлах
	    <filename>Makefile</filename> или
	    <filename>Imakefile</filename>, просто подставьте вместо
	    этих обращений
	    <literal>&dollar;{MOTIFLIB}</literal>.</para>
	</listitem>

	<listitem>
	  <para>Если порт использует <literal>XmClientLibs</literal>
	    в своем файле <filename>Imakefile</filename>, измените
	    это обращение на <literal>&dollar;{MOTIFLIB}
	      &dollar;{XTOOLLIB} &dollar;{XLIB}</literal>.</para>
	</listitem>
      </itemizedlist>

      <para>Заметьте, что переменная <varname>MOTIFLIB</varname> (как
	правило) раскрывается в
	<literal>-L/usr/local/lib -lXm</literal> или
	<literal>/usr/local/lib/libXm.a</literal>, так что нет нужды
	впереди добавлять <literal>-L</literal> или
	<literal>-l</literal>.</para>
    </sect2>

    <sect2>
      <title>Шрифты для X11</title>

      <para>Если ваш порт устанавливает шрифты для X Window System,
	поместите их в каталог
	<filename>LOCALBASE/lib/X11/fonts/local</filename>.</para>
    </sect2>

    <sect2>
      <title>Получение поддельного <envar>DISPLAY</envar>, используя
	Xvfb</title>

      <para>Некоторые приложения для успешной компиляции требуют
	наличие работающего дисплея X11.  Это создает проблему для
	машин, которые работают в режиме headless.  При использовании
	следующего канонического хака инфраструктура построения
	запустит сервер X в виртуальном фреймбуфере.  Затем
	переменная работающего <envar>DISPLAY</envar> передается при
	построении.</para>

      <programlisting>USES=	display</programlisting>
    </sect2>

    <sect2 xml:id="desktop-entries">
      <title>Элементы рабочего стола</title>

      <para>Элементы рабочего стола (<link
	  xlink:href="http://standards.freedesktop.org/desktop-entry-spec/latest/">стандарта
	  Freedesktop</link>) предоставляют способ автоматической
	настройки функций рабочего стола при установке новой
	программы, не требуя вмешательства пользователя.  Например,
	новые программы автоматически отображаются в меню приложений
	совместимых окружений рабочего стола.  Элементы рабочего
	стола изначально появились в окружении рабочего стола
	<application>GNOME</application>, но в настоящее время
	являются стандартом и также работают с
	<application>KDE</application> и
	<application>Xfce</application>.  Такая небольшая
	автоматизация предоставляет реальное удобство для
	пользователя, и посему элементы рабочего стола приветствуются
	в приложениях, которые можно использовать в окружении
	рабочего стола.</para>

      <sect3>
	<title>Использование предопределенных файлов
	  <filename>.desktop</filename></title>

	<para>Порты, включающие предопределенные файлы
	  <filename>*.desktop</filename>, должны включать эти файлы в
	  <filename>pkg-plist</filename> и устанавливать их в каталог
	  <filename>&dollar;LOCALBASE/share/applications</filename>.
	  Для установки этих файлов используется <link
	    linkend="install-macros">макрос
	    <varname>INSTALL_DATA</varname></link>.</para>
      </sect3>

      <sect3 xml:id="updating-desktop-database">
	<title>Обновление базы данных рабочего стола</title>

	<para>Если в файле порта
	  <filename>portname.desktop</filename> имеется запись
	  MimeType, то база данных рабочего стола олжна быть
	  обновлена после установки и удаления.  Для этого укажите
	  <varname>USES</varname>= desktop-file-utils.</para>
      </sect3>

      <sect3 xml:id="desktop-entries-macro">
	<title>Создание элементов рабочего стола с использованием
	  <varname>DESKTOP_ENTRIES</varname></title>

	<para>Элементы рабочего стола можно легко создавать для
	  приложений, используя переменную
	  <varname>DESKTOP_ENTRIES</varname>.  Будет автоматически
	  создан, установлен и добавлен в
	  <filename>pkg-plist</filename> файл с названием
	  <filename>name.desktop</filename>.  Синтаксис:</para>

	<programlisting>DESKTOP_ENTRIES=	"NAME" "COMMENT" "ICON" "COMMAND" "CATEGORY" StartupNotify</programlisting>

	<para>Перечень возможных категорий доступен на <link
	    xlink:href="http://standards.freedesktop.org/menu-spec/latest/apa.html">вебсайте
	    Freedesktop</link>.  <varname>StartupNotify</varname>
	  отобразит, поддерживает ли приложение <emphasis>уведомления
	    о запуске</emphasis>.  Как правило, это графический
	  индикатор часы вместо указателя мыши, меню или панель,
	  которые уведомляют пользователя о загрузке программы.
	  Программа, поддерживающая уведомления о запуске, очистит
	  этот индикатор после запуска.  Программы, несовместимые с
	  уведомлениями о запуске, не будут очищать индикатор
	  (возможно, вызывая путаницу и приводя пользователей в
	  бешенство), и поэтому должны иметь
	  <varname>StartupNotify</varname> в выключенном состоянии
	  <literal>false</literal>; тогда индикатор не будет
	  отображаться совсем.</para>

	<para>Пример:</para>

	<programlisting>DESKTOP_ENTRIES=	"ToME" "Roguelike game based on JRR Tolkien's work" \
			"${DATADIR}/xtra/graf/tome-128.png" \
			"tome -v -g" "Application;Game;RolePlaying;" \
			false</programlisting>
      </sect3>
    </sect2>
  </sect1>

  <sect1 xml:id="using-gnome">
    <title>Использование GNOME</title>

    <para>Для задания того, какие компоненты GNOME использует
      конкретный порт, проект &os;/GNOME использует собственный набор
      переменных.  На странице проекта &os;/GNOME размещён <link
	xlink:href="http://www.FreeBSD.org/gnome/docs/porting.html">
	исчерпывающий список этих переменных</link>.</para>
  </sect1>

  <sect1 xml:id="using-qt">
    <title>Использование Qt</title>

    <sect2 xml:id="qt-common">
      <title>Порты, для которых требуется Qt</title>

      <table frame="none">
	<title>Переменные для портов, использующих Qt</title>

	<tgroup cols="2">
	  <tbody>
	    <row>
	      <entry><varname>USE_QT4</varname></entry>
	      <entry>Указывает инструменты и библиотеки в качестве
		зависимостей для портов, которые используют Qt 4.
		Для получения подробностей смотрите <link
		  linkend="qt4-components">выбор компонентов Qt
		  4</link>.</entry>
	    </row>

	    <row>
	      <entry><varname>QT_PREFIX</varname></entry>
	      <entry>Устанавливается в значение, содержащее путь к
		установленному Qt (переменная только для
		чтения).</entry>
	    </row>

	    <row>
	      <entry><varname>MOC</varname></entry>
	      <entry>Устанавливается в значение, содержащее путь к
		<command>moc</command> (переменная только для
		чтения).  По умолчанию устанавливается в соответствии
		со значением <varname>USE_QT_VER</varname>.</entry>
	    </row>

	    <row>
	      <entry><varname>QTCPPFLAGS</varname></entry>
	      <entry>Дополнительные флаги компилятора для
		инструментального пакета Qt, передаваемые через
		переменную <varname>CONFIGURE_ENV</varname>.  По
		умолчанию устанавливается в соответствии со значением
		<varname>USE_QT_VER</varname>.</entry>
	    </row>

	    <row>
	      <entry><varname>QTCFGLIBS</varname></entry>
	      <entry>Дополнительные флаги компоновки для
		инструментального пакета Qt, передаваемые через
		переменную <varname>CONFIGURE_ENV</varname>.  По
		умолчанию устанавливается в соответствии со значением
		<varname>USE_QT_VER</varname>.</entry>
	    </row>

	    <row>
	      <entry><varname>QTNONSTANDARD</varname></entry>
	      <entry>Подавляет изменение
		<varname>CONFIGURE_ENV</varname>,
		<varname>CONFIGURE_ARGS</varname>,
		<varname>CPPFLAGS</varname> и
		<varname>MAKE_ENV</varname>.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <table frame="none">
	<title>Дополнительные переменные для портов, использующих Qt
	  4.x</title>

	<tgroup cols="2">
	  <tbody>
	    <row>
	      <entry><varname>UIC</varname></entry>
	      <entry>Устанавливает путь к <command>uic</command>
		(переменная только для чтения).</entry>
	    </row>

	    <row>
	      <entry><varname>QMAKE</varname></entry>
	      <entry>Устанавливает путь к <command>qmake</command>
		(переменная только для чтения).</entry>
	    </row>

	    <row>
	      <entry><varname>QMAKESPEC</varname></entry>
	      <entry>Устанавливает путь к конфигурационному файлу для
		<command>qmake</command> (переменная только для
		чтения).</entry>
	    </row>

	    <row>
	      <entry><varname>QMAKEFLAGS</varname></entry>
	      <entry>Дополнительные флаги для
		<command>qmake</command>.</entry>
	    </row>

	    <row>
	      <entry><varname>QT_INCDIR</varname></entry>
	      <entry>Устанавливает каталоги для заголовков Qt 4
		(переменная только для чтения).</entry>
	    </row>

	    <row>
	      <entry><varname>QT_LIBDIR</varname></entry>
	      <entry>Устанавливает путь к библиотекам Qt 4
		(переменная только для чтения).</entry>
	    </row>

	    <row>
	      <entry><varname>QT_PLUGINDIRC</varname></entry>
	      <entry>Устанавливает путь к плагинам Qt 4 (переменная
		только для чтения).</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>При заданной переменной <varname>USE_QT4</varname>
	применяются следующие настройки:</para>

      <programlisting>CONFIGURE_ARGS+=	--with-qt-includes=${QT_INCDIR} \
			--with-qt-libraries=${QT_LIBDIR} \
			--with-extra-libs=${LOCALBASE}/lib \
			--with-extra-includes=${LOCALBASE}/include
CONFIGURE_ENV+=	MOC="${MOC}" UIC="${UIC}" LIBS="${QTCFGLIBS}" \
		QMAKE="${QMAKE}" QMAKESPEC="${QMAKESPEC}" QTDIR="${QT_PREFIX}"
MAKE_ENV+=	QMAKESPEC="${QMAKESPEC}"

PLIST_SUB+=	QT_INCDIR_REL=${QT_INCDIR_REL} \
		QT_LIBDIR_REL=${QT_LIBDIR_REL} \
		QT_PLUGINDIR_REL=${QT_PLUGINDIR_REL}</programlisting>
    </sect2>

    <sect2 xml:id="qt4-components">
      <title>Выбор компонентов</title>

      <para>В переменной <varname>USE_QT4</varname> должны
	указываться зависимости от отдельных инструментов и библиотек
	Qt 4.  К каждому компоненту можно добавить суффикс,
	<literal>_build</literal> или <literal>_run</literal>,
	отражающий, когда должна быть применена зависимость, во время
	сборки или выполнения, соответственно.  Если суффикс
	отсутствует, зависимость от компонента будет и для времени
	сборки, и для времени выполнения.  Обычно, компоненты
	библиотек должны указываться без суффиксов, компоненты
	инструментов - с суффиксом <literal>_build</literal>, а
	компоненты плагинов - с суффиксом <literal>_run</literal>.
	Наиболее общие используемые компоненты перечислены ниже (все
	доступные компоненты перечислены в
	<varname>_USE_QT4_ALL</varname> в файле
	<filename>/usr/ports/Mk/bsd.qt.mk</filename>):</para>

      <table frame="none">
	<title>Доступные библиотечные компоненты Qt 4</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Название</entry>
	      <entry>Описание</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><literal>corelib</literal></entry>
	      <entry>основная библиотека (можно опустить, если порт
		не использует ничего, кроме
		<literal>corelib</literal>)</entry>
	    </row>

	    <row>
	      <entry><literal>gui</literal></entry>
	      <entry>библиотека графического пользовательского
		интерфейса</entry>
	    </row>

	    <row>
	      <entry><literal>network</literal></entry>
	      <entry>сетевая библиотека</entry>
	    </row>

	    <row>
	      <entry><literal>opengl</literal></entry>
	      <entry>библиотека OpenGL</entry>
	    </row>

	    <row>
	      <entry><literal>qt3support</literal></entry>
	      <entry>библиотека совместимости с Qt 3</entry>
	    </row>

	    <row>
	      <entry><literal>qtestlib</literal></entry>
	      <entry>библиотека модульного тестирования</entry>
	    </row>

	    <row>
	      <entry><literal>script</literal></entry>
	      <entry>библиотека сценариев</entry>
	    </row>

	    <row>
	      <entry><literal>sql</literal></entry>
	      <entry>библиотека SQL</entry>
	    </row>

	    <row>
	      <entry><literal>xml</literal></entry>
	      <entry>библиотека XML</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Вы можете определить, от каких библиотек зависит
	приложение, запустив <command>ldd</command> на основной
	исполняемый файл после успешной компиляции.</para>

      <table frame="none">
	<title>Доступные компоненты инструментов Qt 4</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Название</entry>
	      <entry>Описание</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><literal>moc</literal></entry>
	      <entry>мета-объектный компилятор (нужен при построении
		почти для каждого приложения Qt)</entry>
	    </row>

	    <row>
	      <entry><literal>qmake</literal></entry>
	      <entry>генератор Makefile / утилита построения</entry>
	    </row>

	    <row>
	      <entry><literal>rcc</literal></entry>
	      <entry>компилятор ресурсов (нужен, если приложение идет
		вместе с файлами <filename>*.rc</filename> или
		<filename>*.qrc</filename>)</entry>
	    </row>

	    <row>
	      <entry><literal>uic</literal></entry>
	      <entry>компилятор пользовательского интерфейса (нужен,
		если приложение идет вместе с файлами
		<filename>*.ui</filename>, созданными при помощи Qt
		Designer, - на практике каждое приложение Qt с
		GUI)</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <table frame="none">
	<title>Доступные компоненты плагинов Qt 4</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Название</entry>
	      <entry>Описание</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><literal>iconengines</literal></entry>
	      <entry>плагин для движка иконок SVG (если приложение
		поставляется с иконками SVG)</entry>
	    </row>

	    <row>
	      <entry><literal>imageformats</literal></entry>
	      <entry>плагины для графических форматов GIF, JPEG, MNG
		и SVG (если приложение поставляется с графическими
		файлами)</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <example xml:id="qt4-components-example">
	<title>Выбор компонентов Qt 4</title>

	<para>В этом примере портированное приложение использует
	  библиотеку графического пользовательского интерфейса Qt 4,
	  основную библиотеку Qt 4, все инструменты генерации кода
	  Qt 4 и генератор Makefile Qt 4.  Поскольку библиотека
	  <literal>gui</literal> подразумевает зависимость от
	  основной библиотеки, указывать <literal>corelib</literal>
	  нет необходимости.  Инструменты генерации кода Qt 4
	  <literal>moc</literal>, <literal>uic</literal> и
	  <literal>rcc</literal>, а также генератор Makefile
	  <literal>qmake</literal> нужны только для времени
	  построения, поэтому они указаны с суффиксом
	  <literal>_build</literal>:</para>

	<programlisting>USE_QT4=	gui moc_build qmake_build rcc_build uic_build</programlisting>
      </example>
    </sect2>

    <sect2 xml:id="using-qmake">
      <title>Использование <command>qmake</command></title>

      <table frame="none">
	<title>Переменные для портов, использующих
	  <command>qmake</command></title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Название</entry>
	      <entry>Описание</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><varname>QMAKE_ARGS</varname></entry>
	      <entry>Спефицичные для порта флаги
		<application>QMake</application> для передачи
		программе <command>qmake</command>.</entry>
	    </row>

	    <row>
	      <entry><varname>QMAKE_ENV</varname></entry>
	      <entry>Переменные окружения, устанавливаемые для
		программы <command>qmake</command>.  По умолчанию
		соответствует значению
		<literal>&dollar;{CONFIGURE_ENV}</literal>.</entry>
	    </row>

	    <row>
	      <entry><varname>QMAKE_PRO</varname></entry>
	      <entry>Название файла проекта
		<filename>.pro</filename>.  По умолчанию имеет пустое
		значение (с использованием автоопределения).</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Если вместе с приложением вместо
	<filename>configure</filename> поставляется файл
	<filename>.pro</filename>, вы можете использовать
	следующее:</para>

      <programlisting>USES=	qmake
USE_QT4=	qmake_build</programlisting>

      <para><literal>USES=qmake</literal> указывает порту на
	использование <command>qmake</command> в процессе
	конфигурации.  Обратите внимание, что
	<literal>USES=qmake</literal> не подразумевает зависимость от
	Qt 4 <command>qmake</command>.  Для этого в значении
	<literal>USE_QT4</literal> должен присутствовать компонент
	<literal>qmake_build</literal>.</para>

      <para>Приложения Qt часто пишутся в кроссплатформенной манере,
	и X11/Unix часто не является для них платформой разработки,
	что в свою очередь часто приводит к соответствующим упущенным
	моментам:</para>

      <itemizedlist>
	<listitem>
	  <para><emphasis>Отсутствующие дополнительные пути для
	      заголовочных файлов.</emphasis>  Многие приложения идут
	    с поддержкой иконки в системном трее, но пренебрегают
	    смотреть на наличие заголовочных файлов и/или
	    библиотеками в каталогах X11.  Вы можете сообщить
	    <command>qmake</command>, чтобы она добавила каталоги в
	    пути поиска заголовочных файлов и библиотек через
	    командную строку.  К примеру:</para>

	  <programlisting>QMAKE_ARGS+= INCLUDEPATH+=${LOCALBASE}/include \
	LIBS+=-L${LOCALBASE}/lib</programlisting>
	</listitem>

	<listitem>
	  <para><emphasis>Фиктивные пути установки.</emphasis>
	    Иногда данные, такие как иконки и файлы .desktop,
	    устанавливаются по умолчанию в каталоги, которые не
	    просматриваются XDG-совместимыми приложениями.  Примером
	    является <package role="port">editors/texmaker</package>
	    - взгляните на <filename>patch-texmaker.pro</filename> из
	    каталога <filename>files</filename> этого порта, который
	    можно взять в качестве шаблона исправления этого
	    непосредственно в файле проекта
	    <command>qmake</command>.</para>
	</listitem>
      </itemizedlist>
    </sect2>
  </sect1>

  <sect1 xml:id="using-kde">
    <title>Использование KDE</title>

    <sect2 xml:id="kde4-variables">
      <title>Задание переменных KDE 4</title>

      <para>Если ваше приложение зависит от KDE 4.x, присвойте
	<varname>USE_KDE4</varname> список требуемых компонентов.
	Для переопределения типа зависимости компонента могут быть
	использованы суффиксы <literal>_build</literal> и
	<literal>_run</literal> (например,
	<literal>baseapps_run</literal>).  Если суффикс не задан,
	будет использован тип зависимости по умолчанию.  Если вы
	хотите использовать оба типа, добавьте компонент дважды с
	обоими суффиксами (например,
	<literal>automoc4_build automoc4_run</literal>).  Основные
	наиболее используемые компоненты перечислены ниже (актуальные
	компоненты задокументированы в начале файла
	<filename>/usr/ports/Mk/bsd.kde4.mk</filename>):</para>

      <table frame="none">
	<title>Доступные компоненты KDE 4</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Название</entry>
	      <entry>Описание</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><literal>kdehier</literal></entry>
	      <entry>Иерархия основных каталогов KDE</entry>
	    </row>

	    <row>
	      <entry><literal>kdelibs</literal></entry>
	      <entry>KDE Developer Platform</entry>
	    </row>

	    <row>
	      <entry><literal>kdeprefix</literal></entry>
	      <entry>Если установлено, то порт будет установлен в
		<literal>&dollar;{KDE4_PREFIX}</literal> вместо
		<literal>&dollar;{LOCALBASE}</literal></entry>
	    </row>

	    <row>
	      <entry><literal>sharedmime</literal></entry>
	      <entry>База данных MIME типов для портов KDE</entry>
	    </row>

	    <row>
	      <entry><literal>automoc4</literal></entry>
	      <entry>automoc для пакетов Qt 4</entry>
	    </row>

	    <row>
	      <entry><literal>akonadi</literal></entry>
	      <entry>Сервер хранения KDE-Pim</entry>
	    </row>

	    <row>
	      <entry><literal>soprano</literal></entry>
	      <entry>Фреймворк Qt 4 RDF</entry>
	    </row>

	    <row>
	      <entry><literal>strigi</literal></entry>
	      <entry>Поисковые даемон рабочего стола</entry>
	    </row>

	    <row>
	      <entry><literal>libkcddb</literal></entry>
	      <entry>Библиотека KDE CDDB</entry>
	    </row>

	    <row>
	      <entry><literal>libkcompactdisc</literal></entry>
	      <entry>Библиотека KDE для взаимодействия с
		аудио-CD</entry>
	    </row>

	    <row>
	      <entry><literal>libkdeedu</literal></entry>
	      <entry>Библиотеки, используемые для образовательных
		приложений</entry>
	    </row>

	    <row>
	      <entry><literal>libkdcraw</literal></entry>
	      <entry>Библиотека KDE LibRaw</entry>
	    </row>

	    <row>
	      <entry><literal>libkexiv2</literal></entry>
	      <entry>Библиотека KDE Exiv2</entry>
	    </row>

	    <row>
	      <entry><literal>libkipi</literal></entry>
	      <entry> KDE Image Plugin Interface</entry>
	    </row>

	    <row>
	      <entry><literal>libkonq</literal></entry>
	      <entry>Основная библиотека Konqueror</entry>
	    </row>

	    <row>
	      <entry><literal>libksane</literal></entry>
	      <entry>Библиотека KDE SANE ("Scanner Access Now
		Easy")</entry>
	    </row>

	    <row>
	      <entry><literal>pimlibs</literal></entry>
	      <entry>Библиотеки KDE-Pim</entry>
	    </row>

	    <row>
	      <entry><literal>kate</literal></entry>
	      <entry>Тектовый редактор</entry>
	    </row>

	    <row>
	      <entry><literal>marble</literal></entry>
	      <entry>Виртуальный глобус</entry>
	    </row>

	    <row>
	      <entry><literal>okular</literal></entry>
	      <entry>Универсальный просмотрщик документов</entry>
	    </row>

	    <row>
	      <entry><literal>korundum</literal></entry>
	      <entry>Привязка Ruby к KDE</entry>
	    </row>

	    <row>
	      <entry><literal>perlkde</literal></entry>
	      <entry>Привязка Perl к KDE</entry>
	    </row>

	    <row>
	      <entry><literal>pykde4</literal></entry>
	      <entry>Привязка Python к KDE</entry>
	    </row>

	    <row>
	      <entry><literal>pykdeuic4</literal></entry>
	      <entry>Компилятор пользовательского интерфейса
		PyKDE</entry>
	    </row>

	    <row>
	      <entry><literal>smokekde</literal></entry>
	      <entry>Библиотеки KDE SMOKE</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Порты KDE 4.x устанавливаются в
	<varname>KDE4_PREFIX</varname>, что в настоящее время
	соответствует <filename>/usr/local/kde4</filename>.  Это
	достигается путем указания компонента
	<literal>kdeprefix</literal>, который определяет значение по
	умолчанию для <varname>PREFIX</varname>.  Тем не менее, порты
	учитывают любые <varname>PREFIX</varname>, установленные
	через переменную окружения <envar>MAKEFLAGS</envar> и/или
	параметры <command>make</command>.</para>

      <example xml:id="kde4-components-example">
	<title>Пример <varname>USE_KDE4</varname></title>

	<para>Это простой пример для порта KDE 4.
	  <literal>USES= cmake:outsource</literal> указывает порту
	  использовать <application>CMake</application>,
	  конфигурационный инструмент, широко применяемый в проектах
	  KDE 4 (подробное описание даёт <xref
	    linkend="using-cmake"/>).  <varname>USE_KDE4</varname>
	  добавляет зависимость от библиотек KDE и заставляет порты
	  использовать <command>automoc4</command> во время сборки.
	  Требуемые компоненты KDE и другие зависимости можно
	  определить в журнале configure.
	  <varname>USE_KDE4</varname> не подразумевает
	  <varname>USE_QT4</varname>.  Если порт требует какой-либо
	  из компонентов Qt 4, их следует указать в
	  <varname>USE_QT4</varname>.</para>

	<programlisting>USES=		cmake:outsource
USE_KDE4=	kdelibs kdeprefix automoc4
USE_QT4=	moc_build qmake_build rcc_build uic_build</programlisting>
      </example>
    </sect2>
  </sect1>

  <sect1 xml:id="using-java">
    <title>Использование Java</title>

    <sect2 xml:id="java-variables">
      <title>Задание переменных</title>

      <para>Если вашему порту необходимо наличие Java&trade;
	Development Kit (JDK&trade;) для построения, работы или даже
	распаковки дистрибутивного файла, то в нём должна быть задана
	переменная <varname>USE_JAVA</varname>.</para>

      <para>В Коллекции Портов присутствуют несколько JDK различных
	разработчиков и разных версий.  Если ваш порт должен
	использовать одну из этих версий, то вы должны указать, какую
	именно.  Самой последней версией и версией по умолчанию
	является <package role="port">java/openjdk6</package>.</para>

      <table frame="none">
	<title>Переменные, которые которые могут задаваться портами,
	  использующими Java</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Переменная</entry>
	      <entry>Значение</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><varname>USE_JAVA</varname></entry>
	      <entry>Должна быть определена для того, что последующие
		переменные вступили в действие.</entry>
	    </row>

	    <row>
	      <entry><varname>JAVA_VERSION</varname></entry>
	      <entry>Список версий Java, перечисленных через пробел,
		подходящих для порта.  Опциональный знак
		<literal>"+"</literal> позволяет вам указать диапазон
		версий (возможные значения:
		<literal>1.5[+] 1.6[+] 1.7[+]</literal>).</entry>
	    </row>

	    <row>
	      <entry><varname>JAVA_OS</varname></entry>
	      <entry>Список операционных систем, перечисленных через
		пробел, порты JDK для которых подходят для порта
		(возможные значения:
		<literal>native linux</literal>).</entry>
	    </row>

	    <row>
	      <entry><varname>JAVA_VENDOR</varname></entry>
	      <entry>Список разработчиков портов JDK, перечисленных
		через пробел, которые подходят для порта (возможные
		значения: <literal>freebsd bsdjava sun
		  openjdk</literal>).</entry>
	    </row>

	    <row>
	      <entry><varname>JAVA_BUILD</varname></entry>
	      <entry>Если задана, то означает, что выбранный порт JDK
		должен быть добавлен к зависимостям порта для его
		построения.</entry>
	    </row>

	    <row>
	      <entry><varname>JAVA_RUN</varname></entry>
	      <entry>Если задана, то означает, что выбранный порт JDK
		должен быть добавлен в зависимостям порта для его
		работы.</entry>
	    </row>

	    <row>
	      <entry><varname>JAVA_EXTRACT</varname></entry>
	      <entry>Если задана, то означает, что выбранный порт JDK
		должен быть добавлен в зависимостям порта для
		распаковки его дистрибутивных файлов.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Ниже перечисляются все значения, которые принимают
	переменные после задания переменной
	<varname>USE_JAVA</varname>:</para>

      <table frame="none">
	<title>Переменные, доступные в портах, использующих
	  Java</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Переменная</entry>
	      <entry>Значение</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><varname>JAVA_PORT</varname></entry>
	      <entry>Название порта JDK (к примеру,
		<literal>'java/openjdk6'</literal>).</entry>
	    </row>

	    <row>
	      <entry><varname>JAVA_PORT_VERSION</varname></entry>
	      <entry>Полное наименовании версии порта JDK (к примеру,
		<literal>'1.6.0'</literal>).  Если вам нужны только
		первые две цифры номера версии, используйте
		<varname>${JAVA_PORT_VERSION:C/^([0-9])\.([0-9])(.*)$/\1.\2/}</varname>.</entry>
	    </row>

	    <row>
	      <entry><varname>JAVA_PORT_OS</varname></entry>
	      <entry>Операционная система, используемая портом JDK
		(к примеру, <literal>'native'</literal>).</entry>
	    </row>

	    <row>
	      <entry><varname>JAVA_PORT_VENDOR</varname></entry>
	      <entry>Разработчик порта JDK (к примеру,
		<literal>'openjdk'</literal>).</entry>
	    </row>

	    <row>
	      <entry><varname>JAVA_PORT_OS_DESCRIPTION</varname></entry>
	      <entry>Описание операционной системы, используемой
		портом JDK (к примеру,
		<literal>'Native'</literal>).</entry>
	    </row>

	    <row>
	      <entry><varname>JAVA_PORT_VENDOR_DESCRIPTION</varname></entry>
	      <entry>Описание разработчика порта JDK (к примеру,
		<literal>'OpenJDK BSD Porting
		  Team'</literal>).</entry>
	    </row>

	    <row>
	      <entry><varname>JAVA_HOME</varname></entry>
	      <entry>Маршрут к установочному каталогу JDK (к примеру,
		<filename>'/usr/local/openjdk6'</filename>).</entry>
	    </row>

	    <row>
	      <entry><varname>JAVAC</varname></entry>
	      <entry>Маршрут к используемому компилятору Java
		(к примеру,
		<filename>'/usr/local/openjdk6/bin/javac'</filename>.</entry>
	    </row>

	    <row>
	      <entry><varname>JAR</varname></entry>
	      <entry>Маршрут к используемой утилите
		<command>jar</command> (к примеру,
		<filename>'/usr/local/openjdk6/bin/jar'</filename>
		или
		<filename>'/usr/local/bin/fastjar'</filename>).</entry>
	    </row>

	    <row>
	      <entry><varname>APPLETVIEWER</varname></entry>
	      <entry>Маршрут к утилите
		<command>appletviewer</command> (к примеру,
		<filename>'/usr/local/openjdk6/bin/appletviewer'</filename>).</entry>
	    </row>

	    <row>
	      <entry><varname>JAVA</varname></entry>
	      <entry>Маршрут к выполняемому файлу
		<command>java</command>.  Используйте его для запуска
		Java-программ (к примеру,
		<filename>'/usr/local/openjdk6/bin/java'</filename>).</entry>
	    </row>

	    <row>
	      <entry><varname>JAVADOC</varname></entry>
	      <entry>Маршрут к вспомогательной программе
		<command>javadoc</command>.</entry>
	    </row>

	    <row>
	      <entry><varname>JAVAH</varname></entry>
	      <entry>Маршрут к программе
		<command>javah</command>.</entry>
	    </row>

	    <row>
	      <entry><varname>JAVAP</varname></entry>
	      <entry>Маршрут к программе
		<command>javap</command>.</entry>
	    </row>

	    <row>
	      <entry><varname>JAVA_KEYTOOL</varname></entry>
	      <entry>Маршрут к вспомогательной программе
		<command>keytool</command>.</entry>
	    </row>

	    <row>
	      <entry><varname>JAVA_N2A</varname></entry>
	      <entry>Маршрут к утилите
		<command>native2ascii</command>.</entry>
	    </row>

	    <row>
	      <entry><varname>JAVA_POLICYTOOL</varname></entry>
	      <entry>Маршрут к программе
		<command>policytool</command>.</entry>
	    </row>

	    <row>
	      <entry><varname>JAVA_SERIALVER</varname></entry>
	      <entry>Маршрут к вспомогательной программе
		<command>serialver</command>.</entry>
	    </row>

	    <row>
	      <entry><varname>RMIC</varname></entry>
	      <entry>Маршрут к генератору каркаса программ RMI,
		утилите <command>rmic</command>.</entry>
	    </row>

	    <row>
	      <entry><varname>RMIREGISTRY</varname></entry>
	      <entry>Маршрут к программе регистрации RMI,
		<command>rmiregistry</command>.</entry>
	    </row>

	    <row>
	      <entry><varname>RMID</varname></entry>
	      <entry>Маршрут к программе-даемону RMI
		<command>rmid</command>.</entry>
	    </row>

	    <row>
	      <entry><varname>JAVA_CLASSES</varname></entry>
	      <entry>Маршрут к архиву, который содержит файлы классов
		JDK,
		<filename>${JAVA_HOME}/jre/lib/rt.jar</filename>.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Вы можете воспользоваться make-целью
	<literal>java-debug</literal> для получения информации,
	необходимой для отладки вашего порта.  При её выполнении
	будут выданы значения многих упомянутых выше
	переменных.</para>

      <para>Кроме того, для единообразия установки всех портов Java
	определены следующие константы:</para>

      <table frame="none">
	<title>Константы, определённые для портов, использующих
	  Java</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Константа</entry>
	      <entry>Значение</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><varname>JAVASHAREDIR</varname></entry>
	      <entry>Корневой каталог для всего, что связано с Java.
		По умолчанию:
		<filename>${PREFIX}/share/java</filename>.</entry>
	    </row>

	    <row>
	      <entry><varname>JAVAJARDIR</varname></entry>
	      <entry>Каталог, в который должны устанавливаться
		JAR-файлы.  По умолчанию:
		<filename>${JAVASHAREDIR}/classes</filename>.</entry>
	    </row>

	    <row>
	      <entry><varname>JAVALIBDIR</varname></entry>
	      <entry>Каталог, в который устанавливаются JAR-файлы из
		других портов.  По умолчанию:
		<filename>${LOCALBASE}/share/java/classes</filename>.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Соответствующие записи определяются в обоих переменных
	<varname>PLIST_SUB</varname> (описана в
	<xref linkend="plist-sub"/>) и
	<varname>SUB_LIST</varname>.</para>
    </sect2>

    <sect2 xml:id="java-building-with-ant">
      <title>Построение с Ant</title>

      <para>Если построение порта производится с использованием
	Apache Ant, то необходимо определить
	<varname>USE_ANT</varname>.  Таким образом Ant становится
	подкомандой make.  Если в порте не определена цель
	<literal>do-build</literal>, то будет установлена цель по
	умолчанию, которая просто запускает Ant в соответствии со
	значением <varname>MAKE_ENV</varname>,
	<varname>MAKE_ARGS</varname> и <varname>ALL_TARGET</varname>.
	Это похоже на механизм <varname>USES= gmake</varname>,
	который описан в <xref linkend="building"/>.</para>
    </sect2>

    <sect2 xml:id="java-best-practices">
      <title>Практические рекомендации</title>

      <para>При портировании Java-библиотеки ваш порт должен
	устанавливать JAR-файл(ы) в каталог
	<filename>${JAVAJARDIR}</filename>, а все остальные данные в
	каталог <filename>${JAVASHAREDIR}/${PORTNAME}</filename> (за
	исключением документации, о которой пойдёт речь ниже).  Для
	уменьшения размера упакованного файла вы можете сослаться на
	JAR-файл(ы) непосредственно в файле
	<filename>Makefile</filename>.  Просто воспользуйтесь
	следующей директивой (в которой
	<filename>myport.jar</filename> является именем JAR-файла,
	устанавливаемого как часть порта):</para>

      <programlisting>PLIST_FILES+=	%%JAVAJARDIR%%/myport.jar</programlisting>

      <para>При портировании Java-приложения порт обычно
	устанавливает всё в один каталог (в том числе все свои
	JAR-зависимости).  В этом отношении настоятельно
	рекомендуется использование
	<filename>${JAVASHAREDIR}/${PORTNAME}</filename>.  На
	усмотрение создателя порта остаётся решение вопроса о том,
	устанавливать ли дополнительные JAR-зависимости в этот
	каталог или напрямую использовать уже установленные (из
	каталога <filename>${JAVAJARDIR}</filename>).</para>

      <para>При портировании приложения &java;, для запуска сервиса
	которого требуется сервер приложений, такой как <package
	  role="port">www/tomcat7</package>, для производителя в
	порядке вещей является распространение файла
	<filename>.war</filename>.  Файл <filename>.war</filename>
	&mdash; это Веб-приложение АРхивированное и оно
	распаковывается при вызове данным приложением.  Избегайте
	добавлять файлы <filename>.war</filename> в
	<filename>pkg-plist</filename>.  Это не является наилучшим
	решением.  Сервер приложений производит расширение архива
	<filename>war</filename> без должной его очистки при удалении
	порта.  Более подходящим способом работы с этим файлом будет
	распаковать архив, установить файлы и добавить их в
	<filename>pkg-plist</filename>.</para>

      <programlisting>TOMCATDIR=	${LOCALBASE}/apache-tomcat-7.0
WEBAPPDIR=	myapplication

post-extract:
	@${MKDIR} ${WRKDIR}/${PORTDIRNAME}
	@${TAR} xf ${WRKDIR}/myapplication.war -C ${WRKDIR}/${PORTDIRNAME}

do-install:
	cd ${WRKDIR} &amp;&amp; \
	${INSTALL} -d -o ${WWWOWN} -g ${WWWGRP} ${TOMCATDIR}/webapps/${PORTDIRNAME}
	@cd ${WRKDIR}/${PORTDIRNAME} &amp;&amp; ${COPYTREE_SHARE} \* ${WEBAPPDIR}/${PORTDIRNAME}</programlisting>

      <para>Вне зависимости от типа вашего порта (библиотека это или
	приложение), дополнительная документация должна
	устанавливаться <link linkend="install-documentation">в тоже
	самое место</link>, что и для других портов.  Известно, что в
	зависимости от используемой версии JDK утилита JavaDoc
	генерирует различные наборы файлов.  Для портов, которые не
	привязаны к использованию определённой версии JDK, таким
	образом становится проблематичным определить список файлов
	для упаковки (<filename>pkg-plist</filename>).  Это одна из
	причин, по которой создателям портов настоятельно
	рекомендуется использовать макрос
	<varname>PORTDOCS</varname>.  Более того, даже если вы
	сможете угадать набор файлов, который будет сгенерирован
	утилитой <command>javadoc</command>, размер получающегося
	файла <filename>pkg-plist</filename> голосует за
	использование <varname>PORTDOCS</varname>.</para>

      <para>Значением по умолчанию для переменной
	<varname>DATADIR</varname> является
	<filename>${PREFIX}/share/${PORTNAME}</filename>.  Хорошей
	идеей является переопределение для Java-портов значения
	<varname>DATADIR</varname> как
	<filename>${JAVASHAREDIR}/${PORTNAME}</filename>.  На самом
	деле <varname>DATADIR</varname> автоматически добавляется к
	<varname>PLIST_SUB</varname> (это описано в <xref
	  linkend="plist-sub"/>), так что вы сможете использовать
	<literal>%%DATADIR%%</literal> непосредственно в
	<filename>pkg-plist</filename>.</para>

      <para>Что касается выбора между построением портов Java из
	исходных текстов или их прямой установкой из бинарных
	дистрибутивов, то на момент создания этого текста
	определённой политики на этот счёт не существует.  Однако
	участники <link
	  xlink:href="http://www.freebsd.org/java/">Проекта &os;
	  Java</link> рекомендуют создателям портов строить их из
	исходных текстов, если эта задача является несложной.</para>

      <para>Все возможности, которые были описаны в этом разделе,
	реализованы в файле <filename>bsd.java.mk</filename>.  Если
	вы предположите, что вашему порту требуется менее тривиальная
	поддержка Java, пожалуйста, взгляните сначала на <link
	  xlink:href="http://svnweb.FreeBSD.org/ports/head/Mk/bsd.java.mk?view=markup">журнал
	  изменений bsd.java.mk в
	  <application>Subversion</application></link>, так как для
	документирования последних изменений требуется какое-то
	время.  Затем, если вы думаете, что не хватающая вам
	поддержка окажется полезной для многих других портов Java,
	обсудите ваш вопрос в &a.java;.</para>

      <para>Хотя в базе сообщений об ошибках для соответствующих PR
	имеется категория <literal>java</literal>, она относится к
	работе над портированием JDK, которые проводит Проект &os;
	Java.  Таким образом, вы должны относить свой Java-порт, как
	и любой другой, к категории <literal>ports</literal>, если
	решаемый вами вопрос не относится ни к реализации JDK, ни к
	<filename>bsd.java.mk</filename>.</para>

      <para>Похожим образом определена политика по отношению к
	<varname>CATEGORIES</varname> порта Java, которая подробно
	описана в <xref linkend="makefile-categories"/>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="using-php">
    <title>Веб-приложения, Apache и PHP</title>

    <sect2 xml:id="using-apache">
      <title>Apache</title>

      <table frame="none">
	<title>Переменные для портов, использующих Apache</title>

	<tgroup cols="2">
	  <tbody>

	    <row>
	      <entry><varname>USE_APACHE</varname></entry>
	      <entry>Порт требует Apache.  Возможные значения:
		<literal>yes</literal> (берёт любую версию),
		<literal>22</literal>, <literal>24</literal>,
		<literal>22-24</literal>, <literal>22+</literal>
		и так далее.  Версия по умолчанию
		<literal>22</literal>.  Более подробная информация
		содержится в файле
		<filename>ports/Mk/bsd.apache.mk</filename> и на
		странице <link
		  xlink:href="http://wiki.freebsd.org/Apache/">wiki.freebsd.org/Apache/</link>.</entry>
	    </row>

	    <row>
	      <entry><varname>APXS</varname></entry>
	      <entry>Полный путь к исполняемому файлу
		<command>apxs</command>.  Может быть переопределен в
		вашем порту.</entry>
	    </row>

	    <row>
	      <entry><varname>HTTPD</varname></entry>
	      <entry>Полный путь к исполняемому файлу
		<command>httpd</command>.  Может быть переопределен в
		вашем порту.</entry>
	    </row>

	    <row>
	      <entry><varname>APACHE_VERSION</varname></entry>
	      <entry>Версия установленного Apache (переменная только
		для чтения).  Эта переменная доступна только после
		подключения <filename>bsd.port.pre.mk</filename>.
		Возможные значения: <literal>22</literal>,
		<literal>24</literal>.</entry>
	    </row>

	    <row>
	      <entry><varname>APACHEMODDIR</varname></entry>
	      <entry>Каталог для модулей Apache.  Значение переменной
		автоматически подставляется в
		<filename>pkg-plist</filename>.</entry>
	    </row>

	    <row>
	      <entry><varname>APACHEINCLUDEDIR</varname></entry>
	      <entry>Каталог для заголовков Apache.  Значение
		переменной автоматически подставляется в
		<filename>pkg-plist</filename>.</entry>
	    </row>

	    <row>
	      <entry><varname>APACHEETCDIR</varname></entry>
	      <entry>Каталог для конфигурационных файлов Apache.
		Значение переменной автоматически подставляется в
		<filename>pkg-plist</filename>.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <table frame="none">
	<title>Используемые переменные при портировании модулей
	  Apache</title>

	<tgroup cols="2">
	  <tbody>

	    <row>
	      <entry><varname>MODULENAME</varname></entry>
	      <entry>Название модуля.  Значением по умолчанию
		является <varname>PORTNAME</varname>.  Пример:
		<literal>mod_hello</literal></entry>
	    </row>

	    <row>
	      <entry><varname>SHORTMODNAME</varname></entry>
	      <entry>Краткое название модуля.  Наследуется
		автоматически от <varname>MODULENAME</varname>, но
		может быть переопределено.  Пример:
		<literal>hello</literal></entry>
	    </row>

	    <row>
	      <entry><varname>AP_FAST_BUILD</varname></entry>
	      <entry>Использовать <command>apxs</command> для
		компиляции и установки модуля.</entry>
	    </row>

	    <row>
	      <entry><varname>AP_GENPLIST</varname></entry>
	      <entry>Также автоматически создает
		<filename>pkg-plist</filename>.</entry>
	    </row>

	    <row>
	      <entry><varname>AP_INC</varname></entry>
	      <entry>Добавляет каталог к пути поиска заголовков
		во время компиляции.</entry>
	    </row>

	    <row>
	      <entry><varname>AP_LIB</varname></entry>
	      <entry>Добавляет каталог к пути поиска библиотек во
		время компиляции.</entry>
	    </row>

	    <row>
	      <entry><varname>AP_EXTRAS</varname></entry>
	      <entry>Дополнительные флаги, передаваемые
		<command>apxs</command>.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>
    </sect2>

    <sect2 xml:id="web-apps">
      <title>Веб-приложения</title>

      <para>Веб-приложения следует устанавливать в
	<filename>PREFIX/www/appname</filename>.  Для вашего удобства
	этот путь одинаково доступен в <filename>Makefile</filename>
	и <filename>pkg-plist</filename> как переменная
	<varname>WWWDIR</varname>, а путь относительно
	<varname>PREFIX</varname> доступен в
	<filename>Makefile</filename> как
	<varname>WWWDIR_REL</varname>.</para>

      <para>Пользователь и группа процесса веб-сервера доступны как
	<varname>WWWOWN</varname> и <varname>WWWGRP</varname>, в
	случае если вам нужно изменить владельца для некоторых
	файлов.  Значением по умолчанию и для владельца, и для группы
	является <literal>www</literal>.  Если вы хотите использовать
	в вашем порте другие значения, воспользуйтесь для этого
	нотацией <literal>WWWOWN?= myuser</literal>, чтобы позволить
	пользователю легко переопределить их.</para>

      <para>Не добавляйте зависимость от Apache, если веб-приложение
	явным образом не нуждается в Apache.  Учитывайте, что
	пользователи могут пожелать запустить ваше веб-приложение на
	другом веб-сервере помимо Apache.</para>
    </sect2>

    <sect2 xml:id="php-variables">
      <title>PHP</title>

      <table frame="none">
	<title>Переменные для портов, использующих PHP</title>

	<tgroup cols="2">
	  <tbody>
	    <row>
	      <entry><varname>USE_PHP</varname></entry>
	      <entry>Порт требует PHP.  Значение
		<literal>yes</literal> добавляет зависимость от PHP.
		Вместо этого может быть указан перечень требуемых
		расширений PHP.  Пример:
		<literal>pcre xml gettext</literal></entry>
	    </row>

	    <row>
	      <entry><varname>DEFAULT_PHP_VER</varname></entry>
	      <entry>Выбирает старший номер версии, с которым будет
		установлен PHP как зависимость в случае, когда PHP
		еще не установлен.  По умолчанию
		<literal>5</literal>.  Возможные значения:
		<literal>4</literal>, <literal>5</literal></entry>
	    </row>

	    <row>
	      <entry><varname>IGNORE_WITH_PHP</varname></entry>
	      <entry>Порт не работает с PHP данной версии.  Возможные
		значения: <literal>4</literal>,
		<literal>5</literal></entry>
	    </row>

	    <row>
	      <entry><varname>USE_PHPIZE</varname></entry>
	      <entry>Порт будет построен как расширение PHP.</entry>
	    </row>

	    <row>
	      <entry><varname>USE_PHPEXT</varname></entry>
	      <entry>Порт будет считаться расширением PHP, включая
		установку и регистрацию в реестре расширений.</entry>
	    </row>

	    <row>
	      <entry><varname>USE_PHP_BUILD</varname></entry>
	      <entry>Установить PHP как зависимость времени
		построения.</entry>
	    </row>

	    <row>
	      <entry><varname>WANT_PHP_CLI</varname></entry>
	      <entry>Хочет CLI (командная строка) версию PHP.</entry>
	    </row>

	    <row>
	      <entry><varname>WANT_PHP_CGI</varname></entry>
	      <entry>Хочет CGI версию PHP.</entry>
	    </row>

	    <row>
	      <entry><varname>WANT_PHP_MOD</varname></entry>
	      <entry>Хочет PHP как модуль Apache.</entry>
	    </row>

	    <row>
	      <entry><varname>WANT_PHP_SCR</varname></entry>
	      <entry>Хочет CLI или CGI версию PHP.</entry>
	    </row>

	    <row>
	      <entry><varname>WANT_PHP_WEB</varname></entry>
	      <entry>Хочет модуль Apache или CGI версию PHP.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>
    </sect2>

    <sect2>
      <title>Модули PEAR</title>

      <para>Портирование модулей PEAR является очень простым
	процессом.</para>

      <para>Используйте переменные <varname>FILES</varname>,
	<varname>TESTS</varname>, <varname>DATA</varname>,
	<varname>SQLS</varname>, <varname>SCRIPTFILES</varname>,
	<varname>DOCS</varname> and <varname>EXAMPLES</varname> для
	перечисления файлов, которые вы хотите установить.  Все
	перечисленные файлы будут автоматически установлены в
	подходящие места и добавлены в
	<filename>pkg-plist</filename>.</para>

      <para>Подключите
	<filename>&dollar;{PORTSDIR}/devel/pear/bsd.pear.mk</filename>
	на последней строке <filename>Makefile</filename>.</para>

      <example xml:id="pear-makefile">
	<title>Пример Makefile для классов PEAR</title>

	<programlisting>PORTNAME=	Date
PORTVERSION=	1.4.3
CATEGORIES=	devel www pear

MAINTAINER=	example@domain.com
COMMENT=	PEAR Date and Time Zone Classes

BUILD_DEPENDS=	${PEARDIR}/PEAR.php:${PORTSDIR}/devel/pear-PEAR
RUN_DEPENDS:=	${BUILD_DEPENDS}

FILES=		Date.php Date/Calc.php Date/Human.php Date/Span.php     \
		Date/TimeZone.php
TESTS=		test_calc.php test_date_methods_span.php testunit.php   \
		testunit_date.php testunit_date_span.php wknotest.txt   \
		bug674.php bug727_1.php bug727_2.php bug727_3.php       \
		bug727_4.php bug967.php weeksinmonth_4_monday.txt       \
		weeksinmonth_4_sunday.txt weeksinmonth_rdm_monday.txt   \
		weeksinmonth_rdm_sunday.txt
DOCS=		TODO
_DOCSDIR=	.

.include &lt;bsd.port.pre.mk&gt;
.include "&dollar;{PORTSDIR}/devel/pear/bsd.pear.mk"
.include &lt;bsd.port.post.mk&gt;</programlisting>
      </example>
    </sect2>
  </sect1>

  <sect1 xml:id="using-python">
    <title>Использование Python</title>

    <para>Коллекция Портов поддерживает параллельную установку
      множества версий Python.  Следует убедиться, что в портах
      используется правильный интерпретатор <command>python</command>
      в соответствии с переменной <varname>PYTHON_VERSION</varname>,
      установленной пользователем.  По большей части это означает
      замену пути к исполняемому файлу <command>python</command> в
      сценариях на значение переменной
      <varname>PYTHON_CMD</varname>.</para>

    <para>Порты, устанавливающие файлы под каталог
      <varname>PYTHON_SITELIBDIR</varname>, должны использовать
      префикс вида <literal>pyXY-</literal>, таким образом названия
      пакетов будут включать в себя версию Python, с которой они
      установлены.</para>

    <programlisting>PKGNAMEPREFIX=	${PYTHON_PKGNAMEPREFIX}</programlisting>

    <table frame="none">
      <title>Переменные для портов, которые используют Python</title>

      <tgroup cols="2">
	<tbody>
	  <row>
	    <entry><varname>USE_PYTHON</varname></entry>
	    <entry>Для этого порта нужен Python.  Минимальная
	      требуемая версия может быть указана с таким значением
	      как <literal>2.6+</literal>.  Также можно указан
	      диапазон версий с разделением двух версий через &dash;,
	      например: <literal>2.6-2.7</literal></entry>
	  </row>

	  <row>
	    <entry><varname>USE_PYDISTUTILS</varname></entry>
	    <entry>Использовать дистрибутивные утилиты (distutils)
	      Python для конфигурации, компиляции и установки.
	      Необходимо, если порт использует
	      <filename>setup.py</filename>.  Переопределяет цели
	      <buildtarget>do-build</buildtarget> и
	      <buildtarget>do-install</buildtarget> и также может
	      переопределять <buildtarget>do-configure</buildtarget>,
	      если не определена
	      <varname>GNU_CONFIGURE</varname>.</entry>
	  </row>

	  <row>
	    <entry><varname>PYTHON_PKGNAMEPREFIX</varname></entry>
	    <entry>Используется как <varname>PKGNAMEPREFIX</varname>
	      для отличия пакетов, использующих разные версии Python.
	      Пример: <literal>py24-</literal></entry>
	  </row>

	  <row>
	    <entry><varname>PYTHON_SITELIBDIR</varname></entry>
	    <entry>Местонахождение дерева site-packages, которое
	      содержит путь установки Python (обычно,
	      <varname>LOCALBASE</varname>).  Переменная
	      <varname>PYTHON_SITELIBDIR</varname> может быть очень
	      полезной при установке модулей Python.</entry>
	  </row>

	  <row>
	    <entry><varname>PYTHONPREFIX_SITELIBDIR</varname></entry>
	    <entry>Вариант PYTHON_SITELIBDIR без PREFIX.  По
	      возможности всегда используйте
	      <literal>%%PYTHON_SITELIBDIR%%</literal> в
	      <filename>pkg-plist</filename>.  Значением по умолчанию
	      для <literal>%%PYTHON_SITELIBDIR%%</literal> является
	      <literal>lib/python%%PYTHON_VERSION%%/site-packages</literal>.</entry>
	  </row>

	  <row>
	    <entry><varname>PYTHON_CMD</varname></entry>
	    <entry>Командная строка интерпретатора Python, включая
	      номер версии.</entry>
	  </row>

	  <row>
	    <entry><varname>PYNUMERIC</varname></entry>
	    <entry>Строка зависимости для расширения numeric.</entry>
	  </row>

	  <row>
	    <entry><varname>PYNUMPY</varname></entry>
	    <entry>Строка зависимости для нового расширения numeric,
	      numpy (PYNUMERIC объявлен устаревшим вышестоящим
	      производителем).</entry>
	  </row>

	  <row>
	    <entry><varname>PYXML</varname></entry>
	    <entry>Строка зависимости для расширения XML (не нужно
	      для Python 2.0 и выше, т.к. включено в основной
	      дистрибутив).</entry>
	  </row>
	</tbody>
      </tgroup>
    </table>

    <para>Полный перечень доступных переменных можно найти в
      <filename>/usr/ports/Mk/bsd.python.mk</filename>.</para>

    <para>Некоторые приложения на Python заявляют о поддержке
      <varname>DESTDIR</varname> (требуется для staging), которая не
      работает (в частности, у Mailman до версии 2.1.16).
      Ограничение можно обойти путём перекомпиляции сценариев.
      Например, это можно выполнить в цели
      <buildtarget>post-build</buildtarget>.  С учётом того, что
      после установки предполагаемое место размещения сценариев
      Python будет находиться в
      <varname>PYTHONPREFIX_SITELIBDIR</varname>, можно применить
      следующее решение:</para>

    <programlisting>(cd ${STAGEDIR}${PREFIX} \
  &amp;&amp; ${PYTHON_CMD} ${PYTHON_LIBDIR}/compileall.py \
   -d ${PREFIX} -f ${PYTHONPREFIX_SITELIBDIR:S;${PREFIX}/;;})</programlisting>

    <para>Эта команда перекомпилирует исходный текст с заменой путей
      на относительные к каталогу сборки, а также дописывает значение
      <varname>PREFIX</varname> перед именем файла, записанного в
      выходном файле с промежуточным представлением, с использованием
      <literal>-d</literal>.  <literal>-f</literal> требуется для
      безусловной перекомпиляции, <literal>:S;${PREFIX}/;;</literal>
      удаляет префиксы из значения переменной
      <varname>PYTHONPREFIX_SITELIBDIR</varname>, чтобы сделать его
      относительным к <varname>PREFIX</varname>.</para>

    <para>Для этого требуется Python&nbsp;2.7 или выше.  Это не
      работает с Python&nbsp;2.6.</para>
  </sect1>

  <sect1 xml:id="using-tcl">
    <title>Использование <application>Tcl/Tk</application></title>

    <para>В Коллекции Портов поддерживается одновременная установка
      множественных версий <application>Tcl/Tk</application>.  Порты
      должны пытаться поддерживать по крайней мере версию
      <application>Tcl/Tk</application>, используемую по умолчанию, и
      выше с помощью переменных <varname>USE_TCL</varname> и
      <varname>USE_TK</varname>.  Желаемую версию
      <command>tcl</command> можно указать в переменной
      <varname>WITH_TCL_VER</varname>.</para>

    <table frame="none">
      <title>Наиболее востребованные переменные для портов, которые
	используют <application>Tcl/Tk</application></title>

      <tgroup cols="2">
	<tbody>
	  <row>
	    <entry><varname>USE_TCL</varname></entry>
	    <entry>Порт зависит от библиотеки
	      <application>Tcl</application> (не оболочки).
	      Минимальную требуемую версию можно указать с
	      использованием таких значений, как 84+.  Отдельные
	      неподдерживаемые версии указываются в переменной
	      <varname>INVALID_TCL_VER</varname>.</entry>
	  </row>

	  <row>
	    <entry><varname>USE_TCL_BUILD</varname></entry>
	    <entry><application>Tcl</application> нужен для порта
	      только на время сборки.</entry>
	  </row>

	  <row>
	    <entry><varname>USE_TCL_WRAPPER</varname></entry>
	    <entry>Эту новую переменную следует использовать для
	      портов, для которых требуется оболочка
	      <application>Tcl</application> и не требуется
	      конкретная версия <literal>tclsh</literal>.  Обертка
	      <literal>tclsh</literal> устанавливается в систему.
	      Пользователь может указать желаемую оболочку
	      <command>tcl</command> для использования.</entry>
	  </row>

	  <row>
	    <entry><varname>WITH_TCL_VER</varname></entry>
	    <entry>Определяемые пользователем переменные, которые
	      устанавливают желаемую версию
	      <application>Tcl</application>.</entry>
	  </row>

	  <row>
	    <entry><varname><replaceable>UNIQUENAME</replaceable>_WITH_TCL_VER</varname></entry>
	    <entry>Подобно <varname>WITH_TCL_VER</varname>, но для
	      каждого порта.</entry>
	  </row>

	  <row>
	    <entry><varname>USE_TCL_THREADS</varname></entry>
	    <entry>Требует многопоточную сборку
	      <application>Tcl/Tk</application>.</entry>
	  </row>

	  <row>
	    <entry><varname>USE_TK</varname></entry>
	    <entry>Порт зависит от библиотеки
	      <application>Tk</application> (не от предпочитаемой
	      оболочки).  Подразумевает <varname>USE_TCL</varname> с
	      тем же значением.  Для большей информации смотрите
	      описание переменной <varname>USE_TCL</varname>.</entry>
	  </row>

	  <row>
	    <entry><varname>USE_TK_BUILD</varname></entry>
	    <entry>Аналогично
	      <varname>USE_TCL_BUILD</varname>.</entry>
	  </row>

	  <row>
	    <entry><varname>USE_TK_WRAPPER</varname></entry>
	    <entry>Аналогично
	      <varname>USE_TCL_WRAPPER</varname>.</entry>
	  </row>

	  <row>
	    <entry><varname>WITH_TK_VER</varname></entry>
	    <entry>Аналогично <varname>WITH_TCL_VER</varname>,
	      подразумевает <varname>WITH_TCL_VER</varname> той же
	      версии.</entry>
	  </row>
	</tbody>
      </tgroup>
    </table>

    <para>Полный перечень доступных переменных находится в
      <filename>/usr/ports/Mk/bsd.tcl.mk</filename>.</para>
  </sect1>

  <sect1 xml:id="using-emacs">
    <title>Использование Emacs</title>

    <para>Этот раздел ещё предстоит написать.</para>
  </sect1>

  <sect1 xml:id="using-ruby">
    <title>Использование Ruby</title>

    <table frame="none">
      <title>Полезные переменные для портов, использующих Ruby</title>

      <tgroup cols="2">
	<thead>
	  <row>
	    <entry>Переменная</entry>
	    <entry>Описание</entry>
	  </row>
	</thead>
	<tbody>
	  <row>
	    <entry><varname>USE_RUBY</varname></entry>
	    <entry>Порт требует Ruby.</entry>
	  </row>

	  <row>
	    <entry><varname>USE_RUBY_EXTCONF</varname></entry>
	    <entry>Порт использует для конфигурации
	      <filename>extconf.rb</filename>.</entry>
	  </row>

	  <row>
	    <entry><varname>USE_RUBY_SETUP</varname></entry>
	    <entry>Порт использует для конфигурации
	      <filename>setup.rb</filename>.</entry>
	  </row>

	  <row>
	    <entry><varname>RUBY_SETUP</varname></entry>
	    <entry>Устанавливает альтернативное имя для
	      <filename>setup.rb</filename>.  Распространенным
	      значением является
	      <filename>install.rb</filename>.</entry>
	  </row>
	</tbody>
      </tgroup>
    </table>

    <para>Следующая таблица отражает некоторые переменные, доступные
      авторам портов через инфраструктуру портов.  Эти переменные
      должны использоваться для установки файлов в правильное
      месторасположение.  Используйте их в
      <filename>pkg-plist</filename> как можно больше.  Эти
      переменные не должны переопределяться в самом порте.</para>

    <table frame="none">
      <title>Отобранные переменные только для чтения для портов,
	использующих Ruby</title>

      <tgroup cols="3">
	<thead>
	  <row>
	    <entry>Переменная</entry>
	    <entry>Описание</entry>
	    <entry>Примерное значение</entry>
	  </row>
	</thead>
	<tbody>

	  <row>
	    <entry><varname>RUBY_PKGNAMEPREFIX</varname></entry>
	    <entry>Используется как <varname>PKGNAMEPREFIX</varname>
	      для различия пакетов от разных версий Ruby.</entry>
	    <entry><literal>ruby18-</literal></entry>
	  </row>

	  <row>
	    <entry><varname>RUBY_VERSION</varname></entry>
	    <entry>Полная версия Ruby в форме
	      <literal>x.y.z</literal>.</entry>
	    <entry><literal>1.8.2</literal></entry>
	  </row>

	  <row>
	    <entry><varname>RUBY_SITELIBDIR</varname></entry>
	    <entry>Путь для установки архитектуронезависимых
	      библиотек.</entry>
	    <entry><literal>/usr/local/lib/ruby/site_ruby/1.8</literal></entry>
	  </row>

	  <row>
	    <entry><varname>RUBY_SITEARCHLIBDIR</varname></entry>
	    <entry>Путь для установки архитектурозависимых
	      библиотек.</entry>
	    <entry><literal>/usr/local/lib/ruby/site_ruby/1.8/amd64-freebsd6</literal></entry>
	  </row>

	  <row>
	    <entry><varname>RUBY_MODDOCDIR</varname></entry>
	    <entry>Путь для установки документации модуля.</entry>
	    <entry><literal>/usr/local/share/doc/ruby18/patsy</literal></entry>
	  </row>

	  <row>
	    <entry><varname>RUBY_MODEXAMPLESDIR</varname></entry>
	    <entry>Путь для установки примеров модуля.</entry>
	    <entry><literal>/usr/local/share/examples/ruby18/patsy</literal></entry>
	  </row>
	</tbody>
      </tgroup>
    </table>

    <para>Полный перечень доступных переменных находится в
      <filename>/usr/ports/Mk/bsd.ruby.mk</filename>.</para>
  </sect1>

  <sect1 xml:id="using-sdl">
    <title>Использование SDL</title>

    <para>Переменная <varname>USE_SDL</varname> используется для
      автоматической настройки зависимостей для портов, использующих
      библиотеки на основе SDL, такие как
      <package role="port">devel/sdl12</package> или
      <package role="port">graphics/sdl_image</package>.</para>

    <para>Для версии 1.2 на данный момент распознаются следующие
      SDL-библиотеки:</para>

    <itemizedlist>
      <listitem>
	<para>sdl: <package role="port">devel/sdl12</package></para>
      </listitem>

      <listitem>
	<para>console: <package
	    role="port">devel/sdl_console</package></para>
      </listitem>

      <listitem>
	<para>gfx: <package
	    role="port">graphics/sdl_gfx</package></para>
      </listitem>

      <listitem>
	<para>image: <package
	    role="port">graphics/sdl_image</package></para>
      </listitem>

      <listitem>
	<para>mixer: <package
	    role="port">audio/sdl_mixer</package></para>
      </listitem>

      <listitem>
	<para>mm: <package role="port">devel/sdlmm</package></para>
      </listitem>

      <listitem>
	<para>net: <package role="port">net/sdl_net</package></para>
      </listitem>

      <listitem>
	<para>pango: <package
	    role="port">x11-toolkits/sdl_pango</package></para>
      </listitem>

      <listitem>
	<para>sound: <package
	    role="port">audio/sdl_sound</package></para>
      </listitem>

      <listitem>
	<para>ttf: <package
	    role="port">graphics/sdl_ttf</package></para>
      </listitem>
    </itemizedlist>

    <para>Для версии 2.0 на данный момент распознаются следующие
      SDL-библиотеки:</para>

    <itemizedlist>
      <listitem>
	<para>sdl: <package role="port">devel/sdl20</package></para>
      </listitem>

      <listitem>
	<para>gfx: <package
	    role="port">graphics/sdl2_gfx</package></para>
      </listitem>

      <listitem>
	<para>image: <package
	    role="port">graphics/sdl2_image</package></para>
      </listitem>

      <listitem>
	<para>mixer: <package
	    role="port">audio/sdl2_mixer</package></para>
      </listitem>

      <listitem>
	<para>net: <package
	    role="port">net/sdl2_net</package></para>
      </listitem>

      <listitem>
	<para>ttf: <package
	    role="port">graphics/sdl2_ttf</package></para>
      </listitem>
    </itemizedlist>

    <para>Таким образом, если порт имеет зависимость от
      <package role="port">net/sdl_net</package> и
      <package role="port">audio/sdl_mixer</package>, то строка будет
      следующей:</para>

    <programlisting>USE_SDL=	net mixer</programlisting>

    <para>Зависимость от порта
      <package role="port">devel/sdl12</package>, который требуется
      для <package role="port">net/sdl_net</package> и
      <package role="port">audio/sdl_mixer</package>, будет также
      автоматически добавлен.</para>

    <para>Если вы используете <varname>USE_SDL</varname> с элементами
      SDL 1.2, то он автоматически:</para>

    <itemizedlist>
      <listitem>
	<para>Добавляет зависимость от
	  <application>sdl12-config</application> к
	  <varname>BUILD_DEPENDS</varname></para>
      </listitem>

      <listitem>
	<para>Добавляет переменную <varname>SDL_CONFIG</varname> к
	  <varname>CONFIGURE_ENV</varname></para>
      </listitem>

      <listitem>
	<para>Добавляет зависимости от указанных библиотек к
	  <varname>LIB_DEPENDS</varname></para>
      </listitem>
    </itemizedlist>

    <para>Если вы используете <varname>USE_SDL</varname> с элементами
      SDL 2.0, то он автоматически:</para>

    <itemizedlist>
      <listitem>
	<para>Добавляет зависимость от
	  <application>sdl2-config</application> к
	  <varname>BUILD_DEPENDS</varname></para>
      </listitem>

      <listitem>
	<para>Добавляет переменную <varname>SDL2_CONFIG</varname> к
	  <varname>CONFIGURE_ENV</varname></para>
      </listitem>

      <listitem>
	<para>Добавляет зависимости от указанных библиотек к
	  <varname>LIB_DEPENDS</varname></para>
      </listitem>
    </itemizedlist>

    <para>Для проверки наличия библиотеки SDL вы можете делать это
      при помощи переменной <varname>WANT_SDL</varname>:</para>

    <programlisting>WANT_SDL=	yes

.include &lt;bsd.port.pre.mk&gt;

.if ${HAVE_SDL:Mmixer}!=""
USE_SDL+=	mixer
.endif

.include &lt;bsd.port.post.mk&gt;</programlisting>
  </sect1>

  <sect1 xml:id="using-wx">
    <title>Использование <application>wxWidgets</application></title>

    <para>Эта глава описывает статус библиотек
      <application>wxWidgets</application> в дереве портов и их
      интеграцию с системой портов.</para>

    <sect2 xml:id="wx-introduction">
      <title>Введение</title>

      <para>Существует множество версий библиотек
	<application>wxWidgets</application>, конфликтующих между
	собой (устанавливают файлы под тем же именем).  В дереве
	портов эта проблема решена путем установки каждой версии под
	собственным названием с использованием номера версии в
	качестве суффикса.</para>

      <para>Очевидным недостатком этого является необходимость
	изменения каждого приложения для нахождения искомой версии.
	К счастью, большинство приложений для определения нужного
	компилятора и флагов компоновки вызывают сценарий
	<command>wx-config</command>.  Для каждой доступной версии
	этот сценарий имеет своё имя.  Большинство приложений
	учитывают переменную окружения или принимают аргумент
	configure для указания, какой сценарий
	<command>wx-config</command> следует вызывать.  На все
	остальные приходится накладывать патч.</para>
    </sect2>

    <sect2 xml:id="wx-version">
      <title>Выбор версии</title>

      <para>Для того, чтобы заставить ваш порт использовать
	конкретную версию <application>wxWidgets</application>,
	существует две доступные для определения переменные (если
	определена только одна, то вторая примет значение по
	умолчанию):</para>

      <table xml:id="wx-ver-sel-table" frame="none">
	<title>Переменные для выбора версии
	  <application>wxWidgets</application></title>

	<tgroup cols="3">
	  <thead>
	    <row>
	      <entry>Переменная</entry>
	      <entry>Описание</entry>
	      <entry>Значение по умолчанию</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><varname>USE_WX</varname></entry>
	      <entry>Перечень версий, которые порт может
		использовать</entry>
	      <entry>Все доступные версии</entry>
	    </row>

	    <row>
	      <entry><varname>USE_WX_NOT</varname></entry>
	      <entry>Перечень версий, которые порт не может
		использовать</entry>
	      <entry>Нет</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Перечень доступных версий
	<application>wxWidgets</application> и соответствующих им
	портов в дереве:</para>

      <table frame="none">
	<title>Доступные версии
	  <application>wxWidgets</application></title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Версия</entry>
	      <entry>Порт</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><literal>2.4</literal></entry>
	      <entry><package
		  role="port">x11-toolkits/wxgtk24</package></entry>
	    </row>

	    <row>
	      <entry><literal>2.6</literal></entry>
	      <entry><package
		  role="port">x11-toolkits/wxgtk26</package></entry>
	    </row>

	    <row>
	      <entry><literal>2.8</literal></entry>
	      <entry><package
		  role="port">x11-toolkits/wxgtk28</package></entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <note>
	<para>Версии начиная с <literal>2.5</literal> также
	  поставляются с Unicode и устанавливается подчиненным портом
	  с названием как как у обычного, но с суффиксом
	  <literal>-unicode</literal>, но этим можно управлять при
	  помощи переменных (смотрите
	  <xref linkend="wx-unicode"/>).</para>
      </note>

      <para>Переменные в <xref linkend="wx-ver-sel-table"/> можно
	установить в одну или более следующих комбинаций, разделенных
	пробелами:</para>

      <table frame="none">
	<title>Определение версии для
	  <application>wxWidgets</application></title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Описание</entry>
	      <entry>Пример</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry>Единичная версия</entry>
	      <entry><literal>2.4</literal></entry>
	    </row>

	    <row>
	      <entry>Восходящий диапазон</entry>
	      <entry><literal>2.4+</literal></entry>
	    </row>

	    <row>
	      <entry>Нисходящий диапазон</entry>
	      <entry><literal>2.6-</literal></entry>
	    </row>

	    <row>
	      <entry>Полный диапазон (обязан быть восходящим)</entry>
	      <entry><literal>2.4-2.6</literal></entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Кроме того, существует несколько переменных для выбора
	предпочитаемых версий из перечня доступных.  Они могут быть
	установлены в несколько версий, первая из которых будет иметь
	наибольший приоритет.</para>

      <table frame="none">
	<title>Переменные для выбора предпочитаемых версий
	  <application>wxWidgets</application></title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Название</entry>
	      <entry>Предназначение</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><varname>WANT_WX_VER</varname></entry>
	      <entry>порт</entry>
	    </row>

	    <row>
	      <entry><varname>WITH_WX_VER</varname></entry>
	      <entry>пользователь</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>
    </sect2>

    <sect2 xml:id="wx-components">
      <title>Выбор компонентов</title>

      <para>Существуют другие приложения, которые, хотя и не являются
	библиотеками <application>wxWidgets</application>, но в тоже
	время относятся к ним.  Эти приложения можно указать в
	переменной <varname>WX_COMPS</varname>.  Доступны следующие
	компоненты:</para>

      <table frame="none">
	<title>Доступные компоненты
	  <application>wxWidgets</application></title>

	<tgroup cols="3">
	  <thead>
	    <row>
	      <entry>Название</entry>
	      <entry>Описание</entry>
	      <entry>Ограничение версии</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><literal>wx</literal></entry>
	      <entry>основная библиотека</entry>
	      <entry>нет</entry>
	    </row>

	    <row>
	      <entry><literal>contrib</literal></entry>
	      <entry>сторонние библиотеки</entry>
	      <entry><literal>нет</literal></entry>
	    </row>

	    <row>
	      <entry><literal>python</literal></entry>
	      <entry><application>wxPython</application>
		(привязки к
		<application>Python</application>)</entry>
	      <entry><literal>2.4-2.6</literal></entry>
	    </row>

	    <row>
	      <entry><literal>mozilla</literal></entry>
	      <entry><application>wxMozilla</application></entry>
	      <entry><literal>2.4</literal></entry>
	    </row>

	    <row>
	      <entry><literal>svg</literal></entry>
	      <entry><application>wxSVG</application></entry>
	      <entry><literal>2.6</literal></entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Тип добавляемой зависимости при выборе каждого компонента
	может быть указан вручную путем добавления суффикса,
	отделенного точкой с запятой.  Если таковой отсутствует, но
	будет использовано значение по умолчанию (смотрите <xref
	  linkend="wx-def-dep-types"/>).  Доступные типы
	зависимости:</para>

      <table frame="none">
	<title>Доступные типы зависимости
	  <application>wxWidgets</application></title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Название</entry>
	      <entry>Описание</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><literal>build</literal></entry>
	      <entry>Компонент требуется для построения, эквивалентен
		<varname>BUILD_DEPENDS</varname></entry>
	    </row>

	    <row>
	      <entry><literal>run</literal></entry>
	      <entry>Компонент требуется для запуска, эквивалентен
		<varname>RUN_DEPENDS</varname></entry>
	    </row>

	    <row>
	      <entry><literal>lib</literal></entry>
	      <entry>Компонент требуется для построения и запуска,
		эквивалентен <varname>LIB_DEPENDS</varname></entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Значения по умолчанию для компонентов подробно
	рассматриваются в следующей таблице:</para>

      <table xml:id="wx-def-dep-types" frame="none">
	<title>Типы зависимости <application>wxWidgets</application>,
	  используемые по умолчанию</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Компонент</entry>
	      <entry>Тип зависимости</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><literal>wx</literal></entry>
	      <entry><literal>lib</literal></entry>
	    </row>

	    <row>
	      <entry><literal>contrib</literal></entry>
	      <entry><literal>lib</literal></entry>
	    </row>

	    <row>
	      <entry><literal>python</literal></entry>
	      <entry><literal>run</literal></entry>
	    </row>

	    <row>
	      <entry><literal>mozilla</literal></entry>
	      <entry><literal>lib</literal></entry>
	    </row>

	    <row>
	      <entry><literal>svg</literal></entry>
	      <entry><literal>lib</literal></entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <example xml:id="wx-components-example">
	<title>Выбор компонентов
	  <application>wxWidgets</application></title>

	<para>Следующий фрагмент относится к порту, в котором
	  используется <application>wxWidgets</application> версии
	  <literal>2.4</literal> с его сторонними
	  библиотеками.</para>

	<programlisting>USE_WX=		2.4
WX_COMPS=	wx contrib</programlisting>
      </example>
    </sect2>

    <sect2 xml:id="wx-unicode">
      <title>Unicode</title>

      <para>Библиотека <application>wxWidgets</application>
	поддерживает Unicode начиная с версии <literal>2.5</literal>.
	В дереве портов доступны обе версии и могут быть выбраны с
	использованием следующих переменных:</para>

      <table xml:id="wx-unicode-var-table" frame="none">
	<title>Переменные для выбора версии
	  <application>wxWidgets</application> с Unicode</title>

	<tgroup cols="3">
	  <thead>
	    <row>
	      <entry>Переменная</entry>
	      <entry>Описание</entry>
	      <entry>Предназначение</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><varname>WX_UNICODE</varname></entry>
	      <entry>Порт работает <emphasis>только</emphasis> с
		версией Unicode</entry>
	      <entry>порт</entry>
	    </row>

	    <row>
	      <entry><varname>WANT_UNICODE</varname></entry>
	      <entry>Порт работает с обеими версиями, но предпочитает
		версию с Unicode</entry>
	      <entry>порт</entry>
	    </row>

	    <row>
	      <entry><varname>WITH_UNICODE</varname></entry>
	      <entry>Порт будет использовать версию Unicode</entry>
	      <entry>пользователь</entry>
	    </row>

	    <row>
	      <entry><varname>WITHOUT_UNICODE</varname></entry>
	      <entry>Порт будет использовать обычную версию, если это
		поддерживается (когда <varname>WX_UNICODE</varname>
		не определена)</entry>
	      <entry>пользователь</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <warning>
	<para>Не используйте <varname>WX_UNICODE</varname> для
	  портов, которые могут использовать обе версии.  Если вы
	  хотите, чтобы порт по умолчанию использовал Unicode,
	  определите вместо этого
	  <varname>WANT_UNICODE</varname>.</para>
      </warning>
    </sect2>

    <sect2 xml:id="wx-version-detection">
      <title>Обнаружение установленных версий</title>

      <para>Для обнаружения установленной версии вам необходимо
	задать переменную <varname>WANT_WX</varname>.  Если вы не
	присвоите ей определенную версию, то компоненты получат
	суффикс версии.  Переменная <varname>HAVE_WX</varname> будет
	заполнена после обнаружения.</para>

      <example xml:id="wx-ver-det-example">
	<title>Обнаружение установленных версий и компонентов
	  <application>wxWidgets</application></title>

	<para>Следующий фрагмент может быть использован в порту,
	  который использует <application>wxWidgets</application>, в
	  случае если он установлен или выбран соответствующий
	  параметр.</para>

	<programlisting>WANT_WX=	yes

.include &lt;bsd.port.pre.mk&gt;

.if defined(WITH_WX) || !empty(PORT_OPTIONS:MWX) || !empty(HAVE_WX:Mwx-2.4)
USE_WX=			2.4
CONFIGURE_ARGS+=	--enable-wx
.endif</programlisting>

	<para>Следующий фрагмент может быть использован в порту,
	  который задействует поддержку
	  <application>wxPython</application>, в случае если он
	  установлен или выбран соответствующий параметр, в
	  дополнение к <application>wxWidgets</application>, обе
	  версии <literal>2.6</literal>.</para>

	<programlisting>USE_WX=		2.6
WX_COMPS=	wx
WANT_WX=	2.6

.include &lt;bsd.port.pre.mk&gt;

.if defined(WITH_WXPYTHON) || !empty(PORT_OPTIONS:MWXPYTHON) || !empty(HAVE_WX:Mpython)
WX_COMPS+=		python
CONFIGURE_ARGS+=	--enable-wxpython
.endif</programlisting>
      </example>
    </sect2>

    <sect2 xml:id="wx-defined-variables">
      <title>Переменные для определения</title>

      <para>Следующие переменные доступны в порту (после определения
	одной из переменных из
	<xref linkend="wx-ver-sel-table"/>).</para>

      <table frame="none">
	<title>Переменные, определенные для портов, использующих
	  <application>wxWidgets</application></title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Название</entry>
	      <entry>Описание</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><varname>WX_CONFIG</varname></entry>
	      <entry>Путь к сценарию
		<application>wxWidgets</application>
		<command>wx-config</command> (с другим
		именем)</entry>
	    </row>

	    <row>
	      <entry><varname>WXRC_CMD</varname></entry>
	      <entry>Путь к программе
		<application>wxWidgets</application>
		<command>wxrc</command> (с другим именем)</entry>
	    </row>

	    <row>
	      <entry><varname>WX_VERSION</varname></entry>
	      <entry>Версия <application>wxWidgets</application>,
		которая будет использоваться (например,
		<literal>2.6</literal>)</entry>
	    </row>

	    <row>
	      <entry><varname>WX_UNICODE</varname></entry>
	      <entry>Если не определена, но Unicode будет
		использоваться, то она будет определена</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>
    </sect2>

    <sect2 xml:id="wx-premk">
      <title>Обработка в <filename>bsd.port.pre.mk</filename></title>

      <para>Если вам нужно использовать переменные для запуска команд
	сразу после подключения <filename>bsd.port.pre.mk</filename>,
	то вам нужно определить <varname>WX_PREMK</varname>.</para>

      <important>
	<para>Если вы определите <varname>WX_PREMK</varname>, то
	  версия, зависимости, компоненты и заданные переменные не
	  изменяться, в случае вы изменили переменные порта
	  <application>wxWidgets</application>
	  <emphasis>после</emphasis> подключения
	  <filename>bsd.port.pre.mk</filename>.</para>
      </important>

      <example xml:id="wx-premk-example">
	<title>Использование переменных
	  <application>wxWidgets</application> в командах</title>

	<para>Следующий фрагмент иллюстрирует использование
	  переменной <varname>WX_PREMK</varname> посредством запуска
	  сценария <command>wx-config</command> для получения строки
	  с полной версией с присвоением ее переменной и передачей в
	  программу.</para>

	<programlisting>USE_WX=		2.4
WX_PREMK=	yes

.include &lt;bsd.port.pre.mk&gt;

.if exists(${WX_CONFIG})
VER_STR!=	${WX_CONFIG} --release

PLIST_SUB+=	VERSION="${VER_STR}"
.endif</programlisting>
      </example>

      <note>
	<para>Переменные <application>wxWidgets</application> можно
	  безопасно использовать в командах внутри целей без
	  необходимости в использовании
	  <varname>WX_PREMK</varname>.</para>
      </note>
    </sect2>

    <sect2 xml:id="wx-additional-config-args">
      <title>Дополнительные параметры
	<command>configure</command></title>

      <para>Некоторые сценарии GNU <command>configure</command> не
	могут найти <application>wxWidgets</application> только с
	установленной переменной окружения
	<literal>WX_CONFIG</literal>, требуя дополнительные
	параметры.  Для их передачи можно использовать переменную
	<varname>WX_CONF_ARGS</varname>.</para>

      <table frame="none">
	<title>Допустимые значения
	  <varname>WX_CONF_ARGS</varname></title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Возможное значение</entry>
	      <entry>Получаемый параметр</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><literal>absolute</literal></entry>
	      <entry><literal>--with-wx-config=${WX_CONFIG}</literal></entry>
	    </row>

	    <row>
	      <entry><literal>relative</literal></entry>
	      <entry><literal>--with-wx=${LOCALBASE}
		  --with-wx-config=${WX_CONFIG:T}</literal></entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>
    </sect2>
  </sect1>

  <sect1 xml:id="using-lua">
    <title>Использование <application>Lua</application></title>

    <para>Эта глава описывает статус библиотек
      <application>Lua</application> в дереве портов и их интеграцию
      в систему портов.</para>

    <sect2 xml:id="lua-introduction">
      <title>Введение</title>

      <para>Существует множество версий библиотек
	<application>Lua</application> и соответствующих
	интерпретаторов, конфликтующих между собой (устанавливают
	файлы под тем же именем).  В дереве портов эта проблема
	решена путем установки каждой версии в собственное место с
	использованием номера версии в качестве суффикса.</para>

      <para>Очевидным недостатком этого является необходимость
	изменения каждого приложения для нахождения искомой версии.
	Но это решается добавлением некоторых дополнительных флагов
	для компилятора и компоновщика.</para>
    </sect2>

    <sect2 xml:id="lua-version">
      <title>Выбор версии</title>

      <para>Для того, чтобы заставить ваш порт использовать
	конкретную версию <application>Lua</application>, существует
	две доступные для определения переменные (если определена
	только одна, то вторая примет значение по умолчанию):</para>

      <table xml:id="lua-ver-sel-table" frame="none">
	<title>Переменные для выбора версии
	  <application>Lua</application></title>

	<tgroup cols="3">
	  <thead>
	    <row>
	      <entry>Переменная</entry>
	      <entry>Описание</entry>
	      <entry>Значение по умолчанию</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><varname>USE_LUA</varname></entry>
	      <entry>Перечень версий, которые порт может
		использовать</entry>
	      <entry>Все доступные версии</entry>
	    </row>

	    <row>
	      <entry><varname>USE_LUA_NOT</varname></entry>
	      <entry>Перечень версий, которые порт не может
		использовать</entry>
	      <entry>Пусто</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Перечень доступных версий <application>Lua</application>
	и соответствующих портов в дереве:</para>

      <table frame="none">
	<title>Доступные версии
	  <application>Lua</application></title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Версия</entry>
	      <entry>Порт</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><literal>4.0</literal></entry>
	      <entry><package
		  role="port">lang/lua4</package></entry>
	    </row>

	    <row>
	      <entry><literal>5.0</literal></entry>
	      <entry><package
		  role="port">lang/lua50</package></entry>
	    </row>

	    <row>
	      <entry><literal>5.1</literal></entry>
	      <entry><package
		  role="port">lang/lua</package></entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Переменные из <xref linkend="lua-ver-sel-table"/> могут
	иметь комбинации из одного или нескольких значений,
	разделенных пробелом:</para>

      <table frame="none">
	<title>Определение версии
	  <application>Lua</application></title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Описание</entry>
	      <entry>Пример</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry>Единичная версия</entry>
	      <entry><literal>4.0</literal></entry>
	    </row>

	    <row>
	      <entry>Восходящий диапазон</entry>
	      <entry><literal>5.0+</literal></entry>
	    </row>

	    <row>
	      <entry>Нисходящий диапазон</entry>
	      <entry><literal>5.0-</literal></entry>
	    </row>

	    <row>
	      <entry>Полный диапазон (обязан быть восходящим)</entry>
	      <entry><literal>5.0-5.1</literal></entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Кроме того, существует несколько переменных для выбора
	предпочитаемых версий из перечня доступных.  Они могут быть
	установлены в несколько версий, первая из которых будет иметь
	наибольший приоритет.</para>

      <table frame="none">
	<title>Переменные для выбора предпочитаемых версий
	  <application>Lua</application></title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Название</entry>
	      <entry>Предназначение</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><varname>WANT_LUA_VER</varname></entry>
	      <entry>порт</entry>
	    </row>

	    <row>
	      <entry><varname>WITH_LUA_VER</varname></entry>
	      <entry>пользователь</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <example xml:id="lua-version-example">
	<title>Выбор версии <application>Lua</application></title>

	<para>Следующий фрагмент взят из порта, который использует
	  <application>Lua</application> версий
	  <literal>5.0</literal> или <literal>5.1</literal>, по
	  умолчанию <literal>5.0</literal>.  Значение может быть
	  переопределено пользователем с использованием переменной
	  <varname>WITH_LUA_VER</varname>.</para>

	<programlisting>USE_LUA=	5.0-5.1
WANT_LUA_VER=	5.0</programlisting>
      </example>
    </sect2>

    <sect2 xml:id="lua-components">
      <title>Выбор компонентов</title>

      <para>Существуют другие приложения, которые хотя и не являются
	библиотеками <application>Lua</application>, но относятся к
	ним.  Эти приложения можно указать в переменной
	<varname>LUA_COMPS</varname>.  Доступны следующие
	компоненты:</para>

      <table frame="none">
	<title>Доступные компоненты
	  <application>Lua</application></title>

	<tgroup cols="3">
	  <thead>
	    <row>
	      <entry>Название</entry>
	      <entry>Описание</entry>
	      <entry>Ограничение версии</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><literal>lua</literal></entry>
	      <entry>Основная библиотека</entry>
	      <entry>нет</entry>
	    </row>

	    <row>
	      <entry><literal>tolua</literal></entry>
	      <entry>Библиотека доступа к коду C/C++</entry>
	      <entry>4.0-5.0</entry>
	    </row>

	    <row>
	      <entry><literal>ruby</literal></entry>
	      <entry>Привязка к Ruby</entry>
	      <entry>4.0-5.0</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <note>
	<para>Есть и другие компоненты, но они относятся к модулям
	  для интерпретатора и не используются приложениями (только
	  другими модулями).</para>
      </note>

      <para>Тип зависимости можно выбрать для каждого компонента
	через добавление суффикса, отделенного точкой с запятой.  В
	случае отсутствия будет использован тип по умолчанию
	(смотрите <xref linkend="lua-def-dep-types"/>).  Доступные
	следующие типы:</para>

      <table frame="none">
	<title>Доступные типы зависимости
	  <application>Lua</application></title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Название</entry>
	      <entry>Описание</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><literal>build</literal></entry>
	      <entry>Компонент требуется для построения, эквивалентен
		<varname>BUILD_DEPENDS</varname></entry>
	    </row>

	    <row>
	      <entry><literal>run</literal></entry>
	      <entry>Компонент требуется для запуска, эквивалентен
		<varname>RUN_DEPENDS</varname></entry>
	    </row>

	    <row>
	      <entry><literal>lib</literal></entry>
	      <entry>Компонент требуется для построения и запуска,
		эквивалентен <varname>LIB_DEPENDS</varname></entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Значения по умолчанию для компонентов подробно
	рассматриваются в следующей таблице:</para>

      <table xml:id="lua-def-dep-types" frame="none">
	<title>Типы зависимости <application>Lua</application>,
	  используемые по умолчанию</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Компонент</entry>
	      <entry>Тип зависимости</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><literal>lua</literal></entry>
	      <entry><literal>lib</literal> для
		<literal>4.0-5.0</literal> (динамическая) и
		<literal>build</literal> для <literal>5.1</literal>
		(статическая)</entry>
	    </row>

	    <row>
	      <entry><literal>tolua</literal></entry>
	      <entry><literal>build</literal> (статическая)</entry>
	    </row>

	    <row>
	      <entry><literal>ruby</literal></entry>
	      <entry><literal>lib</literal> (динамическая)</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <example xml:id="lua-components-example">
	<title>Выбор компонентов
	  <application>Lua</application></title>

	<para>Следующий фрагмент соответствует порту, использующему
	  <application>Lua</application> версии
	  <literal>4.0</literal> и привязку к
	  <application>Ruby</application>.</para>

	<programlisting>USE_LUA=	4.0
LUA_COMPS=	lua ruby</programlisting>
      </example>
    </sect2>

    <sect2 xml:id="lua-version-detection">
      <title>Обнаружение установленных версий</title>

      <para>Для обнаружения установленной версии вам необходимо
	задать переменную <varname>WANT_LUA</varname>.  Если вы не
	присвоите ей определенную версию, то компоненты получат
	суффикс версии.  Переменная <varname>HAVE_LUA</varname> будет
	заполнена после обнаружения.</para>

      <example xml:id="lua-ver-det-example">
	<title>Обнаружение установленных версий и компонентов
	  <application>Lua</application></title>

	<para>Следующий фрагмент можно использовать для порта,
	  использующего <application>Lua</application>, если она
	  установлена, или был выбран соответствующий
	  параметр.</para>

	<programlisting>WANT_LUA=	yes

.include &lt;bsd.port.pre.mk&gt;

.if defined(WITH_LUA5) || !empty(PORT_OPTIONS:MLUA5) || !empty(HAVE_LUA:Mlua-5.[01])
USE_LUA=		5.0-5.1
CONFIGURE_ARGS+=	--enable-lua5
.endif</programlisting>

	<para>Следующий фрагмент можно использовать для порта,
	  который включает поддержку
	  <application>tolua</application>, если такой компонент
	  установлен, или был выбран соответствующий параметр в
	  дополнение к <application>Lua</application>, оба имеют
	  версию <literal>4.0</literal>.</para>

	<programlisting>USE_LUA=	4.0
LUA_COMPS=	lua
WANT_LUA=	4.0

.include &lt;bsd.port.pre.mk&gt;

.if defined(WITH_TOLUA) || !empty(PORT_OPTIONS:MTOLUA) || !empty(HAVE_LUA:Mtolua)
LUA_COMPS+=		tolua
CONFIGURE_ARGS+=	--enable-tolua
.endif</programlisting>
      </example>
    </sect2>

    <sect2 xml:id="lua-defined-variables">
      <title>Переменные для определения</title>

      <para>Следующие переменные доступны в порту (после определения
	одной из переменных из
	<xref linkend="lua-ver-sel-table"/>).</para>

      <table frame="none">
	<title>Переменные, определенные для портов, использующих
	  <application>Lua</application></title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Название</entry>
	      <entry>Описание</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><varname>LUA_VER</varname></entry>
	      <entry>Версия <application>Lua</application>, которая
		будет использоваться (например,
		<literal>5.1</literal>)</entry>
	    </row>

	    <row>
	      <entry><varname>LUA_VER_SH</varname></entry>
	      <entry>Старший номер версии динамической библиотеки
		<application>Lua</application> (например,
		<literal>1</literal>)</entry>
	    </row>

	    <row>
	      <entry><varname>LUA_VER_STR</varname></entry>
	      <entry>Версия <application>Lua</application> без точки
		(например, <literal>51</literal>)</entry>
	    </row>

	    <row>
	      <entry><varname>LUA_PREFIX</varname></entry>
	      <entry>Префикс, в который установлена
		<application>Lua</application> (и компоненты)</entry>
	    </row>

	    <row>
	      <entry><varname>LUA_SUBDIR</varname></entry>
	      <entry>Каталог под <filename>${PREFIX}/bin</filename>,
		<filename>${PREFIX}/share</filename> и
		<filename>${PREFIX}/lib</filename>, в который
		установлена <application>Lua</application></entry>
	    </row>

	    <row>
	      <entry><varname>LUA_INCDIR</varname></entry>
	      <entry>Каталог, в который установлены заголовочные
		файлы <application>Lua</application> и
		<application>tolua</application></entry>
	    </row>

	    <row>
	      <entry><varname>LUA_LIBDIR</varname></entry>
	      <entry>Каталог, в который установлены библиотеки
		<application>Lua</application> и
		<application>tolua</application></entry>
	    </row>

	    <row>
	      <entry><varname>LUA_MODLIBDIR</varname></entry>
	      <entry>Каталог, в который установлены модули библиотеки
		<application>Lua</application>
		(<filename>.so</filename>)</entry>
	    </row>

	    <row>
	      <entry><varname>LUA_MODSHAREDIR</varname></entry>
	      <entry>Каталог, в который установлены модули
		<application>Lua</application>
		(<filename>.lua</filename>)</entry>
	    </row>

	    <row>
	      <entry><varname>LUA_PKGNAMEPREFIX</varname></entry>
	      <entry>Префикс с именем пакета, используемый модулями
		<application>Lua</application></entry>
	    </row>

	    <row>
	      <entry><varname>LUA_CMD</varname></entry>
	      <entry>Путь к интерпретатору
		<application>Lua</application></entry>
	    </row>

	    <row>
	      <entry><varname>LUAC_CMD</varname></entry>
	      <entry>Путь к компилятору
		<application>Lua</application></entry>
	    </row>

	    <row>
	      <entry><varname>TOLUA_CMD</varname></entry>
	      <entry>Путь к программе
		<application>tolua</application></entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <example xml:id="lua-variables-example">
	<title>Указание для порта, где искать
	  <application>Lua</application></title>

	<para>Следующий фрагмент показывает, как сообщить порту,
	  который использует сценарий configure, где расположены
	  заголовочные файлы и библиотеки
	  <application>Lua</application>.</para>

	<programlisting>USE_LUA=	4.0
GNU_CONFIGURE=	yes
CONFIGURE_ENV=	CPPFLAGS="-I${LUA_INCDIR}" LDFLAGS="-L${LUA_LIBDIR}"</programlisting>
      </example>
    </sect2>

    <sect2 xml:id="lua-premk">
      <title>Обработка в <filename>bsd.port.pre.mk</filename></title>

      <para>Если вам нужно использовать переменные для запуска команд
	сразу после подключения <filename>bsd.port.pre.mk</filename>,
	для этого вам нужно определить переменную
	<varname>LUA_PREMK</varname>.</para>

      <important>
	<para>Если вы задаете <varname>LUA_PREMK</varname>, то
	  версия, зависимости, компоненты и уже заданные переменные
	  не будут изменены, в случае если вы изменили переменные
	  порта <application>Lua</application>
	  <emphasis>после</emphasis> подключения
	  <filename>bsd.port.pre.mk</filename>.</para>
      </important>

      <example xml:id="lua-premk-example">
	<title>Использование переменных
	  <application>Lua</application> в командах</title>

	<para>Следующий фрагмент иллюстрирует использование
	  <varname>LUA_PREMK</varname> посредством запуска
	  интерпретатора <application>Lua</application> для того,
	  чтобы получить строку с полной версией, сохранить ее в
	  переменную и передать программе.</para>

	<programlisting>USE_LUA=	5.0
LUA_PREMK=	yes

.include &lt;bsd.port.pre.mk&gt;

.if exists(${LUA_CMD})
VER_STR!=	${LUA_CMD} -v

CFLAGS+=	-DLUA_VERSION_STRING="${VER_STR}"
.endif</programlisting>
      </example>

      <note>
	<para>Переменные <application>Lua</application> можно
	  безопасно использовать в командах внутри целей без
	  необходимости в использовании
	  <varname>LUA_PREMK</varname>.</para>
      </note>
    </sect2>
  </sect1>

  <sect1 xml:id="using-iconv">
    <title>Использование <command>iconv</command></title>

    <para>После 10-08-2013 (<revnumber>254273</revnumber>) в составе
      &os;&nbsp; 10-CURRENT и более новых версий имеется собственный
      <command role="port">iconv</command>.  В более ранних версиях
      дополнительной зависимостью выступал
      <package role="port">converters/libiconv</package>.</para>

    <para>Для программного обеспечения, которому нужен
      <command>iconv</command>, определите
      <literal>USES=iconv</literal>.  Версии &os; до 10-CURRENT от
      13-08-2013 (<revnumber>254273</revnumber>) не имеют
      собственного <command>iconv</command>.  На этих более ранных
      версиях будет автоматически добавлена зависимость от
      <package role="port">converters/libiconv</package>.</para>

    <para>Когда порт задаёт <literal>USES=iconv</literal>, становятся
      доступными следующие переменные:</para>

    <informaltable frame="none" pgwide="0">
      <tgroup cols="4">
	<thead>
	  <row>
	    <entry>Имя переменной</entry>
	    <entry>Назначение</entry>
	    <entry>Значение до &os;&nbsp;10-CURRENT
	      <revnumber>254273</revnumber> (13-08-2013)</entry>
	    <entry>Значение после &os;&nbsp;10-CURRENT
	      <revnumber>254273</revnumber> (13-08-2013)</entry>
	  </row>
	</thead>

	<tbody>
	  <row>
	    <entry><varname>ICONV_CMD</varname></entry>
	    <entry>Каталог размещения двоичного файла
	      <command>iconv</command></entry>
	    <entry><literal>${LOCALBASE}/bin/iconv</literal></entry>
	    <entry><filename>/usr/bin/iconv</filename></entry>
	  </row>

	  <row>
	    <entry><varname>ICONV_LIB</varname></entry>
	    <entry>Аргумент <command>ld</command> для компоновки с
	      <filename>libiconv</filename> (если нужно)</entry>
	    <entry><literal>-liconv</literal></entry>
	    <entry>(пусто)</entry>
	  </row>

	  <row>
	    <entry><varname>ICONV_PREFIX</varname></entry>
	    <entry>Каталог размещения реализации
	      <command>iconv</command> (используется для сценариев
	      конфигурации)</entry>
	    <entry><literal>${LOCALBASE}</literal></entry>
	    <entry><filename>/usr</filename></entry>
	  </row>

	  <row>
	    <entry><varname>ICONV_CONFIGURE_ARG</varname></entry>
	    <entry>Параметр предварительно собранной конфигурации для
	      сценариев конфигурации</entry>
	    <entry><literal>--with-libiconv-prefix=${LOCALBASE}</literal></entry>
	    <entry>(пусто)</entry>
	  </row>

	  <row>
	    <entry><varname>ICONV_CONFIGURE_BASE</varname></entry>
	    <entry>Параметр предварительно собранной конфигурации для
	      сценариев конфигурации</entry>
	    <entry><literal>--with-libiconv=${LOCALBASE}</literal></entry>
	    <entry>(пусто)</entry>
	  </row>
	</tbody>
      </tgroup>
    </informaltable>

    <para>В следующих двух примерах демонстрируется автоматическое
      присвоение переменным правильных значений для систем,
      использующих <package role="port">converters/libiconv</package>
      или собственный <command>iconv</command>.</para>

    <example xml:id="iconv-simple-use">
      <title>Простое использование <command>iconv</command></title>

      <programlisting>USES=		iconv
LDFLAGS+=	-L${LOCALBASE}/lib ${ICONV_LIB}</programlisting>
    </example>

    <example xml:id="iconv-configure-use">
      <title>Использование <command>iconv</command> с
	<command>configure</command></title>

      <programlisting>USES=		iconv
CONFIGURE_ARGS+=${ICONV_CONFIGURE_ARG}</programlisting>
    </example>

    <para>Как показано выше, <varname>ICONV_LIB</varname> имеет
      пустое значение с собственным <command>iconv</command>.  Эту
      особенность можно использовать для обнаружения собственного
      <command>iconv</command> с соответствующими действиями.</para>

    <para>Иногда в программе параметр <command>ld</command> или путь
      поиска жёстко заданы в <filename>Makefile</filename> или
      сценарии конфигурации.  Для решения этой проблемы можно
      использовать следующий подход:</para>

    <example xml:id="iconv-reinplace">
      <title>Исправление жёстко заданного
	<literal>-liconv</literal></title>

      <programlisting>USES=		iconv

post-patch:
	@${REINPLACE_CMD} -e 's/-liconv/${ICONV_LIB}/' ${WRKSRC}/Makefile</programlisting>
    </example>

    <para>В некоторых случаях необходимо установить альтернативные
      значения или выполнить операции в случае использования
      собственного <command>iconv</command>.  Перед проверкой
      значения <varname>ICONV_LIB</varname> обязан быть подключён
      <filename>bsd.port.pre.mk</filename>:</para>

    <example xml:id="iconv-conditional">
      <title>Проверка доступности собственного
	<command>iconv</command></title>

      <programlisting>USES=		iconv

.include &lt;bsd.port.pre.mk&gt;

post-patch:
.if empty(ICONV_LIB)
	# обнаружен собственный iconv
	@${REINPLACE_CMD} -e 's|iconv||' ${WRKSRC}/Config.sh
.endif

.include &lt;bsd.port.post.mk&gt;</programlisting>
    </example>
  </sect1>

  <sect1 xml:id="using-xfce">
    <title>Использование Xfce</title>

    <para>Переменная <varname>USE_XFCE</varname> используется для
      автоматической конфигурации зависимостей для портов,
      использующих библиотеки или приложения на основе Xfce, такие
      как <package role="port">x11-toolkits/libxfce4gui</package> и
      <package role="port">x11-wm/xfce4-panel</package>.</para>

    <para>В настоящее время распознаются следующие библиотеки и
      приложения Xfce:</para>

    <itemizedlist>
      <listitem>
	<para>libexo: <package
	    role="port">x11/libexo</package></para>
      </listitem>

      <listitem>
	<para>libgui: <package
	    role="port">x11-toolkits/libxfce4gui</package></para>
      </listitem>

      <listitem>
	<para>libutil: <package
	    role="port">x11/libxfce4util</package></para>
      </listitem>

      <listitem>
	<para>libmcs: <package
	    role="port">x11/libxfce4mcs</package></para>
      </listitem>

      <listitem>
	<para>mcsmanager: <package
	    role="port">sysutils/xfce4-mcs-manager</package></para>
      </listitem>

      <listitem>
	<para>panel: <package
	    role="port">x11-wm/xfce4-panel</package></para>
      </listitem>

      <listitem>
	<para>thunar: <package
	    role="port">x11-fm/thunar</package></para>
      </listitem>

      <listitem>
	<para>wm: <package
	    role="port">x11-wm/xfce4-wm</package></para>
      </listitem>

      <listitem>
	<para>xfdev: <package
	    role="port">dev/xfce4-dev-tools</package></para>
      </listitem>
    </itemizedlist>

    <para>Распознаются следующие дополнительные параметры:</para>

    <itemizedlist>
      <listitem>
	<para>configenv: Используйте, если ваш порт требует
	  специально измененного значения
	  <varname>CONFIGURE_ENV</varname> для поиска требуемых для
	  порта библиотек.</para>

	<programlisting>-I&dollar;{LOCALBASE}/include -L&dollar;{LOCALBASE}/lib</programlisting>

	<para>добавляется в CPPFLAGS к
	  <varname>CONFIGURE_ENV</varname>.</para>
      </listitem>
    </itemizedlist>

    <para>Следовательно, если у порта имеется зависимость от <package
	role="port">sysutils/xfce4-mcs-manager</package>, и порт
      требует специальных CPPFLAGS в своем окружении configure, то
      синтаксис будет следующим:</para>

    <programlisting>USE_XFCE=	mcsmanager configenv</programlisting>
  </sect1>

  <sect1 xml:id="using-mozilla">
    <title>Использование Mozilla</title>

    <table frame="none">
      <title>Переменные для портов, использующих Mozilla</title>

      <tgroup cols="2">
	<tbody>

	  <row>
	    <entry><varname>USE_GECKO</varname></entry>
	    <entry>Один из бэкэндов Gecko, с которым может работать
	      порт.  Возможные значения: <literal>libxul</literal>
	      (<filename>libxul.so</filename>),
	      <literal>seamonkey</literal>
	      (<filename>libgtkembedmoz.so</filename>, устаревший,
	      больше не должен использоваться).</entry>
	  </row>

	  <row>
	    <entry><varname>USE_FIREFOX</varname></entry>
	    <entry>Для запуска порта требуется Firefox.  Возможные
	      значения: <literal>yes</literal> (версия по умолчанию),
	      <literal>40</literal>, <literal>36</literal>,
	      <literal>35</literal>.  По умолчанию устанавливает
	      зависимость от версии <literal>40</literal>.</entry>
	  </row>

	  <row>
	    <entry><varname>USE_FIREFOX_BUILD</varname></entry>
	    <entry>Для построения порта требуется Firefox.  Возможные
	      значения: смотрите USE_FIREFOX.  Автоматически
	      устанавливает USE_FIREFOX с присвоением того же
	      значения.</entry>
	  </row>

	  <row>
	    <entry><varname>USE_SEAMONKEY</varname></entry>
	    <entry>Для запуска порта требуется SeaMonkey.  Возможные
	      значения: <literal>yes</literal> (версия по умолчанию),
	      <literal>20</literal>, <literal>11</literal> (устарело,
	      больше не должно использоваться).  По умолчанию
	      устанавливает зависимость от версии
	      <literal>20</literal>.</entry>
	  </row>

	  <row>
	    <entry><varname>USE_SEAMONKEY_BUILD</varname></entry>
	    <entry>Для построения порта требуется SeaMonkey.
	      Возможные значения: смотрите USE_SEAMONKEY.
	      Автоматически устанавливает USE_SEAMONKEY с присвоением
	      того же значения.</entry>
	  </row>

	  <row>
	    <entry><varname>USE_THUNDERBIRD</varname></entry>
	    <entry>Для запуска порта требуется Thunderbird.
	      Возможные значения: <literal>yes</literal> (версия по
	      умолчанию), <literal>31</literal>,
	      <literal>30</literal> (устарело, больше не должно
	      использоваться).  По умолчанию устанавливает
	      зависимость от версии <literal>31</literal>.</entry>
	  </row>

	  <row>
	    <entry><varname>USE_THUNDERBIRD_BUILD</varname></entry>
	    <entry>Для построения порта требуется Thunderbird.
	      Возможные значения: смотрите USE_THUNDERBIRD.
	      Автоматически устанавливает USE_THUNDERBIRD с
	      присвоением того же значения.</entry>
	  </row>
	</tbody>
      </tgroup>
    </table>

    <para>Полный перечень доступных переменных можно получить в файле
      <filename>/usr/ports/Mk/bsd.gecko.mk</filename>.</para>
  </sect1>

  <sect1 xml:id="using-databases">
    <title>Использование баз данных</title>

    <table frame="none">
      <title>Переменные для портов, использующих базы данных</title>

      <tgroup cols="2">
	<thead>
	  <row>
	    <entry>Переменная</entry>
	    <entry>Значение</entry>
	  </row>
	</thead>

	<tbody>
	  <row>
	    <entry><varname>USE_BDB</varname></entry>
	    <entry>Если переменная установлена в
	      <literal>yes</literal>, добавляет зависимость от порта
	      <package role="port">databases/db41</package>.  Также
	      переменной можно присвоить значения: 2, 3, 40, 41, 42,
	      43, 44, 46, 47, 48 или 51.  Вы можете объявить диапазон
	      принимаемых значений, <varname>USE_BDB</varname>=42+
	      будет искать установленную версию с наибольшим номером,
	      и, если ничего не установлено, вернется к 42.</entry>
	  </row>

	  <row>
	    <entry><varname>USE_MYSQL</varname></entry>
	    <entry>Если переменная установлена в
	      <literal>yes</literal>, добавляет зависимость от порта
	      <package
		role="port">databases/mysql55-client</package>.  Как
	      связанная переменная, <varname>WANT_MYSQL_VER</varname>
	      может быть установлена в значение 323, 40, 41, 50, 51,
	      52, 55 или 60.</entry>
	  </row>

	  <row>
	    <entry><varname>USE_PGSQL</varname></entry>
	    <entry>Если установлена в <literal>yes</literal>,
	      добавляет зависимость от порта <package
		role="port">databases/postgresql90-client</package>.
	      Как связанная переменная,
	      <varname>WANT_PGSQL_VER</varname> может быть
	      установлена в значение 83, 84, 90, 91 или 92.  Вы
	      можете указать максимальное и минимальное значения;
	      <varname>WANT_PGSQL_VER</varname>=
	      <literal> 90+</literal> сделает порт зависимым от
	      минимальной версии 9.0.</entry>
	  </row>

	  <row>
	    <entry><varname>USE_SQLITE</varname></entry>
	    <entry>Если переменная имеет значение
	      <literal>yes</literal>, добавляет зависимость от порта
	      <package role="port">databases/sqlite3</package>.
	      Переменная может принимать значения: 3, 2.</entry>
	  </row>
	</tbody>
      </tgroup>
    </table>

    <para>Подробнее смотрите в <link
	xlink:href="http://svnweb.FreeBSD.org/ports/head/Mk/bsd.database.mk?view=markup">bsd.database.mk</link>.</para>
  </sect1>

  <sect1 xml:id="rc-scripts">
    <title>Запуск и остановка служб (сценарии
      <literal>rc</literal>)</title>

    <para>Сценарии <filename>rc.d</filename> используются для запуска
      служб при запуске системы и дают администратору стандартный
      способ остановки, запуска и перезапуска службы.  Порты
      интегрируются в системную инфраструктуру
      <filename>rc.d</filename>.  Подробности по её использованию
      можно найти в <link
	xlink:href="&url.books.handbook;/configtuning-rcd.html">главе
	rc.d Руководства</link>.  Подробное объяснение доступных
      команд находится в &man.rc.8; и &man.rc.subr.8;.  Наконец, есть
      <link xlink:href="&url.articles.rc-scripting;">статья</link>о
      практических аспектах написания сценариев
      <filename>rc.d</filename>.</para>

    <para>Установить можно один или более сценариев
      <filename>rc.d</filename>:</para>

    <programlisting>USE_RC_SUBR=	doormand</programlisting>

    <para>Сценарии обязаны размещаться в подкаталоге
      <filename>files</filename> с обязательным добавлением суффикса
      <literal>.in</literal> к имени файла.  Для этого файла будут
      использоваться стандартные расширения
      <varname>SUB_LIST</varname>.  Также особенно приветствуется
      использование расширений <literal>%%PREFIX%%</literal> и
      <literal>%%LOCALBASE%%</literal>.  Подробнее о
      <varname>SUB_LIST</varname> в <link
	linkend="using-sub-files">соответствующей
	главе</link>.</para>

    <para>Начиная с &os;&nbsp;6.1-RELEASE локальные сценарии
      <filename>rc.d</filename> (включая установленные из портов)
      включены в общий &man.rcorder.8; основной системы.</para>

    <para>Пример простого сценария <filename>rc.d</filename>:</para>

    <programlisting>#!/bin/sh

# &dollar;FreeBSD&dollar;
#
# PROVIDE: doormand
# REQUIRE: LOGIN
# KEYWORD: shutdown
#
# Add the following lines to /etc/rc.conf.local or /etc/rc.conf
# to enable this service:
#
# doormand_enable (bool):	Set to NO by default.
#				Set it to YES to enable doorman.
# doormand_config (path):	Set to %%PREFIX%%/etc/doormand/doormand.cf
#				by default.

. /etc/rc.subr

name=doormand
rcvar=doormand_enable

load_rc_config $name

: ${doormand_enable:="NO"}
: ${doormand_config="%%PREFIX%%/etc/doormand/doormand.cf"}

command=%%PREFIX%%/sbin/${name}
pidfile=/var/run/${name}.pid

command_args="-p $pidfile -f $doormand_config"

run_rc_command "$1"</programlisting>

    <para>Если нет стоящей причины запускать службы раньше всех
      портов, сценарии должны использовать</para>

    <programlisting>REQUIRE: LOGIN</programlisting>

    <para>Если служба работает под определенным пользователем
      (отличным от root), то это делается принудительно.  В сценарий
      выше включена конструкция</para>

    <programlisting>KEYWORD: shutdown</programlisting>

    <para>потому что вымышленный порт, который мы используем в
      качестве примера, запускает службу, и она должна корректно
      завершиться при выключении системы.  Если сценарий не запускает
      постоянную службу, то это не является необходимым.</para>

    <para>Для необязательных элементов конфигурации присвоение
      переменной по умолчанию в стиле &quot;=&quot; является более
      предпочтительным по сравнению со стилем &quot;:=&quot;,
      используемым здесь, поскольку первый устанавливает значение по
      умолчанию только если переменная не установлена, а последний
      устанавливает её, если переменная не установлена
      <emphasis>или</emphasis> обнулена.  Пользователь вполне может
      написать в своем файле <filename>rc.conf.local</filename>
      что-нибудь типа</para>

    <programlisting>doormand_flags=""</programlisting>

    <para>и тогда произойдет неуместная подстановка переменной с
      использованием &quot;:=&quot;, что переопределит намерения
      пользователя.  Переменная <literal>_enable</literal> является
      обязательной; значением по умолчанию должно быть
      &quot;:&quot;.</para>

    <sect2>
      <title>Контрольный список перед внесением изменений</title>

      <para>Перед тем, как отсылать порт со сценарием
	<filename>rc.d</filename>, и тем более перед его коммитом,
	сверьтесь со следующим контрольным списком, чтобы убедиться,
	что порт для этого готов.</para>

      <para>Большинство из этих проверок умеет выполнять порт
	<package role="port">devel/rclint</package>, но это не
	является заменой надлежащему просмотру.</para>

      <procedure>
	<step>
	  <para>Если это новый файл, заканчивается ли он на
	    <filename>.sh</filename>?  Если это так, то имя файла
	    должно быть изменено на <filename>file.in</filename>,
	    поскольку файлы <filename>rc.d</filename> не могут
	    оканчиваться на такое расширение.</para>
	</step>

	<step>
	  <para>Присутствует ли в файле тег
	    <literal>&dollar;FreeBSD&dollar;</literal>?</para>
	</step>

	<step>
	  <para>Соответствуют ли друг другу имя файла
	    (без <filename>.in</filename>), строка
	    <literal>PROVIDE</literal> и
	    <literal>&dollar;</literal><replaceable>name</replaceable>?
	    Имя файла, совпадающее с <literal>PROVIDE</literal>,
	    упрощает отладку, особенно для проблем, связанных с
	    &man.rcorder.8;.  Соответствие имени файла и
	    <literal>&dollar;</literal><replaceable>name</replaceable>
	    также упрощает понимание, какие переменные имеют
	    отношение к сценарию в
	    <filename>rc.conf[.local]</filename>.  Последнее также
	    является тем, что вы могли бы назвать
	    &quot;политикой&quot; для всех новых сценариев, включая
	    те, что входят в базовую систему.</para>
	</step>

	<step>
	  <para>Содержит ли строка <literal>REQUIRE</literal>
	    значение LOGIN?  Это условие обязательно для сценариев,
	    работающих не из-под суперпользователя.  Если сценарий
	    запускается из-под суперпользователя, то стоит ли его
	    запускать до <literal>LOGIN</literal>?  Если нет, то его
	    следует запускать после, так чтобы мы могли свободно
	    сгруппировать локальные сценарии в той точке
	    &man.rcorder.8;, когда почти все сценарии в базовой
	    системе уже стартовали.</para>
	</step>

	<step>
	  <para>Запускает ли сценарий постоянную службу?  Если да, то
	    он должен иметь <literal>KEYWORD:
	      shutdown</literal>.</para>
	</step>

	<step>
	  <para>Убедитесь в том, что в сценарии отсутствует
	    <literal>KEYWORD: &os;</literal>.  Это перестало быть
	    нужным и нежелательно уже много лет.  Это также служит
	    индикатором того, что новый сценарий был скопирован со
	    старого, поэтому особое внимание должно быть уделено при
	    проверке.</para>
	</step>

	<step>
	  <para>Если сценарий использует интерпретируемый язык, такой
	    как <command>perl</command>, <command>python</command>
	    или <command>ruby</command>, то убедитесь, что значение
	    <varname>command_interpreter</varname> установлено
	    должным образом.  В противном случае</para>

	  <screen>&prompt.root; <userinput>service name stop</userinput></screen>

	  <para>возможно будет работать неправильно.  Смотрите
	    &man.service.8; для дополнительной информации.</para>
	</step>

	<step>
	  <para>Все ли вхождения <filename>/usr/local</filename> были
	    заменены на <literal>%%PREFIX%%</literal>?</para>
	</step>

	<step>
	  <para>Идет ли присвоение переменным значений по умолчанию
	    после <function>load_rc_config</function>?</para>
	</step>

	<step>
	  <para>Используются ли пустые строки при присвоении значений
	    по умолчанию?  Такие присвоения должны быть удалены, но
	    перепроверьте, что эти параметры задокументированы в
	    комментариях в начале файла.</para>
	</step>

	<step>
	  <para>Действительно ли в сценариях используются значения,
	    присвоенные переменным?</para>
	</step>

	<step>
	  <para>Являются ли параметры по умолчанию, перечисленные в
	    <replaceable>name</replaceable><varname>_flags</varname>,
	    обязательными?  Если это так, то их следует поместить в
	    <varname>command_args</varname>.  Параметр
	    <option>-d</option> здесь - это как красный флаг (прошу
	    прощения за каламбур), поскольку обычно он применяется
	    для &ldquo;демонизации&ldquo; процесса и поэтому на самом
	    деле обязательный.</para>
	</step>

	<step>
	  <para>Никогда не включайте переменную
	    <replaceable>name</replaceable><varname>_flags</varname>
	    в <varname>command_args</varname> (и наоборот; в прочем,
	    такая ошибка встречается реже).</para>
	</step>

	<step>
	  <para>Запускает ли сценарий какой-либо код безусловно?  Это
	    нехорошо.  Обычно такие вещи могут/должны помещаться в
	    <function>start_precmd</function>.</para>
	</step>

	<step>
	  <para>Все логические условия должны использовать функцию
	    <function>checkyesno</function>.  Не пишите самописных
	    проверок для <literal>[Yy][Ee][Ss]</literal>, и так
	    далее.</para>
	</step>

	<step>
	  <para>Если в сценарии выполняется цикл (например, ожидание
	    чего-либо перед стартом), используется ли счетчик для
	    завершения цикла?  Мы не хотим бесконечного ожидания
	    загрузки в случае возникновения ошибки.</para>
	</step>

	<step>
	  <para>Создает ли сценарий файлы или каталоги, которым нужны
	    особые права доступа?  Например, файл
	    <filename>pid</filename>, который должен принадлежать
	    пользователю, из-под которого запускается процесс.
	    Вместо традиционных команд
	    &man.touch.1;/&man.chown.8;/&man.chmod.1; подумайте об
	    использовании &man.install.1; с подходящими аргументами
	    командной строки, для того чтобы выполнить всю процедуру
	    за один шаг.</para>
	</step>
      </procedure>
    </sect2>
  </sect1>

  <sect1 xml:id="users-and-groups">
    <title>Добавление пользователей и групп</title>

    <para>Некоторые порты требуют в установленной системе наличие
      определенного пользователя.  Выберите свободный UID в диапазоне
      от 50 до 999 и зарегистрируйте его в
      <filename>ports/UIDs</filename> (для пользователей) и/или в
      <filename>ports/GIDs</filename> (для групп).  Удостоверьтесь,
      что не используете UID, уже используемый системой или другими
      портами.</para>

    <para>Пожалуйста, включите в патч изменение для этих двух файлов,
      если вам требуется создать нового пользователя или группу для
      вашего порта.</para>

    <para>Затем вы сможете использовать в вашем
      <filename>Makefile</filename> переменные
      <varname>USERS</varname> и <varname>GROUPS</varname>, и
      пользователь автоматически создастся при установке
      порта.</para>

    <programlisting>USERS=	pulse
GROUPS=	pulse pulse-access pulse-rt</programlisting>

    <para>Текущий перечень зарезервированных UID и GID находится в
      <filename>ports/UIDs</filename> и
      <filename>ports/GIDs</filename>.</para>
  </sect1>

  <sect1 xml:id="requiring-kernel-sources">
    <title>Порты, требующие наличия исходных текстов ядра</title>

    <para>Некоторым портам (таким как загружаемые модули ядра) для
      компиляции нужны файлы с исходными текстами ядра.  Ниже указан
      корректный способ определения, установлены ли они
      пользователем:</para>

    <programlisting>USES=	kmod</programlisting>

    <para>Кроме этой проверки, <literal>kmod</literal> заботится о
      большинстве пунктов, которые должны учитываться в этих
      портах.</para>
  </sect1>
</chapter>

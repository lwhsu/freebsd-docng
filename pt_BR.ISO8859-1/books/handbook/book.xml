<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE book PUBLIC "-//FreeBSD//DTD DocBook XML V5.0-Based Extension//EN" "http://www.FreeBSD.org/XML/share/xml/freebsd50.dtd" [
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
--><!ENTITY % chapters SYSTEM "chapters.ent">
<!--
     Creates entities for each chapter in the FreeBSD Handbook. Each entity
     is named chap.foo, where foo is the value of the id attribute on that
     chapter, and corresponds to the name of the directory in which that
     chapter's .xml file is stored.

     Chapters should be listed in the order in which they are referenced.

     $FreeBSD$
--><!ENTITY chap.preface SYSTEM "preface/preface.xml">
<!ENTITY % pgpkeys SYSTEM "../../../share/pgpkeys/pgpkeys.ent">
<!-- $FreeBSD$ --><!-- PGP keyblocks --><!ENTITY pgpkey.0mp SYSTEM "0mp.key">
<!ENTITY pgpkey.aaron SYSTEM "aaron.key">
<!ENTITY pgpkey.ache SYSTEM "ache.key">
<!ENTITY pgpkey.achim SYSTEM "achim.key">
<!ENTITY pgpkey.acm SYSTEM "acm.key">
<!ENTITY pgpkey.adamw SYSTEM "adamw.key">
<!ENTITY pgpkey.adrian SYSTEM "adrian.key">
<!ENTITY pgpkey.adridg SYSTEM "adridg.key">
<!ENTITY pgpkey.ae SYSTEM "ae.key">
<!ENTITY pgpkey.afedorov SYSTEM "afedorov.key">
<!ENTITY pgpkey.ahze SYSTEM "ahze.key">
<!ENTITY pgpkey.ak SYSTEM "ak.key">
<!ENTITY pgpkey.alc SYSTEM "alc.key">
<!ENTITY pgpkey.ale SYSTEM "ale.key">
<!ENTITY pgpkey.alepulver SYSTEM "alepulver.key">
<!ENTITY pgpkey.alex SYSTEM "alex.key">
<!ENTITY pgpkey.alexbl SYSTEM "alexbl.key">
<!ENTITY pgpkey.alexey SYSTEM "alexey.key">
<!ENTITY pgpkey.alfredo SYSTEM "alfredo.key">
<!ENTITY pgpkey.allanjude SYSTEM "allanjude.key">
<!ENTITY pgpkey.alonso SYSTEM "alonso.key">
<!ENTITY pgpkey.amdmi3 SYSTEM "amdmi3.key">
<!ENTITY pgpkey.anchie SYSTEM "anchie.key">
<!ENTITY pgpkey.anders SYSTEM "anders.key">
<!ENTITY pgpkey.andreas SYSTEM "andreas.key">
<!ENTITY pgpkey.andrew SYSTEM "andrew.key">
<!ENTITY pgpkey.anholt SYSTEM "anholt.key">
<!ENTITY pgpkey.anish SYSTEM "anish.key">
<!ENTITY pgpkey.anray SYSTEM "anray.key">
<!ENTITY pgpkey.antoine SYSTEM "antoine.key">
<!ENTITY pgpkey.araujo SYSTEM "araujo.key">
<!ENTITY pgpkey.arichardson SYSTEM "arichardson.key">
<!ENTITY pgpkey.ariff SYSTEM "ariff.key">
<!ENTITY pgpkey.arrowd SYSTEM "arrowd.key">
<!ENTITY pgpkey.art SYSTEM "art.key">
<!ENTITY pgpkey.arun SYSTEM "arun.key">
<!ENTITY pgpkey.arundel SYSTEM "arundel.key">
<!ENTITY pgpkey.arved SYSTEM "arved.key">
<!ENTITY pgpkey.arybchik SYSTEM "arybchik.key">
<!ENTITY pgpkey.asami SYSTEM "asami.key">
<!ENTITY pgpkey.ashish SYSTEM "ashish.key">
<!ENTITY pgpkey.asomers SYSTEM "asomers.key">
<!ENTITY pgpkey.avatar SYSTEM "avatar.key">
<!ENTITY pgpkey.avg SYSTEM "avg.key">
<!ENTITY pgpkey.avilla SYSTEM "avilla.key">
<!ENTITY pgpkey.avl SYSTEM "avl.key">
<!ENTITY pgpkey.avos SYSTEM "avos.key">
<!ENTITY pgpkey.badger SYSTEM "badger.key">
<!ENTITY pgpkey.bakul SYSTEM "bakul.key">
<!ENTITY pgpkey.bapt SYSTEM "bapt.key">
<!ENTITY pgpkey.bar SYSTEM "bar.key">
<!ENTITY pgpkey.barner SYSTEM "barner.key">
<!ENTITY pgpkey.bcr SYSTEM "bcr.key">
<!ENTITY pgpkey.bcran SYSTEM "bcran.key">
<!ENTITY pgpkey.bdragon SYSTEM "bdragon.key">
<!ENTITY pgpkey.bdrewery SYSTEM "bdrewery.key">
<!ENTITY pgpkey.beat SYSTEM "beat.key">
<!ENTITY pgpkey.beech SYSTEM "beech.key">
<!ENTITY pgpkey.ben SYSTEM "ben.key">
<!ENTITY pgpkey.benjsc SYSTEM "benjsc.key">
<!ENTITY pgpkey.benno SYSTEM "benno.key">
<!ENTITY pgpkey.bf SYSTEM "bf.key">
<!ENTITY pgpkey.bhaga SYSTEM "bhaga.key">
<!ENTITY pgpkey.bhd SYSTEM "bhd.key">
<!ENTITY pgpkey.bhughes SYSTEM "bhughes.key">
<!ENTITY pgpkey.billf SYSTEM "billf.key">
<!ENTITY pgpkey.bjk SYSTEM "bjk.key">
<!ENTITY pgpkey.bk SYSTEM "bk.key">
<!ENTITY pgpkey.blackend SYSTEM "blackend.key">
<!ENTITY pgpkey.bland SYSTEM "bland.key">
<!ENTITY pgpkey.bmah SYSTEM "bmah.key">
<!ENTITY pgpkey.bms SYSTEM "bms.key">
<!ENTITY pgpkey.bofh SYSTEM "bofh.key">
<!ENTITY pgpkey.br SYSTEM "br.key">
<!ENTITY pgpkey.brd SYSTEM "brd.key">
<!ENTITY pgpkey.brian SYSTEM "brian.key">
<!ENTITY pgpkey.brix SYSTEM "brix.key">
<!ENTITY pgpkey.brnrd SYSTEM "brnrd.key">
<!ENTITY pgpkey.brooks SYSTEM "brooks.key">
<!ENTITY pgpkey.brueffer SYSTEM "brueffer.key">
<!ENTITY pgpkey.bruno SYSTEM "bruno.key">
<!ENTITY pgpkey.bryanv SYSTEM "bryanv.key">
<!ENTITY pgpkey.bsam SYSTEM "bsam.key">
<!ENTITY pgpkey.bschmidt SYSTEM "bschmidt.key">
<!ENTITY pgpkey.bsd SYSTEM "bsd.key">
<!ENTITY pgpkey.bushman SYSTEM "bushman.key">
<!ENTITY pgpkey.bvs SYSTEM "bvs.key">
<!ENTITY pgpkey.bwidawsk SYSTEM "bwidawsk.key">
<!ENTITY pgpkey.bz SYSTEM "bz.key">
<!ENTITY pgpkey.carl SYSTEM "carl.key">
<!ENTITY pgpkey.carlavilla SYSTEM "carlavilla.key">
<!ENTITY pgpkey.cel SYSTEM "cel.key">
<!ENTITY pgpkey.ceri SYSTEM "ceri.key">
<!ENTITY pgpkey.cherry SYSTEM "cherry.key">
<!ENTITY pgpkey.chinsan SYSTEM "chinsan.key">
<!ENTITY pgpkey.chs SYSTEM "chs.key">
<!ENTITY pgpkey.chuck SYSTEM "chuck.key">
<!ENTITY pgpkey.cjc SYSTEM "cjc.key">
<!ENTITY pgpkey.cjh SYSTEM "cjh.key">
<!ENTITY pgpkey.clement SYSTEM "clement.key">
<!ENTITY pgpkey.clive SYSTEM "clive.key">
<!ENTITY pgpkey.clsung SYSTEM "clsung.key">
<!ENTITY pgpkey.cmt SYSTEM "cmt.key">
<!ENTITY pgpkey.cokane SYSTEM "cokane.key">
<!ENTITY pgpkey.core-secretary SYSTEM "core-secretary.key">
<!ENTITY pgpkey.cperciva SYSTEM "cperciva.key">
<!ENTITY pgpkey.cpm SYSTEM "cpm.key">
<!ENTITY pgpkey.crees SYSTEM "crees.key">
<!ENTITY pgpkey.cs SYSTEM "cs.key">
<!ENTITY pgpkey.cshumway SYSTEM "cshumway.key">
<!ENTITY pgpkey.csjp SYSTEM "csjp.key">
<!ENTITY pgpkey.culot SYSTEM "culot.key">
<!ENTITY pgpkey.cy SYSTEM "cy.key">
<!ENTITY pgpkey.dab SYSTEM "dab.key">
<!ENTITY pgpkey.daichi SYSTEM "daichi.key">
<!ENTITY pgpkey.damien SYSTEM "damien.key">
<!ENTITY pgpkey.danfe SYSTEM "danfe.key">
<!ENTITY pgpkey.danger SYSTEM "danger.key">
<!ENTITY pgpkey.danilo SYSTEM "danilo.key">
<!ENTITY pgpkey.dannyboy SYSTEM "dannyboy.key">
<!ENTITY pgpkey.das SYSTEM "das.key">
<!ENTITY pgpkey.davidch SYSTEM "davidch.key">
<!ENTITY pgpkey.davide SYSTEM "davide.key">
<!ENTITY pgpkey.davidxu SYSTEM "davidxu.key">
<!ENTITY pgpkey.db SYSTEM "db.key">
<!ENTITY pgpkey.dbaio SYSTEM "dbaio.key">
<!ENTITY pgpkey.dbn SYSTEM "dbn.key">
<!ENTITY pgpkey.dch SYSTEM "dch.key">
<!ENTITY pgpkey.dchagin SYSTEM "dchagin.key">
<!ENTITY pgpkey.dcs SYSTEM "dcs.key">
<!ENTITY pgpkey.dd SYSTEM "dd.key">
<!ENTITY pgpkey.deb SYSTEM "deb.key">
<!ENTITY pgpkey.debdrup SYSTEM "debdrup.key">
<!ENTITY pgpkey.decke SYSTEM "decke.key">
<!ENTITY pgpkey.def SYSTEM "def.key">
<!ENTITY pgpkey.deischen SYSTEM "deischen.key">
<!ENTITY pgpkey.delphij SYSTEM "delphij.key">
<!ENTITY pgpkey.demon SYSTEM "demon.key">
<!ENTITY pgpkey.den SYSTEM "den.key">
<!ENTITY pgpkey.des SYSTEM "des.key">
<!ENTITY pgpkey.dfr SYSTEM "dfr.key">
<!ENTITY pgpkey.dhartmei SYSTEM "dhartmei.key">
<!ENTITY pgpkey.dhn SYSTEM "dhn.key">
<!ENTITY pgpkey.dhw SYSTEM "dhw.key">
<!ENTITY pgpkey.dim SYSTEM "dim.key">
<!ENTITY pgpkey.dinoex SYSTEM "dinoex.key">
<!ENTITY pgpkey.dmgk SYSTEM "dmgk.key">
<!ENTITY pgpkey.doceng-secretary SYSTEM "doceng-secretary.key">
<!ENTITY pgpkey.dougm SYSTEM "dougm.key">
<!ENTITY pgpkey.dru SYSTEM "dru.key">
<!ENTITY pgpkey.dryice SYSTEM "dryice.key">
<!ENTITY pgpkey.dteske SYSTEM "dteske.key">
<!ENTITY pgpkey.dumbbell SYSTEM "dumbbell.key">
<!ENTITY pgpkey.dutchdaemon SYSTEM "dutchdaemon.key">
<!ENTITY pgpkey.dvl SYSTEM "dvl.key">
<!ENTITY pgpkey.dwmalone SYSTEM "dwmalone.key">
<!ENTITY pgpkey.eadler SYSTEM "eadler.key">
<!ENTITY pgpkey.ebrandi SYSTEM "ebrandi.key">
<!ENTITY pgpkey.ed SYSTEM "ed.key">
<!ENTITY pgpkey.edavis SYSTEM "edavis.key">
<!ENTITY pgpkey.edwin SYSTEM "edwin.key">
<!ENTITY pgpkey.egypcio SYSTEM "egypcio.key">
<!ENTITY pgpkey.ehaupt SYSTEM "ehaupt.key">
<!ENTITY pgpkey.emaste SYSTEM "emaste.key">
<!ENTITY pgpkey.emax SYSTEM "emax.key">
<!ENTITY pgpkey.ericbsd SYSTEM "ericbsd.key">
<!ENTITY pgpkey.erj SYSTEM "erj.key">
<!ENTITY pgpkey.erwin SYSTEM "erwin.key">
<!ENTITY pgpkey.eugen SYSTEM "eugen.key">
<!ENTITY pgpkey.fabient SYSTEM "fabient.key">
<!ENTITY pgpkey.fanf SYSTEM "fanf.key">
<!ENTITY pgpkey.farrokhi SYSTEM "farrokhi.key">
<!ENTITY pgpkey.feld SYSTEM "feld.key">
<!ENTITY pgpkey.fernape SYSTEM "fernape.key">
<!ENTITY pgpkey.fjoe SYSTEM "fjoe.key">
<!ENTITY pgpkey.flo SYSTEM "flo.key">
<!ENTITY pgpkey.fluffy SYSTEM "fluffy.key">
<!ENTITY pgpkey.flz SYSTEM "flz.key">
<!ENTITY pgpkey.fox SYSTEM "fox.key">
<!ENTITY pgpkey.foxfair SYSTEM "foxfair.key">
<!ENTITY pgpkey.freqlabs SYSTEM "freqlabs.key">
<!ENTITY pgpkey.fsu SYSTEM "fsu.key">
<!ENTITY pgpkey.gabor SYSTEM "gabor.key">
<!ENTITY pgpkey.gad SYSTEM "gad.key">
<!ENTITY pgpkey.gahr SYSTEM "gahr.key">
<!ENTITY pgpkey.ganbold SYSTEM "ganbold.key">
<!ENTITY pgpkey.garga SYSTEM "garga.key">
<!ENTITY pgpkey.garys SYSTEM "garys.key">
<!ENTITY pgpkey.gavin SYSTEM "gavin.key">
<!ENTITY pgpkey.gbe SYSTEM "gbe.key">
<!ENTITY pgpkey.gblach SYSTEM "gblach.key">
<!ENTITY pgpkey.gerald SYSTEM "gerald.key">
<!ENTITY pgpkey.ghelmer SYSTEM "ghelmer.key">
<!ENTITY pgpkey.gibbs SYSTEM "gibbs.key">
<!ENTITY pgpkey.girgen SYSTEM "girgen.key">
<!ENTITY pgpkey.gjb SYSTEM "gjb.key">
<!ENTITY pgpkey.glarkin SYSTEM "glarkin.key">
<!ENTITY pgpkey.gleb SYSTEM "gleb.key">
<!ENTITY pgpkey.glebius SYSTEM "glebius.key">
<!ENTITY pgpkey.glewis SYSTEM "glewis.key">
<!ENTITY pgpkey.gnn SYSTEM "gnn.key">
<!ENTITY pgpkey.gonzo SYSTEM "gonzo.key">
<!ENTITY pgpkey.gordon SYSTEM "gordon.key">
<!ENTITY pgpkey.green SYSTEM "green.key">
<!ENTITY pgpkey.grehan SYSTEM "grehan.key">
<!ENTITY pgpkey.grembo SYSTEM "grembo.key">
<!ENTITY pgpkey.grog SYSTEM "grog.key">
<!ENTITY pgpkey.gshapiro SYSTEM "gshapiro.key">
<!ENTITY pgpkey.gsutter SYSTEM "gsutter.key">
<!ENTITY pgpkey.guido SYSTEM "guido.key">
<!ENTITY pgpkey.harti SYSTEM "harti.key">
<!ENTITY pgpkey.hiren SYSTEM "hiren.key">
<!ENTITY pgpkey.hmp SYSTEM "hmp.key">
<!ENTITY pgpkey.hq SYSTEM "hq.key">
<!ENTITY pgpkey.hrs SYSTEM "hrs.key">
<!ENTITY pgpkey.ijliao SYSTEM "ijliao.key">
<!ENTITY pgpkey.imp SYSTEM "imp.key">
<!ENTITY pgpkey.issyl0 SYSTEM "issyl0.key">
<!ENTITY pgpkey.itetcu SYSTEM "itetcu.key">
<!ENTITY pgpkey.ivadasz SYSTEM "ivadasz.key">
<!ENTITY pgpkey.ivoras SYSTEM "ivoras.key">
<!ENTITY pgpkey.jacula SYSTEM "jacula.key">
<!ENTITY pgpkey.jadawin SYSTEM "jadawin.key">
<!ENTITY pgpkey.jah SYSTEM "jah.key">
<!ENTITY pgpkey.jamie SYSTEM "jamie.key">
<!ENTITY pgpkey.jase SYSTEM "jase.key">
<!ENTITY pgpkey.jbeich SYSTEM "jbeich.key">
<!ENTITY pgpkey.jcamou SYSTEM "jcamou.key">
<!ENTITY pgpkey.jceel SYSTEM "jceel.key">
<!ENTITY pgpkey.jch SYSTEM "jch.key">
<!ENTITY pgpkey.jchandra SYSTEM "jchandra.key">
<!ENTITY pgpkey.jdp SYSTEM "jdp.key">
<!ENTITY pgpkey.jeb SYSTEM "jeb.key">
<!ENTITY pgpkey.jedgar SYSTEM "jedgar.key">
<!ENTITY pgpkey.jesper SYSTEM "jesper.key">
<!ENTITY pgpkey.jgh SYSTEM "jgh.key">
<!ENTITY pgpkey.jh SYSTEM "jh.key">
<!ENTITY pgpkey.jhale SYSTEM "jhale.key">
<!ENTITY pgpkey.jhay SYSTEM "jhay.key">
<!ENTITY pgpkey.jhb SYSTEM "jhb.key">
<!ENTITY pgpkey.jhibbits SYSTEM "jhibbits.key">
<!ENTITY pgpkey.jhixson SYSTEM "jhixson.key">
<!ENTITY pgpkey.jilles SYSTEM "jilles.key">
<!ENTITY pgpkey.jim SYSTEM "jim.key">
<!ENTITY pgpkey.jinmei SYSTEM "jinmei.key">
<!ENTITY pgpkey.jkh SYSTEM "jkh.key">
<!ENTITY pgpkey.jkim SYSTEM "jkim.key">
<!ENTITY pgpkey.jkois SYSTEM "jkois.key">
<!ENTITY pgpkey.jkoshy SYSTEM "jkoshy.key">
<!ENTITY pgpkey.jlaffaye SYSTEM "jlaffaye.key">
<!ENTITY pgpkey.jlh SYSTEM "jlh.key">
<!ENTITY pgpkey.jmb SYSTEM "jmb.key">
<!ENTITY pgpkey.jmcneill SYSTEM "jmcneill.key">
<!ENTITY pgpkey.jmd SYSTEM "jmd.key">
<!ENTITY pgpkey.jmelo SYSTEM "jmelo.key">
<!ENTITY pgpkey.jmg SYSTEM "jmg.key">
<!ENTITY pgpkey.jmmv SYSTEM "jmmv.key">
<!ENTITY pgpkey.joe SYSTEM "joe.key">
<!ENTITY pgpkey.joerg SYSTEM "joerg.key">
<!ENTITY pgpkey.johalun SYSTEM "johalun.key">
<!ENTITY pgpkey.johans SYSTEM "johans.key">
<!ENTITY pgpkey.jon SYSTEM "jon.key">
<!ENTITY pgpkey.jonathan SYSTEM "jonathan.key">
<!ENTITY pgpkey.joneum SYSTEM "joneum.key">
<!ENTITY pgpkey.josef SYSTEM "josef.key">
<!ENTITY pgpkey.jpaetzel SYSTEM "jpaetzel.key">
<!ENTITY pgpkey.jrm SYSTEM "jrm.key">
<!ENTITY pgpkey.jsa SYSTEM "jsa.key">
<!ENTITY pgpkey.jsm SYSTEM "jsm.key">
<!ENTITY pgpkey.jtl SYSTEM "jtl.key">
<!ENTITY pgpkey.junovitch SYSTEM "junovitch.key">
<!ENTITY pgpkey.jwb SYSTEM "jwb.key">
<!ENTITY pgpkey.jylefort SYSTEM "jylefort.key">
<!ENTITY pgpkey.kadesai SYSTEM "kadesai.key">
<!ENTITY pgpkey.kai SYSTEM "kai.key">
<!ENTITY pgpkey.kaiw SYSTEM "kaiw.key">
<!ENTITY pgpkey.kaktus SYSTEM "kaktus.key">
<!ENTITY pgpkey.kami SYSTEM "kami.key">
<!ENTITY pgpkey.kan SYSTEM "kan.key">
<!ENTITY pgpkey.karels SYSTEM "karels.key">
<!ENTITY pgpkey.kato SYSTEM "kato.key">
<!ENTITY pgpkey.kbowling SYSTEM "kbowling.key">
<!ENTITY pgpkey.ken SYSTEM "ken.key">
<!ENTITY pgpkey.kensmith SYSTEM "kensmith.key">
<!ENTITY pgpkey.keramida SYSTEM "keramida.key">
<!ENTITY pgpkey.kevans SYSTEM "kevans.key">
<!ENTITY pgpkey.kevlo SYSTEM "kevlo.key">
<!ENTITY pgpkey.keymaster SYSTEM "keymaster.key">
<!ENTITY pgpkey.kib SYSTEM "kib.key">
<!ENTITY pgpkey.kibab SYSTEM "kibab.key">
<!ENTITY pgpkey.kmoore SYSTEM "kmoore.key">
<!ENTITY pgpkey.knu SYSTEM "knu.key">
<!ENTITY pgpkey.koitsu SYSTEM "koitsu.key">
<!ENTITY pgpkey.kp SYSTEM "kp.key">
<!ENTITY pgpkey.krion SYSTEM "krion.key">
<!ENTITY pgpkey.kris SYSTEM "kris.key">
<!ENTITY pgpkey.kuriyama SYSTEM "kuriyama.key">
<!ENTITY pgpkey.kwm SYSTEM "kwm.key">
<!ENTITY pgpkey.landonf SYSTEM "landonf.key">
<!ENTITY pgpkey.laszlof SYSTEM "laszlof.key">
<!ENTITY pgpkey.lawrance SYSTEM "lawrance.key">
<!ENTITY pgpkey.lbartoletti SYSTEM "lbartoletti.key">
<!ENTITY pgpkey.lbr SYSTEM "lbr.key">
<!ENTITY pgpkey.le SYSTEM "le.key">
<!ENTITY pgpkey.leeym SYSTEM "leeym.key">
<!ENTITY pgpkey.leitao SYSTEM "leitao.key">
<!ENTITY pgpkey.ler SYSTEM "ler.key">
<!ENTITY pgpkey.leres SYSTEM "leres.key">
<!ENTITY pgpkey.lesi SYSTEM "lesi.key">
<!ENTITY pgpkey.lev SYSTEM "lev.key">
<!ENTITY pgpkey.lidl SYSTEM "lidl.key">
<!ENTITY pgpkey.lifanov SYSTEM "lifanov.key">
<!ENTITY pgpkey.linimon SYSTEM "linimon.key">
<!ENTITY pgpkey.lioux SYSTEM "lioux.key">
<!ENTITY pgpkey.lippe SYSTEM "lippe.key">
<!ENTITY pgpkey.lme SYSTEM "lme.key">
<!ENTITY pgpkey.loader SYSTEM "loader.key">
<!ENTITY pgpkey.lofi SYSTEM "lofi.key">
<!ENTITY pgpkey.loos SYSTEM "loos.key">
<!ENTITY pgpkey.lstewart SYSTEM "lstewart.key">
<!ENTITY pgpkey.lth SYSTEM "lth.key">
<!ENTITY pgpkey.lulf SYSTEM "lulf.key">
<!ENTITY pgpkey.luoqi SYSTEM "luoqi.key">
<!ENTITY pgpkey.luporl SYSTEM "luporl.key">
<!ENTITY pgpkey.lwhsu SYSTEM "lwhsu.key">
<!ENTITY pgpkey.lx SYSTEM "lx.key">
<!ENTITY pgpkey.madpilot SYSTEM "madpilot.key">
<!ENTITY pgpkey.maho SYSTEM "maho.key">
<!ENTITY pgpkey.mahrens SYSTEM "mahrens.key">
<!ENTITY pgpkey.makc SYSTEM "makc.key">
<!ENTITY pgpkey.mandree SYSTEM "mandree.key">
<!ENTITY pgpkey.manolis SYSTEM "manolis.key">
<!ENTITY pgpkey.manu SYSTEM "manu.key">
<!ENTITY pgpkey.marcel SYSTEM "marcel.key">
<!ENTITY pgpkey.marck SYSTEM "marck.key">
<!ENTITY pgpkey.marcus SYSTEM "marcus.key">
<!ENTITY pgpkey.marino SYSTEM "marino.key">
<!ENTITY pgpkey.marius SYSTEM "marius.key">
<!ENTITY pgpkey.markj SYSTEM "markj.key">
<!ENTITY pgpkey.markm SYSTEM "markm.key">
<!ENTITY pgpkey.markp SYSTEM "markp.key">
<!ENTITY pgpkey.marks SYSTEM "marks.key">
<!ENTITY pgpkey.markus SYSTEM "markus.key">
<!ENTITY pgpkey.martymac SYSTEM "martymac.key">
<!ENTITY pgpkey.mat SYSTEM "mat.key">
<!ENTITY pgpkey.matteo SYSTEM "matteo.key">
<!ENTITY pgpkey.matthew SYSTEM "matthew.key">
<!ENTITY pgpkey.matusita SYSTEM "matusita.key">
<!ENTITY pgpkey.mav SYSTEM "mav.key">
<!ENTITY pgpkey.max SYSTEM "max.key">
<!ENTITY pgpkey.maxim SYSTEM "maxim.key">
<!ENTITY pgpkey.mbr SYSTEM "mbr.key">
<!ENTITY pgpkey.mckay SYSTEM "mckay.key">
<!ENTITY pgpkey.mckusick SYSTEM "mckusick.key">
<!ENTITY pgpkey.mdf SYSTEM "mdf.key">
<!ENTITY pgpkey.melifaro SYSTEM "melifaro.key">
<!ENTITY pgpkey.meta SYSTEM "meta.key">
<!ENTITY pgpkey.metal SYSTEM "metal.key">
<!ENTITY pgpkey.mfechner SYSTEM "mfechner.key">
<!ENTITY pgpkey.mheinen SYSTEM "mheinen.key">
<!ENTITY pgpkey.mhorne SYSTEM "mhorne.key">
<!ENTITY pgpkey.mi SYSTEM "mi.key">
<!ENTITY pgpkey.mich SYSTEM "mich.key">
<!ENTITY pgpkey.mikael SYSTEM "mikael.key">
<!ENTITY pgpkey.mikeh SYSTEM "mikeh.key">
<!ENTITY pgpkey.milki SYSTEM "milki.key">
<!ENTITY pgpkey.misha SYSTEM "misha.key">
<!ENTITY pgpkey.miwi SYSTEM "miwi.key">
<!ENTITY pgpkey.mizhka SYSTEM "mizhka.key">
<!ENTITY pgpkey.mjg SYSTEM "mjg.key">
<!ENTITY pgpkey.mjoras SYSTEM "mjoras.key">
<!ENTITY pgpkey.mlaier SYSTEM "mlaier.key">
<!ENTITY pgpkey.mm SYSTEM "mm.key">
<!ENTITY pgpkey.mmel SYSTEM "mmel.key">
<!ENTITY pgpkey.mmokhi SYSTEM "mmokhi.key">
<!ENTITY pgpkey.mmoll SYSTEM "mmoll.key">
<!ENTITY pgpkey.mnag SYSTEM "mnag.key">
<!ENTITY pgpkey.mp SYSTEM "mp.key">
<!ENTITY pgpkey.mr SYSTEM "mr.key">
<!ENTITY pgpkey.mtm SYSTEM "mtm.key">
<!ENTITY pgpkey.murray SYSTEM "murray.key">
<!ENTITY pgpkey.mux SYSTEM "mux.key">
<!ENTITY pgpkey.mva SYSTEM "mva.key">
<!ENTITY pgpkey.mw SYSTEM "mw.key">
<!ENTITY pgpkey.mwlucas SYSTEM "mwlucas.key">
<!ENTITY pgpkey.naddy SYSTEM "naddy.key">
<!ENTITY pgpkey.nate SYSTEM "nate.key">
<!ENTITY pgpkey.nectar SYSTEM "nectar.key">
<!ENTITY pgpkey.neel SYSTEM "neel.key">
<!ENTITY pgpkey.nemoliu SYSTEM "nemoliu.key">
<!ENTITY pgpkey.nemysis SYSTEM "nemysis.key">
<!ENTITY pgpkey.netchild SYSTEM "netchild.key">
<!ENTITY pgpkey.ngie SYSTEM "ngie.key">
<!ENTITY pgpkey.nick SYSTEM "nick.key">
<!ENTITY pgpkey.niels SYSTEM "niels.key">
<!ENTITY pgpkey.nik SYSTEM "nik.key">
<!ENTITY pgpkey.niklas SYSTEM "niklas.key">
<!ENTITY pgpkey.nivit SYSTEM "nivit.key">
<!ENTITY pgpkey.njl SYSTEM "njl.key">
<!ENTITY pgpkey.nork SYSTEM "nork.key">
<!ENTITY pgpkey.novel SYSTEM "novel.key">
<!ENTITY pgpkey.nox SYSTEM "nox.key">
<!ENTITY pgpkey.np SYSTEM "np.key">
<!ENTITY pgpkey.nsouch SYSTEM "nsouch.key">
<!ENTITY pgpkey.nwhitehorn SYSTEM "nwhitehorn.key">
<!ENTITY pgpkey.nyan SYSTEM "nyan.key">
<!ENTITY pgpkey.obraun SYSTEM "obraun.key">
<!ENTITY pgpkey.obrien SYSTEM "obrien.key">
<!ENTITY pgpkey.ohauer SYSTEM "ohauer.key">
<!ENTITY pgpkey.oleg SYSTEM "oleg.key">
<!ENTITY pgpkey.olgeni SYSTEM "olgeni.key">
<!ENTITY pgpkey.oliver SYSTEM "oliver.key">
<!ENTITY pgpkey.olivier SYSTEM "olivier.key">
<!ENTITY pgpkey.olivierd SYSTEM "olivierd.key">
<!ENTITY pgpkey.oshogbo SYSTEM "oshogbo.key">
<!ENTITY pgpkey.patrick SYSTEM "patrick.key">
<!ENTITY pgpkey.paul SYSTEM "paul.key">
<!ENTITY pgpkey.pav SYSTEM "pav.key">
<!ENTITY pgpkey.pclin SYSTEM "pclin.key">
<!ENTITY pgpkey.peadar SYSTEM "peadar.key">
<!ENTITY pgpkey.perky SYSTEM "perky.key">
<!ENTITY pgpkey.petef SYSTEM "petef.key">
<!ENTITY pgpkey.peter SYSTEM "peter.key">
<!ENTITY pgpkey.peterj SYSTEM "peterj.key">
<!ENTITY pgpkey.pfg SYSTEM "pfg.key">
<!ENTITY pgpkey.pgj SYSTEM "pgj.key">
<!ENTITY pgpkey.pgollucci SYSTEM "pgollucci.key">
<!ENTITY pgpkey.phantom SYSTEM "phantom.key">
<!ENTITY pgpkey.phil SYSTEM "phil.key">
<!ENTITY pgpkey.philip SYSTEM "philip.key">
<!ENTITY pgpkey.phk SYSTEM "phk.key">
<!ENTITY pgpkey.pho SYSTEM "pho.key">
<!ENTITY pgpkey.pi SYSTEM "pi.key">
<!ENTITY pgpkey.pirzyk SYSTEM "pirzyk.key">
<!ENTITY pgpkey.pizzamig SYSTEM "pizzamig.key">
<!ENTITY pgpkey.pjd SYSTEM "pjd.key">
<!ENTITY pgpkey.pkelsey SYSTEM "pkelsey.key">
<!ENTITY pgpkey.pkubaj SYSTEM "pkubaj.key">
<!ENTITY pgpkey.plosher SYSTEM "plosher.key">
<!ENTITY pgpkey.pluknet SYSTEM "pluknet.key">
<!ENTITY pgpkey.portmgr-secretary SYSTEM "portmgr-secretary.key">
<!ENTITY pgpkey.pstef SYSTEM "pstef.key">
<!ENTITY pgpkey.qingli SYSTEM "qingli.key">
<!ENTITY pgpkey.rafan SYSTEM "rafan.key">
<!ENTITY pgpkey.rakuco SYSTEM "rakuco.key">
<!ENTITY pgpkey.ram SYSTEM "ram.key">
<!ENTITY pgpkey.ray SYSTEM "ray.key">
<!ENTITY pgpkey.rcyu SYSTEM "rcyu.key">
<!ENTITY pgpkey.rdivacky SYSTEM "rdivacky.key">
<!ENTITY pgpkey.rea SYSTEM "rea.key">
<!ENTITY pgpkey.rees SYSTEM "rees.key">
<!ENTITY pgpkey.remko SYSTEM "remko.key">
<!ENTITY pgpkey.rene SYSTEM "rene.key">
<!ENTITY pgpkey.rew SYSTEM "rew.key">
<!ENTITY pgpkey.rezny SYSTEM "rezny.key">
<!ENTITY pgpkey.rgrimes SYSTEM "rgrimes.key">
<!ENTITY pgpkey.rhurlin SYSTEM "rhurlin.key">
<!ENTITY pgpkey.rich SYSTEM "rich.key">
<!ENTITY pgpkey.riggs SYSTEM "riggs.key">
<!ENTITY pgpkey.rigoletto SYSTEM "rigoletto.key">
<!ENTITY pgpkey.rik SYSTEM "rik.key">
<!ENTITY pgpkey.rink SYSTEM "rink.key">
<!ENTITY pgpkey.rlibby SYSTEM "rlibby.key">
<!ENTITY pgpkey.rm SYSTEM "rm.key">
<!ENTITY pgpkey.rmacklem SYSTEM "rmacklem.key">
<!ENTITY pgpkey.rmh SYSTEM "rmh.key">
<!ENTITY pgpkey.rnoland SYSTEM "rnoland.key">
<!ENTITY pgpkey.roam SYSTEM "roam.key">
<!ENTITY pgpkey.robak SYSTEM "robak.key">
<!ENTITY pgpkey.roberto SYSTEM "roberto.key">
<!ENTITY pgpkey.rodrigc SYSTEM "rodrigc.key">
<!ENTITY pgpkey.rodrigo SYSTEM "rodrigo.key">
<!ENTITY pgpkey.romain SYSTEM "romain.key">
<!ENTITY pgpkey.royger SYSTEM "royger.key">
<!ENTITY pgpkey.rpaulo SYSTEM "rpaulo.key">
<!ENTITY pgpkey.rpokala SYSTEM "rpokala.key">
<!ENTITY pgpkey.rrs SYSTEM "rrs.key">
<!ENTITY pgpkey.rscheff SYSTEM "rscheff.key">
<!ENTITY pgpkey.rstone SYSTEM "rstone.key">
<!ENTITY pgpkey.ru SYSTEM "ru.key">
<!ENTITY pgpkey.rushani SYSTEM "rushani.key">
<!ENTITY pgpkey.ryusuke SYSTEM "ryusuke.key">
<!ENTITY pgpkey.sahil SYSTEM "sahil.key">
<!ENTITY pgpkey.salvadore SYSTEM "salvadore.key">
<!ENTITY pgpkey.sam SYSTEM "sam.key">
<!ENTITY pgpkey.samm SYSTEM "samm.key">
<!ENTITY pgpkey.sanpei SYSTEM "sanpei.key">
<!ENTITY pgpkey.sat SYSTEM "sat.key">
<!ENTITY pgpkey.sbruno SYSTEM "sbruno.key">
<!ENTITY pgpkey.sbz SYSTEM "sbz.key">
<!ENTITY pgpkey.scheidell SYSTEM "scheidell.key">
<!ENTITY pgpkey.schweikh SYSTEM "schweikh.key">
<!ENTITY pgpkey.scop SYSTEM "scop.key">
<!ENTITY pgpkey.scottl SYSTEM "scottl.key">
<!ENTITY pgpkey.scottph SYSTEM "scottph.key">
<!ENTITY pgpkey.se SYSTEM "se.key">
<!ENTITY pgpkey.seanc SYSTEM "seanc.key">
<!ENTITY pgpkey.secteam-secretary SYSTEM "secteam-secretary.key">
<!ENTITY pgpkey.security-officer SYSTEM "security-officer.key">
<!ENTITY pgpkey.sef SYSTEM "sef.key">
<!ENTITY pgpkey.sem SYSTEM "sem.key">
<!ENTITY pgpkey.sephe SYSTEM "sephe.key">
<!ENTITY pgpkey.sepotvin SYSTEM "sepotvin.key">
<!ENTITY pgpkey.sergei SYSTEM "sergei.key">
<!ENTITY pgpkey.sevan SYSTEM "sevan.key">
<!ENTITY pgpkey.sg SYSTEM "sg.key">
<!ENTITY pgpkey.sgalabov SYSTEM "sgalabov.key">
<!ENTITY pgpkey.shaun SYSTEM "shaun.key">
<!ENTITY pgpkey.sheldonh SYSTEM "sheldonh.key">
<!ENTITY pgpkey.shurd SYSTEM "shurd.key">
<!ENTITY pgpkey.simon SYSTEM "simon.key">
<!ENTITY pgpkey.sjg SYSTEM "sjg.key">
<!ENTITY pgpkey.skozlov SYSTEM "skozlov.key">
<!ENTITY pgpkey.skra SYSTEM "skra.key">
<!ENTITY pgpkey.skreuzer SYSTEM "skreuzer.key">
<!ENTITY pgpkey.slavash SYSTEM "slavash.key">
<!ENTITY pgpkey.slm SYSTEM "slm.key">
<!ENTITY pgpkey.snb SYSTEM "snb.key">
<!ENTITY pgpkey.sobomax SYSTEM "sobomax.key">
<!ENTITY pgpkey.sson SYSTEM "sson.key">
<!ENTITY pgpkey.ssouhlal SYSTEM "ssouhlal.key">
<!ENTITY pgpkey.stas SYSTEM "stas.key">
<!ENTITY pgpkey.stefan SYSTEM "stefan.key">
<!ENTITY pgpkey.stefanf SYSTEM "stefanf.key">
<!ENTITY pgpkey.stephane SYSTEM "stephane.key">
<!ENTITY pgpkey.stephen SYSTEM "stephen.key">
<!ENTITY pgpkey.stevek SYSTEM "stevek.key">
<!ENTITY pgpkey.sunpoet SYSTEM "sunpoet.key">
<!ENTITY pgpkey.swills SYSTEM "swills.key">
<!ENTITY pgpkey.sylvio SYSTEM "sylvio.key">
<!ENTITY pgpkey.syrinx SYSTEM "syrinx.key">
<!ENTITY pgpkey.syuu SYSTEM "syuu.key">
<!ENTITY pgpkey.tabthorpe SYSTEM "tabthorpe.key">
<!ENTITY pgpkey.tagattie SYSTEM "tagattie.key">
<!ENTITY pgpkey.taras SYSTEM "taras.key">
<!ENTITY pgpkey.tcberner SYSTEM "tcberner.key">
<!ENTITY pgpkey.tdb SYSTEM "tdb.key">
<!ENTITY pgpkey.theraven SYSTEM "theraven.key">
<!ENTITY pgpkey.thierry SYSTEM "thierry.key">
<!ENTITY pgpkey.thj SYSTEM "thj.key">
<!ENTITY pgpkey.thomas SYSTEM "thomas.key">
<!ENTITY pgpkey.thompsa SYSTEM "thompsa.key">
<!ENTITY pgpkey.tijl SYSTEM "tijl.key">
<!ENTITY pgpkey.timur SYSTEM "timur.key">
<!ENTITY pgpkey.tj SYSTEM "tj.key">
<!ENTITY pgpkey.tmclaugh SYSTEM "tmclaugh.key">
<!ENTITY pgpkey.tmm SYSTEM "tmm.key">
<!ENTITY pgpkey.tmseck SYSTEM "tmseck.key">
<!ENTITY pgpkey.tmunro SYSTEM "tmunro.key">
<!ENTITY pgpkey.tobez SYSTEM "tobez.key">
<!ENTITY pgpkey.tobik SYSTEM "tobik.key">
<!ENTITY pgpkey.tota SYSTEM "tota.key">
<!ENTITY pgpkey.trasz SYSTEM "trasz.key">
<!ENTITY pgpkey.trevor SYSTEM "trevor.key">
<!ENTITY pgpkey.trhodes SYSTEM "trhodes.key">
<!ENTITY pgpkey.trociny SYSTEM "trociny.key">
<!ENTITY pgpkey.truckman SYSTEM "truckman.key">
<!ENTITY pgpkey.tsoome SYSTEM "tsoome.key">
<!ENTITY pgpkey.tuexen SYSTEM "tuexen.key">
<!ENTITY pgpkey.twinterg SYSTEM "twinterg.key">
<!ENTITY pgpkey.tz SYSTEM "tz.key">
<!ENTITY pgpkey.ue SYSTEM "ue.key">
<!ENTITY pgpkey.ultima SYSTEM "ultima.key">
<!ENTITY pgpkey.ume SYSTEM "ume.key">
<!ENTITY pgpkey.ups SYSTEM "ups.key">
<!ENTITY pgpkey.uqs SYSTEM "uqs.key">
<!ENTITY pgpkey.vangyzen SYSTEM "vangyzen.key">
<!ENTITY pgpkey.vanilla SYSTEM "vanilla.key">
<!ENTITY pgpkey.vd SYSTEM "vd.key">
<!ENTITY pgpkey.versus SYSTEM "versus.key">
<!ENTITY pgpkey.vg SYSTEM "vg.key">
<!ENTITY pgpkey.viny SYSTEM "viny.key">
<!ENTITY pgpkey.vkashyap SYSTEM "vkashyap.key">
<!ENTITY pgpkey.vmaffione SYSTEM "vmaffione.key">
<!ENTITY pgpkey.vs SYSTEM "vs.key">
<!ENTITY pgpkey.vsevolod SYSTEM "vsevolod.key">
<!ENTITY pgpkey.wblock SYSTEM "wblock.key">
<!ENTITY pgpkey.wen SYSTEM "wen.key">
<!ENTITY pgpkey.weongyo SYSTEM "weongyo.key">
<!ENTITY pgpkey.wes SYSTEM "wes.key">
<!ENTITY pgpkey.wg SYSTEM "wg.key">
<!ENTITY pgpkey.whu SYSTEM "whu.key">
<!ENTITY pgpkey.wilko SYSTEM "wilko.key">
<!ENTITY pgpkey.will SYSTEM "will.key">
<!ENTITY pgpkey.wkoszek SYSTEM "wkoszek.key">
<!ENTITY pgpkey.wma SYSTEM "wma.key">
<!ENTITY pgpkey.wollman SYSTEM "wollman.key">
<!ENTITY pgpkey.woodsb02 SYSTEM "woodsb02.key">
<!ENTITY pgpkey.wosch SYSTEM "wosch.key">
<!ENTITY pgpkey.wulf SYSTEM "wulf.key">
<!ENTITY pgpkey.wxs SYSTEM "wxs.key">
<!ENTITY pgpkey.xmj SYSTEM "xmj.key">
<!ENTITY pgpkey.xride SYSTEM "xride.key">
<!ENTITY pgpkey.ygy SYSTEM "ygy.key">
<!ENTITY pgpkey.yoichi SYSTEM "yoichi.key">
<!ENTITY pgpkey.yongari SYSTEM "yongari.key">
<!ENTITY pgpkey.yuri SYSTEM "yuri.key">
<!ENTITY pgpkey.yuripv SYSTEM "yuripv.key">
<!ENTITY pgpkey.yzlin SYSTEM "yzlin.key">
<!ENTITY pgpkey.zack SYSTEM "zack.key">
<!ENTITY pgpkey.zbb SYSTEM "zbb.key">
<!ENTITY pgpkey.zeising SYSTEM "zeising.key">
<!ENTITY pgpkey.zi SYSTEM "zi.key">
<!ENTITY pgpkey.zml SYSTEM "zml.key">
<!ENTITY pgpkey.zont SYSTEM "zont.key">
<!ENTITY section.pgpkeys-core SYSTEM "pgpkeys-core.xml">
<!ENTITY section.pgpkeys-developers SYSTEM "pgpkeys-developers.xml">
<!ENTITY section.pgpkeys-officers SYSTEM "pgpkeys-officers.xml">
<!ENTITY section.pgpkeys-other SYSTEM "pgpkeys-other.xml">
<!-- Part One --><!ENTITY chap.introduction SYSTEM "introduction/chapter.xml">
<!ENTITY chap.bsdinstall SYSTEM "bsdinstall/chapter.xml">
<!ENTITY chap.basics SYSTEM "basics/chapter.xml">
<!ENTITY chap.ports SYSTEM "ports/chapter.xml">
<!ENTITY chap.x11 SYSTEM "x11/chapter.xml">
<!-- Part Two --><!ENTITY chap.desktop SYSTEM "desktop/chapter.xml">
<!ENTITY chap.multimedia SYSTEM "multimedia/chapter.xml">
<!ENTITY chap.kernelconfig SYSTEM "kernelconfig/chapter.xml">
<!ENTITY chap.printing SYSTEM "printing/chapter.xml">
<!ENTITY chap.linuxemu SYSTEM "linuxemu/chapter.xml">
<!-- Part Three --><!ENTITY chap.config SYSTEM "config/chapter.xml">
<!ENTITY chap.boot SYSTEM "boot/chapter.xml">
<!ENTITY chap.security SYSTEM "security/chapter.xml">
<!ENTITY chap.jails SYSTEM "jails/chapter.xml">
<!ENTITY chap.mac SYSTEM "mac/chapter.xml">
<!ENTITY chap.audit SYSTEM "audit/chapter.xml">
<!ENTITY chap.disks SYSTEM "disks/chapter.xml">
<!ENTITY chap.geom SYSTEM "geom/chapter.xml">
<!ENTITY chap.zfs SYSTEM "zfs/chapter.xml">
<!ENTITY chap.filesystems SYSTEM "filesystems/chapter.xml">
<!ENTITY chap.virtualization SYSTEM "virtualization/chapter.xml">
<!ENTITY chap.l10n SYSTEM "l10n/chapter.xml">
<!ENTITY chap.cutting-edge SYSTEM "cutting-edge/chapter.xml">
<!ENTITY chap.dtrace SYSTEM "dtrace/chapter.xml">
<!ENTITY chap.usb-device-mode SYSTEM "usb-device-mode/chapter.xml">
<!-- Part Four --><!ENTITY chap.serialcomms SYSTEM "serialcomms/chapter.xml">
<!ENTITY chap.ppp-and-slip SYSTEM "ppp-and-slip/chapter.xml">
<!ENTITY chap.mail SYSTEM "mail/chapter.xml">
<!ENTITY chap.network-servers SYSTEM "network-servers/chapter.xml">
<!ENTITY chap.firewalls SYSTEM "firewalls/chapter.xml">
<!ENTITY chap.advanced-networking SYSTEM "advanced-networking/chapter.xml">
<!-- Part Five (appendices) --><!ENTITY chap.mirrors SYSTEM "mirrors/chapter.xml">
<!ENTITY chap.mirrors.lastmod.inc SYSTEM "mirrors.lastmod.inc">
<!ENTITY chap.mirrors.ftp.index.inc SYSTEM "mirrors.xml.ftp.index.inc">
<!ENTITY chap.mirrors.ftp.inc SYSTEM "mirrors.xml.ftp.inc">
<!ENTITY chap.bibliography SYSTEM "bibliography/chapter.xml">
<!ENTITY chap.eresources SYSTEM "eresources/chapter.xml">
<!ENTITY chap.eresources.www.index.inc SYSTEM "eresources.xml.www.index.inc">
<!ENTITY chap.eresources.www.inc SYSTEM "eresources.xml.www.inc">
<!ENTITY chap.pgpkeys SYSTEM "pgpkeys/chapter.xml">
<!ENTITY chap.freebsd-glossary SYSTEM "../../share/xml/glossary.ent">
<!ENTITY chap.index "<index xmlns='http://docbook.org/ns/docbook'/>">
<!ENTITY chap.colophon SYSTEM "colophon.xml">
<!ENTITY % txtfiles SYSTEM "txtfiles.ent">
<!--
     Creates entities for each .txt screenshot that is included in the
     Handbook.

     Each entity is named txt.dir.foo, where dir is the directory in
     which it is stored, and foo is its filename, without the '.txt'
     extension.

     Entities should be listed in alphabetical order.

     $FreeBSD$
-->]>
<book xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:its="http://www.w3.org/2005/11/its" version="5.0" xml:lang="pt_BR">

  <info>
    <its:rules xmlns:db="http://docbook.org/ns/docbook" version="1.0">

      <its:translateRule translate="no" selector="//db:programlisting[@role='pgpfingerprint']"/>

      <its:translateRule translate="no" selector="//db:programlisting[@role='pgpkey']"/>

      <its:translateRule translate="no" selector="//db:sect2[starts-with(@xml:id,'pgpkey-')]"/>
    </its:rules>

    <title>FreeBSD Handbook</title>

    <author><orgname>Projeto de Documentação do FreeBSD</orgname></author>

    <pubdate its:translate="no">$FreeBSD$</pubdate>

    <releaseinfo its:translate="no">$FreeBSD$</releaseinfo>

    <copyright><year>1995</year> <year>1996</year> <year>1997</year> <year>1998</year> <year>1999</year> <year>2000</year> <year>2001</year> <year>2002</year> <year>2003</year> <year>2004</year> <year>2005</year> <year>2006</year> <year>2007</year> <year>2008</year> <year>2009</year> <year>2010</year> <year>2011</year> <year>2012</year> <year>2013</year> <year>2014</year> <year>2015</year> <year>2016</year> <year>2017</year> <year>2018</year> <year>2019</year> <year>2020</year> <holder>The FreeBSD Documentation Project</holder></copyright>

    
<legalnotice xml:id="legalnotice">
  <title>Copyright</title>

  <para>Redistribution and use in source (XML DocBook) and 'compiled' forms (XML, HTML, PDF, PostScript, RTF and so forth) with or without modification, are permitted provided that the following conditions are met:</para>

  <orderedlist>
    <listitem>
      <para>Redistributions of source code (XML DocBook) must retain the above copyright notice, this list of conditions and the following disclaimer as the first lines of this file unmodified.</para>
    </listitem>

    <listitem>
      <para>Redistributions in compiled form (transformed to other DTDs, converted to PDF, PostScript, RTF and other formats) must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</para>
    </listitem>
  </orderedlist>

  <important>
    <para>THIS DOCUMENTATION IS PROVIDED BY THE FREEBSD DOCUMENTATION PROJECT "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE FREEBSD DOCUMENTATION PROJECT BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS DOCUMENTATION, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</para>
  </important>
</legalnotice>


    <legalnotice xml:id="trademarks" role="trademarks">
      <para>FreeBSD is a registered trademark of the FreeBSD Foundation.</para>
      <para>3Com and HomeConnect are registered trademarks of 3Com Corporation.</para>
      <para>3ware is a registered trademark of 3ware Inc.</para>
      <para>ARM is a registered trademark of ARM Limited.</para>
      <para>Adaptec is a registered trademark of Adaptec, Inc.</para>
      <para>Adobe, Acrobat, Acrobat Reader, Flash and PostScript are either registered trademarks or trademarks of Adobe Systems Incorporated in the United States and/or other countries.</para>
      <para>Apple, AirPort, FireWire, iMac, iPhone, iPad, Mac, Macintosh, Mac OS, Quicktime, and TrueType are trademarks of Apple Inc., registered in the U.S. and other countries.</para>
      <para>Android is a trademark of Google Inc.</para>
      <para>Heidelberg, Helvetica, Palatino, and Times Roman are either registered trademarks or trademarks of Heidelberger Druckmaschinen AG in the U.S. and other countries.</para>
      <para>IBM, AIX, OS/2, PowerPC, PS/2, S/390, and ThinkPad are trademarks of International Business Machines Corporation in the United States, other countries, or both.</para>
      <para>IEEE, POSIX, and 802 are registered trademarks of Institute of Electrical and Electronics Engineers, Inc. in the United States.</para>
      <para>Intel, Celeron, Centrino, Core, EtherExpress, i386, i486, Itanium, Pentium, and Xeon are trademarks or registered trademarks of Intel Corporation or its subsidiaries in the United States and other countries.</para>
      <para>Intuit and Quicken are registered trademarks and/or registered service marks of Intuit Inc., or one of its subsidiaries, in the United States and other countries.</para>
      <para>Linux is a registered trademark of Linus Torvalds.</para>
      <para>LSI Logic, AcceleRAID, eXtremeRAID, MegaRAID and Mylex are trademarks or registered trademarks of LSI Logic Corp.</para>
      <para>Microsoft, IntelliMouse, MS-DOS, Outlook, Windows, Windows Media and Windows NT are either registered trademarks or trademarks of Microsoft Corporation in the United States and/or other countries.</para>
      <para>Motif, OSF/1, and UNIX are registered trademarks and IT DialTone and The Open Group are trademarks of The Open Group in the United States and other countries.</para>
      <para>Oracle is a registered trademark of Oracle Corporation.</para>
      <para>RealNetworks, RealPlayer, and RealAudio are the registered trademarks of RealNetworks, Inc.</para>
      <para>Red Hat, RPM, are trademarks or registered trademarks of Red Hat, Inc. in the United States and other countries.</para>
      <para>Sun, Sun Microsystems, Java, Java Virtual Machine, JDK, JRE, JSP, JVM, Netra, OpenJDK, Solaris, StarOffice, SunOS and VirtualBox are trademarks or registered trademarks of Sun Microsystems, Inc. in the United States and other countries.</para>
      <para>MATLAB is a registered trademark of The MathWorks, Inc.</para>
      <para>SpeedTouch is a trademark of Thomson.</para>
      <para>VMware is a trademark of VMware, Inc.</para>
      <para>Mathematica is a registered trademark of Wolfram Research, Inc.</para>
      <para>XFree86 is a trademark of The XFree86 Project, Inc.</para>
      <para>Ogg Vorbis and Xiph.Org are trademarks of Xiph.Org.</para>
      <para>Many of the designations used by manufacturers and sellers to distinguish their products are claimed as trademarks. Where those designations appear in this document, and the FreeBSD Project was aware of the trademark claim, the designations have been followed by the <quote>™</quote> or the <quote>®</quote> symbol.</para>
    </legalnotice>

    <abstract>
      <para>Bem vindo ao FreeBSD! Este manual cobre a instalação e o uso diário do <emphasis>FreeBSD 12.1-RELEASE</emphasis> e do <emphasis>FreeBSD 11.4-RELEASE</emphasis>. Este livro é o resultado do trabalho contínuo de muitas pessoas. Algumas seções podem estar desatualizadas. Os interessados em ajudar a atualizar e expandir este documento devem enviar e-mails para a <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-doc">lista de discussão do projeto de documentação do FreeBSD</link>.</para>

      <para>A última versão deste livro está disponível no <link xlink:href="https://www.FreeBSD.org/">site do FreeBSD</link>. Versões anteriores podem ser obtidas em <uri xlink:href="https://docs.FreeBSD.org/doc/">https://docs.FreeBSD.org/doc/</uri>. O livro pode ser baixado em uma variedade de formatos e opções de compressão do <link xlink:href="https://download.freebsd.org/ftp/doc/">servidor FTP do FreeBSD</link> ou de um dos inúmeros <link linkend="mirrors-ftp">sites espelho</link>. Cópias impressas podem ser adquiridas da <link xlink:href="https://www.freebsdmall.com/">FreeBSD Mall</link>. As pesquisas podem ser realizadas no manual e em outros documentos na <link xlink:href="@@URL_RELPREFIX@@/search/index.html">página de busca</link>.</para>
    </abstract>
  </info>

  
<!--
     $FreeBSD$
-->
<preface version="5.0" xml:id="book-preface">
  <title>Prefácio</title>

  <bridgehead xml:id="preface-audience" renderas="sect1">Audiência Pretendida</bridgehead>

  <para>O novato no FreeBSD descobrirá que a primeira seção deste livro guia o usuário através do processo de instalação do FreeBSD e gentilmente apresenta os conceitos e convenções que sustentam o <trademark class="registered">UNIX</trademark>. Trabalhar através desta seção exige pouco mais do que o desejo de explorar, e a capacidade de incorporar novos conceitos à medida que eles são introduzidos.</para>

  <para>Uma vez que você chegou até aqui, a segunda seção do Handbook, muito maior, é uma referência abrangente a todos os tópicos de interesse para administradores de sistemas FreeBSD. Alguns destes capítulos podem recomendar que você faça alguma leitura prévia, e isto é destacado na sinopse no início de cada capítulo.</para>

  <para>Para uma lista de fontes adicionais de informação, por favor veja o <xref linkend="bibliography"/>.</para>

  <bridgehead xml:id="preface-changes-from3" renderas="sect1">Mudanças desde a Terceira Edição</bridgehead>

  <para>A versão online atual do Handbook representa o esforço cumulativo de muitas centenas de contribuidores nos últimos 10 anos. A seguir estão algumas das mudanças significativas desde a publicação da terceira edição do volume em 2004:</para>

  <itemizedlist>
    <listitem>
      <para><xref linkend="dtrace"/> foi adicionado com informações sobre a poderosa ferramenta de análise de desempenho DTrace.</para>
    </listitem>

    <listitem>
      <para><xref linkend="filesystems"/> foi adicionado com informações sobre sistemas de arquivos não-nativos no FreeBSD, como o ZFS da <trademark>Sun</trademark>.</para>
    </listitem>

    <listitem>
      <para><xref linkend="audit"/> foi adicionado para cobrir os novos recursos de auditoria no FreeBSD e explicar seu uso.</para>
    </listitem>

    <listitem>
      <para><xref linkend="virtualization"/> foi adicionado com informações sobre a instalação do FreeBSD em ambientes virtualizados.</para>
    </listitem>

    <listitem>
      <para><xref linkend="bsdinstall"/> foi adicionado para cobrir a instalação do FreeBSD usando o novo utilitário de instalação, <application>bsdinstall</application>.</para>
    </listitem>
  </itemizedlist>

  <bridgehead xml:id="preface-changes-from2" renderas="sect1">Mudanças desde a Segunda Edição (2004)</bridgehead>

  <para>A terceira edição foi o culminar de mais de dois anos de trabalho pelos membros dedicados do Projeto de Documentação do FreeBSD. A edição impressa cresceu a tal tamanho que foi necessário publicar como dois volumes separados. A seguir estão as principais mudanças nesta nova edição:</para>

  <itemizedlist>
    <listitem>
      <para><xref linkend="config-tuning"/> foi expandido com novas informações sobre o gerenciamento de recursos e energia da ACPI, o utilitário de sistema <command>cron</command> e mais opções para ajuste do kernel.</para>
    </listitem>

    <listitem>
      <para><xref linkend="security"/> foi expandido com novas informações sobre redes virtuais privadas (VPNs), listas de controle de acesso (ACLs) do sistema de arquivos e avisos de segurança.</para>
    </listitem>

    <listitem>
      <para><xref linkend="mac"/> é um novo capítulo desta edição. Ele explica o que é MAC e como esse mecanismo pode ser usado para proteger um sistema FreeBSD.</para>
    </listitem>

    <listitem>
      <para><xref linkend="disks"/> foi expandido com novas informações sobre dispositivos de armazenamento USB, snapshots do sistema de arquivos, cotas do sistema de arquivos, arquivos e sistemas de arquivos com suporte de rede e partições de disco criptografadas.</para>
    </listitem>

    <listitem>
      <para>Uma seção de solução de problemas foi adicionada ao <xref linkend="ppp-and-slip"/>.</para>
    </listitem>

    <listitem>
      <para><xref linkend="mail"/> foi expandido com novas informações sobre o uso de agentes de transporte alternativos, autenticação SMTP, UUCP, <application>fetchmail</application>, <application>procmail</application> e outros tópicos avançados.</para>
    </listitem>

    <listitem>
      <para><xref linkend="network-servers"/> é novidade nesta edição. Este capítulo inclui informações sobre a configuração do <application>Servidor HTTP Apache</application>, <application>ftpd</application> e a configuração de um servidor para clientes <trademark class="registered">Microsoft</trademark> <trademark class="registered">Windows</trademark> com <application>Samba</application>. Algumas seções do <xref linkend="advanced-networking"/> foram movidas para cá para melhorar a apresentação.</para>
    </listitem>

    <listitem>
      <para><xref linkend="advanced-networking"/> foi expandido com novas informações sobre o uso de dispositivos <trademark class="registered">Bluetooth</trademark> com o FreeBSD, configuração de redes sem fio e redes ATM (Asynchronous Transfer Mode).</para>
    </listitem>

    <listitem>
      <para>Um glossário foi adicionado para fornecer um local central para as definições de termos técnicos utilizados ao longo do livro.</para>
    </listitem>

    <listitem>
      <para>Uma série de melhorias estéticas foram feitas nas tabelas e figuras ao longo do livro.</para>
    </listitem>
  </itemizedlist>

  <bridgehead xml:id="preface-changes" renderas="sect1">Mudanças desde a Primeira Edição (2001)</bridgehead>

    <para>A segunda edição foi o culminar de mais de dois anos de trabalho pelos membros dedicados do Projeto de Documentação do FreeBSD. A seguir, as principais mudanças nesta edição:</para>

<!-- Talk a little about justification and other stylesheet changes? -->

    <itemizedlist>
      <listitem>
	<para>Um índice completo foi adicionado.</para>
      </listitem>

      <listitem>
	<para>Todas as figuras ASCII foram substituídas por diagramas gráficos.</para>
      </listitem>

      <listitem>
	<para>Uma sinopse padrão foi adicionada a cada capítulo para fornecer um resumo rápido de quais informações o capítulo contém e o que se espera que o leitor saiba.</para>
      </listitem>

      <listitem>
	<para>O conteúdo foi logicamente reorganizado em três partes: <quote>Introdução</quote>, <quote>Administração do Sistema</quote> e <quote>Apêndices</quote>.</para>
      </listitem>

      <listitem>
	<para><xref linkend="basics"/> foi expandido para conter informações adicionais sobre processos, daemons e sinais.</para>
      </listitem>

      <listitem>
	<para><xref linkend="ports"/> foi expandido para conter informações adicionais sobre o gerenciamento de pacotes binários.</para>
      </listitem>

      <listitem>
	<para><xref linkend="x11"/> foi completamente reescrito com ênfase no uso de tecnologias de desktop modernas como <application>KDE</application> e <application>GNOME</application> sobre o <trademark>XFree86</trademark> 4.X.</para>
      </listitem>

      <listitem>
	<para><xref linkend="boot"/> foi expandido.</para>
      </listitem>

      <listitem>
	<para><xref linkend="disks"/> foi escrito a partir do que costumava ser dois capítulos separados em <quote>Discos</quote> e <quote>Backups</quote>. Sentimos que os tópicos são mais fáceis de compreender quando apresentados como um único capítulo. Uma seção sobre RAID (hardware e software) também foi adicionada.</para>
      </listitem>

      <listitem>
	<para><xref linkend="serialcomms"/> foi completamente reorganizado e atualizado para o FreeBSD 4.X/5.X.</para>
      </listitem>

      <listitem>
	<para><xref linkend="ppp-and-slip"/> foi substancialmente atualizado.</para>
      </listitem>

      <listitem>
	<para>Muitas novas seções foram adicionadas ao <xref linkend="advanced-networking"/>.</para>
      </listitem>

      <listitem>
	<para><xref linkend="mail"/> foi expandido para incluir mais informações sobre a configuração do <application>sendmail</application>.</para>
      </listitem>

      <listitem>
	<para><xref linkend="linuxemu"/> foi expandido para incluir informações sobre como instalar o <application><trademark class="registered">Oracle</trademark></application> e o <application><trademark class="registered">SAP</trademark> <trademark class="registered">R/3</trademark></application>.</para>
      </listitem>

      <listitem>
	<para>Os novos tópicos a seguir são abordados nesta segunda edição:</para>

	<itemizedlist>
	  <listitem>
	    <para><xref linkend="config-tuning"/>.</para>
	  </listitem>

	  <listitem>
	    <para><xref linkend="multimedia"/>.</para>
	  </listitem>
	</itemizedlist>
      </listitem>
    </itemizedlist>

    <bridgehead xml:id="preface-overview" renderas="sect1">Organização deste Livro</bridgehead>

  <para>Este livro é dividido em cinco seções logicamente distintas. A primeira seção, <emphasis>Introdução</emphasis>, cobre a instalação e o uso básico do FreeBSD. Espera-se que o leitor siga estes capítulos em sequência, possivelmente ignorando capítulos que abordam tópicos familiares. A segunda seção, <emphasis>Tarefas Comuns</emphasis>, cobre alguns dos recursos mais usados do FreeBSD. Esta seção e todas as seções subsequentes podem ser lidas fora de ordem. Cada capítulo começa com uma sinopse sucinta que descreve o que o capítulo cobre e o que se espera que o leitor já conheça. Isso permite que o leitor casual pule para encontrar capítulos de interesse. A terceira seção, <emphasis>Administração do Sistema</emphasis>, cobre tópicos de administração. A quarta seção, <emphasis>Comunicação de Rede</emphasis>, aborda tópicos sobre redes e servidores. A quinta seção contém apêndices de informações de referência.</para>

  <variablelist>

<!-- Part I - Introduction -->

    <varlistentry>
      <term><emphasis><xref linkend="introduction"/></emphasis></term>

      <listitem>
	<para>Introduz o FreeBSD para um novo usuário. Descreve a história do projeto FreeBSD, seus objetivos e modelo de desenvolvimento.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="bsdinstall"/></emphasis></term>

      <listitem>
	<para>Guia o usuário durante todo o processo de instalação do FreeBSD 9.<replaceable>x</replaceable> usando o <application>bsdinstall</application>.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="basics"/></emphasis></term>

      <listitem>
	<para>Cobre os comandos básicos e a funcionalidade do sistema operacional FreeBSD. Se você está familiarizado com <trademark class="registered">Linux</trademark> ou outro tipo de <trademark class="registered">UNIX</trademark>, provavelmente você pode pular este capítulo.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="ports"/></emphasis></term>

      <listitem>
	<para>Cobre a instalação de softwares de terceiros com a inovadora <quote>Coleção de Ports</quote> do FreeBSD, e com pacotes binários tradicionais.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="x11"/></emphasis></term>

      <listitem>
	<para>Descreve o Sistema X Window em geral e usa o X11 no FreeBSD em particular. Também descreve ambientes comuns de desktop, como o <application>KDE</application> e <application>GNOME</application>.</para>
      </listitem>
    </varlistentry>

<!-- Part II Common Tasks -->

    <varlistentry>
      <term><emphasis><xref linkend="desktop"/></emphasis></term>

      <listitem>
	<para>Lista alguns aplicativos comuns de desktop, como navegadores web e pacotes de produtividade, e descreve como instalá-los no FreeBSD.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="multimedia"/></emphasis></term>
      <listitem>
	<para>Mostra como configurar o suporte a reprodução de som e vídeo para o seu sistema. Também descreve alguns exemplos de aplicativos de áudio e vídeo.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="kernelconfig"/></emphasis></term>

      <listitem>
	<para>Explica o porque que você pode precisar configurar um novo kernel e fornece instruções detalhadas para configurar, compilar e instalar um kernel personalizado.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="printing"/></emphasis></term>

      <listitem>
	<para>Descreve o gerenciamento de impressoras no FreeBSD, incluindo informações sobre páginas de banner, contabilidade de impressoras e configuração inicial.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="linuxemu"/></emphasis></term>

      <listitem>
	<para>Descreve os recursos de compatibilidade <trademark class="registered">Linux</trademark> do FreeBSD. Também fornece instruções detalhadas de instalação para muitos aplicativos <trademark class="registered">Linux</trademark> populares, como o <application><trademark class="registered">Oracle</trademark></application> e o <application><trademark class="registered">Mathematica</trademark></application>.</para>
      </listitem>
    </varlistentry>

<!-- Part III - System Administration -->

    <varlistentry>
      <term><emphasis><xref linkend="config-tuning"/></emphasis></term>

      <listitem>
	<para>Descreve os parâmetros disponíveis para os administradores do sistema ajustarem um sistema FreeBSD para um ótimo desempenho. Também descreve os vários arquivos de configuração usados no FreeBSD e onde encontrá-los.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="boot"/></emphasis></term>

      <listitem>
	<para>Descreve o processo de inicialização do FreeBSD e explica como controlar este processo com opções de configuração.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="security"/></emphasis></term>

      <listitem>
	<para>Descreve muitas ferramentas diferentes disponíveis para ajudar a manter seu sistema FreeBSD seguro, incluindo Kerberos, IPsec e OpenSSH.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="jails"/></emphasis></term>

      <listitem>
	<para>Descreve o framework da jail e as suas vantagens sobre o chroot tradicional do FreeBSD.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="mac"/></emphasis></term>

      <listitem>
	<para>Explica o que é o Mandatory Access Control (MAC) e como esse mecanismo pode ser usado para proteger um sistema FreeBSD.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="audit"/></emphasis></term>

      <listitem>
	<para>Descreve o que é a Auditoria de Eventos do FreeBSD, como ela pode ser instalada, configurada e como as trilhas de auditoria podem ser inspecionadas ou monitoradas.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="disks"/></emphasis></term>

      <listitem>
	<para>Descreve como gerenciar mídias de armazenamento e sistemas de arquivos com o FreeBSD. Isto inclui discos físicos, matrizes RAID, mídias óticas e de fita, discos com suporte de memória e sistemas de arquivos de rede.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="geom"/></emphasis></term>

      <listitem>
	<para>Descreve o que é o framework GEOM do FreeBSD e como configurar os vários níveis suportados de RAID.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="filesystems"/></emphasis></term>

      <listitem>
	<para>Examina o suporte a sistemas de arquivos não-nativos no FreeBSD, como o Z File System da <trademark>Sun</trademark>.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="virtualization"/></emphasis></term>

      <listitem>
	<para>Descreve o que os sistemas de virtualização oferecem e como eles podem ser usados com o FreeBSD.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="l10n"/></emphasis></term>

      <listitem>
	<para>Descreve como usar o FreeBSD em outros idiomas além do inglês. Abrange a localização tanto em nível de sistema como em nível de aplicativo.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="updating-upgrading"/></emphasis></term>

      <listitem>
	<para>Explica as diferenças entre FreeBSD-STABLE, FreeBSD-CURRENT e FreeBSD releases. Descreve quais usuários se beneficiariam do uso de um sistema em desenvolvimento e descreve este processo. Cobre os métodos que os usuários podem usar para atualizar seu sistema para a última release de segurança.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="dtrace"/></emphasis></term>

      <listitem>
	<para>Descreve como configurar e usar a ferramenta DTrace da <trademark>Sun</trademark> no FreeBSD. O rastreamento dinâmico pode ajudar a localizar problemas de desempenho, realizando a análise do sistema em tempo real.</para>
      </listitem>
    </varlistentry>

<!-- Part IV - Network Communications -->

    <varlistentry>
      <term><emphasis><xref linkend="serialcomms"/></emphasis></term>

      <listitem>
	<para>Explica como conectar terminais e modems ao seu sistema FreeBSD para conexões de discagem de entrada e de saída.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="ppp-and-slip"/></emphasis></term>

      <listitem>
	<para>Descreve como usar o PPP para se conectar a sistemas remotos com o FreeBSD.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="mail"/></emphasis></term>

      <listitem>
	<para>Explica os diferentes componentes de um servidor de e-mail e mergulha em tópicos simples de configuração do software mais popular de servidor de e-mails: o <application>sendmail</application>.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="network-servers"/></emphasis></term>

      <listitem>
	<para>Fornece instruções detalhadas e exemplos de arquivos de configuração para configurar sua máquina FreeBSD como um servidor de sistema de arquivos de rede, servidor de nome de domínio, servidor de sistema de informações de rede ou servidor de sincronização de horário.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="firewalls"/></emphasis></term>

      <listitem>
	<para>Explica a filosofia por trás dos firewalls baseados em software e fornece informações detalhadas sobre a configuração dos diferentes firewalls disponíveis para o FreeBSD.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="advanced-networking"/></emphasis></term>

      <listitem>
	<para>Descreve muitos tópicos de rede, incluindo o compartilhamento de uma conexão à Internet com outros computadores em sua LAN, tópicos avançados de roteamento, rede sem fio, <trademark class="registered">Bluetooth</trademark>, ATM, IPv6 e muito mais.</para>
      </listitem>
    </varlistentry>

<!-- Part V - Appendices -->

    <varlistentry>
      <term><emphasis><xref linkend="mirrors"/></emphasis></term>

      <listitem>
	<para>Lista diferentes fontes para obter a mídia de instalação do FreeBSD em CD-ROM ou DVD, bem como diferentes sites na Internet que permitem que você baixe e instale o FreeBSD.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="bibliography"/></emphasis></term>

      <listitem>
	<para>Este livro aborda muitos assuntos diferentes que podem deixá-lo com a curiosidade de uma explicação mais detalhada. A bibliografia lista muitos livros excelentes que são referenciados no texto.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="eresources"/></emphasis></term>

      <listitem>
	<para>Descreve os muitos fóruns disponíveis para usuários do FreeBSD postarem perguntas e se engajarem em conversas técnicas sobre o FreeBSD.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><emphasis><xref linkend="pgpkeys"/></emphasis></term>

      <listitem>
	<para>Lista as fingerprints PGP de vários desenvolvedores do FreeBSD.</para>
      </listitem>
    </varlistentry>
  </variablelist>

  <bridgehead xml:id="preface-conv" renderas="sect1">Convenções utilizadas neste livro</bridgehead>

    <para>Para fornecer um texto consistente e fácil de ler, várias convenções são seguidas ao longo do livro.</para>

    <bridgehead xml:id="preface-conv-typographic" renderas="sect2">Convenções Tipográficas</bridgehead>

  <variablelist>
    <varlistentry>
      <term><emphasis>Itálico</emphasis></term>

      <listitem>
	<para>Uma fonte <emphasis>itálica</emphasis> é usada para nomes de arquivos, URLs, textos enfatizados e o primeiro uso de termos técnicos.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><literal>Monospace</literal></term>

      <listitem>
	<para>Uma fonte <literal>monoespaçada</literal> é usada para mensagens de erro, comandos, variáveis de ambiente, nomes de ports, nomes de host, nomes de usuários, nomes de grupos, nomes de dispositivos, variáveis e fragmentos de código.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><application>Negrito</application></term>

      <listitem>
	<para>Uma fonte <keycap>negrita</keycap> é usada para aplicativos, comandos e chaves.</para>
      </listitem>
    </varlistentry>
  </variablelist>

<!-- Var list -->
  <bridgehead xml:id="preface-conv-commands" renderas="sect2">Entrada do Usuário</bridgehead>

  <para>As teclas são mostradas em <keycap>negrito</keycap> para se destacar do restante do texto. As combinações de teclas que devem ser digitadas simultaneamente são mostradas com `<literal>+</literal>' entre as teclas, como:</para>

  <para><keycombo action="simul"> <keycap>Ctrl</keycap> <keycap>Alt</keycap> <keycap>Del</keycap></keycombo></para>

  <para>Isso significa que o usuário deve digitar as teclas <keycap>Ctrl</keycap>, <keycap>Alt</keycap> e <keycap>Del</keycap> ao mesmo tempo.</para>

  <para>As teclas que devem ser digitadas em sequência serão separadas por vírgulas, por exemplo:</para>

  <para><keycombo action="simul"> <keycap>Ctrl</keycap> <keycap>X</keycap> </keycombo>, <keycombo action="simul"> <keycap>Ctrl</keycap> <keycap>S</keycap></keycombo></para>

  <para>Significaria que o usuário deve digitar as teclas <keycap>Ctrl</keycap> e <keycap>X</keycap> simultaneamente e, em seguida, digitar as teclas <keycap>Ctrl</keycap> e <keycap>S</keycap> simultaneamente.</para>

<!-- How to type in key stokes, etc.. -->
  <bridgehead xml:id="preface-conv-examples" renderas="sect2">Exemplos</bridgehead>

  <para>Exemplos começando com <filename>C:\&gt;</filename> indicam um comando <trademark class="registered">MS-DOS</trademark>. Salvo indicação em contrário, estes comandos podem ser executados a partir de uma janela de <quote>Prompt de Comando</quote> em um ambiente <trademark class="registered">Microsoft</trademark> <trademark class="registered">Windows</trademark>.</para>

  <screen><prompt>E:\&gt;</prompt> <userinput>tools\fdimage floppies\kern.flp A:</userinput></screen>

  <para>Exemplos começando com <prompt>#</prompt> indicam um comando que deve ser executado como superusuário no FreeBSD. Você pode logar como <systemitem class="username">root</systemitem> para digitar o comando, ou logar como sua conta normal e usar o comando <citerefentry><refentrytitle>su</refentrytitle><manvolnum>1</manvolnum> </citerefentry> para obter privilégios de superusuário.</para>

  <screen><prompt>#</prompt> <userinput>dd if=kern.flp of=/dev/fd0</userinput></screen>

  <para>Exemplos começando com <prompt>%</prompt> indicam um comando que deve ser chamado a partir de uma conta de usuário normal. Salvo indicação em contrário, a sintaxe C-shell é usada para definir variáveis de ambiente e outros comandos do shell.</para>

  <screen><prompt>%</prompt> <userinput>top</userinput></screen>

  <bridgehead xml:id="preface-acknowledgements" renderas="sect1">Agradecimentos</bridgehead>

  <para>O livro que você está segurando representa os esforços de muitas centenas de pessoas em todo o mundo. Não importa se eles enviaram correções para erros de digitação ou submeteram capítulos completos, todas as contribuições foram úteis.</para>

  <para>Várias empresas têm apoiado o desenvolvimento deste documento, pagando aos autores para trabalhar em tempo integral, pagando pela publicação, etc. Em particular, a BSDi (posteriormente adquirida pela <link xlink:href="http://www.windriver.com">Wind River Systems</link>) pagou membros do Projeto de Documentação do FreeBSD para trabalhar na melhoria deste livro em tempo integral, levando à publicação da primeira edição impressa em março de 2000 (ISBN 1-57176-241-8). A Wind River Systems pagou vários autores adicionais para fazer uma série de melhorias na infraestrutura de impressão e adicionar capítulos adicionais ao texto. Este trabalho culminou com a publicação da segunda edição impressa em novembro de 2001 (ISBN 1-57176-303-1). Em 2003-2004, a <link xlink:href="http://www.freebsdmall.com">FreeBSD Mall, Inc.</link> pagou a vários contribuidores para melhorar o Handbook em preparação para a terceira edição impressa.</para>

</preface>


  <part xml:id="getting-started">
    <title>Primeiros Passos</title>

    <partintro>
      <para>Esta parte do handbook é destinada aos usuários e administradores que são novos no FreeBSD. Estes capítulos:</para>

      <itemizedlist>
	<listitem>
	  <para>Apresentam o FreeBSD.</para>
	</listitem>

	<listitem>
	  <para>Guiam os leitores através do processo de instalação.</para>
	</listitem>

	<listitem>
	  <para>Ensinam conceitos básicos e fundamentais do <trademark class="registered">UNIX</trademark>.</para>
	</listitem>

	<listitem>
	  <para>Mostram como instalar a grande variedade de aplicativos de terceiros disponíveis para o FreeBSD.</para>
	</listitem>

	<listitem>
	  <para>Apresenta o X, o sistema de janelas <trademark class="registered">UNIX</trademark> e detalha como configurar um ambiente de desktop para tornar os usuários mais produtivos.</para>
	</listitem>
      </itemizedlist>

      <para>O número de referências a tópicos futuros no texto foi mantido no mínimo, para que uma seção possa ser lida do começo ao fim com o mínimo de avanço desnecessário de páginas.</para>
    </partintro>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<chapter version="5.0" xml:id="introduction">

  <info>
    <title>Introdução</title>

    <authorgroup>
      <author><personname> <firstname>Jim</firstname> <surname>Mock</surname> </personname> <contrib>Reestruturado, reorganizado e com partes reescritas por </contrib></author>
    </authorgroup>
  </info>

  <sect1 xml:id="introduction-synopsis">
    <title>Sinopse</title>

    <para>Obrigado pelo seu interesse no FreeBSD! O capítulo seguinte cobre vários aspectos do Projeto FreeBSD, como seu histórico, objetivos, modelo de desenvolvimento e assim por diante.</para>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>Como o FreeBSD se relaciona com outros sistemas operacionais de computadores.</para>
      </listitem>

      <listitem>
	<para>A história do projeto FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Os objetivos do projeto FreeBSD.</para>
      </listitem>

      <listitem>
	<para>O básico do modelo de desenvolvimento de código aberto do FreeBSD.</para>
      </listitem>

      <listitem>
	<para>E claro: de onde o nome <quote>FreeBSD</quote> vem.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="nutshell">
    <title>Bem vindo ao FreeBSD!</title>

    <indexterm><primary>4.4BSD-Lite</primary></indexterm>

    <para>O FreeBSD é um Sistema Operacional de código aberto nos padrões Unix-Like para computadores de arquitetura x86 (32 and 64 bits), <trademark class="registered">ARM</trademark>, AArch64, <trademark class="registered">RISC-V</trademark>, <trademark class="registered">MIPS</trademark>, <trademark class="registered">POWER</trademark>, <trademark class="registered">PowerPC</trademark>, and Sun <trademark class="registered">UltraSPARC</trademark>. Ele fornece todos os recursos que são considerados comuns hoje em dia, como multitarefa preemptiva, proteção de memória, memória virtual, recursos para múltiplos usuários, suporte a SMP, todas as ferramentas de desenvolvimento de código aberto para diferentes linguagens e estruturas e recursos de área de trabalho centralizados no Sistema X Window, KDE ou GNOME. Seus pontos fortes são:</para>

    <itemizedlist>
      <listitem>
	<para><emphasis>Licença Liberal Open Source</emphasis>, que concede a você o direito de modificar e estender livremente seu código-fonte e incorporá-lo em projetos Open Source e produtos fechados, sem impor restrições típicas às licenças copyleft, bem como evita potenciais problemas de incompatibilidade de licença.</para>
      </listitem>

      <listitem>
	<para><emphasis>Rede TCP/IP forte</emphasis> <indexterm> <primary>TCP/IP
	      networking</primary></indexterm> - O FreeBSD implementa protocolos padrões da indústria com desempenho e escalabilidade crescentes. Isso faz com que seja uma boa combinação tanto em funções de servidor quanto de roteamento/firewall - e, de fato, muitas empresas e fornecedores o utilizam precisamente para essa finalidade.</para>
      </listitem>

      <listitem>
	<para><emphasis>Suporte totalmente integrado ao OpenZFS</emphasis>, incluindo root-on-ZFS, ZFS Boot Environments, gerenciamento de falhas, delegação administrativa, suporte a jails, documentação específica ao FreeBSD e suporte ao instalador do sistema.</para>
      </listitem>

      <listitem>
	<para><emphasis>Extensivos recursos de segurança</emphasis>, do Mandatory Access Control ao Capsicum e mecanismos de sandbox.</para>
      </listitem>

      <listitem>
	<para><emphasis>Mais de 30 mil pacotes pré-compilados</emphasis> para todas as arquiteturas suportadas, e a Coleção de Ports, que facilita a compilação de seus próprios pacotes personalizados.</para>
      </listitem>

      <listitem>
	<para><emphasis>Documentação</emphasis> - além do Handbook e livros de diferentes autores que cobrem tópicos que vão da administração do sistema aos internals do kernel, há também as páginas <citerefentry><refentrytitle>man</refentrytitle><manvolnum/></citerefentry>, não apenas para daemons do userspace, utilitários e arquivos de configuração, mas também para APIs do driver do kernel (seção 9) e drivers individuais (seção 4).</para>
      </listitem>

      <listitem>
	<para><emphasis>Estrutura de repositório simples e consistente e sistema de compilação</emphasis> - O FreeBSD usa um único repositório para todos os seus componentes, tanto para o kernel quanto para o userspace. Isso, juntamente com um sistema de compilação unificado, fácil de personalizar e um processo de desenvolvimento bem pensado, facilita a integração do FreeBSD com a infraestrutura de compilação do seu próprio produto.</para>
      </listitem>

      <listitem>
	<para><emphasis>Mantem-se fiel à filosofia do Unix</emphasis>, preferindo heterogeneidade ao invés de deamons monolíticos <quote>all in one</quote> com comportamento codificado (hardcoded).</para>
      </listitem>

      <listitem>
	<para><indexterm> <primary>binary compatibility</primary>
	    <secondary>Linux</secondary></indexterm> <emphasis>Compatibilidade binária</emphasis> com o Linux, o que torna possível executar muitos binários do Linux sem a necessidade de virtualização.</para>
      </listitem>
    </itemizedlist>

    <para>O FreeBSD é baseado na release 4.4BSD-Lite<indexterm>
	<primary>4.4BSD-Lite</primary>
      </indexterm> do Computer Systems Research Group (CSRG)<indexterm>
	<primary>Computer Systems Research Group (CSRG)</primary>
      </indexterm> da Universidade da Califórnia em Berkeley, e mantém a tradição distinta do desenvolvimento de sistemas BSD. Além do bom trabalho fornecido pelo CSRG, o Projeto FreeBSD colocou milhares de horas-homem para estender a funcionalidade e ajustar o sistema para o máximo desempenho e confiabilidade em situações de carga reais. O FreeBSD oferece desempenho e confiabilidade a altura de outras ofertas de código aberto e comerciais, combinadas com recursos de ponta não disponíveis em nenhum outro lugar.</para>

    <sect2 xml:id="os-overview">
      <title>O que o FreeBSD Pode Fazer?</title>

      <para>As aplicações para as quais o FreeBSD pode ser colocado são verdadeiramente limitadas apenas pela sua própria imaginação. Do desenvolvimento de software à automação de fábrica, do controle de estoque à correção de azimute de antenas de satélite remotas; Se isso puder ser feito com um produto comercial <trademark class="registered">UNIX</trademark>, é mais do que provável que você também possa fazê-lo com o FreeBSD! O FreeBSD também se beneficia significativamente de milhares de aplicativos de alta qualidade desenvolvidos por centros de pesquisa e universidades em todo o mundo, muitas vezes disponíveis com pouco ou nenhum custo.</para>

      <para>Como o código-fonte do FreeBSD está disponível gratuitamente, o sistema também pode ser customizado em um grau quase inédito para aplicações ou projetos especiais, e de maneiras que geralmente não são possíveis com a maioria do sistemas operacionais dos principais fornecedores comerciais. Aqui está apenas uma amostra de algumas das aplicações em que as pessoas estão atualmente usando o FreeBSD:</para>

      <itemizedlist>
	<listitem>
	  <para><emphasis>Serviços de Internet:</emphasis> A robusta rede TCP/IP incorporada ao FreeBSD torna-o uma plataforma ideal para uma variedade de serviços de Internet, tais como:</para>

	  <itemizedlist>
	    <listitem>
	      <para>Servidores WEB</para>
	    </listitem>

	    <listitem>
	      <para>Roteamento IPv4 e IPv6</para>
	    </listitem>

	    <listitem>
	      <para>Firewalls <indexterm>
		  <primary>firewall</primary>
		</indexterm> e Gateways NAT <indexterm>
		  <primary>NAT</primary>
		</indexterm> (<quote>IP masquerading</quote>)</para>
	    </listitem>

	    <listitem>
	      <para>Servidores FTP<indexterm>
		  <primary>FTP servers</primary>
		</indexterm></para>
	    </listitem>

	    <listitem>
	      <para><indexterm>
		  <primary>electronic mail</primary>
		  <see>email</see>
		</indexterm> <indexterm>
		  <primary>email</primary>
		</indexterm>Servidores de Email</para>
	    </listitem>

	    <listitem>
	      <para>E mais...</para>
	    </listitem>
	  </itemizedlist>
	</listitem>

	<listitem>
	  <para><emphasis>Educação:</emphasis> Você é estudante de ciências da computação ou de engenharia relacionada? Não há melhor maneira de aprender sobre sistemas operacionais, arquitetura de computadores e redes do que colocar as mãos no sistema, uma experiência que o FreeBSD pode oferecer. Os vários pacotes CAD, matemáticos e de design gráfico disponíveis gratuitamente também o tornam altamente útil para aqueles cujo principal interesse em um computador é fazer com que <emphasis>outro</emphasis> trabalho seja feito!</para>
	</listitem>

	<listitem>
	  <para><emphasis>Pesquisa:</emphasis> Com o código-fonte de todo o sistema disponível, o FreeBSD é uma excelente plataforma para pesquisa em sistemas operacionais, assim como em outros ramos da ciência da computação. A natureza livremente disponível do FreeBSD também possibilita que grupos remotos colaborem em ideias ou desenvolvimento compartilhado sem ter que se preocupar com acordos de licenciamento especiais ou limitações sobre o que pode ser discutido em fóruns abertos.</para>
	</listitem>

	<listitem>
	  <para><emphasis>Rede:</emphasis> Precisa de um novo roteador? <indexterm>
	      <primary>router</primary>
	    </indexterm>Um servidor de nomes (DNS)?<indexterm>
	      <primary>DNS Server</primary>
	    </indexterm> Um firewall para manter as pessoas fora de sua rede interna? O FreeBSD pode facilmente transformar esse PC não utilizado que está encostado em algum canto em um roteador avançado com recursos sofisticados de filtragem de pacotes.</para>
	</listitem>

	<listitem>
	  <para><emphasis>Embarcado:</emphasis> O FreeBSD é uma excelente plataforma para construir sistemas embarcados. <indexterm>
	      <primary>embedded</primary>
	    </indexterm> Com suporte para plataformas <trademark class="registered">ARM</trademark>, <trademark class="registered">MIPS</trademark> e <trademark class="registered">PowerPC</trademark>, juntamente com uma pilha de rede robusta, recursos de ponta e a permissiva <link xlink:href="@@URL_RELPREFIX@@/doc/en_US.ISO8859-1/books/faq/introduction.html#bsd-license-restrictions">Licença BSD</link> o FreeBSD é uma excelente base para a criação de roteadores embarcados, firewalls e outros dispositivos.</para>
	</listitem>

	<listitem>
	  <para><indexterm>
	      <primary>X Window System</primary>
	    </indexterm> <indexterm>
	      <primary>GNOME</primary>
	    </indexterm> <indexterm>
	      <primary>KDE</primary>
	    </indexterm> <emphasis>Desktop:</emphasis> O FreeBSD é uma ótima opção para uma solução de desktop barata usando o servidor X11 disponível gratuitamente. O FreeBSD oferece várias opções de ambientes de desktop de código aberto, incluindo as interfaces gráficas de usuário padrão do <application>GNOME</application> e do <application>KDE</application>. O FreeBSD pode até inicializar <quote>diskless</quote> a partir de um servidor central, tornando as estações de trabalho individuais ainda mais baratas e fáceis de administrar.</para>
	</listitem>

	<listitem>
	  <para><emphasis>Desenvolvimento de Software:</emphasis> O sistema básico do FreeBSD vem com um conjunto completo de ferramentas de desenvolvimento, incluindo um completo compilador e depurador C/C++ <indexterm>
	      <primary>Compiler</primary>
	    </indexterm>. O suporte para muitas outras linguagens também está disponível por meio da coleção de ports e dos pacotes.</para>
	</listitem>
      </itemizedlist>

      <para>O FreeBSD está disponível para download gratuito, ou pode ser obtido em CD-ROM ou DVD. Por favor, consulte <xref linkend="mirrors"/> para maiores informações sobre como obter o FreeBSD.</para>
    </sect2>

    <sect2 xml:id="introduction-nutshell-users">
      <title>Quem Usa o FreeBSD?</title>

      <indexterm><primary>usuários</primary> <secondary>grandes sites que executam o FreeBSD</secondary></indexterm>

      <para>O FreeBSD é conhecido por seus recursos de serviço web - sites que rodam no FreeBSD incluem <link xlink:href="https://news.ycombinator.com/">Hacker News</link>, <link xlink:href="http://www.netcraft.com/">Netcraft</link>, <link xlink:href="http://www.163.com/">NetEase</link>, <link xlink:href="https://signup.netflix.com/openconnect">Netflix</link>, <link xlink:href="http://www.sina.com/">Sina</link>, <link xlink:href="http://www.sony.co.jp/">Sony Japan</link>, <link xlink:href="http://www.rambler.ru/">Rambler</link>, <link xlink:href="http://www.yahoo.com/">Yahoo!</link>, e <link xlink:href="http://www.yandex.ru/">Yandex</link>.</para>

      <para>Os recursos avançados do FreeBSD, a segurança comprovada, o ciclo de release previsível e a licença permissiva levaram à sua utilização como plataforma para a construção de muitos appliances, dispositivos e produtos tanto comerciais quanto de código aberto. Muitas das maiores empresas de TI do mundo usam o FreeBSD:</para>

      <itemizedlist>
	<listitem>

	  <para><link xlink:href="http://www.apache.org/">Apache</link> <indexterm>
	      <primary>Apache</primary>
	    </indexterm> - A Apache Software Foundation executa a maior parte de sua infraestrutura voltada para o público, incluindo possivelmente um dos maiores repositórios SVN do mundo, com mais de 1.4 milhões de commits, no FreeBSD.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://www.apple.com/">Apple</link> <indexterm>
	      <primary>Apple</primary>
	    </indexterm> - OS X utiliza muito do FreeBSD na sua pilha de rede, no seu sistema de arquivos virtuais e em muitos componentes userland. O Apple iOS também contém elementos emprestados do FreeBSD.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://www.cisco.com/">Cisco</link> <indexterm>
	      <primary>Cisco</primary>
	    </indexterm> - Os appliances de segurança de rede e anti-spam IronPort executam um kernel modificado do FreeBSD.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://www.citrix.com/">Citrix</link> <indexterm>
	      <primary>Citrix</primary>
	    </indexterm> - A linha NetScaler de dispositivos de segurança fornece balanceamento de carga nas camadas 4-7, cache de conteúdo, firewall de aplicativos, VPN segura e acesso móvel à rede em nuvem, juntamente com o poder de um shell do FreeBSD.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="https://www.emc.com/isilon">Dell EMC Isilon</link> <indexterm>
	      <primary>Isilon</primary>
	    </indexterm> - Os dispositivos de armazenamento corporativo da Isilon são baseados no FreeBSD. A licença extremamente liberal do FreeBSD permitiu que a Isilon integrasse sua propriedade intelectual ao kernel e se concentrasse em construir seu produto ao invés de um sistema operacional.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://www.quest.com/KACE">Quest KACE</link> <indexterm>
	      <primary>Quest KACE</primary>
	    </indexterm> - Os appliances de gerenciamento de sistemas KACE executam o FreeBSD devido à sua confiabilidade, escalabilidade e a comunidade que apoia seu desenvolvimento contínuo.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://www.ixsystems.com/">iXsystems</link> <indexterm>
	      <primary>iXsystems</primary>
	    </indexterm> - A linha TrueNAS de dispositivos de armazenamento unificado é baseada no FreeBSD. Além de seus produtos comerciais, a iXsystems também gerencia o desenvolvimento dos projetos de código aberto TrueOS e FreeNAS.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://www.juniper.net/">Juniper</link> <indexterm>
	      <primary>Juniper</primary>
	    </indexterm> - O sistema operacional JunOS que roda em todos os equipamentos de rede da Juniper (incluindo roteadores, switches, firewalls e dispositivos de rede) é baseado no FreeBSD. A Juniper é um dos muitos fornecedores que mostra a relação simbiótica entre o projeto e os fornecedores de produtos comerciais. Melhorias geradas na Juniper são enviadas para o FreeBSD para reduzir a complexidade de integrar novos recursos do FreeBSD ao JunOS no futuro.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://www.mcafee.com/">McAfee</link> <indexterm>
	      <primary>McAfee</primary>
	    </indexterm> - O SecurOS, a base dos produtos de firewall corporativo da McAfee, incluindo o Sidewinder, é baseado no FreeBSD.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://www.netapp.com/">NetApp</link> <indexterm>
	      <primary>NetApp</primary>
	    </indexterm> - A linha de dispositivos de armazenamento Data ONTAP GX é baseada no FreeBSD. Além disso, a NetApp contribuiu com muitos recursos, incluindo o novo hipervisor licenciado pelo BSD, bhyve.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://www.netflix.com/">Netflix</link> <indexterm>
	      <primary>Netflix</primary>
	    </indexterm> - O appliance OpenConnect que a Netflix usa para transmitir filmes para seus clientes é baseado no FreeBSD. A Netflix fez extensas contribuições para a base de código e trabalha para manter um delta zero a partir do FreeBSD mainline. Os appliances Netflix OpenConnect são responsáveis por entregar mais de 32% de todo o tráfego de Internet na América do Norte.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://www.sandvine.com/">Sandvine</link> <indexterm>
	      <primary>Sandvine</primary>
	    </indexterm> - A Sandvine usa o FreeBSD como base de suas plataformas de processamento de rede em tempo real de alto desempenho que compõem seus produtos inteligentes de controle de política de rede.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://www.sony.com/">Sony</link> <indexterm>
	      <primary>Sony</primary>
	    </indexterm> - O console de videogame PlayStation 4 executa uma versão modificada do FreeBSD.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://www.sophos.com/">Sophos</link> <indexterm>
	      <primary>Sophos</primary>
	    </indexterm> - O produto Sophos Email Appliance é baseado em uma versão modificada (hardened) do FreeBSD e varre as mensagens de entrada em busca por spam e vírus, ao mesmo tempo em que monitora as mensagens de saída quanto a malware, bem como a perda acidental de informações confidenciais.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://www.spectralogic.com/">Spectra Logic</link> <indexterm>
	      <primary>Spectra Logic</primary>
	    </indexterm> - A linha nTier de dispositivos de armazenamento de dados de arquivamento executa o FreeBSD e o OpenZFS.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="https://www.stormshield.eu">Stormshield</link> <indexterm>
	      <primary>Stormshield</primary>

	    </indexterm> - Os dispositivos Stormshield Network Security são baseados em uma versão modificada do FreeBSD. A licença BSD permite que eles integrem sua própria propriedade intelectual ao sistema enquanto retornam uma grande quantidade de desenvolvimento interessante para a comunidade.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://www.weather.com/">The Weather Channel</link> <indexterm>
	      <primary>The Weather Channel</primary>

	    </indexterm> - O appliance IntelliStar que é instalado na central de cada provedor de cabo local e é responsável por injetar previsões meteorológicas locais na programação da rede de TV a cabo, executa o FreeBSD.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://www.verisign.com/">Verisign</link> <indexterm>
	      <primary>Verisign</primary>

	    </indexterm> - A Verisign é responsável por operar os registros de domínio raiz .com e .net, bem como a infra-estrutura de DNS que a acompanha. Eles contam com diversos sistemas operacionais de rede, incluindo o FreeBSD, para garantir que não haja um ponto comum de falha em sua infraestrutura.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://www.voxer.com/">Voxer</link> <indexterm>
	      <primary>Voxer</primary>

	    </indexterm> - A Voxer suporta sua plataforma de mensagem de voz móvel com o ZFS no FreeBSD. A Voxer mudou de um derivativo do Solaris para o FreeBSD por causa da sua documentação superior, comunidade maior e mais ativa e ao ambiente mais favorável ao desenvolvedor. Além de recursos críticos como o <acronym>ZFS</acronym> e o DTrace, o FreeBSD também oferece suporte a TRIM no <acronym>ZFS</acronym>.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="https://fudosecurity.com/en/">Fudo Security</link> <indexterm>
	      <primary>Fudo Security</primary>

	    </indexterm> - O dispositivo de segurança FUDO permite que as empresas monitorem, controlem, registrem e façam auditoria de contratados e administradores que trabalham em seus sistemas. Baseado em todos os melhores recursos de segurança do FreeBSD, incluindo ZFS, GELI, Capsicum, HAST e auditdistd.</para>
	</listitem>
      </itemizedlist>

      <para>O FreeBSD também gerou vários projetos de código aberto relacionados:</para>

      <itemizedlist>
	<listitem>
	  <para><link xlink:href="http://bsdrp.net/">BSD Router</link><indexterm>
	      <primary>BSD Router</primary>
	    </indexterm> - Um substituto baseado em FreeBSD para grandes roteadores corporativos projetados para rodar em hardware PC padrão.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://www.freenas.org/">FreeNAS</link><indexterm>
	      <primary>FreeNAS</primary>
	    </indexterm> - Um FreeBSD personalizado projetado para ser usado como um dispositivo de servidor de arquivos de rede. Fornece uma interface web baseada em Python para simplificar o gerenciamento dos sistemas de arquivos UFS e ZFS. Inclui suporte para NFS, SMB/CIFS, AFP, FTP e iSCSI. Inclui um sistema extensível de plugins baseado em jails do FreeBSD.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="https://ghostbsd.org/">GhostBSD</link> <indexterm>
	      <primary>GhostBSD</primary>
	    </indexterm> - é derivado do FreeBSD, usa o ambiente GTK para fornecer uma aparência bonita e uma experiência confortável na moderna plataforma BSD, oferecendo um ambiente de trabalho natural e nativo <trademark class="registered">UNIX</trademark>.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://mfsbsd.vx.sk/">mfsBSD</link> <indexterm>
	      <primary>mfsBSD</primary>
	    </indexterm> - Um kit de ferramentas para compilar uma imagem do sistema FreeBSD que roda inteiramente da memória.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://www.nas4free.org/">NAS4Free</link><indexterm>
	      <primary>NAS4Free</primary>
	    </indexterm> - Uma distribuição de servidor de arquivos baseada no FreeBSD com uma interface web PHP.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://www.opnsense.org/">OPNSense</link> <indexterm>
	      <primary>OPNsense</primary>
	    </indexterm> - OPNsense é um firewall e uma plataforma de roteamento open source, baseado em FreeBSD, fácil-de-usar e fácil-de-compilar. O OPNsense inclui a maioria dos recursos disponíveis em firewalls comerciais caros e, em muitos casos, muito mais. Ele traz o rico conjunto de recursos de ofertas comerciais com os benefícios de códigos fonte abertos e verificáveis.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="https://www.trueos.org">TrueOS</link> <indexterm>
	      <primary>TrueOS</primary>
	    </indexterm> - O TrueOS é baseado na lendária segurança e estabilidade do FreeBSD. O TrueOS segue o FreeBSD-CURRENT, com os drivers, atualizações de segurança e pacotes mais recentes disponíveis.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="https://www.furybsd.org">FuryBSD</link> <indexterm>
	      <primary>FuryBSD</primary>
	    </indexterm> - é um desktop FreeBSD de código aberto novinho em folha. O FuryBSD presta homenagem aos projetos de BSD de desktop do passado, como PC-BSD e TrueOS com sua interface gráfica e adiciona ferramentas adicionais, como uma imagem live USB/DVD híbrida. O FuryBSD é totalmente gratuito para uso e distribuído sob a licença BSD.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="https://www.midnightbsd.org">MidnightBSD</link> <indexterm>
	      <primary>MidnightBSD</primary>
	    </indexterm> - é um sistema operacional derivado do FreeBSD desenvolvido com usuários de desktop em mente. Inclui todo o software que você esperaria para suas tarefas diárias: email, navegação web, processamento de texto, jogos e muito mais.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://www.pfsense.org/">pfSense</link><indexterm>
	      <primary>pfSense</primary>
	    </indexterm> - Uma distribuição de firewall baseada no FreeBSD com uma enorme variedade de recursos e amplo suporte a IPv6.</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://zrouter.org/">ZRouter</link> <indexterm>
	      <primary>ZRouter</primary>
	    </indexterm> - Um firmware alternativo de código aberto para dispositivos embarcados baseado no FreeBSD. Projetado para substituir o firmware proprietário em roteadores prontos para uso.</para>
	</listitem>
      </itemizedlist>

      <para>Uma lista de <link xlink:href="https://www.freebsdfoundation.org/about/testimonials/">depoimentos de empresas que baseiam seus produtos e serviços no FreeBSD</link> pode ser encontrada no site da Fundação FreeBSD. A Wikipedia também mantém uma <link xlink:href="https://en.wikipedia.org/wiki/List_of_products_based_on_FreeBSD">lista de produtos baseados no FreeBSD</link>.</para>

    </sect2>
  </sect1>

  <sect1 xml:id="history">
    <title>Sobre o Projeto FreeBSD</title>

    <para>A seção a seguir fornece algumas informações básicas sobre o projeto, incluindo um breve histórico, metas do projeto e o modelo de desenvolvimento do projeto.</para>

    <sect2 xml:id="intro-history">
      <title>Uma Breve História do FreeBSD</title>

      <indexterm><primary>386BSD Patchkit</primary></indexterm>
      <indexterm><primary>Hubbard, Jordan</primary></indexterm>
      <indexterm><primary>Williams, Nate</primary></indexterm>
      <indexterm><primary>Grimes, Rod</primary></indexterm>
      <indexterm><primary>FreeBSD Project</primary> <secondary>history</secondary></indexterm>

      <para>O Projeto FreeBSD teve sua gênese no início de 1993, parcialmente como uma evolução natural do Unofficial 386BSD Patchkit por parte dos três últimos coordenadores: Nate Williams, Rod Grimes e Jordan Hubbard.</para>

      <indexterm><primary>386BSD</primary></indexterm>
      <para>O objetivo original era produzir um snapshot intermediário do 386BSD, a fim de corrigir um grande número de problemas que o mecanismo do patchkit simplesmente não era capaz de resolver. O título inicial do projeto foi 386BSD 0.5 ou 386BSD Interim em referência a esse fato.</para>

      <indexterm><primary>Jolitz, Bill</primary></indexterm>
      <para>O 386BSD era o sistema operacional do Bill Jolitz, que havia até então sofrido bastante com quase um ano de negligência. Como o patchkit inchava cada vez mais desconfortavelmente a cada dia que passava, eles decidiram ajudar o Bill fornecendo este snapshot <quote>limpo</quote>. Esses planos foram interrompidos quando, de repente, Bill Jolitz decidiu retirar sua sanção do projeto sem qualquer indicação clara do que seria feito em seu lugar.</para>

      <indexterm><primary>Greenman, David</primary></indexterm>
      <indexterm><primary>Walnut Creek CDROM</primary></indexterm>

      <para>O trio achou que a meta continuava valendo a pena, mesmo sem o apoio de Bill, e então adotaram o nome "FreeBSD" cunhado por David Greenman. Os objetivos iniciais foram definidos após consultar os usuários atuais do sistema e, uma vez que ficou claro que o projeto estava em vias de se tornar realidade, Jordan entrou em contato com a Walnut Creek CDROM com o objetivo de melhorar os canais de distribuição do FreeBSD para aqueles desafortunados sem acesso fácil à Internet. O  Walnut Creek CDROM não apenas apoiou a ideia de distribuir o FreeBSD em CD, mas também chegou a fornecer ao projeto uma máquina para trabalhar e uma conexão rápida à Internet. Sem o grau de fé quase sem precedentes da Walnut Creek CDROM no que era, na época, um projeto completamente desconhecido, é bastante improvável que o FreeBSD tivesse chegado tão longe, tão rápido, como hoje.</para>

      <indexterm><primary>4.3BSD-Lite</primary></indexterm>
      <indexterm><primary>Net/2</primary></indexterm>
      <indexterm><primary>U.C. Berkeley</primary></indexterm>
      <indexterm><primary>386BSD</primary></indexterm>
      <indexterm><primary>Free Software Foundation</primary></indexterm>
      <para>A primeira distribuição em CD-ROM (e amplo pela rede) foi o FreeBSD 1.0, lançado em dezembro de 1993. Isto foi baseado na fita 4.3BSD-Lite (<quote>Net/2</quote>) da U.C. Berkeley, com muitos componentes também fornecidos pelo 386BSD e pela Free Software Foundation. Foi um sucesso bastante razoável para uma primeira oferta, e e eles seguiram com o bem-sucedido FreeBSD 1.1 em maio de 1994.</para>

      <indexterm><primary>Novell</primary></indexterm>
      <indexterm><primary>U.C. Berkeley</primary></indexterm>
      <indexterm><primary>Net/2</primary></indexterm>
      <indexterm><primary>AT&amp;T</primary></indexterm>
      <para>Por esta altura, algumas nuvens de tempestade inesperadas formaram-se no horizonte, como a Novell e U.C. Berkeley resolveram seu longo processo judicial sobre o status legal da fita do Berkeley Net/2. Uma condição desse acordo foi a concessão da U.C. Berkeley de que grande parte do código Net/2 foi <quote>onerado</quote> e era de propriedade da Novell, que por sua vez o adquiriu da AT&amp;T algum tempo antes. O que a Berkeley recebeu em troca foi a <quote>bênção</quote> da Novell de que o lançamento do 4.4BSD-Lite, quando finalmente fosse lançado, seria declarado livre e todos os atuais usuários do Net/2 seriam fortemente encorajados a mudar. Isso incluiu o FreeBSD, e foi dado ao projeto o tempo para interromper o envio de seu próprio produto baseado em Net/2 até o final de julho de 1994. Sob os termos desse acordo, o projeto recebeu um último lançamento antes do prazo final, sendo esse lançamento o FreeBSD 1.1.5.1.</para>

      <para>O FreeBSD então começou a tarefa árdua de literalmente se reinventar de um conjunto completamente novo e incompleto de bits do 4.4BSD-Lite. As versões <quote>Lite</quote> foram leves em parte porque o CSRG da Berkeley removeu grandes pedaços de código necessários para realmente compilar um sistema inicializável (devido a vários requisitos legais) e o fato de que a port Intel do 4.4 era altamente incompleto. O projeto levou até novembro de 1994 para fazer essa transição, e em dezembro lançou o FreeBSD 2.0 para o mundo. Apesar de ainda ser um pouco mais difícil, o lançamento foi um sucesso significativo e foi seguido pela versão mais robusta e fácil de instalar o FreeBSD 2.0.5 em junho de 1995.</para>

      <para>Desde aquela época, o FreeBSD fez uma série de lançamentos cada vez melhorando a estabilidade, a velocidade e o conjunto de recursos da versão anterior.</para>

      <para>Por enquanto, os projetos de desenvolvimento de longo prazo continuam a ocorrer no ramo 10.X-CURRENT (trunk), e os snapshots de release 10.X são continuamente disponibilizados a partir do <link xlink:href="ftp://ftp.FreeBSD.org/pub/FreeBSD/snapshots/">servidor de snapshots</link> à medida que o trabalho progride.</para>
    </sect2>

    <sect2 xml:id="goals">
      <info>
	<title>Objetivos do Projeto FreeBSD</title>

	<authorgroup>
	  <author><personname> <firstname>Jordan</firstname> <surname> Hubbard </surname> </personname> <contrib>Contribuído por</contrib></author>
	</authorgroup>
      </info>

      <indexterm><primary>FreeBSD Project</primary> <secondary>goals</secondary></indexterm>
      <para>Os objetivos do Projeto FreeBSD são fornecer software que possa ser usado para qualquer propósito e sem amarras. Muitos de nós temos um investimento significativo no código (e projeto) e certamente não nos importaríamos com uma pequena compensação financeira de vez em quando, mas definitivamente não estamos preparados para insistir nisso. Acreditamos que a nossa primeira e principal <quote>missão</quote> é fornecer código a todos os participantes, e para qualquer finalidade, para que o código obtenha o maior uso possível e forneça o maior benefício possível. Este é, acredito, um dos objetivos mais fundamentais do Software Livre e um dos que apoiamos entusiasticamente.</para>

      <indexterm><primary>GNU General Public License (GPL)</primary></indexterm>
      <indexterm><primary>GNU Lesser General Public License (LGPL)</primary></indexterm>
      <indexterm><primary>BSD Copyright</primary></indexterm>
      <para>O código em nossa árvore de código-fonte que se enquadra na GNU General Public License (GPL) ou na Library General Public License (LGPL) vem com um pouco mais de amarras, embora pelo menos do lado do acesso imposto, em vez do oposto usual. Devido às complexidades adicionais que podem evoluir no uso comercial de software GPL, no entanto, preferimos software submetido sob licença BSD quando é uma opção razoável fazê-lo.</para>
    </sect2>

    <sect2 xml:id="development">
      <info>
	<title>O Modelo de Desenvolvimento do FreeBSD</title>

	<authorgroup>
	  <author><personname> <firstname>Satoshi</firstname> <surname>Asami</surname> </personname> <contrib>Contribuído por </contrib></author>
	</authorgroup>
      </info>

      <indexterm><primary>FreeBSD Project</primary> <secondary>development model</secondary></indexterm>

      <para>O desenvolvimento do FreeBSD é um processo muito aberto e flexível, sendo construído literalmente a partir das contribuições de milhares de pessoas ao redor do mundo, como pode ser visto na nossa  <link xlink:href="@@URL_RELPREFIX@@/doc/en_US.ISO8859-1/articles/contributors/article.html">lista de contribuidores</link>. A infraestrutura de desenvolvimento do FreeBSD permite que milhares de colaboradores colaborem pela Internet. Estamos constantemente à procura de novos desenvolvedores e ideias, e os interessados em se envolver mais estreitamente com o projeto precisam simplesmente entrar em contato conosco pelas <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hackers">lista de discussões técnicas do FreeBSD</link>. A <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-announce">lista de discussão de anúncios do FreeBSD</link> também está disponível para aqueles que desejam fazer com que outros usuários do FreeBSD conheçam as principais áreas de trabalho.</para>

      <para>Coisas úteis para saber sobre o Projeto FreeBSD e seu processo de desenvolvimento, seja trabalhando independentemente ou em estreita cooperação:</para>

      <variablelist>
	<varlistentry>
	  <term>Os repositórios SVN<anchor xml:id="development-cvs-repository"/></term>

	  <listitem>
	    <para><indexterm>
		<primary>CVS</primary>
	      </indexterm> <indexterm>
		<primary>CVS Repository</primary>
	      </indexterm> <indexterm>
		<primary>Concurrent Versions System</primary>
		<see>CVS</see>
	      </indexterm> <indexterm>
		<primary>Subversion</primary>
	      </indexterm> <indexterm>
		<primary>Subversion Repository</primary>
	      </indexterm> <indexterm>
		<primary>SVN</primary>
		<see>Subversion</see>
	      </indexterm>Por vários anos, a árvore de código-fonte central do FreeBSD foi mantida pelo <link xlink:href="http://www.nongnu.org/cvs/">CVS</link> (Concurrent Versions Systems), uma ferramenta de controle de código-fonte disponível gratuitamente. Em junho de 2008, o Projeto mudou para o <link xlink:href="http://subversion.tigris.org">SVN</link> (Subversion). A troca foi considerada necessária, pois as limitações técnicas impostas pelo <application>CVS</application> estavam se tornando óbvias devido à rápida expansão da árvore de código-fonte e à quantidade de histórico já armazenada. Os repositórios do Projeto de Documentação e da Coleção de Ports também foram movidos do <application>CVS</application> para o <application>SVN</application> em maio de 2012 e julho de 2012, respectivamente. Por favor, consulte a seção <link linkend="synching">Atualizando o código fonte</link> para maiores informações sobre como obter o repositório <literal>src/</literal> do FreeBSD e <link linkend="ports-using">Usando a Coleção de Ports</link> para detalhes sobre como obter a coleção de ports do FreeBSD.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>A lista de committers<anchor xml:id="development-committers"/></term>

	  <listitem>
	    <para>Os <firstterm>committers</firstterm> <indexterm>
		<primary>committers</primary>
	      </indexterm> são as pessoas que têm acesso de <emphasis>escrita</emphasis> na árvore do Subversion, e estão autorizados a fazer modificações no código fonte do FreeBSD (o termo <quote>committer</quote> vem de <command>commit</command>, o comando de controle de código-fonte que é usado para trazer novas mudanças para o repositório). Qualquer um pode enviar um relatório de bug para o <link xlink:href="https://bugs.FreeBSD.org/submit/">Banco de Dados de Bugs</link>. Antes de enviar um relatório de bug, as listas de discussão, canais de IRC ou fóruns do FreeBSD podem ser usados para ajudar a verificar se um problema é realmente um bug.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>O FreeBSD core team<anchor xml:id="development-core"/></term>

	  <listitem>
	    <para>O <firstterm>FreeBSD core team</firstterm> <indexterm>
		<primary>core team</primary>
	      </indexterm> seria equivalente a um conselho de diretores se o Projeto FreeBSD fosse uma empresa. A principal tarefa do core team é garantir que o projeto, como um todo, esteja saudável e seguindo na direção certa. Convidar desenvolvedores dedicados e responsáveis a ingressar em nosso grupo de committers é uma das funções do core team, assim como o recrutamento de novos membros do core team à medida que os outros saiam. O core team atual foi eleito a partir de um grupo de committers candidatos em junho de 2020. As eleições são realizadas a cada dois anos.</para>

	    <note>
	      <para>Como a maioria dos desenvolvedores, a maioria dos membros do core team também são voluntários quando se trata de desenvolvimento do FreeBSD e não se beneficiam financeiramente do projeto, então o <quote>compromisso</quote> também não deve ser interpretado erroneamente como significando <quote>suporte garantido</quote>. A analogia do <quote>quadro de diretores</quote> da diretriz acima não é muito precisa, e pode ser mais apropriado dizer que estas são as pessoas que deram suas vidas em favor do FreeBSD contra o seu melhor julgamento!</para>
	    </note>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>Contribuidores externos</term>

	  <listitem>
	    <para>Por último, mas definitivamente não menos importante, o maior grupo de desenvolvedores são os próprios usuários que fornecem feedback e correções de bugs para nós em uma base quase constante. A principal maneira de manter contato com o desenvolvimento não-centralizado do FreeBSD é inscrever-se nas <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hackers">listas de discussões técnicas sobre o FreeBSD</link> onde essas coisas são discutidas. Veja <xref linkend="eresources"/> para maiores informações sobre as várias listas de discussão do FreeBSD.</para>

	    <para>A <citetitle><link xlink:href="@@URL_RELPREFIX@@/doc/en_US.ISO8859-1/articles/contributors/article.html">Lista de Colaboradores do FreeBSD</link> </citetitle><indexterm>
		<primary>contributors</primary>
	      </indexterm> é extensa e crescente, então por que não se juntar a ela contribuindo com algo para o FreeBSD hoje?</para>

	    <para>Fornecer código não é a única maneira de contribuir para o projeto; para uma lista mais completa de coisas que precisam ser feitas, por favor consulte o <link xlink:href="@@URL_RELPREFIX@@/index.html">web site do Projeto FreeBSD</link>.</para>
	  </listitem>
	</varlistentry>
      </variablelist>

      <para>Em resumo, nosso modelo de desenvolvimento é organizado como um conjunto solto de círculos concêntricos. O modelo centralizado é projetado para a conveniência dos <emphasis>usuários</emphasis> do FreeBSD, que são providos com uma maneira fácil de rastrear uma base de código central, e não para manter potenciais colaboradores fora! Nosso desejo é apresentar um sistema operacional estável com um grande conjunto de <link linkend="ports">aplicações</link> coerentes que os usuários possam facilmente instalar e usar - este modelo funciona muito bem em realizar isso.</para>

      <para>Tudo o que pedimos para aqueles que se juntarem a nós como desenvolvedores do FreeBSD é a mesma dedicação que o pessoal atual tem para o seu sucesso contínuo!</para>
    </sect2>

    <sect2 xml:id="third-party-programs">
      <title>Programas de Terceiros</title>

      <para>Além das distribuições básicas, o FreeBSD oferece uma coleção de software portada com milhares de programas comumente procurados. No momento da redação deste texto, havia mais de 24.000 ports! A lista de ports varia de servidores http, a jogos, linguagens, editores e quase tudo no meio. Toda a coleção de ports requer aproximadamente 500 MB. Para compilar um port, simplesmente mude para o diretório do programa que você deseja instalar, digite <command>make install</command> e deixe o sistema fazer o resto. A distribuição original completa para cada port que você cria é baixada dinamicamente, para que você precise apenas de espaço em disco suficiente para compilar os ports desejados. Quase todos os ports também são fornecidos como um pacote <quote>pré-compilado</quote>, que pode ser instalado com um comando simples (<command>pkg install</command>) por aqueles que não desejam compilar seus próprios ports pelo código fonte. Maiores informações sobre pacotes e ports podem ser encontradas em <xref linkend="ports"/>.</para>
    </sect2>

    <sect2>
      <title>Documentação Adicional</title>

      <para>Todas as versões suportadas do FreeBSD fornecem uma opção no instalador para instalar documentação adicional em <filename>/usr/local/shar/doc/freebsd</filename> durante a configuração inicial do sistema. A documentação também pode ser instalada posteriormente, usando os pacotes descritos em <xref linkend="doc-ports-install-package"/>. Você pode ver os manuais instalados localmente com qualquer navegador compatível com HTML usando as seguintes URLs:</para>

      <variablelist>
	<varlistentry>
	  <term>O Handbook do FreeBSD</term>

	  <listitem>
	    <para><link xlink:href="file://localhost/usr/local/share/doc/freebsd/handbook/index.html"><filename>/usr/local/share/doc/freebsd/handbook/index.html</filename></link></para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>O FAQ do FreeBSD</term>

	  <listitem>
	    <para><link xlink:href="file://localhost/usr/local/share/doc/freebsd/faq/index.html"><filename>/usr/local/share/doc/freebsd/faq/index.html</filename></link></para>
	  </listitem>
	</varlistentry>
      </variablelist>

      <para>Você também pode visualizar as cópias principais (e atualizadas com mais frequência) em <uri xlink:href="https://www.FreeBSD.org/">https://www.FreeBSD.org/</uri>.</para>
    </sect2>
  </sect1>
</chapter>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->

<chapter version="5.0" xml:id="bsdinstall">

  <info>
    <title>Instalando o FreeBSD</title>

    <authorgroup>
      <author><personname> <firstname>Jim</firstname> <surname>Mock</surname> </personname> <contrib>Reestruturado, reorganizado e com partes reescritas por </contrib></author>
    </authorgroup>

    <!---
      <authorgroup>
	<author>
	  <personname>
	    <firstname>Randy</firstname>
	    <surname>Pratt</surname>
	  </personname>
	  <contrib>The sysinstall walkthrough, screenshots, and
	    general copy by </contrib>
	</author>
      </authorgroup>
    -->

    <authorgroup>
      <author><personname> <firstname>Gavin</firstname> <surname>Atkinson</surname> </personname> <contrib>Atualizado para o bsdinstall por </contrib></author>

      <author><personname> <firstname>Warren</firstname> <surname>Block</surname> </personname></author>
    </authorgroup>

    <authorgroup>
      <author><personname> <firstname>Allan</firstname> <surname>Jude</surname> </personname> <contrib>Atualizado para  root-on-ZFS por </contrib></author>
    </authorgroup>
  </info>

  <sect1 xml:id="bsdinstall-synopsis">
    <title>Sinopse</title>

    <indexterm><primary>installation</primary></indexterm>

    <para>Existem diversos modos diferentes de colocar o FreeBSD para rodar, dependendo do ambiente. São eles:</para>

    <itemizedlist>
      <listitem>
	<para>Imagens de Máquinas Virtuais, para baixar e importar em um ambiente virtual da sua escolha. Elas podem ser baixadas da página de <link xlink:href="https://www.freebsd.org/where.html">Download do FreeBSD</link>. Existem imagens para KVM (<quote>qcow2</quote>), VMWare (<quote>vmdk</quote>), Hyper-V (<quote>vhd</quote>) e imagens de dispositivos brutos (raw device) que são universalmente suportadas . Estas não são imagens de instalação, mas sim as instâncias pré-configuradas (<quote>já instaladas</quote>), prontas para executar e realizar tarefas de pós-instalação.</para>
      </listitem>

      <listitem>
	<para>Imagens de máquinas virtuais disponíveis no <link xlink:href="https://aws.amazon.com/marketplace/pp/B07L6QV354">AWS Marketplace</link>, no <link xlink:href="https://azuremarketplace.microsoft.com/en-us/marketplace/apps?search=freebsd&amp;page=1">Microsoft Azure Marketplace</link>, e na <link xlink:href="https://console.cloud.google.com/marketplace/details/freebsd-cloud/freebsd-12">Plataforma Google Cloud</link>, para executar em seus respectivos serviços de hospedagem. Para obter maiores informações sobre como implantar o FreeBSD no Azure, consulte o capítulo relevante na <link xlink:href="https://docs.microsoft.com/en-us/azure/virtual-machines/linux/freebsd-intro-on-azure">Documentação do Azure</link>.</para>
      </listitem>

      <listitem>
	<para>Imagens de cartão SD, para sistemas embarcados, como Raspberry Pi ou BeagleBone Black. Eles podem ser baixados da página de <link xlink:href="https://www.freebsd.org/where.html">Download do FreeBSD</link>. Esses arquivos devem ser descompactados e gravados como uma imagem bruta para um cartão SD, a partir do qual a placa será inicializada.</para>
      </listitem>

      <listitem>
	<para>Imagens de instalação, para instalar o FreeBSD no disco rígido de um desktop padrão, laptop ou servidor.</para>
      </listitem>
    </itemizedlist>

    <para>O resto deste capítulo descreve o quarto caso, explicando como instalar o FreeBSD usando o programa de instalação baseado em texto chamado <application>bsdinstall</application>.</para>

    <para>Em geral, as instruções de instalação neste capítulo foram escritas para as arquiteturas <trademark>i386</trademark> e <acronym>AMD64</acronym>. Onde aplicável, instruções específicas para outras plataformas serão listadas. Pode haver pequenas diferenças entre o instalador e o que é mostrado aqui, portanto, use este capítulo como um guia geral, e não como um conjunto de instruções literais.</para>

    <note><para>Usuários que preferem instalar o FreeBSD usando uma instaldor gráfico talvez possam se interessar no <link xlink:href="https://www.furybsd.org">FuryBSD</link>, <link xlink:href="https://ghostbsd.org">GhostBSD</link> ou <link xlink:href="https://www.midnightbsd.org">MidnightBSD</link>.</para>
    </note>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>Quais os requisitos mínimos de hardware e as arquiteturas suportadas pelo FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como criar a mídia de instalação do FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como iniciar o <application>bsdinstall</application>.</para>
      </listitem>

      <listitem>
	<para>As perguntas que o <application>bsdinstall</application> fará, o que elas significam e como respondê-las.</para>
      </listitem>

      <listitem>
	<para>Como solucionar problemas de uma instalação com falha.</para>
      </listitem>

      <listitem>
	<para>Como acessar uma versão live do FreeBSD antes de se comprometer com uma instalação.</para>
      </listitem>
    </itemizedlist>

    <para>Antes de ler este capítulo, você deve:</para>

    <itemizedlist>
      <listitem>
	<para>Ler a lista de hardware suportado que acompanha a versão do FreeBSD que será instalada e verificar se o hardware do sistema é suportado.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="bsdinstall-hardware">
    <title>Requisitos mínimos de hardware</title>

    <para>Os requisitos de hardware para instalar o FreeBSD variam por arquitetura. Arquiteturas de hardware e dispositivos suportados por uma release do FreeBSD estão listados na página <link xlink:href="@@URL_RELPREFIX@@/releases/index.html">Informação de Release do FreeBSD</link>. A <link xlink:href="@@URL_RELPREFIX@@/where.html">página de download do FreeBSD</link> também tem recomendações para escolha a imagem correta para as diferentes arquiteturas.</para>

    <para>Uma instalação do FreeBSD requer um mínimo de 96 MB de <acronym>RAM</acronym> e 1,5 GB de espaço livre no disco rígido. No entanto, essas pequenas quantidades de memória e espaço em disco são realmente adequadas apenas para aplicativos personalizados, como dispositivos embarcados. Os sistemas de desktop de uso geral precisam de mais recursos. De 2 a 4 GB de RAM e pelo menos 8 GB de espaço no disco rígido é um bom ponto de partida.</para>

    <para>Estes são os requisitos do processador para cada arquitetura:</para>

    <variablelist>
      <varlistentry>
	<term>amd64</term>
	<listitem>
	  <para>Esse é o tipo de processador de desktop e laptop mais comum, usado na maioria dos sistemas modernos. A <trademark class="registered">Intel </trademark> chama ele de <acronym>Intel64</acronym>. Outros fabricantes às vezes o chamam de <acronym>x86-64</acronym>.</para>

	  <para>Exemplos de processadores compatíveis com AMD64 incluem: <trademark>AMD Athlon</trademark> 64, <trademark>AMD Opteron</trademark>, multi-core <trademark class="registered">Intel</trademark> <trademark>Xeon</trademark> e processadores <trademark class="registered">Intel</trademark> <trademark>Core</trademark> 2 e posteriores.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>i386</term>
	<listitem>
	  <para>Desktops e laptops mais antigos geralmente usam essa arquitetura x86 de 32 bits.</para>

	  <para>Quase todos os processadores compatíveis com i386 com uma unidade de ponto flutuante são suportados. Todos os processadores <trademark class="registered">Intel</trademark> 486 ou superior são suportados.</para>

	  <para>O FreeBSD irá aproveitar o suporte a Extensões de Endereços Físicos (<acronym>PAE</acronym>) em <acronym>CPU</acronym>s com este recurso. Um kernel com o recurso <acronym>PAE</acronym> ativado detectará memória acima de 4 GB e permitirá que ela seja usada pelo sistema. No entanto, o uso do <acronym>PAE</acronym> coloca restrições em drivers de dispositivos e outros recursos do FreeBSD.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>powerpc</term>
	<listitem>
	  <para>Todos os sistemas New World <acronym>ROM</acronym> <trademark class="registered">Apple</trademark> <trademark class="registered">Mac</trademark> com <acronym>USB</acronym> incorporados são suportados. O <acronym>SMP</acronym> é suportado em máquinas com vários <acronym>CPU</acronym>s.</para>

	  <para>Um kernel de 32 bits só pode usar os primeiros 2 GB de <acronym>RAM</acronym>.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>sparc64</term>
	<listitem>
	  <para>Os sistemas suportados pelo FreeBSD/sparc64 estão listados no <link xlink:href="@@URL_RELPREFIX@@/platforms/sparc.html">Projeto FreeBSD/sparc64</link>.</para>

	  <para>O <acronym>SMP</acronym> é suportado em todos os sistemas com mais de 1 processador. Um disco dedicado é necessário, pois não é possível compartilhar um disco com outro sistema operacional neste momento.</para>
	</listitem>
      </varlistentry>
    </variablelist>
  </sect1>

  <sect1 xml:id="bsdinstall-pre">
    <title>Tarefas de Pré-instalação</title>

    <para>Uma vez determinado que o sistema atende aos requisitos mínimos de hardware para instalar o FreeBSD, o arquivo de instalação deve ser baixado e a mídia de instalação preparada. Antes de fazer isso, verifique se o sistema está pronto para uma instalação, verificando os itens nesta lista de controle:</para>

    <procedure>
      <step>
	<title>Faça backup dos dados importantes</title>

	<para>Antes de instalar qualquer sistema operacional, <emphasis>sempre</emphasis> faça backup de todos os dados importantes primeiro. Não armazene o backup no sistema que está sendo instalado. Em vez disso, salve os dados em um disco removível, como uma unidade <acronym>USB</acronym>, outro sistema na rede ou um serviço de backup online. Teste o backup antes de iniciar a instalação para garantir que ele contenha todos os arquivos necessários. Depois que o instalador formatar o disco do sistema, todos os dados armazenados nesse disco serão perdidos.</para>
      </step>

      <step>
	<title>Decida onde instalar o FreeBSD</title>

	<para>Se o FreeBSD for o único sistema operacional instalado, esta etapa pode ser ignorada. Mas se o FreeBSD compartilhar o disco com outro sistema operacional, decida qual disco ou partição será usado para o FreeBSD.</para>

	<para>Nas arquiteturas i386 e amd64, os discos podem ser divididos em várias partições usando um dos dois esquemas de particionamento. Um <firstterm>registro de inicialização mestre</firstterm> tradicional (<acronym>MBR</acronym>) contém uma tabela de partição que define até quatro <firstterm>partições primárias</firstterm>. Por razões históricas, o FreeBSD chama essas partições primárias de <firstterm>slices</firstterm>. Uma dessas partições primárias pode ser transformada em uma <firstterm>partição estendida</firstterm> contendo várias <firstterm>partições lógicas</firstterm>. A <firstterm>Tabela de Partição GUID</firstterm> (<acronym>GPT</acronym>) é um método mais novo e mais simples de particionar um disco. Implementações comuns de <acronym>GPT</acronym> permitem até 128 partições por disco, eliminando a necessidade de partições lógicas.</para>

	<para>O boot loader do FreeBSD requer uma partição primária ou <acronym>GPT</acronym>. Se todas as partições primárias ou <acronym>GPT</acronym> já estiverem em uso, uma deve ser liberada para o FreeBSD. Para criar uma partição sem excluir dados existentes, use uma ferramenta de redimensionamento de partição para reduzir uma partição existente e criar uma nova partição usando o espaço liberado.</para>

	<para>Uma variedade de ferramentas de redimensionamento de partições comerciais e gratuitas estão listadas em <link xlink:href="http://en.wikipedia.org/wiki/List_of_disk_partitioning_software"> http://en.wikipedia.org/wiki/List_of_disk_partitioning_software</link>. O <application>GParted Live</application> (<link xlink:href="http://gparted.sourceforge.net/livecd.php">http://gparted.sourceforge.net/livecd.php</link>) é um live <acronym>CD</acronym> que inclui o editor de partições <application>GParted</application>. O <application>GParted</application> também está incluído em muitas outras distribuições live <acronym>CD</acronym> do Linux.</para>

	<warning>
	  <para>Quando usados corretamente, os utilitários de encolhimento de disco podem criar espaço com segurança para criar uma nova partição. Como existe a possibilidade de selecionar a partição errada, sempre faça backup de todos os dados importantes e verifique a integridade do backup antes de modificar as partições do disco.</para>
	</warning>

	<para>Partições de disco contendo diferentes sistemas operacionais tornam possível instalar vários sistemas operacionais em um computador. Uma alternativa é usar virtualização (<xref linkend="virtualization"/>) o que permite que vários sistemas operacionais sejam executados ao mesmo tempo sem modificar nenhuma partição de disco.</para>
      </step>

      <step>
	<title>Colete informações de rede</title>

	<para>Alguns métodos de instalação do FreeBSD requerem uma conexão de rede para baixar os arquivos de instalação. Após qualquer instalação, o instalador oferecerá a configuração das interfaces de rede do sistema.</para>

	<para>Se a rede tiver um servidor <acronym>DHCP</acronym>, ele poderá ser usado para fornecer configuração de rede automática. Se o <acronym>DHCP</acronym> não estiver disponível, as seguintes informações de rede para o sistema devem ser obtidas com o administrador de rede local ou com o provedor de serviços de Internet:</para>

	<orderedlist xml:id="bsdinstall-collect-network-information">
	  <title>Informações de rede necessárias</title>

	  <listitem>
	    <para>Endereço <acronym>IP</acronym></para>
	  </listitem>

	  <listitem>
	    <para>Máscara de sub-rede</para>
	  </listitem>

	  <listitem>
	    <para>Endereço do <acronym>IP</acronym> do gateway padrão</para>
	  </listitem>

	  <listitem>
	    <para>Nome de domínio da rede</para>
	  </listitem>

	  <listitem>
	    <para>Endereços <acronym>IP</acronym> dos servidores <acronym>DNS</acronym> da rede</para>
	  </listitem>
	</orderedlist>
      </step>

      <step>
	<title>Verifique a Errata do FreeBSD</title>

	<para>Embora o Projeto FreeBSD se esforce para garantir que cada versão do FreeBSD seja o mais estável possível, ocasionalmente, os bugs aparecem no processo. Em raras ocasiões, esses erros afetam o processo de instalação. A medida que esses problemas são descobertos e corrigidos, eles são anotados na Errata do FreeBSD (<link xlink:href="@@URL_RELPREFIX@@/releases/12.1R/errata.html">https://www.freebsd.org/releases/12.1R/errata.html</link>) no site do FreeBSD. Verifique a errata antes de instalar para certificar-se de que não existem problemas que possam afetar a instalação.</para>

	<para>Informações e erratas para todos os releases podem ser encontradas na seção de informações de release do site do FreeBSD (<link xlink:href="@@URL_RELPREFIX@@/releases/index.html">https://www.freebsd.org /releases/index.html</link>).</para>
      </step>
    </procedure>

    <sect2 xml:id="bsdinstall-installation-media">
      <title>Prepare a mídia de instalação</title>

      <para>O instalador do FreeBSD não é um aplicativo que pode ser executado dentro de outro sistema operacional. Em vez disso, baixe um arquivo de instalação do FreeBSD, grave-o na mídia associada ao seu tipo e tamanho (<acronym>CD</acronym>, <acronym>DVD</acronym>, ou <acronym>USB</acronym>), e inicialize o sistema para instalar a partir da mídia inserida.</para>

      <para>Os arquivos de instalação do FreeBSD estão disponíveis em <link xlink:href="@@URL_RELPREFIX@@/where.html#download"> www.freebsd.org/where.html#download</link>. O nome de cada arquivo de instalação inclui a versão de Release do FreeBSD, a arquitetura e o tipo de arquivo. Por exemplo, para instalar o FreeBSD 12.1 em um sistema amd64 de um <acronym>DVD</acronym>, baixe o <filename>FreeBSD-12.1-RELEASE-amd64-dvd1.iso</filename>, grave este arquivo em um <acronym>DVD</acronym>, e inicialize o sistema com o <acronym>DVD</acronym> inserido.</para>

      <para>Os arquivos de instalação estão disponíveis em vários formatos. Os formatos variam dependendo da arquitetura do computador e do tipo de mídia.</para>

      <para xml:id="bsdinstall-installation-media-uefi">Arquivos de instalação adicionais são incluídos para computadores que inicializam com <acronym>UEFI</acronym> (Interface de Firmware Extensível Unificada). Os nomes desses arquivos incluem a string <filename>uefi</filename>.</para>

      <para>Tipos de arquivo:</para>

      <itemizedlist>
	<listitem>
	  <para><literal>-bootonly.iso</literal>: Este é o menor arquivo de instalação, pois contém apenas o instalador. É necessária uma conexão de Internet em funcionamento durante a instalação, pois o instalador fará o download dos arquivos necessários para concluir a instalação do FreeBSD. Este arquivo deve ser gravado em um <acronym>CD</acronym> usando um aplicativo de gravação <acronym>CD</acronym>.</para>
	</listitem>

	<listitem>
	  <para><literal>-disc1.iso</literal>: Este arquivo contém todos os arquivos necessários para instalar o FreeBSD, seu código-fonte e a coleção de ports. Ele deve ser gravado em um <acronym>CD</acronym> usando um aplicativo de gravação <acronym>CD</acronym>.</para>
	</listitem>

	<listitem>
	  <para><literal>-dvd1.iso</literal>: Este arquivo contém todos os arquivos necessários para instalar o FreeBSD, seu código-fonte e a coleção de ports. Ele também contém um conjunto de pacotes binários populares para instalar um gerenciador de janelas e alguns aplicativos para que um sistema completo possa ser instalado a partir da mídia sem a necessidade de uma conexão com a Internet. Este arquivo deve ser gravado em um <acronym>DVD</acronym> usando um aplicativo de gravação <acronym>DVD</acronym>.</para>
	</listitem>

	<listitem>
	  <para><literal>-memstick.img</literal>: Este arquivo contém todos os arquivos necessários para instalar o FreeBSD, seu código-fonte e a coleção de ports. Ele deve ser gravado em um pendrive <acronym>USB</acronym> usando as instruções abaixo.</para>
	</listitem>

	<listitem>
	  <para><literal>-mini-memstick.img</literal>: Como <literal> -bootonly.iso </literal>, não inclui arquivos de instalação, mas faz o download conforme necessário. É necessária uma conexão de internet em funcionamento durante a instalação. Grave este arquivo para um pendrive <acronym>USB</acronym> como mostrado em <xref linkend="bsdinstall-usb"/>.</para>
	</listitem>
      </itemizedlist>

      <para>Depois de baixar o arquivo de imagem, baixe o <filename>CHECKSUM.SHA256</filename> do mesmo diretório. Calcule o <firstterm>checksum</firstterm> para o arquivo de imagem. O FreeBSD fornece o <citerefentry><refentrytitle>sha256</refentrytitle><manvolnum>1</manvolnum></citerefentry> para isso, usado como <command>sha256 <replaceable>imagefilename</replaceable></command>. Outros sistemas operacionais possuem programas semelhantes.</para>

      <para>Compare o checksum calculado com a mostrado em <filename>CHECKSUM.SHA256</filename>. Os checksum  devem corresponder exatamente. Se os checksums não corresponderem, o arquivo de imagem está corrompido e deve ser baixado novamente.</para>

      <sect3 xml:id="bsdinstall-usb">
	<title>Gravando um arquivo de imagem para um pendrive <acronym>USB</acronym></title>

	<para>O arquivo <filename>*. Img</filename> é uma <emphasis>imagem</emphasis> do conteúdo completo de um cartão de memória. Ele <emphasis>não pode</emphasis> ser copiado para o dispositivo de destino como um arquivo. Várias aplicações estão disponíveis para escrever o <filename>*. Img</filename> para um pendrive <acronym>USB</acronym>. Esta seção descreve dois destes utilitários.</para>

	<important>
	  <para>Antes de continuar, faça backup de todos os dados importantes do pendrive <acronym>USB</acronym>. Este procedimento irá apagar todos os dados existentes no mesmo.</para>
	</important>

	<procedure xml:id="bsdinstall-usb-dd">
	  <title>Usando o <command>dd</command> para gravar a imagem</title>

	  <warning>
	    <para>Este exemplo usa <filename>/dev/da0</filename> como o dispositivo de destino em que a imagem será gravada. Seja <emphasis>muito cuidadoso</emphasis> para que o dispositivo correto seja usado, pois esse comando destruirá os dados existentes no dispositivo de destino especificado.</para>
	  </warning>

	  <step>
	    <para>O utilitário de linha de comando <citerefentry><refentrytitle>dd</refentrytitle><manvolnum>1</manvolnum></citerefentry> está disponível no BSD, no <trademark class="registered">Linux</trademark> e no <trademark class="registered">Mac OS</trademark>. Para gravar a imagem usando o <command>dd</command>, insira o pendrive <acronym>USB</acronym> e determine o nome do dispositivo. Em seguida, especifique o nome do arquivo de instalação baixado e o nome do dispositivo para o pendrive <acronym>USB</acronym>. Este exemplo grava a imagem de instalação amd64 no primeiro dispositivo <acronym>USB</acronym> em um sistema FreeBSD existente.</para>

	    <screen><prompt>#</prompt> <userinput>dd if=<replaceable>FreeBSD-12.1-RELEASE-amd64-memstick.img</replaceable> of=/dev/<replaceable>da0</replaceable> bs=1M conv=sync</userinput></screen>

	    <para>Se este comando falhar, verifique se o pendrive <acronym>USB</acronym> não está montado e se o nome do dispositivo aponta para o disco, não para uma partição. Alguns sistemas operacionais podem requerer que este comando seja executado com o <citerefentry><refentrytitle>sudo</refentrytitle><manvolnum>8</manvolnum></citerefentry>. A sintaxe do <citerefentry><refentrytitle>dd</refentrytitle><manvolnum>1</manvolnum></citerefentry> varia ligeiramente em diferentes plataformas; por exemplo, o <trademark class="registered">Mac OS</trademark> requer um <option>bs=1m</option> em minúsculas. Sistemas como o <trademark class="registered">Linux</trademark> podem gravar em buffer. Para forçar todas as gravações a serem concluídas, use o comando <citerefentry><refentrytitle>sync</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
	  </step>
	</procedure>

	<procedure>
	  <title>Usando o <trademark class="registered">Windows</trademark> para gravar a imagem</title>

	  <warning>
	    <para>Certifique-se de fornecer a letra da unidade correta, pois os dados existentes na unidade especificada serão sobrescritos e destruídos.</para>
	  </warning>

	  <step>
	    <title>Obtendo o <application>Image Writer para <trademark class="registered">Windows</trademark></application></title>

	    <para>O <application>Image Writer para <trademark class="registered">Windows</trademark></application> é um aplicativo gratuito que pode gravar corretamente um arquivo de imagem em um cartão de memória. Faça o download a partir de <uri xlink:href="https://sourceforge.net/projects/win32diskimager/">https://sourceforge.net/projects/win32diskimager/</uri> e extraia-o em uma pasta.</para>
	  </step>

	  <step>
	    <title>Escrevendo a imagem com o Image Writer</title>

	    <para>Clique duas vezes no ícone <application>Win32DiskImager</application> para iniciar o programa. Verifique se a letra da unidade mostrada em <computeroutput>Device</computeroutput> é a unidade com o cartão de memória. Clique no ícone da pasta e selecione a imagem a ser gravada no cartão de memória. Clique em <guibutton>[ Save ]</guibutton> para aceitar o nome do arquivo de imagem. Verifique se tudo está correto e se nenhuma pasta do cartão de memória está aberta em outras janelas. Quando tudo estiver pronto, clique em <guibutton>[ Write ]</guibutton> para gravar o arquivo de imagem no cartão de memória.</para>
	  </step>
	</procedure>

	<para>Agora você está pronto para começar a instalar o FreeBSD.</para>
      </sect3>
    </sect2>
  </sect1>

  <sect1 xml:id="bsdinstall-start">
    <title>Iniciando a instalação</title>

    <important>
      <para>Por padrão, a instalação não fará alterações no(s) disco(s) antes da seguinte mensagem:</para>

      <programlisting>Your changes will now be written to disk. If you
have chosen to overwrite existing data, it will
be PERMANENTLY ERASED. Are you sure you want to
commit your changes?</programlisting>

      <para>A instalação pode ser encerrada a qualquer momento antes deste aviso. Se houver uma preocupação de que algo esteja configurado incorretamente, basta desligar o computador antes desse ponto e nenhuma alteração será feita nos discos do sistema.</para>
    </important>

    <para>Esta seção descreve como inicializar o sistema a partir da mídia de instalação que foi preparada usando as instruções em <xref linkend="bsdinstall-installation-media"/>. Ao usar um dispositivo USB inicializável, conecte o dispositivo <acronym>USB</acronym> antes de ligar o computador. Ao inicializar a partir do <acronym>CD</acronym> ou do <acronym>DVD</acronym>, ligue o computador e insira a mídia na primeira oportunidade. O procedimento para configurar o sistema para inicializar a partir da mídia inserida depende da arquitetura.</para>

    <sect2 xml:id="bsdinstall-starting-i386">
      <title>Inicializando em <trademark>i386</trademark> e amd64</title>

      <para>Estas arquiteturas fornecem um menu <acronym>BIOS</acronym> para selecionar o dispositivo de inicialização. Dependendo da mídia de instalação usada, selecione o dispositivo de <acronym>CD</acronym>/<acronym>DVD</acronym> ou o <acronym>USB</acronym> como o primeiro dispositivo de inicialização. A maioria dos sistemas também fornece uma chave para selecionar o dispositivo durante a inicialização sem ter que entrar no <acronym>BIOS</acronym>. Normalmente, a chave é <keycap>F10</keycap>, <keycap>F11</keycap>, <keycap>F12</keycap> ou <keycap>Escape</keycap>.</para>

      <para>Se o computador carregar o sistema operacional existente em vez do instalador do FreeBSD, então:</para>

      <orderedlist>
	<listitem>
	  <para>A mídia de instalação não foi inserida cedo o suficiente no processo de inicialização. Deixe a mídia inserida e tente reiniciar o computador.</para>
	</listitem>

	<listitem>
	  <para>As alterações do <acronym>BIOS</acronym> estavam incorretas ou não foram salvas. Verifique novamente se o dispositivo de inicialização correto está selecionado como o primeiro dispositivo de inicialização.</para>
	</listitem>

	<listitem>
	  <para>Este sistema é muito antigo para suportar a inicialização a partir da mídia escolhida. Neste caso, o <application>Plop Boot Manager</application> (<link xlink:href="http://www.plop.at/en/bootmanagers.html"/>)  pode ser usado para inicializar o sistema a partir da mídia selecionada.</para>
	</listitem>
      </orderedlist>
    </sect2>

    <sect2>
      <title>Inicializando no <trademark class="registered">PowerPC</trademark></title>

      <para>Na maioria das máquinas, manter pressionado o <keycap>C</keycap> no teclado durante a inicialização irá inicializar a partir do <acronym>CD</acronym>. Caso contrário, mantenha pressionados <keycombo action="simul"> <keycap>Command</keycap> <keycap>Option</keycap> <keycap>O</keycap> <keycap>F</keycap> </keycombo>, ou <keycombo action="simul"> <keycap>Windows</keycap> <keycap>Alt</keycap> <keycap>O</keycap> <keycap>F</keycap> </keycombo> em teclados não-<trademark class="registered">Apple</trademark>. No prompt <prompt>0 &gt;</prompt>, digite</para>

      <screen><userinput>boot cd:,\ppc\loader cd:0</userinput></screen>
    </sect2>

    <sect2 xml:id="bsdinstall-view-probe">
      <title>Menu de inicialização do FreeBSD</title>

      <para>Quando o sistema inicializar a partir da mídia de instalação, um menu semelhante ao seguinte será exibido:</para>

      <figure xml:id="bsdinstall-newboot-loader-menu">
	<title>Menu do FreeBSD Boot Loader</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-newboot-loader-menu"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Por padrão, o menu irá esperar dez segundos por uma ação do usuário antes de inicializar no instalador do FreeBSD ou, se o FreeBSD já estiver instalado, antes de inicializar no FreeBSD. Para pausar o cronômetro de inicialização para rever as seleções, pressione <keycap>Espaço</keycap>. Para selecionar uma opção, pressione seu número, caractere ou tecla destacada. As seguintes opções estão disponíveis.</para>

      <itemizedlist>
	<listitem>
	  <para><literal>Boot Multi User</literal>: Isto irá continuar o processo de inicialização do FreeBSD. Se o temporizador de boot tiver sido pausado, pressione <keycap>1</keycap>, <keycap>B</keycap> maiúsculo ou minúsculo ou <keycap>Enter</keycap>.</para>
	</listitem>

	<listitem>
	  <para><literal>Boot Single User</literal>: Este modo pode ser usado para corrigir uma instalação existente do FreeBSD como descrito em <xref linkend="boot-singleuser"/>. Pressione <keycap>2</keycap> ou <keycap>S</keycap> maiúsculo ou minúsculo para entrar neste modo.</para>
	</listitem>

	<listitem>
	  <para><literal>Escape to loader prompt</literal>: Isso inicializará o sistema em um prompt de reparo que contém um número limitado de comandos de baixo nível. Este prompt é descrito em <xref linkend="boot-loader"/>. Pressione <keycap>3</keycap> ou <keycap>Esc</keycap> para inicializar neste prompt.</para>
	</listitem>

	<listitem>
	  <para><literal>Reboot</literal>: Reinicia o sistema.</para>
	</listitem>

        <listitem>
          <para><literal>Kernel</literal>: Carrega um kernel diferente.</para>
        </listitem>

	<listitem>
	  <para><literal>Configure Boot Options</literal>: Abre o menu mostrado e descrito em <xref linkend="bsdinstall-boot-options-menu"/>.</para>
	</listitem>
      </itemizedlist>

      <figure xml:id="bsdinstall-boot-options-menu">
	<title>Menu de Opções de Inicialização do FreeBSD</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-boot-options-menu"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>O menu de opções de inicialização é dividido em duas seções. A primeira seção pode ser usada para retornar ao menu de inicialização principal ou para redefinir quaisquer opções que tenham sido alteradas de volta para seus valores padrões.</para>

      <para>A próxima seção é usada para alternar as opções disponíveis para <literal>On</literal> ou <literal>Off</literal> pressionando o número ou caractere realçado da opção. O sistema sempre inicializará usando as configurações dessas opções até serem modificadas. Várias opções podem ser alternadas usando este menu:</para>

      <itemizedlist>
	<listitem>
	  <para><literal>ACPI Support</literal>: Se o sistema travar durante a inicialização, tente alternar essa opção para <literal>Off</literal>.</para>
	</listitem>

	<listitem>
	  <para><literal>Safe Mode</literal>: Se o sistema ainda travar durante a inicialização, mesmo com <literal>Suporte a ACPI</literal> definido como <literal>Off</literal>, tente definir esta opção como <literal>On</literal>.</para>
	</listitem>

	<listitem>
	  <para><literal>Single User</literal>: Alterne esta opção para <literal>On</literal> para corrigir uma instalação existente do FreeBSD como descrito em <xref linkend="boot-singleuser"/>. Depois que o problema for corrigido, configure-o de volta para <literal>Off</literal>.</para>
	</listitem>

	<listitem>
	  <para><literal>Verbose</literal>: Alterne esta opção para <literal>On</literal> para ver mensagens mais detalhadas durante o processo de inicialização. Isso pode ser útil ao solucionar problemas de hardware.</para>
	</listitem>
      </itemizedlist>

      <para>Depois de fazer as seleções necessárias, pressione <keycap>1</keycap> ou <keycap>Backspace</keycap> para retornar ao menu de boot principal, então pressione <keycap>Enter</keycap> para continuar a inicialização no FreeBSD. Uma série de mensagens de inicialização irão aparecer enquanto o FreeBSD executa seus testes de dispositivos de hardware e carrega o programa de instalação. Quando a inicialização estiver concluída, o menu de boas-vindas mostrado em <xref linkend="bsdinstall-choose-mode"/> será exibido.</para>

      <figure xml:id="bsdinstall-choose-mode">
	<title>Menu de boas-vindas</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-choose-mode"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Pressione <keycap>Enter</keycap> para selecionar o padrão de <guibutton>[Install]</guibutton> para entrar no instalador. O restante deste capítulo descreve como usar este instalador. Caso contrário, use as setas para a direita ou para a esquerda ou a letra colorida para selecionar o item de menu desejado. A opção <guibutton>[Shell]</guibutton> pode ser usada para acessar um shell do FreeBSD, a fim de usar utilitários de linha de comando para preparar os discos antes da instalação. A opção <guibutton>[Live CD]</guibutton> pode ser usada para testar o FreeBSD antes de instalá-lo. A versão live é descrita em <xref linkend="using-live-cd"/>.</para>

      <tip>
	<para>Para revisar as mensagens de inicialização, incluindo o probe do dispositivo de hardware, pressione a tecla <keycap>S</keycap> maiúscula ou minúscula  e, em seguida, <keycap>Enter</keycap> para acessar um shell. No prompt do shell, digite <command>more /var/run/dmesg.boot</command> e use a barra de espaço para rolar pelas mensagens. Quando terminar, digite <command>exit</command> para retornar ao menu de boas-vindas.</para>
      </tip>
    </sect2>
  </sect1>

  <sect1 xml:id="using-bsdinstall">
    <title>Usando o <application>bsdinstall</application></title>

    <para>Esta seção mostra a ordem dos menus do <application>bsdinstall</application> e o tipo de informação que será  solicitada antes que o sistema seja instalado. Use as teclas de seta para realçar uma opção de menu e, em seguida, a barra de <keycap>Espaço</keycap> para selecionar ou desmarcar esse item de menu. Quando terminar, pressione <keycap>Enter</keycap> para salvar a seleção e passar para a próxima tela.</para>

    <sect2 xml:id="bsdinstall-keymap">
      <title>Selecionando o menu do Keymap (Mapa de teclas)</title>

      <para>Antes de iniciar o processo, o <application>bsdinstall</application> carregará os arquivos de keymap como mostrado em <xref linkend="bsdinstall-keymap-loading"/>.</para>

      <figure xml:id="bsdinstall-keymap-loading">
	<title>Carregamento de Keymap</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-keymap-loading"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Após o carregamento dos keymaps, o <application>bsdinstall</application> exibe o menu mostrado em <xref linkend="bsdinstall-keymap-10"/>. Use as setas para cima e para baixo para selecionar o mapa de teclas que mais representa o mapeamento do teclado conectado ao sistema. Pressione <keycap>Enter</keycap> para salvar a seleção.</para>

      <figure xml:id="bsdinstall-keymap-10">
	<title>Menu de Seleção do Keymap</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-keymap-10"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <note><para>Pressionar <keycap>Esc</keycap> sairá deste menu e usará o mapa de teclas padrão. Se a escolha do mapa de teclado não for clara, a opção <guimenuitem>United States of America ISO-8859-1</guimenuitem> é uma opção segura.</para></note>

      <para>Além disso, ao selecionar um keymap diferente, o usuário pode testar o keymap e garantir que esteja correto antes de continuar, conforme mostrado em <xref linkend="bsdinstall-keymap-testing"/>.</para>

      <figure xml:id="bsdinstall-keymap-testing">
	<title>Menu de Teste do Keymap</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-keymap-testing"/>
	  </imageobject>
	</mediaobject>
      </figure>

    </sect2>

    <sect2 xml:id="bsdinstall-hostname">
      <title>Configurando o nome do host</title>

      <para>O próximo menu do <application>bsdinstall</application> é usado para definir o nome do host para o sistema recém-instalado.</para>

      <figure xml:id="bsdinstall-config-hostname">
	<title>Configurando o nome do host</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-config-hostname"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Digite um nome de host exclusivo para a rede. Ele deve ser um nome de host totalmente qualificado, como <systemitem class="fqdomainname">machine3.example.com</systemitem>.</para>
    </sect2>

    <sect2 xml:id="bsdinstall-components">
      <title>Selecionando Componentes para Instalar</title>

      <para>Em seguida, o <application>bsdinstall</application> solicitará a seleção de componentes opcionais para instalação.</para>

      <figure xml:id="bsdinstall-config-components">
	<title>Selecionando Componentes para Instalar</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-config-components"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Decidir quais componentes instalar dependerá em grande parte do uso pretendido para o sistema e da quantidade de espaço em disco disponível. O kernel do FreeBSD e o userland, coletivamente conhecidos como o <firstterm>sistema base</firstterm>, são sempre instalados. Dependendo da arquitetura, alguns desses componentes podem não aparecer:</para>

      <itemizedlist>
	<listitem>
	  <para><literal>base-dbg</literal> - Ferramentas básicas como <application>cat</application>, <application>ls</application> entre outras com símbolos de depuração ativados.</para>
	</listitem>

	<listitem>
	  <para><literal>kernel-dbg</literal> - Kernel e módulos com símbolos de depuração ativados.</para>
	</listitem>

	<listitem>
	  <para><literal>lib32-dbg</literal> - Bibliotecas de compatibilidade para executar aplicativos de 32 bits em uma versão de 64 bits do FreeBSD com símbolos de depuração ativados.</para>
	</listitem>

	<listitem>
	  <para><literal>lib32</literal> - Bibliotecas de compatibilidade para executar aplicativos de 32 bits em uma versão de 64 bits do FreeBSD.</para>
	</listitem>

	<listitem>
	  <para><literal>ports</literal> - A Coleção de Ports do FreeBSD é uma coleção de arquivos que automatiza o download, a compilação e a instalação de pacotes de software de terceiros. <xref linkend="ports"/> discute como usar a coleção de ports.</para>

	  <warning>
	    <para>O programa de instalação não verifica o espaço em disco adequado. Selecione esta opção apenas se houver espaço suficiente no disco rígido. A Coleção de Ports do FreeBSD ocupa cerca de 500 MB de espaço em disco.</para>
	  </warning>
	</listitem>

	<listitem>
	  <para><literal>src</literal> - O código-fonte completo do FreeBSD para o kernel e para o userland. Embora não seja necessário para a maioria dos aplicativos, pode ser necessário para compilar drivers de dispositivo, módulos do kernel ou alguns aplicativos da Coleção de Ports. Ele também é usado para desenvolver o próprio FreeBSD. A árvore de código-fonte completa requer 1 GB de espaço em disco e a recompilação de todo o sistema FreeBSD requer 5 GB adicionais de espaço.</para>
	</listitem>

	<listitem>
	  <para><literal>tests</literal> - FreeBSD Test Suite.</para>
	</listitem>
      </itemizedlist>
    </sect2>

    <sect2 xml:id="bsdinstall-netinstall">
      <title>Instalando a partir da rede</title>

      <para>O menu mostrado em <xref linkend="bsdinstall-netinstall-notify"/> apenas aparece ao instalar a partir de um <filename>-bootonly.iso</filename> ou <filename>-mini-memstick.img</filename> pois esta mídia de instalação não possui cópias dos arquivos de instalação. Como os arquivos de instalação devem ser recuperados através de uma conexão de rede, esse menu indica que a interface de rede deve ser configurada primeiro. Se o menu é exibido em qualquer etapa do processo lembre-se de seguir as instruções em <xref linkend="bsdinstall-config-network-dev"/>.</para>

      <figure xml:id="bsdinstall-netinstall-notify">
	<title>Instalando a partir da rede</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-netinstall-files"/>
	  </imageobject>
	</mediaobject>
      </figure>
    </sect2>
  </sect1>

  <sect1 xml:id="bsdinstall-partitioning">
    <title>Alocando o espaço em disco</title>

    <para>O próximo menu é usado para determinar o método de alocação de espaço em disco. As opções disponíveis no menu dependem da versão do FreeBSD sendo instalada.</para>

    <figure xml:id="bsdinstall-zfs-partmenu">
      <title>Opções de Particionamento</title>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="bsdinstall/bsdinstall-zfs-partmenu"/>
	</imageobject>
      </mediaobject>
    </figure>

    <para><application>bsdinstall</application> fornece ao usuário quatro métodos para alocar espaço em disco:</para>

    <itemizedlist>
      <listitem>
	<para>O particionamento <literal>Auto (UFS)</literal> configura automaticamente as partições do disco usando o sistema de arquivos <literal>UFS</literal>.</para>
      </listitem>

      <listitem>
	<para>O particionamento <literal>Manual</literal> permite que usuários avançados criem partições personalizadas a partir das opções de menu.</para>
      </listitem>

      <listitem>
	<para><literal>Shell</literal> abre um prompt de shell no qual usuários avançados podem criar partições personalizadas usando utilitários de linha de comando como <citerefentry><refentrytitle>gpart</refentrytitle><manvolnum>8</manvolnum></citerefentry>, <citerefentry><refentrytitle>fdisk</refentrytitle><manvolnum>8</manvolnum></citerefentry>, e <citerefentry><refentrytitle>bsdlabel</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
      </listitem>

      <listitem>
	<para>O particionamento <literal>Auto (ZFS)</literal> cria um sistema root-on-ZFS com suporte opcional à criptografia GELI para <firstterm>boot environments</firstterm>.</para>
      </listitem>
    </itemizedlist>

    <para>Esta seção descreve o que considerar ao definir as partições de disco. Em seguida, demonstra como usar os diferentes métodos de particionamento.</para>

    <sect2 xml:id="configtuning-initial">
      <title>Criando o layout da partição</title>

      <indexterm><primary>partition layout</primary></indexterm>
      <indexterm><primary><filename>/etc</filename></primary></indexterm>
      <indexterm><primary><filename>/var</filename></primary></indexterm>
      <indexterm><primary><filename>/usr</filename></primary></indexterm>

      <para>Ao criar os sistemas de arquivos, lembre-se de que os discos rígidos transferem dados mais rapidamente das trilhas externas para as internas. Assim, sistemas de arquivos menores e mais acessados devem estar mais próximos da parte externa da unidade, enquanto partições maiores, como <filename>/usr</filename>, devem ser colocadas em direção às partes internas do disco. É uma boa idéia criar partições em uma ordem similar a: <filename>/</filename>, swap, <filename>/var</filename> e <filename>/usr</filename>.</para>

      <para>O tamanho da partição <filename>/var</filename> reflete o uso pretendido para a máquina. Esta partição é usada para armazenar caixas de correio, arquivos de log e spools de impressora. Caixas de correio e arquivos de log podem crescer até tamanhos inesperados, dependendo do número de usuários e de quanto tempo os arquivos de log são mantidos. Na média, a maioria dos usuários raramente precisa de mais do que cerca de um gigabyte de espaço livre em disco no <filename>/var</filename>.</para>

      <note>
	<para>Às vezes, é necessário muito espaço em disco no <filename>/var/tmp</filename>. Quando um novo software é instalado, as ferramentas de empacotamento extraem uma cópia temporária dos pacotes no <filename>/var/tmp</filename>. Grandes pacotes de software, como o <application>Firefox</application> ou <application>LibreOffice</application> podem ser difíceis de instalar se não houver espaço em disco suficiente no <filename>/var/tmp</filename>.</para>
      </note>

      <para>A partição <filename>/usr</filename> contém muitos dos arquivos que suportam o sistema, incluindo o a Coleção de Ports do FreeBSD e o código-fonte do sistema. Pelo menos 2 gigabytes de espaço são recomendados para esta partição.</para>

      <para>Ao selecionar os tamanhos das partições, lembre-se dos requisitos de espaço. Ficar sem espaço em uma partição enquanto mal usa outra pode ser um aborrecimento.</para>

      <indexterm><primary>swap sizing</primary></indexterm>
      <indexterm><primary>swap partition</primary></indexterm>

      <para>Como regra geral, a partição swap deve ter o dobro do tamanho da memória física (<acronym>RAM</acronym>). Sistemas com pouca memória <acronym>RAM</acronym> podem ter um melhor desempenho com mais swap. Configurar um swap pequeno pode levar a ineficiências no código de verificação de página da <acronym>VM</acronym> e pode criar problemas mais tarde, se mais memória for adicionada.</para>

      <para>Em sistemas maiores com vários discos <acronym>SCSI</acronym> ou vários discos <acronym>IDE</acronym> operando em diferentes controladoras, é recomendável que uma area de swap seja configurada em cada unidade, até quatro unidades. As partições de swap devem ter aproximadamente o mesmo tamanho. O kernel pode manipular tamanhos arbitrários, mas as estruturas internas de dados podem ser dimensionadas para 4 vezes a maior partição de swap. Manter as partições de swap próximas do mesmo tamanho permitirá que o kernel otimize o espaço de swap entre discos. Partições grandes de swap são uma coisa boa, mesmo se o swap não for muito usado. Pode ser mais fácil de se recuperar de um programa devorador de memória antes de ser forçado a reinicializar.</para>

      <para>Ao particionar adequadamente um sistema, a fragmentação introduzida nas partições menores e intensas em gravação não vai prejudicar as partições que são maioritariamente de leitura. Manter as partições com maior carga de gravação mais próximas da borda do disco aumentará o desempenho de <acronym>I/O</acronym> nas partições onde ela é mais necessária. Embora o desempenho de <acronym>I/O</acronym> nas partições maiores possa ser necessário, mudá-las mais para a borda do disco não levará a uma melhoria de desempenho significativa em relação à movimentação de <filename>/var</filename> para a borda.</para>
    </sect2>

    <sect2 xml:id="bsdinstall-part-guided">
      <title>Particionamento Guiado Usando UFS</title>

      <para>Quando este método é selecionado, um menu exibirá o(s) disco(s) disponível(s). Se vários discos estiverem conectados, escolha aquele em que o FreeBSD deve ser instalado.</para>

      <figure xml:id="bsdinstall-part-guided-disk">
	<title>Selecionando a partir de vários discos</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-part-guided-disk"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Depois que o disco é selecionado, o próximo menu solicita a instalação no disco inteiro ou a criação de uma partição usando o espaço livre. Se <guibutton>[ Entire Disk ]</guibutton> for escolhido, um layout de partição geral que preenche todo o disco é criado automaticamente. Selecionar <guibutton> [Partition] </guibutton> cria um layout de partição do espaço não utilizado no disco.</para>

      <figure xml:id="bsdinstall-part-entire-part">
	<title>Selecionando todo o disco ou partição</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-part-entire-part"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Após <guibutton>[ Entire Disk ]</guibutton> ser escolhido, <application>bsdinstall</application> exibe uma caixa de diálogo indicando que o disco será apagado.</para>

      <figure xml:id="bsdinstall-ufs-warning">
	<title>Confirmação</title>

        <mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-ufs-warning"/>
	  </imageobject>
        </mediaobject>
      </figure>

      <para>O próximo menu mostra uma lista com os tipos de esquema de partição. O <acronym>GPT</acronym> é geralmente a opção mais apropriada para computadores amd64. Computadores mais antigos que não são compatíveis com o GPT devem usar o MBR. Os outros esquemas de partição são geralmente usados para computadores incomuns ou antigos. Mais informações estão disponíveis em <xref linkend="partition-schemes"/>.</para>

      <figure xml:id="bsdinstall-ufs-scheme">
	<title>Selecionar Esquema de Particionamento</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-part-manual-partscheme"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Depois que o layout da partição tiver sido criado, revise-o para garantir que ele atenda às necessidades da instalação. Selecionar <guibutton>[ Revert ]</guibutton> redefinirá as partições para seus valores originais e pressionar <guibutton>[Auto]</guibutton> recriará as partições automáticas do FreeBSD. As partições também podem ser criadas, modificadas ou excluídas manualmente. Quando o particionamento estiver correto, selecione <guibutton>[Finish]</guibutton> para continuar com a instalação.</para>

      <figure xml:id="bsdinstall-part-review">
	<title>Revise as partições criadas</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-part-review"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Depois que os discos são configurados, o próximo menu fornece a última chance de fazer alterações antes que os discos selecionados sejam formatados. Se for necessário fazer alterações, selecione <guibutton>[Back]</guibutton> para retornar ao menu principal de particionamento. <guibutton>[ Revert &amp; Exit ]</guibutton> sairá do instalador sem fazer alterações no disco. Selecione <guibutton>[ Commit ]</guibutton> para iniciar o processo de instalação.</para>

      <figure xml:id="bsdinstall-ufs-final-confirmation">
	<title>Confirmação final</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-final-confirmation"/>
	  </imageobject>
	</mediaobject>
      </figure>

    <para>Para continuar com o processo de instalação, vá para <xref linkend="bsdinstall-fetching-distribution"/>.</para>
    </sect2>

    <sect2 xml:id="bsdinstall-part-manual">
      <title>Particionamento Manual</title>

      <para>Selecionar este método abre o editor de partições:</para>

      <figure xml:id="bsdinstall-part-manual-create">
	<title>Criar partições manualmente</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-part-manual-create"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Realce a unidade de instalação (<filename>ada0</filename> neste exemplo) e selecione <guibutton>[ Create ]</guibutton> para exibir um menu dos esquemas de partição disponíveis:</para>

      <figure xml:id="bsdinstall-part-manual-partscheme">
	<title>Criar partições manualmente</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-part-manual-partscheme"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>O <acronym>GPT</acronym> é geralmente a opção mais apropriada para computadores amd64. Computadores mais antigos que não são compatíveis com o <acronym>GPT</acronym> devem usar o <acronym>MBR</acronym>. Os outros esquemas de partição são geralmente usados para computadores incomuns ou antigos.</para>

      <table xml:id="partition-schemes" frame="none" rowsep="1" pgwide="1">
	<title>Esquemas de Particionamento</title>

	<tgroup cols="2" align="left">
	  <thead>
	    <row>
	      <entry align="left">Abreviação</entry>
	      <entry align="left">Descrição</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry>APM</entry>
	      <entry>Apple Partition Map, usado no <trademark class="registered">PowerPC</trademark>.</entry>
	    </row>

	    <row>
	      <entry>BSD</entry>
	      <entry>O Label <acronym>BSD</acronym> sem um <acronym>MBR</acronym>, às vezes chamado de <firstterm>modo perigosamente dedicado</firstterm> porque os utilitários de discos não <acronym>BSD</acronym> podem não reconhecê-lo.</entry>
	    </row>

	    <row>
	      <entry>GPT</entry>
	      <entry>Tabela de Partição GUID (<link xlink:href="http://en.wikipedia.org/wiki/GUID_Partition_Table"> http://en.wikipedia.org/wiki/GUID_Partition_Table </link>).</entry>
	    </row>

	    <row>
	      <entry>MBR</entry>
	      <entry>Registro mestre de inicialização ou MBR (<link xlink:href="http://en.wikipedia.org/wiki/Master_boot_record"> http://en.wikipedia.org/wiki/Master_boot_record </link>).</entry>
	    </row>

	    <row>
	      <entry>VTOC8</entry>
	      <entry>Tabela de Volume do Conteúdo usado pelos computadores Sun SPARC64 e UltraSPARC.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Depois que o esquema de particionamento for selecionado e criado, selecione <guibutton>[Create]</guibutton> novamente para criar as partições.A tecla <keycap>Tab</keycap> é utilizada para navegação entre os campos.</para>

      <figure xml:id="bsdinstall-part-manual-addpart">
	<title>Criar partições manualmente</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-part-manual-addpart"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Uma instalação padrão do FreeBSD <acronym>GPT</acronym> usa pelo menos três partições:</para>

      <itemizedlist>
	<listitem>
	  <para><literal>freebsd-boot</literal> - Mantém o código de inicialização do FreeBSD.</para>
	</listitem>

	<listitem>
	  <para><literal>freebsd-ufs</literal> - Um sistema de arquivos <acronym>UFS</acronym> do FreeBSD.</para>
	</listitem>

	<listitem>
	  <para><literal>freebsd-zfs</literal> - Um sistema de arquivos <acronym>ZFS</acronym> do FreeBSD. Mais informações sobre o ZFS estão disponíveis em <xref linkend="zfs"/>.</para>
	</listitem>

	<listitem>
	  <para><literal>freebsd-swap</literal> - Espaço de swap do FreeBSD.</para>
	</listitem>
      </itemizedlist>

      <para>Consulte <citerefentry><refentrytitle>gpart</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter informações de todos os tipos de partições <acronym>GPT</acronym> disponíveis.</para>

      <para>Várias partições do sistema de arquivos podem ser criadas e algumas pessoas preferem um layout tradicional com partições separadas para <filename>/</filename>, <filename>/var</filename>, <filename>/tmp</filename> e <filename>/usr</filename>. Veja <xref linkend="bsdinstall-part-manual-splitfs"/> para um exemplo.</para>

      <para>O <literal>tamanho</literal> pode ser digitado com abreviações comuns: <emphasis>K</emphasis> para kilobytes, <emphasis>M</emphasis> para megabytes, ou <emphasis>G</emphasis> para gigabytes.</para>

      <tip>
	<para>O alinhamento adequado do setor fornece o melhor desempenho, e ao definir os tamanhos das partições em múltiplos de 4K bytes ajuda a garantir o alinhamento em discos com setores de 512 ou 4 bytes. Geralmente, usar tamanhos de partições que são múltiplos de 1M ou 1G é a maneira mais fácil de garantir que cada partição comece em um múltiplo par de 4K. Há uma exceção: a partição <emphasis>freebsd-boot</emphasis> não deve ser maior que 512K devido às limitações atuais do código de inicialização.</para>
      </tip>

      <para>Um <literal>Mountpoint</literal> é necessário se a partição contiver um sistema de arquivos. Se apenas uma única partição <acronym>UFS</acronym> for criada, o ponto de montagem deve ser <filename>/</filename>.</para>

      <para>O <literal>Label</literal> é um nome pelo qual a partição será conhecida. Nomes ou números de unidades podem mudar se a unidade estiver conectada a um controlador ou porta diferente, mas a etiqueta da partição não muda. Referir-se a rótulos em vez de nomes de unidade e números de partição em arquivos como o <filename>/etc/fstab</filename> torna o sistema mais tolerante a alterações de hardware. Os rótulos <acronym>GPT</acronym> aparecem em <filename>/dev/gpt/</filename> quando um disco é anexado. Outros esquemas de particionamento têm diferentes capacidades de rótulos e seus rótulos aparecem em diferentes diretórios no <filename>/dev/</filename>.</para>

      <tip>
	<para>Use um rótulo único e exclusivo para cada uma das partições para evitar conflitos de rótulos idênticos. Algumas letras do nome, uso ou localização do computador podem ser adicionadas ao rótulo. Por exemplo, use <literal>labroot</literal> ou <literal>rootfslab</literal> para a partição raiz  <acronym>UFS</acronym> no computador chamado <literal>lab</literal>.</para>
      </tip>

      <example xml:id="bsdinstall-part-manual-splitfs">
	<title>Criando partições tradicionais para um sistema de arquivos dividido</title>

	<para>Para um layout de partição tradicional em que os diretórios <filename>/</filename>, <filename>/var</filename>, <filename>/tmp</filename> e <filename>/usr</filename> são sistemas de arquivos separados em suas próprias partições, crie um esquema de particionamento <acronym>GPT</acronym> e crie as partições conforme mostrado. Os tamanhos de partição mostrados são típicos para um disco de destino de 20G. Se houver mais espaço disponível no disco de destino, partições maiores de swap ou <filename>/var</filename> podem ser úteis. Os rótulos mostrados aqui são prefixados com <literal>ex</literal> para <quote>exemplo</quote>, mas os leitores devem usar outros valores de rótulo exclusivos, conforme descrito acima.</para>

	<para>Por padrão, o <filename>gptboot</filename> do FreeBSD espera que a primeira partição <acronym>UFS</acronym> seja a partição <filename>/</filename>.</para>

	<informaltable frame="none">
	  <tgroup cols="4">
	    <thead>
	      <row>
		<entry>Tipo de Partição</entry>
		<entry>Tamanho</entry>
		<entry>Ponto de montagem</entry>
		<entry>Rótulo</entry>
	      </row>
	    </thead>

	    <tbody>
	      <row>
		<entry><literal>freebsd-boot</literal></entry>
		<entry><literal>512K</literal></entry>
	      </row>

	      <row>
		<entry><literal>freebsd-ufs</literal></entry>
		<entry><literal>2G</literal></entry>
		<entry><filename>/</filename></entry>
		<entry><literal>exrootfs</literal></entry>
	      </row>

	      <row>
		<entry><literal>freebsd-swap</literal></entry>
		<entry><literal>4G</literal></entry>
		<entry/>
		<entry><literal>exswap</literal></entry>
	      </row>

	      <row>
		<entry><literal>freebsd-ufs</literal></entry>
		<entry><literal>2G</literal></entry>
		<entry><filename>/var</filename></entry>
		<entry><literal>exvarfs</literal></entry>
	      </row>

	      <row>
		<entry><literal>freebsd-ufs</literal></entry>
		<entry><literal>1G</literal></entry>
		<entry><filename>/tmp</filename></entry>
		<entry><literal>extmpfs</literal></entry>
	      </row>

	      <row>
		<entry><literal>freebsd-ufs</literal></entry>
		<entry>aceite o padrão (restante do disco)</entry>
		<entry><filename>/usr</filename></entry>
		<entry><literal>exusrfs</literal></entry>
	      </row>
	    </tbody>
	  </tgroup>
	</informaltable>
      </example>

      <para>Depois que as partições personalizadas forem criadas, selecione <guibutton>[Finish]</guibutton> para continuar com a instalação e vá para <xref linkend="bsdinstall-fetching-distribution"/>.</para>
    </sect2>

    <sect2 xml:id="bsdinstall-part-zfs">
      <title>Particionamento Guiado Usando Root-on-ZFS</title>

      <para>Este modo de particionamento funciona apenas com discos inteiros e apagará por completo o conteúdo do disco. O menu de configuração principal do <acronym>ZFS</acronym> oferece várias opções para controlar a criação do pool.</para>

      <figure xml:id="bsdinstall-zfs-menu">
	<title>Menu de particionamento do <acronym>ZFS</acronym></title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-zfs-menu"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Aqui está um resumo das opções que podem ser usadas neste menu:</para>

    <itemizedlist>
      <listitem>
	<para><literal>Instalar</literal> - Prosseguir a instalação com as opções selecionadas.</para>
      </listitem>

      <listitem>
	<para><literal>Tipo de Pool/Discos</literal> - Permite configurar o <literal>Tipo de Pool</literal> e o(s) disco(s ) que irão constituir o pool. Atualmente o instalador <acronym>ZFS</acronym> automático suporta apenas a criação de uma única camada superior vdev, exceto em modo stripe. Para criar pools mais complexos, use as instruções em <xref linkend="bsdinstall-part-shell"/> para criar o pool.</para>
      </listitem>

      <listitem>
	<para><literal>Re-escanear Dispositivos</literal> - Re-popular a lista de discos disponíveis.</para>
      </listitem>

      <listitem>
	<para><literal>Disk Info</literal> - Disk Info pode ser usado para inspecionar cada disco, incluindo sua tabela de partição e várias outras informações, como o número do modelo do dispositivo e o número de série, se disponíveis.</para>
      </listitem>

      <listitem>
	<para><literal>Pool Name</literal> - Define o nome do pool. O nome default é <emphasis>zroot</emphasis>.</para>
      </listitem>

      <listitem>
	<para><literal>Force 4K Sectors?</literal> - Forçar o uso de setores em 4K. Por padrão, o instalador irá automaticamente criar partições alinhadas com limites em 4K e forçar o ZFS a usar setores de 4K. Isto é seguro mesmo com discos de setores de 512 bytes, e tem o benefício adicional de garantir que pools criados em discos de 512 bytes conseguirão ter setores de 4K adicionados no futuro, seja como espaço de armazenamento adicional ou como substituição ode discos e falha. Aperte a tecla <keycap>Enter</keycap> para escolher ativar isso ou não.</para>
      </listitem>

      <listitem>
	<para><literal>Encrypt Disks?</literal> - A criptografia dos discos permite ao usuário criptografar os discos usando <acronym>GELI</acronym>. Mais informação sobre criptografia de discos está disponível em 
 <xref linkend="disks-encrypting-geli"/>. Aperte a tecla <keycap>Enter</keycap> para escolher ativá-la ou não.</para>
      </listitem>

      <listitem>
	<para><literal>Partition Scheme</literal> - Permitei escolher o esquema de partição. GPT é a opção recomendada na maioria dos casos. Aperte a tecla <keycap>Enter</keycap> para escolher entre diferentes opções.</para>
      </listitem>

      <listitem>
	<para><literal>Swap Size</literal> - Determina a quantidade de espaço para swap.</para>
      </listitem>

      <listitem>
	<para><literal>Mirror Swap?</literal> - Permite ao usuário espelhar o swap entre os discos. Fique atento, o espelhamento da swap irá quebrar dumps de crash. Pressione a tecla <keycap>Enter</keycap> para ativar ou não.</para>
      </listitem>

      <listitem>
	<para><literal>Encrypt Swap?</literal> - Permite ao usuário criptografar a swap. Criptografa a swap com uma chave temporária toda vez que o sistema inicializa e a descarta na reinicialização. Pressione a tecla <keycap>Enter</keycap> para ativar ou não.  Mais informação sobre criptografia de swap em <xref linkend="swap-encrypting"/>.</para>
      </listitem>
    </itemizedlist>

      <para>Selecione <keycap>T</keycap> para configurar o <literal>Pool Type</literal> e o(s) disco(s) que irá constituir o pool.</para>

      <figure xml:id="bsdinstall-zfs-vdev_type">
	<title>Tipo de pool <acronym>ZFS</acronym></title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-zfs-vdev_type"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Aqui está um resumo dos <literal>Pool Type</literal> que podem ser selecionados neste menu:</para>

    <itemizedlist>
      <listitem>
	<para><literal>stripe</literal> - Striping provê a capacidade máxima de todos os dispositivos conectados, mas não redundância. Se um disco falhar os dados do pool estarão perdidos de forma irrevogável.</para>
      </listitem>
      <listitem>
	<para><literal>mirror</literal> - O espelhamento armazena uma completa cópia de todos os dados em todos os discos. O espelhamento provê uma boa performance em leitura porque os dados são lidos the todos os discos em paralelo. A performance da escrita é mais lenta pois os dados precisam ser escritos em todos os discos do pool. Torna possível que haja falha nos discos, menos um. Esta opção requer ao menos dois discos.</para>
      </listitem>
      <listitem>
	<para><literal>raid10</literal> - Striped mirrors. Provê a melhor performance, mas o menor armazenamento. Esta opção necessita de um número par de discos e no mínimo quatro discos.</para>
      </listitem>
      <listitem>
	<para><literal>raidz1</literal> - RAID Único Redundante. Permite que haja falha concorrente de um disco. Esta opção necessita de ao menos três discos.</para>
      </listitem>
      <listitem>
	<para><literal>raidz2</literal> - RAID Duplo Redundante. Permite que até dois discos falhem concorrentemente. Esta opção necessita de ao menos quatro discos.</para>
      </listitem>
      <listitem>
	<para><literal>raidz3</literal> - RAID Triplo Redundante. Permite que até três discos falhem concorrentemente. Esta opção necessita de ao menos cinco discos.</para>
      </listitem>
    </itemizedlist>

      <para>Quando um <literal>Pool Type</literal> for selecionado, uma lista de discos disponíveis será exibida, e o usuário é solicitado a selecionar um ou mais discos para compor o pool. A configuração é então validada, para garantir que discos suficientes sejam selecionados. Caso contrário, selecione <guibutton>&lt;Change Selection&gt;</guibutton> para retornar à lista de discos ou <guibutton>&lt;Backgt&gt;</guibutton> para alterar o <literal>Pool Type</literal></para>

      <figure xml:id="bsdinstall-zfs-disk_select">
	<title>Seleção de disco</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-zfs-disk_select"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <figure xml:id="bsdinstall-zfs-vdev_invalid">
	<title>Seleção inválida</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-zfs-vdev_invalid"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Se um ou mais discos estiverem faltando na lista, ou se os discos foram anexados depois que o instalador foi iniciado, selecione <guibutton>- Rescan Devices</guibutton> para preencher novamente a lista de discos disponíveis.</para>

      <figure xml:id="bsdinstall-zfs-rescan-devices">
	<title>Dispositivos de Reescaneamento</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-zfs-rescan-devices"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Para evitar apagar acidentalmente o disco errado, o menu <guibutton>- Disk Info</guibutton> pode ser usado para inspecionar cada disco, incluindo sua tabela de partição e várias outras informações, como o número do modelo do dispositivo e o número de série, se disponíveis.</para>

      <figure xml:id="bsdinstall-zfs-disk_info">
	<title>Analisando um disco</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-zfs-disk_info"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Selecione <keycap>N</keycap> para configurar o <literal>Pool Name</literal>. Entre com o nome desejado e então selecione <guibutton>&lt;OK&gt;</guibutton> para confirmar ou <guibutton>&lt;Cancel&gt;</guibutton> para retornar ao menu principal e deixar o nome padrão.</para>

      <figure xml:id="bsdinstall-zfs-pool-name">
	<title>Nome do Pool</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-zfs-pool-name"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Selecione <keycap>S</keycap> para escolher a quantidade de swap. Entre com a quantidade desejada e então selecione <guibutton>&lt;OK&gt;</guibutton> para confirmar isto ou <guibutton>&lt;Cancel&gt;</guibutton> para retornar ao menu principal e deixar a quantidade padrão.</para>

      <figure xml:id="bsdinstall-zfs-swap-amount">
	<title>Quantidade de Swap</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-zfs-swap-amount"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Uma vez que todas opções estejam setadas com os valores desejados, selecione a opção <guibutton>&gt;&gt;&gt; Install</guibutton> no topo do menu. O instalador oferece uma última chance de cancelar antes que o conteúdo das unidades selecionadas seja destruído para criar o pool do <acronym>ZFS</acronym>.</para>

      <figure xml:id="bsdinstall-zfs-warning">
	<title>Última chance</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-zfs-warning"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Se a criptografia de disco <acronym>GELI</acronym> foi ativada, o instalador solicitará duas vezes que a frase secreta seja usada para criptografar os discos. E depois dissoa inicialização da criptografia é iniciado.</para>

      <figure xml:id="bsdinstall-zfs-geli_password">
	<title>Senha de criptografia de disco</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-zfs-geli_password"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <figure xml:id="bsdinstall-zfs-init-encription">
	<title>inicializando Criptografia</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-zfs-init-encription"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>A instalação então prossegue normalmente. Para continuar com a instalação, vá para <xref linkend="bsdinstall-fetching-distribution"/>.</para>

    </sect2>

    <sect2 xml:id="bsdinstall-part-shell">
      <title>Particionamento do modo shell</title>

      <para>Ao criar instalações avançadas, os menus de particionamento do <application>bsdinstall</application> podem não fornecer o nível de flexibilidade necessário. Usuários avançados podem selecionar a opção <guibutton>Shell</guibutton> no menu de particionamento para particionar manualmente as unidades, criar o(s) sistema(s) de arquivos, preencher o <filename>/tmp/bsdinstall_etc/fstab</filename> e montar os sistemas de arquivos em <filename>/mnt</filename>. Feito isso, digite <command>exit</command> para retornar ao <application>bsdinstall</application> e continue com a instalação.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="bsdinstall-fetching-distribution">
    <title>Fazendo o download dos arquivos de distribuição</title>

    <para>O tempo de instalação irá variar dependendo das distribuições escolhidas, mídia de instalação e velocidade do computador. Uma série de mensagens indicará o progresso.</para>

    <para>Primeiro, o instalador formata o(s) disco(s) selecionado(s) e inicializa as partições. Em seguida, no caso de uma <literal>bootonly media</literal> ou <literal>mini memstick</literal>, ele faz o download dos componentes selecionados:</para>

    <figure xml:id="bsdinstall-distfile-fetching">
      <title>Fazendo o download dos arquivos de distribuição</title>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="bsdinstall/bsdinstall-distfile-fetching"/>
	</imageobject>
      </mediaobject>
    </figure>

    <para>Em seguida, a integridade dos arquivos de distribuição é verificada para garantir que eles não tenham sido corrompidos durante o download ou mal interpretados da mídia de instalação:</para>

    <figure xml:id="bsdinstall-distfile-verify">
      <title>Verificando arquivos de distribuição</title>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="bsdinstall/bsdinstall-distfile-verifying"/>
	</imageobject>
      </mediaobject>
    </figure>

    <para>Finalmente, os arquivos de distribuição verificados são extraídos para o disco:</para>

    <figure xml:id="bsdinstall-distfile-extract">
      <title>Extraindo arquivos de distribuição</title>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="bsdinstall/bsdinstall-distfile-extracting"/>
	</imageobject>
      </mediaobject>
    </figure>

    <para>Depois que todos os arquivos de distribuição solicitados tiverem sido extraídos, o <application>bsdinstall</application> exibirá a primeira tela de configuração pós-instalação. As opções de configuração pós-instalação disponíveis estão descritas na próxima seção.</para>
  </sect1>

  <sect1 xml:id="bsdinstall-post">
    <title>Contas, Time Zone, Serviços e Hardening</title>

    <sect2 xml:id="bsdinstall-post-root">
      <title>Definindo a Senha de <systemitem class="username">root</systemitem></title>

      <para>Primeiro, a senha do <systemitem class="username">root</systemitem> deve ser definida. Ao digitar a senha, os caracteres digitados não são exibidos na tela. Depois que a senha for digitada, ela deve ser digitada novamente. Isso ajuda a evitar erros de digitação.</para>

      <figure xml:id="bsdinstall-post-set-root-passwd">
	<title>Definindo a Senha de <systemitem class="username">root</systemitem></title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-post-root-passwd"/>
	  </imageobject>
	</mediaobject>
      </figure>
    </sect2>

    <sect2 xml:id="bsdinstall-timezone">
      <title>Defina o fuso horário</title>

      <para>A próxima série de menus é usada para determinar a hora local correta, selecionando a região geográfica, o país e o fuso horário. Definir o fuso horário permite que o sistema corrija automaticamente as alterações de horário regionais, como horário de verão, e execute outras funções relacionadas ao fuso horário corretamente.</para>

      <para>O exemplo mostrado aqui é para uma máquina localizada no fuso horário do continente da Espanha, Europa. As seleções variam de acordo com a localização geográfica.</para>

      <figure xml:id="bsdinstall-timezone-region">
	<title>Selecione uma região</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-timezone-region"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>A região apropriada é selecionada usando as teclas de seta e depois pressionando <keycap>Enter</keycap>.</para>

      <figure xml:id="bsdinstall-timezone-country">
	<title>Selecione um pais</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-timezone-country"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Selecione o país apropriado usando as teclas de seta e pressione <keycap>Enter</keycap>.</para>

      <figure xml:id="bsdinstall-timezone-zone">
	<title>Selecione um fuso horário</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-timezone-zone"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>O fuso horário apropriado é selecionado usando as teclas de seta e pressionando <keycap>Enter</keycap>.</para>

      <figure xml:id="bsdinstall-timezone-confirmation">
	<title>Confirme o fuso horário</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-timezone-confirm"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Confirme se a abreviação do fuso horário está correta.</para>

      <figure xml:id="bsdinstall-timezone-date">
	<title>Selecionar Data</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-timezone-date"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>A data apropriada é selecionada usando as teclas de seta e pressionando <guibutton>[ Set Date ]</guibutton>. Caso contrário, a seleção de data pode ser pulada pressionando <guibutton>[ Skip ]</guibutton>.</para>

      <figure xml:id="bsdinstall-timezone-time">
	<title>Selecionar Hora</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-timezone-time"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>O horário apropriado é selecionado usando as teclas de seta e, em seguida, pressionando <guibutton>[ Set Time ]</guibutton>. Caso contrário, a seleção da hora pode ser pulada pressionando <guibutton>[ Skip ]</guibutton>.</para>
    </sect2>

    <sect2 xml:id="bsdinstall-sysconf">
      <title>Ativando Serviços</title>

      <para>O próximo menu é usado para configurar quais serviços do sistema serão iniciados sempre que o sistema for inicializado. Todos esses serviços são opcionais. Inicie apenas os serviços necessários para o funcionamento do sistema.</para>

      <figure xml:id="bsdinstall-config-serv">
	<title>Selecionando Serviços Adicionais para Ativar</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-config-services"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Aqui está um resumo dos serviços que podem ser ativados neste menu:</para>

      <itemizedlist>
	<listitem>
	  <para><literal>local_unbound</literal> -Ative o DNS local unbound. É necessário ter em mente que esse é o unbound do sistema base e deve ser usado apenas como um cache local de consultas DNS. Se o objetivo é configurar um resolvedor para toda a rede, instale <package>dns/unbound</package>.</para>
	</listitem>

	<listitem>
	  <para><literal>sshd</literal> - O daemon Secure Shell (<acronym>SSH</acronym>) é usado para acessar remotamente um sistema através de uma conexão criptografada. Ative este serviço somente se o sistema estiver disponível para logins remotos.</para>
	</listitem>

	<listitem>
	  <para><literal>moused</literal> - Ative este serviço se o mouse for usado a partir do console do sistema de linha de comando.</para>
	</listitem>

	<listitem>
	  <para><literal>ntpdate</literal> - Ative a sincronização automática do relógio no momento do boot. A funcionalidade deste programa agora está disponível no daemon <citerefentry><refentrytitle>ntpd</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Após um período considerável de luto, o utilitário <citerefentry><refentrytitle>ntpdate</refentrytitle><manvolnum>8</manvolnum></citerefentry> será aposentado.</para>
	</listitem>

	<listitem>
	  <para><literal>ntpd</literal> - O daemon do Network Time Protocol (<acronym>NTP</acronym>) para sincronização automática do relógio. Ative este serviço se houver um servidor <trademark class="registered">Windows</trademark>, Kerberos ou <acronym>LDAP</acronym> na rede.</para>
	</listitem>

	<listitem>
	  <para><literal>powerd</literal> - Utilitário de controle de energia do sistema para controle de energia e economia de energia.</para>
	</listitem>

	<listitem>
	  <para><literal>dumpdev</literal> - A habilitação de despejos de memória é útil na depuração de problemas com o sistema; portanto, os usuários são incentivados a habilitar despejos de memória.</para>
	</listitem>
	</itemizedlist>
    </sect2>

    <sect2 xml:id="bsdinstall-hardening">
      <title>Ativando Opções de Segurança (Hardening)</title>

      <para>O próximo menu é usado para configurar quais opções de segurança serão ativadas. Todas essas opções são opcionais. Mas seu uso é incentivado.</para>

      <figure xml:id="bsdinstall-hardening-options">
	<title>Selecionando Opções de Segurança (Hardening)</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-hardening"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Aqui está um resumo das opções que podem ser ativadas neste menu:</para>

      <itemizedlist>
	<listitem>
	  <para><literal>hide_uids</literal> - Oculta processos em execução de outros usuários para impedir que usuários sem privilégios vejam processos em execução de outros usuários (UID), impedindo o vazamento de informações.</para>
	</listitem>

	<listitem>
	  <para><literal>hide_gids</literal> - Oculta processos em execução de outros grupos para impedir que usuários sem privilégios vejam processos em execução de outros grupos (GID), impedindo o vazamento de informações.</para>
	</listitem>

	<listitem>
	  <para><literal>hide_jail</literal> - Oculta processos em execução em jails para impedir que usuários sem privilégios vejam processos em execução dentro das jails.</para>
	</listitem>

	<listitem>
	  <para><literal>read_msgbuf</literal> - Desativando a leitura do buffer de mensagens do kernel para usuários sem privilégios, impede o uso do <citerefentry><refentrytitle>dmesg</refentrytitle><manvolnum>8</manvolnum></citerefentry> para exibir mensagens do log do kernel em buffer.</para>
	</listitem>

	<listitem>
	  <para><literal>proc_debug</literal> - Desativar os recursos de depuração de processo para usuários sem privilégios desativa uma variedade de serviços de depuração entre processos sem privilégios, incluindo algumas funcionalidades procfs, ptrace() e ktrace(). Observe que isso também irá bloquear ferramentas de depuração, como por exemplo, <citerefentry><refentrytitle>lldb</refentrytitle><manvolnum>1</manvolnum></citerefentry>, <citerefentry><refentrytitle>truss</refentrytitle><manvolnum>1</manvolnum></citerefentry>, <citerefentry><refentrytitle>procstat</refentrytitle><manvolnum>1</manvolnum></citerefentry>, bem como alguns recursos de depuração integrados em certas linguagens de script como PHP, etc., de funcionar para usuários sem privilégios.</para>
	</listitem>

	<listitem>
	  <para><literal>random_pid</literal> - Randomize o PID dos processos recém-criados.</para>
	</listitem>

	<listitem>
	  <para><literal>clear_tmp</literal> - Limpar o <filename>/tmp</filename> na inicialização do sistema.</para>
	</listitem>

	<listitem>
	  <para><literal>disable_syslogd</literal> - Desative a criação de socket de rede do <application>syslogd</application>. Por padrão, o FreeBSD executa o <application>syslogd</application> de maneira segura com <command>-s</command>. Isso impede que o daemon atenda solicitações UDP recebidas na porta 514. Com esta opção ativada, o <application>syslogd</application> será executado com o sinalizador <command>-ss</command>, que impede o <application>syslogd</application> de abrir qualquer porta. Para obter mais informações, consulte <citerefentry><refentrytitle>syslogd</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
	</listitem>

	<listitem>
	  <para><literal>disable_sendmail</literal> - Desative o agente de transporte de email sendmail.</para>
	</listitem>

	<listitem>
	  <para><literal>secure_console</literal> - Quando esta opção está ativada, o prompt solicita a senha de <systemitem class="username">root</systemitem>  ao entrar em modo single-user.</para>
	</listitem>

	<listitem>
	  <para><literal>disable_ddtrace</literal> - O DTrace pode ser executado em um modo que realmente afetará o kernel em execução. Ações destrutivas não podem ser usadas, a menos que tenham sido explicitamente ativadas. Para habilitar esta opção ao usar o DTrace, use <command>-w</command>. Para obter mais informações, consulte <citerefentry><refentrytitle>dtrace</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</para>
	</listitem>
      </itemizedlist>
    </sect2>

    <sect2 xml:id="bsdinstall-addusers">
      <title>Adicione usuários</title>

      <para>O próximo menu pede para criar pelo menos uma conta de usuário. Recomenda-se fazer login no sistema usando uma conta de usuário em vez de utilizar diretamente o <systemitem class="username">root</systemitem>. Quando logado como <systemitem class="username">root</systemitem>, essencialmente não há limites ou proteção sobre o que pode ser feito. Fazer o login como um usuário normal é mais seguro.</para>

      <para>Selecione <guibutton>[Yes]</guibutton> para adicionar novos usuários.</para>

      <figure xml:id="bsdinstall-add-user1">
	<title>Adicione contas de usuário</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-adduser1"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Siga os prompts e insira as informações solicitadas para a conta do usuário. O exemplo mostrado em <xref linkend="bsdinstall-add-user2"/> cria a conta de usuário <systemitem class="username">asample</systemitem>.</para>

      <figure xml:id="bsdinstall-add-user2">
	<title>Insira as informações do usuário</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-adduser2"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Aqui está um resumo das informações para solicitadas:</para>

      <itemizedlist>
	<listitem>
	  <para><literal>Username</literal> - O nome que o usuário digitará para efetuar login. Uma convenção comum é usar a primeira letra do primeiro nome combinada com o sobrenome, desde que cada nome de usuário seja exclusivo para o sistema. O nome de usuário faz distinção entre maiúsculas e minúsculas e não deve conter espaços.</para>
	</listitem>

	<listitem>
	  <para><literal>Username</literal> - O nome completo do usuário. Este campo pode conter espaços e é usado como uma descrição para a conta do usuário.</para>
	</listitem>

	<listitem>
	  <para><literal>Uid</literal> - <acronym>ID</acronym> do Usuário. Normalmente, isso é deixado em branco para que o sistema atribua um valor.</para>
	</listitem>

	<listitem>
	  <para><literal>Login group</literal> - O grupo do usuário. Normalmente, isso é deixado em branco para aceitar o padrão.</para>
	</listitem>

	<listitem>
	  <para><literal>Invite <replaceable>user</replaceable> into other groups?</literal> - Grupos adicionais aos quais o usuário será adicionado como membro. Se o usuário precisar de acesso administrativo, digite <literal>wheel</literal> aqui.</para>
	</listitem>

	<listitem>
	  <para><literal>Login class</literal> - normalmente deixado em branco para seguir com o padrão.</para>
	</listitem>

	<listitem>
	  <para><literal>Shell</literal> - Digite um dos valores listados para definir o shell interativo para o usuário. Consulte <xref linkend="shells"/> para maiores informações sobre shells.</para>
	</listitem>

	<listitem>
	  <para><literal>Home directory</literal> - O diretório inicial do usuário. O padrão geralmente está correto.</para>
	</listitem>

	<listitem>
	  <para><literal>Home directory permissions</literal> - Permissões no diretório inicial do usuário. O padrão geralmente está correto.</para>
	</listitem>

	<listitem>
	  <para><literal>Use password-based authentication?</literal> A resposta deve ser <literal>Yes</literal> para que o usuário seja solicitado a inserir sua senha no login.</para>
	</listitem>

	<listitem>
	  <para><literal>Use an empty password?</literal> - Normalmente a resposta será <literal>No</literal>, pois é inseguro ter uma senha em branco.</para>
	</listitem>

	<listitem>
	  <para><literal>Use a random password?</literal> - Normalmente a resposta será <literal>No</literal> para que o usuário possa definir sua própria senha no próximo prompt.</para>
	</listitem>

	<listitem>
	  <para><literal>Enter password</literal> - Escolha a senha para este usuário. Caracteres digitados não serão exibidos na tela.</para>
	</listitem>

	<listitem>
	  <para><literal>Enter password again</literal> - A senha deve ser digitada novamente para verificação.</para>
	</listitem>

	<listitem>
	  <para><literal>Lock out the account after creation?</literal> - A reposta normalmente será <literal>No</literal> para que o usuário possa fazer o login.</para>
	</listitem>
      </itemizedlist>

      <para>Depois de inserir tudo, um resumo será exibido para revisão. Se algum erro foi cometido, digite <literal>no</literal> e tente novamente. Se tudo estiver correto, digite <literal>yes</literal> para criar o novo usuário.</para>

      <figure xml:id="bsdinstall-add-user3">
	<title>Saia do gerenciamento de usuários e grupos</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-adduser3"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Se houver mais usuários para adicionar, responda a pergunta <literal>Add another user?</literal> com <literal>yes</literal>. Digite <literal>no</literal> para concluir a adição de usuários e continuar a instalação.</para>

      <para>Para obter maiores informações sobre como adicionar usuários e sobre como gerenciá-los de usuários, consulte <xref linkend="users-synopsis"/>.</para>
    </sect2>

    <sect2 xml:id="bsdinstall-final-conf">
      <title>Configuração final</title>

      <para>Depois que tudo tiver sido instalado e configurado, você terá uma chance final para modificar as configurações.</para>

      <figure xml:id="bsdinstall-final-config">
	<title>Configuração final</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-finalconfiguration"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Use este menu para fazer alterações ou fazer qualquer configuração adicional antes de concluir a instalação.</para>

      <itemizedlist>
	<listitem>
	  <para><literal>Add User</literal> - Descrito em <xref linkend="bsdinstall-addusers"/>.</para>
	</listitem>

	<listitem>
	  <para><literal>Root Password</literal> - Descrito em <xref linkend="bsdinstall-post-root"/>.</para>
	</listitem>

	<listitem>
	  <para><literal>Hostname</literal> - Descrito em <xref linkend="bsdinstall-hostname"/>.</para>
	</listitem>

	<listitem>
	  <para><literal>Network</literal> - Descrito em <xref linkend="bsdinstall-config-network-dev"/>.</para>
	</listitem>

	<listitem>
	  <para><literal>Services</literal> - Descrito em <xref linkend="bsdinstall-sysconf"/>.</para>
	</listitem>

	<listitem>
	  <para><literal>System Hardening</literal> - Descrito em <xref linkend="bsdinstall-hardening"/>.</para>
	</listitem>

	<listitem>
	  <para><literal>Time Zone</literal> - Descrito em <xref linkend="bsdinstall-timezone"/>.</para>
	</listitem>

	<listitem>
	  <para><literal>Handbook</literal> - Faça o download e instale o FreeBSD Handbook.</para>
	</listitem>
      </itemizedlist>

      <para>Depois que completar qualquer configuração final que tenha faltado, selecione <guibutton>Exit</guibutton>.</para>

      <figure xml:id="bsdinstall-final-modification-shell">
	<title>Configuração manual</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-final-modification-shell"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>O <application>bsdinstall</application> perguntará se há alguma configuração adicional que precise ser feita antes de reinicializar o novo sistema. Selecione <guibutton>[Yes]</guibutton> para sair para um shell dentro do novo sistema ou <guibutton>[No]</guibutton> para prosseguir para a última etapa da instalação.</para>

      <figure xml:id="bsdinstall-final-main">
	<title>Conclua a instalação</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-mainexit"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Se outras configurações ou configurações especiais forem necessárias, selecione <guibutton>[Live CD]</guibutton> para inicializar a mídia de instalação no modo Live <acronym>CD</acronym>.</para>

      <para>Se a instalação estiver completa, selecione <guibutton>[Reboot]</guibutton> para reiniciar o computador e iniciar o novo sistema FreeBSD. Não se esqueça de remover a mídia de instalação do FreeBSD ou o computador poderá inicializar novamente a partir dela.</para>

      <para>Quando o FreeBSD inicializa, mensagens informativas são exibidas. Depois que o sistema concluir a inicialização, um prompt de login será exibido. No <prompt>login:</prompt>, insira o nome de usuário adicionado durante a instalação. Evite efetuar login como <systemitem class="username">root</systemitem>. Consulte <xref linkend="users-superuser"/> para instruções sobre como se tornar o superusuário quando o acesso administrativo for necessário.</para>

      <para>As mensagens que apareceram durante a inicialização podem ser revisadas pressionando <keycap>Scroll-Lock</keycap> para ativar o buffer de rolagem para trás. As teclas <keycap>PgUp</keycap>, <keycap>PgDn</keycap> e setas podem ser usadas para rolar pelas mensagens. Quando terminar, pressione <keycap>Scroll-Lock</keycap> novamente para desbloquear o visor e retornar ao console. Para revisar essas mensagens depois que o sistema estiver ativo por algum tempo, digite <command>less /var/run/dmesg.boot</command> em um prompt de comando. Pressione <keycap>q</keycap> para retornar à linha de comando após a visualização.</para>

      <para>Se o <application>sshd</application> foi habilitado em <xref linkend="bsdinstall-config-serv"/>, a primeira inicialização pode ser um pouco mais lenta, pois o sistema gerará as chaves <acronym>RSA</acronym> e <acronym>DSA</acronym>. As inicializações subseqüentes serão mais rápidas. As impressões digitais das chaves serão exibidas, conforme mostrado neste exemplo:</para>

      <screen>Generating public/private rsa1 key pair.
Your identification has been saved in /etc/ssh/ssh_host_key.
Your public key has been saved in /etc/ssh/ssh_host_key.pub.
The key fingerprint is:
10:a0:f5:af:93:ae:a3:1a:b2:bb:3c:35:d9:5a:b3:f3 root@machine3.example.com
The key's randomart image is:
+--[RSA1 1024]----+
|    o..          |
|   o . .         |
|  .   o          |
|       o         |
|    o   S        |
|   + + o         |
|o . + *          |
|o+ ..+ .         |
|==o..o+E         |
+-----------------+
Generating public/private dsa key pair.
Your identification has been saved in /etc/ssh/ssh_host_dsa_key.
Your public key has been saved in /etc/ssh/ssh_host_dsa_key.pub.
The key fingerprint is:
7e:1c:ce:dc:8a:3a:18:13:5b:34:b5:cf:d9:d1:47:b2 root@machine3.example.com
The key's randomart image is:
+--[ DSA 1024]----+
|       ..     . .|
|      o  .   . + |
|     . ..   . E .|
|    . .  o o . . |
|     +  S = .    |
|    +  . = o     |
|     +  . * .    |
|    . .  o .     |
|      .o. .      |
+-----------------+
Starting sshd.</screen>

      <para>Consulte <xref linkend="openssh"/> para maiores informações sobre fingerprints e o <acronym>SSH</acronym>.</para>

      <para>O FreeBSD não instala um ambiente gráfico por padrão. Consulte <xref linkend="x11"/> para maiores informações sobre como instalar e configurar um gerenciador gráfico de janelas.</para>

      <para>O desligamento adequado de um computador FreeBSD ajuda a proteger os dados e o hardware contra danos. <emphasis>Não desligue a energia antes do sistema ter sido desligado corretamente!</emphasis> Se o usuário for membro do grupo <systemitem class="groupname">wheel</systemitem>, torne-se o superusuário digitando <command>su</command> na linha de comando e inserindo a senha do usuário <systemitem class="username">root</systemitem>. Em seguida, digite <command>shutdown -p now</command> e o sistema será desligado corretamente e, se o hardware suportar, irá se desliga-se.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="bsdinstall-network">
    <title>Interfaces de Rede</title>

    <sect2 xml:id="bsdinstall-config-network-dev">
      <title>Configurando as Interfaces de Rede</title>

      <para>Em seguida, é mostrada uma lista das interfaces de rede encontradas no computador. Selecione a interface para configurar.</para>

      <figure xml:id="bsdinstall-configure-net-interface">
	<title>Escolha uma interface de rede</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-configure-network-interface"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Se uma interface Ethernet for selecionada, o instalador irá pular para o menu mostrado em <xref linkend="bsdinstall-configure-net-ipv4"/>. Se uma interface de rede sem fio for escolhida, o sistema procurará pontos de acesso sem fio:</para>

      <figure xml:id="bsdinstall-wireless-scan">
	<title>Buscando por pontos de acesso sem fio</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-configure-wireless-scan"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>As redes sem fio são identificadas por um identificador de conjunto de serviços (<acronym>SSID</acronym>), um nome curto e exclusivo dado a cada rede. Os <acronym>SSIDs</acronym> encontrados durante a busca serão listados, seguidos por uma descrição dos tipos de criptografia disponíveis para essa rede. Se o <acronym>SSID</acronym> desejado não aparecer na lista, selecione <guibutton>[Rescan]</guibutton> para buscar novamente. Se a rede desejada ainda não aparecer, verifique se há problemas com as conexões da antena ou tente mover o computador para mais perto do ponto de acesso. refaça a busca após cada alteração ser feita.</para>

      <figure xml:id="bsdinstall-wireless-accesspoints">
	<title>Escolhendo uma rede sem fio</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-configure-wireless-accesspoints"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Em seguida, insira as informações de criptografia para se conectar à rede sem fio selecionada. A encriptação <acronym>WPA2</acronym> é fortemente recomendada, pois os tipos de encriptação mais antigos, como o <acronym>WEP</acronym>, oferecem pouca segurança. Se a rede usar <acronym>WPA2</acronym>, insira a senha, também conhecida como Chave Pré-Compartilhada (<acronym>PSK</acronym>). Por motivos de segurança, os caracteres digitados na caixa de entrada são exibidos como asteriscos.</para>

      <figure xml:id="bsdinstall-wireless-wpa2">
	<title>Configuração WPA2</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-configure-wireless-wpa2setup"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Em seguida, escolha se um endereço <acronym>IPv4</acronym> deve ou não ser configurado na interface Ethernet ou na interface sem fio:</para>

      <figure xml:id="bsdinstall-configure-net-ipv4">
	<title>Escolha a rede <acronym>IPv4</acronym></title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-configure-network-interface-ipv4"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Existem dois métodos de configuração de <acronym>IPv4</acronym>. O <acronym>DHCP</acronym> configurará automaticamente a interface de rede da forma correta e deverá ser usado se a rede fornecer um servidor <acronym>DHCP</acronym>. Caso contrário, as informações de endereçamento precisam ser inseridas manualmente como em uma configuração estática.</para>

      <note>
	<para>Não insira informações de rede aleatórias, pois isso não funcionará. Se um servidor <acronym>DHCP</acronym> não estiver disponível, obtenha as informações listadas em <xref linkend="bsdinstall-collect-network-information"/> do administrador da rede ou do provedor de serviços de Internet.</para>
      </note>

      <para>Se um servidor <acronym>DHCP</acronym> estiver disponível, selecione <guibutton>[Yes]</guibutton> no próximo menu para configurar automaticamente a interface de rede. O instalador parecerá pausar por um minuto ou mais enquanto encontra o servidor <acronym>DHCP</acronym> e obtém as informações de endereçamento do sistema.</para>

      <figure xml:id="bsdinstall-net-ipv4-dhcp">
	<title>Escolha a configuração <acronym>IPv4</acronym> <acronym>DHCP</acronym></title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-configure-network-interface-ipv4-dhcp"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Se um servidor <acronym>DHCP</acronym> não estiver disponível, selecione <guibutton>[No]</guibutton> e insira as seguintes informações de endereçamento neste menu:</para>

      <figure xml:id="bsdinstall-net-ipv4-static">
	<title>Configuração <acronym>IPv4</acronym> estática</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-configure-network-interface-ipv4-static"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <itemizedlist>
	<listitem>
	  <para><literal>Endereço IP</literal> - O endereço <acronym>IPv4</acronym> atribuído a este computador. O endereço deve ser único e não estar em uso por outro equipamento na rede local.</para>
	</listitem>

	<listitem>
	  <para><literal>Subnet Mask</literal> - A máscara de sub-rede da rede.</para>
	</listitem>

	<listitem>
	  <para><literal>Default Router</literal> - O endereço <acronym>IP</acronym> do gateway padrão da rede.</para>
	</listitem>
      </itemizedlist>

      <para>A próxima tela perguntará se a interface deve ser configurada para <acronym>IPv6</acronym>. Se <acronym>IPv6</acronym> estiver disponível e for desejado, escolha <guibutton>[Yes]</guibutton> para selecioná-lo.</para>

      <figure xml:id="bsdinstall-net-ipv6">
	<title>Escolha a rede IPv6</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-configure-network-interface-ipv6"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>O <acronym> IPv6 </acronym> também possui dois métodos de configuração. A configuração automática de endereços sem estado (<acronym>SLAAC</acronym>) solicitará automaticamente as informações de configuração corretas de um roteador local. Consulte <link xlink:href="http://tools.ietf.org/html/rfc4862">rfc4862</link> para maiores informações. A configuração estática requer entrada manual das informações da rede.</para>

      <para>Se um roteador <acronym>IPv6</acronym> estiver disponível, selecione <guibutton>[Yes]</guibutton> no próximo menu para configurar automaticamente a interface de rede. O instalador parecerá pausar por um minuto ou mais enquanto localiza o roteador e obtém as informações de endereçamento do sistema.</para>

      <figure xml:id="bsdinstall-net-ipv6-slaac">
	<title>Escolha a configuração do SLAAC do IPv6</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-configure-network-interface-slaac"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Se um roteador <acronym>IPv6</acronym> não estiver disponível, selecione <guibutton>[No]</guibutton> e insira as seguintes informações de endereçamento neste menu:</para>

      <figure xml:id="bsdinstall-net-ipv6-static">
	<title>Configuração Estática do IPv6</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-configure-network-interface-ipv6-static"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <itemizedlist>
	<listitem>
	  <para><literal>Endereço IPv6</literal> - O endereço <acronym>IPv6</acronym> atribuído a este computador. O endereço deve ser único e não estar em uso por outro equipamento na rede local.</para>
	</listitem>

	<listitem>
	  <para><literal>Default Router</literal> - O endereço <acronym>IPv6</acronym> do gateway padrão da rede.</para>
	</listitem>
      </itemizedlist>

      <para>O último menu de configuração de rede é usado para configurar o resolvedor do Sistema de Nomes de Domínio (<acronym>DNS</acronym>), que converte nomes de host de e para endereços de rede. Se o <acronym>DHCP</acronym> ou <acronym>SLAAC</acronym> foi usado para autoconfigurar a interface de rede, os valores do <literal>Resolver Configuration</literal> podem já estar preenchidos. Caso contrário, insira o domínio da rede local nome no campo <literal>Search</literal>. <literal>DNS # 1</literal> e <literal>DNS # 2</literal> são os endereços <acronym>IPv4</acronym> e/ou <acronym>IPv6</acronym> dos servidores de <acronym>DNS</acronym>. Pelo menos um servidor <acronym>DNS</acronym> é necessário.</para>

      <figure xml:id="bsdinstall-net-dns-config">
	<title>Configuração do DNS</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-configure-network-ipv4-dns"/>
	  </imageobject>
	</mediaobject>
      </figure>

      <para>Quando a interface estiver configurada, selecione um site espelho localizado na mesma região do mundo que o computador no qual o FreeBSD está sendo instalado. Os arquivos podem ser recuperados mais rapidamente quando o espelho está próximo ao computador de destino, reduzindo o tempo de instalação.</para>

      <figure xml:id="bsdinstall-netinstall-mirror">
	<title>Escolhendo um Site Espelho</title>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="bsdinstall/bsdinstall-netinstall-mirrorselect"/>
	  </imageobject>
	</mediaobject>
      </figure>
    </sect2>
  </sect1>

  <sect1 xml:id="bsdinstall-install-trouble">
    <title>Solução de problemas</title>

    <indexterm><primary>installation</primary> <secondary>troubleshooting</secondary></indexterm>
    <para>Esta seção aborda a solução de problemas básicos de instalação, tais como problemas comuns que as pessoas relataram.</para>

    <para>Verifique o documento Notas de Hardware (<link xlink:href="@@URL_RELPREFIX@@/releases/index.html">https://www.freebsd.org/releases/index.html</link>) para a versão do FreeBSD para garantir que o hardware é suportado. Se o hardware for suportado e houver travamentos ou outros problemas, compile um kernel personalizado usando as instruções em <xref linkend="kernelconfig"/> para adicionar suporte a dispositivos que não estão presentes no kernel <filename>GENERIC</filename>. O kernel padrão assume que a maioria dos dispositivos de hardware está na configuração padrão de fábrica em termos de <acronym>IRQ</acronym>s, endereços de <acronym>I/O</acronym> e canais <acronym>DMA</acronym>. Se o hardware foi reconfigurado, um arquivo de configuração personalizado do kernel pode dizer ao FreeBSD onde encontrar os dispositivos.</para>

    <note>
      <para>Alguns problemas de instalação podem ser evitados ou aliviados com a atualização do firmware em vários componentes de hardware, principalmente na placa-mãe. O firmware da placa-mãe é geralmente chamado de <acronym>BIOS</acronym>. A maioria dos fabricantes de placas-mãe e computadores tem um site para atualizações e para informações sobre as atualizações.</para>

      <para>Os fabricantes geralmente desaconselham a atualização da <acronym>BIOS</acronym> da placa-mãe, a menos que haja uma boa razão para isso, como uma atualização crítica. O processo de atualização <emphasis>pode</emphasis> dar errado, deixando o <acronym>BIOS</acronym> incompleto e o computador inoperante.</para>
    </note>

    <para>Se o sistema trava enquanto verifica o hardware durante a inicialização ou se comporta de maneira estranha durante a instalação, o <acronym>ACPI</acronym> pode ser o culpado. O FreeBSD faz uso extensivo do sistema <acronym>ACPI</acronym> nas plataformas i386 e amd64 para ajudar na configuração do sistema, caso seja detectado durante a inicialização. Infelizmente, alguns bugs ainda existem tanto no driver <acronym>ACPI</acronym> como nas placas-mãe do sistema e no firmware <acronym>BIOS</acronym>. O <acronym>ACPI</acronym> pode ser desativado configurando a opção <literal>hint.acpi.0.disabled</literal> no  terceiro estágio do boot loader:</para>

    <screen><userinput>set hint.acpi.0.disabled="1"</userinput></screen>

    <para>Isso é redefinido toda vez que o sistema é inicializado, portanto é necessário adicionar <literal>hint.acpi.0.disabled="1"</literal> ao arquivo <filename>/boot/loader.conf</filename> . Maiores informações sobre o boot loader podem ser encontradas em <xref linkend="boot-synopsis"/>.</para>
  </sect1>

  <sect1 xml:id="using-live-cd">
    <title>Usando o Live <acronym>CD</acronym></title>

    <para>O menu de boas-vindas do <application>bsdinstall</application>, mostrado em <xref linkend="bsdinstall-choose-mode"/>, fornece uma opção <guibutton>[Live CD]</guibutton>. Isto é útil para aqueles que ainda estão se perguntando se o FreeBSD é o sistema operacional correto para eles e quer testar alguns dos recursos antes de instalar.</para>

    <para>Os seguintes pontos devem ser observados antes de usar o <guibutton>[Live CD]</guibutton>:</para>

    <itemizedlist>
      <listitem>
	<para>Para obter acesso ao sistema, a autenticação é necessária. O nome de usuário é <systemitem class="username">root</systemitem> e a senha está em branco.</para>
      </listitem>

      <listitem>
	<para>Como o sistema é executado diretamente da mídia de instalação, o desempenho será significativamente mais lento do que o de um sistema instalado em um disco rígido.</para>
      </listitem>

      <listitem>
	<para>Essa opção fornece apenas um prompt de comando e não uma interface gráfica.</para>
      </listitem>
    </itemizedlist>
  </sect1>
</chapter>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<chapter version="5.0" xml:id="basics">
  <!--
  <chapterinfo>
    <authorgroup>
      <author>
	<firstname>Chris</firstname>
	<surname>Shumway</surname>
	<contrib>Rewritten by in Mar 2000</contrib>
      </author>
    </authorgroup>
  </chapterinfo>
  -->
  <title>Fundamentos do FreeBSD</title>

  <sect1 xml:id="basics-synopsis">
    <title>Sinopse</title>

    <para>Este capítulo cobre os comandos básicos e as funcionalidades do sistema operacional FreeBSD. Grande parte deste material é relevante para qualquer sistema operacional do tipo <trademark class="registered">UNIX</trademark>. Novos usuários do FreeBSD são encorajados a ler este capítulo cuidadosamente.</para>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>Como usar e configurar consoles virtuais.</para>
      </listitem>

      <listitem>
	<para>Como criar e gerenciar usuários e grupos no FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como funcionam as permissões de arquivo <trademark class="registered">UNIX</trademark> e as flags de arquivos do FreeBSD.</para>
      </listitem>

      <listitem>
	<para>O layout padrão do sistema de arquivos do FreeBSD.</para>
      </listitem>

      <listitem>
	<para>A organização do disco no FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como montar e desmontar sistemas de arquivos.</para>
      </listitem>

      <listitem>
	<para>O que são processos, daemons e sinais.</para>
      </listitem>

      <listitem>
	<para>O que é um shell e como alterar o ambiente de login padrão.</para>
      </listitem>

      <listitem>
	<para>Como usar editores de texto básicos.</para>
      </listitem>

      <listitem>
	<para>O que são devices e device nodes.</para>
      </listitem>

      <listitem>
	<para>Como ler páginas de manual para obter maiores informações.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="consoles">
    <title>Consoles e Terminais Virtuais</title>

    <indexterm><primary>virtual consoles</primary></indexterm>
    <indexterm><primary>terminals</primary></indexterm>
    <indexterm><primary>console</primary></indexterm>

    <para>A menos que o FreeBSD tenha sido configurado para iniciar automaticamente um ambiente gráfico durante a inicialização, o sistema inicializará em um prompt de login da linha de comando, como visto neste exemplo:</para>

    <screen>FreeBSD/amd64 (pc3.example.org) (ttyv0)

login:</screen>

    <para>A primeira linha contém algumas informações sobre o sistema. O <literal>amd64</literal> indica que o sistema neste exemplo está executando uma versão de 64 bits do FreeBSD. O nome do host é <systemitem>pc3.example.org</systemitem>, e <filename>ttyv0</filename> indica que este é o <quote>console do sistema</quote>. A segunda linha é o prompt de login.</para>

    <para>Como o FreeBSD é um sistema multiusuário, ele precisa de alguma maneira distinguir entre usuários diferentes. Isso é feito exigindo que todos os usuários façam login no sistema antes de obter acesso aos programas no sistema. Cada usuário tem um <quote>nome de usuário</quote> único e uma <quote>senha</quote> pessoal.</para>

    <para>Para efetuar login no console do sistema, digite o nome de usuário que foi configurado durante a instalação do sistema, conforme descrito em <xref linkend="bsdinstall-addusers"/> e pressione <keycap>Enter</keycap>. Em seguida, insira a senha associada ao nome de usuário e pressione <keycap>Enter</keycap>. A senha não é <emphasis>ecoada</emphasis> por razões de segurança.</para>

    <para>Uma vez que a senha correta é inserida, a mensagem do dia (<acronym>MOTD</acronym>) será exibida, seguida de um prompt de comando. Dependendo do shell que foi selecionado quando o usuário foi criado, este prompt será um caractere <literal>#</literal>, <literal>$</literal> ou <literal>%</literal>. O prompt indica que o usuário está logado no console do sistema FreeBSD e pronto para testar os comandos disponíveis.</para>

    <sect2 xml:id="consoles-virtual">
      <title>Consoles Virtuais</title>

      <para>Enquanto o console do sistema pode ser usado para interagir com o sistema, um usuário trabalhando a partir da linha de comando no teclado de um sistema FreeBSD normalmente irá efetuar login em um console virtual. Isso ocorre porque as mensagens do sistema são configuradas por padrão para serem exibidas no console do sistema. Essas mensagens serão exibidas por cima do comando ou arquivo em que o usuário estiver trabalhando, dificultando a concentração no trabalho em questão.</para>

      <para>Por padrão, o FreeBSD é configurado para fornecer vários consoles virtuais para a entrada de comandos. Cada console virtual tem seu próprio prompt de login e shell e é fácil alternar entre os consoles virtuais. Isso essencialmente fornece a linha de comando equivalente a ter várias janelas abertas ao mesmo tempo em um ambiente gráfico.</para>

      <para>As combinações de teclas <keycombo><keycap>Alt</keycap><keycap>F1</keycap> </keycombo> até a  <keycombo><keycap>Alt</keycap><keycap>F8</keycap></keycombo> foram reservadas pelo FreeBSD para alternar entre os consoles virtuais. Use <keycombo><keycap>Alt</keycap><keycap>F1</keycap></keycombo> para alternar para o console do sistema (<filename>ttyv0</filename>), <keycombo><keycap>Alt</keycap><keycap>F2</keycap></keycombo> para acessar o primeiro console virtual (<filename>ttyv1</filename>), <keycombo><keycap>Alt</keycap> <keycap>F3</keycap></keycombo> para acessar o segundo console virtual (<filename>ttyv2</filename>) e assim por diante. Ao usar o <application>Xorg</application> como um console gráfico, a combinação <keycombo> <keycap>Ctrl</keycap><keycap>Alt</keycap><keycap>F1</keycap> </keycombo> é utilizada para retornar para um console virtual baseado em texto.</para>

      <para>Ao mudar de um console para o próximo, o FreeBSD gerencia a saída da tela. O resultado é uma ilusão de ter várias telas virtuais e teclados que podem ser usados para digitar comandos para o FreeBSD rodar. Os programas executados em um console virtual não param de ser executados quando o usuário alterna para um console virtual diferente.</para>

      <para>Consulte <citerefentry><refentrytitle>kbdcontrol</refentrytitle><manvolnum>1</manvolnum></citerefentry>, <citerefentry><refentrytitle>vidcontrol</refentrytitle><manvolnum>1</manvolnum></citerefentry>, <citerefentry><refentrytitle>atkbd</refentrytitle><manvolnum>4</manvolnum></citerefentry>, <citerefentry><refentrytitle>syscons</refentrytitle><manvolnum>4</manvolnum></citerefentry>, e <citerefentry><refentrytitle>vt</refentrytitle><manvolnum>4</manvolnum></citerefentry> para uma descrição mais técnica do console do FreeBSD e seus drivers de teclado.</para>

      <para>No FreeBSD, o número de consoles virtuais disponíveis é configurado nesta seção do <filename>/etc/ttys</filename>:</para>

      <programlisting># name    getty                         type  status comments
#
ttyv0   "/usr/libexec/getty Pc"         xterm   on  secure
# Virtual terminals
ttyv1   "/usr/libexec/getty Pc"         xterm   on  secure
ttyv2   "/usr/libexec/getty Pc"         xterm   on  secure
ttyv3   "/usr/libexec/getty Pc"         xterm   on  secure
ttyv4   "/usr/libexec/getty Pc"         xterm   on  secure
ttyv5   "/usr/libexec/getty Pc"         xterm   on  secure
ttyv6   "/usr/libexec/getty Pc"         xterm   on  secure
ttyv7   "/usr/libexec/getty Pc"         xterm   on  secure
ttyv8   "/usr/X11R6/bin/xdm -nodaemon"  xterm   off secure</programlisting>


      <para>Para desativar um console virtual, coloque um símbolo de comentário (<literal>#</literal>) no início da linha que representa esse console virtual. Por exemplo, para reduzir o número de consoles virtuais disponíveis de oito para quatro, coloque um <literal>#</literal> na frente das últimas quatro linhas que representam os consoles virtuais de <filename>ttyv5</filename> até <filename>ttyv8</filename>. <emphasis>Não</emphasis> comente a linha do console do sistema <filename>ttyv0</filename>. Note que o último console virtual (<filename>ttyv8</filename>) é usado para acessar o ambiente gráfico se o <application>Xorg</application> tiver sido instalado e configurado conforme descrito em <xref linkend="x11"/>.</para>

      <para>Para uma descrição detalhada de cada coluna neste arquivo e as opções disponíveis para os consoles virtuais, consulte <citerefentry><refentrytitle>ttys</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>
    </sect2>

    <sect2 xml:id="consoles-singleuser">
      <title>Modo "Single User"</title>

      <para>O menu de inicialização do FreeBSD fornece uma opção chamada <quote>Boot Single User</quote>. Se esta opção for selecionada, o sistema inicializará em um modo especial conhecido como <quote>single user mode</quote>. Esse modo é normalmente usado para reparar um sistema que não inicializa ou para redefinir a senha de <systemitem class="username">root</systemitem> quando ela é desconhecida. Quando em modo single user, a rede e outros consoles virtuais não estão disponíveis. No entanto, haverá acesso completo de <systemitem class="username">root</systemitem> ao sistema e, por padrão, a senha de <systemitem class="username">root</systemitem> não é necessária. Por estas razões, o acesso físico ao teclado é necessário para iniciar neste modo e determinar quem tem acesso físico ao teclado é algo a considerar ao proteger um sistema FreeBSD.</para>

      <para>As configurações que controlam o modo de single user são encontradas nesta seção do <filename>/etc/ttys</filename>:</para>

      <programlisting># name  getty                           type  status  comments
#
# If console is marked "insecure", then init will ask for the root password
# when going to single-user mode.
console none                            unknown  off  secure</programlisting>

      <para>Por padrão, o status é definido como <literal>secure</literal>. Isso pressupõe que quem tem acesso físico ao teclado não é importante ou é controlado por uma política de segurança física. Se essa configuração for alterada para <literal>insecure</literal>, a suposição é que o ambiente em si é inseguro porque qualquer pessoa pode acessar o teclado. Quando esta linha é alterada para <literal>insecure</literal>, o FreeBSD irá solicitar a senha do <systemitem class="username">root</systemitem> quando um usuário selecionar inicializar no modo single user.</para>

      <note>
	<para><emphasis>Tenha cuidado ao alterar esta configuração para <literal>inseguro</literal></emphasis>! Se a senha do <systemitem class="username">root</systemitem> for esquecida, a inicialização no modo single user ainda é possível, mas pode ser difícil para alguém que não esteja familiarizado com o processo de inicialização do FreeBSD.</para>
      </note>
    </sect2>

    <sect2 xml:id="consoles-vidcontrol">
      <title>Alterar os modos de vídeo do console</title>

      <para>O modo de vídeo padrão do console do FreeBSD pode ser ajustado para 1024x768, 1280x1024 ou qualquer outro tamanho suportado pelo chip gráfico e monitor. Para usar um modo de vídeo diferente, carregue o módulo <literal>VESA</literal>:</para>

      <screen><prompt>#</prompt> <userinput>kldload vesa</userinput></screen>

      <para>Para determinar quais modos de vídeo são suportados pelo hardware, use <citerefentry><refentrytitle>vidcontrol</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Para obter uma lista de modos de vídeo suportados, execute o seguinte:</para>

      <screen><prompt>#</prompt> <userinput>vidcontrol -i mode</userinput></screen>

      <para>A saída deste comando lista os modos de vídeo suportados pelo hardware. Para selecionar um novo modo de vídeo, especifique o modo usando <citerefentry><refentrytitle>vidcontrol</refentrytitle><manvolnum>1</manvolnum></citerefentry> como o usuário <systemitem class="username">root</systemitem> :</para>

      <screen><prompt>#</prompt> <userinput>vidcontrol MODE_279</userinput></screen>

      <para>Se o novo modo de vídeo for aceitável, ele pode ser definido permanentemente na inicialização, adicionando-o ao <filename>/etc/rc.conf</filename>:</para>

      <programlisting>allscreens_flags="MODE_279"</programlisting>
    </sect2>
  </sect1>

    <!--
  <chapterinfo>
    <authorgroup>
      <author>
	<firstname>Neil</firstname>
	<surname>Blakey-Milner</surname>
	<contrib>Contributed by in Feb 2000</contrib>
      </author>
    </authorgroup>
  </chapterinfo>
  -->

  <sect1 xml:id="users-synopsis">
    <title>Usuários e Gerenciamento Básico de Contas</title>

    <para>O FreeBSD permite que múltiplos usuários usem o computador ao mesmo tempo. Enquanto apenas um usuário pode se sentar em frente à tela e usar o teclado a qualquer momento, qualquer número de usuários pode efetuar o login no sistema através da rede. Para usar o sistema, cada usuário deve ter sua própria conta de usuário.</para>

    <para>Este capítulo descreve:</para>

    <itemizedlist>
      <listitem>
	<para>Os diferentes tipos de contas de usuários em um sistema FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como adicionar, remover e modificar contas de usuários.</para>
      </listitem>

      <listitem>
	<para>Como definir limites para controlar os recursos que usuários e grupos podem acessar.</para>
      </listitem>

      <listitem>
	<para>Como criar grupos e adicionar usuários como membros de um grupo.</para>
      </listitem>
    </itemizedlist>

    <sect2 xml:id="users-introduction">
      <title>Tipos de conta</title>

      <para>Como todo acesso ao sistema FreeBSD é obtido usando contas e todos os processos são executados por usuários, o gerenciamento de usuários e contas é importante.</para>

      <para>Existem três tipos principais de contas: contas do sistema, contas de usuário e a conta de superusuário.</para>

      <sect3 xml:id="users-system">
	<title>Contas do sistema</title>

	<indexterm><primary>accounts</primary> <secondary>system</secondary></indexterm>

	<para>As contas do sistema são usadas para executar serviços como DNS, correio e servidores web. A razão para isso é a segurança; se todos os serviços fossem executados como superusuário, eles poderiam agir sem restrições.</para>

	<indexterm><primary>accounts</primary> <secondary><systemitem class="username">daemon</systemitem></secondary></indexterm>
	<indexterm><primary>accounts</primary> <secondary><systemitem class="username">operator</systemitem></secondary></indexterm>

	<para>Exemplos de contas do sistema são <systemitem class="username">daemon</systemitem>, <systemitem class="username">operador</systemitem>, <systemitem class="username">bind</systemitem>, <systemitem class="username">news</systemitem>, e <systemitem class="username">www</systemitem>.</para>

	<warning>
	  <para>É necessário ter cuidado ao usar o grupo operator, pois privilégios de acesso como o de superusuário podem ser concedidos, incluindo e não limitado a, desligamento, reinicialização e acesso a todos os itens em <filename>/dev</filename> para o grupo.</para>
	</warning>

	<indexterm><primary>accounts</primary> <secondary><systemitem class="username">nobody</systemitem></secondary></indexterm>

	<para>A <systemitem class="username">nobody</systemitem> é uma conta genérica sem privilégios do sistema. No entanto, quanto mais serviços usarem <systemitem class="username">nobody</systemitem>, a mais arquivos e processos esse usuário será associado e, portanto, mais privilegiado esse usuário se tornará.</para>
      </sect3>

      <sect3 xml:id="users-user">
	<title>Contas de usuário</title>

	<indexterm><primary>accounts</primary> <secondary>user</secondary></indexterm>

	<para>As contas de usuários são atribuídas a pessoas reais e são usadas para efetuar login e usar o sistema. Todas as pessoas que acessam o sistema devem ter uma conta de usuário exclusiva. Isso permite que o administrador descubra quem está fazendo o que e impede que usuários alterem as configurações de outros usuários.</para>

	<para>Cada usuário pode configurar seu próprio ambiente para adequar o sistema ao seu uso, utilizando suas opções padrão para o shell, editor, atalhos de teclado e idioma.</para>

	<para>Cada conta de usuário em um sistema FreeBSD tem certas informações associadas:</para>

	<variablelist>
	  <varlistentry>
	    <term>Nome de usuário</term>

	    <listitem>
	      <para>O nome do usuário é digitado no prompt <prompt>login:</prompt>. Cada usuário deve ter um nome de usuário exclusivo. Existem diversas regras para criar nomes de usuário válidos que estão documentadas em <citerefentry><refentrytitle>passwd</refentrytitle><manvolnum>5</manvolnum></citerefentry>. Recomenda-se usar nomes de usuário que tenham oito ou menos caracteres, todos os caracteres devem ser minúsculos para manter a compatibilidade com aplicativos legados.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term>Senha</term>

	    <listitem>
	      <para>Cada conta tem uma senha associada.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term>ID do usuário (<acronym>UID</acronym>)</term>

	    <listitem>
	      <para>O ID do Usuário (<acronym>UID</acronym>) é um número usado para identificar unicamente o usuário no sistema FreeBSD. Comandos que permitem que um nome de usuário seja especificado o converterão para o <acronym>UID</acronym>. Recomenda-se usar um UID menor que 65535, já que valores mais altos podem causar problemas de compatibilidade com alguns softwares.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term>ID do grupo (<acronym>GID</acronym>)</term>

	    <listitem>
	      <para>O ID do grupo (<acronym>GID</acronym>) é um número usado para identificar unicamente o grupo principal ao qual o usuário pertence. Os grupos são um mecanismo para controlar o acesso a recursos com base no <acronym>GID</acronym> de um usuário, em vez de no seu <acronym>UID</acronym>. Isso pode reduzir significativamente o tamanho de alguns arquivos de configuração e permite que os usuários sejam membros de mais de um grupo. Recomenda-se usar um GID de 65535 ou inferior, pois GIDs mais altos podem não funcionar com alguns softwares.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term>Classe de login</term>

	    <listitem>
	      <para>As classes de login são uma extensão do mecanismo de grupo que fornece flexibilidade adicional ao configurar o sistema para diferentes usuários. As classes de login são discutidas em <xref linkend="users-limiting"/>.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term>Tempo para mudança de senha</term>

	    <listitem>
	      <para>Por padrão as senhas não expiram. No entanto, a expiração de senha pode ser ativada por usuário, forçando alguns ou todos os usuários a alterar suas senhas após um determinado período de tempo.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term>Tempo de expiração da conta</term>

	    <listitem>
	      <para>Por padrão o FreeBSD não expira contas. Ao criar contas que precisam de uma vida útil limitada, como contas de alunos em uma escola, especifique a data de expiração da conta usando o <citerefentry><refentrytitle>pw</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Após o tempo de expiração, a conta não poderá ser usada para efetuar login no sistema, embora os diretórios e arquivos da conta permaneçam no servidor.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term>Nome completo do usuário</term>

	    <listitem>
	      <para>O nome de usuário identifica a conta de forma única para o FreeBSD, mas não reflete necessariamente o nome real do usuário. Semelhante a um comentário, essas informações podem conter espaços, caracteres maiúsculos e ter mais de oito caracteres.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term>Diretório Inicial (home)</term>

	    <listitem>
	      <para>O diretório "home" é um caminho completo para um diretório no sistema. Este é o diretório inicial do usuário quando o usuário faz o login. Uma convenção comum é colocar todos os diretórios home dos usuários em <filename><replaceable>/home/username</replaceable></filename> ou <filename><replaceable>/usr/home/username</replaceable></filename>. Cada usuário armazena seus arquivos e subdiretórios pessoais em seu próprio diretório home.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term>Shell do usuário</term>

	    <listitem>
	      <para>O shell fornece o ambiente padrão do usuário para interagir com o sistema. Existem muitos tipos diferentes de shells e usuários experientes terão suas próprias preferências, que podem ser refletidas nas suas configurações da conta.</para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </sect3>

      <sect3 xml:id="users-superuser">
	<title>A conta de superusuário</title>

	<indexterm><primary>accounts</primary> <secondary>superuser (root)</secondary></indexterm>

	<para>A conta de superusuário, geralmente chamada de <systemitem class="username">root</systemitem>, é usada para gerenciar o sistema sem limitações de privilégios. Por este motivo, não deve ser usado para tarefas do dia-a-dia, como enviar e receber e-mail, exploração geral do sistema ou programação.</para>

	<para>O superusuário, ao contrário de outras contas de usuário, pode operar sem limites, e o uso indevido da conta de superusuário pode resultar em desastres espetaculares. As contas de usuário não podem destruir o sistema operacional por engano, por isso é recomendável fazer o login como uma conta de usuário e se tornar o superusuário somente quando um comando exigir privilégios extras.</para>

	<para>Sempre cheque duas ou três vezes todos os comandos emitidos como superusuário, pois um espaço extra ou um caractere ausente pode causar uma perda de dados irreparável.</para>

	<para>Existem várias maneiras de obter privilégios de superusuário. Embora seja possível efetuar login como <systemitem class="username">root</systemitem>, isso é altamente desencorajado.</para>

	<para>Em vez disso, use <citerefentry><refentrytitle>su</refentrytitle><manvolnum>1</manvolnum></citerefentry> para se tornar o superusuário. Se <literal>-</literal> for especificado ao executar este comando, o usuário também herdará o ambiente do usuário root. O usuário que executa este comando deve estar no grupo <systemitem class="groupname">wheel</systemitem> ou o comando falhará. O usuário também deve saber a senha da conta de usuário <systemitem class="username">root</systemitem>.</para>

	<para>Neste exemplo, o usuário só se torna superusuário para executar <command>make install</command>, pois isso requer privilégios de superusuário. Quando o comando é concluído, o usuário digita <command>exit</command> para deixar a conta de superusuário e retornar à sua conta de usuário.</para>

	<example>
	  <title>Instalar um programa como superusuário</title>

	  <screen><prompt>%</prompt> <userinput>configure</userinput>
<prompt>%</prompt> <userinput>make</userinput>
<prompt>%</prompt> <userinput>su -</userinput>
Password:
<prompt>#</prompt> <userinput>make install</userinput>
<prompt>#</prompt> <userinput>exit</userinput>
<prompt>%</prompt></screen>
	</example>

	<para>O framework integrado <citerefentry><refentrytitle>su</refentrytitle><manvolnum>1</manvolnum></citerefentry> funciona bem para sistemas isolados ou redes pequenas com apenas um administrador. Uma alternativa é instalar o pacote ou port <package>security/sudo</package>. Este software fornece registro de atividades e permite ao administrador configurar quais usuários podem executar quais comandos como superusuário.</para>
      </sect3>
    </sect2>

    <sect2 xml:id="users-modifying">
      <title>Gerenciando Contas</title>

      <indexterm><primary>accounts</primary> <secondary>modifying</secondary></indexterm>

      <para>O FreeBSD fornece uma variedade de diferentes comandos para gerenciar contas de usuários. Os comandos mais comuns são descritos em <xref linkend="users-modifying-utilities"/>, seguidos por alguns exemplos de seu uso. Veja a página de manual para cada utilitário para maiores detalhes e exemplos de uso.</para>

      <table frame="none" pgwide="1" xml:id="users-modifying-utilities">
	<title>Utilitários para gerenciar contas de usuários</title>

	<tgroup cols="2">
	  <colspec colwidth="1*"/>
	  <colspec colwidth="2*"/>

	  <thead>
	    <row>
	      <entry>Comando</entry>
	      <entry>Resumo</entry>
	    </row>
	  </thead>
	  <tbody>
	    <row>
	      <entry><citerefentry><refentrytitle>adduser</refentrytitle><manvolnum>8</manvolnum></citerefentry></entry>
	      <entry>Aplicativo de linha de comando recomendado para adicionar novos usuários.</entry>
	    </row>

	    <row>
	      <entry><citerefentry><refentrytitle>rmuser</refentrytitle><manvolnum>8</manvolnum></citerefentry></entry>
	      <entry>Aplicativo de linha de comando recomendado para remover usuários.</entry>
	    </row>

	    <row>
	      <entry><citerefentry><refentrytitle>chpass</refentrytitle><manvolnum>1</manvolnum></citerefentry></entry>
	      <entry>Uma ferramenta flexível para alterar as informações do usuário.</entry>
	    </row>

	    <row>
	      <entry><citerefentry><refentrytitle>passwd</refentrytitle><manvolnum>1</manvolnum></citerefentry></entry>
	      <entry>Ferramenta de linha de comando para alterar senhas de usuários.</entry>
	    </row>

	    <row>
	      <entry><citerefentry><refentrytitle>pw</refentrytitle><manvolnum>8</manvolnum></citerefentry></entry>
	      <entry>Uma ferramenta poderosa e flexível para modificar todos os aspectos das contas de usuário.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <sect3 xml:id="users-adduser">
	<title><command>adduser</command></title>

	<indexterm><primary>accounts</primary> <secondary>adding</secondary></indexterm>
	<indexterm><primary><command>adduser</command></primary></indexterm>
	<indexterm><primary><filename>/usr/share/skel</filename></primary></indexterm>
	<indexterm><primary>skeleton directory</primary></indexterm>

	<para>O programa recomendado para adicionar novos usuários é o <citerefentry><refentrytitle>adduser</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Quando um novo usuário é adicionado, este programa atualiza automaticamente o <filename>/etc/passwd</filename> e o <filename>/etc/group</filename>. Ele também cria um diretório inicial para o novo usuário, copia os arquivos de configuração padrão de <filename>/usr/share/skel</filename> e pode, opcionalmente, enviar uma nova mensagem de boas-vindas ao novo usuário. Este utilitário deve ser executado como o superusuário.</para>

	<para>O utilitário <citerefentry><refentrytitle>adduser</refentrytitle><manvolnum>8</manvolnum></citerefentry> é interativo e percorre as etapas para criar uma nova conta de usuário. Como visto em <xref linkend="users-modifying-adduser"/>, insira as informações necessárias ou pressione <keycap>Enter</keycap> para aceitar o valor padrão mostrado entre colchetes. Neste exemplo, o usuário foi convidado para o grupo <systemitem class="groupname">wheel</systemitem>, permitindo que ele se tornasse o superusuário com o uso do <citerefentry><refentrytitle>su</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Quando terminar, o utilitário perguntará se deseja criar outro usuário ou finalizar o comando.</para>

	<example xml:id="users-modifying-adduser">
	  <title>Adicionando um usuário no FreeBSD</title>

	  <screen><prompt>#</prompt> <userinput>adduser</userinput>
Username: <userinput>jru</userinput>
Full name: <userinput>J. Random User</userinput>
Uid (Leave empty for default):
Login group [jru]:
Login group is jru. Invite jru into other groups? []: <userinput>wheel</userinput>
Login class [default]:
Shell (sh csh tcsh zsh nologin) [sh]: <userinput>zsh</userinput>
Home directory [/home/jru]:
Home directory permissions (Leave empty for default):
Use password-based authentication? [yes]:
Use an empty password? (yes/no) [no]:
Use a random password? (yes/no) [no]:
Enter password:
Enter password again:
Lock out the account after creation? [no]:
Username   : jru
Password   : ****
Full Name  : J. Random User
Uid        : 1001
Class      :
Groups     : jru wheel
Home       : /home/jru
Shell      : /usr/local/bin/zsh
Locked     : no
OK? (yes/no): <userinput>yes</userinput>
adduser: INFO: Successfully added (jru) to the user database.
Add another user? (yes/no): <userinput>no</userinput>
Goodbye!
<prompt>#</prompt></screen>
	</example>

	<note>
	  <para>Como a senha não é mostrada quando digitada, tenha cuidado para não digitar a senha incorretamente ao criar a conta do usuário.</para>
	</note>
      </sect3>

      <sect3 xml:id="users-rmuser">
	<title><command>rmuser</command></title>

	<indexterm><primary><command>rmuser</command></primary></indexterm>
	<indexterm><primary>accounts</primary> <secondary>removing</secondary></indexterm>

	<para>Para remover completamente um usuário do sistema, execute o <citerefentry><refentrytitle>rmuser</refentrytitle><manvolnum>8</manvolnum></citerefentry> como o superusuário. Este comando executa as seguintes etapas:</para>

	<procedure>
	  <step>
	    <para>Remove a entrada <citerefentry><refentrytitle>crontab</refentrytitle><manvolnum>1</manvolnum></citerefentry> do usuário, se existir.</para>
	  </step>

	  <step>
	    <para>Remove todas as tarefas <citerefentry><refentrytitle>at</refentrytitle><manvolnum>1</manvolnum></citerefentry> pertencentes ao usuário.</para>
	  </step>

	  <step>
	    <para>Elimina todos os processos pertencentes ao usuário.</para>
	  </step>

	  <step>
	    <para>Remove o usuário do arquivo de senhas do sistema.</para>
	  </step>

	  <step>
	    <para>Opcionalmente, remove o diretório pessoal do usuário, se ele for de propriedade do usuário.</para>
	  </step>

	  <step>
	    <para>Remove os arquivos de mensagens recebidas pertencentes ao usuário de <filename>/var/mail</filename>.</para>
	  </step>

	  <step>
	    <para>Remove todos os arquivos pertencentes ao usuário das áreas de armazenamento de arquivos temporários, como <filename>/tmp</filename>.</para>
	  </step>

	  <step>
	    <para>Finalmente, remove o nome de usuário de todos os grupos aos quais ele pertence em <filename>/etc/group</filename>. Se um grupo ficar vazio e o nome do grupo for o mesmo que o nome de usuário, o grupo será removido. Isso complementa os grupos exclusivos por usuário criados por <citerefentry><refentrytitle>adduser</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
	  </step>
	</procedure>

	<para>O <citerefentry><refentrytitle>rmuser</refentrytitle><manvolnum>8</manvolnum></citerefentry> não pode ser usado para remover contas de superusuário, pois isso quase sempre ocasiona uma de destruição em massa.</para>

	<para>Por padrão, um modo interativo é usado, conforme mostrado no exemplo a seguir.</para>

	<example>
	  <title>Remoção de contas interativas com o <command>rmuser</command></title>

	  <screen><prompt>#</prompt> <userinput>rmuser jru</userinput>
Matching password entry:
jru:*:1001:1001::0:0:J. Random User:/home/jru:/usr/local/bin/zsh
Is this the entry you wish to remove? <userinput>y</userinput>
Remove user's home directory (/home/jru)? <userinput>y</userinput>
Removing user (jru): mailspool home passwd.
<prompt>#</prompt></screen>
	</example>
      </sect3>

      <sect3 xml:id="users-chpass">
	<title><command>chpass</command></title>

	<indexterm><primary><command>chpass</command></primary></indexterm>

	<para>Qualquer usuário pode usar o <citerefentry><refentrytitle>chpass</refentrytitle><manvolnum>1</manvolnum></citerefentry> para alterar seu shell padrão e informações pessoais associadas à sua conta de usuário. O superusuário pode usar esse utilitário para alterar informações adicionais da conta de qualquer usuário.</para>

	<para>Quando não há opções, além de um nome de usuário opcional, o <citerefentry><refentrytitle>chpass</refentrytitle><manvolnum>1</manvolnum></citerefentry> exibe um editor contendo informações do usuário. Quando o usuário sai do editor, o banco de dados do usuário é atualizado com as novas informações.</para>

	<note>
	  <para>Este utilitário solicitará a senha do usuário ao sair do editor, a menos que o utilitário seja executado como superusuário.</para>
	</note>

	<para>Em <xref linkend="users-modifying-chpass-su"/>, o superusuário digitou <command>chpass jru</command> e agora está visualizando os campos que podem ser alterados para este usuário. Se <systemitem class="username">jru</systemitem> executar este comando, apenas os últimos seis campos serão exibidos e estarão disponíveis para edição. Isso é mostrado em <xref linkend="users-modifying-chpass-ru"/>.</para>

	<example xml:id="users-modifying-chpass-su">
	  <title>Usando o <command>chpass</command> como superusuário</title>

	  <screen>#Changing user database information for jru.
Login: jru
Password: *
Uid [#]: 1001
Gid [# or name]: 1001
Change [month day year]:
Expire [month day year]:
Class:
Home directory: /home/jru
Shell: /usr/local/bin/zsh
Full Name: J. Random User
Office Location:
Office Phone:
Home Phone:
Other information:</screen>
	</example>

	<example xml:id="users-modifying-chpass-ru">
	  <title>Usando o <command>chpass</command> como usuário regular</title>

	  <screen>#Changing user database information for jru.
Shell: /usr/local/bin/zsh
Full Name: J. Random User
Office Location:
Office Phone:
Home Phone:
Other information:</screen>
	</example>

	<note>
	  <para>Os comandos <citerefentry><refentrytitle>chfn</refentrytitle><manvolnum>1</manvolnum></citerefentry> e <citerefentry><refentrytitle>chsh</refentrytitle><manvolnum>1</manvolnum></citerefentry> são links para <citerefentry><refentrytitle>chpass</refentrytitle><manvolnum>1</manvolnum></citerefentry>, como são <citerefentry><refentrytitle>ypchpass</refentrytitle><manvolnum>1</manvolnum></citerefentry>, <citerefentry><refentrytitle>ypchfn</refentrytitle><manvolnum>1</manvolnum></citerefentry>e<citerefentry><refentrytitle>ypchsh</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Já que o suporte ao  <acronym>NIS</acronym> é automático, colocar o <literal>yp</literal> antes do comando não é necessário. Os procedimentos para configurar o NIS está documentado em <xref linkend="network-servers"/>.</para>
	</note>
      </sect3>

      <sect3 xml:id="users-passwd">
	<title><command>passwd</command></title>

	<indexterm><primary><command>passwd</command></primary></indexterm>
	<indexterm><primary>accounts</primary> <secondary>changing password</secondary></indexterm>

	<para>Qualquer usuário pode alterar facilmente sua senha usando o <citerefentry><refentrytitle>passwd</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Para prevenir alterações acidentais ou não autorizadas, este comando irá solicitar a senha atual  ao usuário antes de configurar uma nova senha:</para>

	<example>
	  <title>Alterando Sua Senha</title>

	  <screen><prompt>%</prompt> <userinput>passwd</userinput>
Changing local password for jru.
Old password:
New password:
Retype new password:
passwd: updating the database...
passwd: done</screen>
	</example>

	<para>O superusuário pode alterar a senha de qualquer usuário especificando o nome de usuário ao executar o <citerefentry><refentrytitle>passwd</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Quando este utilitário é executado como superusuário, ele não solicita a senha atual do usuário. Isso permite que a senha seja alterada quando um usuário não consegue lembrar a senha original.</para>

	<example>
	  <title>Mudando a senha de outro usuário como superusuário</title>

	  <screen><prompt>#</prompt> <userinput>passwd jru</userinput>
Changing local password for jru.
New password:
Retype new password:
passwd: updating the database...
passwd: done</screen>
	</example>

	<note>
	  <para>Como com o <citerefentry><refentrytitle>chpass</refentrytitle><manvolnum>1</manvolnum></citerefentry>, o <citerefentry><refentrytitle>yppasswd</refentrytitle><manvolnum>1</manvolnum></citerefentry> é um link para <citerefentry><refentrytitle>passwd</refentrytitle><manvolnum>1</manvolnum></citerefentry>, então o <acronym>NIS</acronym> funciona com ambos os comandos.</para>
	</note>
      </sect3>

      <sect3 xml:id="users-pw">
	<title><command>pw</command></title>

	<indexterm><primary><command>pw</command></primary></indexterm>

	<para>O utilitário <citerefentry><refentrytitle>pw</refentrytitle><manvolnum>8</manvolnum></citerefentry> pode criar, remover, modificar e exibir usuários e grupos. Funciona como um front-end para o usuário do sistema e para os arquivos de grupo. O <citerefentry><refentrytitle>pw</refentrytitle><manvolnum>8</manvolnum></citerefentry> tem um conjunto muito poderoso de opções de linha de comando que o torna adequado para uso em shell scripts, mas novos usuários podem achar isso mais complicado que os outros comandos apresentados nesta seção.</para>
      </sect3>
    </sect2>

    <sect2 xml:id="users-groups">
      <title>Gerenciando Grupos</title>

      <indexterm><primary>groups</primary></indexterm>
      <indexterm><primary><filename>/etc/groups</filename></primary></indexterm>
      <indexterm><primary>accounts</primary> <secondary>groups</secondary></indexterm>

      <para>Um grupo é uma lista de usuários. Um grupo é identificado pelo nome do grupo e pelo <acronym>GID</acronym>. No FreeBSD, o kernel usa o <acronym>UID</acronym> de um processo, e a lista de grupos a que pertence, para determinar o que o processo pode fazer. Na maioria das vezes, o <acronym>GID</acronym> de um usuário ou processo geralmente significa o primeiro grupo na lista.</para>

      <para>O mapeamento do nome do grupo para o <acronym>GID</acronym> está listado em <filename>/etc/group</filename>. Este é um arquivo de texto simples com quatro campos delimitados por dois pontos. O primeiro campo é o nome do grupo, o segundo é a senha criptografada, o terceiro é o <acronym>GID</acronym> e o quarto é a lista de membros delimitados por vírgulas. Para uma descrição mais completa da sintaxe, consulte <citerefentry><refentrytitle>group</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>

      <para>O superusuário pode modificar o <filename>/etc/group</filename> usando um editor de texto. Alternativamente, o <citerefentry><refentrytitle>pw</refentrytitle><manvolnum>8</manvolnum></citerefentry> pode ser usado para adicionar e editar grupos. Por exemplo, para adicionar um grupo chamado <systemitem class="groupname">teamtwo</systemitem> e confirmar se ele existe:</para>

      <example>
	<title>Adicionando um grupo usando o <citerefentry><refentrytitle>pw</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

	<screen><prompt>#</prompt> <userinput>pw groupadd teamtwo</userinput>
<prompt>#</prompt> <userinput>pw groupshow teamtwo</userinput>
teamtwo:*:1100:</screen>
      </example>

      <para>Neste exemplo, <literal>1100</literal> é o <acronym>GID</acronym> de <systemitem class="groupname">teamtwo</systemitem>. No momento, <systemitem class="groupname">teamtwo</systemitem> não possui membros. Este comando adicionará <systemitem class="username">jru</systemitem> como um membro de <systemitem class="groupname">teamtwo</systemitem>.</para>

      <example>
	<title>Adicionando contas de usuários a um novo grupo usando o <citerefentry><refentrytitle>pw</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

	<screen><prompt>#</prompt> <userinput>pw groupmod teamtwo -M jru</userinput>
<prompt>#</prompt> <userinput>pw groupshow teamtwo</userinput>
teamtwo:*:1100:jru</screen>
      </example>

      <para>O argumento para a opção <option>-M</option> é uma lista de usuários, delimitada por vírgulas, a serem adicionados a um novo grupo (vazio) ou para substituir os membros de um grupo existente. Para o usuário, essa associação ao grupo é diferente (e adicional ao) do grupo principal do usuário listado no arquivo de senha. Isso significa que o usuário não aparecerá como membro ao usar a opção <option>groupshow</option> com o <citerefentry><refentrytitle>pw</refentrytitle><manvolnum>8</manvolnum></citerefentry>, mas mostrará quando a informação é consultada via <citerefentry><refentrytitle>id</refentrytitle><manvolnum>1</manvolnum></citerefentry> ou uma ferramenta similar. Quando o <citerefentry><refentrytitle>pw</refentrytitle><manvolnum>8</manvolnum></citerefentry> é usado para adicionar um usuário a um grupo, ele apenas manipula o <filename>/etc/group</filename> e não tenta ler dados adicionais do <filename>/etc/passwd</filename>.</para>

      <example>
	<title>Adicionando um novo membro a um grupo usando o <citerefentry><refentrytitle>pw</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

	<screen><prompt>#</prompt> <userinput>pw groupmod teamtwo -m db</userinput>
<prompt>#</prompt> <userinput>pw groupshow teamtwo</userinput>
teamtwo:*:1100:jru,db</screen>
      </example>

      <para>Neste exemplo, o argumento para <option>-m</option> é uma lista delimitada por vírgulas de usuários que devem ser adicionados ao grupo. Ao contrário do exemplo anterior, esses usuários são adicionados ao grupo e não substituem usuários existentes no grupo.</para>

      <example>
	<title>Usando o <citerefentry><refentrytitle>id</refentrytitle><manvolnum>1</manvolnum></citerefentry> para determinar a associação ao grupo</title>

	<screen><prompt>%</prompt> <userinput>id jru</userinput>
uid=1001(jru) gid=1001(jru) groups=1001(jru), 1100(teamtwo)</screen>
      </example>

      <para>Neste exemplo, <systemitem class="username">jru</systemitem> é um membro dos grupos <systemitem class="groupname">jru</systemitem> e <systemitem class="groupname">teamtwo</systemitem>.</para>

      <para>Para obter mais informações sobre este comando e o formato do <filename>/etc/group</filename>, consulte <citerefentry><refentrytitle>pw</refentrytitle><manvolnum>8</manvolnum></citerefentry> e <citerefentry><refentrytitle>group</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="permissions">
    <title>Permissões</title>

    <indexterm><primary>UNIX</primary></indexterm>

    <para>No FreeBSD, todo arquivo e diretório tem um conjunto associado de permissões e vários utilitários estão disponíveis para visualizar e modificar essas permissões. É necessário entender como as permissões funcionam para garantir que os usuários consigam acessar os arquivos que precisam e não consigam acessar os arquivos usados pelo sistema operacional ou de propriedade de outros usuários.</para>

    <para>Esta seção discute as permissões <trademark class="registered">UNIX</trademark> tradicionais usadas no FreeBSD. Para um controle de acesso ao sistema de arquivos mais refinado, consulte <xref linkend="fs-acl"/>.</para>

    <para>No <trademark class="registered">UNIX</trademark>, as permissões básicas são atribuídas usando três tipos de acesso: ler, escrever e executar. Esses tipos de acesso são usados para determinar o acesso do arquivo ao proprietário, ao grupo e a outros usuários do arquivo (todos os outros). As permissões de leitura, gravação e execução podem ser representadas como as letras <literal>r</literal>, <literal>w</literal> e <literal>x</literal>. Elas também podem ser representados como números binários, pois cada permissão está ativada ou desativada (<literal>0</literal>). Quando representada como um número, a ordem é sempre lida como <literal>rwx</literal>, onde <literal>r</literal> é ativado com o valor <literal>4</literal>, <literal>w</literal> é ativado com o valor <literal>2</literal> e <literal>x</literal> é ativado com o valor <literal>1</literal>.</para>

    <para>A Tabela 4.1 resume as possíveis possibilidades numéricas e alfabéticas. Ao ler a coluna <quote>Listagem do Diretório</quote>, um <literal>-</literal> é usado para representar uma permissão que está desativada.</para>

    <indexterm><primary>permissions</primary></indexterm>
    <indexterm><primary>file permissions</primary></indexterm>

    <table frame="none" pgwide="1">
      <title>Permissões <trademark class="registered">UNIX</trademark></title>

      <tgroup cols="3">
	<thead>
	  <row>
	    <entry>Valor</entry>
	    <entry>Permissão</entry>
	    <entry>Listagem de diretório</entry>
	  </row>
	</thead>

	<tbody>
	  <row>
	    <entry>0</entry>
	    <entry>Sem leitura, sem escrita, sem execução</entry>
	    <entry><literal>---</literal></entry>
	  </row>

	  <row>
	    <entry>1</entry>
	    <entry>Sem leitura, sem escrita, execução</entry>
	    <entry><literal>--x</literal></entry>
	  </row>

	  <row>
	    <entry>2</entry>
	    <entry>Sem leitura, escrita, sem execução</entry>
	    <entry><literal>-w-</literal></entry>
	  </row>

	  <row>
	    <entry>3</entry>
	    <entry>Sem leitura, escrita, execução</entry>
	    <entry><literal>-wx</literal></entry>
	  </row>

	  <row>
	    <entry>4</entry>
	    <entry>Leitura, sem escrita, sem execução</entry>
	    <entry><literal>r--</literal></entry>
	  </row>

	  <row>
	    <entry>5</entry>
	    <entry>Leitura, sem escrita, execução</entry>
	    <entry><literal>r-x</literal></entry>
	  </row>

	  <row>
	    <entry>6</entry>
	    <entry>Leitura, escrita, sem execução</entry>
	    <entry><literal>rw-</literal></entry>
	  </row>

	  <row>
	    <entry>7</entry>
	    <entry>Leitura, escrita, execução</entry>
	    <entry><literal>rwx</literal></entry>
	  </row>
	</tbody>
      </tgroup>
    </table>

    <indexterm><primary><citerefentry><refentrytitle>ls</refentrytitle><manvolnum>1</manvolnum></citerefentry></primary></indexterm>
    <indexterm><primary>directories</primary></indexterm>

    <para>Use o argumento <option>-l</option> com o <citerefentry><refentrytitle>ls</refentrytitle><manvolnum>1</manvolnum></citerefentry> para exibir uma lista longa de diretórios que inclua uma coluna de informações sobre um permissões do arquivo para o proprietário, grupo e outros. Por exemplo, um <command>ls -l</command> em um diretório arbitrário pode mostrar:</para>

    <screen><prompt>%</prompt> <userinput>ls -l</userinput>
total 530
-rw-r--r--  1 root  wheel     512 Sep  5 12:31 myfile
-rw-r--r--  1 root  wheel     512 Sep  5 12:31 otherfile
-rw-r--r--  1 root  wheel    7680 Sep  5 12:31 email.txt</screen>

    <para>O primeiro caractere (mais à esquerda) da primeira coluna indica se esse arquivo é um arquivo normal, um diretório, um dispositivo de caractere especial, um soquete ou qualquer outro dispositivo especial de pseudo-arquivo. Neste exemplo, o <literal>-</literal> indica um arquivo regular. Os próximos três caracteres, <literal>rw-</literal> neste exemplo, fornecem as permissões para o proprietário do arquivo. Os próximos três caracteres, <literal>r--</literal>, fornecem as permissões para o grupo ao qual o arquivo pertence. Os três últimos caracteres, <literal>r--</literal>, dão as permissões para o resto do mundo. Um traço significa que a permissão está desativada. Neste exemplo, as permissões são definidas para que o proprietário possa ler e gravar no arquivo, o grupo possa ler o arquivo e o resto do mundo só possa ler o arquivo. De acordo com a tabela acima, as permissões para este arquivo seriam <literal>644</literal>, onde cada dígito representa uma das três partes da permissão do arquivo.</para>

    <para>Como o sistema controla as permissões nos dispositivos? O FreeBSD trata a maioria dos dispositivos de hardware como um arquivo nos quais os programas podem abrir, ler e gravar dados. Esses arquivos de dispositivos especiais são armazenados em <filename>/dev/</filename>.</para>

    <para>Diretórios também são tratados como arquivos. Eles tem permissões de leitura, gravação e execução. O bit executável de um diretório tem um significado ligeiramente diferente que nos arquivos. Quando um diretório é marcado como executável, isso significa que é possível mudar para esse diretório usando <citerefentry><refentrytitle>cd</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Isso também significa que é possível acessar os arquivos dentro desse diretório, sujeito às permissões dos próprios arquivos.</para>

    <para>Para executar uma listagem de diretórios, a permissão de leitura deve estar ativada no diretório. Para deletar um arquivo que se conhece o nome, é necessário ter permissões de escrita <emphasis>e</emphasis> execução no diretório que contém o arquivo.</para>

    <para>Há mais bits de permissão, mas eles são usados principalmente em circunstâncias especiais, como binários setuid e diretórios fixos. Para obter mais informações sobre permissões de arquivos e como configurá-las, consulte <citerefentry><refentrytitle>chmod</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</para>

    <sect2>
      <info>
	<title>Permissões simbólicas</title>

	<authorgroup>
	  <author><personname> <firstname>Tom</firstname> <surname>Rhodes</surname> </personname> <contrib>Contribuído por </contrib></author>
	</authorgroup>
      </info>

      <indexterm><primary>permissions</primary> <secondary>symbolic</secondary></indexterm>

      <para>Permissões simbólicas usam caracteres em vez de valores octais para atribuir permissões a arquivos ou diretórios. Permissões simbólicas usam a sintaxe de (quem) (ação) (permissões), onde os seguintes valores estão disponíveis:</para>

      <informaltable frame="none" pgwide="1">
	<tgroup cols="3">
	  <thead>
	    <row>
	      <entry>Opção</entry>
	      <entry>Letra</entry>
	      <entry>Representa</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry>(quem)</entry>
	      <entry>u</entry>
	      <entry>Usuário</entry>
	    </row>

	    <row>
	      <entry>(quem)</entry>
	      <entry>g</entry>
	      <entry>Grupo</entry>
	    </row>

	    <row>
	      <entry>(quem)</entry>
	      <entry>o</entry>
	      <entry>Outros</entry>
	    </row>

	    <row>
	      <entry>(quem)</entry>
	      <entry>a</entry>
	      <entry>Todos (<quote>resto do mundo</quote>)</entry>
	    </row>

	    <row>
	      <entry>(açao)</entry>
	      <entry>+</entry>
	      <entry>Adiciona permissões</entry>
	    </row>

	    <row>
	      <entry>(açao)</entry>
	      <entry>-</entry>
	      <entry>Remove permissões</entry>
	    </row>

	    <row>
	      <entry>(açao)</entry>
	      <entry>=</entry>
	      <entry>Permissões definidas explicitamente</entry>
	    </row>

	    <row>
	      <entry>(permissões)</entry>
	      <entry>r</entry>
	      <entry>Leitura</entry>
	    </row>

	    <row>
	      <entry>(permissões)</entry>
	      <entry>w</entry>
	      <entry>Escrita</entry>
	    </row>

	    <row>
	      <entry>(permissões)</entry>
	      <entry>x</entry>
	      <entry>Execução</entry>
	    </row>

	    <row>
	      <entry>(permissões)</entry>
	      <entry>t</entry>
	      <entry>bit fixador</entry>
	    </row>

	    <row>
	      <entry>(permissões)</entry>
	      <entry>s</entry>
	      <entry>Set UID ou GID</entry>
	    </row>
	  </tbody>
	</tgroup>
      </informaltable>

      <para>Esses valores são usados com o <citerefentry><refentrytitle>chmod</refentrytitle><manvolnum>1</manvolnum></citerefentry>, mas com letras em vez de números. Por exemplo, o comando a seguir impediria que outros usuários acessassem <replaceable>FILE</replaceable>:</para>

      <screen><prompt>%</prompt> <userinput>chmod go= FILE</userinput></screen>

      <para>Uma lista separada por vírgula pode ser fornecida quando mais de um conjunto de alterações em um arquivo precisar ser feito. Por exemplo, o comando a seguir remove as permissões de gravação do grupo e <quote>resto do mundo</quote> no <replaceable>FILE</replaceable> e adiciona as permissões de execução para todos:</para>

      <screen><prompt>%</prompt> <userinput>chmod go-w,a+x <replaceable>FILE</replaceable></userinput></screen>

<!--
      <para>Most users will not notice this, but it should be pointed
	out that using the octal method will only set or assign
	permissions to a file; it does not add or delete them.</para>
-->
    </sect2>

    <sect2>
      <info>
	<title>Flags de arquivos no FreeBSD</title>

	<authorgroup>
	  <author><personname> <firstname>Tom</firstname> <surname>Rhodes</surname> </personname> <contrib>Contribuído por </contrib></author>
	</authorgroup>
      </info>

      <para>Além das permissões de arquivo, o FreeBSD suporta o uso de <quote>flags de arquivo</quote>. Esses sinalizadores adicionam um nível a mais de segurança e controle sobre os arquivos, mas não nos diretórios. Com flags de arquivos, mesmo o <systemitem class="username">root</systemitem> pode ser impedido de remover ou alterar arquivos.</para>

      <para>Os sinalizadores de arquivo são modificados usando o <citerefentry><refentrytitle>chflags</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Por exemplo, para ativar o sinalizador undeletable do sistema no arquivo <filename>file1</filename>, use o seguinte comando:</para>

      <screen><prompt>#</prompt> <userinput>chflags sunlink file1</userinput></screen>

      <para>Para desabilitar o sinalizador undeletable do sistema, coloque um <quote>no</quote> na frente do <option>sunlink</option>:</para>

      <screen><prompt>#</prompt> <userinput>chflags nosunlink file1</userinput></screen>

      <para>Para visualizar os sinalizadores de um arquivo, use <option>-lo</option> com o <citerefentry><refentrytitle>ls</refentrytitle><manvolnum>1</manvolnum></citerefentry>:</para>

      <screen><prompt>#</prompt> <userinput>ls -lo file1</userinput></screen>

      <programlisting>-rw-r--r-- 1 trhodes trhodes sunlnk 0 Mar 1 05:54 file1</programlisting>

      <para>Vários flags de arquivo só podem ser adicionados ou removidos pelo usuário <systemitem class="username">root</systemitem>. Em outros casos, o proprietário do arquivo pode definir seus sinalizadores. Consulte <citerefentry><refentrytitle>chflags</refentrytitle><manvolnum>1</manvolnum></citerefentry> e <citerefentry><refentrytitle>chflags</refentrytitle><manvolnum>2</manvolnum></citerefentry> para maiores informações.</para>
    </sect2>

    <sect2>
      <info>
	<title>As permissões <literal>setuid</literal>, <literal>setgid</literal> e <literal>sticky</literal></title>

	<authorgroup>
	  <author><personname> <firstname>Tom</firstname> <surname>Rhodes</surname> </personname> <contrib>Contribuído por </contrib></author>
	</authorgroup>
      </info>

      <para>Além das permissões já discutidas, existem três outras configurações específicas que todos os administradores devem conhecer. Eles são as permissões <literal>setuid</literal>, <literal>setgid</literal> e <literal>sticky</literal>.</para>

      <para>Essas configurações são importantes para algumas operações <trademark class="registered">UNIX</trademark>, pois fornecem funcionalidades normalmente não concedidas a usuários normais. Para compreendê-los, a diferença entre o ID real de usuário e o ID efetivo de usuário deve ser explicada.</para>

      <para>O ID de usuário real é o <acronym>UID</acronym> que inicia ou é o dono do processo. O ID de usuário efetivo é o <acronym>UID</acronym> do usuário com o qual o processo é executado. Por exemplo, o <citerefentry><refentrytitle>passwd</refentrytitle><manvolnum>1</manvolnum></citerefentry> é executado com o ID do usuário real quando um usuário altera sua senha. No entanto, para atualizar o banco de dados de senhas, o comando é executado como o ID efetivo do usuário <systemitem class="username">root</systemitem>. Isso permite que os usuários alterem suas senhas sem ver um erro <errorname>Permission Denied</errorname>.</para>

      <para>A permissão setuid pode ser definida prefixando um conjunto de permissões com o número quatro (4), conforme mostrado no exemplo a seguir:</para>

      <screen><prompt>#</prompt> <userinput>chmod 4755 suidexample.sh</userinput></screen>

      <para>As permissões em <filename><replaceable>suidexample.sh</replaceable></filename> agora se parecem com o seguinte:</para>

      <programlisting>-rwsr-xr-x   1 trhodes  trhodes    63 Aug 29 06:36 suidexample.sh</programlisting>

      <para>Observe que um <literal>s</literal> agora faz parte do conjunto de permissões designado para o proprietário do arquivo, substituindo o bit executável. Isso viabiliza utilitários que precisam de permissões elevadas, como o <citerefentry><refentrytitle>passwd</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</para>

      <note>
	<para>A opção <literal>nosuid</literal> <citerefentry><refentrytitle>mount</refentrytitle><manvolnum>8</manvolnum></citerefentry> fará com que esses binários falhem silenciosamente sem alertar o usuário. Essa opção não é totalmente confiável, já que um wrapper <literal>nosuid</literal> pode contorná-la.</para>
      </note>

      <para>Para ver isso em tempo real, abra dois terminais. Em um deles, digite <command>passwd</command> como um usuário normal. Enquanto aguarda uma nova senha, verifique a tabela de processos e observe as informações de usuário do <citerefentry><refentrytitle>passwd</refentrytitle><manvolnum>1</manvolnum></citerefentry>:</para>

      <para>No terminal A:</para>

      <screen>Changing local password for trhodes
Old Password:</screen>

      <para>No terminal B:</para>

      <screen><prompt>#</prompt> <userinput>ps aux | grep passwd</userinput></screen>

      <screen>trhodes  5232  0.0  0.2  3420  1608   0  R+    2:10AM   0:00.00 grep passwd
root     5211  0.0  0.2  3620  1724   2  I+    2:09AM   0:00.01 passwd</screen>

      <para>Embora <citerefentry><refentrytitle>passwd</refentrytitle><manvolnum>1</manvolnum></citerefentry> seja executado como um usuário normal, ele está usando o <acronym>UID</acronym> do <systemitem class="username">root</systemitem>.</para>

      <para>A permissão <literal>setgid</literal> executa a mesma função que a permissão <literal>setuid</literal>; exceto que altera as configurações do grupo. Quando um aplicativo ou utilitário é executado com essa configuração, ele recebe as permissões com base no grupo do arquivo, não no usuário que iniciou o processo.</para>

      <para>Para definir a permissão <literal>setgid</literal> em um arquivo, execute o <citerefentry><refentrytitle>chmod</refentrytitle><manvolnum>1</manvolnum></citerefentry> com dois (2) no início:</para>

      <screen><prompt>#</prompt> <userinput>chmod 2755 sgidexample.sh</userinput></screen>

      <para>Na listagem a seguir, observe que o <literal>s</literal> está agora no campo designado para as configurações de permissão do grupo:</para>

      <screen>-rwxr-sr-x   1 trhodes  trhodes    44 Aug 31 01:49 sgidexample.sh</screen>

      <note>
	<para>Nestes exemplos, mesmo que o shell script em questão seja um arquivo executável, ele não será executado com um <acronym>EUID</acronym> diferente ou um ID de usuário efetivo. Isso ocorre porque os shell scripts podem não acessar as chamadas de sistema <citerefentry><refentrytitle>setuid</refentrytitle><manvolnum>2</manvolnum></citerefentry>.</para>
      </note>

      <para>Os bits de permissão <literal>setuid</literal> e <literal>setgid</literal> podem diminuir a segurança do sistema, permitindo permissões elevadas. A terceira permissão especial, o <literal>sticky bit</literal>, pode fortalecer a segurança de um sistema.</para>

      <para>Quando o <literal>sticky bit</literal> é definido em um diretório, ele permite a exclusão de arquivos apenas pelo proprietário do arquivo. Isso é útil para impedir a exclusão de arquivos em diretórios públicos, como <filename>/tmp</filename>, por usuários que não possuem o arquivo. Para utilizar essa permissão, use o um (1) no início das permissões:</para>

      <screen><prompt>#</prompt> <userinput>chmod 1777 /tmp</userinput></screen>

      <para>A permissão <literal>sticky bit</literal> será exibida como um <literal>t</literal> no final do conjunto de permissões:</para>

      <screen><prompt>#</prompt> <userinput>ls -al / | grep tmp</userinput></screen>

      <screen>drwxrwxrwt  10 root  wheel         512 Aug 31 01:49 tmp</screen>

    </sect2>
  </sect1>

  <sect1 xml:id="dirstructure">
    <title>Estrutura de Diretórios</title>

    <indexterm><primary>directory hierarchy</primary></indexterm>

    <para>Entender a hierarquia de diretórios do FreeBSD é fundamental para obter uma compreensão geral do sistema. O diretório mais importante é o root ou raiz ou <quote>/</quote>. Esse diretório é o primeiro montado no momento da inicialização e contém a base do sistema necessária para preparar o sistema operacional para a operação multi-usuário. O diretório raiz também contém pontos de montagem para outros sistemas de arquivos que são montados durante a transição para a operação multi-usuário.</para>

    <para>Um ponto de montagem é um diretório no qual sistemas de arquivos adicionais podem ser disponibilizados em um sistema de arquivos principal (geralmente o sistema de arquivos raiz). Isso é descrito em <xref linkend="disk-organization"/>. Os pontos de montagem padrão incluem <filename>/usr/</filename>, <filename>/var/</filename>, <filename>/tmp/</filename>, <filename>/mnt/</filename> e <filename>/cdrom/</filename>. Esses diretórios são geralmente associados a entradas em <filename>/etc/fstab</filename>. Este arquivo é uma tabela de vários sistemas de arquivos e pontos de montagem e é lido pelo sistema. A maioria dos sistemas de arquivos em <filename>/etc/fstab</filename> é montada automaticamente no momento da inicialização do script <citerefentry><refentrytitle>rc</refentrytitle><manvolnum>8</manvolnum></citerefentry> a não ser que haja a opção <option>noauto</option>. Maiores detalhes em <xref linkend="disks-fstab"/>.</para>

    <para>Uma descrição completa da hierarquia do sistema de arquivos está disponível em <citerefentry><refentrytitle>hier</refentrytitle><manvolnum>7</manvolnum></citerefentry>. A tabela a seguir fornece uma visão geral dos diretórios mais comuns.</para>

    <para>
      <informaltable frame="none" pgwide="1">
	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Diretório</entry>
	      <entry>Descrição</entry>
	    </row>
	  </thead>
	  <tbody valign="top">
	    <row>
	      <entry><filename>/</filename></entry>
	      <entry>Diretório raiz do sistema de arquivos.</entry>
	    </row>

	    <row>
	      <entry><filename>/bin/</filename></entry>
	      <entry>Utilitários de usuário fundamentais para ambientes mono e multi-usuário.</entry>
	    </row>

	    <row>
	      <entry><filename>/boot/</filename></entry>
	      <entry>Programas e arquivos de configuração usados durante o bootstrap do sistema operacional.</entry>
	    </row>

	    <row>
	      <entry><filename>/boot/defaults/</filename></entry>
	      <entry>Arquivos de configuração de inicialização padrão. Consulte <citerefentry><refentrytitle>loader.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry> para maiores detalhes.</entry>
	    </row>

	    <row>
	      <entry><filename>/dev/</filename></entry>
	      <entry>Nós de dispositivo (device nodes). Consulte <citerefentry><refentrytitle>intro</refentrytitle><manvolnum>4</manvolnum></citerefentry> para detalhes.</entry>
	    </row>

	    <row>
	      <entry><filename>/etc/</filename></entry>
	      <entry>Arquivos de configuração do sistema e scripts.</entry>
	    </row>

	    <row>
	      <entry><filename>/etc/defaults/</filename></entry>
	      <entry>Arquivos padrão de configuração do sistema. Consulte <citerefentry><refentrytitle>rc</refentrytitle><manvolnum>8</manvolnum></citerefentry> para maiores detalhes.</entry>
	    </row>

	    <row>
	      <entry><filename>/etc/mail/</filename></entry>
	      <entry>Arquivos de configuração para agentes de transporte de mensagens, como o <citerefentry><refentrytitle>sendmail</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</entry>
	    </row>

	    <row>
	      <entry><filename>/etc/periodic/</filename></entry>
	      <entry>Scripts que são executados diariamente, semanalmente e mensalmente, por meio do <citerefentry><refentrytitle>cron</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Consulte <citerefentry><refentrytitle>periodic</refentrytitle><manvolnum>8</manvolnum></citerefentry> para maiores detalhes.</entry>
	    </row>

	    <row>
	      <entry><filename>/etc/ppp/</filename></entry>
	      <entry>Arquivos de configuração do <citerefentry><refentrytitle>ppp</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</entry>
	    </row>

	    <row>
	      <entry><filename>/mnt/</filename></entry>
	      <entry>Diretório vazio comumente usado pelos administradores do sistema como um ponto de montagem temporário.</entry>
	    </row>

	    <row>
	      <entry><filename>/proc/</filename></entry>
	      <entry>Sistema de arquivos de processos. Consulte <citerefentry><refentrytitle>procfs</refentrytitle><manvolnum>5</manvolnum></citerefentry>, <citerefentry><refentrytitle>mount_procfs</refentrytitle><manvolnum>8</manvolnum></citerefentry> para detalhes.</entry>
	    </row>

	    <row>
	      <entry><filename>/rescue/</filename></entry>
	      <entry>Programas vinculados estaticamente para recuperação de emergência, conforme descrito em <citerefentry><refentrytitle>rescue</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</entry>
	    </row>

	    <row>
	      <entry><filename>/root/</filename></entry>
	      <entry>Diretório da conta <systemitem class="username">root</systemitem>.</entry>
	    </row>

	    <row>
	      <entry><filename>/sbin/</filename></entry>
	      <entry>Programas do sistema e utilitários de administração fundamentais para ambientes mono e multi-usuário.</entry>
	    </row>

	    <row>
	      <entry><filename>/tmp/</filename></entry>
	      <entry>Arquivos temporários que normalmente <emphasis>não</emphasis> são preservados em uma reinicialização do sistema. Um sistema de arquivos baseado em memória é frequentemente montado em <filename>/tmp</filename>. Isso pode ser automatizado usando as variáveis relacionadas ao tmpmfs do <citerefentry><refentrytitle>rc.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry> ou com uma entrada em <filename>/etc/fstab</filename>; consulte <citerefentry><refentrytitle>mdmfs</refentrytitle><manvolnum>8</manvolnum></citerefentry> para maiores detalhes.</entry>
	    </row>

	    <row>
	      <entry><filename>/usr/</filename></entry>
	      <entry>A maioria dos utilitários e aplicativos do usuário.</entry>
	    </row>

	    <row>
	      <entry><filename>/usr/bin/</filename></entry>
	      <entry>Utilitários comuns, ferramentas de programação e aplicativos.</entry>
	    </row>

	    <row>
	      <entry><filename>/usr/include/</filename></entry>
	      <entry>Arquivos para "include" do C padrão.</entry>
	    </row>

	    <row>
	      <entry><filename>/usr/lib/</filename></entry>
	      <entry>Arquivos de biblioteca.</entry>
	    </row>


	    <row>
	      <entry><filename>/usr/libdata/</filename></entry>
	      <entry>Diversos arquivos de dados de utilitários.</entry>
	    </row>

	    <row>
	      <entry><filename>/usr/libexec/</filename></entry>
	      <entry>Daemons do sistema e utilitários do sistema executados por outros programas.</entry>
	    </row>

	    <row>
	      <entry><filename>/usr/local/</filename></entry>
	      <entry>Executáveis e bibliotecas locais. Também é usado como o destino padrão para o framework do ports do FreeBSD. Dentro do <filename>/usr/local</filename>, o layout geral esboçado por <citerefentry><refentrytitle>hier</refentrytitle><manvolnum>7</manvolnum></citerefentry> para <filename>/usr</filename> deve ser usado. Exceções são o diretório man, que está diretamente sob <filename>/usr/local</filename> em vez de sob <filename>/usr/local/share</filename>, e a documentação do ports está em <filename>share/doc/<replaceable>port</replaceable></filename>.</entry>
	    </row>

	    <row>
	      <entry><filename>/usr/obj/</filename></entry>
	      <entry>Árvore de destino específica da arquitetura produzida pela construção da árvore <filename>/usr/src</filename>.</entry>
	    </row>

	    <row>
	      <entry><filename>/usr/ports/</filename></entry>
	      <entry>A Coleção de Ports do FreeBSD (opcional).</entry>
	    </row>

	    <row>
	      <entry><filename>/usr/sbin/</filename></entry>
	      <entry>Daemons do sistema e utilitários do sistema executados pelos usuários.</entry>
	    </row>

	    <row>
	      <entry><filename>/usr/share/</filename></entry>
	      <entry>Arquivos independentes de arquitetura.</entry>
	    </row>

	    <row>
	      <entry><filename>/usr/src/</filename></entry>
	      <entry>Arquivos do código-fonte do BSD.</entry>
	    </row>

	    <row>
	      <entry><filename>/var/</filename></entry>
	      <entry>Arquivos de log de múltiplos propósitos, temporários, transientes e de spool. Um sistema de arquivos baseado em memória às vezes é montado em <filename>/var</filename>. Isso pode ser automatizado usando as variáveis relacionadas ao varmfs em <citerefentry><refentrytitle>rc.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry> ou com uma entrada em <filename>/etc/fstab</filename>; consulte <citerefentry><refentrytitle>mdmfs</refentrytitle><manvolnum>8</manvolnum></citerefentry> para maiores detalhes.</entry>
	    </row>

	    <row>
	      <entry><filename>/var/log/</filename></entry>
	      <entry>Diversos arquivos de log do sistema.</entry>
	    </row>

	    <row>
	      <entry><filename>/var/mail/</filename></entry>
	      <entry>Arquivos de caixa de correio do usuário.</entry>
	    </row>

	    <row>
	      <entry><filename>/var/spool/</filename></entry>
	      <entry>Diretórios de spooling de impressoras e sistemas de email.</entry>
	    </row>

	    <row>
	      <entry><filename>/var/tmp/</filename></entry>
	      <entry>Arquivos temporários que geralmente são preservados em uma reinicialização do sistema, a menos que <filename>/var</filename> seja um sistema de arquivos baseado em memória.</entry>
	    </row>

	    <row>
	      <entry><filename>/var/yp/</filename></entry>
	      <entry>Mapas de NIS.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </informaltable></para>
  </sect1>

  <sect1 xml:id="disk-organization">
    <title>Organização dos Discos</title>

    <para>A menor unidade de organização que o FreeBSD usa para encontrar arquivos é o nome do arquivo. Os nomes dos arquivos diferenciam maiúsculas de minúsculas, o que significa que <filename>readme.txt</filename> e <filename>README.TXT</filename> são dois arquivos distintos. O FreeBSD não usa a extensão de um arquivo para determinar se é um programa, documento ou alguma outra forma de dados.</para>

    <para>Os arquivos são armazenados em diretórios. Um diretório pode não conter arquivos ou pode conter centenas deles. Um diretório também pode conter outros diretórios, permitindo uma hierarquia de diretórios entre si para organizar os dados.</para>

    <para>Arquivos e diretórios são referenciados por meio de um nome, seguido por uma barra, <literal>/</literal>, seguido por qualquer outro nome de diretório que seja necessário. Por exemplo, se o diretório <filename>foo</filename> contiver um diretório <filename>bar</filename> que contenha o arquivo <filename>readme.txt</filename>, o nome completo ou <firstterm>caminho</firstterm>, para o arquivo é <filename>foo/bar/readme.txt</filename>. Observe que isso é diferente do <trademark class="registered">Windows</trademark> que usa <literal>\</literal> para separar nomes de arquivos e diretórios. O FreeBSD não usa letras de unidades ou outros nomes de unidades no caminho. Por exemplo, não se deve digitar <filename>c:\foo\bar\readme.txt</filename> no FreeBSD.</para>

    <para>Diretórios e arquivos são armazenados em um sistema de arquivos. Cada sistema de arquivos contém exatamente um diretório no nível superior, chamado de <firstterm>diretório raiz</firstterm> para esse sistema de arquivos. Este diretório raiz pode conter outros diretórios. Um sistema de arquivos é designado como <firstterm>sistema de arquivos raiz</firstterm> ou <literal>/</literal>. Todos os outros sistemas de arquivos são <firstterm>montados</firstterm> no sistema de arquivos raiz. Não importa quantos discos estejam no sistema FreeBSD, cada diretório parece fazer parte do mesmo disco.</para>

    <para>Considere três sistemas de arquivos, chamados <literal>A</literal>, <literal>B</literal> e <literal>C</literal>. Cada sistema de arquivos tem um diretório raiz, que contém dois outros diretórios, chamados <literal>A1</literal>, <literal>A2</literal> (e da mesma forma <literal>B1</literal>, <literal>B2</literal> e <literal>C1</literal>, <literal>C2</literal>).</para>

    <para>Chame <literal>A</literal> de sistema de arquivos raiz. Se <citerefentry><refentrytitle>ls</refentrytitle><manvolnum>1</manvolnum></citerefentry> for usado para visualizar o conteúdo deste diretório, ele mostrará dois subdiretórios, <literal>A1</literal> e <literal>A2</literal>. A árvore de diretórios tem esta aparência:</para>

    <mediaobject>
      <imageobject>
	<imagedata fileref="basics/example-dir1"/>
      </imageobject>

      <textobject>
	<literallayout class="monospaced"> /
 |
 +--- A1
 |
 `--- A2</literallayout>
      </textobject>
    </mediaobject>

    <para>Um sistema de arquivos deve ser montado em um diretório em outro sistema de arquivos. Ao montar o sistema de arquivos <literal>B</literal> no diretório <literal>A1</literal>, o diretório raiz de <literal>B</literal> substitui <literal>A1</literal> e os diretórios em <literal>B</literal> aparecem de acordo:</para>

    <mediaobject>
      <imageobject>
	<imagedata fileref="basics/example-dir2"/>
      </imageobject>

      <textobject>
	<literallayout class="monospaced"> /
 |
 +--- A1
 |     |
 |     +--- B1
 |     |
 |     `--- B2
 |
 `--- A2</literallayout>
      </textobject>
    </mediaobject>

    <para>Todos os arquivos que estão nos diretórios <literal>B1</literal> ou <literal>B2</literal> podem ser alcançados com o caminho <filename>/A1/B1</filename> ou <filename>/A1/B2</filename>, conforme necessário. Todos os arquivos que estavam em <filename>/A1</filename> foram temporariamente ocultados. Eles reaparecerão se <literal>B</literal> for <firstterm> desmontado </firstterm> de <literal>A</literal>.</para>

    <para>Se <literal>B</literal> tivesse sido montado em <literal>A2</literal>, o diagrama ficaria assim:</para>

    <mediaobject>
      <imageobject>
	<imagedata fileref="basics/example-dir3"/>
      </imageobject>

      <textobject>
	<literallayout class="monospaced"> /
 |
 +--- A1
 |
 `--- A2
       |
       +--- B1
       |
       `--- B2</literallayout>
      </textobject>
    </mediaobject>

    <para>e os caminhos seriam <filename>/A2/B1</filename> e <filename>/A2/B2</filename> respectivamente.</para>

    <para>Os sistemas de arquivos podem ser montados uns em cima dos outros. Continuando o último exemplo, o sistema de arquivos <literal>C</literal> pode ser montado no topo do diretório <literal>B1</literal> no sistema de arquivos <literal>B</literal>, levando a esta disposição:</para>

    <mediaobject>
      <imageobject>
	<imagedata fileref="basics/example-dir4"/>
      </imageobject>

      <textobject>
	<literallayout class="monospaced"> /
 |
 +--- A1
 |
 `--- A2
       |
       +--- B1
       |     |
       |     +--- C1
       |     |
       |     `--- C2
       |
       `--- B2</literallayout>
      </textobject>
    </mediaobject>

    <para>Ou <literal>C</literal> poderia ser montado diretamente no sistema de arquivos <literal>A</literal>, sob o diretório <literal>A1</literal>:</para>

    <mediaobject>
      <imageobject>
	<imagedata fileref="basics/example-dir5"/>
      </imageobject>

      <textobject>
	<literallayout class="monospaced"> /
 |
 +--- A1
 |     |
 |     +--- C1
 |     |
 |     `--- C2
 |
 `--- A2
       |
       +--- B1
       |
       `--- B2</literallayout>
      </textobject>
    </mediaobject>

    <para>É perfeitamente possível ter um sistema de arquivos raiz grande e não precisar criar nenhum outro. Existem algumas desvantagens nessa abordagem e uma vantagem.</para>

    <itemizedlist>
      <title>Benefícios de vários sistemas de arquivos</title>

      <listitem>
	<para>Sistemas de arquivos diferentes podem ter diferentes <firstterm>opções de montagem</firstterm>. Por exemplo, o sistema de arquivos raiz pode ser montado somente para leitura, impossibilitando que os usuários excluam ou editem inadvertidamente um arquivo crítico. Separar sistemas de arquivos graváveis pelo usuário, como <filename>/home</filename>, de outros sistemas de arquivos permite que eles sejam montados como <firstterm>nosuid</firstterm>. Essa opção impede que os bits <firstterm>suid</firstterm>/<firstterm>guid</firstterm> dos executáveis armazenados no sistema de arquivos entrem em vigor, possivelmente melhorando a segurança.</para>
      </listitem>

      <listitem>
	<para>O FreeBSD otimiza automaticamente o layout dos arquivos em um sistema de arquivos, dependendo de como o sistema de arquivos está sendo usado. Portanto, um sistema de arquivos que contém muitos arquivos pequenos que são gravados com freqüência terá uma otimização diferente para um que contenha menos arquivos maiores. Ao ter um sistema de arquivos maior, essa otimização é quebrada.</para>
      </listitem>

      <listitem>
	<para>Os sistemas de arquivos do FreeBSD são robustos se a energia for perdida. No entanto, uma perda de energia em um ponto crítico ainda pode danificar a estrutura do sistema de arquivos. Ao dividir dados em vários sistemas de arquivos, é mais provável que o sistema ainda inicialize, facilitando a restauração do backup conforme necessário.</para>
      </listitem>
    </itemizedlist>

    <itemizedlist>
      <title>Benefício de um sistema de arquivos único</title>

      <listitem>
	<para>Os sistemas de arquivos são de tamanho fixo. Se você cria um sistema de arquivos quando instala o FreeBSD e dá a ele um tamanho específico, você pode descobrir mais tarde que precisa aumentar a partição. Isso não é facilmente realizado sem um backup, recriando o sistema de arquivos com o novo tamanho e, em seguida, restaurando os dados de backup.</para>

	<important>
	  <para>O FreeBSD possui o comando <citerefentry><refentrytitle>growfs</refentrytitle><manvolnum>8</manvolnum></citerefentry>, que torna possível aumentar o tamanho do sistema de arquivos enquanto montado, removendo essa limitação.</para>
	</important>
      </listitem>
    </itemizedlist>

    <para>Os sistemas de arquivos estão contidos em partições. Isto não tem o mesmo significado que o uso comum do termo partição (por exemplo, a partição <trademark class="registered">MS-DOS</trademark>), por causa da herança  <trademark class="registered">UNIX</trademark> do FreeBSD. Cada partição é identificada por uma letra de <literal>a</literal> até <literal>h</literal>. Cada partição pode conter apenas um sistema de arquivos, o que significa que os sistemas de arquivos geralmente são descritos por seu ponto de montagem típico na hierarquia do sistema de arquivos ou pela letra da partição em que estão contidos.</para>

    <para>O FreeBSD também usa espaço em disco para <firstterm>espaço de swap</firstterm> para fornecer <firstterm>memória virtual</firstterm>. Isso permite que o seu computador se comporte como se tivesse muito mais memória do que realmente tem. Quando o FreeBSD fica sem memória, ele move alguns dos dados que não estão sendo usados atualmente para o espaço de swap, e os move de volta (removendo alguma outra coisa) quando precisa.</para>

    <para>Algumas partições possuem certas convenções associadas a elas.</para>

    <informaltable frame="none" pgwide="1">
      <tgroup cols="2">
	<colspec colwidth="1*"/>
	<colspec colwidth="5*"/>

	<thead>
	  <row>
	    <entry>Partição</entry>
	    <entry>Convenção</entry>
	  </row>
	</thead>

	<tbody valign="top">
	  <row>
	    <entry><literal>a</literal></entry>
	    <entry>Normalmente contém o sistema de arquivos raiz.</entry>
	  </row>

	  <row>
	    <entry><literal>b</literal></entry>
	    <entry>Normalmente contém espaço de swap.</entry>
	  </row>

	  <row>
	    <entry><literal>c</literal></entry>
	    <entry>Normalmente o mesmo tamanho da slice que a envolve. Isso permite que os programas que precisem trabalhar na slice inteira, como um scanner de bloco defeituoso, trabalhem na partição <literal>c</literal>. Um sistema de arquivos normalmente não seria criado nessa partição.</entry>
	  </row>

	  <row>
	    <entry><literal>d</literal></entry>
	    <entry>A partição <literal>d</literal> costumava ter um significado especial associado a ela, mas isso foi descontinuado e <literal>d</literal> pode funcionar como qualquer partição normal.</entry>
	  </row>
	</tbody>
      </tgroup>
    </informaltable>

    <para>Os discos no FreeBSD são divididos em slices, referidas no <trademark class="registered">Windows</trademark> como partições, numeradas de 1 a 4. Estas são então divididas em partições, que contêm sistemas de arquivos, e são rotuladas usando letras.</para>

    <indexterm><primary>slices</primary></indexterm>
    <indexterm><primary>partitions</primary></indexterm>
    <indexterm><primary>dangerously dedicated</primary></indexterm>

    <para>Os números das slices seguem o nome do dispositivo, prefixado com um <literal>s</literal>, começando em 1. Então <quote>da0<emphasis>s1</emphasis></quote> é a primeira slice na primeira unidade SCSI. Pode haver apenas quatro slices físicas em um disco, mas pode haver slices lógicas dentro de slices físicas do tipo apropriado. Essas slices estendidas são numeradas a partir de 5, então <quote>ada0<emphasis>s5</emphasis></quote> é a primeira slice estendida no primeiro disco SATA. Esses dispositivos são usados por sistemas de arquivos que esperam ocupar uma slice.</para>

    <para>Slices, unidades físicas <quote>perigosamente dedicadas</quote> e outras unidades contêm <firstterm>partições </firstterm>, que são representadas como letras de <literal>a</literal> até <literal>h</literal>. Esta letra é adicionada ao nome do dispositivo, então <quote>da0<emphasis>a</emphasis></quote> é a partição <literal>a</literal> na primeira unidade <literal>da</literal>, que é <quote>perigosamente dedicada</quote>. A <quote>ada1s3<emphasis>e</emphasis></quote> é a quinta partição na terceira slice da segunda unidade de disco SATA.</para>

    <para>Finalmente, cada disco no sistema é identificado. Um nome de disco começa com um código que indica o tipo de disco e, em seguida, um número, indicando qual é o disco. Ao contrário das slices, a numeração de discos começa em 0. Códigos usuais são listados em <xref linkend="disks-naming"/>.</para>

    <para>Ao se referir a uma partição, inclua o nome do disco, <literal>s</literal>, o número da slice, em seguida, a letra da partição. Exemplos são mostrados em <xref linkend="basics-disk-slice-part"/>.</para>

    <para><xref linkend="basics-concept-disk-model"/> mostra um modelo conceitual de um layout de disco.</para>

    <para>Ao instalar o FreeBSD, configure as slices de disco, crie partições dentro da slice a ser usada para o FreeBSD, crie um sistema de arquivos ou espaço de swap em cada partição e decida onde cada sistema de arquivos será montado.</para>

    <table frame="none" pgwide="1" xml:id="disks-naming">
      <title>Nomes de dispositivos de disco</title>

      <tgroup cols="2">
	<colspec colwidth="1*"/>
	<colspec colwidth="5*"/>

	<thead>
	  <row>
	    <entry>Tipo de drive</entry>
	    <entry>Nome do drive</entry>
	  </row>
	</thead>

	<tbody>
	  <row>
	    <entry>discos rígidos <acronym>SATA</acronym> e <acronym>IDE</acronym></entry>
	    <entry><literal>ada</literal> ou <literal>ad</literal></entry>
	  </row>

	  <row>
	    <entry>Discos rígidos <acronym>SCSI</acronym> e dispositivos de armazenamento <acronym>USB</acronym></entry>
	    <entry><literal>da</literal></entry>
	  </row>

	  <row>
	    <entry>drives de <acronym>CD-ROM</acronym> <acronym>SATA</acronym> e <acronym>IDE</acronym></entry>
	    <entry><literal>cd</literal> ou <literal>acd</literal></entry>
	  </row>

	  <row>
	    <entry>Unidades <acronym>SCSI</acronym> <acronym>CD-ROM</acronym></entry>
	    <entry><literal>cd</literal></entry>
	  </row>

	  <row>
	    <entry>Unidades de disquete</entry>
	    <entry><literal>fd</literal></entry>
	  </row>

	  <row>
	    <entry>Unidades de <acronym>CD-ROM</acronym> não-padrão variadas</entry>
	    <entry><literal>mcd</literal> para <acronym>CD-ROM</acronym> Mitsumi e <literal>scd</literal> para dispositivos de <acronym>CD-ROM</acronym> Sony</entry>
	  </row>

	  <row>
	    <entry>Unidades de fita <acronym>SCSI</acronym></entry>
	    <entry><literal>sa</literal></entry>
	  </row>

	  <row>
	    <entry>Unidades de fita <acronym>IDE</acronym></entry>
	    <entry><literal>ast</literal></entry>
	  </row>

	  <row>
	    <entry>Drives RAID</entry>
	    <entry>Exemplos incluem <literal>aacd</literal> para <trademark class="registered">Adaptec</trademark> AdvancedRAID, <literal>mlxd</literal> e <literal>mlyd</literal> para <trademark class="registered">Mylex</trademark>, <literal>amrd</literal> para AMI <trademark class="registered">MegaRAID</trademark>, <literal>idad</literal> para  Compaq Smart RAID, <literal>twed</literal> para <trademark class="registered">3ware</trademark> RAID.</entry>
	  </row>
	</tbody>
      </tgroup>
    </table>

    <example xml:id="basics-disk-slice-part">
      <title>Exemplo de Nomes de Disco, Slice e Partição</title>

      <informaltable frame="none" pgwide="1">
	<tgroup cols="2">
	  <colspec colwidth="1*"/>
	  <colspec colwidth="5*"/>

	  <thead>
	    <row>
	      <entry>Nome</entry>
	      <entry>Significado</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><literal>ada0s1a</literal></entry>
	      <entry>A primeira partição (<literal>a</literal>) na primeira slice (<literal>s1</literal>) no primeiro disco <acronym>SATA</acronym> (<literal>ada0</literal>).</entry>
	    </row>

	    <row>
	      <entry><literal>da1s2e</literal></entry>
	      <entry>A quinta partição (<literal>e</literal>) na segunda slice (<literal>s2</literal>) no segundo disco SCSI (<literal>da1</literal>).</entry>
	    </row>
	  </tbody>
	</tgroup>
      </informaltable>
    </example>

    <example xml:id="basics-concept-disk-model">
      <title>Modelo conceitual de um disco</title>

      <para>Este diagrama mostra a visão do FreeBSD do primeiro disco <acronym>SATA</acronym> conectado ao sistema. Suponha que o disco tenha 250 GB de tamanho e contenha uma slice de 80 GB e uma slice de 170 GB (partições <trademark class="registered">MS-DOS</trademark>). A primeira slice contém um sistema de arquivos <trademark class="registered">Windows</trademark> <acronym>NTFS</acronym>, <filename>C:</filename>, e a segunda fatia contém uma instalação do FreeBSD. Este exemplo de instalação do FreeBSD possui quatro partições de dados e uma partição swap.</para>

      <para>Cada uma das quatro partições contém um sistema de arquivos. A partição <literal>a</literal> é usada para o sistema de arquivos raiz, <literal>d</literal> para <filename>/var/</filename>, <literal>e</literal> para <filename>/tmp/</filename> e <literal>f</literal> para <filename>/usr/</filename>. A letra de partição <literal>c</literal> refere-se à fatia inteira e, portanto, não é usada para partições comuns.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="basics/disk-layout"/>
	</imageobject>
      </mediaobject>
    </example>
  </sect1>

  <sect1 xml:id="mount-unmount">
    <title>Montando e Desmontando Sistemas de Arquivos</title>

    <para>O sistema de arquivos é melhor visualizado como uma árvore, enraizada, por assim dizer, em <filename>/</filename>. O <filename>/dev</filename>, <filename>/usr</filename>, e os outros diretórios no diretório raiz são ramos, que podem ter suas próprias ramificações, como <filename>/usr/local</filename> e assim por diante.</para>

    <indexterm><primary>root file system</primary></indexterm>

    <para>Existem várias razões para abrigar alguns desses diretórios em sistemas de arquivos separados. O <filename>/var</filename> contém os diretórios <filename>log/</filename>, <filename>spool/</filename> e vários tipos de arquivos temporários e, como tal, podem encher. Encher completamente o sistema de arquivos raiz não é uma boa ideia, então separar o <filename>/var</filename> do <filename>/</filename> geralmente é vantajoso.</para>

    <para>Outro motivo comum para colocar determinadas árvores de diretório em outros sistemas de arquivos é se elas forem ser armazenadas em discos físicos separados ou se são discos virtuais separados, tal como montagens de NFS (Network File System), descritas em <xref linkend="network-nfs"/> ou unidades de CD-ROM.</para>

    <sect2 xml:id="disks-fstab">
      <title>O arquivo <filename>fstab</filename></title>

      <indexterm><primary>file systems</primary> <secondary>mounted with fstab</secondary></indexterm>

      <para>Durante o processo de inicialização (<xref linkend="boot"/>), os sistemas de arquivos listados em <filename>/etc/fstab</filename> são automaticamente montados, exceto pelas entradas que contêm <option>noauto</option>. Este arquivo contém entradas no seguinte formato:</para>

      <programlisting><replaceable>device</replaceable>       <replaceable>/mount-point</replaceable> <replaceable>fstype</replaceable>     <replaceable>options</replaceable>      <replaceable>dumpfreq</replaceable>     <replaceable>passno</replaceable></programlisting>

      <variablelist>
	<varlistentry>
	  <term><literal>device</literal></term>
	  <listitem>
	    <para>Um nome de dispositivo existente, conforme explicado em <xref linkend="disks-naming"/>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><literal>mount-point</literal></term>

	  <listitem>
	    <para>Um diretório existente no qual montar o sistema de arquivos.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><literal>fstype</literal></term>

	  <listitem>
	    <para>O tipo de sistema de arquivos para passar para o <citerefentry><refentrytitle>mount</refentrytitle><manvolnum>8</manvolnum></citerefentry>. O sistema de arquivos padrão do FreeBSD é o <literal>ufs</literal>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><literal>options</literal></term>

	  <listitem>
	    <para><option>rw</option> para sistemas de arquivos de leitura/gravação, ou <option>ro</option> para sistemas de arquivos somente de leitura, seguidos por quaisquer outras opções que possam ser necessárias. Uma opção comum é <option>noauto</option> para sistemas de arquivos normalmente não montados durante a seqüência de inicialização. Outras opções estão listadas em <citerefentry><refentrytitle>mount</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><literal>dumpfreq</literal></term>

	  <listitem>
	    <para>Usado pelo <citerefentry><refentrytitle>dump</refentrytitle><manvolnum>8</manvolnum></citerefentry> para determinar quais sistemas de arquivos requerem o dump. Se o campo estiver faltando, um valor zero será assumido.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><literal>passno</literal></term>

	  <listitem>
	    <para>Determina a ordem em que os sistemas de arquivos devem ser verificados. Os sistemas de arquivos que devem ser ignorados devem ter seu <literal>passno</literal> definido como zero. O sistema de arquivos raiz precisa ser verificado antes de todo o restante e deve ter seu <literal>passno</literal> definido como um. Os outros sistemas de arquivos devem ser configurados para valores maiores que um. Se mais de um sistema de arquivos tiver o mesmo <literal>passno</literal>, o <citerefentry><refentrytitle>fsck</refentrytitle><manvolnum>8</manvolnum></citerefentry> tentará verificar os sistemas de arquivos em paralelo, se possível.</para>
	  </listitem>
	</varlistentry>
      </variablelist>

      <para>Consulte <citerefentry><refentrytitle>fstab</refentrytitle><manvolnum>5</manvolnum></citerefentry> para obter maiores informações sobre o formato do <filename>/etc/fstab</filename> e suas opções.</para>
    </sect2>

    <sect2 xml:id="disks-mount">
      <title>Usando o <citerefentry><refentrytitle>mount</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <indexterm><primary>file systems</primary> <secondary>mounting</secondary></indexterm>

      <para>Os sistemas de arquivos são montados usando o comando <citerefentry><refentrytitle>mount</refentrytitle><manvolnum>8</manvolnum></citerefentry>. A sintaxe mais básica é a seguinte:</para>

      <informalexample>
	<screen><prompt>#</prompt> <userinput>mount <replaceable>device</replaceable> <replaceable>mountpoint</replaceable></userinput></screen>
      </informalexample>

      <para>Este comando fornece muitas opções que são descritas em <citerefentry><refentrytitle>mount</refentrytitle><manvolnum>8</manvolnum></citerefentry>. As opções mais usadas incluem:</para>

      <variablelist>
	<title>Opções de montagem</title>

	<varlistentry>
	  <term><option>-a</option></term>

	  <listitem>
	    <para>Monte todos os sistemas de arquivos listados em <filename>/etc/fstab</filename>, exceto aqueles marcados como <quote>noauto</quote>, excluídos pela opção <option>-t</option>, ou aqueles que já estão montados.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><option>-d</option></term>

	  <listitem>

	    <para>Faz tudo, exceto a chamada real do sistema de montagem. Esta opção é útil em conjunto com a opção <option>-v</option> para determinar o que o <citerefentry><refentrytitle>mount</refentrytitle><manvolnum>8</manvolnum></citerefentry> está realmente tentando fazer.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><option>-f</option></term>

	  <listitem>
	    <para>Força a montagem de um sistema de arquivos sujo (perigoso) ou a revogação do acesso de gravação ao fazer o downgrade do status de montagem de um sistema de arquivos de leitura/gravação para somente leitura.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><option>-r</option></term>

	  <listitem>
	    <para>Monta o sistema de arquivos somente para leitura. Isso é idêntico ao uso de <option>-o ro</option>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><option>-t</option> <replaceable>fstype</replaceable></term>

	  <listitem>
	    <para>Monta o tipo de sistema de arquivos especificado ou monta somente sistemas de arquivos do tipo especificado, se <option>-a</option>estiver incluído. <quote>ufs</quote> é o tipo de sistema de arquivos padrão.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><option>-u</option></term>

	  <listitem>
	    <para>Atualiza as opções de montagem no sistema de arquivos.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><option>-v</option></term>

	  <listitem>
	    <para>Fica verboso (mostra mais informações).</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><option>-w</option></term>

	  <listitem>
	    <para>Monta o sistema de arquivos para leitura/gravação.</para>
	  </listitem>
	</varlistentry>
      </variablelist>

      <para>As seguintes opções podem ser passadas para <option>-o</option> como uma lista separada por vírgula:</para>

      <variablelist>
	<varlistentry>
	  <term>nosuid</term>

	  <listitem>
	    <para>Não interprete flags setuid ou setgid no sistema de arquivos. Essa também é uma opção de segurança útil.</para>
	  </listitem>
	</varlistentry>
      </variablelist>
    </sect2>

    <sect2 xml:id="disks-umount">
      <title>Usando o <citerefentry><refentrytitle>umount</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <indexterm><primary>file systems</primary> <secondary>unmounting</secondary></indexterm>

      <para>Para desmontar um sistema de arquivos use <citerefentry><refentrytitle>umount</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Esse comando usa um parâmetro que pode ser um ponto de montagem, um nome do dispositivo, <option>-a</option> ou <option>-A</option>.</para>

      <para>Todos os usos aceitam <option>-f</option> para forçar a desmontagem e <option>-v</option> para ver mais informações. Atenção, em geral <option>-f</option> não é uma boa opção, pois pode travar o computador ou danificar os dados no sistema de arquivos.</para>

      <para>Para desmontar todos os sistemas de arquivos montados, ou apenas os tipos de sistema de arquivos listados após <option>-t</option>, use <option>-a</option> ou <option>-A</option>. Note que <option>-A</option> não tenta desmontar o sistema de arquivos raiz.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="basics-processes">
    <title>Processos e Daemons</title>

    <para>O FreeBSD é um sistema operacional multitarefa. Cada programa em execução a qualquer momento é chamado de <firstterm>processo</firstterm>. Todo comando em execução inicia pelo menos um novo processo e há vários processos de sistema que são executados pelo FreeBSD.</para>

    <para>Cada processo é identificado exclusivamente por um número chamado <firstterm>ID do processo</firstterm> (<acronym>PID</acronym>). Semelhante aos arquivos, cada processo tem um proprietário e um grupo, e as permissões de proprietário e grupo são usadas para determinar quais arquivos e dispositivos o processo pode abrir. A maioria dos processos também possui um processo pai que os iniciou. Por exemplo, o shell é um processo e qualquer comando iniciado no shell é um processo que tem o shell como seu processo pai. A exceção é um processo especial chamado <citerefentry><refentrytitle>init</refentrytitle><manvolnum>8</manvolnum></citerefentry> que é sempre o primeiro processo a rodar na inicialização e que sempre possui um <acronym>PID</acronym> de <literal>1</literal>.</para>

    <para>Alguns programas não são projetados para serem executados com a entrada contínua do usuário e desconectam do terminal na primeira oportunidade. Por exemplo, um servidor da Web responde a solicitações da Web, em vez de entradas do usuário. Servidores de email são outro exemplo desse tipo de aplicativo. Esses tipos de programas são conhecidos como <firstterm>daemons</firstterm>. O termo daemon vem da mitologia grega e representa uma entidade que não é boa nem má, e que invisivelmente realiza tarefas úteis. É por isso que o mascote do BSD é o daemon de aparência alegre com tênis e um tridente.</para>

    <para>Existe uma convenção para nomear programas que normalmente são executados como daemons com um <quote>d</quote> à direita. Por exemplo, <application>BIND</application> é o Berkeley Internet Name Domain, mas o programa real que é executado é <command>named</command>. O programa do servidor da web <application>Apache</application> é o <command>httpd</command> e o daemon de spooling da impressora de linha é o <command>lpd</command>. Esta é apenas uma convenção de nomenclatura. Por exemplo, o daemon de correio principal para o aplicativo <application>Sendmail</application> é o <command>sendmail</command> e não <literal>maild</literal>.</para>

    <sect2>
      <title>Visualizando Processos</title>

      <para>Para ver os processos em execução no sistema, use o <citerefentry><refentrytitle>ps</refentrytitle><manvolnum>1</manvolnum></citerefentry> ou o <citerefentry><refentrytitle>top</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Para exibir uma lista estática dos processos em execução no momento, seus <acronym>PID</acronym>s, quanta memória eles estão usando e o comando com o qual eles foram iniciados, use o <citerefentry><refentrytitle>ps</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Para exibir todos os processos em execução e atualizar a exibição a cada poucos segundos para ver interativamente o que o computador está fazendo, use o <citerefentry><refentrytitle>top</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</para>

      <para>Por padrão, o <citerefentry><refentrytitle>ps</refentrytitle><manvolnum>1</manvolnum></citerefentry> mostra apenas os comandos que estão em execução e que são de propriedade do usuário. Por exemplo:</para>

      <screen><prompt>%</prompt> <userinput>ps</userinput>
 PID TT  STAT    TIME COMMAND
8203  0  Ss   0:00.59 /bin/csh
8895  0  R+   0:00.00 ps</screen>

      <para>A saída do <citerefentry><refentrytitle>ps</refentrytitle><manvolnum>1</manvolnum></citerefentry> é organizada em várias colunas. A coluna <literal>PID</literal> exibe o ID do processo. Os <acronym>PID</acronym>s são atribuídos a partir de 1, vão até 99999, e depois retornam ao início. No entanto, um <acronym>PID</acronym> não é reatribuído se já estiver em uso. A coluna <literal>TT</literal> mostra o tty em que o programa está sendo executado e <literal>STAT</literal> mostra o estado do programa. <literal>TIME</literal> é a quantidade de tempo que o programa foi executado na CPU. Normalmente, esse não é o tempo decorrido desde que o programa foi iniciado, pois a maioria dos programas gasta muito tempo esperando que as coisas aconteçam antes que precisem gastar tempo na CPU. Finalmente, <literal>COMMAND</literal> é o comando que foi usado para iniciar o programa.</para>

      <para>Várias opções diferentes estão disponíveis para alterar as informações exibidas. Um dos conjuntos mais úteis é <literal>auxww</literal>, onde <option>a</option> exibe informações sobre todos os processos em execução de todos os usuários, <option>u</option> exibe o nome de usuário e o uso de memória do proprietário do processo, <option>x</option> exibe informações sobre os processos do daemon e <option>ww</option> faz com que o <citerefentry><refentrytitle>ps</refentrytitle><manvolnum>1</manvolnum></citerefentry> exiba a linha de comando completa para cada processo, em vez de truncá-la para caber na tela quando é muito longa.</para>

      <para>A saída do <citerefentry><refentrytitle>top</refentrytitle><manvolnum>1</manvolnum></citerefentry> é semelhante a abaixo:</para>

      <screen><prompt>%</prompt> <userinput>top</userinput>
last pid:  9609;  load averages:  0.56,  0.45,  0.36              up 0+00:20:03  10:21:46
107 processes: 2 running, 104 sleeping, 1 zombie
CPU:  6.2% user,  0.1% nice,  8.2% system,  0.4% interrupt, 85.1% idle
Mem: 541M Active, 450M Inact, 1333M Wired, 4064K Cache, 1498M Free
ARC: 992M Total, 377M MFU, 589M MRU, 250K Anon, 5280K Header, 21M Other
Swap: 2048M Total, 2048M Free

  PID USERNAME    THR PRI NICE   SIZE    RES STATE   C   TIME   WCPU COMMAND
  557 root          1 -21  r31   136M 42296K select  0   2:20  9.96% Xorg
 8198 dru           2  52    0   449M 82736K select  3   0:08  5.96% kdeinit4
 8311 dru          27  30    0  1150M   187M uwait   1   1:37  0.98% firefox
  431 root          1  20    0 14268K  1728K select  0   0:06  0.98% moused
 9551 dru           1  21    0 16600K  2660K CPU3    3   0:01  0.98% top
 2357 dru           4  37    0   718M   141M select  0   0:21  0.00% kdeinit4
 8705 dru           4  35    0   480M    98M select  2   0:20  0.00% kdeinit4
 8076 dru           6  20    0   552M   113M uwait   0   0:12  0.00% soffice.bin
 2623 root          1  30   10 12088K  1636K select  3   0:09  0.00% powerd
 2338 dru           1  20    0   440M 84532K select  1   0:06  0.00% kwin
 1427 dru           5  22    0   605M 86412K select  1   0:05  0.00% kdeinit4</screen>

      <para>A saída é dividida em duas seções. O cabeçalho (as primeiras cinco ou seis linhas) mostra o <acronym>PID</acronym> do último processo executado, as médias de carga do sistema (que são uma medida de quão ocupado o sistema está), o tempo de atividade do sistema desde a última reinicialização) e a hora atual. As outras informações no cabeçalho se relacionam com quantos processos estão sendo executados, quanta memória e swap estão em uso e quanto tempo o sistema está gastando em diferentes estados da CPU. Se o módulo do sistema de arquivos <acronym>ZFS</acronym> foi carregado, uma linha <literal>ARC</literal> indica a quantidade de dados que foram lidos do cache de memória, e não do disco.</para>

      <para>Abaixo do cabeçalho há uma série de colunas contendo informações semelhantes à saída do <citerefentry><refentrytitle>ps</refentrytitle><manvolnum>1</manvolnum></citerefentry>, como o <acronym>PID</acronym>, nome de usuário, quantidade de tempo de CPU e o comando que iniciou o processo. Por padrão, o <citerefentry><refentrytitle>top</refentrytitle><manvolnum>1</manvolnum></citerefentry> também exibe a quantidade de espaço de memória ocupada pelo processo. Isso é dividido em duas colunas: uma para o tamanho total e outra para o tamanho do residente. O tamanho total é a quantidade de memória que o aplicativo precisa e o tamanho de residente é o quanto ele está realmente usando agora.</para>

      <para>O <citerefentry><refentrytitle>top</refentrytitle><manvolnum>1</manvolnum></citerefentry> atualiza automaticamente a exibição a cada dois segundos. Um intervalo diferente pode ser especificado com <option>-s</option>.</para>
    </sect2>

    <sect2 xml:id="basics-daemons">
      <title>Matando Processos</title>

      <para>Uma maneira de se comunicar com qualquer processo ou daemon em execução é enviar um <firstterm>sinal</firstterm> usando o <citerefentry><refentrytitle>kill</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Existem vários sinais diferentes; alguns têm um significado específico, enquanto outros são descritos na documentação do comando. Um usuário só pode enviar um sinal para um processo que seja seu. Enviar um sinal para o processo de outra pessoa resultará em um erro de permissão negada. A exceção é o usuário <systemitem class="username">root</systemitem>, que pode enviar sinais para os processos de qualquer pessoa.</para>

      <para>O sistema operacional também pode enviar um sinal para um processo. Se um aplicativo estiver mal escrito e tentar acessar a memória que não deveria, o FreeBSD enviará ao processo o sinal de <quote>Segmentation Violation</quote> (<literal>SIGSEGV</literal>). Se uma aplicação foi escrita para usar a chamada de sistema <citerefentry><refentrytitle>alarm</refentrytitle><manvolnum>3</manvolnum></citerefentry> para ser alertada após um período de tempo, será enviado o sinal <quote>Alarm</quote> (<literal>SIGALRM</literal>).</para>

      <para>Dois sinais podem ser usados para interromper um processo: <literal>SIGTERM</literal> e <literal>SIGKILL</literal>. <literal>SIGTERM</literal> é a maneira educada de eliminar um processo, pois o processo pode ler o sinal, fechar quaisquer arquivos de log que possam estar abertos e tentar terminar o que está fazendo antes de desligar. Em alguns casos, um processo pode ignorar <literal>SIGTERM</literal> se estiver no meio de alguma tarefa que não pode ser interrompida.</para>

      <para><literal>SIGKILL</literal> não pode ser ignorado por um processo. Enviar um <literal>SIGKILL</literal> para um processo geralmente interromperá esse processo de uma vez por todas. <footnote><para>Existem algumas tarefas que não podem ser interrompidas. Por exemplo, se o processo estiver tentando ler de um arquivo que está em outro computador na rede e o outro estiver indisponível, o processo é considerado não <quote>interrompível</quote>. Eventualmente, o processo expirará, normalmente após dois minutos. Assim que esse tempo limite ocorrer, o processo será eliminado.</para></footnote>.</para>

      <para>Outros sinais comumente usados são <literal>SIGHUP</literal>, <literal>SIGUSR1</literal> e <literal>SIGUSR2</literal>. Como esses são sinais de finalidade geral, diferentes aplicativos responderão de maneira diferente.</para>

      <para>Por exemplo, depois de alterar o arquivo de configuração de um servidor da Web, o servidor da Web precisa ser instruído a reler sua configuração. Reiniciar o <command>httpd</command> resultaria em um breve período de interrupção no servidor da web. Em vez disso, envie ao daemon o sinal <literal>SIGHUP</literal>. Esteja ciente de que diferentes daemons terão um comportamento diferente, então consulte a documentação do daemon para determinar se <literal>SIGHUP</literal> terá os resultados desejados.</para>

      <procedure>
	<title>Enviando um sinal para um processo</title>

	<para>Este exemplo mostra como enviar um sinal para o <citerefentry><refentrytitle>inetd</refentrytitle><manvolnum>8</manvolnum></citerefentry>. O arquivo de configuração do <citerefentry><refentrytitle>inetd</refentrytitle><manvolnum>8</manvolnum></citerefentry> é o <filename>/etc/inetd.conf</filename> e o <citerefentry><refentrytitle>inetd</refentrytitle><manvolnum>8</manvolnum></citerefentry> irá reler este arquivo de configuração quando for enviado um <literal>SIGHUP</literal>.</para>

	<step>
	  <para>Encontre o <acronym>PID</acronym> do processo para enviar o sinal usando <citerefentry><refentrytitle>pgrep</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Neste exemplo, o <acronym>PID</acronym> do <citerefentry><refentrytitle>inetd</refentrytitle><manvolnum>8</manvolnum></citerefentry> é 198:</para>

	  <screen><prompt>%</prompt> <userinput>pgrep -l inetd</userinput>
198  inetd -wW</screen>

	</step>

	<step>
	  <para>Use o <citerefentry><refentrytitle>kill</refentrytitle><manvolnum>1</manvolnum></citerefentry> para enviar o sinal. Como o <citerefentry><refentrytitle>inetd</refentrytitle><manvolnum>8</manvolnum></citerefentry> é de propriedade do <systemitem class="username">root</systemitem>, use o <citerefentry><refentrytitle>su</refentrytitle><manvolnum>1</manvolnum></citerefentry> para se tornar <systemitem class="username">root</systemitem> primeiro.</para>

	  <screen><prompt>%</prompt> <userinput>su</userinput>
<prompt>Password:</prompt>
<prompt>#</prompt> <userinput>/bin/kill -s HUP 198</userinput></screen>

	  <para>Como a maioria dos comandos <trademark class="registered">UNIX</trademark>, o <citerefentry><refentrytitle>kill</refentrytitle><manvolnum>1</manvolnum></citerefentry> não imprimirá nenhuma saída se for bem-sucedido. Se um sinal for enviado para um processo que não pertence ao usuário, a mensagem <errorname>kill: <replaceable>PID</replaceable>: Operation not permitted</errorname> será exibida. Errar o <acronym>PID</acronym> irá enviar o sinal para o processo errado, o que poderia ter resultados negativos, ou enviará o sinal para um <acronym>PID</acronym> que não esteja em uso no momento, resultando em o erro <errorname>kill: <replaceable>PID</replaceable>: No such process</errorname>.</para>

	  <note>
	    <title>Por que usar o <command>/bin/kill</command>?</title>

	    <para>Muitos shells fornecem o <command>kill</command> como um comando interno, o que significa que o shell enviará o sinal diretamente, em vez de executar o <filename>/bin/kill</filename>. Esteja ciente de que diferentes shells possuem uma sintaxe diferente para especificar o nome do sinal a ser enviado. Em vez de tentar aprender todos eles, pode ser mais simples especificar explicitamente o uso do <command>/bin/kill</command>.</para>
	  </note>
	</step>
      </procedure>

      <para>Ao enviar outros sinais, substitua <literal>TERM</literal> ou <literal>KILL</literal> pelo nome do sinal.</para>

      <important>
	<para>Matar um processo aleatório no sistema é uma má ideia. Em particular, o <citerefentry><refentrytitle>init</refentrytitle><manvolnum>8</manvolnum></citerefentry>, <acronym>PID</acronym> 1, é especial. Executar <command>/bin/kill -s KILL 1</command> é uma maneira rápida e não recomendada de desligar o sistema. <emphasis>Sempre</emphasis> verifique os argumentos do <citerefentry><refentrytitle>kill</refentrytitle><manvolnum>1</manvolnum></citerefentry> <emphasis>antes</emphasis> de pressionar a tecla <keycap>Enter</keycap>.</para>
      </important>
    </sect2>
  </sect1>

  <sect1 xml:id="shells">
    <title>Shells</title>

    <indexterm><primary>shells</primary></indexterm>
    <indexterm><primary>command line</primary></indexterm>

    <para>Um <firstterm>shell</firstterm> fornece uma interface de linha de comandos para interagir com o sistema operacional. Um shell recebe comandos do canal de entrada e os executa. Muitos shells fornecem funções incorporadas para ajudar nas tarefas diárias, como gerenciamento de arquivos, referenciamento de arquivos, edição de linha de comando, macros de comando e variáveis de ambiente. O FreeBSD vem com vários shells, incluindo o shell Bourne (<citerefentry><refentrytitle>sh</refentrytitle><manvolnum>1</manvolnum></citerefentry>) e o shell C estendido (<citerefentry><refentrytitle>tcsh</refentrytitle><manvolnum>1</manvolnum></citerefentry>). Outros shells estão disponíveis na Coleção de Ports do FreeBSD, como o <command>zsh</command> e o <command>bash</command>.</para>

    <para>O shell usado é realmente uma questão de gosto. Um programador C pode se sentir mais confortável com um shell semelhante ao C, como o <citerefentry><refentrytitle>tcsh</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Um usuário <trademark class="registered">Linux</trademark> pode preferir o <command>bash</command>. Cada shell tem propriedades únicas que podem ou não funcionar com o ambiente de trabalho preferido de um usuário, e é por isso que existe a opção de qual shell usar.</para>

    <para>Um recurso de shell comum é a conclusão do nome do arquivo. Depois que um usuário digita as primeiras letras de um comando ou nome de arquivo e pressiona a tecla <keycap>Tab</keycap>, o shell completa o restante do comando ou nome do arquivo. Considere dois arquivos chamados <filename>foobar</filename> e <filename>football</filename>. Para excluir <filename>foobar</filename>, o usuário pode digitar <command>rm foo</command> e pressionar a tecla <keycap>Tab</keycap> para completar o nome do arquivo.</para>

    <para>Mas se o shell mostrar apenas <command>rm foo</command>. Não foi possível completar o nome do arquivo porque ambos <filename>foobar</filename> e <filename>football</filename> começam com <literal>foo</literal>. Algumas shells emitem um sinal sonoro ou mostram todas as opções se houver mais de um nome. O usuário deve digitar mais caracteres para identificar o nome do arquivo desejado. Digitar um <literal>t</literal> e pressionar a tecla <keycap>Tab</keycap> novamente é suficiente para permitir que o shell determine qual nome de arquivo é desejado e preencha o resto.</para>

    <indexterm><primary>environment variables</primary></indexterm>

    <para>Outra característica do shell é o uso de variáveis de ambiente. As variáveis de ambiente são um par de variável/chave armazenado no ambiente do shell. Esse ambiente pode ser lido por qualquer programa chamado pela shell e, portanto, contém muitas configurações de programas. <xref linkend="shell-env-vars"/> fornece uma lista de variáveis de ambiente comuns e seus significados. Observe que os nomes das variáveis de ambiente estão sempre em maiúsculas.</para>

    <table xml:id="shell-env-vars" frame="none" pgwide="1">
      <title>Variáveis de Ambiente Comuns</title>

      <tgroup cols="2">
	<thead>
	  <row>
	    <entry>Variável</entry>
	    <entry>Descrição</entry>
	  </row>
	</thead>

	<tbody>
	  <row>
	    <entry><envar>USER</envar></entry>
	    <entry>Nome do usuário atual.</entry>
	  </row>

	  <row>
	    <entry><envar>PATH</envar></entry>
	    <entry>Lista de diretórios separados por dois pontos para pesquisa de binários (progamas).</entry>
	  </row>

	  <row>
	    <entry><envar>DISPLAY</envar></entry>
	    <entry>Nome de rede do display do <application>Xorg</application> para conexão, se disponível.</entry>
	  </row>

	  <row>
	    <entry><envar>SHELL</envar></entry>
	    <entry>O shell atual.</entry>
	  </row>

	  <row>
	    <entry><envar>TERM</envar></entry>

	    <entry>O nome do tipo de terminal do usuário. Usado para determinar os recursos do terminal.</entry>
	  </row>

	  <row>
	    <entry><envar>TERMCAP</envar></entry>

	    <entry>Acesso à base de dados dos códigos de escape do terminal para executar várias funções do terminal.</entry>
	  </row>

	  <row>
	    <entry><envar>OSTYPE</envar></entry>
	    <entry>Tipo de sistema operacional.</entry>
	  </row>

	  <row>
	    <entry><envar>MACHTYPE</envar></entry>
	    <entry>A arquitetura da CPU do sistema.</entry>
	  </row>

	  <row>
	    <entry><envar>EDITOR</envar></entry>
	    <entry>O editor de texto preferencial do usuário.</entry>
	  </row>

	  <row>
	    <entry><envar>PAGER</envar></entry>
	    <entry>O utilitário preferencial do usuário para visualização de texto página à página.</entry>
	  </row>

	  <row>
	    <entry><envar>MANPATH</envar></entry>
	    <entry>Lista de diretórios separados por dois pontos para pesquisar páginas de manual.</entry>
	  </row>
	</tbody>
      </tgroup>
    </table>

    <indexterm><primary>Bourne shells</primary></indexterm>

    <para>O processo para definir uma variável de ambiente difere entre as shells. Em <citerefentry><refentrytitle>tcsh</refentrytitle><manvolnum>1</manvolnum></citerefentry> e <citerefentry><refentrytitle>csh</refentrytitle><manvolnum>1</manvolnum></citerefentry>, use <command>setenv</command> para definir variáveis de ambiente. Em <citerefentry><refentrytitle>sh</refentrytitle><manvolnum>1</manvolnum></citerefentry> e no <command>bash</command>, use <command>export</command> para definir as variáveis de ambiente atuais. Este exemplo define o <envar>EDITOR</envar> padrão para <filename>/usr/local/bin/emacs</filename> para a shell <citerefentry><refentrytitle>tcsh</refentrytitle><manvolnum>1</manvolnum></citerefentry>:</para>

    <screen><prompt>%</prompt> <userinput>setenv EDITOR /usr/local/bin/emacs</userinput></screen>

    <para>O comando equivalente para <command>bash</command> seria:</para>

    <screen><prompt>%</prompt> <userinput>export EDITOR="/usr/local/bin/emacs"</userinput></screen>

    <para>Para expandir uma variável de ambiente para ver sua configuração atual, digite um caracter <literal>$</literal> na frente de seu nome na linha de comando. Por exemplo, <command>echo $TERM</command> exibe a configuração atual do <envar>$TERM</envar>.</para>

    <para>Shells tratam caracteres especiais, conhecidos como meta-caracteres, como representações especiais de dados. O meta-caracter mais comum é <literal>*</literal>, que representa qualquer número de caracteres em um nome de arquivo. Meta-caracteres podem ser usados para executar a globalização de nomes de arquivos. Por exemplo, <command>echo *</command> é equivalente a <command>ls</command> porque a shell pega todos os arquivos que correspondem ao <literal>*</literal> e <command>echo</command> os lista na linha de comando.</para>

    <para>Para evitar que a shell interprete um caractere especial, escape-o a partir da shell, iniciando-o com uma barra invertida (<literal>\</literal>). Por exemplo, <command>echo $TERM</command> imprime a configuração do terminal, enquanto <command>echo \$TERM</command> imprime literalmente a string <literal>$TERM</literal>.</para>

    <sect2 xml:id="changing-shells">
      <title>Alterando a Shell</title>

      <para>A maneira mais fácil de alterar permanentemente a shell padrão é usar o <command>chsh</command>. A execução desse comando abrirá o editor que está configurado na variável de ambiente <envar>EDITOR</envar>, que por padrão é definido como o <citerefentry><refentrytitle>vi</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Altere a linha <literal>Shell:</literal> para o caminho completo da nova shell.</para>

      <para>Como alternativa, use <command>chsh -s</command>, que irá definir a shell especificada sem abrir um editor. Por exemplo, para alterar a shell para <command>bash</command>:</para>

      <screen><prompt>%</prompt> <userinput>chsh -s /usr/local/bin/bash</userinput></screen>

      <note>
	<para>A nova shell <emphasis>deve</emphasis> estar presente no arquivo <filename>/etc/shells</filename>. Se a shell foi instalada a partir da coleção de ports do FreeBSD, como descrito em <xref linkend="ports"/>, ela deve ser adicionada automaticamente a este arquivo. Se estiver faltando, adicione-a usando este comando, substituindo o caminho pelo caminho da shell:</para>

	<screen><prompt>#</prompt> <userinput>echo <replaceable>/usr/local/bin/bash</replaceable> &gt;&gt; /etc/shells</userinput></screen>

	<para>Em seguida, execute novamente o <citerefentry><refentrytitle>chsh</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</para>
      </note>
    </sect2>

    <sect2>
      <info>
	<title>Técnicas Avançadas de Shell</title>

	<authorgroup>
	  <author><personname><firstname>Tom</firstname> <surname>Rhodes</surname></personname><contrib>Escrito por</contrib></author>
	</authorgroup>
      </info>

      <para>A shell <trademark class="registered">UNIX</trademark> não é apenas um interpretador de comandos, ela atua como uma ferramenta poderosa que permite aos usuários executar comandos, redirecionar sua saída, redirecionar 
 sua entrada e encadear comandos para melhorar o resultado final. Quando essa funcionalidade é mesclada com comandos incorporados, é fornecido ao usuário um ambiente que pode maximizar a eficiência.</para>

      <para>O redirecionamento de shell é a ação de enviar a saída ou a entrada de um comando para outro comando ou para um arquivo. Para capturar a saída do comando <citerefentry><refentrytitle>ls</refentrytitle> <manvolnum>1</manvolnum></citerefentry>, por exemplo, em um arquivo, redirecione a saída:</para>

      <screen><prompt>%</prompt> <userinput>ls &gt; directory_listing.txt</userinput></screen>

      <para>O conteúdo do diretório agora será listado em <filename>directory_listing.txt</filename>. Alguns comandos podem ser usados para ler entradas, como <citerefentry><refentrytitle>sort</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Para classificar esta listagem, redirecione a entrada:</para>

      <screen><prompt>%</prompt> <userinput>sort &lt; directory_listing.txt</userinput></screen>

      <para>A entrada será classificada e colocada na tela. Para redirecionar essa entrada para outro arquivo, pode-se redirecionar a saída de <citerefentry><refentrytitle>sort</refentrytitle><manvolnum>1</manvolnum></citerefentry> misturando a direção:</para>

      <screen><prompt>%</prompt> <userinput>sort &lt; directory_listing.txt &gt; sorted.txt</userinput></screen>

      <para>Em todos os exemplos anteriores, os comandos estão executando o redirecionamento usando descritores de arquivos. Todo sistema <trademark class="registered">UNIX</trademark> possui descritores de arquivos, que incluem entrada padrão (stdin), saída padrão (stdout) e erro padrão (stderr). Cada um tem um propósito, onde a entrada pode ser um teclado ou um mouse, algo que fornece entrada. A saída pode ser uma tela ou papel em uma impressora. E erro seria tudo o que pode ser usado para mensagens de diagnóstico ou erro. Todos os três são considerados descritores de arquivos baseados em <acronym>I/O</acronym> e, às vezes, considerados fluxos.</para>

      <para>Através do uso desses descritores, a shell permite que a saída e a entrada sejam passadas por vários comandos e redirecionadas para/ou a partir de um arquivo. Outro método de redirecionamento é o operador de pipe.</para>

      <para>O operador pipe <trademark class="registered">UNIX</trademark>, <quote>|</quote> permite que a saída de um comando seja transmitida diretamente ou direcionada para outro programa. Basicamente, um pipe permite que a saída padrão de um comando seja passada como entrada padrão para outro comando, por exemplo:</para>

      <screen><prompt>%</prompt> <userinput>cat directory_listing.txt | sort | less</userinput></screen>

      <para>Nesse exemplo, o conteúdo de <filename>directory_listing.txt</filename> será classificado e a saída será transmitida para <citerefentry><refentrytitle>less</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Isso permite que o usuário role pela saída em seu próprio ritmo e evite que ela role para fora da tela.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="editors">
    <title>Editores de Texto</title>

    <indexterm><primary>text editors</primary></indexterm>
    <indexterm><primary>editors</primary></indexterm>

    <para>A maioria das configurações do FreeBSD é feita através da edição de arquivos de texto. Por isso, é uma boa ideia familiarizar-se com um editor de texto. O FreeBSD vem com alguns como parte do sistema base, e muitos outros estão disponíveis na coleção do ports.</para>

    <indexterm><primary><command>ee</command></primary></indexterm>
    <indexterm><primary>editors</primary> <secondary><citerefentry><refentrytitle>ee</refentrytitle><manvolnum>1</manvolnum></citerefentry></secondary></indexterm>

    <para>Um editor simples para aprender é o <citerefentry><refentrytitle>ee</refentrytitle><manvolnum>1</manvolnum></citerefentry>, que significa editor fácil (Ease Editor). Para iniciar este editor, digite <command>ee<replaceable>filename</replaceable></command> em que <replaceable>filename</replaceable> é o nome do arquivo a ser editado. Uma vez dentro do editor, todos os comandos para manipular as funções do editor são listados no topo da tela. O cursor (<literal>^</literal>) representa <keycap>Ctrl</keycap>, então <literal>^e</literal> expande para <keycombo action="simul"><keycap>Ctrl</keycap><keycap>e</keycap></keycombo>. Para sair do <citerefentry><refentrytitle>ee</refentrytitle><manvolnum>1</manvolnum></citerefentry>, pressione <keycap>Esc</keycap> e escolha a opção <quote>leave editor</quote> no menu principal. O editor pedirá para salvar as alterações, caso o arquivo tenha sido modificado.</para>

    <indexterm><primary><command>vi</command></primary></indexterm>
    <indexterm><primary>editors</primary></indexterm>
    <indexterm><primary><command>emacs</command></primary></indexterm>

    <para>O FreeBSD também vem com editores de texto mais poderosos, como o <citerefentry><refentrytitle>vi</refentrytitle><manvolnum>1</manvolnum></citerefentry>, como parte do sistema base. Outros editores, como <package>editors/emacs</package> e <package>editors/vim</package>, fazem parte da coleção do ports do FreeBSD. Esses editores oferecem mais funcionalidade às custas de serem mais complicados de aprender. Aprender um editor mais poderoso como o <application>vim</application> ou o <application>Emacs</application> pode economizar mais tempo a longo prazo.</para>

    <para>Muitos aplicativos que modificam arquivos ou exigem entrada digitada abrirão automaticamente um editor de texto. Para alterar o editor padrão, defina a variável de ambiente <envar>EDITOR</envar> conforme descrito em <xref linkend="shells"/>.</para>
  </sect1>

  <sect1 xml:id="basics-devices">
    <title>Dispositivos e nós de dispositivos</title>

    <para>Um dispositivo é um termo usado principalmente para atividades relacionadas a hardware em um sistema, incluindo discos, impressoras, placas gráficas e teclados. Quando o FreeBSD inicializa, a maioria das mensagens de inicialização se refere aos dispositivos sendo detectados. Uma cópia das mensagens de inicialização é salva em <filename>/var/run/dmesg.boot</filename>.</para>

    <para>Cada dispositivo tem um nome e um número de dispositivo. Por exemplo, <filename>ada0</filename> é o primeiro disco rígido SATA, enquanto <filename>kbd0</filename> representa o teclado.</para>

    <para>A maioria dos dispositivos no FreeBSD deve ser acessada através de arquivos especiais chamados nós de dispositivos (device nodes), que estão localizados em <filename>/dev</filename>.</para>
  </sect1>

  <sect1 xml:id="basics-more-information">
    <title>Páginas de Manual</title>

    <indexterm><primary>manual pages</primary></indexterm>

    <para>A documentação mais abrangente sobre o FreeBSD está na forma de páginas de manual. Quase todos os programas do sistema vêm com um breve manual de referência explicando a operação básica e os argumentos disponíveis. Estes manuais podem ser visualizados usando o <command>man</command>:</para>

    <screen><prompt>%</prompt> <userinput>man <replaceable>command</replaceable></userinput></screen>

    <para>onde <replaceable>command</replaceable> é o nome do comando para aprender. Por exemplo, para saber mais sobre o <citerefentry><refentrytitle>ls</refentrytitle><manvolnum>1</manvolnum></citerefentry>, digite:</para>

    <screen><prompt>%</prompt> <userinput>man ls</userinput></screen>

    <para>As páginas de manual são divididas em seções que representam o tipo de tópico. No FreeBSD, as seguintes seções estão disponíveis:</para>

    <orderedlist>
      <listitem>
	<para>Comandos de usuário.</para>
      </listitem>

      <listitem>
	<para>Chamadas do sistema e números de erro.</para>
      </listitem>

      <listitem>
	<para>Funções nas bibliotecas C.</para>
      </listitem>

      <listitem>
	<para>Drivers de dispositivos.</para>
      </listitem>

      <listitem>
	<para>Formatos de arquivo.</para>
      </listitem>

      <listitem>
	<para>Jogos e outras diversões.</para>
      </listitem>

      <listitem>
	<para>Informações diversas.</para>
      </listitem>

      <listitem>
	<para>Comandos de manutenção e operação do sistema.</para>
      </listitem>

      <listitem>
	<para>Interfaces do kernel do sistema.</para>
      </listitem>
    </orderedlist>

    <para>Em alguns casos, o mesmo tópico pode aparecer em mais de uma seção do manual online. Por exemplo, existe um comando de usuário <command>chmod</command> e uma chamada de sistema <function>chmod()</function>. Para informar ao <citerefentry><refentrytitle>man</refentrytitle><manvolnum>1</manvolnum></citerefentry> qual seção exibir, especifique o número da seção:</para>

    <screen><prompt>%</prompt> <userinput>man 1 chmod</userinput></screen>

    <para>Isto irá mostrar a página de manual do comando <citerefentry><refentrytitle>chmod</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Referências a uma seção em particular do manual online são tradicionalmente colocadas entre parênteses na documentação escrita, então <citerefentry><refentrytitle>chmod</refentrytitle><manvolnum>1</manvolnum></citerefentry> refere-se ao comando do usuário e <citerefentry><refentrytitle>chmod</refentrytitle><manvolnum>2</manvolnum></citerefentry> refere-se à chamada do sistema.</para>

    <para>Se o nome da página de manual for desconhecido, use <command>man -k</command> para procurar por palavras-chave nas descrições da página de manual:</para>

    <screen><prompt>%</prompt> <userinput>man -k <replaceable>mail</replaceable></userinput></screen>

    <para>Este comando exibe uma lista de comandos que possuem a palavra-chave <quote>mail</quote> em suas descrições. Isso é equivalente a usar o <citerefentry><refentrytitle>apropos</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</para>

    <para>Para ler as descrições de todos os comandos em <filename>/usr/bin</filename>, digite:</para>

    <screen><prompt>%</prompt> <userinput>cd /usr/bin</userinput>
<prompt>%</prompt> <userinput>man -f * | more</userinput></screen>

    <para>ou</para>

    <screen><prompt>%</prompt> <userinput>cd /usr/bin</userinput>
<prompt>%</prompt> <userinput>whatis * |more</userinput></screen>

    <sect2 xml:id="basics-info">
      <title>Arquivos GNU Info</title>

      <indexterm><primary>Free Software Foundation</primary></indexterm>

      <para>O FreeBSD inclui vários aplicativos e utilitários produzidos pela Free Software Foundation (FSF). Além das páginas de manual, esses programas podem incluir documentos de hipertexto chamados arquivos <literal>info</literal>. Elas podem ser visualizadas usando <citerefentry><refentrytitle>info</refentrytitle><manvolnum>1</manvolnum></citerefentry> ou, se o <package>editors/emacs</package> estiver instalado, o modo info do <application>emacs</application>.</para>

      <para>Para usar o <citerefentry><refentrytitle>info</refentrytitle><manvolnum>1</manvolnum></citerefentry>, digite:</para>

      <screen><prompt>%</prompt> <userinput>info</userinput></screen>

      <para>Para uma breve introdução, digite <literal>h</literal>. Para uma referência rápida de comandos, digite <literal>?</literal>.</para>
    </sect2>
  </sect1>
</chapter>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<chapter version="5.0" xml:id="ports">

  <title>Instalando Aplicativos: Pacotes e Ports</title>

  <sect1 xml:id="ports-synopsis">
    <title>Sinopse</title>

    <indexterm><primary>ports</primary></indexterm>
    <indexterm><primary>packages</primary></indexterm>
    <para>O FreeBSD tem uma grande coleção de ferramentas dentro do sistema base. Além disso, o FreeBSD fornece duas ferramentas complementares para a instalação de software de terceiros: o a Coleção de Ports do FreeBSD, para instalação a partir do código-fonte, e pacotes, para instalação de binários pré-compilados. Qualquer um dos métodos pode ser usado para instalar um software de uma mídia local ou da rede.</para>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>A diferença entre pacotes binários e ports.</para>
      </listitem>

      <listitem>
	<para>Como encontrar softwares de terceiros que tenham sido portados para o FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como gerenciar pacotes binários usando o <application>pkg</application>.</para>
      </listitem>

      <listitem>
	<para>Como compilar software de terceiros a partir do código-fonte usando a coleção de ports.</para>
      </listitem>

      <listitem>
	<para>Como encontrar os arquivos instalados do aplicativo para configuração pós-instalação.</para>
      </listitem>

      <listitem>
	<para>O que fazer se a instalação do software falhar.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="ports-overview">
    <title>Visão geral sobre a Instalação de Software</title>

    <para>As etapas típicas para instalar um software de terceiros em um sistema <trademark class="registered">UNIX</trademark> incluem:</para>

    <procedure>
      <step>
	<para>Encontre e baixe o software, que pode ser distribuído no formato de código-fonte ou como um binário.</para>
      </step>

      <step>
	<para>Desempacote o software a partir do seu formato de distribuição. Tipicamente é um arquivo tarball compactado com um programa como <citerefentry><refentrytitle>compress</refentrytitle><manvolnum>1</manvolnum></citerefentry>,<citerefentry><refentrytitle>gzip</refentrytitle><manvolnum>1</manvolnum> </citerefentry>, <citerefentry><refentrytitle>bzip2</refentrytitle> <manvolnum>1</manvolnum></citerefentry> ou <citerefentry> <refentrytitle>xz</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</para>
      </step>

      <step>
	<para>Localize a documentação em <filename>INSTALL</filename>, <filename> README </filename> ou algum arquivo em um subdiretório <filename>doc/</filename> e leia sobre como instalar o software.</para>
      </step>

      <step>
	<para>Se o software foi distribuído como código-fonte, compile-o. Isso pode envolver a edição de um <filename>Makefile</filename> ou a execução de um script <command>configure</command>.</para>
      </step>

      <step>
	<para>Teste e instale o software.</para>
      </step>
    </procedure>

    <para>Um <emphasis>port</emphasis> do FreeBSD é uma coleção de arquivos projetados para automatizar o processo de compilação de um aplicativo a partir do código-fonte. Os arquivos que compõem um port contêm todas as informações necessárias para baixar, extrair, corrigir, compilar e instalar automaticamente o aplicativo.</para>

    <para>Se o software ainda não foi adaptado e testado no FreeBSD, o código-fonte pode precisar ser editado para que seja instalado e executado corretamente.</para>

    <para>No entanto, mais de <link xlink:href="@@URL_RELPREFIX@@/ports/index.html">24.000</link> aplicativos de terceiros já foram portados para o FreeBSD. Quando possível, esses aplicativos são disponibilizados para download como <emphasis>pacotes</emphasis> pré-compilados.</para>

    <para>Pacotes podem ser manipulados com os comandos de gerenciamento de pacotes do FreeBSD.</para>

    <para>Ambos, pacotes e ports, entendem dependências. Se um pacote ou port for usado para instalar um aplicativo, e uma biblioteca dependente ainda não estiver instalada, a biblioteca será instalada automaticamente primeiro.</para>

    <para>Um pacote do FreeBSD contém cópias pré-compiladas de todos os comandos para uma aplicação, assim como quaisquer arquivos de configuração e documentação. Um pacote pode ser manipulado com os comandos <citerefentry><refentrytitle>pkg</refentrytitle><manvolnum>8</manvolnum></citerefentry>, como <command>pkg install</command>.</para>

    <para>Mesmo as duas tecnologias sendo semelhantes, os pacotes e os ports têm seus próprios pontos fortes. Selecione a tecnologia que melhor atenda aos seus requisitos para instalar um aplicativo específico.</para>

    <itemizedlist>
      <title>Benefícios dos Pacotes</title>

      <listitem>
	<para>Um tarball compactado de um pacote geralmente é menor que o tarball compactado que contém o código-fonte do aplicativo.</para>
      </listitem>

      <listitem>
	<para>Pacotes não requerem tempo de compilação. Para aplicativos grandes, como o <application>Mozilla</application>, <application>KDE</application> ou <application>GNOME</application>, isso pode ser importante em um sistema lento.</para>
      </listitem>

      <listitem>
	<para>Pacotes não requerem nenhum entendimento do processo envolvido na compilação de software no FreeBSD.</para>
      </listitem>
    </itemizedlist>

    <itemizedlist>
      <title>Benefícios dos Ports</title>

      <listitem>
	<para>Os pacotes são normalmente compilados com opções conservadoras porque eles precisam ser executados no número máximo de sistemas. Ao compilar a partir do port, podem-se alterar as opções de compilação.</para>
      </listitem>

      <listitem>
	<para>Alguns aplicativos têm opções em tempo de compilação relacionadas a quais recursos estão instalados. Por exemplo, o <application>Apache</application> pode ser configurado com uma ampla variedade de diferentes opções internas.</para>

	<para>Em alguns casos, vários pacotes existirão para o mesmo aplicativo para especificar determinadas configurações. Por exemplo, o <application>Ghostscript</application> está disponível como um pacote <filename>ghostscript</filename> e um pacote <filename>ghostscript-nox11</filename>, dependendo se o <application>Xorg</application> está instalado ou não. Criar vários pacotes rapidamente se torna impossível se um aplicativo tiver mais de uma ou duas opções diferentes de tempo de compilação.</para>
      </listitem>

      <listitem>
	<para>As condições de licenciamento de alguns softwares proíbem sua distribuição em binário. Tais softwares devem ser distribuídos como código-fonte o qual deve ser compilado pelo usuário final.</para>
      </listitem>

      <listitem>
	<para>Algumas pessoas não confiam em distribuições binárias ou preferem ler o código-fonte para procurar possíveis problemas.</para>
      </listitem>

      <listitem>
	<para>O código-fonte é necessário para aplicar patches personalizados.</para>
      </listitem>
    </itemizedlist>

    <para>Para acompanhar a atualização dos ports, inscreva-se na <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports">lista de discussão dos ports do FreeBSD </link> e no link <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports-bugs">Lista de discussão de bugs no FreeBSD</link>.</para>

    <warning>
      <para>Antes de instalar qualquer aplicativo, verifique <link xlink:href="https://vuxml.freebsd.org/"/> para questões de segurança relacionadas ao aplicativo ou digite <command>pkg audit -F</command> para verificar todas as instâncias instaladas aplicativos para vulnerabilidades conhecidas.</para>
    </warning>

    <para>O restante deste capítulo explica como usar pacotes e ports para instalar e gerenciar software de terceiros no FreeBSD.</para>
  </sect1>

  <sect1 xml:id="ports-finding-applications">
    <title>Encontrando Software</title>

    <para>A lista de aplicativos disponíveis do FreeBSD está crescendo o tempo todo. Existem várias maneiras de encontrar softwares para instalar:</para>

    <itemizedlist>
      <listitem>
	<para>O site do FreeBSD mantém uma lista atualizada e pesquisável de todos os aplicativos disponíveis, em <link xlink:href="@@URL_RELPREFIX@@/ports/index.html">https://www.FreeBSD.org/ ports/</link>. Os ports podem ser pesquisados por nome do aplicativo ou por categoria de software.</para>
      </listitem>

      <listitem>
	<indexterm><primary>FreshPorts</primary></indexterm>

	<para>Dan Langille mantém o <link xlink:href="http://www.FreshPorts.org/">FreshPorts.org</link>, que fornece um utilitário de pesquisa abrangente e também rastreia alterações nos aplicativos da Coleção de Ports. Os usuários registrados podem criar uma lista de observação personalizada para receber um e-mail automatizado quando seus ports sendo monitorados forem atualizados.</para>
      </listitem>

      <listitem>
	<indexterm><primary>SourceForge</primary></indexterm>

	<para>Se encontrar um aplicativo específico se tornar desafiador, tente pesquisar um site como <link xlink:href="http://www.sourceforge.net/">SourceForge.net</link> ou <link xlink:href="http://www.github.com/">GitHub.com</link> então volte no <link xlink:href="@@URL_RELPREFIX@@/ports/index.html">site do FreeBSD</link> para ver se o aplicativo foi portado.</para>
      </listitem>

      <listitem>
	<indexterm><primary>pkg</primary> <secondary>search</secondary></indexterm>

	<para xml:id="pkg-search">Para pesquisar o repositório de pacotes binários por um aplicativo:</para>

	<screen><prompt>#</prompt> <userinput>pkg search <replaceable>subversion</replaceable></userinput>
git-subversion-<replaceable>1.9.2</replaceable>
java-subversion-<replaceable>1.8.8_2</replaceable>
p5-subversion-<replaceable>1.8.8_2</replaceable>
py27-hgsubversion-<replaceable>1.6</replaceable>
py27-subversion-<replaceable>1.8.8_2</replaceable>
ruby-subversion-<replaceable>1.8.8_2</replaceable>
subversion-<replaceable>1.8.8_2</replaceable>
subversion-book-<replaceable>4515</replaceable>
subversion-static-<replaceable>1.8.8_2</replaceable>
subversion16-<replaceable>1.6.23_4</replaceable>
subversion17-<replaceable>1.7.16_2</replaceable></screen>

	<para>Os nomes dos pacotes incluem o número da versão e, no caso de ports baseados em python, o número da versão  do pacote python sobre o qual o pacote foi compilado. Alguns ports também possuem várias versões disponíveis. No caso do <application>Subversion</application>, existem diferentes versões disponíveis, bem como diferentes opções de compilação. Neste caso, a versão estaticamente vinculada do <application>Subversion</application>. Ao indicar qual pacote instalar, é melhor especificar o aplicativo pela origem do port, que é o caminho na árvore de ports. Repita o <command>pkg search</command> com <option>-o</option> para listar a origem de cada pacote:</para>

	<screen><prompt>#</prompt> <userinput>pkg search -o <replaceable>subversion</replaceable></userinput>
devel/git-subversion
java/java-subversion
devel/p5-subversion
devel/py-hgsubversion
devel/py-subversion
devel/ruby-subversion
devel/subversion16
devel/subversion17
devel/subversion
devel/subversion-book
devel/subversion-static</screen>

	<para>Pesquisar por shell globs, expressões regulares, correspondência exata, por descrição ou qualquer outro campo no banco de dados do repositório também é suportado pelo <command>pkg search</command>. Depois de instalar o <package>ports-mgmt/pkg</package> ou o <package>ports-mgmt/pkg-devel</package>, veja <citerefentry><refentrytitle>pkg-search</refentrytitle><manvolnum>8</manvolnum></citerefentry> para maiores detalhes.</para>
      </listitem>

      <listitem>
	<para>Se a Coleção de Ports já estiver instalada, existem vários métodos para consultar a versão local da árvore de ports. Para descobrir em qual categoria um port está, digite <command>whereis<replaceable> file </replaceable></command>, onde <replaceable>file</replaceable> é o programa a ser instalado:</para>

	<screen><prompt>#</prompt> <userinput>whereis lsof</userinput>
lsof: /usr/ports/sysutils/lsof</screen>

	<para>Como alternativa, uma declaração  <citerefentry><refentrytitle>echo</refentrytitle><manvolnum>1</manvolnum></citerefentry> pode ser usada:</para>

	<screen><prompt>#</prompt> <userinput>echo /usr/ports/*/*lsof*</userinput>
/usr/ports/sysutils/lsof</screen>

	<para>Observe que isso também retornará todos os arquivos correspondentes baixados no diretório <filename>/usr/ports/distfiles</filename>.</para>
      </listitem>

      <listitem>
	<para>Outra maneira de encontrar software é usando o mecanismo de pesquisa integrado da Coleção de Ports. Para usar o recurso de pesquisa, <application>cd</application> para <filename>/usr/ports</filename>, execute <command>make search name=program-name</command> onde <replaceable>program-name</replaceable> é o nome do software. Por exemplo, para procurar por <command>lsof</command>:</para>

	<screen><prompt>#</prompt> <userinput>cd /usr/ports</userinput>
<prompt>#</prompt> <userinput>make search name=lsof</userinput>
Port:   lsof-4.88.d,8
Path:   /usr/ports/sysutils/lsof
Info:   Lists information about open files (similar to fstat(1))
Maint:  ler@lerctr.org
Index:  sysutils
B-deps:
R-deps: </screen>

	<tip>
	  <para>O mecanismo de pesquisa interna usa um arquivo de informações de índice. Se uma mensagem indicar que o <filename>INDEX</filename> é necessário, execute <command>make fetchindex</command> para baixar o arquivo de índice atual. Com o <filename>INDEX</filename> presente, o <command>make search</command> poderá realizar a pesquisa solicitada.</para>
	</tip>

	<para>A linha <quote>Path:</quote> indica onde encontrar o port.</para>

	<para>Para receber menos informações, use o recurso <command>quicksearch</command>:</para>

	<screen><prompt>#</prompt> <userinput>cd /usr/ports</userinput>
<prompt>#</prompt> <userinput>make quicksearch name=lsof</userinput>
Port:   lsof-4.88.d,8
Path:   /usr/ports/sysutils/lsof
Info:   Lists information about open files (similar to fstat(1))</screen>

	<para>Para uma busca mais aprofundada, use o <command>make search key=<replaceable>string</replaceable></command> ou o <command>make quicksearch key=<replaceable>string</replaceable></command>, onde <replaceable>string</replaceable> é algum texto para procurar. O texto pode estar em comentários, descrições ou dependências para encontrar ports relacionados a um assunto em particular quando o nome do programa é desconhecido.</para>

	<para>Ao usar <buildtarget>pesquisa</buildtarget> ou <buildtarget>pesquisa rápida</buildtarget>, a cadeia de pesquisa não diferencia maiúsculas de minúsculas. Procurar por <quote>LSOF</quote> produzirá os mesmos resultados que procurar por <quote>lsof</quote>.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="pkgng-intro">
    <title>Usando o <application>pkg</application> para o gerenciamento de pacotes binários</title>

    <para>O <application>pkg</application> é o substituto da próxima geração para as tradicionais ferramentas de gerenciamento de pacotes do FreeBSD, oferecendo muitos recursos que tornam o processamento de pacotes binários mais rápido e fácil.</para>

    <para>Para sites que desejam apenas usar pacotes binários pré-construídos a partir dos espelhos do FreeBSD, o gerenciamento de pacotes com <application>pkg</application> pode ser suficiente.</para>

    <para>No entanto, para aqueles que optarem por compilar suas aplicações a partir do código-fonte ou que utilizarem seus próprios repositórios, será necessária uma <link linkend="ports-upgrading-tools">ferramenta de gerenciamento de ports</link> separada.</para>

    <para>Como o <application>pkg</application> só funciona com pacotes binários, ele não é um substituto para tais ferramentas. Estas ferramentas podem ser usadas para instalar o software a partir de pacotes binários e da Coleção do Ports, enquanto o <application>pkg</application> instala apenas pacotes binários.</para>

    <sect2 xml:id="pkgng-initial-setup">
      <title>Introdução ao <application>pkg</application></title>

      <para>O FreeBSD inclui um utilitário de bootstrap que pode ser usado para baixar e instalar o <application>pkg</application> e suas páginas de manual. Este utilitário foi projetado para funcionar com versões do FreeBSD começando com 10.<replaceable>X</replaceable>.</para>

      <note>
	<para>Nem todas as versões e arquiteturas do FreeBSD suportam este processo de bootstrap. A lista atual está em <link xlink:href="https://pkg.freebsd.org/"/>. Para outros casos, o <application>pkg</application> deve ser instalado a partir da coleção de ports ou como um pacote binário.</para>

      </note>

      <para>Para inicializar o sistema, execute:</para>

      <screen><prompt>#</prompt> <userinput>/usr/sbin/pkg</userinput></screen>

      <para>Você deve ter uma conexão com a Internet para que o processo de inicialização seja bem-sucedido.</para>

      <para>Caso contrário, para instalar o port, execute:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/ports-mgmt/pkg</userinput>
<prompt>#</prompt> <userinput>make</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>

      <para>Ao atualizar um sistema existente que usava originalmente as ferramentas pkg_ * mais antigas, o banco de dados deve ser convertido para o novo formato, para que as novas ferramentas estejam cientes dos pacotes já instalados. Uma vez que o <application>pkg</application> tenha sido instalado, o banco de dados de pacotes deve ser convertido do formato tradicional para o novo formato, executando este comando:</para>

      <screen><prompt>#</prompt> <userinput>pkg2ng</userinput></screen>

      <note><para>Esta etapa não é necessária para novas instalações que ainda não possuem nenhum software de terceiros instalado.</para></note>

      <important>
	<para>Este passo não é reversível. Uma vez que o banco de dados de pacotes tenha sido convertido para o formato <application>pkg</application>, as ferramentas tradicionais <literal> pkg _ * </literal> não devem mais ser usadas.</para>
      </important>

      <note>
	<para>A conversão do banco de dados de pacotes pode emitir erros conforme o conteúdo é convertido para a nova versão. Geralmente, esses erros podem ser ignorados com segurança. No entanto, uma lista com os softwares que não foram convertidos com sucesso é mostrada após o <command>pkg2ng</command> terminar. Esses aplicativos devem ser reinstalados manualmente.</para>
      </note>

      <para>Para garantir que a Coleção de Ports registre novos softwares com o <application>pkg</application> ao invés do tradicional banco de dados de pacotes, versões do FreeBSD anteriores a 10.<replaceable>X</replaceable> requerem esta linha em <filename>/etc/make.conf</filename>:</para>

      <programlisting>WITH_PKGNG=	yes</programlisting>

      <para>Por padrão, o <application>pkg</application> usa os pacotes binários dos espelhos de pacotes do FreeBSD (o <emphasis>repositório</emphasis>). Para obter informações sobre como criar um repositório de pacotes personalizados, consulte <xref linkend="ports-poudriere"/>.</para>

      <para>Opções adicionais de configuração do <application>pkg</application> são descritas em <citerefentry><refentrytitle>pkg.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>

      <para>As informações de uso do <application>pkg</application> estão disponíveis na página de manual <citerefentry><refentrytitle>pkg</refentrytitle><manvolnum>8</manvolnum></citerefentry> ou executando o <command>pkg</command> sem argumentos adicionais.</para>

      <para>Cada argumento do comando <application>pkg</application> é documentado em uma página de manual específica do comando. Para ler a página de manual do <command>pkg install</command>, por exemplo, execute um destes comandos:</para>

      <screen><prompt>#</prompt> <userinput>pkg help install</userinput></screen>

      <screen><prompt>#</prompt> <userinput>man pkg-install</userinput></screen>

      <para>O restante desta seção demonstra tarefas comuns de gerenciamento de pacotes binários que podem ser executadas usando o <application>pkg</application>. Cada comando demonstrado fornece muitos switches para personalizar seu uso. Consulte a ajuda de um comando ou a página do manual para obter detalhes e mais exemplos.</para>
    </sect2>

    <sect2 xml:id="quarterly-latest-branch">
      <title>Branches Ports Trimestrais e Mais Recentes</title>

      <para>As branches <literal>Quarterly</literal>(trimestrais) provê aos usuários uma experiência mais estável e previsível para instalação e upgrade de ports e pacotes.  Isto é feito essencialmente permitindo apenas atualizações que não contém novas features (non-features updates). Branches trimestrais visam receber correções se segurança (que talvez sejam atualizações de versão, ou commits de backports), correções de bugs e compliance de ports ou alterações de frameworks. A branch trimestral é baseada (anualmente) na HEAD no início de Janeiro, Abril, Julho e Outubro. As branches são nomeadas de acordo com o ano (YYYY) e o quarter (Q1-4) em que são criadas. Por exemplo, a branch trimestral criada em Janeiro de 2016, é nomeada 2016Q1. E a branch <literal>Latest</literal> provê as últimas versões dos pacotes para os usuários.</para>

      <para>Para alternar de trimestral para latest execute os seguintes comandos:</para>

      <screen><prompt>#</prompt> <userinput>cp /etc/pkg/FreeBSD.conf /usr/local/etc/pkg/repos/FreeBSD.conf</userinput></screen>

      <para>Edite o arquivo <filename>/usr/local/etc/pkg/repos/FreeBSD.conf</filename> and change the string <emphasis>quarterly</emphasis> to <emphasis>latest</emphasis> in the <literal>url:</literal> line.</para>

      <para>O resultado deve ser semelhante ao seguinte:</para>

      <programlisting>FreeBSD: {
  url: "pkg+http://pkg.FreeBSD.org/${ABI}/latest",
  mirror_type: "srv",
  signature_type: "fingerprints",
  fingerprints: "/usr/share/keys/pkg",
  enabled: yes
}</programlisting>

      <para>E finalmente rode este comando para atualizar do novo (ultimo) meta dado do repositório.</para>

      <screen><prompt>#</prompt> <userinput>pkg update -f</userinput></screen>

    </sect2>

    <sect2 xml:id="pkgng-pkg-info">
      <title>Obtendo informações sobre os pacotes instalados</title>

      <para>Informações sobre os pacotes instalados em um sistema podem ser visualizadas executando <command>pkg info</command> que, quando executado sem qualquer opção, listará a versão do pacote para todos os pacotes instalados ou para o pacote especificado.</para>

      <para>Por exemplo, para ver qual versão do <application>pkg</application> está instalada, execute:</para>

      <screen><prompt>#</prompt> <userinput>pkg info pkg</userinput>
pkg-1.1.4_1</screen>
    </sect2>

    <sect2 xml:id="pkgng-installing-deinstalling">
      <title>Instalando e removendo pacotes</title>

      <para>Para instalar um pacote binário, use o seguinte comando, em que <replaceable>packagename</replaceable> é o nome do pacote a ser instalado:</para>

      <screen><prompt>#</prompt> <userinput>pkg install <replaceable>packagename</replaceable></userinput></screen>

      <para>Esse comando usa os dados do repositório para determinar qual versão do software instalar e se ele possui alguma dependência faltando. Por exemplo, para instalar o <application>curl</application>:</para>

      <screen><prompt>#</prompt> <userinput>pkg install curl</userinput>
Updating repository catalogue
/usr/local/tmp/All/curl-7.31.0_1.txz          100% of 1181 kB 1380 kBps 00m01s

/usr/local/tmp/All/ca_root_nss-3.15.1_1.txz   100% of  288 kB 1700 kBps 00m00s

Updating repository catalogue
The following 2 packages will be installed:

        Installing ca_root_nss: 3.15.1_1
        Installing curl: 7.31.0_1

The installation will require 3 MB more space

0 B to be downloaded

Proceed with installing packages [y/N]: <userinput>y</userinput>
Checking integrity... done
[1/2] Installing ca_root_nss-3.15.1_1... done
[2/2] Installing curl-7.31.0_1... done
Cleaning up cache files...Done</screen>

	<para>O novo pacote e quaisquer pacotes adicionais que foram instalados como dependências podem ser vistos na lista de pacotes instalados:</para>

	<screen><prompt>#</prompt> <userinput>pkg info</userinput>
ca_root_nss-3.15.1_1	The root certificate bundle from the Mozilla Project
curl-7.31.0_1	Non-interactive tool to get files from FTP, GOPHER, HTTP(S) servers
pkg-1.1.4_6	New generation package manager</screen>

	<para>Pacotes que não são mais necessários podem ser removidos com <command>pkg delete</command>. Por exemplo:</para>

	<screen><prompt>#</prompt> <userinput>pkg delete curl</userinput>
The following packages will be deleted:

	curl-7.31.0_1

The deletion will free 3 MB

Proceed with deleting packages [y/N]: <userinput>y</userinput>
[1/1] Deleting curl-7.31.0_1... done</screen>
    </sect2>

    <sect2 xml:id="pkgng-upgrading">
      <title>Atualizando os Pacotes Instalados</title>

      <para>Os pacotes instalados podem ser atualizados para as versões mais recentes executando:</para>

      <screen><prompt>#</prompt> <userinput>pkg upgrade</userinput></screen>

      <para>Este comando irá comparar as versões instaladas com as disponíveis no catálogo do repositório e atualizá-las a partir do repositório.</para>
    </sect2>

    <sect2 xml:id="pkgng-auditing">
      <title>Auditando os Pacotes Instalados</title>

      <para>Vulnerabilidades de software são regularmente descobertas em aplicativos de terceiros. Para resolver isso, o <application>pkg</application> inclui um mecanismo de auditoria integrado. Para determinar se há alguma vulnerabilidade conhecida para o software instalado no sistema, execute:</para>

	<screen><prompt>#</prompt> <userinput>pkg audit -F</userinput></screen>
    </sect2>

    <sect2 xml:id="pkgng-autoremove">
      <title>Removendo Pacotes Não Utilizados Automaticamente</title>

      <para>Remover um pacote pode deixar dependências que não são mais necessárias. Pacotes desnecessários que foram instalados como dependências podem ser automaticamente detectados e removidos usando:</para>

      <screen><prompt>#</prompt> <userinput>pkg autoremove</userinput>
Packages to be autoremoved:
	ca_root_nss-3.15.1_1

The autoremoval will free 723 kB

Proceed with autoremoval of packages [y/N]: <userinput>y</userinput>
Deinstalling ca_root_nss-3.15.1_1... done</screen>

      <para>Os pacotes instalados como dependências são chamados de pacotes <emphasis>automáticos</emphasis>. Pacotes não automáticos, ou seja, os pacotes que não foram instalados como uma dependência para outro pacote, podem ser listados usando:</para>

      <screen><prompt>#</prompt> <userinput>pkg prime-list</userinput>
nginx
openvpn
sudo</screen>

      <para>O <command>pkg prime-list</command> é um alias de comando declarado no  <filename>/usr/local/etc/pkg.conf</filename>. Existem muitos outros que podem ser usados para consultar o banco de dados de pacotes do sistema. Por exemplo, o comando <command>pkg prime-origins</command> pode ser usado para obter o diretório de origem dos ports da lista mencionada acima:</para>

      <screen><prompt>#</prompt> <userinput>pkg prime-origins</userinput>
www/nginx
security/openvpn
security/sudo</screen>

      <para>Esta lista pode ser usada para recompilar todos os pacotes instalados em um sistema usando ferramentas de compilação como o <package>ports-mgmt/poudriere</package> ou o <package>ports-mgmt/synth</package>.</para>

    <para>Marcar um pacote instalado como automático pode ser feito usando:</para>

      <screen><prompt>#</prompt> <userinput>pkg set -A 1 devel/cmake</userinput></screen>

      <para>Uma vez que um pacote é um pacote orfão e está marcado como automático, ele será selecionado por <command>pkg autoremove</command>.</para>

      <para>Marcar um pacote instalado como <emphasis>não</emphasis> automático pode ser feito usando:</para>

      <screen><prompt>#</prompt> <userinput>pkg set -A 0 devel/cmake</userinput></screen>

    </sect2>

    <sect2 xml:id="pkgng-backup">
      <title>Restaurando o banco de dados de pacotes</title>

      <para>Ao contrário do sistema tradicional de gerenciamento de pacotes, o <application>pkg</application> inclui seu próprio mecanismo de backup de banco de dados de pacotes. Essa funcionalidade é habilitada por padrão.</para>

      <tip>
	<para>Para desabilitar o script que faz o backup periódico do banco de dados de pacotes, defina <literal>daily_backup_pkgdb_enable="NO"</literal> no <citerefentry><refentrytitle>periodic.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>
      </tip>

      <para>Para restaurar o conteúdo de um backup anterior do banco de dados de pacotes, execute o seguinte comando substituindo <replaceable>/path/to/pkg.sql</replaceable> pelo local do backup:</para>

      <screen><prompt>#</prompt> <userinput>pkg backup -r <replaceable>/path/to/pkg.sql</replaceable></userinput></screen>

      <note>
	<para>Se estiver restaurando um backup feito pelo script periódico, ele deve ser descompactado antes de ser restaurado.</para>
      </note>

      <para>Para executar um backup manual do banco de dados <application>pkg</application>, execute o seguinte comando, substituindo <replaceable>/path/to/pkg.sql</replaceable> por um nome de arquivo e local adequados:</para>

      <screen><prompt>#</prompt> <userinput>pkg backup -d <replaceable>/path/to/pkg.sql</replaceable></userinput></screen>
    </sect2>

    <sect2 xml:id="pkgng-clean">
      <title>Removendo Pacotes Obsoletos</title>

      <para>Por padrão, o <application>pkg</application> armazena pacotes binários em um diretório de cache definido por <envar>PKG_CACHEDIR</envar> no <citerefentry> <refentrytitle>pkg.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>. Somente cópias dos últimos pacotes instalados são mantidas. Versões mais antigas do <application>pkg</application> mantinham todos os pacotes anteriores. Para remover esses pacotes binários desatualizados, execute:</para>

      <screen><prompt>#</prompt> <userinput>pkg clean</userinput></screen>

      <para>O cache inteiro pode ser limpo executando:</para>

      <screen><prompt>#</prompt> <userinput>pkg clean -a</userinput></screen>
    </sect2>

    <sect2 xml:id="pkgng-set">
      <title>Modificando Metadados de Pacotes</title>

      <para>Os softwares dentro da Coleção de Ports do FreeBSD podem passar por grandes mudanças no número de versão. Para resolver isso, o <application>pkg</application> possui um comando interno para atualizar as origens do pacote. Isto pode ser útil, por exemplo, se <package>lang/php5</package> for renomeado para <package>lang/php53</package> para que <package>lang/php5</package> possa agora representar a versão <literal>5.4</literal>.</para>

      <para>Para alterar a origem do pacote para o exemplo acima, execute:</para>

      <screen><prompt>#</prompt> <userinput>pkg set -o lang/php5:lang/php53</userinput></screen>

      <para>Como outro exemplo, para atualizar <package>lang/ruby18</package> para <package>lang/ruby19</package>, execute:</para>

      <screen><prompt>#</prompt> <userinput>pkg set -o lang/ruby18:lang/ruby19</userinput></screen>

      <para>Como um exemplo final, para alterar a origem das bibliotecas compartilhadas <filename>libglut</filename> de <package>graphics/libglut</package> para <package>graphics/freeglut</package>, execute:</para>

      <screen><prompt>#</prompt> <userinput>pkg set -o graphics/libglut:graphics/freeglut</userinput></screen>

      <note>
	<para>Ao alterar as origens do pacote, é importante reinstalar os pacotes que dependem do pacote com a origem modificada. Para forçar uma reinstalação dos pacotes dependentes, execute:</para>

	<screen><prompt>#</prompt> <userinput>pkg install -Rf <replaceable>graphics/freeglut</replaceable></userinput></screen>
      </note>
    </sect2>
  </sect1>

  <sect1 xml:id="ports-using">
    <title>Usando a Coleção de Ports</title>

    <para>A Coleção de Ports é um conjunto de <filename>Makefile</filename>s, patches e arquivos de descrição. Cada conjunto desses arquivos é usado para compilar e instalar um aplicativo individual no FreeBSD, e é chamado de <emphasis>port</emphasis>.</para>

    <para>Por padrão, a própria coleção de ports é armazenada como um subdiretório de <filename>/usr/ports</filename>.</para>

    <warning>
      <para xml:lang="en">Before installing and using the Ports Collection, please
	be aware that it is generally ill-advised to use the
	Ports Collection in conjunction with the binary packages
	provided via <application>pkg</application> to install
	software.  <application>pkg</application>, by default,
	tracks quarterly branch-releases of the ports
	tree and not HEAD. Dependencies could be different for a port
	in HEAD compared to its counterpart in a quarterly branch
	release and this could result in conflicts between
	dependencies installed by <application>pkg</application>
	and those from the Ports Collection.
	If the Ports Collection and <application>pkg</application>
	must be used in conjunction, then be sure that your
	Ports Collection and <application>pkg</application> are
	on the same branch release of the ports tree.</para>
    </warning>

    <para>Antes que um aplicativo possa ser compilado usando um port, a Coleção de Ports deve primeiro ser instalada. Se ela não foi instalada durante a instalação do FreeBSD, use um dos seguintes métodos para instalá-la:</para>

    <procedure xml:id="ports-using-portsnap-method">
      <title>Método Portsnap</title>

      <para>O sistema base do FreeBSD inclui o <application>Portsnap</application>. Esta é uma ferramenta rápida e de fácil utilização para obter a Coleção de Ports e é a escolha recomendada para a maioria dos usuários que não estão executando o FreeBSD-CURRENT. Este utilitário se conecta a um site do FreeBSD, verifica a chave segura e faz o download de uma nova cópia da Coleção de Ports. A chave é usada para verificar a integridade de todos os arquivos baixados.</para>

      <step>
	<para>Para baixar um snapshot compactado da coleção de ports em <filename>/var/db/portsnap</filename>:</para>

	<screen><prompt>#</prompt> <userinput>portsnap fetch</userinput></screen>
      </step>

      <step>
	<para>Ao executar o <application>Portsnap</application> pela primeira vez, extraia o snapshot em <filename>/usr/ports</filename>:</para>

	<screen><prompt>#</prompt> <userinput>portsnap extract</userinput></screen>
      </step>

      <step>
	<para>Após o primeiro uso do <application>Portsnap</application> ter sido concluído, como mostrado acima, o <filename>/usr/ports</filename> pode ser atualizado conforme necessário executando:</para>

	<screen><prompt>#</prompt> <userinput>portsnap fetch</userinput>
<prompt>#</prompt> <userinput>portsnap update</userinput></screen>

	<para>Ao usar <literal>fetch</literal>, a operação <literal>extract</literal> ou <literal>update</literal> pode ser executada consecutivamente, da seguinte forma:</para>

	<screen><prompt>#</prompt> <userinput>portsnap fetch update</userinput></screen>
      </step>
    </procedure>

    <procedure xml:id="ports-using-subversion-method">
      <title>Método Subversion</title>

      <para>Se for necessário mais controle sobre a árvore de ports ou se as mudanças locais precisarem ser mantidas, ou se estiver executando o FreeBSD-CURRENT, o <application>Subversion</application> pode ser usado para obter a coleção de ports. Consulte <link xlink:href="@@URL_RELPREFIX@@/doc/en_US.ISO8859-1/articles/committers-guide/subversion-primer.html">O Subversion Primer</link> para uma descrição detalhada do <application>Subversion</application>.</para>

      <step>
	<para>O <application>Subversion</application> deve ser instalado antes de poder ser usado para fazer o check-out da árvore de ports. Se uma cópia da árvore de ports já estiver presente, instale o <application>Subversion</application> desta forma:</para>

	<screen><prompt>#</prompt> <userinput>cd /usr/ports/devel/subversion</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>

	<para>Se a árvore de ports não estiver disponível, ou o <application>pkg</application> estiver sendo usado para gerenciar pacotes, o <application>Subversion</application> poderá ser instalado como um pacote:</para>

	<screen><prompt>#</prompt> <userinput>pkg install subversion</userinput></screen>

      </step>

      <step>
	<para xml:lang="en">Check out a copy of the HEAD branch of the ports
	  tree:</para>

	<screen><prompt>#</prompt> <userinput>svn checkout https://svn.FreeBSD.org/ports/head /usr/ports</userinput></screen>
      </step>

      <step>
	<para xml:lang="en">Or, check out a copy of a quarterly branch:</para>

	<screen xml:lang="en"><prompt>#</prompt> <userinput>svn checkout https://svn.FreeBSD.org/ports/branches/2020Q3 /usr/ports</userinput></screen>
      </step>

      <step>
	<para>Conforme necessário, atualize o <filename>/usr/ports</filename> após o check out inicial do <application>Subversion</application>:</para>

	<screen><prompt>#</prompt> <userinput>svn update /usr/ports</userinput></screen>
      </step>

      <step>
	<para xml:lang="en">As needed, switch <filename>/usr/ports</filename> to a
	  different quarterly branch:</para>

	<screen xml:lang="en"><prompt>#</prompt> <userinput>svn switch http://svn.freebsd.org/ports/branches/2020Q4/ /usr/ports</userinput></screen>
      </step>
    </procedure>

    <para>A coleção de ports contém diretórios para categorias de software. Dentro de cada categoria estão subdiretórios para aplicativos individuais. Cada subdiretório de aplicativo contém um conjunto de arquivos que informa ao FreeBSD como compilar e instalar esse programa, chamado de <emphasis>esqueleto do ports</emphasis>. Cada esqueleto de port inclui esses arquivos e diretórios:</para>

    <itemizedlist>
      <listitem>
	<para><filename>Makefile</filename>: contém instruções que especificam como o aplicativo deve ser compilado e onde seus componentes devem ser instalados.</para>
      </listitem>

      <listitem>
	<para><filename>distinfo</filename>: contém os nomes e checksums dos arquivos que devem ser baixados para compilar o port.</para>
      </listitem>

      <listitem>
	<para><filename>files/</filename>: este diretório contém quaisquer patches necessários para o programa compilar e instalar no FreeBSD. Esse diretório também pode conter outros arquivos usados para compilar o port.</para>
      </listitem>

      <listitem>
	<para><filename>pkg-descr</filename>: fornece uma descrição mais detalhada do programa.</para>
      </listitem>

      <listitem>
	<para><filename>pkg-plist</filename>: uma lista de todos os arquivos que serão instalados pelo port. Ele também informa ao sistema de ports quais arquivos devem ser removidos após a desinstalação.</para>
      </listitem>
    </itemizedlist>

    <para>Alguns ports incluem <filename>pkg-message</filename> ou outros arquivos para lidar com situações especiais. Para obter mais detalhes sobre esses arquivos e sobre os ports em geral, consulte o <link xlink:href="@@URL_RELPREFIX@@/doc/en_US.ISO8859-1/books/porters-handbook/index.html">FreeBSD Porter's Manual</link>.</para>

    <para>O port não inclui o código-fonte real, também conhecido como <filename>distfile</filename>. A etapa de extração da compilação de um port salvará automaticamente o código-fonte transferido por download para <filename>/usr/ports/distfiles</filename>.</para>

    <sect2 xml:id="ports-skeleton">
      <title>Instalando Ports</title>

      <indexterm><primary>ports</primary> <secondary>installing</secondary></indexterm>

      <para>Esta seção fornece instruções básicas sobre o uso da Coleção de Ports para instalar ou remover software. A descrição detalhada dos targets disponíveis do <command>make</command> e das variáveis de ambiente está disponível em <citerefentry><refentrytitle>ports</refentrytitle><manvolnum>7</manvolnum></citerefentry>.</para>

      <warning>
	<para>Antes de compilar qualquer port, certifique-se de atualizar a Coleção de Ports conforme descrito na seção anterior. Como a instalação de qualquer software de terceiros pode introduzir vulnerabilidades de segurança, recomenda-se primeiro verificar <link xlink:href="https://vuxml.freebsd.org/"/> para problemas de segurança conhecidos relacionados ao port. Alternativamente, execute <command>pkg -f</command> antes de instalar um novo port. Esse comando pode ser configurado para executar automaticamente uma auditoria de segurança e uma atualização do banco de dados de vulnerabilidades durante a verificação diária do sistema de segurança. Para obter maiores informações, consulte <citerefentry><refentrytitle>pkg-audit</refentrytitle><manvolnum>8</manvolnum></citerefentry> e <citerefentry><refentrytitle>periodic</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
      </warning>

      <para>O uso da coleção de ports pressupõe uma conexão de Internet ativa. Também requer privilégios de superusuário.</para>

      <para>Para compilar e instalar o port, mude para o diretório do port a ser instalado e, em seguida, digite <command>make install</command> no prompt. Mensagens indicarão o progresso:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/sysutils/lsof</userinput>
<prompt>#</prompt> <userinput>make install</userinput>
&gt;&gt; lsof_4.88D.freebsd.tar.gz doesn't seem to exist in /usr/ports/distfiles/.
&gt;&gt; Attempting to fetch from ftp://lsof.itap.purdue.edu/pub/tools/unix/lsof/.
===&gt;  Extracting for lsof-4.88
...
[extraction output snipped]
...
&gt;&gt; Checksum OK for lsof_4.88D.freebsd.tar.gz.
===&gt;  Patching for lsof-4.88.d,8
===&gt;  Applying FreeBSD patches for lsof-4.88.d,8
===&gt;  Configuring for lsof-4.88.d,8
...
[configure output snipped]
...
===&gt;  Building for lsof-4.88.d,8
...
[compilation output snipped]
...

===&gt;  Installing for lsof-4.88.d,8
...
[installation output snipped]
...
===&gt;   Generating temporary packing list
===&gt;   Compressing manual pages for lsof-4.88.d,8
===&gt;   Registering installation for lsof-4.88.d,8
===&gt;  SECURITY NOTE:
      This port has installed the following binaries which execute with
      increased privileges.
/usr/local/sbin/lsof
<prompt>#</prompt></screen>

      <para>Como o <command>lsof</command> é um programa que é executado com privilégios aumentados, um aviso de segurança é exibido quando é instalado. Quando a instalação estiver concluída, o prompt será retornado.</para>

      <para>Algumas shells mantêm um cache dos comandos que estão disponíveis nos diretórios listados na variável de ambiente <envar>PATH</envar>, para acelerar as operações de pesquisa do arquivo executável desses comandos. Os usuários do shell <command>tcsh</command> devem digitar <command>rehash</command> para que um comando recém-instalado possa ser usado sem especificar seu caminho completo. Use <command>hash -r</command> para o shell <command>sh</command>. Consulte a documentação do shell para mais informações.</para>

      <para>Durante a instalação, é criado um subdiretório de trabalho que contém todos os arquivos temporários usados durante a compilação. A remoção desse diretório economiza espaço em disco e minimiza a possibilidade de problemas mais tarde ao atualizar para a versão mais recente do port:</para>

      <screen><prompt>#</prompt> <userinput>make clean</userinput>
===&gt;  Cleaning for lsof-88.d,8
<prompt>#</prompt></screen>

      <note>
	<para>Para evitar esta etapa extra, use <command>make install clean</command> ao compilar o port.</para>
      </note>

      <sect3>
	<title>Personalizando a instalação de ports</title>

	<para>Alguns ports fornecem opções de compilação que podem ser usadas para habilitar ou desabilitar componentes do aplicativo, fornecer opções de segurança ou permitir outras personalizações. Os exemplos incluem o <package>www/firefox</package>, <package>security/gpgme</package>, e <package>mail/sylpheed-claws</package>. Se o port depender de outros ports que tenham opções configuráveis, ela poderá pausar várias vezes para interação do usuário, pois o comportamento padrão é solicitar ao usuário que selecione opções de um menu. Para evitar isso e fazer toda a configuração em um lote, execute <command>make config-recursive</command> dentro do diretório do port. Em seguida, execute <command>make install [clean]</command> para compilar e instalar o port.</para>

	<tip>
	  <para>Ao usar <buildtarget>config-recursive</buildtarget>, a lista de ports a serem configurados é reunida pelo target <buildtarget>all-depends-list</buildtarget>. É recomendado executar o <command>make config-recursive</command> até que todas as opções dos ports dependentes tenham sido definidas, e as telas de opções de ports não apareçam mais, para ter certeza de que todas as opções das dependência foram configuradas.</para>
	</tip>

	<para>Há várias maneiras de revisitar o menu de opções de compilação de um port para adicionar, remover ou alterar essas opções após a compilação de um port. Um método é efetuar <command>cd</command> no diretório que contém o  port e digitar <command>make config</command>. Outra opção é usar o <command>make showconfig</command>. Outra opção é executar <command>make rmconfig</command>, o que removerá todas as opções selecionadas e permitirá que você comece de novo. Todas essas opções, e outras, são explicadas detalhadamente em <citerefentry> <refentrytitle>ports</refentrytitle><manvolnum>7</manvolnum></citerefentry>.</para>

	<para>O sistema de ports usa o <citerefentry><refentrytitle>fetch</refentrytitle><manvolnum>1</manvolnum></citerefentry> para fazer o download dos arquivos com o código-fonte, que suportam várias variáveis de ambiente. As variáveis <envar>FTP_PASSIVE_MODE</envar>, <envar>FTP_PROXY</envar> e <envar>FTP_PASSWORD</envar> podem precisar ser definidas se o sistema FreeBSD estiver por trás de um firewall ou proxy FTP/HTTP. Veja <citerefentry><refentrytitle>fetch</refentrytitle><manvolnum>3</manvolnum></citerefentry> para a lista completa de variáveis suportadas.</para>

	<para>Para usuários que não podem estar conectados à Internet o tempo todo, o <command>make fetch</command> pode ser executado dentro do <filename>/usr/ports</filename>, para buscar todos os distfiles, ou dentro de uma categoria, como <filename>/usr/ports/net</filename>, ou dentro do diretório de um port especifico. Observe que, se um port tiver alguma dependência, executar este comando em uma categoria ou diretório de um port especifico  <emphasis>não</emphasis> buscará os distfiles de ports de outra categoria. Em vez disso, use <command>make fetch-recursive</command> para também buscar os distfiles para todas as dependências de um port.</para>

	<para>Em casos raros, como quando uma organização tem um repositório local de distfiles, a variável <varname>MASTER_SITES</varname> pode ser usada para substituir os locais de download especificados no <filename>Makefile</filename>. Ao usar, especifique o local alternativo:</para>

	<screen><prompt>#</prompt> <userinput>cd /usr/ports/<replaceable>directory</replaceable></userinput>
<prompt>#</prompt> <userinput>make MASTER_SITE_OVERRIDE= \
<replaceable>ftp://ftp.organization.org/pub/FreeBSD/ports/distfiles/</replaceable> fetch</userinput></screen>

	<para>As variáveis <varname>WRKDIRPREFIX</varname> e <varname>PREFIX</varname> podem substituir os diretórios de trabalho e de destino padrão. Por exemplo:</para>

	<screen><prompt>#</prompt> <userinput>make WRKDIRPREFIX=/usr/home/example/ports install</userinput></screen>

	<para>irá compilar o port em <filename>/usr/home/example/ports</filename> e instalar tudo sob <filename>/usr/local</filename>.</para>

	<screen><prompt>#</prompt> <userinput>make PREFIX=/usr/home/example/local install</userinput></screen>

	<para>irá compilar o port em <filename>/usr/ports</filename> e instalá-lo em <filename>/usr/home/example/local</filename>.  E:</para>

	<screen><prompt>#</prompt> <userinput>make WRKDIRPREFIX=../ports PREFIX=../local install</userinput></screen>

	<para>vai combinar os dois.</para>

	<para>Estes também podem ser definidos como variáveis ambientais. Consulte a página de manual do seu shell para obter instruções sobre como definir uma variável de ambiente.</para>
      </sect3>
    </sect2>

    <sect2 xml:id="ports-removing">
      <title>Removendo Ports Instalados</title>

      <indexterm><primary>ports</primary> <secondary>removing</secondary></indexterm>

      <para>Ports instalados podem ser desinstalados usando <command>pkg delete</command>. Exemplos para usar este comando podem ser encontrados na página de manual <citerefentry><refentrytitle>pkg-delete</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>

      <para>Alternativamente, o <command>make deinstall</command> pode ser executado no diretório do port:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/sysutils/lsof</userinput>
<prompt>#</prompt> <userinput>make deinstall</userinput>
===&gt;  Deinstalling for sysutils/lsof
===&gt;   Deinstalling
Deinstallation has been requested for the following 1 packages:

	lsof-4.88.d,8

The deinstallation will free 229 kB
[1/1] Deleting lsof-4.88.d,8... done</screen>

      <para>Recomenda-se ler as mensagens quando o port for desinstalado. Se o port tiver algum aplicativo que dependa dele, essas informações serão exibidas, mas a desinstalação continuará. Nesses casos, talvez seja melhor reinstalar o aplicativo para evitar dependências quebradas.</para>
    </sect2>

    <sect2 xml:id="ports-upgrading">
      <title>Atualizando os Ports</title>

      <indexterm><primary>ports</primary> <secondary>upgrading</secondary></indexterm>

      <para>Com o tempo, novas versões de software ficam disponíveis na coleção de ports. Esta seção descreve como determinar qual software pode ser atualizado e como executar a atualização.</para>

      <para>Para determinar se versões mais recentes dos ports instalados estão disponíveis, verifique se a versão mais recente da árvore de ports está instalada, usando o comando de atualização descrito em <xref linkend="ports-using-portsnap-method"/> ou <xref linkend="ports-using-subversion-method"/>. No FreeBSD 10 e posterior, ou se o sistema foi convertido para <application>pkg</application>, o seguinte comando listará os ports instalados que estão desatualizadas:</para>

      <screen><prompt>#</prompt> <userinput>pkg version -l "&lt;"</userinput></screen>

      <para>Para o FreeBSD 9.<replaceable>X</replaceable> e menor, o seguinte comando listará os ports instalados que estão desatualizados:</para>

      <screen><prompt>#</prompt> <userinput>pkg_version -l "&lt;"</userinput></screen>

      <important>
	<para>Antes de tentar uma atualização, leia o <filename>/usr/ports/UPDATING</filename> da parte superior do arquivo até a data mais próxima da última vez em que os ports foram atualizados ou o sistema foi instalado. Este arquivo descreve vários problemas e etapas adicionais que os usuários podem encontrar e precisar executar ao atualizar um port, incluindo coisas como alterações de formato de arquivo, alterações nos locais de arquivos de configuração ou incompatibilidades com versões anteriores. Anote quaisquer instruções que correspondam a qualquer um dos ports que precisam de atualização e siga estas instruções ao executar a atualização.</para>
      </important>

      <sect3 xml:id="ports-upgrading-tools">
	<title>Ferramentas para atualizar e gerenciar ports</title>

	<indexterm><primary>ports</primary> <secondary>upgrading-tools</secondary></indexterm>

	<para>A coleção de ports contém vários utilitários para executar a atualização real. Cada um tem seus pontos fortes e fracos.</para>

	<para>Historicamente, a maioria das instalações usava o <application>Portmaster</application> ou o <application>Portupgrade</application>. O <application>Synth</application> é uma alternativa mais recente.</para>

	<note>
	  <para>A escolha da melhor ferramenta para um determinado sistema depende do administrador do sistema. Recomenda-se a prática de fazer backup de seus dados antes de usar qualquer uma dessas ferramentas.</para>
	</note>

      </sect3>

      <sect3 xml:id="portmaster">
	<title>Atualizando Ports Usando o <application>Portmaster</application></title>

	<indexterm><primary>portmaster</primary></indexterm>

	<para>O <package>ports-mgmt/portmaster</package> é um utilitário muito pequeno para atualizar os ports instalados. Ele é projetado para usar as ferramentas instaladas com o sistema base do FreeBSD sem depender de outros ports ou bancos de dados. Para instalar este utilitário como um port:</para>

	<screen><prompt>#</prompt> <userinput>cd /usr/ports/ports-mgmt/portmaster</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>

	<para>O <application>Portmaster</application> define quatro categorias de ports:</para>

	<itemizedlist>
	  <listitem>
	    <para>Port Root: não tem dependências e não é uma dependência de outros ports.</para>
	  </listitem>

	  <listitem>
	    <para>Port Trunk: não tem dependências, mas outros ports dependem dele.</para>
	  </listitem>

	  <listitem>
	    <para>Port Branch: tem dependências e outros ports dependem dele.</para>
	  </listitem>

	  <listitem>
	    <para>Port Leaf: tem dependências, mas nenhum outro port depende dele.</para>
	  </listitem>
	</itemizedlist>

	<para>Para listar essas categorias e procurar atualizações:</para>

	<screen><prompt>#</prompt> <userinput>portmaster -L</userinput>
===&gt;&gt;&gt; Root ports (No dependencies, not depended on)
===&gt;&gt;&gt; ispell-3.2.06_18
===&gt;&gt;&gt; screen-4.0.3
        ===&gt;&gt;&gt; New version available: screen-4.0.3_1
===&gt;&gt;&gt; tcpflow-0.21_1
===&gt;&gt;&gt; 7 root ports
...
===&gt;&gt;&gt; Branch ports (Have dependencies, are depended on)
===&gt;&gt;&gt; apache22-2.2.3
        ===&gt;&gt;&gt; New version available: apache22-2.2.8
...
===&gt;&gt;&gt; Leaf ports (Have dependencies, not depended on)
===&gt;&gt;&gt; automake-1.9.6_2
===&gt;&gt;&gt; bash-3.1.17
        ===&gt;&gt;&gt; New version available: bash-3.2.33
...
===&gt;&gt;&gt; 32 leaf ports

===&gt;&gt;&gt; 137 total installed ports
        ===&gt;&gt;&gt; 83 have new versions available</screen>

	<para>Este comando é usado para atualizar todos os ports desatualizados:</para>

	<screen><prompt>#</prompt> <userinput>portmaster -a</userinput></screen>

	<note>
	  <para>Por padrão, o <application>Portmaster</application> faz um backup do pacote antes de excluir o port existente. Se a instalação da nova versão for bem-sucedida, o <application>Portmaster</application> excluirá o backup. O uso de <option>-b</option> instrui o <application>Portmaster</application> a não excluir automaticamente o backup. Adicionar <option>-i</option> inicia o <application>Portmaster</application> no modo interativo, solicitando a confirmação antes de atualizar cada port. Muitas outras opções estão disponíveis. Leia a página de manual para o <citerefentry vendor="ports"><refentrytitle>portmaster</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter detalhes sobre seu uso.</para>
	</note>

	<para>Se forem encontrados erros durante o processo de atualização, adicione <option>-f</option> para atualizar e recompilar todos os ports:</para>

	<screen><prompt>#</prompt> <userinput>portmaster -af</userinput></screen>

	<para>O <application>Portmaster</application> também pode ser usado para instalar novos ports no sistema, atualizando todas as dependências antes de compilar e instalar o novo port. Para usar essa função, especifique o local do port na coleção de ports:</para>

	<screen><prompt>#</prompt> <userinput>portmaster <replaceable>shells/bash</replaceable></userinput></screen>

	<para>Maiores informações sobre <package>ports-mgmt/portmaster</package> podem ser encontradas no <filename>pkg-descr</filename>.</para>
      </sect3>

      <sect3 xml:id="portupgrade">
	<title>Atualizando Ports Usando o Portupgrade</title>

	<indexterm><primary>portupgrade</primary></indexterm>

	<para>O <package>ports-mgmt/portupgrade</package> é outro utilitário que pode ser usado para atualizar ports. Ele instala um conjunto de aplicativos que podem ser usados para gerenciar ports. No entanto, ele depende do Ruby. Para instalar o port:</para>

	<screen><prompt>#</prompt> <userinput>cd /usr/ports/ports-mgmt/portupgrade</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>

	<para>Antes de executar uma atualização usando esse utilitário, é recomendável verificar a lista de ports instalados usando o <command>pkgdb -F</command> e corrigir todas as inconsistências relatadas.</para>

	<para>Para atualizar todos os ports desatualizados instalados no sistema, use o <command>portupgrade -a</command>. Como alternativa, inclua <option>-i</option> para ser solicitado da confirmação de cada atualização individual:</para>

	<screen><prompt>#</prompt> <userinput>portupgrade -ai</userinput></screen>

	<para>Para atualizar apenas um aplicativo especifico em vez de todos os ports disponíveis, use <command>portupgrade <replaceable>pkgname</replaceable></command>. É muito importante incluir <option>-R</option> para primeiro atualizar todos os ports requeridos pelo aplicativo fornecido:</para>

	<screen><prompt>#</prompt> <userinput>portupgrade -R firefox</userinput></screen>

	<para>Se <option>-P</option> estiver incluído, o <application>Portupgrade</application> procura pacotes disponíveis nos diretórios locais listados em <envar>PKG_PATH</envar>. Se nenhum estiver disponível localmente, ele buscará pacotes de um site remoto. Se os pacotes não puderem ser encontrados localmente ou buscados remotamente, o <application>Portupgrade</application> utilizará os ports. Para evitar completamente o uso do ports, especifique <option>-PP</option>. Este último conjunto de opções diz ao <application>Portupgrade</application> para cancelar se nenhum pacote estiver disponível:</para>

	<screen><prompt>#</prompt> <userinput>portupgrade -PP gnome3</userinput></screen>

	<para>Para obter apenas os distfiles do port, ou pacotes, se <option>-P</option> for especificado, sem compilar ou instalar nada, use <option>-F</option>. Para mais informações sobre todas as opções disponíveis, consulte a página de manual do <command>portupgrade</command>.</para>

	<para>Maiores informações sobre o <package>ports-mgmt/portupgrade</package> podem ser encontradas no <filename>pkg-descr</filename>.</para>
      </sect3>

    </sect2>

    <sect2 xml:id="ports-disk-space">
      <title>Ports e o Espaço em Disco</title>

      <indexterm><primary>ports</primary> <secondary>disk-space</secondary></indexterm>

      <para>A utilização da coleção de ports irá ocupar espaço em disco ao longo do tempo. Depois de compilar e instalar um port, executar <command>make clean</command> dentro do diretório de um port limpará o diretório temporário de <filename>trabalho</filename>. Se o <application>Portmaster</application> for usado para instalar um port, ele removerá automaticamente esse diretório, a menos que <option>-K</option> seja especificado. Se o <application>Portupgrade</application> estiver instalado, este comando removerá todos os diretórios de <filename>trabalho</filename> encontrados na cópia local da coleção de ports:</para>

      <screen><prompt>#</prompt> <userinput>portsclean -C</userinput></screen>

      <para>Além disso, arquivos de distribuição de código-fonte desatualizados se acumulam no <filename>/usr/ports/distfiles</filename> ao longo do tempo. Para usar <application>Portupgrade</application> para excluir todos os distfiles que não são mais referenciados por nenhum port:</para>

      <screen><prompt>#</prompt> <userinput>portsclean -D</userinput></screen>

      <para>O <application>Portupgrade</application> pode remover todos os distfiles não referenciados por qualquer port atualmente instalado no sistema:</para>

      <screen><prompt>#</prompt> <userinput>portsclean -DD</userinput></screen>

      <para>Se o <application>Portmaster</application> estiver instalado, use:</para>

      <screen><prompt>#</prompt> <userinput>portmaster --clean-distfiles</userinput></screen>

      <para>Por padrão, esse comando é interativo e solicita que o usuário confirme se um distfile deve ser excluído.</para>

      <para>Além desses comandos, o <package>ports-mgmt/pkg_cutleaves</package> automatiza a tarefa de remover os ports instalados que não são mais necessários.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="ports-poudriere">
    <title>Compilando Pacotes com o <application>Poudriere</application></title>

    <para>O <application>Poudriere</application> é um utilitário licenciado sob a licença <acronym>BSD</acronym> para criar e testar pacotes do FreeBSD. Ele usa as jails do FreeBSD para configurar ambientes de compilação isolados. Essas jails podem ser usadas para compilar pacotes para versões do FreeBSD que são diferentes do sistema no qual ele está instalado, e também para construir pacotes para o i386 se o host for um sistema amd64. Uma vez que os pacotes são compilados, eles estão em um layout idêntico aos espelhos oficiais. Esses pacotes podem ser usados pelo <citerefentry><refentrytitle>pkg</refentrytitle><manvolnum>8</manvolnum></citerefentry> e por outras ferramentas de gerenciamento de pacotes.</para>

    <para>O <application>Poudriere</application> é instalado usando o pacote ou port <package role="port">ports-mgmt/poudriere</package>. A instalação inclui um arquivo de configuração de exemplo,   <filename>/usr/local/etc/poudriere.conf.sample</filename>. Copie este arquivo para <filename>/usr/local/etc/poudriere.conf</filename>. Edite o arquivo copiado de acordo com a configuração local.</para>

    <para>Embora o <acronym>ZFS</acronym> não seja necessário no sistema que executa o <application>poudriere</application>, o seu uso é benéfico. Quando o <acronym>ZFS</acronym> é usado, o <varname>ZPOOL</varname> deve ser especificado em <filename>/usr/local/etc/poudriere.conf</filename> e o  <varname>FREEBSD_HOST</varname> deve ser definido para um espelho próximo. A definição de <varname>CCACHE_DIR</varname> permite o uso de <package role="port">devel/ccache</package> para armazenar em cache a compilação e reduzir os tempos de compilação para o código compilado com freqüência. Pode ser conveniente colocar os conjuntos de dados do <application>poudriere</application> em uma árvore isolada montada em <filename>/poudriere</filename>. Os valores padrões para as outras variáveis de configuração são adequados.</para>

    <para>O número de núcleos do processador detectados é usado para definir quantas compilações serão executadas em paralelo. Forneça memória virtual suficiente, seja por meio de <acronym>RAM</acronym> ou espaço de swap. Se a memória virtual se esgotar, as jails de compilação serão interrompidas e desativadas, resultando em mensagens de erro estranhas.</para>

    <sect2 xml:id="poudriere-initialization">
      <title>Inicializar Jails e o Port Trees</title>

      <para>Após a configuração, inicialize o <application>poudriere</application> para que ele instale uma jail com a árvore do FreeBSD requerida e uma árvore de ports. Especifique um nome para a jail usando <option>-j</option> e a versão do FreeBSD com <option>-v</option>. Em sistemas que executam o FreeBSD/amd64, a arquitetura pode ser definida com <option>-a</option> para <literal>i386</literal> ou <literal>amd64</literal>. O padrão é a arquitetura mostrada pelo <command>uname</command>.</para>

      <screen><prompt>#</prompt> <userinput>poudriere jail -c -j <replaceable>11amd64</replaceable> -v <replaceable>11.4-RELEASE</replaceable></userinput>
[00:00:00] Creating 11amd64 fs at /poudriere/jails/11amd64... done
[00:00:00] Using pre-distributed MANIFEST for FreeBSD 11.4-RELEASE amd64
[00:00:00] Fetching base for FreeBSD 11.4-RELEASE amd64
/poudriere/jails/11amd64/fromftp/base.txz              125 MB 4110 kBps    31s
[00:00:33] Extracting base... done
[00:00:54] Fetching src for FreeBSD 11.4-RELEASE amd64
/poudriere/jails/11amd64/fromftp/src.txz               154 MB 4178 kBps    38s
[00:01:33] Extracting src... done
[00:02:31] Fetching lib32 for FreeBSD 11.4-RELEASE amd64
/poudriere/jails/11amd64/fromftp/lib32.txz              24 MB 3969 kBps    06s
[00:02:38] Extracting lib32... done
[00:02:42] Cleaning up... done
[00:02:42] Recording filesystem state for clean... done
[00:02:42] Upgrading using ftp
/etc/resolv.conf -&gt; /poudriere/jails/11amd64/etc/resolv.conf
Looking up update.FreeBSD.org mirrors... 3 mirrors found.
Fetching public key from update4.freebsd.org... done.
Fetching metadata signature for 11.4-RELEASE from update4.freebsd.org... done.
Fetching metadata index... done.
Fetching 2 metadata files... done.
Inspecting system... done.
Preparing to download files... done.
Fetching 124 patches.....10....20....30....40....50....60....70....80....90....100....110....120.. done.
Applying patches... done.
Fetching 6 files... done.
The following files will be added as part of updating to
11.4-RELEASE-p1:
/usr/src/contrib/unbound/.github
/usr/src/contrib/unbound/.github/FUNDING.yml
/usr/src/contrib/unbound/contrib/drop2rpz
/usr/src/contrib/unbound/contrib/unbound_portable.service.in
/usr/src/contrib/unbound/services/rpz.c
/usr/src/contrib/unbound/services/rpz.h
/usr/src/lib/libc/tests/gen/spawnp_enoexec.sh
The following files will be updated as part of updating to
11.4-RELEASE-p1:
[…]
Installing updates...Scanning //usr/share/certs/blacklisted for certificates...
Scanning //usr/share/certs/trusted for certificates...
 done.
11.4-RELEASE-p1
[00:04:06] Recording filesystem state for clean... done
[00:04:07] Jail 11amd64 11.4-RELEASE-p1 amd64 is ready to be used</screen>

      <screen><prompt>#</prompt> <userinput>poudriere ports -c -p <replaceable>local</replaceable> -m svn+https</userinput>
[00:00:00] Creating local fs at /poudriere/ports/local... done
[00:00:00] Checking out the ports tree... done</screen>

      <para>Em um único computador, o <application>poudriere</application> pode construir ports com várias configurações, em várias jails e de diferentes árvores de ports. Configurações customizadas para estas combinações são chamadas de <emphasis>sets</emphasis>. Veja a seção CUSTOMIZAÇÃO do <citerefentry vendor="ports"><refentrytitle>poudriere</refentrytitle><manvolnum>8</manvolnum></citerefentry> para detalhes depois que o  <package>ports-mgmt/poudriere</package> ou o <package>ports-mgmt/poudriere-devel</package> estiver  instalado.</para>

      <para>A configuração básica mostrada aqui coloca uma única jail-, port-, e um set específico <filename>make.conf</filename> em <filename>/usr/local/etc/poudriere.d</filename>. O nome do arquivo neste exemplo é criado combinando o nome da jail, o nome do port e o nome do set: <filename><replaceable>11amd64-local-workstation</replaceable>-make.conf</filename>. O sistema <filename>make.conf</filename> e este novo arquivo são combinados em tempo de compilação para criar o <filename>make.conf</filename> usado pela jail de compilação.</para>

      <para>Os pacotes a serem criados são inseridos em <filename><replaceable>11amd64-local-workstation</replaceable>-pkglist</filename>:</para>

      <programlisting>editors/emacs
devel/git
ports-mgmt/pkg
...</programlisting>

      <para>Opções e dependências para os ports especificados são configuradas:</para>

      <screen><prompt>#</prompt> <userinput>poudriere options -j <replaceable>11amd64</replaceable> -p <replaceable>local</replaceable> -z <replaceable>workstation</replaceable> -f <replaceable>11amd64-local-workstation-pkglist</replaceable></userinput></screen>

      <para>Finalmente, os pacotes são compilados e um repositório de pacotes é criado:</para>

      <screen><prompt>#</prompt> <userinput>poudriere bulk -j <replaceable>11amd64</replaceable> -p <replaceable>local</replaceable> -z <replaceable>workstation</replaceable> -f <replaceable>11amd64-local-workstation-pkglist</replaceable></userinput></screen>

      <para>Durante a execução, pressionar <keycombo action="simul"><keycap>Ctrl</keycap><keycap>t</keycap></keycombo> exibe o estado atual da compilação. O <application>Poudriere</application> também cria arquivos em <filename>/poudriere/logs/bulk/<replaceable>jailname</replaceable></filename> que podem ser usados com um servidor da Web para exibir informações de compilação.</para>

      <para>Após a conclusão, os novos pacotes estão agora disponíveis para instalação a partir do repositório <application>poudriere</application>.</para>

      <para>Para obter maiores informações sobre o uso do <application>poudriere</application>, consulte <citerefentry vendor="ports"><refentrytitle>poudriere</refentrytitle><manvolnum>8</manvolnum></citerefentry> e o site principal, <link xlink:href="https://github.com/freebsd/poudriere/wiki"/>.</para>
    </sect2>
    <sect2>
      <title>Configurando Clientes do pkg para usar um repositório de Poudriere</title>

      <para>Embora seja possível usar um repositório personalizado ao lado do repositório oficial, às vezes é útil desativar o repositório oficial. Isso é feito criando um arquivo de configuração que substitui e desativa o arquivo de configuração oficial. Crie o <filename>/usr/local/etc/pkg/repos/FreeBSD.conf</filename> que deverá conter o seguinte:</para>

      <programlisting>FreeBSD: {
	enabled: no
}</programlisting>

      <para>Geralmente é mais fácil disponibilizar um repositório poudriere para as máquinas clientes via HTTP. Configure um servidor web para disponibilizar o diretório de pacotes, por exemplo: <filename>/usr/local/poudriere/data/packages/<replaceable>11amd64</replaceable></filename>, onde <filename><replaceable>11amd64</replaceable></filename> é o nome da compilação.</para>

      <para>Se a URL para o repositório de pacotes for: <literal>http://pkg.example.com/11amd64</literal>, o arquivo de configuração do repositório em <filename>/usr/local/etc/pkg/repos/custom.conf</filename> ficaria assim:</para>

      <programlisting>custom: {
	url: "<replaceable>http://pkg.example.com/11amd64</replaceable>",
	enabled: yes,
}</programlisting>
    </sect2>
  </sect1>

  <sect1 xml:id="ports-nextsteps">
    <title>Considerações pós-instalação</title>

    <para>Independentemente do software ter sido instalado a partir de um pacote binário ou de um port, a maioria dos aplicativos de terceiros requer algum nível de configuração após a instalação. Os seguintes comandos e locais podem ser usados para ajudar a determinar o que foi instalado com o aplicativo.</para>

    <itemizedlist>
      <listitem>
	<para>A maioria dos aplicativos instala pelo menos um arquivo de configuração padrão em <filename>/usr/local/etc</filename>. Nos casos em que um aplicativo possui um grande número de arquivos de configuração, um subdiretório será criado para mantê-los. Geralmente, os arquivos de configuração de exemplo são instalados e terminam com um sufixo, como <filename>.sample</filename>. Os arquivos de configuração devem ser revisados e possivelmente editados para atender às necessidades do sistema. Para editar um arquivo de amostra, primeiro copie-o sem a extensão <filename>.sample</filename>.</para>
      </listitem>

      <listitem>
	<para>As aplicações que fornecem documentação irão instalá-la em <filename>/usr/local/share/doc</filename> e muitos aplicativos também instalam páginas de manual. Esta documentação deve ser consultada antes de continuar.</para>
      </listitem>

      <listitem>
	<para>Alguns aplicativos executam serviços que devem ser adicionados ao <filename>/etc/rc.conf</filename> antes de iniciar o aplicativo. Esses aplicativos geralmente instalam um script de inicialização em <filename>/usr/local/etc/rc.d</filename>. Veja <link linkend="configtuning-starting-services"> Iniciando Serviços </link> para maiores informações.</para>

	<note>
	  <para>Por padrão, os aplicativos não executam o script de inicialização durante a instalação, nem executam o script de parada após a desinstalação ou atualização. Essa decisão é deixada para o administrador do sistema.</para>
	</note>

      </listitem>

      <listitem>
	<para>Os usuários de <citerefentry><refentrytitle>csh</refentrytitle><manvolnum>1</manvolnum></citerefentry> devem executar <command>rehash</command> para reconstruir a lista dos binários conhecidos nos shells <envar>PATH</envar>.</para>
      </listitem>

      <listitem>
	<para>Use <command>pkg info</command> para determinar quais arquivos, páginas man e binários foram instalados com o aplicativo.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="ports-broken">
    <title>Lidando com ports quebrados</title>

    <para>Quando um port não é compilado ou instalado, tente o seguinte:</para>

    <orderedlist>
      <listitem>
	<para>Procure para ver se há uma correção pendente para o port no <link xlink:href="@@URL_RELPREFIX@@/support.html">Banco de Dados do Relatório de Problemas</link>. Nesse caso, implementar a correção proposta pode corrigir o problema.</para>
      </listitem>

      <listitem>
	<para>Peça ajuda ao mantenedor do port. Digite <command>make maintainer</command> no diretório do port ou leia o <filename>Makefile</filename> do port para encontrar o endereço de e-mail do mantenedor. Lembre-se de incluir a linha <literal>$FreeBSD:</literal> do <filename>Makefile</filename> do port e a saída que leva ao erro no e-mail para o mantenedor.</para>

	<note>
	  <para>Alguns ports não são mantidos por um indivíduo, mas sim por um grupo de mantenedores representado por uma <link xlink:href="@@URL_RELPREFIX@@/doc/en_US.ISO8859-1/articles/mailing-list-faq/article.html">lista de discussão</link>. Muitos, mas não todos, esses endereços se parecem com <email role="nolink">freebsd-<replaceable>listname</replaceable>@FreeBSD.org</email>. Por favor, leve isso em consideração ao enviar um email.</para>

	  <para>Em particular, os ports mantidos por <email role="nolink">ports@FreeBSD.org</email> não são mantidos por um indivíduo específico. Em vez disso, quaisquer correções e suporte vêm da comunidade geral que se inscreve nessa lista de discussão. Mais voluntários são sempre necessários!</para>
	</note>

	<para>Se não houver resposta ao email, use o Bugzilla para enviar um relatório de bug usando as instruções em <link xlink:href="@@URL_RELPREFIX@@/doc/en_US.ISO8859-1/articles/problem-reports/article.html"> Escrevendo Relatórios de Problemas do FreeBSD</link>.</para>
      </listitem>

      <listitem>
	<para>Conserte-o! O <link xlink:href="@@URL_RELPREFIX@@/doc/en_US.ISO8859-1/books/porters-handbook/index.html">Porters Handbook</link> inclui informações detalhadas sobre a infra-estrutura da arvore de ports para que você possa corrigir possiveis erros na compilacao de um ports que quebrou ou ocasionou um erro de compilacao ou até mesmo submeta seu próprio projeto!</para>
      </listitem>

      <listitem>
	<para>Instale o pacote em vez do port usando as instruções em <xref linkend="pkgng-intro"/>.</para>
      </listitem>
    </orderedlist>
  </sect1>
</chapter>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<chapter version="5.0" xml:id="x11">
  <!--
  <chapterinfo>
    <authorgroup>
      <author>
	<firstname>Ken</firstname>
	<surname>Tom</surname>
	<contrib>Updated for X.Org's X11 server by </contrib>
      </author>
      <author>
	<firstname>Marc</firstname>
	<surname>Fonvieille</surname>
      </author>
    </authorgroup>
  </chapterinfo>
  -->

  <title>O sistema X Window</title>

  <sect1 xml:id="x11-synopsis">
    <title>Sinopse</title>

    <para>Uma instalação padrão do FreeBSD usando o <application>bsdinstall</application> não irá instalar automaticamente uma interface gráfica para o usuário. Este capítulo descreve como instalar e configurar o <application>Xorg</application>, que fornece o sistema X Window open source usado para fornecer um ambiente gráfico. Em seguida, descreve como encontrar e instalar um ambiente de área de trabalho ou um gerenciador de janelas.</para>

    <note>
      <para>Os usuários que preferem um método de instalação que configure automaticamente o <application>Xorg</application> devem consultar <link xlink:href="https://www.furybsd.org">FuryBSD</link>, <link xlink:href="https://ghostbsd.org">GhostBSD</link> ou <link xlink:href="https://www.midnightbsd.org">MidnightBSD</link>.</para>
    </note>

    <para>Para obter maiores informações sobre o hardware de vídeo suportado pelo <application>Xorg</application>, consulte o web site <link xlink:href="http://www.x.org/">x.org</link>.</para>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>Quais são os vários componentes do Sistema X Window e como eles interoperam.</para>
      </listitem>

      <listitem>
	<para>Como instalar e configurar o <application>Xorg</application>.</para>
      </listitem>

      <listitem>
	<para>Como instalar e configurar vários gerenciadores de janelas e ambientes de desktop.</para>
      </listitem>

      <listitem>
	<para>Como usar fontes <trademark class="registered">TrueType</trademark> no <application>Xorg</application>.</para>
      </listitem>

      <listitem>
	<para>Como configurar seu sistema para usar um sistema de login gráfico (<application>XDM</application>).</para>
      </listitem>
    </itemizedlist>

    <para>Antes de ler este capítulo, você deve:</para>

    <itemizedlist>
      <listitem>
	<para>Saber como instalar softwares adicionais de terceiros, conforme descrito em <xref linkend="ports"/>.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="x-understanding">
    <title>Terminologia</title>

    <para>Embora não seja necessário entender todos os detalhes dos vários componentes do Sistema X Window e como eles interagem, algum conhecimento básico desses componentes pode ser útil.</para>

    <variablelist>
      <varlistentry>
	<term>Servidor X</term>

	<listitem>
	  <para>O X foi projetado desde o início para ser centrado em rede e para adotar um modelo <quote>cliente-servidor</quote>. Neste modelo, o <quote>Servidor X</quote> é executado no computador que possui o teclado, o monitor e o mouse conectados. A responsabilidade do servidor inclui tarefas como gerenciar o monitor, manipular a entrada do teclado e do mouse e manipular a entrada ou saída de outros dispositivos, como um tablet ou um projetor de vídeo. Isso confunde algumas pessoas, porque a terminologia X é exatamente o oposto do que eles esperam. Eles esperam que o <quote>X server</quote> seja a grande máquina poderosa no final das contas, e o <quote>Ciente X</quote> seja a máquina em sua mesa.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Cliente X</term>

	<listitem>
	  <para>Cada aplicativo X, como o <application>XTerm</application> ou o <application>Firefox</application>, é um <quote>cliente</quote>. Um cliente envia mensagens para o servidor, como <quote>Por favor, desenhe uma janela nessas coordenadas</quote>, e o servidor envia de volta mensagens como <quote>O usuário apenas clicou no botão OK</quote>.</para>

	  <para>Em um ambiente doméstico ou de uma pequena empresa, o servidor X e os clientes X geralmente são executados no mesmo computador. Também é possível executar o servidor X em um computador menos potente e executar os aplicativos X em um sistema mais poderoso. Nesse cenário, a comunicação entre o cliente X e o servidor ocorre através da rede.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Gerenciador de janelas</term>

	<listitem>
	  <para>O X não dita como as janelas devem se parecer na tela, como movê-las com o mouse, quais teclas devem ser usadas para mover-se entre as janelas, como devem ficar as barras de título em cada janela, se elas têm ou não botões para fechar nelas e assim por diante. Em vez disso, o X delega essa responsabilidade para um gerenciador de janelas separado. Existem <link xlink:href="http://www.xwinman.org/">dezenas de gerenciadores de janelas</link>  disponíveis. Cada gerenciador de janelas oferece uma aparência diferente: alguns oferecem suporte a desktops virtuais, alguns permitem pressionamentos de tecla personalizados para gerenciar a área de trabalho, alguns têm um botão <quote>Iniciar</quote> e alguns são personalizáveis, permitindo uma alteração completa da aparência da área de trabalho. Os gerenciadores de janelas estão disponíveis na categoria <filename>x11-wm</filename> da coleção de ports.</para>

	  <para>Cada gerenciador de janelas usa um mecanismo de configuração diferente. Alguns esperam que o arquivo de configuração seja escrito à mão, enquanto outros fornecem ferramentas gráficas para a maioria das tarefas de configuração.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Ambiente de desktop</term>

	<listitem>
	  <para>O <application>KDE</application> e o <application>GNOME</application> são considerados ambientes de desktop, pois incluem um conjunto completo de aplicativos para executar tarefas comuns de desktop. Estes podem incluir pacotes de escritório, navegadores da web e jogos.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Política de foco</term>

	<listitem>
	  <para>O gerenciador de janelas é responsável pela política de foco do mouse. Essa política fornece alguns meios para escolher qual janela está recebendo ativamente as teclas digitadas e também deve indicar visivelmente qual janela está ativa no momento.</para>

	  <para>Uma política de foco é chamada <quote>click-to-focus</quote>. Neste modelo, uma janela fica ativa ao receber um clique do mouse. Na política <quote>focus-follows-mouse</quote>, a janela que está sob o ponteiro do mouse tem foco e o foco é alterado apontando para outra janela. Se o mouse estiver sobre a janela raiz, esta janela estará focada. No modelo <quote>sloppy-focus</quote>, se o mouse for movido sobre a janela raiz, a janela usada mais recentemente ainda terá o foco. Com sloppy-focus, o foco só é alterado quando o cursor entra em uma nova janela, e não ao sair da janela atual. Na política de <quote>click-to-focus</quote>, a janela ativa é selecionada pelo clique do mouse. A janela pode então ser destacada para aparecer na frente de todas as outras janelas. Todas as teclas digitadas serão direcionadas para esta janela, mesmo se o cursor for movido para outra janela.</para>

	  <para>Diferentes gerenciadores de janela suportam diferentes modelos de foco. Todos eles suportam click-to-focus, e a maioria deles também suporta outras políticas. Consulte a documentação do gerenciador de janelas para determinar quais modelos de foco estão disponíveis.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Widgets</term>

	<listitem>
	  <para>Widget é um termo para todos os itens na interface do usuário que podem ser clicados ou manipulados de alguma forma. Isso inclui botões, caixas de seleção, botões de opção, ícones e listas. Um kit de ferramentas de widget é um conjunto de widgets usado para criar aplicativos gráficos. Existem vários toolkits de widgets populares, incluindo o Qt, usado pelo <application>KDE</application>, e o GTK+, usado pelo <application>GNOME</application>. Como resultado, os aplicativos terão uma aparência e comportamentos diferentes, dependendo de qual kit de ferramentas de widget foi usado para criar o aplicativo.</para>
	</listitem>
      </varlistentry>
    </variablelist>
  </sect1>

  <sect1 xml:id="x-install">
    <title>Instalando o <application>Xorg</application></title>

    <para>No FreeBSD, o <application>Xorg</application> pode ser instalado como um pacote ou port.</para>

    <para>O pacote binário pode ser instalado rapidamente, mas com menos opções de personalização:</para>

    <screen><prompt>#</prompt> <userinput>pkg install xorg</userinput></screen>

    <para>Para compilar e instalar a partir da Coleção de Ports:</para>

    <screen><prompt>#</prompt> <userinput>cd /usr/ports/x11/xorg</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>

    <para>Qualquer uma dessas instalações resulta no sistema completo do <application>Xorg</application> sendo instalado. Pacotes binários são a melhor opção para a maioria dos usuários.</para>

    <para>Uma versão menor do sistema X adequada para usuários experientes está disponível em <package>x11/xorg-minimal</package>. A maioria dos documentos, bibliotecas e aplicativos não será instalada. Algumas aplicações requerem esses componentes adicionais para funcionarem.</para>
  </sect1>

  <sect1 xml:id="x-config">
    <title>Configuração do <application>Xorg</application></title>

    <info>
      <authorgroup>
      <author><personname> <firstname>Warren</firstname> <surname>Block</surname> </personname> <contrib>Originalmente contribuído por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>Xorg</primary></indexterm>
    <indexterm><primary><application>Xorg</application></primary></indexterm>

    <sect2 xml:id="x-config-quick-start">
      <title>Inicio Rápido</title>

      <para>O <application>Xorg</application> suporta as placas de vídeo, teclados e dispositivos USB mais comuns.</para>

      <tip>
	<para>Placas de vídeo, monitores e dispositivos de entrada são detectados automaticamente e não exigem nenhuma configuração manual. Não crie o <filename>xorg.conf</filename> ou execute o passo <option>-configure</option> a menos que a configuração automática falhe.</para>
      </tip>

      <procedure>
	<step>
	  <para>Se o <application>Xorg</application> tiver sido usado neste computador antes, mova ou remova qualquer arquivo de configuração existente:</para>

	  <screen><prompt>#</prompt> <userinput>mv /etc/X11/xorg.conf ~/xorg.conf.etc</userinput>
<prompt>#</prompt> <userinput>mv /usr/local/etc/X11/xorg.conf ~/xorg.conf.localetc</userinput></screen>
	</step>

	<step>
	  <para>Adicione o usuário que executará o <application>Xorg</application> ao grupo <systemitem class="groupname">video</systemitem> ou <systemitem class="groupname">wheel</systemitem> para ativar a aceleração 3D quando disponível. Para adicionar o usuário <replaceable>jru</replaceable> ao grupo que estiver disponível:</para>

	  <screen><prompt>#</prompt> <userinput>pw groupmod video -m <replaceable>jru</replaceable> || pw groupmod wheel -m <replaceable>jru</replaceable></userinput></screen>
	</step>

	<step>
	  <para>O gerenciador de janelas <acronym>twm</acronym> é incluído por padrão.  Ele é chamado quando o <application>Xorg</application> se inicia:</para>

	  <screen><prompt>%</prompt> <userinput>startx</userinput></screen>
	</step>

	<step>
	  <para>Em algumas versões mais antigas do FreeBSD, o console do sistema deve ser definido como <citerefentry><refentrytitle>vt</refentrytitle><manvolnum>4</manvolnum></citerefentry> antes que a volta para o console de texto funcione corretamente. Veja <xref linkend="x-config-kms"/>.</para>
	</step>
      </procedure>
    </sect2>

    <sect2 xml:id="x-config-user-group">
      <title>Grupo de Usuários para Vídeo Acelerado</title>

      <para>O acesso ao <filename>/dev/dri</filename> é necessário para permitir a aceleração 3D nas placas de vídeo. Geralmente é mais simples adicionar o usuário que estará executando o X no grupo <systemitem class="groupname">video</systemitem> ou no <systemitem class="groupname">wheel</systemitem>. Aqui, o <citerefentry> <refentrytitle>pw</refentrytitle><manvolnum>8</manvolnum> </citerefentry> é usado para adicionar o usuário <replaceable>slurms</replaceable> ao grupo <systemitem class="groupname">video</systemitem>, ou ao grupo <systemitem class="groupname">wheel</systemitem> se não houver nenhum grupo <systemitem class="groupname">video</systemitem>:</para>

      <screen><prompt>#</prompt> <userinput>pw groupmod video -m <replaceable>slurms</replaceable> || pw groupmod wheel -m <replaceable>slurms</replaceable></userinput></screen>
    </sect2>

    <sect2 xml:id="x-config-kms">
      <title>Configuração do Modo Kernel (<acronym>KMS</acronym>)</title>

      <para>Quando o computador alterna a exibição do console para uma resolução de tela mais alta para o X, ele deve definir o  <emphasis>modo</emphasis> da saída de vídeo. Versões recentes do <acronym>Xorg</acronym> usam um sistema dentro do kernel para fazer essas mudanças de modo mais eficiente. Versões mais antigas do FreeBSD usam o <citerefentry><refentrytitle>sc</refentrytitle> <manvolnum>4</manvolnum></citerefentry>, que não tem conhecimento do sistema <acronym>KMS</acronym>. O resultado final é que depois de fechar o X, o console do sistema fica em branco, embora ainda esteja funcionando. O console <citerefentry><refentrytitle>vt</refentrytitle> <manvolnum>4</manvolnum> </citerefentry> mais recente evita esse problema.</para>

      <para>Adicione esta linha ao <filename>/boot/loader.conf</filename> para ativar o <citerefentry><refentrytitle>vt</refentrytitle> <manvolnum>4</manvolnum></citerefentry>:</para>

      <programlisting>kern.vty=vt</programlisting>
    </sect2>

    <sect2 xml:id="x-config-files">
      <title>Arquivos de Configuração</title>

      <para>A configuração manual geralmente não é necessária. Por favor, não crie manualmente arquivos de configuração, a menos que a autoconfiguração não funcione.</para>

      <sect3 xml:id="x-config-files-directory">
	<title>Diretório</title>

	<para>O <application>Xorg</application> procura em vários diretórios por arquivos de configuração. O <filename>/usr/local/etc/X11/</filename> é o diretório recomendado para esses arquivos no FreeBSD. Usar esse diretório ajuda a manter os arquivos dos aplicativos separados dos arquivos do sistema operacional.</para>

	<para>Armazenar arquivos de configuração no diretório legado <filename>/etc/X11/</filename> ainda funciona. No entanto, isso combina arquivos de aplicativos com os arquivos básicos do FreeBSD e não é recomendado.</para>
      </sect3>

      <sect3 xml:id="x-config-files-single-or-multi">
	<title>Arquivos Únicos ou Múltiplos</title>

	<para>É mais fácil usar multiplos arquivos em que cada um controla uma configuração específica ao invés do único e tradicional <filename>xorg.conf</filename>. Esses arquivos são armazenados no subdiretório <filename>xorg.conf.d/</filename> do diretório principal do arquivo de configuração. O caminho completo é tipicamente <filename>/usr/local/etc/X11/xorg.conf.d/</filename>.</para>

	<para>Exemplos desses arquivos serão mostrados posteriormente nesta seção.</para>

	<para>O tradicional e único arquivo <filename>xorg.conf</filename> ainda funciona, mas não é tão claro e nem tão flexível quanto vários arquivos no subdiretório <filename>xorg.conf.d/</filename>.</para>
      </sect3>
    </sect2>

    <sect2 xml:id="x-config-video-cards">
      <title>Placas de Vídeo</title>

      <para>Devido as mudanças feitas nas versões recentes do FreeBSD, agora é possível usar drivers gráficos fornecidos pelo Framework do Ports, assim como pelos pacotes. Assim sendo, os usuários podem usar um dos seguintes drivers disponíveis em <package>graphics/drm-kmod</package>.</para>

      <variablelist>
	<varlistentry xml:id="x-config-video-cards-ports">
	  <term>Intel KMS driver</term>
	  <term>Radeon KMS driver</term>
	  <term>AMD KMS driver</term>

	  <listitem>
	    <para>A aceleração 2D e 3D é suportada na maioria das placas gráficas do driver Intel KMS fornecidas pela <trademark class="registered">Intel</trademark>.</para>

	    <para>Nome do driver: <literal>i915kms</literal></para>

	    <para>A aceleração 2D e 3D é suportada na maioria das placas gráficas de driver Radeon KMS mais antigas fornecidas pela <trademark class="registered">AMD</trademark>.</para>

	    <para>Nome do Driver: <literal>radeonkms</literal></para>

	    <para>A aceleração 2D e 3D é suportada nas mais recentes placas gráficas do driver AMD KMS fornecidas pela <trademark class="registered">AMD</trademark>.</para>

	    <para>Nome do Driver: <literal>amdgpu</literal></para>

	    <para>Para referência, veja <link xlink:href="https://en.wikipedia.org/wiki/List_of_Intel_graphics_processing_units"/> ou <link xlink:href="https://en.wikipedia.org/wiki/List_of_AMD_graphics_processing_units"/> para uma lista das GPUs suportadas.</para>
	  </listitem>
	</varlistentry>

	<varlistentry xml:id="x-config-video-cards-intel">
	  <term><trademark class="registered">Intel</trademark></term>

	  <listitem>
	    <para>A aceleração 3D é suportada na maioria dos chipsets gráficos da <trademark class="registered">Intel</trademark> até o Ivy Bridge (HD Graphics 2500, 4000 e P4000), incluindo Iron Lake (HD Graphics) e Sandy Bridge (HD Graphics 2000) .</para>

	    <para>Nome do driver: <literal>intel</literal></para>

	    <para>Para referência, veja <link xlink:href="https://en.wikipedia.org/wiki/List_of_Intel_graphics_processing_units"/>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry xml:id="x-config-video-cards-radeon">
	  <term><trademark class="registered">AMD</trademark> Radeon</term>

	  <listitem>
	    <para>Aceleração 2D e 3D é suportada em placas Radeon das mais antigas até a série HD6000.</para>

	    <para>Nome do Driver: <literal>radeon</literal></para>

	    <para>Para referência, veja <link xlink:href="https://en.wikipedia.org/wiki/List_of_AMD_graphics_processing_units"/>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry xml:id="x-config-video-cards-nvidia">
	  <term>NVIDIA</term>

	  <listitem>
	    <para>Vários drivers da NVIDIA estão disponíveis na categoria <filename>x11</filename> da Coleção de Ports. Instale o driver que corresponde à sua placa de vídeo.</para>

	    <para>Para referência, veja <link xlink:href="https://en.wikipedia.org/wiki/List_of_Nvidia_graphics_processing_units"/>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry xml:id="x-config-video-cards-hybrid">
	  <term>Gráficos Híbridos de Combinação</term>

	  <listitem>
	    <para>Alguns notebooks adicionam unidades de processamento gráfico adicionais àquelas incorporadas ao chipset ou ao processador. O <emphasis>Optimus</emphasis> combina o hardware da <trademark class="registered">Intel</trademark> e da NVIDIA. O <emphasis>Switchable Graphics</emphasis> ou <emphasis>Hybrid Graphics</emphasis> são uma combinação dos processadores <trademark class="registered">Intel</trademark> ou <trademark class="registered">AMD</trademark> e uma <acronym>GPU</acronym> <trademark class="registered">AMD</trademark> Radeon.</para>

	    <para>As implementações desses sistemas gráficos híbridos variam e o <application>Xorg</application> no FreeBSD não é capaz de controlar todas as versões deles.</para>

	    <para>Alguns computadores fornecem uma opção no <acronym>BIOS</acronym> para desativar um dos adaptadores gráficos ou selecionar um modo <emphasis>discreto</emphasis> que pode ser usado com um dos drivers de placa de vídeo padrão. Por exemplo, às vezes é possível desativar a <acronym>GPU</acronym> NVIDIA em um sistema Optimus. O vídeo <trademark class="registered">Intel</trademark> pode então ser usado com um driver <trademark class="registered">Intel</trademark>.</para>

	    <para>Configurações de <acronym>BIOS</acronym> dependem do modelo do computador. Em algumas situações, ambas <acronym>GPU</acronym>s  podem ser deixadas ativadas, mas criar um arquivo de configuração que use apenas a <acronym>GPU</acronym> principal na seção <literal>Device</literal> é o suficiente para tornar esse sistema funcional.</para>
	  </listitem>
	</varlistentry>

	<varlistentry xml:id="x-config-video-cards-other">
	  <term>Outras placas de vídeo</term>

	  <listitem>
	    <para>Drivers para algumas placas de vídeo menos comuns podem ser encontrados no diretório <filename>x11-drivers</filename> da Coleção de Ports.</para>

	    <para>PLacas que não são suportadas por um driver específico ainda podem ser usadas com o driver <package>x11-drivers/xf86-video-vesa</package>. Este driver é instalado pelo <package>x11/xorg</package>. Ele também pode ser instalado manualmente como <package>x11-drivers/xf86-video-vesa</package>. O <application>Xorg</application> tenta usar este driver quando um driver específico não é encontrado para a placa de vídeo.</para>

	    <para>O <package>x11-drivers/xf86-video-scfb</package> é um driver de vídeo não especializado similar que funciona em muitos computadores <acronym>UEFI</acronym> e <trademark class="registered">ARM</trademark>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry xml:id="x-config-video-cards-file">
	  <term>Configurando o driver de vídeo em um arquivo</term>

	  <listitem>
	    <para>Para definir o driver <trademark class="registered">Intel</trademark> em um arquivo de configuração:</para>

	    <example xml:id="x-config-video-cards-file-intel">
	      <title>Selecione o driver de vídeo <trademark class="registered">Intel</trademark> em um arquivo</title>

	      <para><filename>/usr/local/etc/X11/xorg.conf.d/driver-intel.conf</filename></para>

	      <programlisting>Section "Device"
	Identifier "Card0"
	Driver     "intel"
	# BusID    "PCI:1:0:0"
EndSection</programlisting>

	      <para>Se mais de uma placa de vídeo estiver presente, o identificador <literal>BusID</literal> pode ser descomentado e configurado para selecionar a placa desejada. Uma lista de barramento de placa de vídeo <acronym>ID</acronym> pode ser exibida com <command>pciconf -lv | grep -B3 display</command>.</para>
	    </example>

	    <para>Para definir o driver Radeon em um arquivo de configuração:</para>

	    <example xml:id="x-config-video-cards-file-radeon">
	      <title>Selecione o driver de vídeo Radeon em um arquivo</title>

	      <para><filename>/usr/local/etc/X11/xorg.conf.d/driver-radeon.conf</filename></para>

	      <programlisting>Section "Device"
	Identifier "Card0"
	Driver     "radeon"
EndSection</programlisting>
	    </example>

	    <para>Para definir o driver <acronym>VESA</acronym> em um arquivo de configuração:</para>

	    <example xml:id="x-config-video-cards-file-vesa">
	      <title>Selecione o driver de vídeo <acronym>VESA</acronym> em um arquivo</title>

	      <para><filename>/usr/local/etc/X11/xorg.conf.d/driver-vesa.conf</filename></para>

	      <programlisting>Section "Device"
	Identifier "Card0"
	Driver     "vesa"
EndSection</programlisting>
	    </example>

	    <para>Para definir o driver <literal>scfb</literal> para uso com um computador <acronym>UEFI</acronym> ou <trademark class="registered">ARM</trademark>:</para>

	    <example xml:id="x-config-video-cards-file-scfb">
	      <title>Selecione o driver de vídeo <literal>scfb</literal> em um arquivo</title>

	      <para><filename>/usr/local/etc/X11/xorg.conf.d/driver-scfb.conf</filename></para>

	      <programlisting>Section "Device"
	Identifier "Card0"
	Driver     "scfb"
EndSection</programlisting>
	    </example>
	  </listitem>
	</varlistentry>
      </variablelist>
    </sect2>

    <sect2 xml:id="x-config-monitors">
      <title>Monitores</title>

      <para>Quase todos os monitores suportam o padrão Extended Display Identification Data (<acronym>EDID</acronym>). O <application>Xorg</application> usa o <acronym>EDID</acronym> para se comunicar com o monitor e detectar as resoluções e taxas de atualização suportadas. Em seguida, seleciona a combinação mais adequada de configurações para usar com esse monitor.</para>

      <para>Outras resoluções suportadas pelo monitor podem ser escolhidas definindo a resolução desejada nos arquivos de configuração, ou após o servidor X ter sido iniciado com <citerefentry vendor="xfree86"> <refentrytitle>xrandr</refentrytitle><manvolnum>1</manvolnum> </citerefentry>.</para>

      <variablelist>
	<varlistentry xml:id="x-config-monitors-xrandr">
	  <term>Usando <citerefentry vendor="xfree86"> <refentrytitle>xrandr</refentrytitle><manvolnum>1</manvolnum></citerefentry></term>

	  <listitem>
	    <para>Execute o <citerefentry vendor="xfree86"><refentrytitle>xrandr</refentrytitle><manvolnum>1</manvolnum> </citerefentry> sem nenhum parâmetro para ver uma lista de saídas de vídeo e modos de monitor detectados:</para>

	    <screen><prompt>%</prompt> <userinput>xrandr</userinput>
Screen 0: minimum 320 x 200, current 3000 x 1920, maximum 8192 x 8192
DVI-0 connected primary 1920x1200+1080+0 (normal left inverted right x axis y axis) 495mm x 310mm
   1920x1200     59.95*+
   1600x1200     60.00
   1280x1024     85.02    75.02    60.02
   1280x960      60.00
   1152x864      75.00
   1024x768      85.00    75.08    70.07    60.00
   832x624       74.55
   800x600       75.00    60.32
   640x480       75.00    60.00
   720x400       70.08
DisplayPort-0 disconnected (normal left inverted right x axis y axis)
HDMI-0 disconnected (normal left inverted right x axis y axis)</screen>

	    <para>Isso mostra que a saída <literal>DVI-0</literal> está sendo usada para exibir uma resolução de tela de 1920x1200 pixels a uma taxa de atualização de cerca de 60 Hz. Os monitores não estão conectados aos conectores <literal>DisplayPort-0</literal> e <literal>HDMI-0</literal>.</para>

	    <para>Qualquer um dos outros modos de exibição pode ser selecionado com <citerefentry vendor="xfree86"><refentrytitle>xrandr</refentrytitle> <manvolnum>1</manvolnum></citerefentry>. Por exemplo, para mudar para 1280x1024 a 60 Hz:</para>

	    <screen><prompt>%</prompt> <userinput>xrandr --mode 1280x1024 --rate 60</userinput></screen>

	    <para>Uma tarefa comum é usar a saída de vídeo externa em um notebook para um projetor de vídeo.</para>

	    <para>O tipo e a quantidade de conectores de saída variam entre os dispositivos, e o nome dado a cada saída varia de driver para driver. O que um driver chama de <literal>HDMI-1</literal>, outro pode chamar de <literal>HDMI1</literal>. Portanto, o primeiro passo é executar <citerefentry vendor="xfree86"><refentrytitle>xrandr</refentrytitle><manvolnum>1</manvolnum></citerefentry> para listar todas as saídas disponíveis:</para>

	    <screen><prompt>%</prompt> <userinput>xrandr</userinput>
Screen 0: minimum 320 x 200, current 1366 x 768, maximum 8192 x 8192
LVDS1 connected 1366x768+0+0 (normal left inverted right x axis y axis) 344mm x 193mm
   1366x768      60.04*+
   1024x768      60.00
   800x600       60.32    56.25
   640x480       59.94
VGA1 connected (normal left inverted right x axis y axis)
   1280x1024     60.02 +  75.02
   1280x960      60.00
   1152x864      75.00
   1024x768      75.08    70.07    60.00
   832x624       74.55
   800x600       72.19    75.00    60.32    56.25
   640x480       75.00    72.81    66.67    60.00
   720x400       70.08
HDMI1 disconnected (normal left inverted right x axis y axis)
DP1 disconnected (normal left inverted right x axis y axis)</screen>

	    <para>Quatro saídas foram encontradas: os conectores <literal>LVDS1</literal> e <literal>VGA1</literal>, <literal>HDMI1</literal> e <literal>DP1</literal> do painel interno.</para>

	    <para>O projetor foi conectado à saída <literal>VGA1</literal>. O <citerefentry vendor="xfree86"> <refentrytitle>xrandr</refentrytitle><manvolnum>1</manvolnum></citerefentry> agora é usado para definir essa saída para a resolução nativa do projetor e adicionar o espaço adicional à direita da área de trabalho:</para>

	    <screen><prompt>%</prompt> <userinput>xrandr --output VGA1 --auto --right-of LVDS1</userinput></screen>

	    <para>A opção <literal>--auto</literal> escolhe a resolução e a taxa de atualização detectadas pelo <acronym>EDID</acronym>. Se a resolução não for detectada corretamente, um valor fixo pode ser fornecido com <literal>--mode</literal> em vez da instrução <literal>--auto</literal>. Por exemplo, a maioria dos projetores pode ser usada com uma resolução de 1024x768, que é definida com <literal>--mode 1024x768</literal>.</para>

	    <para>O <citerefentry vendor="xfree86"><refentrytitle>xrandr</refentrytitle><manvolnum>1</manvolnum></citerefentry> geralmente é executado a partir do <filename>.xinitrc</filename> para definir o modo apropriado quando o X é iniciado.</para>
	  </listitem>
	</varlistentry>

	<varlistentry xml:id="x-config-monitors-files">
	  <term>Configurando a resolução do monitor em um arquivo</term>

	  <listitem>
	    <para>Para definir uma resolução de tela de 1024x768 em um arquivo de configuração:</para>

	    <example>
	      <title>Defina a resolução de tela em um arquivo</title>

	      <para><filename>/usr/local/etc/X11/xorg.conf.d/screen-resolution.conf</filename></para>

	      <programlisting>Section "Screen"
	Identifier "Screen0"
	Device     "Card0"
	SubSection "Display"
	Modes      "1024x768"
	EndSubSection
EndSection</programlisting>
	    </example>

	    <para>Os poucos monitores que não possuem <acronym>EDID</acronym> podem ser configurados setando o <literal>HorizSync</literal> e o <literal>VertRefresh</literal> para o intervalo de frequências suportado pelo monitor.</para>

	    <example>
	      <title>Configurando Manualmente as Frequências do Monitor</title>

	      <para><filename>/usr/local/etc/X11/xorg.conf.d/monitor0-freq.conf</filename></para>

	      <programlisting>Section "Monitor"
	Identifier   "Monitor0"
	HorizSync    30-83   # kHz
	VertRefresh  50-76   # Hz
EndSection</programlisting>
	    </example>
	  </listitem>
	</varlistentry>
      </variablelist>
    </sect2>

    <sect2 xml:id="x-config-input">
      <title>Dispositivos de Entrada</title>

      <sect3 xml:id="x-config-input-keyboard">
	<title>Teclados</title>

	<variablelist>
	  <varlistentry xml:id="x-config-input-keyboard-layout">
	    <term>Layout do Teclado</term>

	    <listitem>
	      <para>A localização padronizada das teclas em um teclado é chamada de <emphasis>layout</emphasis>. Layouts e outros parâmetros ajustáveis são listados em <citerefentry vendor="xfree86"><refentrytitle>xkeyboard-config</refentrytitle> <manvolnum>7</manvolnum></citerefentry>.</para>

	      <para>Um layout dos Estados Unidos é o padrão. Para selecionar um layout alternativo, defina as opções <literal>XkbLayout</literal> e <literal>XkbVariant</literal> em um <literal>InputClass</literal>. Isso será aplicado a todos os dispositivos de entrada que correspondam à classe.</para>

	      <para>Este exemplo seleciona um layout de teclado Francês.</para>

	      <example>
		<title>Definindo um layout de teclado</title>

		<para><filename>/usr/local/etc/X11/xorg.conf.d/keyboard-fr.conf</filename></para>

		<programlisting>Section	"InputClass"
	Identifier	"KeyboardDefaults"
	MatchIsKeyboard	"on"
	Option		"XkbLayout" "fr"
EndSection</programlisting>
	      </example>

	      <example>
		<title>Definindo vários layouts de teclado</title>

		<para>Define os layouts de teclado para Estados Unidos, Espanhol e Ucraniano. Alterne entre esses layouts pressionando <keycombo action="simul"><keycap>Alt</keycap> <keycap>Shift</keycap> </keycombo>. O <package>x11/xxkb</package> ou <package>x11/sbxkb</package> pode ser usado para um melhor controle da  mudança de layout e dos indicadores do layout atual.</para>

		<para><filename>/usr/local/etc/X11/xorg.conf.d/kbd-layout-multi.conf</filename></para>

		<programlisting>Section	"InputClass"
	Identifier	"All Keyboards"
	MatchIsKeyboard	"yes"
	Option		"XkbLayout" "us, es, ua"
EndSection</programlisting>
	      </example>
	    </listitem>
	  </varlistentry>

	  <varlistentry xml:id="x-config-input-keyboard-zap">
	    <term>Fechando o <application>Xorg</application> pelo teclado</term>

	    <listitem>
	      <para>X pode ser fechado com uma combinação de teclas. Por padrão, essa combinação de teclas não está definida porque entra em conflito com os comandos do teclado para alguns aplicativos. Ativar essa opção requer alterações na seção <literal>InputDevice</literal> do teclado:</para>

	      <example>
		<title>Ativando o fechamento de X pelo teclado</title>

		<para><filename>/usr/local/etc/X11/xorg.conf.d/keyboard-zap.conf</filename></para>

		<programlisting>Section	"InputClass"
	Identifier	"KeyboardDefaults"
	MatchIsKeyboard	"on"
	Option		"XkbOptions" "terminate:ctrl_alt_bksp"
EndSection</programlisting>
	      </example>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </sect3>

      <sect3 xml:id="x11-input-mice">
	<title>Mouse e Dispositivos Similares</title>

	<important>
	  <para>Se ao usar <package>xorg-server</package> 1.20.8 ou maior no FreeBSD 12.1 e não usar <citerefentry><refentrytitle>moused</refentrytitle><manvolnum>8</manvolnum></citerefentry>, adicione <userinput>kern.evdev.rcpt_mask=12</userinput> ao arquivo <filename>/etc/sysctl.conf</filename>:</para>
	</important>

	<para>Muitos parâmetros do mouse podem ser ajustados com opções de configuração. Veja <citerefentry vendor="xorg"><refentrytitle>mousedrv</refentrytitle><manvolnum>4</manvolnum></citerefentry> para obter uma lista completa.</para>

	<variablelist>
	  <varlistentry xml:id="x11-input-mice-buttons">
	    <term>Botões do Mouse</term>

	    <listitem>
	      <para>O número de botões em um mouse pode ser definido na seção <literal>InputDevice</literal> do <filename>xorg.conf</filename>. Para definir o número de botões para 7:</para>

	      <example>
		<title>Definindo o número de botões do mouse</title>

		<para><filename>/usr/local/etc/X11/xorg.conf.d/mouse0-buttons.conf</filename></para>

		<programlisting>Section "InputDevice"
	Identifier  "Mouse0"
	Option      "Buttons" "7"
EndSection</programlisting>
	      </example>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </sect3>
    </sect2>

    <sect2 xml:id="x-config-manual-configuration">
      <title>Configuração manual</title>

      <para>Em alguns casos, a autoconfiguração do <application>Xorg</application> não funciona com alguns hardwares específicos, ou uma configuração diferente é desejada. Para esses casos, um arquivo de configuração personalizado pode ser criado.</para>

      <warning>
	<para>Não crie arquivos de configuração manualmente, a menos que seja necessário. A configuração manual desnecessária pode impedir o funcionamento adequado.</para>
      </warning>

      <para>Um arquivo de configuração pode ser gerado pelo <application>Xorg</application> baseado no hardware detectado. Esse arquivo geralmente é um ponto de partida útil para configurações personalizadas.</para>

      <para>Gerando um arquivo <filename>xorg.conf</filename>:</para>

      <screen><prompt>#</prompt> <userinput>Xorg -configure</userinput></screen>

      <para>O arquivo de configuração é salvo em <filename>/root/xorg.conf.new</filename>. Faça as alterações desejadas e teste esse arquivo(usando <option>-retro</option> assim será exibido um fundo visível) com:</para>

      <screen><prompt>#</prompt> <userinput>Xorg -retro -config /root/xorg.conf.new</userinput></screen>

      <para>Após a nova configuração ter sido ajustada e testada, ela pode ser dividida em arquivos menores no diretorio, <filename>/usr/local/etc/X11/xorg.conf.d/</filename>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="x-fonts">
    <!--
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Murray</firstname>
	  <surname>Stokely</surname>
	  <contrib>Contributed by </contrib>
	</author>
      </authorgroup>
    </sect1info>
    -->
    <title>Usando fontes no <application>Xorg</application></title>

    <sect2 xml:id="type1">
      <title>Fontes Type1</title>

      <para>As fontes padrões que vem com o <application>Xorg</application> não são adequadas para muitas aplicações desktop. As fontes grandes aparecem irregulares e com aparência não profissional, e as fontes pequenas são quase ilegíveis. Contudo existem muitas fontes Type1 (<trademark class="registered">PostScript</trademark>) gratuitas de alta qualidade prontas para uso no <application>Xorg</application>. Por exemplo, a coleção de fontes URW (<package>x11-fonts/urwfonts</package>) inclui versões de alta qualidade de fontes type1 padrão (<trademark class="registered">Times Roman</trademark>, <trademark class="registered">Helvetica</trademark>, <trademark class="registered">Palatino</trademark> e outras). A coleção Freefonts (<package>x11-fonts/freefonts</package>) inclui muito mais fontes, mas a maioria delas direcionadas para uso em softwares gráficos como o <application>Gimp</application>, e não são tão completas para servir como fontes de tela. Além disso, o <application>Xorg</application> pode ser configurado para usar fontes <trademark class="registered">TrueType</trademark> com um minimo esforço. Para maiores detalhes sobre isso veja a página de manual do <citerefentry vendor="xfree86"><refentrytitle>X</refentrytitle><manvolnum>7</manvolnum></citerefentry> ou <xref linkend="truetype"/>.</para>

      <para>Para instalar as coleções de fontes Type1 usando pacotes binários, execute os seguintes comandos:</para>

      <screen><prompt>#</prompt> <userinput>pkg install urwfonts</userinput></screen>

      <para>Como alternativa, para compilar a partir da coleção de Ports, execute os seguintes comandos:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/x11-fonts/urwfonts</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>

      <para>Proceda da mesma forma com a freefont ou outras coleções. Para que o servidor X detecte essas fontes, adicione uma linha apropriada ao arquivo de configuração do servidor X (<filename>/etc/X11/xorg.conf</filename>):</para>

      <programlisting>FontPath "/usr/local/share/fonts/urwfonts/"</programlisting>

      <para>Alternativamente, na linha de comando de execução da sessão X:</para>

      <screen><prompt>%</prompt> <userinput>xset fp+ /usr/local/share/fonts/urwfonts</userinput>
<prompt>%</prompt> <userinput>xset fp rehash</userinput></screen>

      <para>Isso funcionará, mas será perdido quando a sessão X for fechada, a menos que seja adicionada ao arquivo de inicialização (<filename>~/.xinitrc</filename> para uma sessão <command>startx</command> normal ou <filename>~/.xsession</filename> ao efetuar login através de um gerenciador de login gráfico como o <application>XDM</application>). Uma terceira forma é usar o novo <filename>/usr/local/etc/fonts/local.conf</filename>, como demonstrado em <xref linkend="antialias"/>.</para>
    </sect2>

    <sect2 xml:id="truetype">
      <title>Fontes <trademark class="registered">TrueType</trademark></title>

      <indexterm><primary>TrueType Fonts</primary></indexterm>
      <indexterm><primary>fonts</primary> <secondary>TrueType</secondary></indexterm>

      <para>O <application>Xorg</application> tem suporte nativo para renderizar fontes <trademark class="registered">TrueType</trademark>. Existem dois módulos diferentes que podem ativar essa funcionalidade. O módulo freetype é usado neste exemplo porque é mais consistente com os outros backends de renderização de fonte. Para habilitar o módulo freetype, basta adicionar a seguinte linha à seção <literal>"Module"</literal> do <filename>/etc/X11/xorg.conf</filename>.</para>

      <programlisting>Load  "freetype"</programlisting>

      <para>Agora crie um diretório para as fontes <trademark class="registered">TrueType</trademark> (por exemplo, <filename>/usr/local/share/fonts/TrueType</filename>) e copie todas as fontes <trademark class="registered">TrueType</trademark> para este diretório. Tenha em mente que as fontes <trademark class="registered">TrueType</trademark> não podem ser obtidas diretamente de um <trademark class="registered">Apple</trademark> <trademark class="registered">Mac</trademark>; elas devem estar no formato <trademark class="registered">UNIX</trademark>/<trademark class="registered">MS-DOS</trademark>/<trademark class="registered">Windows</trademark> para uso pelo <application>Xorg</application>. Uma vez que os arquivos foram copiados para este diretório, use <application>mkfontdir</application> para criar um <filename>fonts.dir</filename>, para que o renderizador de fontes do X saiba que esses novos arquivos foram instalados. O <command>mkfontdir</command> pode ser instalado como um pacote binário com o comando:</para>

      <screen><prompt>#</prompt> <userinput>pkg install mkfontdir</userinput></screen>

      <para>Em seguida, crie um índice de arquivos de fontes X em um diretório:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/local/share/fonts/TrueType</userinput>
<prompt>#</prompt> <userinput>mkfontdir</userinput></screen>

      <para>Agora adicione o diretório <trademark class="registered">TrueType</trademark> ao caminho da fonte. Isso é exatamente o mesmo descrito em <xref linkend="type1"/>:</para>

      <screen><prompt>%</prompt> <userinput>xset fp+ /usr/local/share/fonts/TrueType</userinput>
<prompt>%</prompt> <userinput>xset fp rehash</userinput></screen>

      <para>ou adicione uma linha de <literal>FontPath</literal> ao <filename>xorg.conf</filename>.</para>

      <para xml:lang="en">Now <application>Gimp</application>,
	<application>LibreOffice</application>, and all of the
	other X applications should now recognize the installed
	<trademark class="registered">TrueType</trademark> fonts.  Extremely small fonts (as with text in a
	high resolution display on a web page) and extremely large
	fonts (within <application>LibreOffice</application>) will
	look much better now.</para>
    </sect2>

    <sect2 xml:id="antialias">
      <!--
      <sect2info>
	<authorgroup>
	  <author>
	    <firstname>Joe Marcus</firstname>
	    <surname>Clarke</surname>
	    <contrib>Updated in May 2003 by</contrib>
	  </author>
	</authorgroup>
      </sect2info>
      -->
      <title>Fontes com Anti-Alias</title>

      <indexterm><primary>anti-aliased fonts</primary></indexterm>
      <indexterm><primary>fonts</primary> <secondary>anti-aliased</secondary></indexterm>

      <para>Todas as fontes do <application>Xorg</application> que são encontradas em <filename>/usr/local/share/fonts/</filename> e <filename>~/.fonts/</filename> são automaticamente disponibilizadas para anti-aliasing para aplicativos compatíveis com Xft-aware. Os aplicativos mais recentes são compatíveis com o Xft-aware, incluindo o <application>KDE</application>, o <application>GNOME</application> e o <application>Firefox</application>.</para>

      <para>Para controlar quais fontes são anti-aliased, ou para configurar as propriedades do anti-alias, crie (ou edite, se já existir) o arquivo <filename>/usr/local/etc/fonts/local.conf</filename>. Vários recursos avançados do sistema de fontes Xft podem ser ajustados usando este arquivo; Esta seção descreve apenas algumas possibilidades simples. Para maiores detalhes, por favor veja <citerefentry vendor="xorg"><refentrytitle>fonts-conf</refentrytitle> <manvolnum>5</manvolnum></citerefentry>.</para>

      <indexterm><primary>XML</primary></indexterm>

      <para>Este arquivo deve estar no formato XML. Preste muita atenção ao uso de letras maiusculas e minusculas e certifique-se de que todas as tags estejam corretamente fechadas. O arquivo começa com o cabeçalho XML usual seguido por uma definição DOCTYPE e, em seguida, a tag <literal>&lt;fontconfig&gt;</literal>:</para>

      <programlisting>&lt;?xml version="1.0"?&gt;
      &lt;!DOCTYPE fontconfig SYSTEM "fonts.dtd"&gt;
      &lt;fontconfig&gt;</programlisting>

      <para>Como dito anteriormente, todas as fontes em <filename>/usr/local/share/fonts/</filename> e <filename>~/.fonts/</filename> já estão disponíveis para aplicativos Xft-aware. Para adicionar outro diretório fora dessas duas árvores de diretórios, adicione uma linha como essa a <filename>/usr/local/etc/fonts/local.conf</filename>:</para>

      <programlisting>&lt;dir&gt;/path/to/my/fonts&lt;/dir&gt;</programlisting>

      <para>Depois de adicionar novas fontes e especialmente novos diretórios de fontes, reconstrua os caches de fontes:</para>

      <screen><prompt>#</prompt> <userinput>fc-cache -f</userinput></screen>

      <para>O anti-aliasing torna as bordas um pouco confusas, o que torna o texto muito pequeno mais legível e remove os <quote>serrilhados</quote> do texto grande, mas pode causar fadiga ocular se aplicado ao texto normal. Para excluir tamanhos de fonte menores que 14 pontos do anti-aliasing, inclua estas linhas:</para>

      <programlisting>        &lt;match target="font"&gt;
	    &lt;test name="size" compare="less"&gt;
		&lt;double&gt;14&lt;/double&gt;
	    &lt;/test&gt;
	    &lt;edit name="antialias" mode="assign"&gt;
		&lt;bool&gt;false&lt;/bool&gt;
	    &lt;/edit&gt;
	&lt;/match&gt;
	&lt;match target="font"&gt;
	    &lt;test name="pixelsize" compare="less" qual="any"&gt;
		&lt;double&gt;14&lt;/double&gt;
	    &lt;/test&gt;
	    &lt;edit mode="assign" name="antialias"&gt;
		&lt;bool&gt;false&lt;/bool&gt;
	    &lt;/edit&gt;
	&lt;/match&gt;</programlisting>

      <indexterm><primary>fonts</primary> <secondary>spacing</secondary></indexterm>

      <para>O espaçamento para algumas fontes monoespaçadas também pode ser inadequado com o anti-aliasing. Este parece ser um problema com o <application>KDE</application>, em particular. Uma possível correção é forçar o espaçamento dessas fontes para que seja 100. Adicione essas linhas:</para>

      <programlisting>	&lt;match target="pattern" name="family"&gt;
	   &lt;test qual="any" name="family"&gt;
	       &lt;string&gt;fixed&lt;/string&gt;
	   &lt;/test&gt;
	   &lt;edit name="family" mode="assign"&gt;
	       &lt;string&gt;mono&lt;/string&gt;
	   &lt;/edit&gt;
	&lt;/match&gt;
	&lt;match target="pattern" name="family"&gt;
	    &lt;test qual="any" name="family"&gt;
		&lt;string&gt;console&lt;/string&gt;
	    &lt;/test&gt;
	    &lt;edit name="family" mode="assign"&gt;
		&lt;string&gt;mono&lt;/string&gt;
	    &lt;/edit&gt;
	&lt;/match&gt;</programlisting>

      <para>(isto cria um apelido para outros nomes comuns para fontes fixas como <literal>"mono"</literal>), e então adicione:</para>

      <programlisting>         &lt;match target="pattern" name="family"&gt;
	     &lt;test qual="any" name="family"&gt;
		 &lt;string&gt;mono&lt;/string&gt;
	     &lt;/test&gt;
	     &lt;edit name="spacing" mode="assign"&gt;
		 &lt;int&gt;100&lt;/int&gt;
	     &lt;/edit&gt;
	 &lt;/match&gt;      </programlisting>

      <para>Determinadas fontes, como Helvetica, podem ter um problema com o anti-alias. Geralmente isso se manifesta como uma fonte que parece cortada ao meio na vertical. Na pior das hipóteses, pode causar falhas nos aplicativos. Para evitar isso, considere adicionar o seguinte ao <filename>local.conf</filename>:</para>

      <programlisting>         &lt;match target="pattern" name="family"&gt;
	     &lt;test qual="any" name="family"&gt;
		 &lt;string&gt;Helvetica&lt;/string&gt;
	     &lt;/test&gt;
	     &lt;edit name="family" mode="assign"&gt;
		 &lt;string&gt;sans-serif&lt;/string&gt;
	     &lt;/edit&gt;
	 &lt;/match&gt;        </programlisting>

      <para>Depois de editar o <filename>local.conf</filename>, certifique-se de finalizar o arquivo com a tag <literal>&lt;/fontconfig&gt;</literal>. Não fazer isso fará com que as alterações sejam ignoradas.</para>

      <para>Os usuários podem adicionar configurações personalizadas criando seus próprios arquivos <filename>~/.config/fontconfig/fonts.conf</filename>. Este arquivo usa o mesmo formato <acronym>XML</acronym> descrito acima.</para>

      <indexterm><primary>LCD screen</primary></indexterm>
      <indexterm><primary>Fonts</primary> <secondary>LCD screen</secondary></indexterm>

      <para>Um último ponto: com uma tela de LCD, a amostragem de sub-pixels pode ser desejada. Isso basicamente trata os componentes vermelho, verde e azul (separados horizontalmente) separadamente para melhorar a resolução horizontal; os resultados podem ser dramáticos. Para habilitar isso, adicione a linha em algum lugar do <filename>local.conf</filename>:</para>

      <programlisting>	 &lt;match target="font"&gt;
	     &lt;test qual="all" name="rgba"&gt;
		 &lt;const&gt;unknown&lt;/const&gt;
	     &lt;/test&gt;
	     &lt;edit name="rgba" mode="assign"&gt;
		 &lt;const&gt;rgb&lt;/const&gt;
	     &lt;/edit&gt;
	 &lt;/match&gt;</programlisting>

      <note>
	<para>Dependendo do tipo de display, o <literal>rgb</literal> pode precisar ser alterado para <literal>bgr</literal>, <literal>vrgb</literal> ou <literal>vbgr</literal>: experimente e veja qual funciona melhor.</para>
      </note>
    </sect2>
  </sect1>

  <sect1 xml:id="x-xdm">
    <info>
      <title>O Gerenciador de Display X</title>

      <authorgroup>
	<author><personname> <firstname>Seth</firstname> <surname>Kingsley</surname> </personname> <contrib> Contribuído Originalmente por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>X Display Manager</primary></indexterm>
    <para>O <application>Xorg</application> fornece um Gerenciador de Display X, o <application>XDM</application>, que pode ser usado para o gerenciamento de sessões de login. O <application>XDM</application> fornece uma interface gráfica para escolher em qual servidor de display se conectar para inserir informações de autorização, tal como uma combinação de login e senha.</para>

    <para>Esta seção demonstra como configurar o X Display Manager no FreeBSD. Alguns ambientes de desktop fornecem seu próprio gerenciador de login gráfico. Consulte <xref linkend="x11-wm-gnome"/> para instruções sobre como configurar o GNOME Display Manager e <xref linkend="x11-wm-kde"/> para instruções sobre como configurar o KDE Display Manager.</para>

    <sect2>
      <title>Configurando o <application>XDM</application></title>

      <para>Para instalar o <application>XDM</application>, use o pacote ou ports <package>x11/xdm</package>. Uma vez instalado, o <application>XDM</application> pode ser configurado para ser executado quando a máquina for inicializada editando esta entrada em <filename>/etc/ttys</filename>:</para>

      <screen>ttyv8   "/usr/local/bin/xdm -nodaemon"  xterm   off secure</screen>

      <para>Altere o <literal>off</literal> para <literal>on</literal> e salve a edição. O <literal>ttyv8</literal> nesta entrada indica que o <application>XDM</application> será executado no nono terminal virtual.</para>

      <para>O diretório de configuração do <application>XDM</application> está localizado em <filename>/usr/local/lib/X11/xdm</filename>. Esse diretório contém diversos arquivos usados para alterar o comportamento e a aparência do <application>XDM</application>, bem como alguns scripts e programas usados para configurar a área de trabalho quando o <application>XDM</application> está em execução. <xref linkend="xdm-config-files"/> resume a função de cada um desses arquivos. A sintaxe exata e o uso desses arquivos são descritos em <citerefentry vendor="xfree86"><refentrytitle>xdm</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</para>

      <table frame="none" pgwide="1" xml:id="xdm-config-files">
	<title>Arquivos de Configuração do XDM</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Arquivo</entry>
	      <entry>Descrição</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><filename>Xaccess</filename></entry>
	      <entry>O protocolo para conectar ao <application>XDM</application> é chamado de X Display Manager Connection Protocol (<acronym>XDMCP</acronym>). Este arquivo é um conjunto de regras de autorização do cliente para controlar conexões de <acronym>XDMCP</acronym> de máquinas remotas. Por padrão, esse arquivo não permite a conexão de nenhum cliente remoto.</entry>
	    </row>

	    <row>
	      <entry><filename>Xresources</filename></entry>
	      <entry>Este arquivo controla a aparência do seletor de display <application>XDM</application> e das telas de login. A configuração padrão é uma janela de login retangular simples com o nome do host da máquina exibido na parte superior em uma fonte grande e <quote>Login:</quote> e <quote>Senha:</quote> solicitado abaixo. O formato deste arquivo é idêntico ao arquivo app-defaults descrito na documentação do <application>Xorg</application>.</entry>
	    </row>

	    <row>
	      <entry><filename>Xservers</filename></entry>
	      <entry>A lista de exibições locais e remotas que o seletor deve fornecer como opções de login.</entry>
	    </row>

	    <row>
	      <entry><filename>Xsession</filename></entry>
	      <entry>Script de sessão padrão para logins que é executado pelo <application>XDM</application> após um usuário realizar o login. Isso aponta para um script de sessão personalizado em <filename>~/.xsession</filename>.</entry>
	    </row>

	    <row>
	      <entry><filename>Xsetup_</filename>*</entry>
	      <entry>Script para iniciar automaticamente os aplicativos antes de exibir as interfaces de seleção ou de login. Há um script para cada exibição sendo usada, denominada <filename>Xsetup_*</filename>, em que <literal>*</literal> é o número de exibição local. Geralmente, esses scripts executam um ou dois programas em segundo plano, como <command>xconsole</command>.</entry>
	    </row>

	    <row>
	      <entry><filename>xdm-config</filename></entry>
	      <entry>Configuração global para todos os monitores executados nesta máquina.</entry>
	    </row>

	    <row>
	      <entry><filename>xdm-errors</filename></entry>
	      <entry>Contém os erros gerados pelo programa do servidor. Se um display que o <application>XDM</application> está tentando iniciar travar, procure neste arquivo por mensagens de erro. Essas mensagens também são gravadas no <filename>~/.xsession-errors</filename> do usuário.</entry>
	    </row>

	    <row>
	      <entry><filename>xdm-pid</filename></entry>
	      <entry>O <acronym>ID</acronym> do processo <application>XDM</application> em execução.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>
    </sect2>

    <sect2>
      <title>Configurando o acesso remoto</title>

      <para>Por padrão, somente usuários no mesmo sistema podem efetuar login usando o <application>XDM</application>. Para permitir que os usuários em outros sistemas se conectem ao servidor de Display, edite as regras de controle de acesso e ative o listener de conexão.</para>

      <para>Para configurar o <application>XDM</application> para escutar qualquer conexão remota, comente a linha <literal>DisplayManager.requestPort</literal> em <filename>/usr/local/etc/X11/xdm/xdm-config</filename> colocando um <literal>!</literal> na frente dele:</para>

      <screen>! SECURITY: do not listen for XDMCP or Chooser requests
! Comment out this line if you want to manage X terminals with xdm
DisplayManager.requestPort:     0</screen>

      <para>Salve as edições e reinicie o <application>XDM</application>. Para restringir o acesso remoto, veja as entradas de exemplo em <filename>/usr/local/lib/X11/xdm/Xaccess</filename> e consulte <citerefentry vendor="xfree86"><refentrytitle>xdm</refentrytitle><manvolnum>1</manvolnum></citerefentry> para mais informações.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="x11-wm">
    <info>
      <title>Ambientes de desktop</title>

      <authorgroup>
	<author><personname> <firstname>Valentino</firstname> <surname>Vaschetto</surname> </personname> <contrib>Contribuído por </contrib></author>
      </authorgroup>
    </info>

    <para>Esta seção descreve como instalar três ambientes de desktop populares em um sistema FreeBSD. Um ambiente de desktop pode variar de um gerenciador de janelas simples a um conjunto completo de aplicativos de desktop. Mais de cem ambientes de área de trabalho estão disponíveis na categoria <filename>x11-wm</filename> da Coleção de Ports.</para>

    <sect2 xml:id="x11-wm-gnome">
      <title>GNOME</title>

      <indexterm><primary>GNOME</primary></indexterm>
      <para>O <application>GNOME</application> é um ambiente de área de trabalho amigável. Ele inclui um painel para iniciar aplicativos e exibir status, uma área de trabalho, um conjunto de ferramentas e aplicativos e um conjunto de convenções que facilitam a cooperação entre os aplicativos e a compatibilidade entre eles. Mais informações sobre o <application>GNOME</application> no FreeBSD podem ser encontradas em <link xlink:href="https://www.FreeBSD.org/gnome">https://www.FreeBSD.org/gnome</link>. Esse site contém documentação adicional sobre instalação, configuração e gerenciamento do <application>GNOME</application> no FreeBSD.</para>

      <para>Este ambiente de desktop pode ser instalado a partir de um pacote binario:</para>

      <screen><prompt>#</prompt> <userinput>pkg install gnome3</userinput></screen>

      <para>Para instalar o <application>GNOME</application> a partir do ports, use o seguinte comando. O <application>GNOME</application> é um aplicativo grande e levará algum tempo para compilar, mesmo em um computador rápido.</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/x11/gnome3</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>

      <para>O <application>GNOME</application> requer que o <filename>/proc</filename> seja montado. Adicione esta linha ao <filename>/etc/fstab</filename> para montar este sistema de arquivos automaticamente durante a inicialização do sistema:</para>

      <programlisting>proc           /proc       procfs  rw  0   0</programlisting>

      <para>O <application>GNOME</application> usa o <application>D-Bus</application> e o <application>HAL</application> para barramento de mensagens e abstração de hardware. Esses aplicativos são instalados automaticamente como dependências do <application>GNOME</application>. Habilite-os em <filename>/etc/rc.conf</filename> para que eles sejam iniciados quando o sistema inicializar:</para>

      <programlisting>dbus_enable="YES"
hald_enable="YES"</programlisting>

      <para>Após a instalação, configure o <application>Xorg</application> para iniciar o <application>GNOME</application>. A maneira mais fácil de fazer isso é habilitar o Gerenciador de Display do GNOME, o <application>GDM</application>, que é instalado como parte do pacote ou ports do <application>GNOME</application>. Pode ser ativado adicionando esta linha ao <filename>/etc/rc.conf</filename>:</para>

      <programlisting>gdm_enable="YES"</programlisting>

      <para>Geralmente é desejável também iniciar todos os serviços do <application>GNOME</application>. Para conseguir isso, adicione uma segunda linha ao <filename>/etc/rc.conf</filename>:</para>

      <programlisting>gnome_enable="YES"</programlisting>

      <para>O <application>GDM</application> será iniciado automaticamente quando o sistema for inicializado.</para>

      <para>Um segundo método para iniciar o <application>GNOME</application> é digitar <command>startx</command> na linha de comando depois de configurar o <filename>~/.xinitrc</filename>. Se este arquivo já existir, substitua a linha que inicia o gerenciador de janelas atual por uma que inicie o <filename>/usr/local/bin/gnome-session</filename>. Se este arquivo não existir, crie-o com este comando:</para>

      <screen><prompt>%</prompt> <userinput>echo "exec /usr/local/bin/gnome-session" &gt; ~/.xinitrc</userinput></screen>

      <para>Um terceiro método é usar o <application>XDM</application> como o gerenciador de Display. Neste caso, crie um executável <filename>~/.xsession</filename>:</para>

      <screen><prompt>%</prompt> <userinput>echo "exec /usr/local/bin/gnome-session" &gt; ~/.xsession</userinput></screen>
    </sect2>

    <sect2 xml:id="x11-wm-kde">
      <title>KDE</title>

      <indexterm><primary>KDE</primary></indexterm>

      <para>O <application>KDE</application> é outro ambiente de trabalho fácil de usar. Essa área de trabalho fornece um conjunto de aplicativos com aparência e comportamento consistentes, um menu e barras de ferramentas padronizadas, atalhos de teclado, esquemas de cores, internacionalização e uma configuração de área de trabalho centralizada e orientada a diálogos. Mais informações sobre o <application>KDE</application> podem ser encontradas em <link xlink:href="http://www.kde.org/">http://www.kde.org/</link>. Para informações específicas do FreeBSD, consulte <link xlink:href="http://freebsd.kde.org/">http://freebsd.kde.org</link>.</para>

      <para>Para instalar o pacote <application>KDE</application>, digite:</para>

      <screen><prompt>#</prompt> <userinput>pkg install x11/kde5</userinput></screen>

      <para>Para instalar o <application>KDE</application> via ports, use o seguinte comando. A instalação do ports fornecerá um menu para selecionar quais componentes instalar. O <application>KDE</application> é um aplicativo grande e levará algum tempo para compilar, mesmo em um computador rápido.</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/x11/kde5</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>

      <para>O <application>KDE</application> requer que o <filename>/proc</filename> esteja montado. Adicione esta linha ao <filename>/etc/fstab</filename> para montar este sistema de arquivos automaticamente durante a inicialização do sistema:</para>

      <programlisting>proc           /proc       procfs  rw  0   0</programlisting>

      <para>O <application>KDE</application> usa o <application>D-Bus</application> e o <application>HAL</application> para barramento de mensagens e abstração de hardware. Estas aplicações são automaticamente instaladas como dependências do <application>KDE</application>. Habilite-os em <filename>/etc/rc.conf</filename> para que eles sejam iniciados quando o sistema inicializar:</para>

      <programlisting>dbus_enable="YES"
hald_enable="YES"</programlisting>

      <indexterm><primary>KDE</primary> <secondary>display manager</secondary></indexterm>

      <para>Desde o KDE Plasma 5, o Gerenciador de Display do KDE, <application>KDM</application>, não é mais desenvolvido. Uma possível substituição é o <application>SDDM</application>. Para instalá-lo, digite:</para>

      <screen><prompt>#</prompt> <userinput>pkg install x11/sddm</userinput></screen>

      <para>Adicione esta linha em <filename>/etc/rc.conf</filename>:</para>

      <programlisting>sddm_enable="YES"</programlisting>

      <para>Um segundo método para iniciar o <application>KDE Plasma</application> é digitar <command>startx</command> na linha de comando. Para que isso funcione, a seguinte linha é necessária em <filename>~/.xinitrc</filename>:</para>

      <programlisting>exec ck-launch-session startplasma-x11</programlisting>

      <para>Um terceiro método para iniciar o <application>KDE Plasma </application> é através do <application>XDM</application>. Para fazer isso, crie um arquivo executável <filename>~/.xsession</filename> da seguinte maneira:</para>

      <screen><prompt>%</prompt> <userinput>echo "exec ck-launch-session startplasma-x11" &gt; ~/.xsession</userinput></screen>

      <para>Uma vez iniciado o <application>KDE Plasma </application>, consulte o sistema de ajuda integrado para obter mais informações sobre como usar seus diversos menus e aplicativos.</para>
    </sect2>

    <sect2 xml:id="x11-wm-xfce">
      <title>Xfce</title>

      <para>O <application>Xfce</application> é um ambiente de desktop baseado no kit de ferramentas GTK+ usado pelo <application>GNOME</application>. No entanto, é mais leve e fornece um desktop simples, eficiente e fácil de usar. É totalmente configurável, possui um painel principal com menus, applets e lançadores de aplicativos, fornece um gerenciador de arquivos e um gerenciador de som e é personalizável. Como é rápido, leve e eficiente, é ideal para máquinas mais antigas ou mais lentas com limitações de memória. Mais informações sobre o <application>Xfce</application> podem ser encontradas em <link xlink:href="http://www.xfce.org/">http://www.xfce.org</link>.</para>

      <para>Para instalar o pacote <application>Xfce</application>:</para>

      <screen><prompt>#</prompt> <userinput>pkg install xfce</userinput></screen>

      <para>Alternativamente , para compilar o port:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/x11-wm/xfce4</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>

      <para>O <application>Xfce</application> usa o <application>D-Bus</application> para barramento de mensagens. Este aplicativo é instalado automaticamente como dependência do <application>Xfce</application>. Habilite-o em <filename>/etc/rc.conf</filename> para que ele seja iniciado quando o sistema inicializar:</para>

      <programlisting>dbus_enable="YES"</programlisting>

      <para>Ao contrário do <application>GNOME</application> ou <application>KDE</application>, o <application>Xfce</application> não disponibiliza seu próprio gerenciador de login. Para iniciar o <application>Xfce</application> à partir da linha de comando digitando <command>startx</command>, mas primeiro adicione sua entrada ao <filename>~/.xinitrc</filename>:</para>

      <screen><prompt>%</prompt> <userinput>echo ". /usr/local/etc/xdg/xfce4/xinitrc" &gt; ~/.xinitrc</userinput></screen>

      <para>Um método alternativo é usar o <application>XDM</application>. Para configurar este método, crie um executável <filename>~/.xsession</filename>:</para>

      <screen><prompt>%</prompt> <userinput>echo ". /usr/local/etc/xdg/xfce4/xinitrc" &gt; ~/.xsession</userinput></screen>
    </sect2>
  </sect1>

  <sect1 xml:id="x-compiz-fusion">
    <title>Instalando o Compiz Fusion</title>

    <para>Uma maneira de tornar o uso de um computador desktop mais agradável é com bons efeitos 3D.</para>

    <para>Instalar o pacote <application>Compiz Fusion</application> é fácil, mas a configuração requer alguns passos que não estão descritos na documentação do ports.</para>

    <sect2 xml:id="x-compiz-video-card">
      <title>Configurando o Driver nVidia no FreeBSD</title>

      <para>Os efeitos da área de trabalho podem causar uma carga considerável na placa gráfica. Para uma placa gráfica baseada na nVidia, o driver proprietário é necessário para um bom desempenho. Usuários de outras placas gráficas podem pular esta seção e continuar com a configuração do <filename>xorg.conf</filename>.</para>

      <para>Para determinar qual o driver nVidia é necessário, consulte a <link xlink:href="@@URL_RELPREFIX@@/doc/en_US.ISO8859-1/books/faq/x.html#idp59950544">Perguntas frequentes sobre o assunto</link>.</para>

      <para>Tendo determinado o driver correto para usar em sua placa gráfica, a instalação é tão simples quanto instalar qualquer outro pacote.</para>

      <para>Por exemplo, para instalar o driver mais recente:</para>

      <screen><prompt>#</prompt> <userinput>pkg install x11/nvidia-driver</userinput></screen>

      <para>O driver irá criar um módulo do kernel, que precisa ser carregado na inicialização do sistema. Adicione a seguinte linha ao <filename>/boot/loader.conf</filename>:</para>

      <programlisting>nvidia_load="YES"</programlisting>

      <note>
	<para>Para carregar imediatamente o módulo no kernel em execução, você pode executar o comando <command>kldload nvidia</command>. No entanto, foi observado que algumas versões do <application>Xorg</application> não funcionarão corretamente se o driver não for carregado no momento da inicialização. Desta forma, depois de editar o <filename>/boot/loader.conf</filename>, é recomendado reiniciar o sistema.</para>
      </note>

      <para>Com o módulo do kernel carregado, você normalmente só precisa alterar uma única linha no <filename>xorg.conf</filename> para habilitar o driver proprietário:</para>

      <para>Encontre a seguinte linha no <filename>/etc/X11/xorg.conf</filename>:</para>

      <programlisting>Driver      "nv"</programlisting>

      <para>e mude para:</para>

      <programlisting>Driver      "nvidia"</programlisting>

      <para>Inicie a GUI como de costume, e você será saudado pelo splash da nVidia. Tudo deve funcionar como de costume.</para>
    </sect2>

    <sect2 xml:id="xorg-configuration">
      <title>Configurando o xorg.conf para Efeitos de Desktop</title>

      <para>Para ativar o <application>Compiz Fusion</application>, o <filename>/etc/X11/xorg.conf</filename> precisa ser modificado:</para>

      <para>Adicione a seguinte seção para habilitar os efeitos compostos:</para>

      <programlisting>Section "Extensions"
    Option         "Composite" "Enable"
EndSection</programlisting>

      <para>Localize a seção <quote>Screen</quote>, que deve ser semelhante à abaixo:</para>

      <programlisting>Section "Screen"
    Identifier     "Screen0"
    Device         "Card0"
    Monitor        "Monitor0"
    ...</programlisting>

      <para>e adicione as duas linhas seguintes (após <quote>Monitor</quote>):</para>

      <programlisting>DefaultDepth    24
Option         "AddARGBGLXVisuals" "True"</programlisting>

      <para>Localize a <quote>Subsection</quote> que se refere à resolução da tela que você deseja usar. Por exemplo, se você deseja usar 1280x1024, localize a seção a seguir. Se a resolução desejada não aparecer em nenhuma subseção, você pode adicionar a entrada relevante à mão:</para>

      <programlisting>SubSection     "Display"
    Viewport    0 0
    Modes      "1280x1024"
EndSubSection</programlisting>

      <para>Uma profundidade de cor de 24 bits é necessária para a composição do desktop, altere a subseção acima para:</para>

      <programlisting>SubSection     "Display"
    Viewport    0 0
    Depth       24
    Modes      "1280x1024"
EndSubSection</programlisting>

      <para>Finalmente, confirme que os módulos <quote>glx</quote> e <quote>extmod</quote> estão carregados na seção <quote>Module</quote>:</para>

      <programlisting>Section "Module"
    Load           "extmod"
    Load           "glx"
    ...</programlisting>

      <para>A configuração acima pode ser feita automaticamente com o <package>x11/nvidia-xconfig</package> (executando como <systemitem class="username">root</systemitem>):</para>

      <screen><prompt>#</prompt> <userinput>nvidia-xconfig --add-argb-glx-visuals</userinput>
<prompt>#</prompt> <userinput>nvidia-xconfig --composite</userinput>
<prompt>#</prompt> <userinput>nvidia-xconfig --depth=24</userinput></screen>
    </sect2>

    <sect2 xml:id="compiz-fusion">
      <title>Instalando e Configurando o Compiz Fusion</title>

      <para>Instalar o <application>Compiz Fusion</application> é tão simples quanto qualquer outro pacote:</para>

      <screen><prompt>#</prompt> <userinput>pkg install x11-wm/compiz-fusion</userinput></screen>

      <para>Quando a instalação estiver concluída, inicie o Desktop Gráfico e, em um terminal, digite os seguintes comandos (como usuário normal):</para>

      <screen><prompt>%</prompt> <userinput>compiz --replace --sm-disable --ignore-desktop-hints ccp &amp;</userinput>
<prompt>%</prompt> <userinput>emerald --replace &amp;</userinput></screen>

      <para>Sua tela piscará por alguns segundos, pois o gerenciador de janelas (por exemplo, <application>Metacity</application> se você estiver usando o <application>GNOME</application>) será substituído pelo <application>Compiz Fusion</application>. O <application>Emerald</application> cuida das decorações da janela (isto é, botões de fechar, minimizar, maximizar, barras de título e assim por diante).</para>

      <para>Você pode converter isso em um script trivial e executá-lo na inicialização automaticamente (por exemplo, adicionando a <quote>Sessions</quote> em um Desktop do <application>GNOME</application>):</para>

      <programlisting>#! /bin/sh
compiz --replace --sm-disable --ignore-desktop-hints ccp &amp;
emerald --replace &amp;</programlisting>

      <para>Salve isso no seu diretório home como, por exemplo, <filename>start-compiz</filename> e torne-o executável:</para>

      <screen><prompt>%</prompt> <userinput>chmod +x ~/start-compiz</userinput></screen>

      <para>Em seguida, utilize a GUI para adicioná-lo a <guimenuitem>Startup Programs</guimenuitem> (localizado em <guimenuitem>System</guimenuitem>, <guimenuitem>Preferences</guimenuitem>, <guimenuitem>Sessions</guimenuitem> em um desktop <application>GNOME</application>).</para>

      <para>Para selecionar realmente todos os efeitos desejados e suas configurações, execute (novamente como um usuário normal) o <application>Compiz Config Settings Manager</application>:</para>

      <screen><prompt>%</prompt> <userinput>ccsm</userinput></screen>

      <note>
	<para>No <application>GNOME</application>, isso também pode ser encontrado no menu <guimenuitem>System</guimenuitem>, <guimenuitem>Preferences</guimenuitem>.</para>
      </note>

      <para>Se você selecionou <quote>gconf support</quote> durante a compilação, você também será capaz de ver estas configurações usando o <command>gconf-editor</command> sob <literal>apps/compiz</literal>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="x11-troubleshooting">

    <title>Solução de problemas</title>

    <para>Se o mouse não funcionar, você precisará primeiro configurá-lo antes de prosseguir. Em versões recentes do <application>Xorg</application>, as seções <literal>InputDevice</literal> em <filename>xorg.conf</filename> são ignoradas em favor dos dispositivos autodetectados. Para restaurar o comportamento antigo, adicione a seguinte linha à seção <literal>ServerLayout</literal> ou <literal>ServerFlags</literal> deste arquivo:</para>

      <programlisting>Option "AutoAddDevices" "false"</programlisting>

      <para>Os dispositivos de entrada podem então ser configurados como nas versões anteriores, juntamente com quaisquer outras opções necessárias (por exemplo, troca do layout de teclado).</para>

      <note>
	<para>Como explicado anteriormente, o daemon <application>hald</application> irá, por padrão, detectar automaticamente o seu teclado. Há chances de que o layout ou modelo do teclado não esteja correto, ambientes de Desktop como o <application>GNOME</application>, <application>KDE</application> ou <application>Xfce</application> fornecem ferramentas para configurar o teclado. No entanto, é possível definir as propriedades do teclado diretamente com a ajuda do utilitário <citerefentry vendor="xorg"><refentrytitle>setxkbmap</refentrytitle><manvolnum>1</manvolnum></citerefentry> ou com uma regra de configuração do aplicativo<application>hald</application>.</para>

	<para>Por exemplo, se alguém quiser usar um teclado de teclas PC 102 vindo com um layout francês, temos que criar um arquivo de configuração de teclado para o <application>hald</application> chamado <filename>x11-input.fdi</filename> e salva-lo no diretório <filename>/usr/local/etc/hal/fdi/policy</filename>. Este arquivo deve conter as seguintes linhas:</para>

	<programlisting>&lt;?xml version="1.0" encoding="iso-8859-1"?&gt;
&lt;deviceinfo version="0.2"&gt;
  &lt;device&gt;
    &lt;match key="info.capabilities" contains="input.keyboard"&gt;
	  &lt;merge key="input.x11_options.XkbModel" type="string"&gt;pc102&lt;/merge&gt;
	  &lt;merge key="input.x11_options.XkbLayout" type="string"&gt;fr&lt;/merge&gt;
    &lt;/match&gt;
  &lt;/device&gt;
&lt;/deviceinfo&gt;</programlisting>

	<para>Se este arquivo já existir, apenas copie e adicione ao seu arquivo as linhas referentes à configuração do teclado.</para>

	<para>Você terá que reinicializar sua máquina para forçar o <application>hald</application> a ler este arquivo.</para>

	<para>É possível fazer a mesma configuração a partir de um terminal X ou um script com esta linha de comando:</para>

	<screen><prompt>%</prompt> <userinput>setxkbmap -model pc102 -layout fr</userinput></screen>

	<para>O <filename>/usr/local/share/X11/xkb/rules/base.lst</filename> lista os vários teclados, layouts e opções disponíveis.</para>
      </note>

      <indexterm><primary><application>Xorg</application> tuning</primary></indexterm>

      <para>O arquivo de configuração <filename>xorg.conf.new</filename> pode agora ser ajustado para o seu gosto. Abra o arquivo em um editor de texto, como <citerefentry vendor="ports"><refentrytitle>emacs</refentrytitle> <manvolnum>1</manvolnum></citerefentry> ou o <citerefentry><refentrytitle>ee</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Se o monitor for um modelo antigo ou incomum que não suporta a detecção automática de frequências de sincronização, essas configurações podem ser adicionadas ao <filename>xorg.conf.new</filename> na seção <literal>"Monitor"</literal>:</para>

      <programlisting>Section "Monitor"
	Identifier   "Monitor0"
	VendorName   "Monitor Vendor"
	ModelName    "Monitor Model"
	HorizSync    30-107
	VertRefresh  48-120
EndSection</programlisting>

      <para>A maioria dos monitores suporta autodetecção de frequência de sincronização, tornando desnecessária a entrada manual desses valores. Para os poucos monitores que não suportam a detecção automática, evite possíveis danos inserindo apenas valores fornecidos pelo fabricante.</para>

      <para>O X permite que os recursos do DPMS (Energy Star) sejam usados com monitores capazes. O programa <citerefentry vendor="xfree86"><refentrytitle>xset</refentrytitle><manvolnum>1</manvolnum></citerefentry> controla os tempos limite e pode forçar os modos de espera, suspensão ou desativação. Se você deseja habilitar recursos de  DPMS para o seu monitor, você deve adicionar a seguinte linha à seção do monitor:</para>

      <programlisting>Option       "DPMS"</programlisting>

      <indexterm><primary><filename>xorg.conf</filename></primary></indexterm>

      <para>Enquanto o arquivo de configuração <filename>xorg.conf.new</filename> ainda estiver aberto em um editor, selecione a resolução padrão e a profundidade de cor desejada. Isso é definido na seção <literal>"Screen"</literal>:</para>

      <programlisting>Section "Screen"
	Identifier "Screen0"
	Device     "Card0"
	Monitor    "Monitor0"
	DefaultDepth 24
	SubSection "Display"
		Viewport  0 0
		Depth     24
		Modes     "1024x768"
	EndSubSection
EndSection</programlisting>

      <para>A palavra-chave <literal>DefaultDepth</literal> descreve a profundidade de cor a ser executada por padrão. Isto pode ser sobrescrito com a opção de linha de comando <option>-depth</option> para <citerefentry vendor="xorg"> <refentrytitle>Xorg</refentrytitle><manvolnum>1</manvolnum></citerefentry>. A palavra-chave <literal>Modes</literal> descreve a resolução a ser executada na profundidade de cor especificada. Observe que somente os modos padrão VESA são suportados, conforme definido pelo hardware gráfico do sistema de destino. No exemplo acima, a profundidade de cor padrão é de vinte e quatro bits por pixel. Nesta profundidade de cor, a resolução aceita é 1024 por 768 pixels.</para>

      <para>Finalmente, escreva o arquivo de configuração e teste-o usando o modo de teste dado acima.</para>

      <note>
	<para>Uma das ferramentas disponíveis para ajudá-lo durante o processo de solução de problemas são os arquivos de log do <application>Xorg</application>, que contêm informações sobre cada dispositivo ao qual o servidor <application>Xorg</application> se conecta. Os nomes de arquivos de log do <application>Xorg</application> estão no formato <filename>/var/log/Xorg.0.log</filename>. O nome exato do log pode variar de <filename>Xorg.0.log</filename> para <filename>Xorg.8.log</filename> e assim por diante.</para>
      </note>

      <para>Se tudo estiver bem, o arquivo de configuração precisa ser instalado em um local comum onde o <citerefentry vendor="xorg"><refentrytitle>Xorg</refentrytitle><manvolnum>1</manvolnum></citerefentry> possa encontrá-lo. Isto é tipicamente <filename>/etc/X11/xorg.conf</filename> ou <filename>/usr/local/etc/X11/xorg.conf</filename>.</para>

      <screen><prompt>#</prompt> <userinput>cp xorg.conf.new /etc/X11/xorg.conf</userinput></screen>

      <para>O processo de configuração do <application>Xorg</application> agora está completo. O <application>Xorg</application> pode agora ser iniciado com o utilitário <citerefentry vendor="xfree86"><refentrytitle>startx</refentrytitle><manvolnum>1</manvolnum></citerefentry>. O servidor <application>Xorg</application> também pode ser iniciado com o uso de <citerefentry vendor="xfree86"><refentrytitle>xdm</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</para>

      <sect2>
	<title>Configuração com Chipsets gráficos <trademark class="registered">Intel</trademark> <literal>i810</literal></title>

	<indexterm><primary><trademark class="registered">Intel</trademark> i810 graphic chipset</primary></indexterm>

	<para>A configuração com chipsets integrados i810 da <trademark class="registered">Intel</trademark> requer a interface de programação AGP <filename>agpgart</filename> para o <application>Xorg</application> para conduzir a placa. Consulte a página de manual do driver <citerefentry><refentrytitle>agp</refentrytitle><manvolnum>4</manvolnum></citerefentry> para obter maiores informações.</para>

	<para>Isso permitirá a configuração do hardware como qualquer outra placa gráfica. Observe que nos sistemas sem o driver <citerefentry><refentrytitle>agp</refentrytitle><manvolnum>4</manvolnum></citerefentry> compilado no kernel, tentar carregar o módulo com <citerefentry><refentrytitle>kldload</refentrytitle><manvolnum>8</manvolnum></citerefentry> não funcionará. Este driver tem que estar no kernel no momento da inicialização, através da compilação ou usando o <filename>/boot/loader.conf</filename>.</para>
      </sect2>

      <sect2>
	<title>Adicionando um Flatpanel Widescreen ao Mix</title>

	<indexterm><primary>widescreen flatpanel configuration</primary></indexterm>

	<para>Esta seção pressupõe um pouco de conhecimento avançado de configuração. Se as tentativas de usar as ferramentas de configuração padrão acima não resultaram em uma configuração funcional, há informações suficientes nos arquivos de log para serem úteis para fazer a configuração funcionar. O uso de um editor de texto será necessário.</para>

	<para>Os formatos widescreen atuais (WSXGA, WSXGA+, WUXGA, WXGA, WXGA+, etc.) suportam formatos ou proporções de formato 16:10 e 10:9 que podem ser problemáticos. Exemplos de algumas resoluções de tela comuns para proporções de 16:10 são:</para>

	<itemizedlist>
	  <listitem>
	    <para>2560x1600</para>
	  </listitem>

	  <listitem>
	    <para>1920x1200</para>
	  </listitem>

	  <listitem>
	    <para>1680x1050</para>
	  </listitem>

	  <listitem>
	    <para>1440x900</para>
	  </listitem>

	  <listitem>
	    <para>1280x800</para>
	  </listitem>
	</itemizedlist>

	<para>Em algum momento, será tão fácil quanto adicionar uma dessas resoluções como um possível <literal>Mode</literal> na <literal>Section "Screen"</literal> como tal:</para>

	<programlisting>Section "Screen"
Identifier "Screen0"
Device     "Card0"
Monitor    "Monitor0"
DefaultDepth 24
SubSection "Display"
	Viewport  0 0
	Depth     24
	Modes     "1680x1050"
EndSubSection
EndSection</programlisting>

	<para>O <application>Xorg</application> é inteligente o suficiente para extrair as informações de resolução da tela widescreen via informações I2C/DDC, para que ele saiba o que o monitor pode suportar em termos de freqüências e resoluções.</para>

	<para>Se aqueles <literal>ModeLines</literal> não existem nos drivers, pode ser necessário dar ao <application>Xorg</application> uma pequena dica. Usando o <filename>/var/log/Xorg.0.log</filename> pode-se extrair informações suficientes para criar manualmente um <literal>ModeLine</literal> que funcionará. Basta procurar informações semelhantes:</para>

	<programlisting>(II) MGA(0): Supported additional Video Mode:
(II) MGA(0): clock: 146.2 MHz   Image Size:  433 x 271 mm
(II) MGA(0): h_active: 1680  h_sync: 1784  h_sync_end 1960 h_blank_end 2240 h_border: 0
(II) MGA(0): v_active: 1050  v_sync: 1053  v_sync_end 1059 v_blanking: 1089 v_border: 0
(II) MGA(0): Ranges: V min: 48  V max: 85 Hz, H min: 30  H max: 94 kHz, PixClock max 170 MHz</programlisting>

	<para>Esta informação é chamada de informação EDID. Criar uma <literal>ModeLine</literal> a partir disso é apenas uma questão de colocar os números na ordem correta:</para>

	<programlisting>ModeLine &lt;name&gt; &lt;clock&gt; &lt;4 horiz. timings&gt; &lt;4 vert. timings&gt;</programlisting>

	<para>Assim, o <literal>ModeLine</literal> na <literal>Section "Monitor"</literal> para este exemplo ficaria assim:</para>

	<programlisting>Section "Monitor"
Identifier      "Monitor1"
VendorName      "Bigname"
ModelName       "BestModel"
ModeLine        "1680x1050" 146.2 1680 1784 1960 2240 1050 1053 1059 1089
Option          "DPMS"
EndSection</programlisting>

	<para>Agora, tendo completado estes passos simples de edição, o X deve iniciar no seu novo monitor widescreen.</para>
      </sect2>

      <sect2 xml:id="compiz-troubleshooting">
	<title>Solução de problemas do Compiz Fusion</title>

	<qandaset>
	  <qandaentry>
	    <question xml:id="no-decorations">
	      <para>Eu instalei o <application>Compiz Fusion</application>, e depois de executar os comandos que você mencionou, minhas janelas ficaram sem barras de título e botões. O que está errado?</para>
	    </question>

	    <answer>
	      <para>Provavelmente está faltando alguma configuração em <filename>/etc/X11/xorg.conf</filename>. Revise este arquivo cuidadosamente e verifique especialmente as diretivas <literal>DefaultDepth</literal> e <literal>AddARGBGLXVisuals</literal>.</para>
	    </answer>
	  </qandaentry>

	  <qandaentry>
	    <question xml:id="xorg-crash">
	      <para>Quando executo o comando para iniciar o <application>Compiz Fusion</application>, o servidor X trava e eu volto ao console. O que está errado?</para>
	    </question>

	    <answer>
	      <para>Se você verificar o <filename>/var/log/Xorg.0.log</filename>, você provavelmente encontrará mensagens de erro durante a inicialização do X. As mais comuns seriam:</para>

	      <screen>(EE) NVIDIA(0):     Failed to initialize the GLX module; please check in your X
(EE) NVIDIA(0):     log file that the GLX module has been loaded in your X
(EE) NVIDIA(0):     server, and that the module is the NVIDIA GLX module.  If
(EE) NVIDIA(0):     you continue to encounter problems, Please try
(EE) NVIDIA(0):     reinstalling the NVIDIA driver.</screen>

	    <para>Este é geralmente o caso quando você atualiza o <application>Xorg</application>. Você precisará reinstalar o pacote <package>x11/nvidia-driver</package> para que o glx seja compilado novamente.</para>
	  </answer>
	</qandaentry>
      </qandaset>
    </sect2>
  </sect1>
</chapter>

  </part>

  <part xml:id="common-tasks">
    <title>Tarefas comuns</title>

    <partintro>
      <para>Agora que o básico foi abordado, esta parte do livro discute alguns recursos freqüentemente usados do FreeBSD. Estes capítulos:</para>

      <itemizedlist>
	<listitem>
	  <para>Introduzem aplicativos de desktop populares e úteis: navegadores, ferramentas de produtividade, visualizadores de documentos e muito mais.</para>
	</listitem>

	<listitem>
	  <para>Introduzem uma série de ferramentas multimídia disponíveis para o FreeBSD.</para>
	</listitem>

	<listitem>
	  <para>Explicam o processo de compilação de um kernel customizado do FreeBSD para habilitar funcionalidades extras.</para>
	</listitem>

	<listitem>
	  <para>Descrevem o sistema de impressão em detalhes, tanto configurações de impressoras conectadas em desktops quanto  impressoras conectadas à rede.</para>
	</listitem>

	<listitem>
	  <para>Mostram como executar aplicativos Linux no sistema FreeBSD.</para>
	</listitem>
      </itemizedlist>

      <para>Alguns destes capítulos recomendam leituras prévias, e isso é destacado na sinopse no início de cada capítulo.</para>
    </partintro>

    
<!--
     The FreeBSD Documentation Project
     $FreeBSD$
-->
<chapter version="5.0" xml:id="desktop">
  <!--
  <chapterinfo>
    <authorgroup>
      <author>
	<firstname>Christophe</firstname>
	<surname>Juniet</surname>
	<contrib>Contributed by </contrib>
      </author>
    </authorgroup>
  </chapterinfo>
  -->

  <title>Aplicações de Desktop</title>

  <sect1 xml:id="desktop-synopsis">
    <title>Sinopse</title>

    <para>Embora o FreeBSD seja popular como um servidor por seu desempenho e estabilidade, ele também é adequado para o uso diário como desktop. Com mais de 24.000 aplicativos disponíveis como pacotes ou ports para o FreeBSD, é fácil construir um desktop personalizado que executa uma ampla variedade de aplicativos de desktop. Este capítulo demonstra como instalar vários aplicativos de desktop, incluindo navegadores da Web, software de produtividade, visualizadores de documentos e softwares financeiros.</para>

    <note>
      <para>Os usuários que preferem instalar uma versão de desktop pré-configurada do FreeBSD em vez de configurar um do zero devem consultar <link xlink:href="http://www.furybsd.org">FuryBSD.</link>, <link xlink:href="https://ghostbsd.org">GhostBSD</link> or <link xlink:href="https://www.midnightbsd.org">MidnightBSD</link>.</para>
    </note>

    <para>Os leitores deste capítulo devem saber como:</para>

    <itemizedlist>
      <listitem>
	<para>Instalar software adicional usando pacotes ou ports, conforme descrito em <xref linkend="ports"/>.</para>
      </listitem>

      <listitem>
	<para>Instalar o X e um gerenciador de janelas, conforme descrito em <xref linkend="x11"/>.</para>
      </listitem>
    </itemizedlist>

    <para>Para obter informações sobre como configurar um ambiente multimídia, consulte <xref linkend="multimedia"/>.</para>
  </sect1>

  <sect1 xml:id="desktop-browsers">
    <title>Navegadores</title>

    <indexterm><primary>browsers</primary> <secondary>web</secondary></indexterm>

    <para>O FreeBSD não vem com um navegador Web pré-instalado. Em vez disso, a categoria <link xlink:href="https://www.FreeBSD.org/ports/www.html">www</link> da Coleção de Ports contém muitos navegadores que podem ser instalados como um pacote ou compilados a partir da coleção de Ports.</para>

    <para>Os ambientes de área de trabalho <application>KDE</application> e <application>GNOME</application> incluem seu próprio navegador HTML. Consulte <xref linkend="x11-wm"/> para mais informações sobre como configurar esses desktops completos.</para>

    <para>Alguns navegadores leves incluem o <package>www/dillo2</package>, o <package>www/links</package> e o <package>www/w3m</package>.</para>

    <para>Esta seção demonstra como instalar os seguintes navegadores Web populares e indica se o aplicativo é pesado em recursos, se leva tempo para compilar a partir do Ports ou se possui dependências importantes.</para>

    <informaltable frame="none" pgwide="1">
      <tgroup cols="4">
	<thead>
	  <row>
	    <entry>Nome da aplicação</entry>
	    <entry>Recursos necessários</entry>
	    <entry>Instalação a partir do Ports</entry>
	    <entry>Notas</entry>
	  </row>
	</thead>

	<tbody>
	  <row>
	    <entry><application>Firefox</application></entry>
	    <entry>médio</entry>
	    <entry>pesado</entry>
	    <entry>FreeBSD, <trademark class="registered">Linux</trademark>, e versões localizadas estão disponíveis</entry>
	  </row>

	  <row>
	    <entry><application>Konqueror</application></entry>
	    <entry>médio</entry>
	    <entry>pesado</entry>
	    <entry>Requer bibliotecas do <application>KDE</application></entry>
	  </row>

	  <row>
	    <entry><application>Chromium</application></entry>
	    <entry>médio</entry>
	    <entry>pesado</entry>
	    <entry>Requer <application>Gtk+</application></entry>
	  </row>
	</tbody>
      </tgroup>
    </informaltable>

    <sect2>
      <title>Firefox</title>

      <indexterm><primary><application>Firefox</application></primary></indexterm>

      <para>O <application>Firefox</application> é um navegador de código-fonte aberto que apresenta um mecanismo de exibição HTML compatível com os padrões, navegação por guias, bloqueio de pop-up, extensões, segurança aprimorada e muito mais. O <application>Firefox</application> é baseado na base de código <application>Mozilla</application>.</para>

      <para>Para instalar o pacote da versão mais recente do <application>Firefox</application>, digite:</para>

      <screen><prompt>#</prompt> <userinput>pkg install firefox</userinput></screen>

      <para>Para instalar a versão ESR (Extended Support Release) do <application>Firefox</application>, use:</para>

      <screen><prompt>#</prompt> <userinput>pkg install firefox-esr</userinput></screen>

      <para>A Coleção de Ports pode ser usada para compilar a versão desejada do <application>Firefox</application> a partir do código-fonte. Este exemplo compila o <package>www/firefox</package>, onde o <literal>firefox</literal> pode ser substituído pelo ESR ou pela versão localizada para instalar.</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/www/firefox</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>
    </sect2>

    <sect2>
      <title>Konqueror</title>

      <indexterm><primary><application>Konqueror</application></primary></indexterm>

      <para>O <application>Konqueror</application> é mais do que um navegador Web, pois também é um gerenciador de arquivos e um visualizador de multimídia. Suporta WebKit assim como seu próprio KHTML. WebKit é um motor de renderização usado por diversos navegadores modernos incluiindo o Chromium.</para>

      <para>O <application>Konqueror</application> pode ser instalado como um pacote digitando:</para>

      <screen><prompt>#</prompt> <userinput>pkg install konqueror</userinput></screen>

      <para>Para instalar a partir da Coleção de Ports:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/x11-fm/konqueror/</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>
    </sect2>

    <sect2>
      <title>Chromium</title>

      <indexterm><primary><application>Chromium</application></primary></indexterm>

      <para>O <application>Chromium</application> é um projeto de navegador de código aberto que visa criar uma experiência de navegação na Web mais segura, mais rápida e mais estável. O <application>Chromium</application> apresenta navegação com guias, bloqueio de pop-up, extensões e muito mais. O <application>Chromium</application> é o projeto de código-fonte aberto no qual o navegador Web do Google Chrome é baseado.</para>

      <para>O <application>Chromium</application> pode ser instalado como um pacote digitando:</para>

      <screen><prompt>#</prompt> <userinput>pkg install chromium</userinput></screen>

      <para>Alternativamente, o <application>Chromium</application> pode ser compilado a partir do código-fonte usando a Coleção de Ports:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/www/chromium</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>

      <note>
	<para>O executável do <application>Chromium</application> é <filename>/usr/local/bin/chrome</filename>, não <filename>/usr/local/bin/chromium</filename>.</para>
      </note>
    </sect2>
  </sect1>

  <sect1 xml:id="desktop-productivity">
    <title>Produtividade</title>

    <para>Quando se trata de produtividade, os usuários geralmente procuram uma suíte de escritório ou um processador de texto fácil de usar. Embora alguns <link linkend="x11-wm">ambientes de desktop</link> como o <application>KDE</application> forneçam uma suíte de escritório, não há um pacote de produtividade padrão. Várias suítes de escritório e processadores de texto gráficos estão disponíveis para o FreeBSD, independentemente do gerenciador de janelas instalado.</para>

    <para>Esta seção demonstra como instalar os seguintes softwares populares de produtividade e indica se o aplicativo é pesado em recursos, se leva tempo para compilar a partir do ports ou se possui dependências importantes.</para>

    <informaltable frame="none" pgwide="1">
      <tgroup cols="4">
	<thead>
	  <row>
	    <entry>Nome da aplicação</entry>
	    <entry>Recursos necessários</entry>
	    <entry>Instalação a partir do Ports</entry>
	    <entry>Principais Dependências</entry>
	  </row>
	</thead>

	<tbody>
	  <row>
	    <entry><application>Calligra</application></entry>
	    <entry>leve</entry>
	    <entry>pesado</entry>
	    <entry><application>KDE</application></entry>
	  </row>

	  <row>
	    <entry><application>AbiWord</application></entry>
	    <entry>leve</entry>
	    <entry>leve</entry>
	    <entry><application>Gtk+</application> ou <application>GNOME</application></entry>
	  </row>

	  <row>
	    <entry><application>The Gimp</application></entry>
	    <entry>leve</entry>
	    <entry>pesado</entry>
	    <entry><application>Gtk+</application></entry>
	  </row>

	  <row>
	    <entry><application>Apache OpenOffice</application></entry>
	    <entry>pesado</entry>
	    <entry>enorme</entry>
	    <entry><application><trademark>JDK</trademark></application> e <application>Mozilla</application></entry>
	  </row>

	  <row>
	    <entry><application>LibreOffice</application></entry>
	    <entry>um pouco pesado</entry>
	    <entry>enorme</entry>
	    <entry><application>Gtk+</application>, ou <application>KDE</application>/ <application>GNOME</application>, ou <application><trademark>JDK</trademark></application></entry>
	  </row>
	</tbody>
      </tgroup>
    </informaltable>

    <sect2>
      <title>Calligra</title>

      <indexterm><primary><application>Calligra</application></primary></indexterm>
      <indexterm><primary>office suite</primary> <secondary><application>Calligra</application></secondary></indexterm>

      <para>O ambiente de área de trabalho do KDE inclui uma suíte de escritório que pode ser instalada separadamente do <application>KDE</application>. O <application>Calligra</application> inclui componentes padrões que podem ser encontrados em outros pacotes de escritório. O <application>Words</application> é o processador de texto, <application>Sheets</application> é o programa de planilha eletrônica, o <application>Stage</application> gerencia apresentações de slides e <application>Karbon</application> é usado para desenhar documentos gráficos.</para>

      <para>No FreeBSD, o <package>editors/calligra</package> pode ser instalado como um pacote ou um port. Para instalar o pacote:</para>

      <screen><prompt>#</prompt> <userinput>pkg install calligra</userinput></screen>

      <para>Se o pacote não estiver disponível, use a Coleção de Ports:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/editors/calligra</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>
    </sect2>

    <sect2>
      <title>AbiWord</title>

      <indexterm><primary><application>AbiWord</application></primary></indexterm>

      <para>O <application>AbiWord</application> é um programa gratuito de processamento de texto semelhante em aparência ao <application><trademark class="registered">Microsoft</trademark> Word</application>. É rápido, contém muitos recursos e é de fácil utilização.</para>

      <para>O <application>AbiWord</application> pode importar ou exportar muitos formatos de arquivo, incluindo alguns formatos proprietários como o <trademark class="registered">Microsoft</trademark> <filename>.rtf</filename>.</para>

      <para>Para instalar o pacote do <application>AbiWord</application>:</para>

      <screen><prompt>#</prompt> <userinput>pkg install abiword</userinput></screen>

      <para>Se o pacote não estiver disponível, ele pode ser compilado a partir da Coleção de Ports:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/editors/abiword</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>
    </sect2>

    <sect2>
      <title>O GIMP</title>

      <indexterm><primary><application>The GIMP</application></primary></indexterm>

      <para>Para autoria ou retoque de imagens, o <application>GIMP</application> fornece um sofisticado programa de manipulação de imagens. Ele pode ser usado como um programa de pintura simples ou como um pacote de qualidade para retoque de fotos. Ele suporta um grande número de plugins e possui uma interface de script. O <application>GIMP</application> pode ler e gravar uma grande variedade de formatos de arquivos e suporta interfaces com scanners e tablets.</para>

      <para>Para instalar o pacote:</para>

      <screen><prompt>#</prompt> <userinput>pkg install gimp</userinput></screen>

      <para>Como alternativa, use a Coleção de Ports:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/graphics/gimp</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>

      <para>A categoria de programas gráficos (<link xlink:href="https://www.FreeBSD.org/ports/graphics.html">freebsd.org/ports/graphics.html</link>) da Coleção de Ports contém vários plugins relacionados ao <application>GIMP</application>, arquivos de ajuda e manuais do usuário.</para>

    </sect2>

    <sect2>
      <title>Apache OpenOffice</title>

      <indexterm><primary> <application>Apache OpenOffice</application> </primary></indexterm>
      <indexterm><primary>office suite</primary> <secondary> <application>Apache OpenOffice</application> </secondary></indexterm>

      <para>O <application>Apache OpenOffice</application> é uma suíte de escritório de código-fonte aberto que é desenvolvida sob a asa da Incubadora da Apache Software Foundation. Ele inclui todos os aplicativos encontrados em um pacote completo de produtividade de escritório: um processador de texto, uma planilha eletrônica, um gerenciador de apresentação e um programa de desenho. Sua interface de usuário é semelhante a outros pacotes de escritório e pode importar e exportar em vários formatos de arquivo populares. Está disponível em vários idiomas diferentes e a internacionalização foi estendida para interfaces, corretores ortográficos e dicionários.</para>

      <para>O processador de texto do <application>Apache OpenOffice</application> usa um formato de arquivo XML nativo para maior portabilidade e flexibilidade. O programa de planilha eletrônica possui uma linguagem de macros que pode ser conectada a bancos de dados externos. O <application>Apache OpenOffice</application> é estável e roda nativamente em <trademark class="registered">Windows</trademark>, <trademark>Solaris</trademark>, <trademark class="registered">Linux</trademark>, FreeBSD, e <trademark class="registered">Mac OS</trademark> X. Maiores informações sobre o <application>Apache OpenOffice</application> podem ser encontradas em <link xlink:href="http://openoffice.org/">openoffice.org</link>. Para informações específicas do FreeBSD, consulte <link xlink:href="http://porting.openoffice.org/freebsd/">porting.openoffice.org/freebsd/</link>.</para>

      <para>Para instalar o pacote <application>Apache OpenOffice</application>:</para>

      <screen><prompt>#</prompt> <userinput>pkg install apache-openoffice</userinput></screen>

      <para>Depois que o pacote for instalado, digite o seguinte comando para iniciar o <application>Apache OpenOffice</application>:</para>

      <screen><prompt>%</prompt> <userinput>openoffice-<replaceable>X.Y.Z</replaceable></userinput></screen>

      <para>onde <replaceable>X.Y.Z</replaceable> é o número da versão instalada do <application>Apache OpenOffice</application>. Na primeira vez que o <application>Apache OpenOffice</application> for iniciado, algumas perguntas serão feitas e uma pasta <filename>.openoffice.org</filename> será criada no diretório pessoal do usuário.</para>

      <para>Se o pacote do <application>Apache OpenOffice</application> desejado não estiver disponível, a compilação do port ainda será uma opção. No entanto, isso requer muito espaço em disco e um tempo bastante longo para compilar:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/editors/openoffice-4</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>

      <note>
	<para>Para compilar uma versão localizada, substitua o comando anterior por:</para>

	<screen><prompt>#</prompt> <userinput>make LOCALIZED_LANG=<replaceable>your_language</replaceable> install clean</userinput></screen>

	<para>Substitua <replaceable>your_language</replaceable> pelo código ISO do idioma correto. Uma lista de códigos de idiomas suportados está disponível em <filename>files/Makefile.localized</filename>, localizado no diretório do port.</para>
      </note>
    </sect2>

    <sect2>
      <title>LibreOffice</title>

      <indexterm><primary><application>LibreOffice</application></primary></indexterm>
      <indexterm><primary>office suite</primary> <secondary><application>LibreOffice</application></secondary></indexterm>

      <para>O <application>LibreOffice</application> é um pacote de software livre desenvolvido por <link xlink:href="http://www.documentfoundation.org/">documentfoundation.org</link>. É compatível com outras grandes suítes de escritórios e está disponível em diversas plataformas. Ele é um fork renomeado do <application>Apache OpenOffice</application> e inclui aplicativos encontrados em um pacote completo de produtividade de escritório: processador de texto, planilha, gerenciador de apresentação, programa de desenho, programa de gerenciamento de banco de dados e uma ferramenta para criar e editar fórmulas matemáticas. Está disponível em vários idiomas diferentes e a internacionalização foi estendida para interfaces, corretores ortográficos e dicionários.</para>

      <para>O processador de texto do <application>LibreOffice</application> usa um formato de arquivo XML nativo para maior portabilidade e flexibilidade. O programa de planilha eletrônica possui uma linguagem de macros que pode ser conectada a bancos de dados externos. O <application>LibreOffice</application> é estável e roda nativamente em <trademark class="registered">Windows</trademark>, <trademark class="registered">Linux</trademark>, FreeBSD e <trademark class="registered">Mac OS</trademark> X. Maiores informações sobre o <application>LibreOffice</application> podem ser encontradas em <link xlink:href="http://www.libreoffice.org/">libreoffice.org</link>.</para>

      <para>Para instalar a versão em inglês do pacote <application>LibreOffice</application>:</para>

      <screen><prompt>#</prompt> <userinput>pkg install libreoffice</userinput></screen>

      <para>A categoria de editores de texto (<link xlink:href="https://www.FreeBSD.org/ports/editors.html"> freebsd.org/ports/editors.html </link>) da Coleção de Ports contém várias versões versões localizadas do <application>LibreOffice</application>. Ao instalar um pacote localizado, substitua <literal>libreoffice</literal> pelo nome do pacote localizado.</para>

      <para>Quando o pacote estiver instalado, digite o seguinte comando para executar o <application>LibreOffice</application>:</para>

      <screen><prompt>%</prompt> <userinput>libreoffice</userinput></screen>

      <para>Durante a primeira execução, algumas perguntas serão feitas e uma pasta <filename>.libreoffice</filename> será criada no diretório pessoal do usuário.</para>

      <para>Se o pacote <application>LibreOffice</application> desejado não estiver disponível, a compilação do port ainda será uma opção. No entanto, isso requer muito espaço em disco e um tempo bastante longo para compilar. Este exemplo compila a versão em inglês:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/editors/libreoffice</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>

      <note>
	<para>Para compilar uma versão localizada, faça <command>cd</command> para o diretório do port do idioma desejado. Os idiomas suportados podem ser encontrados na categoria de editores (<link xlink:href="https://www.FreeBSD.org/ports/editors.html">freebsd.org/ports/editors.html</link>) da Coleção de Ports.</para>
      </note>
    </sect2>
  </sect1>

  <sect1 xml:id="desktop-viewers">
    <title>Visualizadores de Documentos</title>

    <para>Alguns novos formatos de documentos ganharam popularidade desde o advento do <trademark class="registered">UNIX</trademark> e os visualizadores que eles exigem podem não estar disponíveis no sistema base. Esta seção demonstra como instalar os seguintes visualizadores de documentos:</para>

    <informaltable frame="none" pgwide="1">
      <tgroup cols="4">
	<thead>
	  <row>
	    <entry>Nome da aplicação</entry>
	    <entry>Recursos necessários</entry>
	    <entry>Instalação a partir do Ports</entry>
	    <entry>Principais Dependências</entry>
	  </row>
	</thead>

	<tbody>
	  <row>
	    <entry><application>Xpdf</application></entry>
	    <entry>leve</entry>
	    <entry>leve</entry>
	    <entry><application>FreeType</application></entry>
	  </row>

	  <row>
	    <entry><application>gv</application></entry>
	    <entry>leve</entry>
	    <entry>leve</entry>
	    <entry><application>Xaw3d</application></entry>
	  </row>

	  <row>
	    <entry><application>Geeqie</application></entry>
	    <entry>leve</entry>
	    <entry>leve</entry>
	    <entry><application>Gtk+</application> ou <application>GNOME</application></entry>
	  </row>

	  <row>
	    <entry><application>ePDFView</application></entry>
	    <entry>leve</entry>
	    <entry>leve</entry>
	    <entry><application>Gtk+</application></entry>
	  </row>

	  <row>
	    <entry><application>Okular</application></entry>
	    <entry>leve</entry>
	    <entry>pesado</entry>
	    <entry><application>KDE</application></entry>
	  </row>
	</tbody>
      </tgroup>
    </informaltable>

    <sect2>
      <title>Xpdf</title>

      <indexterm><primary><application>Xpdf</application></primary></indexterm>
      <indexterm><primary>PDF</primary> <secondary>viewing</secondary></indexterm>

      <para>Para os usuários que preferem um pequeno visualizador de PDF do FreeBSD, o <application>Xpdf</application> fornece um visualizador leve e eficiente que requer poucos recursos. Ele usa as fontes X padrão e não requer nenhum kit de ferramentas adicional.</para>

      <para>Para instalar o pacote <application>Xpdf</application>:</para>

      <screen><prompt>#</prompt> <userinput>pkg install xpdf</userinput></screen>

      <para>Se o pacote não estiver disponível, use a Coleção de Ports:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/graphics/xpdf</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>

      <para>Quando a instalação estiver concluída, inicie o <command>xpdf</command> e use o botão direito do mouse para ativar o menu.</para>
    </sect2>

    <sect2>
      <title><application>gv</application></title>

      <indexterm><primary><application>gv</application></primary></indexterm>
      <indexterm><primary>PDF</primary> <secondary>viewing</secondary></indexterm>
      <indexterm><primary>PostScript</primary> <secondary>viewing</secondary></indexterm>

      <para>O <application>gv</application> é um visualizador de arquivos <trademark class="registered">PostScript</trademark> e PDF. Ele é baseado no <application>ghostview</application>, mas tem uma aparência mais agradável, pois é baseado no kit de ferramentas do widget <application>Xaw3d</application>. O <application>gv</application> possui muitos recursos configuráveis, como orientação, tamanho do papel, escala e anti-aliasing. Quase qualquer operação pode ser executada com o teclado ou com o mouse.</para>

      <para>Para instalar o <application>gv</application> como um pacote:</para>

      <screen><prompt>#</prompt> <userinput>pkg install gv</userinput></screen>

      <para>Se um pacote não estiver disponível, use a Coleção de Ports:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/print/gv</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>
    </sect2>

    <sect2>
      <title>Geeqie</title>

      <indexterm><primary><application>Geeqie</application></primary></indexterm>

      <para>O <application> Geeqie </application> é um fork do projeto abandonado <application>GQView</application>, em um esforço para levar o desenvolvimento adiante e integrar os patches existentes. O <application>Geeqie</application> é um gerenciador de imagens que suporta a visualização de um arquivo com um único clique, a execução de um editor externo e a visualização de miniaturas. Ele também possui um modo de apresentação de slides e algumas operações básicas de arquivo, facilitando o gerenciamento das coleções de imagens e a localização de arquivos duplicados. O <application>Geeqie</application> suporta visualização em tela cheia e a internacionalização.</para>

      <para>Para instalar o pacote <application>Geeqie</application>:</para>

      <screen><prompt>#</prompt> <userinput>pkg install geeqie</userinput></screen>

      <para>Se o pacote não estiver disponível, use a Coleção de Ports:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/graphics/geeqie</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>
    </sect2>

    <sect2>
      <title>ePDFView</title>

      <indexterm><primary><application>ePDFView</application></primary></indexterm>
      <indexterm><primary>PDF</primary> <secondary>viewing</secondary></indexterm>

      <para>O <application>ePDFView</application> é um visualizador de documentos <acronym>PDF</acronym> leve que usa somente as bibliotecas <application>Gtk+</application> e <application>Poppler</application>. Ele está atualmente em desenvolvimento, mas já abre a maioria dos arquivos <acronym>PDF</acronym> (até os criptografados), salva cópias de documentos e tem suporte para impressão usando o <application>CUPS</application>.</para>

      <para>Para instalar o <application>ePDFView</application> como um pacote:</para>

      <screen><prompt>#</prompt> <userinput>pkg install epdfview</userinput></screen>

      <para>Se um pacote não estiver disponível, use a Coleção de Ports:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/graphics/epdfview</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>
    </sect2>

    <sect2>
      <title>Okular</title>

      <indexterm><primary><application>Okular</application></primary></indexterm>
      <indexterm><primary><acronym>PDF</acronym></primary> <secondary>viewing</secondary></indexterm>

      <para>O <application>Okular</application> é um visualizador de documentos universal baseado no <application>KPDF</application> para <application>KDE</application>. Ele pode abrir muitos formatos de documentos, incluindo <acronym>PDF</acronym>, <trademark class="registered">PostScript</trademark>, DjVu, <acronym>CHM</acronym>, <acronym>XPS</acronym> e ePub.</para>

      <para>Para instalar o <application>Okular</application> como um pacote:</para>

      <screen><prompt>#</prompt> <userinput>pkg install okular</userinput></screen>

      <para>Se um pacote não estiver disponível, use a Coleção de Ports:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/graphics/okular</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>
    </sect2>
  </sect1>

  <sect1 xml:id="desktop-finance">
    <title>Finanças</title>

    <para>Para gerenciar finanças pessoais em um desktop FreeBSD, alguns aplicativos poderosos e fáceis de usar podem ser instalados. Alguns são compatíveis com formatos de arquivos comuns, como os formatos usados pelo <application>Quicken</application> e <application>Excel</application>.</para>

    <para>Esta seção cobre estes programas:</para>

    <informaltable frame="none" pgwide="1">
      <tgroup cols="4">
	<thead>
	  <row>
	    <entry>Nome da aplicação</entry>
	    <entry>Recursos necessários</entry>
	    <entry>Instalação a partir do Ports</entry>
	    <entry>Principais Dependências</entry>
	  </row>
	</thead>

	<tbody>
	  <row>
	    <entry><application>GnuCash</application></entry>
	    <entry>leve</entry>
	    <entry>pesado</entry>
	    <entry><application>GNOME</application></entry>
	  </row>

	  <row>
	    <entry><application>Gnumeric</application></entry>
	    <entry>leve</entry>
	    <entry>pesado</entry>
	    <entry><application>GNOME</application></entry>
	  </row>

	  <row>
	    <entry><application>KMyMoney</application></entry>
	    <entry>leve</entry>
	    <entry>pesado</entry>
	    <entry><application>KDE</application></entry>
	  </row>
	</tbody>
      </tgroup>
    </informaltable>

    <sect2>
      <title>GnuCash</title>

      <indexterm><primary><application>GnuCash</application></primary></indexterm>

      <para>O <application>GnuCash</application> faz parte do esforço do <application>GNOME</application> para fornecer aplicativos fáceis de usar, mas poderosos, para usuários finais. O <application>GnuCash</application> pode ser usado para acompanhar receitas e despesas, contas bancárias e ações. Ele apresenta uma interface intuitiva, mantendo-se profissional.</para>

      <para>O <application> GnuCash </application> fornece um registro inteligente, um sistema hierárquico de contas e muitos aceleradores de teclado e métodos de preenchimento automático. Ele pode dividir uma única transação em várias partes mais detalhadas. O <application>GnuCash</application> pode importar e mesclar arquivos QIF do <application>Quicken</application>. Ele também lida com a maioria dos formatos internacionais de data e moeda.</para>

      <para>Para instalar o pacote <application>GnuCash</application>:</para>

      <screen><prompt>#</prompt> <userinput>pkg install gnucash</userinput></screen>

      <para>Se o pacote não estiver disponível, use a Coleção de Ports:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/finance/gnucash</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>
    </sect2>

    <sect2>
      <title>Gnumeric</title>

      <indexterm><primary><application>Gnumeric</application></primary></indexterm>
      <indexterm><primary>spreadsheet</primary> <secondary><application>Gnumeric</application></secondary></indexterm>

      <para>O <application>Gnumeric</application> é um programa de planilha eletrônica desenvolvido pela comunidade <application>GNOME</application>. Ele possui adivinhação automática e conveniente de entrada do usuário de acordo com o formato da célula para muitas sequências. Ele pode importar arquivos em vários formatos populares, incluindo <application>Excel</application>, <application>Lotus 1-2-3</application> e <application>Quattro Pro</application>. Ele tem um grande número de funções internas e permite todos os formatos usuais de célula, como número, moeda, data, hora e muito mais.</para>

      <para>Para instalar o <application>Gnumeric</application> como um pacote:</para>

      <screen><prompt>#</prompt> <userinput>pkg install gnumeric</userinput></screen>

      <para>Se o pacote não estiver disponível, use a Coleção de Ports:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/math/gnumeric</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>
    </sect2>

    <sect2>
      <title>KMyMoney</title>

      <indexterm><primary><application>KMyMoney</application></primary></indexterm>

      <indexterm><primary>spreadsheet</primary> <secondary><application>KMyMoney</application></secondary></indexterm>

      <para>O <application>KMyMoney</application> é uma aplicação de finanças pessoais criada pela comunidade <application>KDE</application>. O <application>KMyMoney</application> tem como objetivo fornecer os recursos importantes encontrados em aplicativos comerciais de gerenciamento de finanças pessoais. Ele também destaca a facilidade de uso e a contabilidade adequada de dupla entrada entre seus recursos. O <application>KMyMoney</application> importa a partir de arquivos QIF padrão do <application>Quicken</application>, rastreia investimentos, manipula várias moedas e fornece diversos relatórios.</para>

      <para>Para instalar o <application>KMyMoney</application> como um pacote:</para>

      <screen><prompt>#</prompt> <userinput>pkg install kmymoney-kde4</userinput></screen>

      <para>Se o pacote não estiver disponível, use a Coleção de Ports:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/finance/kmymoney-kde4</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>
    </sect2>
  </sect1>
</chapter>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<chapter version="5.0" xml:id="multimedia">

  <info>
    <title>Multimídia</title>

    <authorgroup>
      <author><personname> <firstname>Ross</firstname> <surname>Lippert</surname> </personname> <contrib>Editado por </contrib></author>
    </authorgroup>
  </info>

  <sect1 xml:id="multimedia-synopsis">
    <title>Sinopse</title>

    <para>O FreeBSD suporta uma ampla variedade de placas de som, permitindo que os usuários aproveitem a saída de alta fidelidade de um sistema FreeBSD. Isso inclui a capacidade de gravar e reproduzir áudio MPEG Layer 3 (<acronym>MP3</acronym>), arquivo de áudio Waveform (<acronym>WAV</acronym>), Ogg Vorbis e outros formatos. A coleção de Ports do FreeBSD contém muitas aplicações para editar áudio gravado, adicionar efeitos sonoros e controlar dispositivos MIDI conectados.</para>

    <para>O FreeBSD também suporta a reprodução de arquivos de vídeo e <acronym>DVD</acronym>s. A coleção de Ports do FreeBSD contém aplicativos para codificar, converter e reproduzir várias mídias de vídeo.</para>

    <para>Este capítulo descreve como configurar placas de som, reprodução de vídeo, placas sintonizadoras de TV e scanners no FreeBSD. Também descreve algumas das aplicações que estão disponíveis para usar esses dispositivos.</para>

    <para>Depois de ler este capítulo, você irá saber como:</para>

    <itemizedlist>
      <listitem>
	<para>Configurar uma placa de som no FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Solucionar problemas de configuração de som.</para>
      </listitem>

      <listitem>
	<para>Reproduzir e codificar MP3 e outros áudios.</para>
      </listitem>

      <listitem>
	<para>Preparar um sistema FreeBSD para reprodução de vídeo.</para>
      </listitem>

      <listitem>
	<para>Reproduzir <acronym>DVD</acronym>s, arquivos <filename>.mpg</filename> e <filename>.avi</filename>.</para>
      </listitem>

      <listitem>
	<para>Copiar o conteúdo de um <acronym>CD</acronym> ou <acronym>DVD</acronym> em arquivos arquivos.</para>
      </listitem>

      <listitem>
	<para>Configurar uma placa de TV.</para>
      </listitem>

      <listitem>
	<para>Instale e configure o MythTV no FreeBSD</para>
      </listitem>

      <listitem>
	<para>Configurar um scanner de imagem.</para>
      </listitem>

      <listitem>
	<para>Configurar um headset Bluetooth.</para>
      </listitem>
    </itemizedlist>

    <para>Antes de ler este capítulo, você deve:</para>

    <itemizedlist>
      <listitem><para>Saber como instalar aplicativos conforme descrito em <xref linkend="ports"/>.</para></listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="sound-setup">
    <info>
      <title>Configurando a Placa de Som</title>

      <authorgroup>
	<author><personname> <firstname>Moses</firstname> <surname>Moore</surname> </personname> <contrib>Contribuido por</contrib></author>
      </authorgroup>

      <authorgroup>
	<author><personname> <firstname>Marc</firstname> <surname>Fonvieille</surname> </personname> <contrib>Aprimorado por</contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>PCI</primary></indexterm>
    <indexterm><primary>sound cards</primary></indexterm>
    <para>Antes de iniciar a configuração, determine o modelo da placa de som e o chip usado. O FreeBSD suporta uma ampla variedade de placas de som. Verifique a lista de dispositivos de áudio compatíveis nas <link xlink:href="https://www.FreeBSD.org/releases/12.0R/hardware.html">Notas de Hardware</link>, para ver se a placa de som é suportada e quais drivers do FreeBSD que ela usa.</para>

    <indexterm><primary>kernel</primary> <secondary>configuration</secondary></indexterm>

    <para>Para usar um dispositivo de som, seu driver deve ser carregado. A maneira mais fácil é carregar o módulo do kernel para a placa de som com o <citerefentry><refentrytitle>kldload</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Este exemplo carrega o driver para um chipset de áudio integrado baseado na especificação Intel:</para>

    <screen><prompt>#</prompt> <userinput>kldload snd_hda</userinput></screen>

    <para>Para automatizar o carregamento desse driver no momento da inicialização, faça edição adicionando a seguinte linha ao arquivo <filename>/boot/loader.conf</filename>:</para>

    <programlisting>snd_hda_load="YES"</programlisting>

    <para>Outros módulos de som disponíveis estão listados no arquivo <filename>/boot/defaults/loader.conf</filename>. Quando não tiver certeza de qual driver usar, carregue o módulo <filename>snd_driver</filename>:</para>

    <screen><prompt>#</prompt> <userinput>kldload snd_driver</userinput></screen>

    <para>Este é um metadriver que carrega todos os drivers de som mais comuns e pode ser usado para acelerar a busca pelo driver correto. Também é possível carregar todos os drivers de som adicionando o metadriver no arquivo <filename>/boot/loader.conf</filename>.</para>

    <para>Para determinar qual driver foi selecionado para a placa de som após carregar o metadriver <filename>snd_driver</filename>, digite, <command>cat /dev/sndstat</command>.</para>

    <sect2>
      <title>Configurando um kernel Personalizado com Suporte de Som</title>

      <para>Esta seção é para usuários que preferem compilar estaticamente em suporte para a placa de som em um kernel personalizado. Para mais informações sobre como recompilar um kernel, consulte <xref linkend="kernelconfig"/>.</para>

      <para>Ao usar um kernel personalizado para fornecer suporte ao som, verifique se o driver do framework de áudio existe no arquivo de configuração do kernel personalizado:</para>

      <programlisting>device sound</programlisting>

      <para>Em seguida, adicione suporte para a placa de som. Para continuar o exemplo do chipset de áudio integrado baseado na especificação Intel da seção anterior, use a seguinte linha no arquivo de configuração do kernel personalizado:</para>

      <programlisting>device snd_hda</programlisting>

      <para>Certifique-se de ler a página de manual do driver para o nome do dispositivo a ser usado pelo driver.</para>

      <para>Placas de som ISA não-PnP podem requerer que as configurações de porta IRQ e I/O da placa sejam adicionadas ao arquivo <filename>/boot/device.hints</filename>. Durante o processo de inicialização, o <citerefentry><refentrytitle>loader</refentrytitle><manvolnum>8</manvolnum></citerefentry> lê este arquivo e passa as configurações para o kernel. Por exemplo, uma placa antiga ISA não-PnP da Creative <trademark class="registered">SoundBlaster</trademark> usará o driver <citerefentry><refentrytitle>snd_sbc</refentrytitle><manvolnum>4</manvolnum></citerefentry> em conjunto com <literal>snd_sb16</literal>. Para esta placa, as seguintes linhas devem ser adicionadas ao arquivo de configuração do kernel:</para>

      <programlisting>device snd_sbc
device snd_sb16</programlisting>

      <para>Se a placa usar a porta de I/O <literal>0x220</literal> e a IRQ <literal>5</literal>, essas linhas também deverão ser adicionadas ao arquivo <filename>/boot/device.hints</filename>:</para>

      <programlisting>hint.sbc.0.at="isa"
hint.sbc.0.port="0x220"
hint.sbc.0.irq="5"
hint.sbc.0.drq="1"
hint.sbc.0.flags="0x15"</programlisting>

      <para>A sintaxe usada no arquivo <filename>/boot/device.hints</filename> é descrita em <citerefentry><refentrytitle>sound</refentrytitle><manvolnum>4</manvolnum></citerefentry> e na página de manual do driver da placa de som.</para>

      <para>As configurações mostradas acima são os padrões. Em alguns casos, a IRQ ou outras configurações podem precisar ser alterados para corresponder à placa. Consulte <citerefentry><refentrytitle>snd_sbc</refentrytitle><manvolnum>4</manvolnum></citerefentry> para obter mais informações sobre esta placa.</para>
    </sect2>

    <sect2 xml:id="sound-testing">
      <title>Testando o Som</title>

      <para>Depois de carregar o módulo necessário ou reinicializar no kernel personalizado, a placa de som deve ser detectada. Para confirmar, execute <command>dmesg | grep pcm</command>. Este exemplo é de um sistema com um chipset integrado Conexant CX20590:</para>

      <screen>pcm0: &lt;NVIDIA (0x001c) (HDMI/DP 8ch)&gt; at nid 5 on hdaa0
pcm1: &lt;NVIDIA (0x001c) (HDMI/DP 8ch)&gt; at nid 6 on hdaa0
pcm2: &lt;Conexant CX20590 (Analog 2.0+HP/2.0)&gt; at nid 31,25 and 35,27 on hdaa1</screen>

      <para>O status da placa de som também pode ser verificado usando este comando:</para>

      <screen><prompt>#</prompt> <userinput>cat /dev/sndstat</userinput>
FreeBSD Audio Driver (newpcm: 64bit 2009061500/amd64)
Installed devices:
pcm0: &lt;NVIDIA (0x001c) (HDMI/DP 8ch)&gt; (play)
pcm1: &lt;NVIDIA (0x001c) (HDMI/DP 8ch)&gt; (play)
pcm2: &lt;Conexant CX20590 (Analog 2.0+HP/2.0)&gt; (play/rec) default</screen>

      <para>A saída irá variar dependendo da placa de som. Se nenhum dispositivo <filename>pcm</filename> estiver listado, verifique se o driver de dispositivo correto foi carregado ou compilado no kernel. A próxima seção lista alguns problemas comuns e suas soluções.</para>

      <para>Se tudo correr bem, a placa de som deverá funcionar no FreeBSD. Se a unidade de <acronym>CD</acronym> ou <acronym>DVD</acronym> estiver corretamente conectada à placa de som, é possível inserir um <acronym>CD</acronym> de áudio na unidade e reproduzi-lo com <citerefentry><refentrytitle>cdcontrol</refentrytitle><manvolnum>1</manvolnum></citerefentry>:</para>

      <screen><prompt>%</prompt> <userinput>cdcontrol -f /dev/acd0 play 1</userinput></screen>

      <warning>
	<para><acronym>CD</acronym> de audio têm codificações especializadas, o que significa que não devem ser montados usando <citerefentry><refentrytitle>mount</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
      </warning>

      <para>Várias aplicações, como <package>audio/workman</package>, fornecem uma interface mais amigável. O Port <package>audio/mpg123</package> pode ser instalado para ouvir arquivos de áudio MP3.</para>

      <para>Outra maneira rápida de testar a placa é enviar dados para <filename>/dev/dsp</filename>:</para>

      <screen><prompt>%</prompt> <userinput>cat <replaceable>filename</replaceable> &gt; /dev/dsp</userinput></screen>

      <para>onde <filename><replaceable>filename</replaceable></filename> pode ser qualquer tipo de arquivo. Este comando deve produzir algum ruído, confirmando que a placa de som está funcionando.</para>

      <note>
	<para>Os nós de dispositivo <filename>/dev/dsp*</filename> serão criados automaticamente conforme necessário. Quando não estão em uso, eles não existem e não aparecerão na saída de <citerefentry><refentrytitle>ls</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</para>
      </note>
    </sect2>

    <sect2 xml:id="bluetooth-headset">
      <title>Configurando Dispositivos de Som Bluetooth</title>

      <indexterm><primary>Bluetooth audio</primary></indexterm>

      <para>Conectar a um dispositivo Bluetooth está fora do escopo deste capítulo. Consulte a <xref linkend="network-bluetooth"/> para mais informações.</para>

      <para>Para que o dispositivo Bluetooth funcione com o sistema de som do FreeBSD, os usuários precisam primeiramente instalar o <package>audio/virtual_oss</package>:</para>

      <screen><prompt>#</prompt> <userinput>pkg install virtual_oss</userinput></screen>

      <para><package>audio/virtual_oss</package> requer <literal>cuse</literal> para ser carregado no kernel:</para>

      <screen><prompt>#</prompt> <userinput>kldload cuse</userinput></screen>

      <para>Para carregar o <literal>cuse</literal> durante a inicialização do sistema, execute o comando:</para>

      <screen><prompt>#</prompt> <userinput>sysrc -f /boot/loader.conf cuse_load=yes</userinput></screen>

      <para>Para usar fones de ouvido como reprodutor de som com <package>audio/virtual_oss</package>, os usuários precisam criar um dispositivo virtual depois de se conectarem a um dispositivo de áudio Bluetooth:</para>

      <screen><prompt>#</prompt> <userinput>virtual_oss -C 2 -c 2 -r 48000 -b 16 -s 768 -R /dev/null -P /dev/bluetooth/<replaceable>headphones</replaceable> -d dsp</userinput></screen>

      <note>
	<para><replaceable>headphones</replaceable> neste exemplo é o nome de host de <filename>/etc/bluetooth/hosts</filename>. <literal>BT_ADDR</literal> também poderia ser usado.</para>
      </note>

      <para>Consulte <citerefentry vendor="ports"><refentrytitle>virtual_oss</refentrytitle><manvolnum>8</manvolnum></citerefentry> para mais informações.</para>
    </sect2>

    <sect2 xml:id="troubleshooting">
      <title>Solução de Problemas de Som</title>

      <indexterm><primary>device nodes</primary></indexterm>
      <indexterm><primary>I/O port</primary></indexterm>
      <indexterm><primary>IRQ</primary></indexterm>
      <indexterm><primary>DSP</primary></indexterm>

      <para><xref linkend="multimedia-sound-common-error-messages"/> lista algumas mensagens de erros comuns e suas soluções:</para>

      <table xml:id="multimedia-sound-common-error-messages" frame="none" pgwide="1">
	<title>Mensagens de Erros Comuns</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Erro</entry>
	      <entry>Solução</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><errorname>sb_dspwr(XX) timed out</errorname></entry>
	      <entry><para>A porta de I/O não está configurada corretamente.</para></entry>
	    </row>

	    <row>
	      <entry><errorname>bad irq XX</errorname></entry>
	      <entry><para>A IRQ está definida incorretamente. Certifique-se de que a IRQ definido e a IRQ do som são as mesmas.</para></entry>
	    </row>

	    <row>
	      <entry><errorname>xxx: gus pcm not attached, out of memory</errorname></entry>
	      <entry><para>Não há memória disponível suficiente para usar o dispositivo.</para></entry>
	    </row>

	    <row>
	      <entry><errorname>xxx: can't open /dev/dsp!</errorname></entry>
	      <entry><para>Digite <command>fstat | grep dsp</command> para verificar se outro aplicativo está mantendo o dispositivo aberto. Os causadores de problemas notáveis são o suporte a som do <application>esound</application> e do <application>KDE</application>.</para></entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Placas gráficas modernas geralmente vêm com seu próprio driver de som para uso com <acronym>HDMI</acronym>. Às vezes, esse dispositivo de som é enumerado antes da placa de som, o que significa que a placa de som não será usada como o dispositivo de reprodução padrão. Para verificar se este é o caso, execute <application>dmesg</application> e procure por <literal>pcm</literal>. A saída é algo como isto:</para>

      <programlisting>...
hdac0: HDA Driver Revision: 20100226_0142
hdac1: HDA Driver Revision: 20100226_0142
hdac0: HDA Codec #0: NVidia (Unknown)
hdac0: HDA Codec #1: NVidia (Unknown)
hdac0: HDA Codec #2: NVidia (Unknown)
hdac0: HDA Codec #3: NVidia (Unknown)
pcm0: &lt;HDA NVidia (Unknown) PCM #0 DisplayPort&gt; at cad 0 nid 1 on hdac0
pcm1: &lt;HDA NVidia (Unknown) PCM #0 DisplayPort&gt; at cad 1 nid 1 on hdac0
pcm2: &lt;HDA NVidia (Unknown) PCM #0 DisplayPort&gt; at cad 2 nid 1 on hdac0
pcm3: &lt;HDA NVidia (Unknown) PCM #0 DisplayPort&gt; at cad 3 nid 1 on hdac0
hdac1: HDA Codec #2: Realtek ALC889
pcm4: &lt;HDA Realtek ALC889 PCM #0 Analog&gt; at cad 2 nid 1 on hdac1
pcm5: &lt;HDA Realtek ALC889 PCM #1 Analog&gt; at cad 2 nid 1 on hdac1
pcm6: &lt;HDA Realtek ALC889 PCM #2 Digital&gt; at cad 2 nid 1 on hdac1
pcm7: &lt;HDA Realtek ALC889 PCM #3 Digital&gt; at cad 2 nid 1 on hdac1
...</programlisting>

      <para>Neste exemplo, a placa gráfica (<literal>NVidia</literal>) foi enumerada antes da placa de som (<literal>Realtek ALC889</literal>). Para usar a placa de som como o dispositivo de reprodução padrão, altere a variável <varname>hw.snd.default_unit</varname> para a unidade que deve ser usada para reprodução:</para>

      <screen><prompt>#</prompt> <userinput>sysctl hw.snd.default_unit=<replaceable>n</replaceable></userinput></screen>

      <para>onde <literal>n</literal> é o número do dispositivo de som a ser usado. Neste exemplo, deve ser <literal>4</literal>. Deixe esta mudança permanente adicionando a seguinte linha ao arquivo <filename>/etc/sysctl.conf</filename>:</para>

      <programlisting>hw.snd.default_unit=<replaceable>4</replaceable></programlisting>
    </sect2>

    <sect2 xml:id="sound-multiple-sources">
      <info>
	<title>Utilizando Múltiplas Fontes de Som</title>

	<authorgroup>
	  <author><personname> <firstname>Munish</firstname> <surname>Chopra</surname> </personname> <contrib>Contribuído por</contrib></author>
	</authorgroup>
      </info>

      <para>Muitas vezes é desejável ter várias fontes de som capazes de tocar simultaneamente. O FreeBSD usa <quote>Canais de Som Virtuais</quote> para multiplexar a reprodução da placa de som mixando o som no kernel.</para>

      <para>Três variáveis no <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> estão disponíveis para configurar canais virtuais:</para>

      <screen><prompt>#</prompt> <userinput>sysctl dev.pcm.0.play.vchans=4</userinput>
<prompt>#</prompt> <userinput>sysctl dev.pcm.0.rec.vchans=4</userinput>
<prompt>#</prompt> <userinput>sysctl hw.snd.maxautovchans=4</userinput></screen>

      <para>Este exemplo aloca quatro canais virtuais, que é um número prático para o uso diário. Ambos <varname>dev.pcm.0.play.vchans=4</varname> e <varname>dev.pcm.0.rec.vchans=4</varname> são configuráveis depois que um dispositivo foi anexado e representa o número de canais virtuais <filename>pcm0</filename> para reprodução e gravação. Como o módulo <filename>pcm</filename> pode ser carregado independentemente dos drivers de hardware, <varname>hw.snd.maxautovchans</varname> indica quantos canais virtuais serão dados a um dispositivo de áudio quando ele estiver conectado. Consulte <citerefentry><refentrytitle>pcm</refentrytitle><manvolnum>4</manvolnum> </citerefentry> para obter mais informações.</para>

      <note>
	<para>O número de canais virtuais para um dispositivo não pode ser alterado enquanto estiver em uso. Primeiramente, feche todos os programas usando o dispositivo, como players de música ou daemons de som.</para>
      </note>

      <para>O dispositivo <filename>pcm</filename> correto será automaticamente alocado de forma transparente para um programa que solicite <filename>/dev/dsp0</filename>.</para>
    </sect2>

    <sect2>
      <info>
	<title>Configurando Valores Padrões para Canais de Mixer</title>

	<authorgroup>
	  <author><personname> <firstname>Josef</firstname> <surname>El-Rayes</surname> </personname> <contrib>Contribuído por</contrib></author>
	</authorgroup>
      </info>

      <para>Os valores padrões para os diferentes canais do mixer são codificados permanentemente no código-fonte do driver <citerefentry><refentrytitle>pcm</refentrytitle><manvolnum>4</manvolnum></citerefentry>. Embora os níveis do mixer da placa de som possam ser alterados usando <citerefentry><refentrytitle>mixer</refentrytitle><manvolnum>8</manvolnum></citerefentry> ou aplicativos e daemons de terceiros, essa não é uma solução permanente. Para definir os valores padrões do mixer no nível do driver, defina os valores apropriados no arquivo <filename>/boot/device.hints</filename>, conforme mostrado neste exemplo:</para>

      <programlisting>hint.pcm.0.vol="50"</programlisting>

      <para>Isso definirá o canal de volume como um valor padrão de <literal>50</literal> quando o módulo <citerefentry><refentrytitle>pcm</refentrytitle><manvolnum>4</manvolnum></citerefentry> for carregado.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="sound-mp3">
    <info>
      <title>Áudio MP3</title>

      <authorgroup>
	<author><personname> <firstname>Chern</firstname> <surname>Lee</surname> </personname> <contrib>Contribuído por</contrib></author>
      </authorgroup>
    </info>

    <para>Esta seção descreve alguns players <acronym>MP3</acronym> disponíveis para o FreeBSD, como ripar trilhas de <acronym>CD</acronym> de áudio e como codificar e decodificar <acronym>MP3</acronym>.</para>

    <sect2 xml:id="mp3-players">
      <title>Players de MP3</title>

      <para>Um popular reprodutor gráfico de <acronym>MP3</acronym> é o <application>Audacious</application>. Ele suporta skins do <application>Winamp</application> e plugins adicionais. A interface é intuitiva, com uma lista de reprodução, equalizador gráfico e muito mais. Para aqueles que estão familiarizados com o <application>Winamp</application>, acharão o <application>Audacious</application> simples de usar. No FreeBSD, o <application>Audacious</application> pode ser instalado a partir de pacotes ou coleção de Ports <package>multimedia/audacious</package>. Audacious é descendente do XMMS.</para>

      <para>O pacote ou Port <package>audio/mpg123</package> fornece um reprodutor de <acronym>MP3</acronym> alternativo em linha de comando. Uma vez instalado, especifique o arquivo <acronym>MP3</acronym> para reproduzir na linha de comando. Se o sistema tiver vários dispositivos de áudio, o dispositivo de som também pode ser especificado:</para>

      <screen><prompt>#</prompt> <userinput>mpg123 <replaceable>-a /dev/dsp1.0 Foobar-GreatestHits.mp3</replaceable></userinput>
High Performance MPEG 1.0/2.0/2.5 Audio Player for Layers 1, 2 and 3
        version 1.18.1; written and copyright by Michael Hipp and others
        free software (LGPL) without any warranty but with best wishes

Playing MPEG stream from Foobar-GreatestHits.mp3 ...
MPEG 1.0 layer III, 128 kbit/s, 44100 Hz joint-stereo</screen>

      <para>Outros players <acronym>MP3</acronym> estão disponíveis na Coleção de Ports do FreeBSD.</para>
    </sect2>

    <sect2 xml:id="rip-cd">
      <title>Copiando Trilhas de <acronym>CD</acronym> de Áudio</title>

      <para>Antes de codificar um <acronym>CD</acronym> ou <acronym>CD</acronym> para <acronym>MP3</acronym>, os dados de áudio no <acronym>CD</acronym> devem ser copiados para o disco rígido. Isso é feito copiando os dados brutos do <acronym>CD</acronym> Digital Audio (<acronym>CDDA</acronym>) como arquivos <acronym>WAV</acronym>.</para>

      <para>A ferramenta <command>cdda2wav</command>, que é instalada com o suite de programas <package>sysutils/cdrtools</package>, pode ser usada para extrair informações de áudio do <acronym>CD</acronym>.</para>

      <para>Com o <acronym>CD</acronym> de áudio na unidade, o seguinte comando pode ser executado como <systemitem class="username">root</systemitem> para ripar um <acronym>CD</acronym> inteiro em arquivos <acronym>WAV</acronym>, por trilhas:</para>

      <screen><prompt>#</prompt> <userinput>cdda2wav -D <replaceable>0,1,0</replaceable> -B</userinput></screen>

      <para>Neste exemplo, o <option>-D <replaceable>0,1,0</replaceable></option> indica o dispositivo <acronym>SCSI</acronym> <filename>0,1,0</filename> contendo o <acronym>CD</acronym> para ripar. Use o comando <command>cdrecord -scanbus</command> para determinar os parâmetros corretos do dispositivo para o sistema.</para>

      <para>Para ripar trilhas individuais, use a opção <option>-t</option> para especificar a trilha:</para>

      <screen><prompt>#</prompt> <userinput>cdda2wav -D <replaceable>0,1,0</replaceable> -t 7</userinput></screen>

      <para>Para extrair um intervalo de trilhas, como as trilhas de um a sete, especifique um intervalo:</para>

      <screen><prompt>#</prompt> <userinput>cdda2wav -D <replaceable>0,1,0</replaceable> -t 1+7</userinput></screen>

      <para>Para extrair de uma unidade <acronym>ATAPI</acronym>(<acronym>IDE</acronym>)  <acronym>CDROM</acronym>, especifique o nome do dispositivo no lugar dos números da unidade <acronym>SCSI</acronym>. Por exemplo, para extrair a trilha 7 de uma unidade IDE:</para>

      <screen><prompt>#</prompt> <userinput>cdda2wav -D <replaceable>/dev/acd0 -t 7</replaceable></userinput></screen>

      <para>Alternativamente, o comando <command>dd</command> pode ser usado para extrair trilhas de áudio em unidades <acronym>ATAPI</acronym>, conforme descrito em <xref linkend="duplicating-audiocds"/>.</para>
    </sect2>

    <sect2 xml:id="mp3-encoding">
      <title>Codificação e Decodificação de MP3</title>

      <para><application>Lame</application> é um codificador popular para <acronym>MP3</acronym> que pode ser instalado a partir do port <package>audio/lame</package>. Devido a problemas de patente, o pacote não está disponível.</para>

      <para>O comando a seguir converterá o arquivo <acronym>WAV</acronym> <filename><replaceable>audio01.wav</replaceable></filename> para <filename><replaceable>audio01.mp3</replaceable></filename>:</para>

      <screen><prompt>#</prompt> <userinput>lame -h -b <replaceable>128</replaceable> --tt "<replaceable>Foo Song Title</replaceable>" --ta "<replaceable>FooBar Artist</replaceable>" --tl "<replaceable>FooBar Album</replaceable>" \
--ty "<replaceable>2014</replaceable>" --tc "<replaceable>Ripped and encoded by Foo</replaceable>" --tg "<replaceable>Genre</replaceable>" <replaceable>audio01.wav audio01.mp3</replaceable></userinput></screen>

      <para>Os 128 kbits especificados são uma taxa de bits padrão para <acronym>MP3</acronym>, enquanto as taxas de bits 160 e 192 fornecem maior qualidade. Quanto maior a taxa de bits, maior o tamanho do arquivo <acronym>MP3</acronym> resultante. A opção <option>-h</option> ativa o modo <quote> de maior qualidade, mas um pouco mais lento </quote>. As opções que começam com <option>--t</option> indicam as tags <acronym>ID3</acronym>, que geralmente contêm informações sobre músicas, para serem incorporadas no arquivo <acronym>MP3</acronym>. Opções adicionais de codificação podem ser encontradas na página de manual do <application>lame</application>.</para>

      <para>Para gravar um <acronym>CD</acronym> de áudio usando arquivos <acronym>MP3</acronym>, primeiro estes devem ser convertidos em um formato de arquivo não compactado. O <application>XMMS</application> pode ser usado para converter para o formato <acronym>WAV</acronym>, enquanto o <application>mpg123</application> pode ser usado para converter para o formato de dados de áudio bruto, Pulse Code Modulation (<acronym>PCM</acronym>).</para>

      <para>Para converter o arquivo <filename>audio01.mp3</filename> usando <application>mpg123</application>, especifique o nome do arquivo <acronym>PCM</acronym>:</para>

      <screen><prompt>#</prompt> <userinput>mpg123 -s <replaceable>audio01.mp3</replaceable> &gt; <replaceable>audio01.pcm</replaceable></userinput></screen>

      <para>Para usar <application>XMMS</application> para converter um arquivo <acronym>MP3</acronym> para <acronym>WAV</acronym>, use esses passos:</para>

      <procedure>
	<title>Convertendo para o Formato <acronym>WAV</acronym> no <application>XMMS</application></title>

	<step>
	  <para>Inicie o <application>XMMS</application>.</para>
	</step>

	<step>
	  <para>Clique com o botão direito do mouse na janela para abrir o menu <application>XMMS</application>.</para>
	</step>

	<step>
	  <para>Selecione <literal>Preferences</literal> abaixo de <literal>Options</literal>.</para>
	</step>

	<step>
	  <para>Altere o Plugin de Saída para <quote>Disk Writer Plugin</quote>.</para>
	</step>

	<step>
	  <para>Pressione <literal>Configure</literal>.</para>
	</step>

	<step>
	  <para>Digite ou procure um diretório para gravar os arquivos descompactados.</para>
	</step>

	<step>
	  <para>Carregue o arquivo <acronym>MP3</acronym> no <application>XMMS</application> como de costume, com o volume em 100% e as configurações de EQ desativadas.</para>
	</step>

	<step>
	  <para>Pressione <literal>Play</literal>. O <application>XMMS</application> aparecerá como se estivesse tocando o <acronym>MP3</acronym>, mas nenhuma música será ouvida. Na verdade, está tocando o <acronym>MP3</acronym> para um arquivo.</para>
	</step>

	<step>
	  <para>Quando terminar, certifique-se de ajustar o Plugin de Saída padrão de volta ao que era antes para ouvir <acronym>MP3</acronym> novamente.</para>
	</step>
      </procedure>

      <para>Os formatos <acronym>WAV</acronym> e <acronym>PCM</acronym> podem ser usados com <application>cdrecord</application>. Ao usar arquivos <acronym>WAV</acronym>, haverá um pequeno som no início de cada trilha. Este som é o cabeçalho do arquivo <acronym>WAV</acronym>. O pacote binário ou port <package>audio/sox</package> pode ser usado para remover o cabeçalho:</para>

      <screen><prompt>%</prompt> <userinput>sox -t wav -r 44100 -s -w -c 2 <replaceable>track.wav track.raw</replaceable></userinput></screen>

      <para>Consulte <xref linkend="creating-cds"/> para mais informações sobre o uso de um gravador de <acronym>CD</acronym> no FreeBSD.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="video-playback">
    <info>
      <title>Reprodução de Vídeo</title>

      <authorgroup>
	<author><personname> <firstname>Ross</firstname> <surname>Lippert</surname> </personname> <contrib>Contribuído por</contrib></author>
      </authorgroup>
    </info>

    <para>Antes de configurar a reprodução de vídeo, determine o modelo e o chipset da placa de vídeo. Embora o <application>Xorg</application> suporte uma ampla variedade de placas de vídeo, nem todas oferecem um bom desempenho de reprodução. Para obter uma lista de extensões suportadas pelo servidor <application>Xorg</application> usando a placa, execute <command>xdpyinfo</command> enquanto o <application>Xorg</application> está sendo executado.</para>

    <para>É interessante ter um arquivo de teste MPEG pequeno para avaliar vários players e opções. Como alguns aplicativos de <acronym>DVD</acronym> procuram por mídia <acronym>DVD</acronym> em <filename>/dev/dvd</filename> por padrão, ou possuem esse nome de dispositivo codificado neles, pode ser útil fazer um link simbólico para o dispositivo adequado:</para>

    <screen><prompt>#</prompt> <userinput>ln -sf /dev/cd0 /dev/dvd</userinput></screen>

    <para>Devido à natureza do <citerefentry vendor="current"><refentrytitle>devfs</refentrytitle><manvolnum>5</manvolnum></citerefentry>, os links criados manualmente não persistirão após a reinicialização do sistema. Para recriar o link simbólico automaticamente quando o sistema inicializar, adicione a seguinte linha ao arquivo <filename>/etc/devfs.conf</filename>:</para>

    <programlisting>link cd0 dvd</programlisting>

    <para>A decriptografia do <acronym>DVD</acronym> invoca certas funções que exigem permissão de gravação para o dispositivo <acronym>DVD</acronym>.</para>

    <para>Para melhorar a interface de memória compartilhada do <application>Xorg</application>, recomenda-se aumentar os valores dessas variáveis <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>:</para>

    <programlisting>kern.ipc.shmmax=67108864
kern.ipc.shmall=32768</programlisting>

    <sect2 xml:id="video-interface">
      <title>Determinando os Recursos de Vídeo</title>

      <indexterm><primary>XVideo</primary></indexterm>
      <indexterm><primary>SDL</primary></indexterm>
      <indexterm><primary>DGA</primary></indexterm>

      <para>Existem várias maneiras possíveis de exibir vídeo no <application>Xorg</application> e o que funciona é, em grande parte, dependente de hardware. Cada método descrito abaixo terá qualidade variável em diferentes hardwares.</para>

      <para>Interfaces de vídeo comuns incluem:</para>

      <orderedlist>
	<listitem>
	  <para><application>Xorg</application>: saída normal usando memória compartilhada.</para>
	</listitem>

	<listitem>
	  <para>XVideo: uma extensão para a interface <application>Xorg</application> que permite que o vídeo seja exibido diretamente em objetos que podem ser desenhados através de uma aceleração especial. Esta extensão oferece reprodução de boa qualidade, mesmo em máquinas de baixo custo. A próxima seção descreve como determinar se esta extensão está sendo executada.</para>
	</listitem>

	<listitem>
	  <para><acronym>SDL</acronym>: Simple Directmedia Layer é uma camada de portabilidade para muitos sistemas operacionais, permitindo o desenvolvimento de aplicativos multiplataforma que fazem uso eficiente de som e gráficos. O <acronym>SDL</acronym> fornece uma abstração de baixo nível para o hardware, que às vezes pode ser mais eficiente que a interface do <application>Xorg</application>. No FreeBSD, o <acronym>SDL</acronym> pode ser instalado usando o pacote ou port <package>devel/sdl20</package>.</para>
	</listitem>

	<listitem>
	  <para><acronym>DGA</acronym>: Direct Graphics Access é uma extensão do <application>Xorg</application> que permite que um programa contorne o servidor <application>Xorg</application> e altere diretamente o quadro de buffer. Como ele depende de um mapeamento de memória de baixo nível, os programas que o utilizam devem ser executados como <systemitem class="username">root</systemitem>. A extensão <acronym>DGA</acronym> pode ser testada e comparada usando <citerefentry vendor="xfree86"><refentrytitle>dga</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Quando o <command>dga</command> está em execução, ele altera as cores do display sempre que uma tecla é pressionada. Para sair, pressione <keycap>q</keycap>.</para>
	</listitem>

	<listitem>
	  <para>SVGAlib: uma camada gráfica de console de baixo nível.</para>
	</listitem>
      </orderedlist>

      <sect3 xml:id="video-interface-xvideo">
	<title>XVideo</title>

	<para>Para verificar se esta extensão está em execução, use <command>xvinfo</command>:</para>

	<screen><prompt>%</prompt> <userinput>xvinfo</userinput></screen>

	<para>O XVideo é suportado pela placa de vídeo se o resultado for semelhante a:</para>

	<screen>X-Video Extension version 2.2
  screen #0
  Adaptor #0: "Savage Streams Engine"
    number of ports: 1
    port base: 43
    operations supported: PutImage
    supported visuals:
      depth 16, visualID 0x22
      depth 16, visualID 0x23
    number of attributes: 5
      "XV_COLORKEY" (range 0 to 16777215)
              client settable attribute
              client gettable attribute (current value is 2110)
      "XV_BRIGHTNESS" (range -128 to 127)
              client settable attribute
              client gettable attribute (current value is 0)
      "XV_CONTRAST" (range 0 to 255)
              client settable attribute
              client gettable attribute (current value is 128)
      "XV_SATURATION" (range 0 to 255)
              client settable attribute
              client gettable attribute (current value is 128)
      "XV_HUE" (range -180 to 180)
              client settable attribute
              client gettable attribute (current value is 0)
    maximum XvImage size: 1024 x 1024
    Number of image formats: 7
      id: 0x32595559 (YUY2)
        guid: 59555932-0000-0010-8000-00aa00389b71
        bits per pixel: 16
        number of planes: 1
        type: YUV (packed)
      id: 0x32315659 (YV12)
        guid: 59563132-0000-0010-8000-00aa00389b71
        bits per pixel: 12
        number of planes: 3
        type: YUV (planar)
      id: 0x30323449 (I420)
        guid: 49343230-0000-0010-8000-00aa00389b71
        bits per pixel: 12
        number of planes: 3
        type: YUV (planar)
      id: 0x36315652 (RV16)
        guid: 52563135-0000-0000-0000-000000000000
        bits per pixel: 16
        number of planes: 1
        type: RGB (packed)
        depth: 0
        red, green, blue masks: 0x1f, 0x3e0, 0x7c00
      id: 0x35315652 (RV15)
        guid: 52563136-0000-0000-0000-000000000000
        bits per pixel: 16
        number of planes: 1
        type: RGB (packed)
        depth: 0
        red, green, blue masks: 0x1f, 0x7e0, 0xf800
      id: 0x31313259 (Y211)
        guid: 59323131-0000-0010-8000-00aa00389b71
        bits per pixel: 6
        number of planes: 3
        type: YUV (packed)
      id: 0x0
        guid: 00000000-0000-0000-0000-000000000000
        bits per pixel: 0
        number of planes: 0
        type: RGB (packed)
        depth: 1
        red, green, blue masks: 0x0, 0x0, 0x0</screen>

	<para>Os formatos listados, como YUV2 e YUV12, não estão presentes em todas as implementações do XVideo e sua ausência pode atrapalhar alguns players.</para>

	<para>Se o resultado, ao invés disso, se parecer com:</para>

	<screen>X-Video Extension version 2.2
screen #0
no adaptors present</screen>

	<para>O XVideo provavelmente não é compatível com a placa. Isso significa que será mais difícil para o monitor atender às demandas computacionais de renderização de vídeo, dependendo da placa de vídeo e do processador.</para>
      </sect3>
    </sect2>

    <sect2 xml:id="video-ports">
      <title>Ports e Pacotes Lidando com Vídeo</title>

      <indexterm><primary>video ports</primary></indexterm>
      <indexterm><primary>video packages</primary></indexterm>

      <para>Esta seção apresenta alguns dos softwares disponíveis na Coleção de Ports do FreeBSD, que podem ser usados para reprodução de vídeo.</para>

      <sect3 xml:id="video-mplayer">
	<title><application>MPlayer</application> e <application>MEncoder</application></title>

	<para>O <application>MPlayer</application> é um reprodutor de vídeo em linha de comando com uma interface gráfica opcional que visa oferecer velocidade e flexibilidade. Outros front-ends gráficos para o <application>MPlayer</application> estão disponíveis na Coleção de Ports do FreeBSD.</para>

	<indexterm><primary>MPlayer</primary></indexterm>

	<para>O <application>MPlayer</application> pode ser instalado usando o pacote ou port <package>multimedia/mplayer</package>. Várias opções de compilação estão disponíveis e uma variedade de verificações de hardware ocorre durante o processo de compilação. Por esses motivos, alguns usuários preferem compilar um port ao invés de instalar o pacote.</para>

	<para>Ao compilar o port, as opções do menu devem ser revisadas para determinar o tipo de suporte a ser compilado no port. Se uma opção não estiver selecionada, o <application>MPlayer</application> não poderá exibir esse tipo de formato de vídeo. Use as setas e a barra de espaço para selecionar os formatos necessários. Quando terminar, pressione <keycap>Enter</keycap> para continuar a compilação e instalação do port.</para>

	<para>Por padrão, o pacote ou port construirá o utilitário de linha de comando <command>mplayer</command> e o utilitário gráfico <command>gmplayer</command>. Para codificar vídeos, compile o port <package>multimedia/mencoder</package>. Devido a restrições de licenciamento, um pacote não está disponível para o <application>MEncoder</application>.</para>

	<para>A primeira vez que o <application>MPlayer</application> for executado, ele criará um arquivo  <filename>~/.mplayer</filename> no diretório pessoal do usuário. Esse subdiretório contém versões padrões dos arquivos de configurações específicos do usuário.</para>

	<para>Esta seção descreve apenas alguns usos comuns. Consulte o mplayer(1) para uma descrição completa de suas inúmeras opções.</para>

	<para>Para reproduzir o arquivo <filename><replaceable>testfile.avi</replaceable></filename>, especifique as interfaces de vídeo com <option>-vo</option>, conforme mostrado nos exemplos a seguir:</para>

	<screen><prompt>%</prompt> <userinput>mplayer -vo xv <replaceable>testfile.avi</replaceable></userinput></screen>

	<screen><prompt>%</prompt> <userinput>mplayer -vo sdl <replaceable>testfile.avi</replaceable></userinput></screen>

	<screen><prompt>%</prompt> <userinput>mplayer -vo x11 <replaceable>testfile.avi</replaceable></userinput></screen>

	<screen><prompt>#</prompt> <userinput>mplayer -vo dga <replaceable>testfile.avi</replaceable></userinput></screen>

	<screen><prompt>#</prompt> <userinput>mplayer -vo 'sdl:dga' <replaceable>testfile.avi</replaceable></userinput></screen>

	<para>Vale a pena tentar todas essas opções, pois seu relativo desempenho depende de muitos fatores e varia significativamente com o hardware.</para>

	<para>Para reproduzir um <acronym>DVD</acronym>, substitua <filename><replaceable>testfile.avi</replaceable></filename> por <option>dvd://<replaceable>N</replaceable> -dvd-device <replaceable>DEVICE</replaceable></option>, em que <replaceable>N</replaceable> é o número do título a ser reproduzido e <replaceable>DEVICE</replaceable> é o nó do dispositivo para o <acronym>DVD</acronym>. Por exemplo, para reproduzir o filme 3 de <filename>/dev/dvd</filename>:</para>

	<screen><prompt>#</prompt> <userinput>mplayer -vo xv dvd://3 -dvd-device /dev/dvd</userinput></screen>

	<note>
	  <para>O dispositivo padrão de <acronym>DVD</acronym> pode ser definido durante a construção do port <application>MPlayer</application> incluindo a opção <varname>WITH_DVD_DEVICE=/path/to/desired/device</varname>. Por padrão, o dispositivo é <filename>/dev/cd0</filename>. Mais detalhes podem ser encontrados no <filename>Makefile.options</filename> do port.</para>
	</note>

	<para>Para parar, pausar, avançar e assim por diante, use uma tecla de atalho. Para ver a lista de atalhos de teclado, execute <command>mplayer -h</command> ou leia o mplayer (1).</para>

	<para>Opções de reprodução adicionais incluem <option>-fs -zoom</option>, que ativa o modo de tela cheia e <option>-framedrop</option>, o que ajuda no desempenho.</para>

	<para>Cada usuário pode adicionar opções comumente usadas ao seu <filename>~/.mplayer/config</filename> assim:</para>

	<programlisting>vo=xv
fs=yes
zoom=yes</programlisting>

	<para>O <command>mplayer</command> pode ser usado para copiar um filme de <acronym>DVD</acronym> para um arquivo <filename>.vob</filename>. Para gravar o filme em um segundo <acronym>DVD</acronym>:</para>

	<screen><prompt>#</prompt> <userinput>mplayer -dumpstream -dumpfile out.vob dvd://2 -dvd-device /dev/dvd</userinput></screen>

	<para>O arquivo de saída, <filename>out.vob</filename>, estará no formato <acronym>MPEG</acronym>.</para>

	<para>Qualquer pessoa que deseje obter um alto nível de experiência com vídeo <trademark class="registered">UNIX</trademark> deve consultar <link xlink:href="http://www.mplayerhq.hu/DOCS/">mplayerhq.hu/DOCS</link>. Como é tecnicamente informativa, esta documentação deve ser considerada como leitura obrigatória antes de enviar qualquer relatório de bug.</para>

	<indexterm><primary>mencoder</primary></indexterm>

	<para>Antes de usar o <command>mencoder</command>, é interessante familiarizar-se com as opções descritas em <link xlink:href="http://www.mplayerhq.hu/DOCS/HTML/en/mencoder.html">mplayerhq.hu/DOCS/HTML/en/mencoder.html</link>. Existem inúmeras maneiras de melhorar a qualidade, diminuir a taxa de bits e alterar os formatos, e algumas dessas opções podem fazer a diferença entre bom ou mau desempenho. Combinações impróprias de opções de linha de comando podem produzir arquivos de saída que não podem ser reproduzidos até mesmo por <command>mplayer</command>.</para>

	<para>Aqui está um exemplo de uma cópia simples:</para>

	<screen><prompt>%</prompt> <userinput>mencoder <replaceable>input.avi</replaceable> -oac copy -ovc copy -o <replaceable>output.avi</replaceable></userinput></screen>

	<para>Para copiar para um arquivo, use <option>-dumpfile</option> com o <command>mplayer</command>.</para>

	<para>Para converter <filename><replaceable>input.avi</replaceable></filename> para o codec MPEG4 com codificação de áudio MPEG3, primeiro instale o port <package>audio/lame</package>. Devido a restrições de licenciamento, um pacote não está disponível. Uma vez instalado, digite:</para>

	<screen><prompt>%</prompt> <userinput>mencoder <replaceable>input.avi</replaceable> -oac mp3lame -lameopts br=192 \
	 -ovc lavc -lavcopts vcodec=mpeg4:vhq -o <replaceable>output.avi</replaceable></userinput></screen>

	<para>Isso produzirá uma saída reproduzível por aplicativos como <command>mplayer</command> e <command>xine</command>.</para>

	<para><filename><replaceable>input.avi</replaceable></filename> pode ser substituído por <option>dvd://1 -dvd-device /dev/dvd</option> e executado como <systemitem class="username">root</systemitem> para recodificar um filme de <acronym>DVD</acronym> diretamente. Como pode levar algumas tentativas para obter o resultado desejado, recomenda-se gravar o arquivo de um filme e trabalhar nele.</para>
      </sect3>

      <sect3 xml:id="video-xine">
	<title>O Player (reprodutor) de Vídeo <application>xine</application></title>

	<para>O <application>xine</application> é um reprodutor de vídeo com uma biblioteca base reutilizável e um executável modular que pode ser estendido com plug-ins. Pode ser instalado usando o pacote ou port <package>multimedia/xine</package>.</para>

	<para>Na prática, o <application>xine</application> requer uma CPU rápida com uma placa de vídeo rápida ou suporte para a extensão XVideo. O player de vídeo <application>xine</application> apresenta melhor desempenho nas interfaces XVideo.</para>

	<para>Por padrão, o player <application>xine</application> inicia uma interface gráfica com o usuário. Os menus podem então ser usados para abrir um arquivo específico.</para>

	<para>Alternativamente, o <application>xine</application> pode ser executado a partir da linha de comando, especificando o nome do arquivo a ser reproduzido:</para>

	<screen><prompt>%</prompt> <userinput>xine -g -p <replaceable>mymovie.avi</replaceable></userinput></screen>

	<para>Consulte <link xlink:href="http://www.xine-project.org/faq">xine-project.org/faq</link> para mais informações e dicas de solução de problemas.</para>
      </sect3>

      <sect3 xml:id="video-ports-transcode">
	<title>As Utilidades do <application>Transcode</application></title>

	<para>O <application>Transcode</application> fornece um conjunto de ferramentas para recodificar arquivos de vídeo e áudio. O <application>Transcode</application> pode ser usado para mesclar arquivos de vídeo ou reparar arquivos quebrados usando ferramentas de linha de comando com interfaces de fluxo stdin/stdout.</para>

	<para>No FreeBSD, o <application>Transcode</application> pode ser instalado usando o pacote ou port <package>multimedia/transcode</package>. Muitos usuários preferem compilar o port, pois fornece um menu de opções de compilação para especificar o suporte e os codecs a serem compilados. Se uma opção não for selecionada, o <application>Transcode</application> não poderá codificar esse formato. Use as setas e a barra de espaço para selecionar os formatos necessários. Quando terminar, pressione <keycap>Enter</keycap> para continuar a compilação e instalação do port.</para>

	<para>Este exemplo demonstra como converter um arquivo DivX em um arquivo PAL MPEG-1 (PAL VCD):</para>

	<screen><prompt>%</prompt> <userinput>transcode -i <replaceable>input.avi</replaceable> -V --export_prof vcd-pal -o output_vcd</userinput>
<prompt>%</prompt> <userinput>mplex -f 1 -o <replaceable>output_vcd.mpg output_vcd.m1v output_vcd.mpa</replaceable></userinput></screen>

	<para>O arquivo <acronym>MPEG</acronym> resultante, <filename><replaceable>output_vcd.mpg</replaceable></filename>, está pronto para ser executado com o <application>MPlayer</application>. O arquivo pode ser gravado em uma mídia (<acronym>CD</acronym>), para criar um <acronym>CD</acronym> de vídeo usando um utilitário como <package>multimedia/vcdimager</package> ou <package>sysutils/cdrdao</package>.</para>

	<para>Além da página de manual do <command>transcode</command>, consulte  <link xlink:href="http://www.transcoding.org/cgi-bin/transcode">transcoding.org/cgi-bin/transcode</link> para mais informações e exemplos.</para>
      </sect3>
    </sect2>
  </sect1>

  <sect1 xml:id="tvcard">
    <info>
      <title>Placas de TV</title>

      <authorgroup>
	<author><personname> <firstname>Josef</firstname> <surname>El-Rayes</surname> </personname> <contrib>Contribuição original por </contrib></author>
      </authorgroup>

      <authorgroup>
	<author><personname> <firstname>Marc</firstname> <surname>Fonvieille</surname> </personname> <contrib>Aprimorado e adaptado por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>TV cards</primary></indexterm>

    <para>As placas de TV podem ser usadas para assistir à transmissão ou à TV a cabo em um computador. A maioria das placas aceitam vídeo composto por meio de uma entrada <acronym>RCA</acronym> ou S-video e algumas placas incluem um sintonizador de rádio <acronym>FM</acronym>.</para>

    <para>O FreeBSD fornece suporte para placas de TV baseadas em PCI usando um chip de captura de vídeo Brooktree Bt848/849/878/879 com o driver <citerefentry><refentrytitle>bktr</refentrytitle><manvolnum>4</manvolnum></citerefentry>. Este driver suporta a maioria das placas de vídeo Pinnacle PCTV. Antes de comprar uma placa de TV, consulte <citerefentry><refentrytitle>bktr</refentrytitle><manvolnum>4</manvolnum></citerefentry> para obter uma lista dos sintonizadores suportados.</para>

    <sect2>
      <title>Carregando o Driver</title>

      <para>Para usar a placa, o driver <citerefentry><refentrytitle>bktr</refentrytitle><manvolnum>4</manvolnum></citerefentry> deve ser carregado. Para automatizar isso no momento da inicialização, adicione a seguinte linha ao arquivo <filename>/boot/loader.conf</filename>:</para>

      <programlisting>bktr_load="YES"</programlisting>

      <para>Como alternativa, pode-se compilar estaticamente o suporte para a placa de TV em um kernel personalizado. Nesse caso, adicione as seguintes linhas ao arquivo de configuração do kernel personalizado:</para>

      <programlisting>device	 bktr
device	iicbus
device	iicbb
device	smbus</programlisting>

      <para>Esses dispositivos adicionais são necessários, pois os componentes da placa são interconectados por meio de um barramento I2C. Em seguida, crie e instale um novo kernel.</para>

      <para>Para testar se o sintonizador foi detectado corretamente, reinicialize o sistema. A placa de TV deve aparecer nas mensagens de inicialização, conforme mostrado neste exemplo:</para>

      <programlisting>bktr0: &lt;BrookTree 848A&gt; mem 0xd7000000-0xd7000fff irq 10 at device 10.0 on pci0
iicbb0: &lt;I2C bit-banging driver&gt; on bti2c0
iicbus0: &lt;Philips I2C bus&gt; on iicbb0 master-only
iicbus1: &lt;Philips I2C bus&gt; on iicbb0 master-only
smbus0: &lt;System Management Bus&gt; on bti2c0
bktr0: Pinnacle/Miro TV, Philips SECAM tuner.</programlisting>

      <para>As mensagens serão diferentes de acordo com o hardware. Se necessário, é possível substituir alguns dos parâmetros detectados usando <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> ou opções de configuração de kernel personalizadas. Por exemplo, para forçar o sintonizador a usar um sintonizador SECAM da Philips, adicione a seguinte linha a um arquivo de configuração de kernel personalizado:</para>

      <programlisting>options OVERRIDE_TUNER=6</programlisting>

      <para>ou, use <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>:</para>

      <screen><prompt>#</prompt> <userinput>sysctl hw.bt848.tuner=6</userinput></screen>

      <para>Consulte <citerefentry><refentrytitle>bktr</refentrytitle><manvolnum>4</manvolnum></citerefentry> para obter uma descrição disponível dos parâmetros do <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> e opções do kernel.</para>
    </sect2>

    <sect2>
      <title>Aplicações Úteis</title>

      <para>Para usar a placa de TV, instale um dos seguintes aplicativos:</para>

      <itemizedlist>
	<listitem>
	  <para><package>multimedia/fxtv</package> oferece recursos de captura de imagem/áudio/vídeo numa transmissão de TV no monitor do computador.</para>
	</listitem>
	<listitem>
	  <para>O <package>multimedia/xawtv</package> é outro aplicativo de TV com recursos semelhantes.</para>
	</listitem>
	<listitem>
	  <para>O <package>audio/xmradio</package> fornece uma aplicação para usar o sintonizador de rádio FM de uma placa de TV.</para>
	</listitem>
      </itemizedlist>

      <para>Mais aplicações estão disponíveis na Coleção de Ports do FreeBSD.</para>
    </sect2>

    <sect2>
      <title>Solução de problemas</title>

      <para>Se forem encontrados problemas com a placa de TV, verifique se o chip de captura de vídeo e o sintonizador são compatíveis com <citerefentry><refentrytitle>bktr</refentrytitle><manvolnum>4</manvolnum></citerefentry> e que as opções corretas de configuração foram usadas. Para obter mais suporte ou para fazer perguntas sobre as placas de TV suportadas, consulte a lista de discussão <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-multimedia">freebsd-multimedia</link>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="mythtv">
    <title>MythTV</title>

    <para>MythTV é um popular aplicativo de gravação de vídeo pessoal (<acronym>PVR</acronym>). Esta seção demonstra como instalar e configurar o MythTV no FreeBSD. Consulte <link xlink:href="http://www.mythtv.org/wiki/">mythtv.org/wiki</link> para mais informações sobre como usar o MythTV.</para>

    <para>MythTV requer um frontend e um backend. Esses componentes podem ser instalados no mesmo sistema ou em máquinas diferentes.</para>

    <para>O frontend pode ser instalado no FreeBSD usando o pacote ou port <package>multimedia/mythtv-frontend</package>. O <application>Xorg</application> também deve ser instalado e configurado conforme descrito em <xref linkend="x11"/>. Idealmente, este sistema tem uma placa de vídeo que suporta Compensação de Movimento de X-Vídeo (<acronym>XvMC</acronym>) e, opcionalmente, um controle remoto compatível com o Controle Remoto Infravermelho do Linux (<acronym>LIRC</acronym>).</para>

    <para>Para instalar o backend e o frontend no FreeBSD, use o pacote ou port <package>multimedia/mythtv</package>. Um servidor de banco de dados <trademark>MySQL</trademark> também é necessário e deve ser instalado automaticamente como uma dependência. Opcionalmente, este sistema deve ter uma placa sintonizadora e armazenamento suficiente para armazenar os dados gravados.</para>

    <sect2>
      <title>Hardware</title>

      <para>O MythTV usa o Video for Linux (<acronym>V4L</acronym>) para acessar dispositivos de entrada de vídeo, como codificadores e sintonizadores. No FreeBSD, o MythTV funciona melhor com placas <acronym>USB</acronym> DVB-S/C/T, pois são bem suportadas pelo pacote <package>multimedia/webcamd</package> ou pelo port que forneça uma aplicação  <acronym>V4L</acronym> userland. Qualquer placa de transmissão de vídeo digital (<acronym>DVB</acronym>) suportada pelo <application>webcamd</application> deve funcionar com o MythTV. Uma lista de placas suportadas conhecidas pode ser encontrada em <link xlink:href="https://wiki.freebsd.org/WebcamCompat"> wiki.freebsd.org/WebcamCompat</link>. Drivers também estão disponíveis para placas Hauppauge nos ports <package>multimedia/pvr250</package> e <package>multimedia/pvrxxx</package>, mas eles fornecem uma interface de driver não padronizados que não funcionam com versões do MythTV posteriores à 0.23. Devido a restrições de licenciamento, nenhum pacote está disponível e esses dois ports devem ser compilados.</para>

      <para>A página <link xlink:href="https://wiki.freebsd.org/HTPC">wiki.freebsd.org/HTPC</link> contém uma lista de todos os drivers <acronym>DVB</acronym> disponíveis.</para>
    </sect2>

    <sect2>
      <title>Configurando o Backend MythTV</title>

      <para>Para instalar o MythTV usando pacotes binários:</para>

      <screen><prompt>#</prompt> <userinput>pkg install mythtv</userinput></screen>

      <para>Como alternativa, para instalar a partir da Coleção de Ports:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/multimedia/mythtv</userinput>
<prompt>#</prompt> <userinput>make install</userinput></screen>

      <para>Uma vez instalado, configure o banco de dados do MythTV:</para>

      <screen><prompt>#</prompt> <userinput>mysql -uroot -p &lt; /usr/local/share/mythtv/database/mc.sql</userinput></screen>

      <para>Em seguida, configure o backend:</para>

      <screen><prompt>#</prompt> <userinput>mythtv-setup</userinput></screen>

      <para>Finalmente, inicie o backend:</para>

      <screen><prompt>#</prompt> <userinput>sysrc mythbackend_enable=yes</userinput>
<prompt>#</prompt> <userinput>service mythbackend start</userinput></screen>
    </sect2>
  </sect1>

  <sect1 xml:id="scanners">
    <info>
      <title>Scanners de Imagem</title>

      <authorgroup>
	<author><personname> <firstname>Marc</firstname> <surname>Fonvieille</surname> </personname> <contrib>Escrito por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>image scanners</primary></indexterm>

    <para>No FreeBSD, o acesso aos scanners de imagens é fornecido pelo <application>SANE</application> (Scanner Access Now Easy), que está disponível na Coleção de Ports do FreeBSD. O <application>SANE</application> também usará alguns drivers de dispositivos do FreeBSD para fornecer acesso ao hardware do scanner.</para>

    <para>O FreeBSD suporta os scanners <acronym>SCSI</acronym> e <acronym>USB</acronym>. Dependendo da interface do scanner, são necessários drivers de dispositivos diferentes. Certifique-se de que o scanner seja suportado pelo <application>SANE</application> antes de executar qualquer configuração. Consulte <link xlink:href="http://www.sane-project.org/sane-supported-devices.html">http://www.sane-project.org/sane-supported-devices.html</link> para obter mais informações sobre os scanners suportados.</para>

    <para>Este capítulo descreve como determinar se o scanner foi detectado pelo FreeBSD. Em seguida, ele fornece uma visão geral de como configurar e usar o <application>SANE</application> em um sistema FreeBSD.</para>

    <sect2 xml:id="scanners-kernel-usb">
      <title>Verificando o Scanner</title>

      <para>O kernel <filename>GENERIC</filename> inclui os drivers de dispositivos necessários para suportar scanners <acronym>USB</acronym>. Usuários com um kernel personalizado devem garantir que as seguintes linhas estejam presentes no arquivo de configuração do kernel personalizado:</para>

      <programlisting>device usb
device uhci
device ohci
device ehci
device xhci</programlisting>

      <para>Para verificar se o scanner <acronym>USB</acronym> foi detectado, conecte-o e execute o comando <command>dmesg</command>,  sendo então possível ver se o scanner aparece no buffer de mensagens do sistema. Em caso afirmativo, deve ser exibida uma mensagem semelhante a esta:</para>

      <screen>ugen0.2: &lt;EPSON&gt; at usbus0</screen>

      <para>Neste exemplo, um scanner <trademark class="registered">EPSON Perfection</trademark> 1650 <acronym>USB</acronym> foi detectado em <filename>/dev/ugen0.2</filename>.</para>

      <para>Se o scanner usar uma interface <acronym>SCSI</acronym>, é importante saber qual placa controladora <acronym>SCSI</acronym> será usada. Dependendo do chipset <acronym>SCSI</acronym>, um arquivo de configuração do kernel personalizado pode ser necessário. O kernel <filename>GENERIC</filename> suporta os controladores <acronym>SCSI</acronym> mais comuns. Consulte <filename>/usr/src/sys/conf/NOTES</filename> para determinar a linha correta a ser adicionada a um arquivo de configuração de kernel personalizado. Além do driver de adaptador <acronym>SCSI</acronym>, as seguintes linhas são necessárias em um arquivo de configuração de kernel personalizado:</para>

      <programlisting>device scbus
device pass</programlisting>

      <para>Verifique se o dispositivo é exibido no buffer de mensagens do sistema:</para>

      <screen>pass2 at aic0 bus 0 target 2 lun 0
pass2: &lt;AGFA SNAPSCAN 600 1.10&gt; Fixed Scanner SCSI-2 device
pass2: 3.300MB/s transfers</screen>

      <para>Se o scanner não foi ligado na inicialização do sistema, ainda é possível forçar manualmente a detecção executando uma varredura de barramento <acronym>SCSI</acronym> com o comando <command>camcontrol</command>:</para>

      <screen><prompt>#</prompt> <userinput>camcontrol rescan all</userinput>
Re-scan of bus 0 was successful
Re-scan of bus 1 was successful
Re-scan of bus 2 was successful
Re-scan of bus 3 was successful</screen>

      <para>O scanner deve agora aparecer na lista de dispositivos <acronym>SCSI</acronym>:</para>

      <screen><prompt>#</prompt> <userinput>camcontrol devlist</userinput>
&lt;IBM DDRS-34560 S97B&gt;              at scbus0 target 5 lun 0 (pass0,da0)
&lt;IBM DDRS-34560 S97B&gt;              at scbus0 target 6 lun 0 (pass1,da1)
&lt;AGFA SNAPSCAN 600 1.10&gt;           at scbus1 target 2 lun 0 (pass3)
&lt;PHILIPS CDD3610 CD-R/RW 1.00&gt;     at scbus2 target 0 lun 0 (pass2,cd0)</screen>

      <para>Consulte <citerefentry><refentrytitle>scsi</refentrytitle><manvolnum>4</manvolnum></citerefentry> e <citerefentry><refentrytitle>camcontrol</refentrytitle><manvolnum>8</manvolnum></citerefentry> para mais detalhes sobre dispositivos <acronym>SCSI</acronym> no FreeBSD.</para>
    </sect2>

    <sect2>
      <title>Configuração do <application>SANE</application></title>

      <para>O sistma <application>SANE</application> provê o acesso ao scanner via backends (<package>graphics/sane-backends</package>). Consulte <link xlink:href="http://www.sane-project.org/sane-supported-devices.html">http://www.sane-project.org/sane-supported-devices.html</link> para determinar qual backend suporta o scanner. Uma interface gráfica é fornecida por aplicações terceiras como <application>Kooka</application> (<package>graphics/kooka</package>) ou <application>XSane</application> (<package>graphics/xsane</package>). Os  backends do <application>SANE</application> são suficientes para testar o scanner.</para>

      <para>Para instalar os backends do pacote binário:</para>

      <screen><prompt>#</prompt> <userinput>pkg install sane-backends</userinput></screen>

      <para>Alternativamente, para instalar a partir da Coleção de Ports</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/graphics/sane-backends</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>

      <para>Depois de instalar o pacote ou port <package>graphics/sane-backends</package>, use o comando <command>sane-find-scanner</command> para verificar a detecção do scanner pelo sistema <application>SANE</application>:</para>

      <screen><prompt>#</prompt> <userinput>sane-find-scanner -q</userinput>
found SCSI scanner "AGFA SNAPSCAN 600 1.10" at /dev/pass3</screen>

      <para>A saída deve mostrar o tipo de interface do scanner e o nó do dispositivo usado para conectar o scanner ao sistema. O fornecedor e o modelo do produto podem ou não aparecer.</para>

      <note>
	<para>Alguns scanners <acronym>USB</acronym> exigem que o firmware seja carregado. Consulte sane-find-scanner(1) e sane(7) para mais detalhes.</para>
      </note>

      <para>Em seguida, verifique se o scanner será identificado por uma interface de digitalização. Os backends <application>SANE</application> incluem o comando <command>scanimage</command>, que pode ser usado para listar os dispositivos e realizar uma aquisição de imagens. Use a opção <option>-L</option> para listar os dispositivos do scanner. O primeiro exemplo é para um scanner <acronym>SCSI</acronym> e o segundo é para um scanner <acronym>USB</acronym>:</para>

      <screen><prompt>#</prompt> <userinput>scanimage -L</userinput>
device `snapscan:/dev/pass3' is a AGFA SNAPSCAN 600 flatbed scanner
<prompt>#</prompt> <userinput>scanimage -L</userinput>
device 'epson2:libusb:000:002' is a Epson GT-8200 flatbed scanner</screen>

      <para>Neste segundo exemplo,<literal>epson2</literal> é o nome do backend e <literal>libusb:000:002</literal> significa que <literal>/dev/ugen0.2</literal> é o dispositivo usado pelo scanner.</para>

      <para>Se o comando <command>scanimage</command> não conseguir identificar o scanner, esta mensagem será exibida:</para>

      <screen><prompt>#</prompt> <userinput>scanimage -L</userinput>

No scanners were identified. If you were expecting something different,
check that the scanner is plugged in, turned on and detected by the
sane-find-scanner tool (if appropriate). Please read the documentation
which came with this software (README, FAQ, manpages).</screen>

      <para>Se isso acontecer, edite o arquivo de configuração de backend em <filename>/usr/local/etc/sane.d/</filename> e defina o dispositivo de scanner usado. Por exemplo, se o modelo de scanner não detectado for um <trademark class="registered">EPSON Perfection</trademark> 1650 e usar o backend <literal>epson2</literal>, edite o arquivo <filename>/usr/ local/etc/sane.d/epson2.conf</filename>. Ao editar, adicione uma linha especificando a interface e o nó do dispositivo usado. Nesse caso, adicione a seguinte linha:</para>

      <programlisting>usb /dev/ugen0.2</programlisting>

      <para>Salve as edições e verifique se o scanner está identificado com o nome do back-end correto e com o nó do dispositivo:</para>

      <screen><prompt>#</prompt> <userinput>scanimage -L</userinput>
device 'epson2:libusb:000:002' is a Epson GT-8200 flatbed scanner</screen>

      <para>Depois que o comando <command>scanimage -L</command> identificar o scanner, a configuração estará completa e o scanner estará pronto para ser usado.</para>

      <para>Embora o <command>scanimage</command> possa ser usado para realizar uma digitalização de imagem a partir da linha de comando, muitas vezes é preferível usar uma interface gráfica para executar o escaneamento. Aplicações como <application>Kooka</application> ou <application>XSane</application> são interfaces de digitalização populares. Eles oferecem recursos avançados, como vários modos de digitalização, correção de cores e digitalizações em lote. O <application>XSane</application> também pode ser usado como um plugin <application>GIMP</application>.</para>
    </sect2>

    <sect2>
      <title>Permissões do Scanner</title>

      <para>Para ter acesso ao scanner, o usuário precisa ler e gravar as permissões no nó do dispositivo usado pelo scanner. No exemplo anterior, o scanner <acronym>USB</acronym> usa o nó do dispositivo <filename>/dev/ugen0.2</filename> que é realmente um link simbólico para o nó do dispositivo real <filename>/dev/usb/0.2.0</filename>. O link simbólico e o nó do dispositivo pertencem, respectivamente, aos grupos <systemitem class="groupname">wheel</systemitem> e <systemitem class="groupname">operator</systemitem>. Adicionando o usuário a esses grupos, será permitido o acesso ao scanner, considera-se inseguro adicionar um usuário a <systemitem class="groupname">wheel</systemitem>. Uma solução melhor é criar um grupo e tornar o dispositivo de scanner acessível aos membros desse grupo.</para>

      <para>Este exemplo cria um grupo chamado <systemitem class="groupname"><replaceable>usb</replaceable></systemitem>:</para>

      <screen><prompt>#</prompt> <userinput>pw groupadd usb</userinput></screen>

      <para>Então, crie um link simbólico para <filename>/dev/ugen0.2</filename> e o nó do dispositivo <filename>/dev/usb/0.2.0</filename> para ficarem acessíveis ao grupo <systemitem class="groupname">usb</systemitem> com permissões de gravação <literal>0660</literal> ou <literal>0664</literal> adicionando as seguintes linhas ao <filename>/etc/devfs.rules</filename>:</para>

      <programlisting>[system=5]
add path ugen0.2 mode 0660 group usb
add path usb/0.2.0 mode 0666 group usb</programlisting>

      <note>
	<para>Acontece do nó do dispositivo mudar com a adição ou remoção de dispositivos, então você pode querer dar acesso a todos os dispositivos USB usando esse conjunto de regas:</para>

	<programlisting>[system=5]
add path 'ugen*' mode 0660 group usb
add path 'usb/*' mode 0666 group usb</programlisting>
      </note>

      <para>Veja <citerefentry><refentrytitle>devfs.rules</refentrytitle><manvolnum>5</manvolnum></citerefentry> para mais informações sobre este arquivo.</para>

      <para>Em seguida, ative o conjunto de regras no arquivo /etc/rc.conf:</para>

      <programlisting>devfs_system_ruleset="system"</programlisting>

      <para>E, reinicie o sistema <citerefentry><refentrytitle>devfs</refentrytitle><manvolnum>8</manvolnum></citerefentry>:</para>

      <screen><prompt>#</prompt> <userinput>service devfs restart</userinput></screen>

      <para>Finalmente, adicione os usuários a <systemitem class="groupname"><replaceable>usb</replaceable></systemitem> para permitir acesso ao scanner:</para>

      <screen><prompt>#</prompt> <userinput>pw groupmod usb -m <replaceable>joe</replaceable></userinput></screen>

      <para>Para mais detalhes, consulte <citerefentry><refentrytitle>pw</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
    </sect2>
  </sect1>
</chapter>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<chapter version="5.0" xml:id="kernelconfig">
<!--<chapterinfo>
    <authorgroup>
      <author>
	<firstname>Jim</firstname>
	<surname>Mock</surname>
	<contrib>Updated and restructured in Mar 2000 by </contrib>
      </author>
    </authorgroup>
    <authorgroup>
      <author>
	<firstname>Jake</firstname>
	<surname>Hamby</surname>
	<contrib>Originally contributed 6 Oct 1995 by </contrib>
      </author>
    </authorgroup>
  </chapterinfo>
  -->

  <title>Configurando o kernel do FreeBSD</title>

  <sect1 xml:id="kernelconfig-synopsis">
    <title>Sinopse</title>

    <indexterm><primary>kernel</primary> <secondary>building a custom kernel</secondary></indexterm>

    <para>O kernel é o núcleo do sistema operacional do FreeBSD. Ele é responsável pelo gerenciamento de memória, aplicação de controles de segurança, rede, acesso ao disco e muito mais. Embora grande parte do FreeBSD seja configurável dinamicamente, ainda é necessário configurar e compilar um kernel personalizado ocasionalmente.</para>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>Quando compilar um kernel personalizado.</para>
      </listitem>

      <listitem>
	<para>Como obter um inventário do hardware.</para>
      </listitem>

      <listitem>
	<para>Como personalizar um arquivo de configuração do kernel.</para>
      </listitem>

      <listitem>
	<para>Como usar o arquivo de configuração do kernel para criar e compilar um novo kernel.</para>
      </listitem>

      <listitem>
	<para>Como instalar o novo kernel.</para>
      </listitem>

      <listitem>
	<para>Como solucionar problemas se as coisas derem errado.</para>
      </listitem>
    </itemizedlist>

    <para>Todos os comandos listados nos exemplos deste capítulo devem ser executados como <systemitem class="username">root</systemitem>.</para>
  </sect1>

  <sect1 xml:id="kernelconfig-custom-kernel">
    <title>Por que compilar um kernel personalizado?</title>

    <para>Tradicionalmente, o FreeBSD usava um kernel monolítico. O kernel era um grande programa, suportava uma lista fixa de dispositivos e, para mudar o comportamento do kernel, era preciso compilar e depois reinicializar em um novo kernel.</para>

    <para>Hoje, a maior parte da funcionalidade do kernel do FreeBSD está contida em módulos que podem ser dinamicamente carregados e descarregados do kernel, conforme necessário. Isso permite que o kernel em execução se adapte imediatamente ao novo hardware e que novas funcionalidades sejam trazidas para o kernel. Isso é conhecido como um kernel modular.</para>

    <para>Ocasionalmente, ainda é necessário executar a configuração do kernel estático. Às vezes, a funcionalidade necessária é tão ligada ao kernel que não pode ser carregada dinamicamente. Alguns ambientes de segurança impedem o carregamento e descarregamento de módulos do kernel e exigem que apenas a funcionalidade necessária seja estaticamente compilada no kernel.</para>

    <para>Construir um kernel personalizado é muitas vezes um rito de passagem para usuários avançados do BSD. Este processo, embora consuma tempo, pode fornecer benefícios ao sistema FreeBSD. Ao contrário do kernel <filename>GENERIC</filename>, que deve suportar uma ampla gama de hardware, um kernel personalizado pode ser reduzido para fornecer suporte apenas para o hardware desse computador. Isso tem vários benefícios, tais como:</para>

    <itemizedlist>
      <listitem>
	<para>Tempo de inicialização mais rápido. Uma vez que o kernel irá verificar apenas o hardware existente no sistema, o tempo que o sistema leva para inicializar pode diminuir.</para>
      </listitem>

      <listitem>
	<para>Diminuir o uso de memória. Um kernel personalizado geralmente usa menos memória que o kernel <filename>GENERIC</filename> ao omitir recursos e drivers de dispositivo que não são utilizados. Isso é importante porque o código do kernel permanece residente na memória física o tempo todo, impedindo que a memória seja usada pelos aplicativos. Por esse motivo, um kernel personalizado é útil em um sistema com uma pequena quantidade de RAM.</para>
      </listitem>

      <listitem>
	<para>Suporte adicional de hardware. Um kernel personalizado pode adicionar suporte para dispositivos que não estão presentes no kernel <filename>GENERIC</filename>.</para>
      </listitem>
    </itemizedlist>

    <para>Antes de criar um kernel personalizado, considere a razão para isso. Se houver necessidade de suporte para um  hardware específico, ele já pode existir como um módulo.</para>

    <para>Os módulos do kernel existem em <filename>/boot/kernel</filename> e podem ser dinamicamente carregados no kernel em execução usando o <citerefentry><refentrytitle>kldload</refentrytitle><manvolnum>8</manvolnum></citerefentry>. A maioria dos drivers do kernel tem um módulo carregável e uma página de manual. Por exemplo, o driver Ethernet sem fio <citerefentry><refentrytitle>ath</refentrytitle><manvolnum>4</manvolnum></citerefentry> tem as seguintes informações em sua página de manual:</para>

    <screen>Como alternativa, para carregar o driver como um módulo no momento da inicialização, coloque o a seguinte linha no <citerefentry><refentrytitle>loader.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>:

    if_ath_load="YES"</screen>

    <para>Adicionar <literal>if_ath_load="YES"</literal> ao <filename>/boot/loader.conf</filename> carregará este módulo dinamicamente no momento da inicialização.</para>

    <para>Em alguns casos, não há nenhum módulo associado em <filename>/boot/kernel</filename>. Isso é verdade principalmente para certos subsistemas.</para>
  </sect1>

  <sect1 xml:id="kernelconfig-devices">
    <!--
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Tom</firstname>
	  <surname>Rhodes</surname>
	  <contrib>Written by </contrib>
	</author>
      </authorgroup>
    </sect1info>
    -->
    <title>Encontrando o hardware do sistema</title>

    <para>Antes de editar o arquivo de configuração do kernel, é recomendável realizar um inventário do hardware da máquina. Em um sistema de inicialização dupla, o inventário pode ser criado a partir do outro sistema operacional. Por exemplo, o <application>Device Manager</application> da <trademark class="registered">Microsoft</trademark> contém informações sobre os dispositivos instalados.</para>

    <note>
      <para>Algumas versões do <trademark class="registered">Microsoft </trademark> <trademark class="registered">Windows</trademark> têm um ícone <application>System</application> que pode ser usado para acessar o <application>Device Manager</application>.</para>
    </note>

    <para>Se o FreeBSD for o único sistema operacional instalado, use o <citerefentry><refentrytitle>dmesg</refentrytitle><manvolnum>8</manvolnum></citerefentry> para determinar o hardware que foi encontrado e listado durante a verificação de inicialização. A maioria dos drivers de dispositivos no FreeBSD tem uma página de manual que lista o hardware suportado pelo driver. Por exemplo, as seguintes linhas indicam que o driver <citerefentry><refentrytitle>psm</refentrytitle><manvolnum>4</manvolnum></citerefentry> encontrou um mouse:</para>

    <screen>psm0: &lt;PS/2 Mouse&gt; irq 12 on atkbdc0
psm0: [GIANT-LOCKED]
psm0: [ITHREAD]
psm0: model Generic PS/2 mouse, device ID 0</screen>

    <para>Como esse hardware existe, esse driver não deve ser removido de um arquivo de configuração de kernel personalizado.</para>

    <para>Se a saída do <command>dmesg</command> não exibir os resultados da saída da verificação de inicialização, leia o conteúdo do <filename>/var/run/dmesg.boot</filename>.</para>

    <para>Outra ferramenta para encontrar hardware é o <citerefentry><refentrytitle>pciconf</refentrytitle> <manvolnum>8</manvolnum></citerefentry>, que fornece uma saída mais detalhada. Por exemplo:</para>

    <screen><prompt>%</prompt> <userinput>pciconf -lv</userinput>
ath0@pci0:3:0:0:        class=0x020000 card=0x058a1014 chip=0x1014168c rev=0x01 hdr=0x00
    vendor     = 'Atheros Communications Inc.'
    device     = 'AR5212 Atheros AR5212 802.11abg wireless'
    class      = network
    subclass   = ethernet</screen>

    <para>Esta saída mostra que o driver <filename>ath</filename> localizou um dispositivo Ethernet sem fio.</para>

    <para>O sinalizador <option>-k</option> do <citerefentry><refentrytitle>man</refentrytitle> <manvolnum>1</manvolnum></citerefentry> pode ser usado para fornecer informações úteis. Por exemplo, ele pode ser usado para exibir uma lista de páginas de manual que contêm uma marca ou um nome de dispositivo específico:</para>

    <screen><prompt>#</prompt> <userinput>man -k <replaceable>Atheros</replaceable></userinput>
ath(4)                   - Atheros IEEE 802.11 wireless network driver
ath_hal(4)               - Atheros Hardware Access Layer (HAL)</screen>

    <para>Depois que a lista de inventário de hardware for criada, consulte-a para garantir que os drivers para o hardware instalado não sejam removidos à medida que a configuração do kernel personalizado é editada.</para>
  </sect1>

  <sect1 xml:id="kernelconfig-config">
    <!--
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Joel</firstname>
	  <surname>Dahl</surname>
	  <contrib>Updated by </contrib>
	</author>
      </authorgroup>
    </sect1info>
    -->
    <title>O Arquivo de Configuração</title>

    <para>Para criar um arquivo de configuração do kernel personalizado e compilar um kernel personalizado, a árvore de código-fonte completa do FreeBSD deve ser instalada primeira.</para>

    <para>Se o <filename>/usr/src/</filename> não existir ou estiver vazio, o código-fonte não foi instalado. O fonte pode ser instalado usando o <application>Subversion</application> e as instruções em <xref linkend="svn"/>.</para>

    <para>Depois que o código-fonte for instalado, revise o conteúdo do <filename>/usr/src/sys</filename>. Este diretório contém vários subdiretórios, incluindo aqueles que representam as seguintes arquiteturas suportadas: <filename>amd64</filename>,  <filename>i386</filename>,  <filename>powerpc</filename> e <filename>sparc64</filename>. Tudo dentro do diretório de uma arquitetura em particular lida apenas com essa arquitetura e o restante do código é código independente de máquina comum a todas as plataformas. Cada arquitetura suportada tem um subdiretório <filename>conf</filename> que contém o arquivo de configuração do kernel <filename>GENERIC</filename> para essa arquitetura.</para>

    <para>Não faça edições no <filename>GENERIC</filename>. Em vez disso, copie o arquivo para um nome diferente e faça edições na cópia. A convenção é usar um nome do host com todas as letras maiúsculas. Ao manter várias máquinas FreeBSD com hardware diferente, é uma boa idéia nomeá-lo com o nome do host da máquina. Este exemplo cria uma cópia, denominada <filename>MYKERNEL</filename>, do arquivo de configuração <filename>GENERIC</filename> para a arquitetura <literal>amd64</literal>:</para>

    <screen><prompt>#</prompt> <userinput>cd /usr/src/sys/<replaceable>amd64</replaceable>/conf</userinput>
<prompt>#</prompt> <userinput>cp GENERIC <replaceable>MYKERNEL</replaceable></userinput></screen>

    <para>O <filename><replaceable>MYKERNEL</replaceable></filename> agora pode ser personalizado com qualquer editor de texto <acronym>ASCII</acronym>. O editor padrão é o <application>vi</application>, embora um editor mais fácil para iniciantes, chamado <application>ee</application>, também seja instalado com o FreeBSD.</para>

    <indexterm><primary>kernel</primary> <secondary>NOTES</secondary></indexterm>
    <indexterm><primary>NOTES</primary></indexterm>
    <indexterm><primary>kernel</primary> <secondary>configuration file</secondary></indexterm>

    <para>O formato do arquivo de configuração do kernel é simples. Cada linha contém uma palavra-chave que representa um dispositivo ou subsistema, um argumento e uma breve descrição. Qualquer texto depois de um <literal>#</literal> é considerado um comentário e ignorado. Para remover o suporte do kernel para um dispositivo ou subsistema, coloque um <literal>#</literal> no início da linha que representa esse dispositivo ou subsistema. Não adicione ou remova um <literal>#</literal> para qualquer linha que você não entenda.</para>

    <warning>
      <para>É fácil remover o suporte para um dispositivo ou opção e acabar com um kernel quebrado. Por exemplo, se o driver <citerefentry><refentrytitle>ata</refentrytitle><manvolnum>4</manvolnum></citerefentry> for removido do arquivo de configuração do kernel, um sistema usando os drivers de disco <acronym>ATA</acronym> pode não inicializar. Em caso de dúvida, basta deixar o suporte no kernel.</para>
    </warning>

    <para>Além das breves descrições fornecidas neste arquivo, descrições adicionais estão contidas no arquivo <filename>NOTES</filename>, o qual pode ser encontrado no mesmo diretório que o <filename>GENERIC</filename> para aquela arquitetura. Para opções independentes de arquitetura, consulte <filename>/usr/src/sys/conf/NOTES</filename>.</para>

    <tip>
      <para>Quando terminar de personalizar o arquivo de configuração do kernel, salve uma cópia de backup em um local fora do <filename>/usr/src</filename>.</para>

      <para>Como alternativa, mantenha o arquivo de configuração do kernel em outro lugar e crie um link simbólico para o arquivo:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/src/sys/amd64/conf</userinput>
<prompt>#</prompt> <userinput>mkdir /root/kernels</userinput>
<prompt>#</prompt> <userinput>cp GENERIC /root/kernels/MYKERNEL</userinput>
<prompt>#</prompt> <userinput>ln -s /root/kernels/MYKERNEL</userinput></screen>
    </tip>

    <para>Uma diretiva <literal>include</literal> está disponível para uso em arquivos de configuração. Isso permite que outro arquivo de configuração seja incluído no arquivo atual, facilitando a manutenção de pequenas alterações em relação a um arquivo existente. Se apenas um pequeno número de opções ou drivers adicionais forem necessários, isso permitirá que um delta seja mantido com relação ao <filename>GENERIC</filename>, conforme mostrado neste exemplo:</para>

    <programlisting>include GENERIC
ident MYKERNEL

options         IPFIREWALL
options         DUMMYNET
options         IPFIREWALL_DEFAULT_TO_ACCEPT
options         IPDIVER</programlisting>

    <para>Usando este método, o arquivo de configuração local expressa as diferenças locais em relação ao kernel <filename>GENERIC</filename>. Conforme as atualizações são realizadas, os novos recursos adicionados ao <filename>GENERIC</filename> também serão adicionados ao kernel local, a menos que sejam especificamente evitados usando <literal>nooptions</literal> ou <literal>nodevice</literal>. Uma lista abrangente de diretivas de configuração e suas descrições pode ser encontrada em <citerefentry><refentrytitle>config</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>

    <note>
      <para>Para compilar um arquivo que contém todas as opções disponíveis, execute o seguinte comando como <systemitem class="username">root</systemitem>:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/src/sys/<replaceable>arch</replaceable>/conf &amp;&amp; make LINT</userinput></screen>
    </note>

<!--
    <indexterm>
      <primary>kernel options</primary>
      <secondary>ident</secondary>
    </indexterm>

This is outdated and specific to one architecture.

    <programlisting>ident          GENERIC</programlisting>

    <para>This is the identification of the kernel.  Change
      this to the new kernel name, such as
      <literal><replaceable>MYKERNEL</replaceable></literal>.
      The value in the <literal>ident</literal> string will
      print when the kernel boots.</para>

    <programlisting>makeoptions     DEBUG=-g          # Build kernel with gdb(1) debug symbols</programlisting>

    <para>This option enables debugging information when passed to
      &man.gcc.1;.</para>

    <programlisting>options          SCHED_ULE         # ULE scheduler</programlisting>

    <para>The default system scheduler for &os;.  Keep this.</para>

    <programlisting>options          INET              # InterNETworking</programlisting>

    <para>Networking support.  This is mandatory as most programs
      require at least loopback networking.</para>

    <programlisting>options          INET6             # IPv6 communications protocols</programlisting>

    <para>This enables the IPv6 communication protocols.</para>

    <programlisting>options          FFS               # Berkeley Fast Filesystem</programlisting>

    <para>This is the basic hard drive file system.  Leave it in if
      the system boots from the hard disk.</para>

    <programlisting>options          SOFTUPDATES       # Enable FFS Soft Updates support</programlisting>

    <para>This option enables Soft Updates in the kernel which helps
      to speed up write access on the disks.  Even when this
      functionality is provided by the kernel, it must be turned on
      for specific disks.  Review the output of &man.mount.8; to
      determine if Soft Updates is enabled.  If the
      <literal>soft-updates</literal> option is not in the output, it
      can be activated using &man.tunefs.8; for existing file systems
      or &man.newfs.8; for new file systems.</para>

    <programlisting>options          UFS_ACL           # Support for access control lists</programlisting>

    <para>This option enables kernel support for access control lists
      (<acronym>ACL</acronym>s).  This relies on the use of extended
      attributes and <acronym>UFS2</acronym>, and the feature is
      described in detail in <xref linkend="fs-acl"/>.
      <acronym>ACL</acronym>s are enabled by default and should not be
      disabled in the kernel if they have been used previously on a
      file system, as this will remove the ACLs, changing the way
      files are protected in unpredictable ways.</para>

    <programlisting>options          UFS_DIRHASH       # Improve performance on big directories</programlisting>

    <para>This option includes functionality to speed up disk
      operations on large directories, at the expense of using
      additional memory.  Keep this for a large server or interactive
      workstation, and remove it from smaller systems where memory is
      at a premium and disk access speed is less important, such as a
      firewall.</para>

    <programlisting>options          MD_ROOT           # MD is a potential root device</programlisting>

    <para>This option enables support for a memory backed virtual disk
      used as a root device.</para>

    <indexterm>
      <primary>kernel options</primary>
      <secondary>NFS</secondary>
    </indexterm>
    <indexterm>
      <primary>kernel options</primary>
      <secondary>NFS_ROOT</secondary>
    </indexterm>
    <programlisting>options          NFSCLIENT         # Network Filesystem Client
options          NFSSERVER         # Network Filesystem Server
options          NFS_ROOT          # NFS usable as /, requires NFSCLIENT</programlisting>

    <para>The network file system (<acronym>NFS</acronym>).  These
      lines can be commented unless the system needs to mount
      partitions from a <acronym>NFS</acronym> file server over
      TCP/IP.</para>

    <indexterm>
      <primary>kernel options</primary>
      <secondary>MSDOSFS</secondary>
    </indexterm>
    <programlisting>options          MSDOSFS           # MSDOS Filesystem</programlisting>

    <para>The &ms-dos; file system.  Unless the system needs to mount
      a DOS formatted hard drive partition at boot time, comment this
      out.  It will be automatically loaded the first time a DOS
      partition is mounted.  The <package>emulators/mtools</package>
      package allows access to DOS floppies without having to mount
      and unmount them and does not require
      <literal>MSDOSFS</literal>.</para>

    <programlisting>options          CD9660            # ISO 9660 Filesystem</programlisting>

    <para>The ISO 9660 file system for CDROMs.  Comment it out if the
      system does not have a CDROM drive or only mounts data CDs
      occasionally since it will be dynamically loaded the first
      time a data CD is mounted.  Audio CDs do not need this file
      system.</para>

    <programlisting>options          PROCFS            # Process filesystem (requires PSEUDOFS)</programlisting>

    <para>The process file system.  This is a <quote>pretend</quote>
      file system mounted on <filename>/proc</filename> which allows
      some programs to provide more information on what processes are
      running.  Use of <literal>PROCFS</literal> is not required under
      most circumstances, as most debugging and monitoring tools have
      been adapted to run without <literal>PROCFS</literal>.  The
      default installation will not mount this file system by
      default.</para>

    <programlisting>options          PSEUDOFS          # Pseudo-filesystem framework</programlisting>

    <para>Kernels making use of <literal>PROCFS</literal> must
      also include support for <literal>PSEUDOFS</literal>.</para>

    <programlisting>options          GEOM_PART_GPT     # GUID Partition Tables.</programlisting>

    <para>Adds support for <link
	xlink:href="http://en.wikipedia.org/wiki/GUID_Partition_Table">GUID
	Partition Tables</link> (<acronym>GPT</acronym>).  GPT
      provides the ability to have a large number of partitions per
      disk, 128 in the standard configuration.</para>

    <programlisting>options          COMPAT_43         # Compatible with BSD 4.3 [KEEP THIS!]</programlisting>

    <para>Compatibility with 4.3BSD.  Leave this in as some programs
      will act strangely if this is commented out.</para>

    <programlisting>options          COMPAT_FREEBSD4   # Compatible with &os;4</programlisting>

    <para>This option is required to support applications compiled on
      older versions of &os; that use older system call interfaces.
      It is recommended that this option be used on all &i386; systems
      that may run older applications.  Platforms that gained support
      after &os;&nbsp;4.X, such as &sparc64;, do not require
      this option.</para>

    <programlisting>options          COMPAT_FREEBSD5   # Compatible with &os;5</programlisting>

    <para>This option is required to support applications compiled on
      &os;&nbsp;5.X versions that use &os;&nbsp;5.X system call
      interfaces.</para>

    <programlisting>options          COMPAT_FREEBSD6   # Compatible with &os;6</programlisting>

    <para>This option is required to support applications compiled on
      &os;&nbsp;6.X versions that use &os;&nbsp;6.X system call
      interfaces.</para>

    <programlisting>options          COMPAT_FREEBSD7   # Compatible with &os;7</programlisting>

    <para>This option is required on &os;&nbsp;8 and above to support
      applications compiled on &os;&nbsp;7.X versions that use
      &os;&nbsp;7.X system call interfaces.</para>

    <programlisting>options          SCSI_DELAY=5000  # Delay (in ms) before probing SCSI</programlisting>

    <para>This causes the kernel to pause for 5 seconds before probing
      each <acronym>SCSI</acronym> device in the system.  If
      <acronym>SCSI</acronym> drives are not recognized, increase the
      number.  If the system does not have any <acronym>SCSI</acronym>
      drives, this value can be ignored or decreased to speed up
      booting.</para>

    <programlisting>options          KTRACE            # ktrace(1) support</programlisting>

    <para>This enables kernel process tracing, which is useful in
      debugging.</para>

    <programlisting>options          SYSVSHM           # SYSV-style shared memory</programlisting>

    <para>This option provides for System&nbsp;V shared memory.  The
      most common use of this is the XSHM extension in X, which many
      graphics-intensive programs will automatically take advantage of
      for extra speed.  If <application>Xorg</application> is
      installed, include this.</para>

    <programlisting>options          SYSVMSG           # SYSV-style message queues</programlisting>

    <para>Support for System&nbsp;V messages.  This option only adds
      a few hundred bytes to the kernel.</para>

    <programlisting>options          SYSVSEM           # SYSV-style semaphores</programlisting>

    <para>Support for System&nbsp;V semaphores.  Less commonly used,
      but only adds a few hundred bytes to the kernel.</para>

    <note>
      <para>Using <option>-p</option> with &man.ipcs.1; will list any
	processes using each of these System&nbsp;V facilities.</para>
    </note>

    <programlisting>options 	     _KPOSIX_PRIORITY_SCHEDULING # POSIX P1003_1B real-time extensions</programlisting>

    <para>Real-time extensions added in the 1993 &posix;.  Certain
      applications in the Ports Collection use these.</para>

    <programlisting>options          KBD_INSTALL_CDEV  # install a CDEV entry in /dev</programlisting>

    <para>This option is required to allow the creation of keyboard
      device nodes in <filename>/dev</filename>.</para>

    <indexterm>
      <primary>kernel options</primary>
      <secondary>SMP</secondary>
    </indexterm>
    <programlisting>device          apic               # I/O APIC</programlisting>

    <para>This device enables the use of the I/O APIC for interrupt
      delivery.  It can be used in both uni-processor and SMP kernels,
      but is required for SMP kernels.  Add <literal>options
	SMP</literal> to include support for multiple
      processors.</para>

    <note>
      <para>This device exists only on the &i386; architecture and
	this configuration line should not be used on other
	architectures.</para>
    </note>

    <programlisting>device          eisa</programlisting>

    <para>Include this for systems with an EISA motherboard.  This
      enables auto-detection and configuration support for all devices
      on the EISA bus.</para>

    <programlisting>device          pci</programlisting>

    <para>Include this for systems with a PCI motherboard.  This
      enables auto-detection of PCI cards and gatewaying from the PCI
      to ISA bus.</para>

    <programlisting># Floppy drives
device          fdc</programlisting>

    <para>This is the floppy drive controller.</para>

    <programlisting># ATA and ATAPI devices
device          ata</programlisting>

    <para>This driver supports all ATA and ATAPI devices.  Only
      one <literal>device ata</literal> line is needed for the kernel
      to detect all PCI ATA/ATAPI devices on modern machines.</para>

    <programlisting>device          atadisk                 # ATA disk drives</programlisting>

    <para>This is needed along with <literal>device ata</literal> for
      ATA disk drives.</para>

    <programlisting>device          ataraid                 # ATA RAID drives</programlisting>

    <para>This is needed along with <literal>device ata</literal>
      for ATA RAID drives.</para>

    <programlisting><anchor xml:id="kernelconfig-atapi"/>
device          atapicd                 # ATAPI CDROM drives</programlisting>

    <para>This is needed along with <literal>device ata</literal>
      for ATAPI CDROM drives.</para>

    <programlisting>device          atapifd                 # ATAPI floppy drives</programlisting>

    <para>This is needed along with <literal>device ata</literal> for
      ATAPI floppy drives.</para>

    <programlisting>device          atapist                 # ATAPI tape drives</programlisting>

    <para>This is needed along with <literal>device ata</literal> for
      ATAPI tape drives.</para>

    <programlisting>options         ATA_STATIC_ID           # Static device numbering</programlisting>

    <para>This makes the controller number static.  Without this, the
      device numbers are dynamically allocated.</para>

    <programlisting># SCSI Controllers
device          ahb        # EISA AHA1742 family
device          ahc        # AHA2940 and onboard AIC7xxx devices
options         AHC_REG_PRETTY_PRINT    # Print register bitfields in debug
                                        # output.  Adds ~128k to driver.
device          ahd        # AHA39320/29320 and onboard AIC79xx devices
options         AHD_REG_PRETTY_PRINT    # Print register bitfields in debug
                                        # output.  Adds ~215k to driver.
device          amd        # AMD 53C974 (Teckram DC-390(T))
device          isp        # Qlogic family
#device         ispfw      # Firmware for QLogic HBAs- normally a module
device          mpt        # LSI-Logic MPT-Fusion
#device         ncr        # NCR/Symbios Logic
device          sym        # NCR/Symbios Logic (newer chipsets + those of `ncr')
device          trm        # Tekram DC395U/UW/F DC315U adapters

device          adv        # Advansys SCSI adapters
device          adw        # Advansys wide SCSI adapters
device          aha        # Adaptec 154x SCSI adapters
device          aic        # Adaptec 15[012]x SCSI adapters, AIC-6[23]60.
device          bt         # Buslogic/Mylex MultiMaster SCSI adapters

device          ncv        # NCR 53C500
device          nsp        # Workbit Ninja SCSI-3
device          stg        # TMC 18C30/18C50</programlisting>

    <para>In this section, comment out any SCSI controllers not on
      the system.  For an IDE only system, these lines can be removed.
      The <literal>*_REG_PRETTY_PRINT</literal> lines are
      debugging options for their respective drivers.</para>

    <programlisting># SCSI peripherals
device          scbus      # SCSI bus (required for SCSI)
device          ch         # SCSI media changers
device          da         # Direct Access (disks)
device          sa         # Sequential Access (tape etc)
device          cd         # CD
device          pass       # Passthrough device (direct SCSI access)
device          ses        # SCSI Environmental Services (and SAF-TE)</programlisting>

    <para>Comment out any SCSI peripherals not on the system.  If
      the system only has IDE hardware, these lines can be removed
      completely.</para>

    <note>
      <para>The USB &man.umass.4; driver and a few other drivers use
	the SCSI subsystem even though they are not real SCSI devices.
	Do not remove SCSI support if any such drivers are included in
	the kernel configuration.</para>
    </note>

    <programlisting># RAID controllers interfaced to the SCSI subsystem
device          amr        # AMI MegaRAID
device          arcmsr     # Areca SATA II RAID
device          asr        # DPT SmartRAID V, VI and Adaptec SCSI RAID
device          ciss       # Compaq Smart RAID 5*
device          dpt        # DPT Smartcache III, IV - See NOTES for options
device          hptmv      # Highpoint RocketRAID 182x
device          hptrr      # Highpoint RocketRAID 17xx, 22xx, 23xx, 25xx
device          iir        # Intel Integrated RAID
device          ips        # IBM (Adaptec) ServeRAID
device          mly        # Mylex AcceleRAID/eXtremeRAID
device          twa        # 3ware 9000 series PATA/SATA RAID

# RAID controllers
device          aac        # Adaptec FSA RAID
device          aacp       # SCSI passthrough for aac (requires CAM)
device          ida        # Compaq Smart RAID
device          mfi        # LSI MegaRAID SAS
device          mlx        # Mylex DAC960 family
device          pst        # Promise Supertrak SX6000
device          twe        # 3ware ATA RAID</programlisting>

    <para>Supported RAID controllers.  If the system does not have any
      of these, comment them out or remove them.</para>

    <programlisting># atkbdc0 controls both the keyboard and the PS/2 mouse
device          atkbdc     # AT keyboard controller</programlisting>

    <para>The <literal>atkbdc</literal> keyboard controller provides
      I/O services for the AT keyboard and PS/2 style pointing
      devices.  This controller is required by &man.atkbd.4; and
      &man.psm.4;.</para>

    <programlisting>device          atkbd      # AT keyboard</programlisting>

    <para>The &man.atkbd.4; driver, together with the &man.atkbdc.4;
      controller, provides access to the AT 84 keyboard or the AT
      enhanced keyboard which is connected to the AT keyboard
      controller.</para>

    <programlisting>device          psm        # PS/2 mouse</programlisting>

    <para>Use this device if the mouse plugs into the PS/2 mouse
      port.</para>

    <programlisting>device          kbdmux        # keyboard multiplexer</programlisting>

    <para>Basic support for keyboard multiplexing.  If the system
      does not use more than one keyboard, this line can be safely
      removed.</para>

    <programlisting>device          vga        # VGA video card driver</programlisting>

    <para>The &man.vga.4; video card driver.</para>

    <programlisting>device          splash     # Splash screen and screen saver support</programlisting>

    <para>Required by the boot splash screen and screen savers.</para>

    <programlisting># syscons is the default console driver, resembling a SCO console
device          sc</programlisting>

    <para>&man.sc.4; is the default console driver and resembles a SCO
      console.  Since most full-screen programs access the console
      through a terminal database library like
      <filename>termcap</filename>, it should not matter whether
      this or <literal>vt</literal>, the
      <literal>VT220</literal> compatible console driver, is used.
      When a user logs in, the <envar>TERM</envar> variable can be set
      to <literal>scoansi</literal> if full-screen programs have
      trouble running under this console.</para>

    <programlisting># Enable this for the pcvt (VT220 compatible) console driver
#device          vt
#options         XSERVER          # support for X server on a vt console
#options         FAT_CURSOR       # start with block cursor</programlisting>

    <para>This is a VT220-compatible console driver, backward
      compatible to VT100/102.  It works well on some laptops which
      have hardware incompatibilities with <literal>sc</literal>.
      Users may need to set <envar>TERM</envar> to
      <literal>vt100</literal> or <literal>vt220</literal> after
      login.  This driver is useful when connecting to a large number
      of different machines over the network, where
      <filename>termcap</filename> or <filename>terminfo</filename>
      entries for the <literal>sc</literal> device are not
      available as <literal>vt100</literal> should be available
      on virtually any platform.</para>

    <programlisting>device          agp</programlisting>

    <para>Include this if the system has an AGP card.  This will
      enable support for AGP and AGP GART for boards which have these
      features.</para>

    <programlisting># Add suspend/resume support for the i8254.
device           pmtimer</programlisting>

    <para>Timer device driver for power management events, such as
      APM and ACPI.</para>

    <programlisting># PCCARD (PCMCIA) support
# PCMCIA and cardbus bridge support
device          cbb               # cardbus (yenta) bridge
device          pccard            # PC Card (16-bit) bus
device          cardbus           # CardBus (32-bit) bus</programlisting>

    <para>PCMCIA support.  Keep this on laptop systems.</para>

    <programlisting># Serial (COM) ports
device          sio               # 8250, 16[45]50 based serial ports</programlisting>

    <para>These are the serial ports referred to as
      <filename>COM</filename> ports in &windows;.</para>

    <note>
      <para>If the system has an internal modem on
	<filename>COM4</filename> and a serial port at
	<filename>COM2</filename>, change the IRQ of the modem to
	2.  For a multiport serial card, refer to &man.sio.4; for more
	information on the proper values to add to
	<filename>/boot/device.hints</filename>.  Some video cards,
	notably those based on S3 chips, use I/O addresses in the
	form of <literal>0x*2e8</literal>.  Since many cheap serial
	cards do not fully decode the 16-bit I/O address space, they
	clash with these cards, making the
	<filename>COM4</filename> port practically
	unavailable.</para>

      <para>Each serial port is required to have a unique IRQ and the
	default IRQs for <filename>COM3</filename> and
	<filename>COM4</filename> cannot be used.  The exception
	is multiport cards where shared interrupts are
	supported.</para>
    </note>

    <programlisting># Parallel port
device          ppc</programlisting>

    <para>This is the ISA bus parallel port interface.</para>

    <programlisting>device          ppbus      # Parallel port bus (required)</programlisting>

    <para>Provides support for the parallel port bus.</para>

    <programlisting>device          lpt        # Printer</programlisting>

    <para>Adds support for parallel port printers.</para>

    <note>
      <para>All three of the above are required to enable parallel
	printer support.</para>
    </note>

    <programlisting>device          ppi        # Parallel port interface device</programlisting>

    <para>The general-purpose I/O (<quote>geek port</quote>) +
      IEEE1284 I/O.</para>

    <programlisting>#device         vpo        # Requires scbus and da</programlisting>

    <indexterm><primary>zip drive</primary></indexterm>
    <para>This is for an Iomega Zip drive.  It requires
      <literal>scbus</literal> and <literal>da</literal> support.
      Best performance is achieved with ports in EPP 1.9 mode.</para>

    <programlisting>#device         puc</programlisting>

    <para>Uncomment this device if the system has a
      <quote>dumb</quote> serial or parallel PCI card that is
      supported by the &man.puc.4; glue driver.</para>

    <programlisting># PCI Ethernet NICs.
device          de         # DEC/Intel DC21x4x (<quote>Tulip</quote>)
device          em         # Intel PRO/1000 adapter Gigabit Ethernet Card
device          ixgb       # Intel PRO/10GbE Ethernet Card
device          txp        # 3Com 3cR990 (<quote>Typhoon</quote>)
device          vx         # 3Com 3c590, 3c595 (<quote>Vortex</quote>)</programlisting>

    <para>Various PCI network card drivers.  Comment out or remove
      any of these which are not present in the system.</para>

    <programlisting># PCI Ethernet NICs that use the common MII bus controller code.
# NOTE: Be sure to keep the 'device miibus' line in order to use these NICs!
device          miibus     # MII bus support</programlisting>

    <para>MII bus support is required for some PCI 10/100 Ethernet
      NICs, namely those which use MII-compliant transceivers or
      implement transceiver control interfaces that operate like an
      MII.  Adding <literal>device miibus</literal> to the kernel
      config pulls in support for the generic miibus API and all of
      the PHY drivers, including a generic one for PHYs that are not
      specifically handled by an individual driver.</para>

    <programlisting>device          bce        # Broadcom BCM5706/BCM5708 Gigabit Ethernet
device          bfe        # Broadcom BCM440x 10/100 Ethernet
device          bge        # Broadcom BCM570xx Gigabit Ethernet
device          dc         # DEC/Intel 21143 and various workalikes
device          fxp        # Intel EtherExpress PRO/100B (82557, 82558)
device          lge        # Level 1 LXT1001 gigabit ethernet
device          msk        # Marvell/SysKonnect Yukon II Gigabit Ethernet
device          nge        # NatSemi DP83820 gigabit ethernet
device          nve        # nVidia nForce MCP on-board Ethernet Networking
device          pcn        # AMD Am79C97x PCI 10/100 (precedence over 'lnc')
device          re         # RealTek 8139C+/8169/8169S/8110S
device          rl         # RealTek 8129/8139
device          sf         # Adaptec AIC-6915 (<quote>Starfire</quote>)
device          sis        # Silicon Integrated Systems SiS 900/SiS 7016
device          sk         # SysKonnect SK-984x &amp; SK-982x gigabit Ethernet
device          ste        # Sundance ST201 (D-Link DFE-550TX)
device          stge       # Sundance/Tamarack TC9021 gigabit Ethernet
device          ti         # Alteon Networks Tigon I/II gigabit Ethernet
device          tl         # Texas Instruments ThunderLAN
device          tx         # SMC EtherPower II (83c170 <quote>EPIC</quote>)
device          vge        # VIA VT612x gigabit ethernet
device          vr         # VIA Rhine, Rhine II
device          wb         # Winbond W89C840F
device          xl         # 3Com 3c90x (<quote>Boomerang</quote>, <quote>Cyclone</quote>)</programlisting>

    <para>Drivers that use the MII bus controller code.</para>

    <programlisting># ISA Ethernet NICs.  pccard NICs included.
device          cs         # Crystal Semiconductor CS89x0 NIC
# 'device ed' requires 'device miibus'
device          ed         # NE[12]000, SMC Ultra, 3c503, DS8390 cards
device          ex         # Intel EtherExpress Pro/10 and Pro/10+
device          ep         # Etherlink III based cards
device          fe         # Fujitsu MB8696x based cards
device          ie         # EtherExpress 8/16, 3C507, StarLAN 10 etc.
device          lnc        # NE2100, NE32-VL Lance Ethernet cards
device          sn         # SMC's 9000 series of Ethernet chips
device          xe         # Xircom pccard Ethernet

# ISA devices that use the old ISA shims
#device         le</programlisting>

    <para>ISA Ethernet drivers.  See
      <filename>/usr/src/sys/<replaceable>arch</replaceable>/conf/NOTES</filename>
      for details of which cards are supported by which driver.</para>

    <programlisting># Wireless NIC cards
device          wlan            # 802.11 support</programlisting>

    <para>Generic 802.11 support.  This line is required for wireless
      networking.</para>

    <programlisting>device          wlan_wep        # 802.11 WEP support
device          wlan_ccmp       # 802.11 CCMP support
device          wlan_tkip       # 802.11 TKIP support</programlisting>

    <para>Crypto support for 802.11 devices.  These lines are needed
      on systems which use encryption and 802.11i security
      protocols.</para>

    <programlisting>device          an         # Aironet 4500/4800 802.11 wireless NICs.
device          ath             # Atheros pci/cardbus NIC's
device          ath_hal         # Atheros HAL (Hardware Access Layer)
device          ath_rate_sample # SampleRate tx rate control for ath
device          awi        # BayStack 660 and others
device          ral        # Ralink Technology RT2500 wireless NICs.
device          wi         # WaveLAN/Intersil/Symbol 802.11 wireless NICs.
#device         wl         # Older non 802.11 Wavelan wireless NIC.</programlisting>

    <para>Support for various wireless cards.</para>

    <programlisting># Pseudo devices
device   loop          # Network loopback</programlisting>

    <para>This is the generic loopback device for TCP/IP.  This is
      <emphasis>mandatory</emphasis>.</para>

    <programlisting>device   random        # Entropy device</programlisting>

    <para>Cryptographically secure random number generator.</para>

    <programlisting>device   ether         # Ethernet support</programlisting>

    <para><literal>ether</literal> is only needed if the system has
      an Ethernet card.  It includes generic Ethernet protocol
      code.</para>

    <programlisting>device   sl            # Kernel SLIP</programlisting>

    <para><literal>sl</literal> provides SLIP support.  This has been
      almost entirely supplanted by PPP, which is easier to set up,
      better suited for modem-to-modem connection, and more
      powerful.</para>

    <programlisting>device   ppp           # Kernel PPP</programlisting>

    <para>This is for kernel PPP support for dial-up connections.
      There is also a version of PPP implemented as a userland
      application that uses <literal>tun</literal> and offers more
      flexibility and features such as demand dialing.</para>

    <programlisting>device   tun           # Packet tunnel.</programlisting>

    <para>This is used by the userland PPP software.  See the <link
	linkend="userppp">PPP</link> section of the Handbook for more
      information.</para>

    <programlisting><anchor xml:id="kernelconfig-ptys"/>
device   pty           # Pseudo-ttys (telnet etc)</programlisting>

    <para>This is a <quote>pseudo-terminal</quote> or simulated
      login port.  It is used by incoming <command>telnet</command>
      and <command>rlogin</command> sessions,
      <application>xterm</application>, and some other applications
      such as <application>Emacs</application>.</para>

    <programlisting>device   md            # Memory <quote>disks</quote></programlisting>

    <para>Memory disk pseudo-devices.</para>

    <programlisting>device   gif           # IPv6 and IPv4 tunneling</programlisting>

    <para>This implements IPv6 over IPv4 tunneling, IPv4 over IPv6
      tunneling, IPv4 over IPv4 tunneling, and IPv6 over IPv6
      tunneling.  The <literal>gif</literal> device is
      <quote>auto-cloning</quote>, and will create device nodes as
      needed.</para>

    <programlisting>device   faith         # IPv6-to-IPv4 relaying (translation)</programlisting>

    <para>This pseudo-device captures packets that are sent to it and
      diverts them to the IPv4/IPv6 translation daemon.</para>

    <programlisting># The `bpf' device enables the Berkeley Packet Filter.
# Be aware of the administrative consequences of enabling this!
# Note that 'bpf' is required for DHCP.
device   bpf           # Berkeley packet filter</programlisting>

    <para>The Berkeley Packet Filter pseudo-device allows network
      interfaces to be placed in promiscuous mode, capturing every
      packet on a broadcast network such as an Ethernet network.
      These packets can be captured to disk and or examined using
      &man.tcpdump.1;.</para>

    <note>
      <para>The &man.bpf.4; device is also used by &man.dhclient.8;.
	If DHCP is used, leave this uncommented.</para>
    </note>

    <programlisting># USB support
device          uhci          # UHCI PCI-&gt;USB interface
device          ohci          # OHCI PCI-&gt;USB interface
device          ehci          # EHCI PCI-&gt;USB interface (USB 2.0)
device          usb           # USB Bus (required)
#device         udbp          # USB Double Bulk Pipe devices
device          ugen          # Generic
device          uhid          # <quote>Human Interface Devices</quote>
device          ukbd          # Keyboard
device          ulpt          # Printer
device          umass         # Disks/Mass storage - Requires scbus and da
device          ums           # Mouse
device          ural          # Ralink Technology RT2500USB wireless NICs
device          urio          # Diamond Rio 500 MP3 player
device          uscanner      # Scanners
# USB Ethernet, requires mii
device          aue           # ADMtek USB Ethernet
device          axe           # ASIX Electronics USB Ethernet
device          cdce          # Generic USB over Ethernet
device          cue           # CATC USB Ethernet
device          kue           # Kawasaki LSI USB Ethernet
device          rue           # RealTek RTL8150 USB Ethernet</programlisting>

    <para>Support for various USB devices.</para>

    <programlisting># FireWire support
device          firewire      # FireWire bus code
device          sbp           # SCSI over FireWire (Requires scbus and da)
device          fwe           # Ethernet over FireWire (non-standard!)</programlisting>

    <para>Support for various Firewire devices.</para>

    <para>For more information and additional devices supported by
      &os;, see
      <filename>/usr/src/sys/<replaceable>arch</replaceable>/conf/NOTES</filename>.</para>
      -->

  <!--
  This section refers to ancient hardware.
    <sect2>
      <title>Large Memory Configurations
	(<acronym>PAE</acronym>)</title>

      <indexterm>
	<primary>Physical Address Extensions
	    (<acronym>PAE</acronym>)</primary>
	  <secondary>large memory</secondary>
      </indexterm>

      <para>Large memory configuration machines require access to
	more than the 4 gigabyte limit on User+Kernel Virtual
	Address (<acronym>KVA</acronym>) space.  Due to this
	limitation, Intel added support for 36-bit physical address
	space access in the &pentium; Pro and later line of
	CPUs.</para>

      <para>The Physical Address Extension (<acronym>PAE</acronym>)
	capability of the &intel; &pentium; Pro and later CPUs allows
	memory configurations of up to 64 gigabytes.  &os; provides
	support for this capability via the <option>PAE</option>
	kernel configuration option, available in all current release
	versions of &os;.  Due to the limitations of the Intel memory
	architecture, no distinction is made for memory above or below
	4 gigabytes.  Memory allocated above 4 gigabytes is simply
	added to the pool of available memory.</para>

      <para>To enable <acronym>PAE</acronym> support in the kernel,
	add the following line to the kernel configuration
	file:</para>

      <programlisting>options		    PAE</programlisting>

	<note>
	  <para>The <acronym>PAE</acronym> support in &os; is only
	    available for &intel; IA-32 processors.  It should also be
	    noted that the <acronym>PAE</acronym> support in &os; has
	    not received wide testing, and should be considered beta
	    quality compared to other stable features of &os;.</para>
	</note>

	<para><acronym>PAE</acronym> support in &os; has a few
	  limitations:</para>

	<itemizedlist>
	  <listitem>
	    <para>A process is not able to access more than 4
	      gigabytes of virtual memory space.</para>
	  </listitem>

	  <listitem>
	    <para>Device drivers that do not use the &man.bus.dma.9;
	      interface will cause data corruption in a
	      <acronym>PAE</acronym> enabled kernel and are not
	      recommended for use.  For this reason, a
	      <filename>PAE</filename> kernel configuration file is
	      provided in &os; which excludes all drivers not known to
	      work in a <acronym>PAE</acronym> enabled kernel.</para>
	  </listitem>

	  <listitem>
	    <para>Some system tunables determine memory resource usage
	      by the amount of available physical memory.  Such
	      tunables can unnecessarily over-allocate due to the
	      large memory nature of a <acronym>PAE</acronym> system.
	      One such example is the
	      <varname>kern.maxvnodes</varname> sysctl, which controls
	      the maximum number of vnodes allowed in the kernel.  It
	      is advised to adjust this and other such tunables to a
	      reasonable value.</para>
	  </listitem>

	  <listitem>
	    <para>It might be necessary to increase the kernel virtual
	      address (<acronym>KVA</acronym>) space or to reduce the
	      amount of specific kernel resource that is heavily used
	      in order to avoid <acronym>KVA</acronym> exhaustion.
	      The <option>KVA_PAGES</option> kernel option can be used
	      for increasing the <acronym>KVA</acronym> space.</para>
	  </listitem>
	</itemizedlist>

	<para>For performance and stability concerns, it is advised to
	  consult &man.tuning.7;.  &man.pae.4; contains up-to-date
	  information on &os;'s <acronym>PAE</acronym> support.</para>
      </sect2>
-->
  </sect1>

  <sect1 xml:id="kernelconfig-building">
    <title>Criando e Instalando um Kernel Customizado</title>

    <para>Depois que as edições no arquivo de configuração personalizada forem salvas, o código-fonte do kernel poderá ser compilado usando as seguintes etapas:</para>

    <procedure>
      <title>Compilando um Kernel</title>

      <indexterm><primary>kernel</primary> <secondary>building / installing</secondary></indexterm>

      <step>
	<para>Mude para este diretório:</para>

	<screen><prompt>#</prompt> <userinput>cd /usr/src</userinput></screen>
      </step>

      <step>
	<para>Compile o novo kernel especificando o nome do arquivo de configuração do kernel personalizado:</para>

	<screen><prompt>#</prompt> <userinput>make buildkernel KERNCONF=<replaceable>MYKERNEL</replaceable></userinput></screen>
      </step>

      <step>
	<para>Instale o novo kernel associado ao arquivo de configuração do kernel especificado. Este comando irá copiar o novo kernel para <filename>/boot/kernel/kernel</filename> e salvar o kernel antigo para <filename>/boot/kernel.old/kernel</filename>:</para>

	<screen><prompt>#</prompt> <userinput>make installkernel KERNCONF=<replaceable>MYKERNEL</replaceable></userinput></screen>
      </step>

      <step>
	<para>Desligue o sistema e reinicie no novo kernel. Se algo der errado, consulte <xref linkend="kernelconfig-noboot"/>.</para>
      </step>
    </procedure>

    <para>Por padrão, quando um kernel personalizado é compilado, todos os módulos do kernel são reconstruídos. Para atualizar um kernel mais rapidamente ou para construir apenas módulos customizados, edite o <filename>/etc/make.conf</filename> antes de começar a construir o kernel.</para>

    <para>Por exemplo, esta variável especifica a lista de módulos para compilar em vez de usar o padrão de construir todos os módulos:</para>

    <programlisting>MODULES_OVERRIDE = linux acpi</programlisting>

    <para>Como alternativa, essa variável lista quais módulos excluir do processo de criação:</para>

    <programlisting>WITHOUT_MODULES = linux acpi sound</programlisting>

    <para>Variáveis adicionais estão disponíveis. Consulte <citerefentry><refentrytitle>make.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry> para detalhes.</para>

    <indexterm><primary><filename>/boot/kernel.old</filename></primary></indexterm>
  </sect1>

  <sect1 xml:id="kernelconfig-trouble">
    <title>Se algo der errado</title>

    <para>Existem quatro categorias de problemas que podem ocorrer ao criar um kernel personalizado:</para>

    <variablelist>
      <varlistentry>
	<term>falhas na <command>config</command></term>

	<listitem>
	  <para>Se o <command>config</command> falhar, ele imprimirá o número da linha que está incorreta. Como exemplo, para a seguinte mensagem, certifique-se de que a linha 17 seja digitada corretamente, comparando-a com <filename>GENERIC</filename> ou <filename>NOTES</filename>:</para>

	  <screen>config: line 17: syntax error</screen>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>falha no <command>make</command></term>

	<listitem>
	  <para>Se o <command>make</command> falhar, geralmente é devido a um erro no arquivo de configuração do kernel que não é grave o suficiente para o <command>config</command> capturar. Revise a configuração, e se o problema não for aparente, envie um email para a <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions">lista de discussão de questões gerais do FreeBSD</link> contendo o arquivo de configuração do kernel.</para>
	</listitem>
      </varlistentry>

      <varlistentry xml:id="kernelconfig-noboot">
	<term>O kernel não inicializa</term>

	<listitem>
	  <para>Se o novo kernel não inicializar ou não reconhecer os dispositivos, não entre em pânico! Felizmente, o FreeBSD possui um excelente mecanismo para recuperação de kernels incompatíveis. Simplesmente escolha o kernel para inicializar a partir do gerenciador de inicialização do FreeBSD. Isso pode ser acessado quando o menu de inicialização do sistema aparecer, selecionando a opção <quote>Escape to a loader prompt</quote>. No prompt, digite <command>boot <replaceable>kernel.old</replaceable></command> ou o nome de qualquer outro kernel que seja conhecido por inicializar corretamente.</para>

	  <para>Após inicializar com um kernel correto, verifique o arquivo de configuração e tente construí-lo novamente. Um recurso útil é o <filename>/var/log/messages</filename> que registra as mensagens do kernel de cada inicialização bem-sucedida. Além disso, o <citerefentry><refentrytitle>dmesg</refentrytitle><manvolnum>8</manvolnum></citerefentry> imprimirá as mensagens do kernel a partir da inicialização atual.</para>

	  <note>
	    <para>Ao solucionar problemas de um kernel, certifique-se de manter uma cópia do <filename>GENERIC</filename>, ou algum outro kernel que funcione, como um nome diferente que não será apagado na próxima compilação. Isto é importante porque toda vez que um novo kernel é instalado, o <filename>kernel.old</filename> é sobrescrito com o último kernel instalado, que pode ou não ser inicializável. Assim que possível, mova o kernel funcional renomeando o diretório que contém o kernel correto:</para>

	    <screen><prompt>#</prompt> <userinput>mv /boot/kernel <replaceable>/boot/kernel.bad</replaceable></userinput>
<prompt>#</prompt> <userinput>mv /boot/<replaceable>kernel.good</replaceable> /boot/kernel</userinput></screen>
	  </note>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>O kernel funciona, mas o <citerefentry><refentrytitle>ps</refentrytitle><manvolnum>1</manvolnum></citerefentry> não</term>

	<listitem>
	  <para>Se a versão do kernel for diferente daquela com a qual os utilitários do sistema foram construídos, por exemplo, um kernel compilado a partir do código-fonte do -CURRENT é instalado em um sistema -RELEASE, muitos comandos de status do sistema como <citerefentry><refentrytitle>ps</refentrytitle><manvolnum>1</manvolnum></citerefentry> e <citerefentry><refentrytitle>vmstat</refentrytitle><manvolnum>8</manvolnum></citerefentry> não funcionarão. Para corrigir isso, <link linkend="makeworld">recompile e instale o world</link> usando a mesma versão da árvore de código-fonte que o kernel. Nunca é uma boa ideia usar uma versão diferente do kernel do que o resto do sistema operacional.</para>
	</listitem>
      </varlistentry>
    </variablelist>
  </sect1>
</chapter>

    
<!--
    The FreeBSD Documentation Project

    $FreeBSD$
-->
<chapter version="5.0" xml:id="printing">

  <info>
    <title>Impressão</title>

    <authorgroup>
      <author><personname><firstname>Warren</firstname> <surname>Block</surname> </personname><contrib> Originalmente contribuído por </contrib></author>
    </authorgroup>
  </info>

  <para>Colocar informações no papel é uma função vital, apesar de muitas tentativas de eliminá-la. A impressão tem dois componentes básicos. Os dados devem ser entregues à impressora e devem estar em um formato que a impressora possa entender.</para>

  <sect1 xml:id="printing-quick-start">
    <title>Inicio Rápido</title>

    <para>A impressão básica pode ser configurada rapidamente. A impressora deve ser capaz de imprimir texto simples <acronym>ASCII</acronym>. Para imprimir em outros tipos de arquivos, consulte <xref linkend="printing-lpd-filters"/>.</para>

    <procedure>
      <step>
	<para>Crie um diretório para armazenar arquivos enquanto eles estão sendo impressos:</para>

	<screen><prompt>#</prompt> <userinput>mkdir -p /var/spool/lpd/lp</userinput>
<prompt>#</prompt> <userinput>chown daemon:daemon /var/spool/lpd/lp</userinput>
<prompt>#</prompt> <userinput>chmod 770 /var/spool/lpd/lp</userinput></screen>
      </step>

      <step>
	<para>Como <systemitem class="username">root</systemitem>, crie <filename>/etc/printcap</filename> com estes conteúdos:</para>

	<programlisting>lp:\
	<replaceable>:lp=/dev/unlpt0:\</replaceable>  <co xml:id="printing-qs-co-printcap"/>
	:sh:\
	:mx#0:\
	:sd=/var/spool/lpd/lp:\
	:lf=/var/log/lpd-errs:</programlisting>

	<calloutlist>
	  <callout arearefs="printing-qs-co-printcap">
	    <para>Esta linha é para uma impressora conectada a uma porta <acronym>USB</acronym>.</para>

	    <para>Para uma impressora conectada a uma porta paralela ou uma porta de <quote>impressora</quote>, use:</para>

	    <programlisting>:lp=/dev/lpt0:\</programlisting>

	    <para>Para uma impressora conectada diretamente a uma rede, use:</para>

	    <programlisting>:lp=:rm=<replaceable>network-printer-name</replaceable>:rp=raw:\</programlisting>

	    <para>Substitua <replaceable>network-printer-name</replaceable> pelo nome de host <acronym>DNS</acronym> da impressora de rede.</para>
	  </callout>
	</calloutlist>
      </step>

      <step>
	<para>Ative o <command>lpd</command> editando o <filename>/etc/rc.conf</filename>, adicionando esta linha:</para>

	<programlisting>lpd_enable="YES"</programlisting>

	<para>Inicie o serviço:</para>

	<screen><prompt>#</prompt> <userinput>service lpd start</userinput>
Starting lpd.</screen>
      </step>

      <step>
	<para>Imprima um teste:</para>

	<screen><prompt>#</prompt> <userinput>printf "1. This printer can print.\n2. This is the second line.\n" | lpr</userinput></screen>

	<tip>
	  <para>Se ambas as linhas não iniciarem na borda esquerda, mas em <quote>degrau</quote>, consulte <xref linkend="printing-lpd-filters-stairstep"/>.</para>
	</tip>

	<para>Arquivos de texto agora podem ser impressos com <command>lpr</command>. Dê o nome do arquivo na linha de comando ou canalize a saída diretamente no <command>lpr</command>.</para>

	<screen><prompt>%</prompt> <userinput>lpr textfile.txt</userinput>
<prompt>%</prompt> <userinput>ls -lh | lpr</userinput></screen>
      </step>
    </procedure>
  </sect1>

  <sect1 xml:id="printing-connections">
    <title>Conexões de Impressora</title>

    <para>As impressoras são conectadas a sistemas de computadores de várias maneiras. Geralmente, as impressoras desktop pequenas são conectadas diretamente à porta <acronym>USB</acronym> do computador. As impressoras mais antigas são conectadas a uma porta paralela ou a porta de <quote>impressora</quote>. Algumas impressoras estão diretamente conectadas a uma rede, facilitando o compartilhamento com vários computadores. Algumas impressoras usam uma rara conexão de porta serial.</para>

    <para>O FreeBSD pode se comunicar com todos esses tipos de impressoras.</para>

    <variablelist>
      <varlistentry xml:id="printing-connections-usb">
	<term><acronym>USB</acronym></term>

	<listitem>
	  <para>As impressoras <acronym>USB</acronym> podem ser conectadas a qualquer porta <acronym>USB</acronym> disponível no computador.</para>

	  <para>Quando o FreeBSD detecta uma impressora <acronym>USB</acronym>, duas entradas de dispositivos são criadas: <filename>/dev/ulpt0</filename> e <filename>/dev/unlpt0</filename>. Os dados enviados para qualquer dispositivo serão retransmitidos para a impressora. Após cada trabalho de impressão, o <filename>ulpt0</filename> reseta a porta <acronym>USB</acronym>. O reset da porta pode causar problemas em algumas impressoras, portanto, o dispositivo <filename>unlpt0</filename> é normalmente usado em seu lugar. O <filename>unlpt0</filename> não reseta a porta USB.</para>
	</listitem>
      </varlistentry>

      <varlistentry xml:id="printing-connections-parallel">
	<term>Paralela (<acronym>IEEE</acronym>-1284)</term>

	<listitem>
	  <para>O dispositivo da porta paralela é o <filename>/dev/lpt0</filename>. Este dispositivo aparece independentemente se uma impressora está ou não conectada, ela não é autodetectada.</para>

	  <para>A maior parte dos fabricantes se afastou destas portas <quote>legadas</quote> e muitos computadores não as têm mais. Adaptadores podem ser usados para conectar uma impressora paralela a uma porta <acronym>USB</acronym>. Com este tipo de adaptador, a impressora pode ser tratada como se fosse uma impressora <acronym>USB</acronym>. Dispositivos chamados <emphasis>servidores de impressão</emphasis> também podem ser usados para conectar impressoras paralelas diretamente a uma rede.</para>
	</listitem>
      </varlistentry>

      <varlistentry xml:id="printing-connections-serial">
	<term>Serial (RS-232)</term>

	<listitem>
	  <para>Portas seriais são outro tipo de porta legada, raramente usada para impressoras, exceto em determinadas aplicações  de nicho. Os cabos, os conectores e a fiação necessária variam muito.</para>

	  <para>Para portas seriais incorporadas em uma placa-mãe, o nome do dispositivo serial é <filename>/dev/cuau0</filename> ou <filename>/dev/cuau1</filename>. Os adaptadores Seriais <acronym>USB</acronym> também podem ser usados, e eles aparecerão como <filename>/dev/cuaU<replaceable>0</replaceable></filename>.</para>

	  <para>Vários parâmetros de comunicação devem ser conhecidos para se comunicar com uma impressora serial. Os mais importantes são <emphasis>baud rate</emphasis> ou <acronym>BPS</acronym> (Bits por segundo) e <emphasis>paridade</emphasis>. Os valores variam, mas as impressoras seriais típicas usam uma taxa de transmissão de 9600 e nenhuma paridade.</para>
	</listitem>
      </varlistentry>

      <varlistentry xml:id="printing-connections-network">
	<term>Rede</term>

	<listitem>
	  <para>As impressoras de rede estão conectadas diretamente à rede de computadores local.</para>

	  <para>O nome de host <acronym>DNS</acronym> da impressora deve ser conhecido. Se a impressora tiver um endereço dinâmico atribuído por <acronym>DHCP</acronym>, o <acronym>DNS</acronym> deverá ser atualizado dinamicamente para que o nome do host tenha sempre o endereço <acronym>IP</acronym> correto. As impressoras de rede geralmente recebem endereços <acronym>IP</acronym> estáticos para evitar esse problema.</para>

	  <para>A maioria das impressoras de rede entende os trabalhos de impressão enviados com o protocolo <acronym>LPD</acronym>. Um nome de fila de impressão também pode ser especificado. Algumas impressoras processam dados de maneira diferente, dependendo de qual fila é usada. Por exemplo, uma fila <literal>raw</literal> imprime os dados inalterados, enquanto a fila <literal>text</literal> adiciona retornos de carro aos textos simples.</para>

	  <para>Muitas impressoras de rede também podem imprimir dados enviados diretamente para a porta 9100.</para>
	</listitem>
      </varlistentry>
    </variablelist>

    <sect2 xml:id="printing-connections-summary">
      <title>Resumo</title>

      <para>As conexões de rede com fio geralmente são as mais fáceis de configurar e oferecem a impressão mais rápida. Para conexão direta com o computador, a conexão <acronym>USB</acronym> é preferida em função da velocidade e da  simplicidade. As conexões paralelas funcionam, mas têm limitações no comprimento do cabo e na velocidade. Conexões seriais são mais difíceis de configurar. A configuração do cabo difere entre os modelos, e os parâmetros de comunicação, como taxa de transmissão e bits de paridade, se somam a complexidade. Felizmente, as impressoras seriais são raras.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="printing-pdls">
    <title>Linguagens de Descrição de Página Comuns</title>

    <para>Os dados enviados a uma impressora devem estar em um idioma que a impressora possa entender. Esses idiomas são chamados de Linguagens de Descrição de Página ou <acronym>PDL</acronym>s.</para>

    <variablelist>
      <varlistentry xml:id="print-pdls-ascii">
	<term><acronym>ASCII</acronym></term>

	<listitem>
	  <para>Texto <acronym>ASCII</acronym> simples é a maneira mais simples de enviar dados para uma impressora. Os caracteres correspondem um a um com o que será impresso: um <literal>A</literal> nos dados imprime um <literal>A</literal> na página. Muito pouca formatação está disponível. Não há como selecionar uma fonte ou espaçamento proporcional. A simplicidade forçada do texto <acronym>ASCII</acronym> simples significa que o texto pode ser impresso diretamente do computador com pouca ou nenhuma codificação ou tradução. A saída impressa corresponde diretamente ao que foi enviado.</para>

	  <para>Algumas impressoras baratas não conseguem imprimir texto <acronym>ASCII</acronym> simples. Isso as torna mais difíceis de configurar, mas geralmente ainda é possível fazê-lo.</para>
	</listitem>
      </varlistentry>

      <varlistentry xml:id="print-pdls-postscript">
	<term><trademark class="registered">PostScript</trademark></term>

	<listitem>
	  <para>O <trademark class="registered">PostScript</trademark> é quase o oposto do <acronym>ASCII</acronym>. Em vez de um texto simples, um programa <trademark class="registered">PostScript</trademark> é um conjunto de instruções que desenham o documento final. Fontes e gráficos diferentes podem ser usados. No entanto, esse poder tem um preço. O programa que desenha a página deve ser escrito. Geralmente este programa é gerado pelo software aplicativo, portanto, o processo é invisível para o usuário.</para>

	  <para>Impressoras baratas às vezes deixam de fora a compatibilidade com o <trademark class="registered">PostScript</trademark> como uma medida para economia de custos.</para>
	</listitem>
      </varlistentry>

      <varlistentry xml:id="print-pdls-pcl">
	<term><acronym>PCL</acronym> (linguagem de comando de impressora)</term>

	<listitem>
	  <para>A <acronym>PCL</acronym> é uma extensão do <acronym>ASCII</acronym>, adicionando sequências de escape para formatação, seleção de fontes e impressão de gráficos. Muitas impressoras fornecem suporte para <acronym>PCL5</acronym>. Algumas suportam o mais recente <acronym>PCL6</acronym> ou o <acronym>PCLXL</acronym>. Essas versões posteriores são superconjuntos do <acronym>PCL5</acronym> e podem fornecer uma impressão mais rápida.</para>
	</listitem>
      </varlistentry>

      <varlistentry xml:id="print-pdls-host-based">
	<term>Baseado em Host</term>

	<listitem>
	  <para>Os fabricantes podem reduzir o custo de uma impressora, oferecendo um processador simples e muito pouca memória. Essas impressoras não são capazes de imprimir texto simples. Em vez disso, bitmaps de texto e gráficos são desenhados por um driver no computador host e, em seguida, enviados para a impressora. Estas são chamadas de impressoras <emphasis>baseadas em host</emphasis>.</para>

	  <para>A comunicação entre o driver e uma impressora baseada em host geralmente ocorre por meio de protocolos proprietários ou não documentados, tornando-os funcionais apenas nos sistemas operacionais mais comuns.</para>
	</listitem>
      </varlistentry>
    </variablelist>

    <sect2 xml:id="print-pdls-table">
      <title>Convertendo <trademark class="registered">PostScript</trademark> para outros <acronym>PDL</acronym>s</title>

      <para>Muitas aplicações da Coleção de Ports e muitos utilitários do FreeBSD produzem uma saída em <trademark class="registered">PostScript</trademark>. Esta tabela mostra os utilitários disponíveis para converter o postscript em outros <acronym>PDL</acronym>s comuns:</para>

      <table xml:id="print-pdls-ps-to-other-tbl" frame="none">
	<title>Saída <acronym>PDL</acronym>s</title>

	<tgroup cols="3" align="left">
	  <thead>
	    <row>
	      <entry align="left">Saída <acronym>PDL</acronym></entry>
	      <entry align="left">Gerado por</entry>
	      <entry align="left">Notas</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><acronym>PCL</acronym> ou <acronym>PCL5</acronym></entry>
	      <entry><package role="port">print/ghostscript9</package></entry>
	      <entry><literal>-sDEVICE=ljet4</literal> para monocromático, e <literal>-sDEVICE=cljet5</literal> para colorido</entry>
	    </row>

	    <row>
	      <entry><acronym>PCLXL</acronym> ou <acronym>PCL6</acronym></entry>
	      <entry><package role="port">print/ghostscript9</package></entry>
	      <entry><literal>-sDEVICE=pxlmono</literal> para monocromático, <literal>-sDEVICE=pxlcolor</literal> para colorido</entry>
	    </row>

	    <row>
	      <entry><acronym>ESC/P2</acronym></entry>
	      <entry><package role="port">print/ghostscript9</package></entry>
	      <entry><literal>-sDEVICE=uniprint</literal></entry>
	    </row>

	    <row>
	      <entry><acronym>XQX</acronym></entry>
	      <entry><package role="port">print/foo2zjs</package></entry>
	      <entry/>
	    </row>
	  </tbody>
	</tgroup>
      </table>
    </sect2>

    <sect2 xml:id="print-pdls-summary">
      <title>Resumo</title>

      <para>Para facilitar a impressão, escolha uma impressora que suporte <trademark class="registered">PostScript</trademark>. Impressoras que suportam <acronym>PCL</acronym> são as próximas preferidas. Com o <package role="port">print/ghostscript</package>, essas impressoras podem ser usadas como se entendessem nativamente <trademark class="registered">PostScript</trademark>. Impressoras que suportam <trademark class="registered">PostScript</trademark> ou <acronym>PCL</acronym> diretamente quase sempre suportam a impressão direta de arquivos de texto simples <acronym>ASCII</acronym> também.</para>

      <para>Impressoras baseadas em linha, como as jatos de tinta comuns, geralmente não suportam <trademark class="registered">PostScript</trademark> ou <acronym>PCL</acronym>. Elas geralmente podem imprimir arquivos de texto plano <acronym>ASCII</acronym>. O <package role="port">print/ghostscript</package> suporta os <acronym>PDL</acronym> usados por algumas dessas impressoras. Entretanto, a impressão de uma página inteira baseada em gráficos nessas impressoras costuma ser muito lenta devido à grande quantidade de dados a serem transferidos e impressos.</para>

      <para>Geralmente, as impressoras baseadas em host são mais difíceis de configurar. Algumas não podem ser usadas por causa de <acronym>PDL</acronym>s proprietários. Evite essas impressoras quando possível.</para>

      <para>Descrições de muitos <acronym>PDL</acronym>s podem ser encontradas em <link xlink:href="http://www.undocprint.org/formats/page_description_languages"/>. O <acronym>PDL</acronym> específico usado por vários modelos de impressoras pode ser encontrado em <link xlink:href="http://www.openprinting.org/printers"/>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="printing-direct">
    <title>Impressão Direta</title>

    <para>Para impressão ocasional, os arquivos podem ser enviados diretamente para um dispositivo de impressora sem qualquer configuração. Por exemplo, um arquivo chamado <filename>exemplo.txt</filename> pode ser enviado para uma impressora <acronym>USB</acronym>:</para>

    <screen><prompt>#</prompt> <userinput>cp sample.txt /dev/unlpt0</userinput></screen>

    <para>A impressão direta para impressoras de rede depende das capacidades da impressora, mas a maioria aceita trabalhos de impressão na porta 9100, e o <citerefentry><refentrytitle>nc</refentrytitle> <manvolnum>1</manvolnum></citerefentry> pode ser usado com eles. Para imprimir o mesmo arquivo em uma impressora com o nome de host <acronym>DNS</acronym> de <replaceable>netlaser</replaceable>:</para>

    <screen><prompt>#</prompt> <userinput>nc <replaceable>netlaser</replaceable> 9100 &lt; sample.txt</userinput></screen>
  </sect1>

  <sect1 xml:id="printing-lpd">
    <title><acronym>LPD</acronym> (Daemon de impressora de linha)</title>

    <para>A impressão de um arquivo em segundo plano é chamada de <emphasis>spooling</emphasis>. Um spooler permite que o usuário continue com outros programas no computador sem ter de esperar que a impressora conclua lentamente o trabalho de impressão.</para>

    <para>O FreeBSD inclui um spooler chamado <citerefentry><refentrytitle>lpd</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Os trabalhos de impressão são enviados com o comando <citerefentry><refentrytitle>lpr</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</para>

    <sect2 xml:id="printing-lpd-setup">
      <title>Configuração inicial</title>

      <para>Um diretório para armazenar trabalhos de impressão é criado, a propriedade é definida e as permissões são definidas para impedir que outros usuários visualizem o conteúdo desses arquivos:</para>

      <screen><prompt>#</prompt> <userinput>mkdir -p /var/spool/lpd/lp</userinput>
<prompt>#</prompt> <userinput>chown daemon:daemon /var/spool/lpd/lp</userinput>
<prompt>#</prompt> <userinput>chmod 770 /var/spool/lpd/lp</userinput></screen>

      <para>As impressoras são definidas no <filename>/etc/printcap</filename>. Uma entrada para cada impressora inclui detalhes como um nome, a porta onde ela está conectada e várias outras configurações. Crie <filename>/etc/printcap</filename> com estes conteúdos:</para>

      <programlisting>lp:\				<co xml:id="printing-lpd-co-name"/>
	:lp=/dev/unlpt0:\	<co xml:id="printing-lpd-co-device"/>
	:sh:\			<co xml:id="printing-lpd-co-header"/>
	:mx#0:\			<co xml:id="printing-lpd-co-mx"/>
	:sd=/var/spool/lpd/lp:\	<co xml:id="printing-lpd-co-sd"/>
	:lf=/var/log/lpd-errs:	<co xml:id="printing-lpd-co-lf"/></programlisting>

      <calloutlist>
	<callout arearefs="printing-lpd-co-name">
	  <para>O nome desta impressora. O <citerefentry><refentrytitle>lpr</refentrytitle><manvolnum>1</manvolnum></citerefentry> envia trabalhos de impressão para a impressora <literal>lp</literal>, a menos que outra impressora seja especificada com <option>-P</option>, portanto, a impressora padrão deve ser denominada <literal>lp</literal>.</para>
	</callout>

	<callout arearefs="printing-lpd-co-device">
	  <para>O dispositivo em que a impressora está conectada. Substitua esta linha pela apropriada para o tipo de conexão mostrado aqui.</para>

	  <informaltable xml:id="printing-lpd-co-device-tbl">
	    <tgroup cols="2">
	      <thead>
		<row>
		  <entry>Tipo de conexão</entry>
		  <entry>Entrada de Dispositivos no <filename>/etc/printcap</filename></entry>
		</row>
	      </thead>

	      <tbody>
		<row>
		  <entry><acronym>USB</acronym></entry>
		  <entry><programlisting>:lp=/dev/unlpt0:\</programlisting>

		    <para>Este é o dispositivo de impressora <acronym>USB</acronym> que <emphasis>não reseta</emphasis>. Se houver problemas, use o <filename>ulpt0</filename>, ele reseta a porta <acronym>USB</acronym> após cada uso.</para></entry>
		</row>

		<row>
		  <entry>Paralelo</entry>
		  <entry><programlisting>:lp=/dev/lpt0:\</programlisting></entry>
		</row>

		<row>
		  <entry>Rede</entry>

		  <entry><para>Para uma impressora que suporta o protocolo <acronym>LPD</acronym>:</para>

		    <programlisting>:lp=:rm=<replaceable>network-printer-name</replaceable>:rp=raw:\</programlisting>

		    <para>Para impressoras que suportam impressão na porta 9100:</para>

		    <programlisting>:lp=9100@<replaceable>network-printer-name</replaceable>:\</programlisting>

		    <para>Para ambos os tipos, substitua <replaceable>network-printer-name</replaceable> pelo nome de host <acronym>DNS</acronym> da impressora na rede.</para></entry>
		</row>

		<row>
		  <entry>Serial</entry>
		  <entry><programlisting>:lp=/dev/cuau0:br=9600:pa=none:\</programlisting>

		    <para>Esses valores são para uma impressora serial comum conectada a uma porta serial da placa-mãe. A taxa de transmissão é 9600 e nenhuma paridade é usada.</para></entry>
		</row>
	      </tbody>
	    </tgroup>
	  </informaltable>
	</callout>

	<callout arearefs="printing-lpd-co-header">
	  <para>Suprimir a impressão de uma página de cabeçalho no início de um trabalho de impressão.</para>
	</callout>

	<callout arearefs="printing-lpd-co-mx">
	  <para>Não limite o tamanho máximo de um trabalho de impressão.</para>
	</callout>

	<callout arearefs="printing-lpd-co-sd">
	  <para>O caminho para o diretório de spooling desta impressora. Cada impressora usa seu próprio diretório de spooling.</para>
	</callout>

	<callout arearefs="printing-lpd-co-lf">
	  <para>O arquivo de log no qual os erros nesta impressora serão relatados.</para>
	</callout>
      </calloutlist>

      <para>Depois de criar o <filename>/etc/printcap</filename>, use <citerefentry><refentrytitle>chkprintcap</refentrytitle><manvolnum>8</manvolnum></citerefentry> para testar se há erros:</para>

      <screen><prompt>#</prompt> <userinput>chkprintcap</userinput></screen>

      <para>Corrija quaisquer problemas relatados antes de continuar.</para>

      <para>Ative o <citerefentry><refentrytitle>lpd</refentrytitle><manvolnum>8</manvolnum></citerefentry> no <filename>/etc/rc.conf</filename>:</para>

      <programlisting>lpd_enable="YES"</programlisting>

      <para>Inicie o serviço:</para>

      <screen><prompt>#</prompt> <userinput>service lpd start</userinput></screen>
    </sect2>

    <sect2 xml:id="printing-lpd-lpr">
      <title>Imprimindo com o <citerefentry><refentrytitle>lpr</refentrytitle><manvolnum>1</manvolnum></citerefentry></title>

      <para>Os documentos são enviados para a impressora com o <command>lpr</command>. Um arquivo a ser impresso pode ser nomeado na linha de comando ou canalizado para o <command>lpr</command>. Esses dois comandos são equivalentes, enviando o conteúdo de <filename>doc.txt</filename> para a impressora padrão:</para>

      <screen><prompt>%</prompt> <userinput>lpr doc.txt</userinput>
<prompt>%</prompt> <userinput>cat doc.txt | lpr</userinput></screen>

      <para>Impressoras podem ser selecionadas com <option>-P</option>. Para imprimir em uma impressora chamada <replaceable>laser</replaceable>:</para>

      <screen><prompt>%</prompt> <userinput>lpr -Plaser doc.txt</userinput></screen>
    </sect2>

    <sect2 xml:id="printing-lpd-filters">
      <title>Filtros</title>

      <para>Os exemplos mostrados até agora enviaram o conteúdo de um arquivo de texto diretamente para a impressora. Contanto que a impressora entenda o conteúdo desses arquivos, a saída será impressa corretamente.</para>

      <para>Algumas impressoras não são capazes de imprimir texto simples, e o arquivo de entrada pode nem ser texto simples.</para>

      <para><emphasis>Filtros</emphasis> permitem que os arquivos sejam traduzidos ou processados. O uso típico é traduzir um tipo de entrada, como texto simples, em um formato que a impressora possa entender, como <trademark class="registered">PostScript</trademark> ou <acronym>PCL</acronym>. Os filtros também podem ser usados para fornecer recursos adicionais, como adicionar números de página ou destacar o código-fonte para facilitar a leitura.</para>

      <para>Os filtros discutidos aqui são <emphasis>filtros de entrada</emphasis> ou <emphasis>filtros de texto</emphasis>. Esses filtros convertem o arquivo recebido em diferentes formatos. Use <citerefentry><refentrytitle>su</refentrytitle><manvolnum>1</manvolnum></citerefentry> para se tornar <systemitem class="username">root</systemitem> antes de criar os arquivos.</para>

      <para>Os filtros são especificados em <filename>/etc/printcap</filename> com o identificador <literal>if=</literal>. Para usar <filename>/usr/local/libexec/lf2crlf</filename> como um filtro, modifique o <filename>/etc/printcap</filename> assim:</para>

      <programlisting>lp:\
	:lp=/dev/unlpt0:\
	:sh:\
	:mx#0:\
	:sd=/var/spool/lpd/lp:\
	:if=/usr/local/libexec/lf2crlf:\   <co xml:id="printing-lpd-filters-co-if"/>
	:lf=/var/log/lpd-errs:</programlisting>

      <calloutlist>
	<callout arearefs="printing-lpd-filters-co-if">
	  <para><literal>if=</literal> identifica o <emphasis>filtro de entrada</emphasis> que será usado no texto recebido.</para>
	</callout>
      </calloutlist>

      <tip xml:id="printing-lpd-filters-oneline">
	<para>Os caracteres backslash de <emphasis>continuação de linha</emphasis> no final das linhas nas entradas do <filename>printcap</filename> revelam que uma entrada para uma impressora é na verdade apenas uma linha longa com entradas delimitadas por dois pontos. O exemplo anterior pode ser reescrito como uma única linha menos legível:</para>

	<programlisting>lp:lp=/dev/unlpt0:sh:mx#0:sd=/var/spool/lpd/lp:if=/usr/local/libexec/lf2crlf:lf=/var/log/lpd-errs:</programlisting>
      </tip>

      <sect3 xml:id="printing-lpd-filters-stairstep">
	<title>Impedindo degraus em impressoras de texto simples</title>

	<para>Os arquivos de texto típicos do FreeBSD contêm apenas um único caractere de feed de linha no final de cada linha. Estas linhas vão ficar em <quote>degraus</quote> em uma impressora padrão:</para>

	<programlisting>Um arquivo impresso parece
                    como os degraus de uma escada
                                              espalhados pelo vento</programlisting>

	<para>Um filtro pode converter os caracteres de nova linha em retornos de carro e novas linhas. Os retornos de carro fazem a impressora retornar para a esquerda após cada linha. Crie o <filename>/usr/local/libexec/lf2crlf</filename> com este conteúdo:</para>

	<programlisting>#!/bin/sh
CR=$'\r'
/usr/bin/sed -e "s/$/${CR}/g"</programlisting>

	<para>Defina as permissões e torne-o executável:</para>

	<screen><prompt>#</prompt> <userinput>chmod 555 /usr/local/libexec/lf2crlf</userinput></screen>

	<para>Modifique o <filename>/etc/printcap</filename> para usar o novo filtro:</para>

	<programlisting>:if=/usr/local/libexec/lf2crlf:\</programlisting>

	<para>Teste o filtro imprimindo o mesmo arquivo de texto simples. O procedimento fará com que cada linha comece no lado esquerdo da página.</para>
      </sect3>

      <sect3 xml:id="printing-lpd-filters-enscript">
	<title>Texto simples chique em impressoras <trademark class="registered">PostScript</trademark> com <package>print/enscript</package></title>

	<para>O <acronym>GNU</acronym><application>Enscript</application> converte arquivos de texto simples em arquivos  formatados como <trademark class="registered">PostScript</trademark> para impressão em impressoras <trademark class="registered">PostScript</trademark>. Ele adiciona números de página, quebra as linhas longas e fornece vários outros recursos para facilitar a leitura dos arquivos de texto impressos. Dependendo do tamanho do papel local, instale o <package role="port">print/enscript-letter</package> ou o <package role="port">print/enscript-a4</package> da coleção Ports.</para>

	<para>Crie o <filename>/usr/local/libexec/enscript</filename> com este conteúdo:</para>

	<programlisting>#!/bin/sh
/usr/local/bin/enscript -o -</programlisting>

	<para>Defina as permissões e torne-o executável:</para>

	<screen><prompt>#</prompt> <userinput>chmod 555 /usr/local/libexec/enscript</userinput></screen>

	<para>Modifique o <filename>/etc/printcap</filename> para usar o novo filtro:</para>

	<programlisting>:if=/usr/local/libexec/enscript:\</programlisting>

	<para>Teste o filtro imprimindo um arquivo de texto simples.</para>
      </sect3>

      <sect3 xml:id="printing-lpd-filters-ps2pcl">
	<title>Imprimindo <trademark class="registered">PostScript</trademark> em impressoras <acronym>PCL</acronym></title>

	<para>Muitos programas produzem documentos <trademark class="registered">PostScript</trademark>. No entanto, impressoras baratas geralmente só entendem texto simples ou <acronym>PCL</acronym>. Este filtro converte os arquivos <trademark class="registered">PostScript</trademark> para o formato <acronym>PCL</acronym> antes de enviá-los para a impressora.</para>

	<para>Instale o interpretador de <trademark class="registered">PostScript</trademark> Ghostscript, <package role="port">print/ghostscript9</package>, através da Coleção de Ports.</para>

	<para>Crie o <filename>/usr/local/libexec/ps2pcl</filename> com este conteúdo:</para>

	<programlisting>#!/bin/sh
/usr/local/bin/gs -dSAFER -dNOPAUSE -dBATCH -q -sDEVICE=ljet4 -sOutputFile=- -</programlisting>

	<para>Defina as permissões e torne-o executável:</para>

	<screen><prompt>#</prompt> <userinput>chmod 555 /usr/local/libexec/ps2pcl</userinput></screen>

	<para>A entrada <trademark class="registered">PostScript</trademark> enviada para este script será processada e convertida em <acronym>PCL</acronym> antes de ser enviada para a impressora.</para>

	<para>Modifique o <filename>/etc/printcap</filename> para usar este novo filtro de entrada:</para>

	<programlisting>:if=/usr/local/libexec/ps2pcl:\</programlisting>

	<para>Teste o filtro enviando um pequeno programa <trademark class="registered">PostScript</trademark> para ele:</para>

	<screen><prompt>%</prompt> <userinput>printf "%%\!PS \n /Helvetica findfont 18 scalefont setfont \
72 432 moveto (PostScript printing successful.) show showpage \004" | lpr</userinput></screen>
      </sect3>

      <sect3 xml:id="printing-lpd-filters-smart">
	<title>Filtros Inteligentes</title>

	<para>Um filtro que detecta o tipo de entrada e converte automaticamente para o formato correto da impressora pode ser muito conveniente. Os dois primeiros caracteres de um arquivo <trademark class="registered">PostScript</trademark> são geralmente <literal>%!</literal>. Um filtro pode detectar esses dois caracteres. Os arquivos <trademark class="registered">PostScript</trademark> podem ser enviados de forma inalterada para uma impressora <trademark class="registered">PostScript</trademark>. Arquivos de texto podem ser convertidos para <trademark class="registered">PostScript</trademark> com o <application>Enscript</application> como mostrado anteriormente. Crie o <filename>/usr/local/libexec/psif</filename> com este conteúdo:</para>

	<programlisting>#!/bin/sh
#
#  psif - Print PostScript or plain text on a PostScript printer
#
IFS="" read -r first_line
first_two_chars=`expr "$first_line" : '\(..\)'`

case "$first_two_chars" in
%!)
    # %! : PostScript job, print it.
    echo "$first_line" &amp;&amp; cat &amp;&amp; exit 0
    exit 2
    ;;
*)
    # otherwise, format with enscript
    ( echo "$first_line"; cat ) | /usr/local/bin/enscript -o - &amp;&amp; exit 0
    exit 2
    ;;
esac</programlisting>

	<para>Defina as permissões e torne-o executável:</para>

	<screen><prompt>#</prompt> <userinput>chmod 555 /usr/local/libexec/psif</userinput></screen>

	<para>Modifique o <filename>/etc/printcap</filename> para usar este novo filtro de entrada:</para>

	<programlisting>:if=/usr/local/libexec/psif:\</programlisting>

	<para>Teste o filtro imprimindo <trademark class="registered">PostScript</trademark> e arquivos de texto simples.</para>
      </sect3>

      <sect3 xml:id="printing-lpd-filters-othersmart">
	<title>Outros Filtros Inteligentes</title>

	<para>Escrever um filtro que detecte muitos tipos diferentes de entrada e os formate corretamente é um desafio. O <package role="port">print/apsfilter</package> da Coleção de Ports é um filtro <quote>magico</quote> inteligente 
 que detecta dezenas de tipos de arquivos e os converte automaticamente para o <acronym>PDL</acronym> entendido pela impressora. Veja <link xlink:href="http://www.apsfilter.org"/> para mais detalhes.</para>
      </sect3>
    </sect2>

    <sect2 xml:id="printing-lpd-queues">
      <title>Múltiplas filas</title>

      <para>As entradas no <filename>/etc/printcap</filename> são na verdade definições de <emphasis>filas</emphasis>. Pode haver mais de uma fila para uma única impressora. Quando combinadas com filtros, múltiplas filas fornecem aos usuários um maior controle sobre como seus trabalhos são impressos.</para>

      <para>Por exemplo, considere uma impressora laser <trademark class="registered">PostScript</trademark> em rede num escritório. A maioria dos usuários deseja imprimir texto simples, mas alguns usuários avançados querem poder imprimir diretamente os arquivos <trademark class="registered">PostScript</trademark>. Duas entradas podem ser criadas para a mesma impressora no <filename>/etc/printcap</filename>:</para>

      <programlisting>textprinter:\
	:lp=9100@officelaser:\
	:sh:\
	:mx#0:\
	:sd=/var/spool/lpd/textprinter:\
	:if=/usr/local/libexec/enscript:\
	:lf=/var/log/lpd-errs:

psprinter:\
	:lp=9100@officelaser:\
	:sh:\
	:mx#0:\
	:sd=/var/spool/lpd/psprinter:\
	:lf=/var/log/lpd-errs:</programlisting>

      <para>Os documentos enviados para a fila <literal>textprinter</literal> serão formatados pelo filtro <filename>/usr/local/libexec/enscript</filename> mostrado em um exemplo anterior. Usuários avançados podem imprimir arquivos <trademark class="registered">PostScript</trademark> em <literal>psprinter</literal>, onde nenhuma filtragem é feita.</para>

      <para>Esta técnica de múltiplas filas pode ser usada para fornecer acesso direto a todos os tipos de recursos da impressora. Uma impressora com um duplexador pode usar duas filas, uma para impressões em apenas um lado da folha e outra com um filtro que envia a seqüência de comandos para habilitar a impressão frente e verso e, em seguida, envia o arquivo recebido.</para>
    </sect2>

    <sect2 xml:id="printing-lpd-monitor">
      <title>Monitoramento e controle de impressão</title>

      <para>Vários utilitários estão disponíveis para monitorar trabalhos de impressão e verificar e controlar a operação da impressora.</para>

      <sect3 xml:id="printing-lpd-monitor-lpq">
	<title><citerefentry><refentrytitle>lpq</refentrytitle><manvolnum>1</manvolnum></citerefentry></title>

	<para>O <citerefentry><refentrytitle>lpq</refentrytitle><manvolnum>1</manvolnum></citerefentry> mostra o status das tarefas de impressão de um usuário. Trabalhos de impressão de outros usuários não são mostrados.</para>

	<para>Mostra os trabalhos pendentes do usuário atual em uma única impressora:</para>

	<screen><prompt>%</prompt> <userinput>lpq -P<replaceable>lp</replaceable></userinput>
Rank   Owner      Job  Files                                 Total Size
1st    jsmith     0    (standard input)                      12792 bytes</screen>

	<para>Mostra os trabalhos pendentes do usuário atual em todas as impressoras:</para>

	<screen><prompt>%</prompt> <userinput>lpq -a</userinput>
lp:
Rank   Owner      Job  Files                                 Total Size
1st    jsmith     1    (standard input)                      27320 bytes

laser:
Rank   Owner      Job  Files                                 Total Size
1st    jsmith     287  (standard input)                      22443 bytes</screen>
      </sect3>

      <sect3 xml:id="printing-lpd-monitor-lprm">
	<title><citerefentry><refentrytitle>lprm</refentrytitle><manvolnum>1</manvolnum></citerefentry></title>

	<para>O <citerefentry><refentrytitle>lprm</refentrytitle><manvolnum>1</manvolnum></citerefentry> é usado para remover trabalhos de impressão. Usuários normais só podem remover seus próprios trabalhos. O <systemitem class="username">root</systemitem> pode remover qualquer um ou todos os trabalhos.</para>

	<para>Remova todos os trabalhos pendentes de uma impressora:</para>

	<screen><prompt>#</prompt> <userinput>lprm -P<replaceable>lp</replaceable> -</userinput>
dfA002smithy dequeued
cfA002smithy dequeued
dfA003smithy dequeued
cfA003smithy dequeued
dfA004smithy dequeued
cfA004smithy dequeued</screen>

	<para>Remova um único trabalho de uma impressora. O <citerefentry><refentrytitle>lpq</refentrytitle><manvolnum>1</manvolnum></citerefentry> é usado para encontrar o número do trabalho.</para>

	<screen><prompt>%</prompt> <userinput>lpq</userinput>
Rank   Owner      Job  Files                                 Total Size
1st    jsmith     5    (standard input)                      12188 bytes
<prompt>%</prompt> <userinput>lprm -P<replaceable>lp</replaceable> <replaceable>5</replaceable></userinput>
dfA005smithy dequeued
cfA005smithy dequeued</screen>
      </sect3>

      <sect3 xml:id="printing-lpd-monitor-lpc">
	<title><citerefentry><refentrytitle>lpc</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

	<para>O <citerefentry><refentrytitle>lpc</refentrytitle><manvolnum>8</manvolnum></citerefentry> é usado para verificar e modificar o status da impressora. O <literal>lpc</literal> é seguido por um comando e um nome de impressora opcional. O parâmetro <literal>all</literal> pode ser usado em vez de um nome de impressora específico, e o comando será aplicado a todas as impressoras. Usuários normais podem visualizar o status com <citerefentry><refentrytitle>lpc</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Somente o <systemitem> class="username"&amp;gt;root</systemitem> pode usar comandos que modificam o status da impressora.</para>

	<para>Mostrar o status de todas as impressoras:</para>

	<screen><prompt>%</prompt> <userinput>lpc status all</userinput>
lp:
	queuing is enabled
	printing is enabled
	1 entry in spool area
	printer idle
laser:
	queuing is enabled
	printing is enabled
	1 entry in spool area
	waiting for laser to come up</screen>

	<para>Impedindo que uma impressora aceite novos trabalhos e fazendo com que ela comece a aceitar novos trabalhos novamente:</para>

	<screen><prompt>#</prompt> <userinput>lpc disable <replaceable>lp</replaceable></userinput>
lp:
	queuing disabled
<prompt>#</prompt> <userinput>lpc enable <replaceable>lp</replaceable></userinput>
lp:
	queuing enabled</screen>

	<para>Pare de imprimir, mas continue aceitando novos trabalhos. Em seguida, comece a imprimir novamente:</para>

	<screen><prompt>#</prompt> <userinput>lpc stop <replaceable>lp</replaceable></userinput>
lp:
	printing disabled
<prompt>#</prompt> <userinput>lpc start <replaceable>lp</replaceable></userinput>
lp:
	printing enabled
	daemon started</screen>

	<para>Reinicie uma impressora após alguma condição de erro:</para>

	<screen><prompt>#</prompt> <userinput>lpc restart <replaceable>lp</replaceable></userinput>
lp:
	no daemon to abort
	printing enabled
	daemon restarted</screen>

	<para>Desative a fila de impressão e desative a impressão, com uma mensagem para explicar o problema aos usuários:</para>

	<screen><prompt>#</prompt> <userinput>lpc down <replaceable>lp</replaceable> Repair parts will arrive on Monday</userinput>
lp:
	printer and queuing disabled
	status message is now: Repair parts will arrive on Monday</screen>

	<para>Reative uma impressora que esteja inativa:</para>

	<screen><prompt>#</prompt> <userinput>lpc up <replaceable>lp</replaceable></userinput>
lp:
	printing enabled
	daemon started</screen>

	<para>Veja <citerefentry><refentrytitle>lpc</refentrytitle><manvolnum>8</manvolnum></citerefentry> para mais comandos e opções.</para>
      </sect3>
    </sect2>

    <sect2 xml:id="printing-lpd-shared">
      <title>Impressoras Compartilhadas</title>

      <para>As impressoras costumam ser compartilhadas por vários usuários em empresas e escolas. Recursos adicionais são fornecidos para tornar as impressoras compartilhadas mais convenientes.</para>

      <sect3 xml:id="printing-shared-aliases">
	<title>Aliases</title>

	<para>O nome da impressora é definido na primeira linha da entrada em <filename>/etc/printcap</filename>. Nomes adicionais, ou <emphasis>aliases</emphasis>, podem ser adicionados após esse nome. Os aliases são separados do nome e um do outro por barras verticais:</para>

	<programlisting>lp|<replaceable>repairsprinter</replaceable>|<replaceable>salesprinter</replaceable>:\</programlisting>

	<para>Os aliases podem ser usados no lugar do nome da impressora. Por exemplo, os usuários do departamento de vendas imprimem em sua impressora com</para>

	<screen><prompt>%</prompt> <userinput>lpr -P<replaceable>salesprinter</replaceable> <replaceable>sales-report.txt</replaceable></userinput></screen>

	<para>Usuários do departamento de Reparos podem imprimir na <emphasis>sua</emphasis> impressora com</para>

	<screen><prompt>%</prompt> <userinput>lpr -P<replaceable>repairsprinter</replaceable> <replaceable>repairs-report.txt</replaceable></userinput></screen>

	<para>Todos os documentos são impressos nessa única impressora. Quando o departamento de vendas cresce o suficiente para precisar de sua própria impressora, o alias pode ser removido da entrada da impressora compartilhada e usado como o nome de uma nova impressora. Os usuários nos dois departamentos continuam usando os mesmos comandos, mas os documentos de vendas são enviados para a nova impressora.</para>
      </sect3>

      <sect3 xml:id="printing-shared-headers">
	<title>Páginas de cabeçalho</title>

	<para>Pode ser difícil para os usuários localizarem seus documentos na pilha de páginas produzidas por uma impressora compartilhada ocupada. <emphasis>Páginas de cabeçalho</emphasis> foram criadas para resolver este problema. Uma página de cabeçalho com o nome de usuário e o nome do documento é impressa antes de cada trabalho de impressão. Estas páginas são por vezes chamadas de páginas <emphasis>banner</emphasis> ou <emphasis>separadoras</emphasis>.</para>

	<para>A ativação das páginas de cabeçalho é diferente, dependendo se a impressora está conectada diretamente ao computador com um cabo <acronym>USB</acronym>, paralelo ou serial, ou se está conectada remotamente por uma rede.</para>

	<para>As páginas de cabeçalho em impressoras conectadas diretamente são ativadas removendo-se a linha  <literal>:sh:\</literal> (Suprimir Cabeçalho) da entrada no <filename>/etc/printcap</filename>. Essas páginas de cabeçalho usam apenas caracteres de feed de linha para novas linhas. Algumas impressoras precisarão do filtro <filename>/usr/share/examples/printing/hpif</filename> para evitar imprimir o texto em escada. O filtro configura impressoras <acronym>PCL</acronym> para imprimir retornos de carro e alimentações de linha quando um feed de linha é recebido.</para>

	<para>As páginas de cabeçalho das impressoras de rede devem ser configuradas na própria impressora. Entradas de página de cabeçalho no <filename>/etc/printcap</filename> são ignoradas. As configurações geralmente estão disponíveis no painel frontal da impressora ou em uma página da web de configuração acessível com um navegador da web.</para>
      </sect3>
      <!-- conversion filters?,
	restricting printer usage?, accounting? -->
    </sect2>

    <sect2 xml:id="printing-lpd-references">
      <title>Referências</title>

      <para>Arquivos de exemplo:<filename role="directory">/usr/share/examples/printing/</filename>.</para>

      <para>O <emphasis>Manual do Spooler de Impressora de Linha do 4.3BSD</emphasis>, <filename>/usr/share/doc/smm/07.lpd/paper.ascii.gz</filename>.</para>

      <para>Páginas de manual: <citerefentry><refentrytitle>printcap</refentrytitle><manvolnum>5</manvolnum></citerefentry>, <citerefentry><refentrytitle>lpd</refentrytitle><manvolnum>8</manvolnum></citerefentry>, <citerefentry><refentrytitle>lpr</refentrytitle><manvolnum>1</manvolnum></citerefentry>, <citerefentry><refentrytitle>lpc</refentrytitle><manvolnum>8</manvolnum></citerefentry>, <citerefentry><refentrytitle>lprm</refentrytitle><manvolnum>1</manvolnum></citerefentry>, <citerefentry><refentrytitle>lpq</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="printing-other">
    <title>Outros sistemas de impressão</title>

    <para>Vários outros sistemas de impressão estão disponíveis, além do <citerefentry><refentrytitle>lpd</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Esses sistemas oferecem suporte para outros protocolos ou recursos adicionais.</para>

    <sect2 xml:id="printing-other-cups">
      <title><acronym>CUPS</acronym> (Sistema de impressão comum <trademark class="registered">UNIX</trademark>)</title>

      <para>O <acronym>CUPS</acronym> é um sistema de impressão popular disponível em muitos sistemas operacionais. Usar o <acronym>CUPS</acronym> no FreeBSD está documentado em um artigo separado: <link xlink:href="@@URL_RELPREFIX@@/doc/en_US.ISO8859-1/articles/cups"/></para>
    </sect2>

    <sect2 xml:id="printing-other-hplip">
      <title>HPLIP</title>

      <para>A Hewlett Packard fornece um sistema de impressão que suporta muitas de suas impressoras a jato de tinta e laser. O port é o <package role="port">print/hplip</package>. A página principal da web está em <link xlink:href="http://hplipopensource.com/hplip-web/index.html"/>. O port lida com todos os detalhes de instalação no FreeBSD. As informações de configuração são mostradas em <link xlink:href="http://hplipopensource.com/hplip-web/install/manual/hp_setup.html"/>.</para>
    </sect2>

    <sect2 xml:id="printing-other-lprng">
      <title>LPRng</title>

      <para>O <application>LPRng</application> foi desenvolvido como uma alternativa aprimorada para o <citerefentry><refentrytitle>lpd</refentrytitle><manvolnum>8</manvolnum></citerefentry>. O port é <package role="port">sysutils/LPRng</package>. Para detalhes e documentação, veja <link xlink:href="http://www.lprng.com/"/>.</para>
    </sect2>
  </sect1>
</chapter>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<chapter version="5.0" xml:id="linuxemu">

  <info>
    <title><trademark class="registered">Compatibilidade binária com o Linux</trademark></title>

    <authorgroup>
      <author><personname> <firstname>Jim</firstname> <surname>Mock</surname> </personname> <contrib>Reestruturado e atualizado por </contrib></author>
      <!-- 22 Mar 2000 -->
    </authorgroup>

    <authorgroup>
      <author><personname> <firstname>Brian N.</firstname> <surname>Handy</surname> </personname> <contrib>Originalmente contribuído por </contrib></author>

      <author><personname> <firstname>Rich</firstname> <surname>Murphey</surname> </personname></author>
    </authorgroup>
  </info>

  <sect1 xml:id="linuxemu-synopsis">
    <title>Sinopse</title>

    <indexterm><primary>Linux binary compatibility</primary></indexterm>
    <indexterm><primary>binary compatibility</primary> <secondary>Linux</secondary></indexterm>

    <para>O FreeBSD fornece compatibilidade binária com o <trademark class="registered">Linux</trademark>, permitindo que os usuários instalem e executem a maioria dos binários do <trademark class="registered">Linux</trademark> em um sistema FreeBSD sem ter que primeiro modificar o binário. Foi até relatado que, em algumas situações, os binários <trademark class="registered">Linux</trademark> têm melhor desempenho no FreeBSD do que no <trademark class="registered">Linux</trademark>.</para>

    <para>No entanto, alguns recursos do sistema operacional específicos do <trademark class="registered">Linux</trademark> não são suportados no FreeBSD. Por exemplo, os binários <trademark class="registered">Linux</trademark> não funcionarão no FreeBSD se usarem chamadas específicas <trademark>i386</trademark>, mesmo ativando o modo 8086 virtual.</para>

    <note>
      <para>O suporte para compatibilidade binária de 64 bits com o <trademark class="registered">Linux</trademark> foi adicionado no FreeBSD 10.3.</para>
    </note>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>Como habilitar a compatibilidade binária com o <trademark class="registered">Linux</trademark> em um sistema FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como instalar bibliotecas compartilhadas adicionais do <trademark class="registered">Linux</trademark>.</para>
      </listitem>

      <listitem>
	<para>Como instalar aplicativos <trademark class="registered">Linux</trademark> em um sistema FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Os detalhes de implementação da compatibilidade com o <trademark class="registered">Linux</trademark> no FreeBSD.</para>
      </listitem>
    </itemizedlist>

    <para>Antes de ler este capítulo, você deve:</para>

    <itemizedlist>
      <listitem>
	<para>Saiber como instalar <link linkend="ports">software adicional de terceiros</link>.</para>
      </listitem>
    </itemizedlist>

  </sect1>

  <sect1 xml:id="linuxemu-lbc-install">
    <title>Configurando a compatibilidade binária com o <trademark class="registered">Linux</trademark></title>

    <indexterm><primary>Ports Collection</primary></indexterm>

    <para>Por padrão, as bibliotecas do <trademark class="registered">Linux</trademark> não estão instaladas e a compatibilidade binária com o <trademark class="registered">Linux</trademark> não está ativada. As bibliotecas <trademark class="registered">Linux</trademark> podem ser instaladas manualmente ou a partir da coleção de Ports do FreeBSD.</para>

    <para>Antes de tentar compilar o port, carregue o módulo de kernel <trademark class="registered">Linux</trademark>, caso contrário a compilação irá falhar:</para>

    <screen><prompt>#</prompt> <userinput>kldload linux</userinput></screen>

    <para>Para compatibilidade com 64 bits:</para>

    <screen><prompt>#</prompt> <userinput>kldload linux64</userinput></screen>

    <para>Para verificar se o módulo está carregado:</para>

    <screen><prompt>%</prompt> <userinput>kldstat</userinput>
      Id Refs Address    Size     Name
      1    2 0xc0100000 16bdb8   kernel
      7    1 0xc24db000 d000     linux.ko</screen>

    <para>O pacote ou port <package>emulators/linux_base-c7</package> é a maneira mais fácil de instalar um conjunto básico de bibliotecas e binários do <trademark class="registered">Linux</trademark> em um sistema FreeBSD. Para instalar o port:</para>

    <screen><prompt>#</prompt> <userinput>pkg install emulators/linux_base-c7</userinput></screen>

    <para>Para que a compatibilidade com o <trademark class="registered">Linux</trademark> seja ativada durante a inicialização, adicione esta linha ao <filename>/etc/rc.conf</filename>:</para>

    <programlisting>linux_enable="YES"</programlisting>

    <para>Em máquinas de 64 bits, o <filename>/etc/rc.d/abi</filename> carregará automaticamente o módulo para emulação de 64 bits.</para>

    <indexterm><primary>kernel options</primary> <secondary>COMPAT_LINUX</secondary></indexterm>

    <para>Como a camada de compatibilidade binária do <trademark class="registered">Linux</trademark> ganhou suporte para a execução de binários <trademark class="registered">Linux</trademark> de 32 e 64 bits (em hosts x86 de 64 bits), não é mais possível vincular estaticamente a funcionalidade de emulação a um kernel personalizado.</para>

    <sect2 xml:id="linuxemu-libs-manually">
      <title>Instalando Bibliotecas Adicionais Manualmente</title>

      <indexterm><primary>bibliotecas compartilhadas</primary></indexterm>

      <para>Se um aplicativo <trademark class="registered">Linux</trademark> reclamar sobre a falta de bibliotecas compartilhadas após configurar a compatibilidade binária do <trademark class="registered">Linux</trademark>, determine quais bibliotecas compartilhadas o <trademark class="registered">Linux</trademark> precisa e instale-as manualmente.</para>

      <para>A partir de um sistema <trademark class="registered">Linux</trademark>, o <command>ldd</command> pode ser usado para determinar quais bibliotecas compartilhadas o aplicativo precisa. Por exemplo, para verificar quais bibliotecas compartilhadas o <command>linuxdoom</command> precisa, execute este comando a partir de um sistema <trademark class="registered">Linux</trademark> que tenha o <application>Doom</application> instalado:</para>

      <screen><prompt>%</prompt> <userinput>ldd linuxdoom</userinput>
libXt.so.3 (DLL Jump 3.1) =&gt; /usr/X11/lib/libXt.so.3.1.0
libX11.so.3 (DLL Jump 3.1) =&gt; /usr/X11/lib/libX11.so.3.1.0
libc.so.4 (DLL Jump 4.5pl26) =&gt; /lib/libc.so.4.6.29</screen>

      <indexterm><primary>links simbólicos</primary></indexterm>

      <para>Então, copie todos os arquivos listados na última coluna da saída do comando no sistema <trademark class="registered">Linux</trademark> para o diretório <filename>/compat/linux</filename> no sistema FreeBSD. Depois de copiados, crie links simbólicos para os nomes na primeira coluna. Este exemplo irá resultar nos seguintes arquivos no sistema FreeBSD:</para>

      <screen>/compat/linux/usr/X11/lib/libXt.so.3.1.0
/compat/linux/usr/X11/lib/libXt.so.3 -&gt; libXt.so.3.1.0
/compat/linux/usr/X11/lib/libX11.so.3.1.0
/compat/linux/usr/X11/lib/libX11.so.3 -&gt; libX11.so.3.1.0
/compat/linux/lib/libc.so.4.6.29
/compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.29</screen>

      <para>Se uma biblioteca compartilhada <trademark class="registered">Linux</trademark> já existir com um número de revisão principal correspondente à primeira coluna da saída do comando <command>ldd</command>, ela não precisará ser copiada para a arquivo nomeado na última coluna, pois a biblioteca existente deve funcionar. No entanto é aconselhável copiar a biblioteca compartilhada se for uma versão mais nova. O arquivo antigo pode ser removido, desde que o link simbólico aponte para o novo.</para>

      <para>Por exemplo, essas bibliotecas já existem no sistema FreeBSD:</para>

      <screen>/compat/linux/lib/libc.so.4.6.27
/compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.27</screen>

      <para>e o <command>ldd</command> indica que um binário requer uma versão posterior:</para>

      <screen>libc.so.4 (DLL Jump 4.5pl26) -&gt; libc.so.4.6.29</screen>

      <para>Como a biblioteca existente tem apenas uma ou duas versões desatualizadas no último dígito, o programa ainda deve funcionar com a versão um pouco mais antiga. No entanto, é seguro substituir o <filename>libc.so</filename> existente pela versão mais nova:</para>

      <screen>/compat/linux/lib/libc.so.4.6.29
/compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.29</screen>

      <para>Geralmente, será necessário procurar as bibliotecas compartilhadas que os binários do <trademark class="registered">Linux</trademark> dependem apenas das primeiras vezes que um programa <trademark class="registered">Linux</trademark> é instalado no FreeBSD. Depois de um tempo, haverá um conjunto suficiente de bibliotecas <trademark class="registered">Linux</trademark> compartilhadas no sistema para poder executar binários <trademark class="registered">Linux</trademark> atualizados sem qualquer trabalho extra.</para>
    </sect2>

    <sect2>
      <title>Instalando os binários <trademark class="registered">Linux</trademark> <acronym>ELF</acronym></title>

      <indexterm><primary>Linux</primary> <secondary>ELF binaries</secondary></indexterm>

      <para>Os binários <acronym>ELF</acronym> requerem por vezes um passo extra. Quando um binário <acronym>ELF</acronym> sem marca for executado, ele gerará uma mensagem de erro:</para>

      <screen><prompt>%</prompt> <userinput>./my-linux-elf-binary</userinput>
ELF binary type not known
Abort</screen>

      <para>Para ajudar o kernel do FreeBSD a distinguir entre um binário do FreeBSD <acronym>ELF</acronym> e um binário <trademark class="registered">Linux</trademark>, use <citerefentry><refentrytitle>brandelf</refentrytitle><manvolnum>1</manvolnum></citerefentry>:</para>

      <screen><prompt>%</prompt> <userinput>brandelf -t Linux my-linux-elf-binary</userinput></screen>

      <indexterm><primary>GNU toolchain</primary></indexterm>

      <para>Como o conjunto de ferramentas GNU coloca as informações de branding apropriadas em binários <acronym>ELF</acronym> automaticamente, essa etapa geralmente não é necessária.</para>
    </sect2>

    <sect2>
      <title>Instalando um aplicativo baseado em <trademark class="registered">Linux</trademark> <acronym>RPM</acronym></title>

      <para>Para instalar um aplicativo baseado em <trademark class="registered">Linux</trademark> <acronym>RPM</acronym>, primeiro instale o pacote ou o port <package>archivers/rpm4</package>. Uma vez instalado, o usuário <systemitem class="username">root</systemitem> pode usar este comando para instalar um <filename>.rpm</filename>:</para>

      <screen><prompt>#</prompt> <userinput>cd /compat/linux</userinput>
<prompt>#</prompt> <userinput>rpm2cpio &lt; /path/to/linux.archive.rpm | cpio -id</userinput></screen>

      <para>Se necessário, use o <command>brandelf</command> nos binários <acronym>ELF</acronym> instalados . Observe que isso impedirá uma desinstalação limpa.</para>
    </sect2>

    <sect2>
      <title>Configurando o Resolver do Hostname</title>

      <para>Se o <acronym>DNS</acronym> não funcionar ou este erro aparecer:</para>

      <screen>resolv+: "bind" is an invalid keyword resolv+:
"hosts" is an invalid keyword</screen>

      <para>configure o <filename>/compat/linux/etc/host.conf</filename> como segue:</para>

      <programlisting>order hosts, bind
multi on</programlisting>

      <para>Isso especifica que o <filename>/etc/hosts</filename> deve ser pesquisado primeiro e o <acronym>DNS</acronym> deve ser pesquisado em segundo lugar. Quando o  <filename>/compat/linux/etc/host.conf</filename> não existe, os aplicativos <trademark class="registered">Linux</trademark> usam o <filename>/etc/host.conf</filename> e avisam sobre a sintaxe incompatível do FreeBSD. Remova o <literal>bind</literal> se um servidor de nomes não estiver configurado usando o <filename>/etc/resolv.conf</filename>.</para>
    </sect2>
  </sect1>

  <?ignore While the installer works, the binaries do not.  As of Oct 2013,
  Linux emulation is 32-bit but the trial version of Mathematica is
  only available as 64-bit.  This section should be revisited if Linux
  emulation gets 64-bit binary support.

  <sect1 id="linuxemu-mathematica">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Boris</firstname>
	  <surname>Hollas</surname>
	  <contrib>Updated for Mathematica 5.X by </contrib>
	</author>
      </authorgroup>
    </sect1info>

    <title>Installing &mathematica;</title>

    <indexterm>
      <primary>applications</primary>
      <secondary><application>Mathematica</application></secondary>
    </indexterm>

    <para>This section describes the process of installing the &linux;
      version of <application>&mathematica; 9.X</application> onto a
      &os; system.  <application>&mathematica;</application> is a
      commercial, computational software program used in scientific,
      engineering, and mathematical fields.  A 30 day trial version is
      available for download from <ulink
	url="http://www.wolfram.com/mathematica/">wolfram.com/mathematica</ulink>.</para>

    <sect2>
      <title>Running the &mathematica; Installer</title>

      <para>Before installing &mathematica;, make sure that the
	<filename role="package">textproc/linux-c7-aspell</filename>
	package or port is installed and that the &man.linprocfs.5;
	file system is mounted.</para>

      <screen>&prompt.root; <userinput>sysctl kern.fallback_elf_brand=3</userinput></screen>

      <para>&os; will now assume that unbranded ELF binaries use the
	&linux; <acronym>ABI</acronym> which should allow the
	installer to execute from the CDROM.</para>

      <para>The downloaded file will be saved to
	<filename>/tmp/Mathematica_9.0.1_LINUX.sh</filename>.  Become
	the superuser and run this installer file:</para>

      <programlisting>&prompt.root; <userinput>sh /tmp/Mathematica_9.0.1_LINUX.sh</userinput>
Mathematica Secured 9.0.1 for LINUX Installer Archive

Verifying archive integrity.
Extracting installer. ...
                               Wolfram Mathematica 9 Installer
Copyright (c) 1988-2013 Wolfram Research, Inc. All rights reserved.

WARNING: Wolfram Mathematica is protected by copyright law and international treaties. Unauthorized
reproduction or distribution may result in severe civil and criminal
penalties and will be prosecuted to the maximum extent possible under law.

Enter the installation directory, or press ENTER to select /usr/local/Wolfram/Mathematica/9.0:
>
Now installing...
***********************
Installation complete.</programlisting>
    </sect2>

    <sect2>
      <title>Running the &mathematica; Frontend over a Network</title>

      <para><application>&mathematica;</application> uses some special
	fonts to display characters not present in any of the standard
	font sets.  <application>Xorg</application> requires these
	fonts to be installed locally.  This means that these fonts
	need to be copied from the CDROM or from a host with
	<application>&mathematica;</application> installed to the
	local machine.  These fonts are normally stored in <filename
	  >/cdrom/Unix/Files/SystemFiles/Fonts</filename>
	on the CDROM, or <filename
	  >/usr/local/mathematica/SystemFiles/Fonts</filename>
	on the hard drive.  The actual fonts are in the subdirectories
	<filename>Type1</filename> and
	<filename>X</filename>.  There are several
	ways to use them, as described below.</para>

      <para>The first way is to copy the fonts into one of the
	existing font directories in <filename
	  >/usr/local/lib/X11/fonts</filename> then
	running &man.mkfontdir.1; within the directory containing the
	new fonts.</para>

      <para>The second way to do this is to copy the directories to
	<filename
	  >/usr/local/lib/X11/fonts</filename>:</para>

      <screen>&prompt.root; <userinput>cd /usr/local/lib/X11/fonts</userinput>
&prompt.root; <userinput>mkdir X</userinput>
&prompt.root; <userinput>mkdir MathType1</userinput>
&prompt.root; <userinput>cd /cdrom/Unix/Files/SystemFiles/Fonts</userinput>
&prompt.root; <userinput>cp X/* /usr/local/lib/X11/fonts/X</userinput>
&prompt.root; <userinput>cp Type1/* /usr/local/lib/X11/fonts/MathType1</userinput>
&prompt.root; <userinput>cd /usr/local/lib/X11/fonts/X</userinput>
&prompt.root; <userinput>mkfontdir</userinput>
&prompt.root; <userinput>cd ../MathType1</userinput>
&prompt.root; <userinput>mkfontdir</userinput></screen>

      <para>Now add the new font directories to the font path:</para>

      <screen>&prompt.root; <userinput>xset fp+ /usr/local/lib/X11/fonts/X</userinput>
&prompt.root; <userinput>xset fp+ /usr/local/lib/X11/fonts/MathType1</userinput>
&prompt.root; <userinput>xset fp rehash</userinput></screen>

      <para>When using the <application>&xorg;</application> server,
	these font directories can be loaded automatically by adding
	them to <filename>/etc/X11/xorg.conf</filename>.</para>

      <indexterm><primary>fonts</primary></indexterm>

      <para>If <filename
	  >/usr/local/lib/X11/fonts/Type1</filename>
	does not already exist, change the name of the <filename
	  >MathType1</filename> directory in the
	example above to <filename
	  >Type1</filename>.</para>
    </sect2>
  </sect1>
  -->

  <!--
  As of October 2013, the trial version is only available in the
  Professional and Academic editions (not the Student or Personal
  editions) and requires a contact with a product specialist before
  the evaluation download link is made available.
  <sect1 id="linuxemu-maple">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Aaron</firstname>
	  <surname>Kaplan</surname>
	  <contrib>Contributed by </contrib>
	</author>
      </authorgroup>
      <authorgroup>
	<author>
	  <firstname>Robert</firstname>
	  <surname>Getschmann</surname>
	  <contrib>Thanks to </contrib>
	</author>
      </authorgroup>
    </sect1info>
    <title>Installing &maple;</title>

    <indexterm>
      <primary>applications</primary>
      <secondary><application>Maple</application></secondary>
    </indexterm>

    <para><application>&maple;</application> is a commercial
      mathematics program similar to
      <application>&mathematica;</application>.  This software must be
      purchased and licensed from <ulink
	url="http://www.maplesoft.com/products/maple/">Maplesoft</ulink>.
      To install the &linux; version of this software on &os;, follow
      these steps.</para>

    <procedure>
      <step><para>Execute the <filename>INSTALL</filename> shell
	script from the product distribution.  Choose the
	<quote>RedHat</quote> option when prompted by the
	installation program.  A typical installation directory
	might be <filename
	  >/usr/local/maple</filename>.</para></step>

      <step>
	<para>Copy the license to
	  <filename>/usr/local/maple/license/license.dat</filename>.</para>
      </step>

      <step>
	<para>Install the <application>FLEXlm</application> license
	  manager by running the <filename>INSTALL_LIC</filename>
	  install shell script that comes with
	  <application>&maple;</application>.  Specify the primary
	  hostname for the machine for the license server.</para>
      </step>

      <step>
	<para>Patch
	  <filename>/usr/local/maple/bin/maple.system.type</filename>
	  with the following:</para>


	<programlisting>   ----- snip ------------------
*** maple.system.type.orig      Sun Jul  8 16:35:33 2001
-- - maple.system.type   Sun Jul  8 16:35:51 2001
***************
*** 72,77 ****
-- - 72,78 ----
          # the IBM RS/6000 AIX case
          MAPLE_BIN="bin.IBM_RISC_UNIX"
          ;;
+     "FreeBSD"|\
      "Linux")
          # the Linux/x86 case
        # We have two Linux implementations, one for Red Hat and
   ----- snip end of patch -----</programlisting>

	<para>Note that no whitespace should be present after
	  <literal>"FreeBSD"|\</literal>.</para>

	<para>This patch instructs <application>&maple;</application>
	  to recognize &os; as a type of &linux; system.  The
	  <filename>bin/maple</filename> shell script calls the
	  <filename>bin/maple.system.type</filename> shell script
	  which in turn calls <command>uname -a</command> to find out
	  the operating system name.  Depending on the OS name it will
	  find out which binaries to use.</para>
      </step>

      <step>
	<para>Start the license server.</para>

	<para>The following script, installed as
	  <filename>/usr/local/rtc/rc.d/lmgrd</filename> is a
	  convenient way to start up <command>lmgrd</command>:</para>

	<programlisting>   ----- snip ------------

#! /bin/sh
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
PATH=${PATH}:/usr/local/maple/bin:/usr/local/maple/FLEXlm/UNIX/LINUX
export PATH

LICENSE_FILE=/usr/local/maple/license/license.dat
LOG=/var/log/lmgrd.log

case "$1" in
start)
	lmgrd -c ${LICENSE_FILE} 2&gt;&gt; ${LOG} 1&gt;&amp;2
	echo -n " lmgrd"
	;;
stop)
	lmgrd -c ${LICENSE_FILE} -x lmdown 2&gt;&gt; ${LOG} 1&gt;&amp;2
	;;
*)
	echo "Usage: `basename $0` {start|stop}" 1&gt;&amp;2
	exit 64
	;;
esac

exit 0
   ----- snip ------------</programlisting>
      </step>

      <step>
	<para>Test that <application>&maple;</application>
	  starts:</para>

	<screen>&prompt.user; <userinput>cd /usr/local/maple/bin</userinput>
&prompt.user; <userinput>./xmaple</userinput></screen>

	<para>Once everything is working, consider writing Maplesoft
	  to let them know you would like a native &os;
	  version!</para>
      </step>
    </procedure>

    <sect2>
      <title>Common Pitfalls</title>

      <itemizedlist>
	<listitem>
	  <para><command>lmgrd</command> is known to be picky about
	    the license file and to dump core if there are any
	    problems.  A correct license file should look like
	    this:</para>

	  <programlisting>#
=======================================================
# License File for UNIX Installations ("Pointer File")
# =======================================================
SERVER chillig ANY
#USE_SERVER
VENDOR maplelmg

FEATURE Maple maplelmg 2000.0831 permanent 1 XXXXXXXXXXXX \
         PLATFORMS=i86_r ISSUER="Waterloo Maple Inc." \
         ISSUED=11-may-2000 NOTICE=" Technische Universitat Wien" \
         SN=XXXXXXXXX</programlisting>

	  <note>
	    <para>In this example, the serial number and key were
	      replaced with <literal>X</literal>.
	      <hostid>chillig</hostid> is the hostname.</para>
	  </note>

	  <para>Editing the license file works as long as the
	    <quote>FEATURE</quote> line is not edited.  That line is
	    protected by the license key.</para>
	</listitem>
      </itemizedlist>
    </sect2>
  </sect1>
  -->
  <!--
  As of October, 2013, the Linux version of Matlab is only available
  for 64-bit.

  <sect1 id="linuxemu-matlab">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Dan</firstname>
	  <surname>Pelleg</surname>
	  <contrib>Contributed by </contrib>
	</author>
      </authorgroup>
    </sect1info>

    <title>Installing &matlab;</title>

    <indexterm>
      <primary>applications</primary>
      <secondary><application>MATLAB</application></secondary>
    </indexterm>

    <para>This document describes the process of installing the
      &linux; version of
      <application>&matlab; version 6.5</application> onto a &os;
      system.  It works quite well, with the exception of the
      <application>&java.virtual.machine;</application> which is
      described further in <xref linkend="matlab-jre"/>.</para>

    <para>The &linux; version of <application>&matlab;</application>
      can be purchased and licensed from <ulink
	url="http://www.mathworks.com/products/matlab/">MathWorks</ulink>.
      Consider letting the company know that you would like a native
      &os; version of this software.</para>

    <sect2>
      <title>Installing &matlab;</title>

      <para>To install <application>&matlab;</application>:</para>

      <procedure>
	<step>
	  <para>Become <username>root</username>, as recommended by
	    the installation script.  Insert the installation CD and
	    mount it.  To start the installation script type:</para>

	  <screen>&prompt.root; <userinput>/compat/linux/bin/sh /cdrom/install</userinput></screen>

	  <tip>
	    <para>The installer is graphical.  If it is not able to
	      open a display, type <command>setenv HOME
		~<replaceable>USER</replaceable></command>,
	      where <replaceable>USER</replaceable> is the user who
	      ran &man.su.1;.</para>
	  </tip>
	</step>

	<step>
	  <para>When asked for the <application>&matlab;</application>
	    root directory, type:
	    <userinput>/compat/linux/usr/local/matlab</userinput>.</para>

	  <tip>
	    <para>For easier typing on the rest of the installation
	      process, type this at the shell prompt: <command>set
		MATLAB=/compat/linux/usr/local/matlab</command>.</para>
	  </tip>
	</step>

	<step>
	  <para>Edit the license file as instructed when obtaining
	    the <application>&matlab;</application> license.</para>

	  <tip>
	    <para>This file can be prepared in advance using an
	      editor, and copied to
	      <filename>$MATLAB/license.dat</filename> before the
	      installer asks to edit it.</para>
	  </tip>
	</step>

	<step>
	  <para>Complete the installation process.</para>
	</step>
      </procedure>

      <para>At this point the <application>&matlab;</application>
	installation is complete.  The following steps apply
	<quote>glue</quote> to connect it to the &os; system.</para>
    </sect2>

    <sect2>
      <title>License Manager Startup</title>

      <procedure>
	<step>
	  <para>Create symlinks for the license manager
	    scripts:</para>

	  <screen>&prompt.root; <userinput>ln -s $MATLAB/etc/lmboot /usr/local/etc/lmboot_TMW</userinput>
&prompt.root; <userinput>ln -s $MATLAB/etc/lmdown /usr/local/etc/lmdown_TMW</userinput></screen>
	</step>

	<step>
	  <para>Create a startup file named
	    <filename>/usr/local/etc/rc.d/flexlm</filename>.  The
	    example below is a modified version of the distributed
	    <filename>$MATLAB/etc/rc.lm.glnx86</filename>.  The
	    changes are file locations and startup of the license
	    manager under &linux; emulation.</para>

	  <programlisting>#!/bin/sh
case "$1" in
  start)
        if [ -f /usr/local/etc/lmboot_TMW ]; then
              /compat/linux/bin/sh /usr/local/etc/lmboot_TMW -u <replaceable>username</replaceable> &amp;&amp; echo 'MATLAB_lmgrd'
        fi
        ;;
  stop)
	if [ -f /usr/local/etc/lmdown_TMW ]; then
            /compat/linux/bin/sh /usr/local/etc/lmdown_TMW  &gt; /dev/null 2&gt;&amp;1
	fi
        ;;
  *)
	echo "Usage: $0 {start|stop}"
	exit 1
	;;
esac

exit 0</programlisting>

	  <important>
	    <para>The file must be made executable:</para>

	    <screen>&prompt.root; <userinput>chmod +x /usr/local/etc/rc.d/flexlm</userinput></screen>

	    <para>Replace <replaceable>username</replaceable> with the
	      name of a valid user on the system which is not
	      <username>root</username>.</para>
	  </important>
	</step>

	<step>
	  <para>Start the license manager with the command:</para>

	  <screen>&prompt.root; <userinput>service flexlm start</userinput></screen>
	</step>
      </procedure>
    </sect2>

    <sect2 id="matlab-jre">
      <title>Linking the &java; Runtime Environment</title>

      <para>Change the <application>&java;</application> Runtime
	Environment (<acronym>JRE</acronym>) link to one working under
	&os;:</para>

      <screen>&prompt.root; <userinput>cd $MATLAB/sys/java/jre/glnx86/</userinput>
&prompt.root; <userinput>unlink jre; ln -s ./jre1.1.8 ./jre</userinput></screen>
    </sect2>

    <sect2>
      <title>Creating a &matlab; Startup Script</title>

      <procedure>
	<step>
	  <para>Place the following startup script in
	    <filename
	      >/usr/local/bin/matlab</filename>:</para>

	  <programlisting>#!/bin/sh
/compat/linux/bin/sh /compat/linux/usr/local/matlab/bin/matlab "$@"</programlisting>
	</step>

	<step>
	  <para>Then, type the command
	    <command>chmod +x /usr/local/bin/matlab</command>.</para>
	</step>
      </procedure>

      <tip>
	<para>Depending on the version of
	  <filename role="package">emulators/linux_base</filename>,
	  running this script may result in errors.  To avoid errors,
	  edit
	  <filename>/compat/linux/usr/local/matlab/bin/matlab</filename>,
	  and change the line that says:</para>

	<programlisting>if [ `expr "$lscmd" : '.*-&gt;.*'` -ne 0 ]; then</programlisting>

	<para>to this line:</para>

	<programlisting>if test -L $newbase; then</programlisting>
      </tip>
    </sect2>

    <sect2>
      <title>Creating a &matlab; Shutdown Script</title>

      <para>The following is needed to solve a problem with &matlab;
	not exiting correctly.</para>

      <procedure>
	<step>
	  <para>Create
	    <filename>$MATLAB/toolbox/local/finish.m</filename>
	    containing the single line:</para>

	  <programlisting>! $MATLAB/bin/finish.sh</programlisting>

	  <note>
	    <para>The <literal>$MATLAB</literal> is literal.</para>
	  </note>

	  <tip>
	    <para>The same directory contains
	      <filename>finishsav.m</filename> and
	      <filename>finishdlg.m</filename>, which allow the
	      workspace to be saved before quitting.  If either file
	      is used, insert the line above immediately after the
	      <literal>save</literal> command.</para>
	  </tip>
	</step>

	<step>
	  <para>Create <filename>$MATLAB/bin/finish.sh</filename>
	    which contains the following:</para>

	  <programlisting>#!/compat/linux/bin/sh
(sleep 5; killall -1 matlab_helper) &amp;
exit 0</programlisting>
	</step>

	<step>
	  <para>Make the file executable:</para>

	  <screen>&prompt.root; <userinput>chmod +x $MATLAB/bin/finish.sh</userinput></screen>
	</step>
      </procedure>
    </sect2>

    <sect2 id="matlab-using">
      <title>Using &matlab;</title>

      <para>At this point, <command>matlab</command> is ready for
	use.</para>
    </sect2>
  </sect1>

  <sect1 id="linuxemu-oracle">
    While the Oracle website is unclear, the installation script is:
    You are attempting to install 64-bit Oracle on a 32-bit operating
    system.  This is not supported and will not work.

    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Marcel</firstname>
	  <surname>Moolenaar</surname>
	  <contrib>Contributed by </contrib>
	</author>
      </authorgroup>
    </sect1info>

    <title>Installing &oracle;</title>

    <indexterm>
      <primary>applications</primary>
      <secondary><application>Oracle</application></secondary>
    </indexterm>

    <para>This document describes the process of installing
      <application>&oracle; 8.0.5</application> and
      <application>&oracle; 8.0.5.1 Enterprise Edition</application>
      for &linux; onto a &os; machine.</para>

    <sect2>
      <title>Installing the &linux; Environment</title>

      <para>Make sure <filename
	  role='package'>emulators/linux_base</filename>
	has been installed from the Ports Collection.</para>

      <para>To run the intelligent agent, install the Red Hat Tcl
	package:  <filename>tcl-8.0.3-20.i386.rpm</filename>.  The
	general command for installing RPMs with the
	<filename role='package'>archivers/rpm</filename> port
	is:</para>

      <screen>&prompt.root; <userinput>rpm -i --ignoreos --root /compat/linux --dbpath /var/lib/rpm <replaceable>package</replaceable></userinput></screen>

      <para>This command should not generate any errors.</para>
    </sect2>

    <sect2>
      <title>Creating the &oracle; Environment</title>

      <para>Before installing <application>&oracle;</application>, set
	up a proper environment.  This section only describes how to
	install <application>&oracle;</application> for &linux; on
	&os;, not what has been described in the
	<application>&oracle;</application> installation guide.</para>

      <sect3 id="linuxemu-kernel-tuning">
	<title>Kernel Tuning</title>

	<indexterm>
	  <primary>kernel tuning</primary>
	</indexterm>

	<para>As described in the <application>&oracle;</application>
	  installation guide, the maximum size of shared memory needs
	  to be set.  Do not use <literal>SHMMAX</literal> under &os;
	  as it is calculated from <literal>SHMMAXPGS</literal> and
	  <literal>PGSIZE</literal>.  Therefore, define
	  <literal>SHMMAXPGS</literal>.  All other options can be
	  used as described in the guide.  For example:</para>

	<programlisting>options SHMMAXPGS=10000
options SHMMNI=100
options SHMSEG=10
options SEMMNS=200
options SEMMNI=70
options SEMMSL=61</programlisting>

	<para>Set these options to suit the intended use of
	  <application>&oracle;</application>.</para>

	<para>Also, make sure the following options are in the
	  kernel configuration file:</para>

	<programlisting>options SYSVSHM #SysV shared memory
options SYSVSEM #SysV semaphores
options SYSVMSG #SysV interprocess communication</programlisting>
      </sect3>

      <sect3 id="linuxemu-oracle-account">

	<title>&oracle; Account</title>

	<para>Create a user account to be used as the
	  <username>oracle</username> account.  Add
	  <literal>/compat/linux/bin/bash</literal> to
	  <filename>/etc/shells</filename> and set the shell for
	  the <username>oracle</username> account to
	  <filename>/compat/linux/bin/bash</filename>.</para>
      </sect3>

      <sect3 id="linuxemu-environment">
	<title>Environment</title>

	<para>Besides the normal <application>&oracle;</application>
	  variables, such as <envar>ORACLE_HOME</envar> and
	  <envar>ORACLE_SID</envar> set the following
	  environment variables:</para>

	<informaltable frame="none" pgwide="1">
	  <tgroup cols="2">
	    <colspec colwidth="1*"/>
	    <colspec colwidth="2*"/>
	    <thead>
	      <row>
		<entry>Variable</entry>
		<entry>Value</entry>
	      </row>
	    </thead>

	    <tbody>
	      <row>
		<entry><envar>LD_LIBRARY_PATH</envar></entry>
		<entry><literal>$ORACLE_HOME/lib</literal></entry>
	      </row>

	      <row>
		<entry><envar>CLASSPATH</envar></entry>
		<entry><literal>$ORACLE_HOME/jdbc/lib/classes111.zip</literal></entry>
	      </row>

	      <row>
		<entry><envar>PATH</envar></entry>
		<entry><literal>/compat/linux/bin
		    /compat/linux/sbin
		    /compat/linux/usr/bin
		    /compat/linux/usr/sbin
		    /bin
		    /sbin
		    /usr/bin
		    /usr/sbin
		    /usr/local/bin
		    $ORACLE_HOME/bin</literal></entry>
	      </row>
	    </tbody>
	  </tgroup>
	</informaltable>

	<para>It is advised to set all the environment variables in
	  <filename>~/.profile</filename> as follows:</para>

	<programlisting>ORACLE_BASE=/oracle; export ORACLE_BASE
ORACLE_HOME=/oracle; export ORACLE_HOME
LD_LIBRARY_PATH=$ORACLE_HOME/lib
export LD_LIBRARY_PATH
ORACLE_SID=ORCL; export ORACLE_SID
ORACLE_TERM=386x; export ORACLE_TERM
CLASSPATH=$ORACLE_HOME/jdbc/lib/classes111.zip
export CLASSPATH
PATH=/compat/linux/bin:/compat/linux/sbin:/compat/linux/usr/bin
PATH=$PATH:/compat/linux/usr/sbin:/bin:/sbin:/usr/bin:/usr/sbin
PATH=$PATH:/usr/local/bin:$ORACLE_HOME/bin
export PATH</programlisting>
      </sect3>
    </sect2>

    <sect2>
      <title>Installing &oracle;</title>

      <para>Before starting the installer, create a directory named
	<filename>/var/tmp/.oracle</filename> which
	is owned by the <username>oracle</username> user.  The
	installation of <application>&oracle;</application> should
	work without any problems.  If errors are encountered, check
	the <application>&oracle;</application> distribution and
	configuration.  Once <application>&oracle;</application> is
	installed, apply the patches described in the next two
	subsections.</para>

      <para>A frequent error is that the TCP protocol adapter is not
	installed correctly.  As a consequence, no TCP listeners can
	be started.  The following actions help to solve this
	problem:</para>

      <screen>&prompt.root; <userinput>cd $ORACLE_HOME/network/lib</userinput>
&prompt.root; <userinput>make -f ins_network.mk ntcontab.o</userinput>
&prompt.root; <userinput>cd $ORACLE_HOME/lib</userinput>
&prompt.root; <userinput>ar r libnetwork.a ntcontab.o</userinput>
&prompt.root; <userinput>cd $ORACLE_HOME/network/lib</userinput>
&prompt.root; <userinput>make -f ins_network.mk install</userinput></screen>

    <para>Do not forget to run <filename>root.sh</filename>
      again.</para>

    <sect3 id="linuxemu-patch-root">
      <title>Patching <filename>root.sh</filename></title>

      <para>When installing <application>&oracle;</application>,
	some actions, which need to be performed as
	<username>root</username>, are recorded in a shell script
	called <filename>root.sh</filename>.  This script is
	found in <filename>orainst</filename>.
	Apply the following patch to <filename>root.sh</filename>
	so that it can find the &os; location of
	<command>chown</command>.  Alternatively, run the script
	under a &linux; native shell.</para>

      <programlisting>*** orainst/root.sh.orig Tue Oct 6 21:57:33 1998
--- orainst/root.sh Mon Dec 28 15:58:53 1998
***************
*** 31,37 ****
# This is the default value for CHOWN
# It will redefined later in this script for those ports
# which have it conditionally defined in ss_install.h
! CHOWN=/bin/chown
#
# Define variables to be used in this script
 --- 31,37 ----
# This is the default value for CHOWN
# It will redefined later in this script for those ports
# which have it conditionally defined in ss_install.h
! CHOWN=/usr/sbin/chown
#
# Define variables to be used in this script</programlisting>

      <para>If <application>&oracle;</application> is not installed
	from CD, patch the source for <filename>root.sh</filename>.
	It is called <filename>rthd.sh</filename> and is located in
	<filename>orainst</filename> in the source
	tree.</para>
    </sect3>

    <sect3 id="linuxemu-patch-tcl">
      <title>Patching <filename>genclntsh</filename></title>

      <para>The script <command>genclntsh</command> is used to create
	a single shared client library when building the demos.  Apply
	the following patch to comment out the definition of
	<envar>PATH</envar>:</para>

      <programlisting>*** bin/genclntsh.orig Wed Sep 30 07:37:19 1998
--- bin/genclntsh Tue Dec 22 15:36:49 1998
***************
*** 32,38 ****
#
# Explicit path to ensure that we're using the correct commands
#PATH=/usr/bin:/usr/ccs/bin export PATH
! PATH=/usr/local/bin:/bin:/usr/bin export PATH
#
# each product MUST provide a $PRODUCT/admin/shrept.lst
--- 32,38 ----
#
# Explicit path to ensure that we're using the correct commands
#PATH=/usr/bin:/usr/ccs/bin export PATH
! #PATH=/usr/local/bin:/bin:/usr/bin: export PATH
#
# each product MUST provide a $PRODUCT/admin/shrept.lst</programlisting>
      </sect3>
    </sect2>

    <sect2>
      <title>Running &oracle;</title>

      <para>After following these instructions,
	<application>&oracle;</application> should run as if it was
	running on &linux;.</para>
    </sect2>
  </sect1>
  ?>

  <sect1 xml:id="linuxemu-advanced">
    <title>Tópicos Avançados</title>

    <para>Esta seção descreve como funciona a compatibilidade binária com o <trademark class="registered">Linux</trademark> e é baseada em um email escrito para <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-chat">Lista de discussão do chat do FreeBSD</link> por Terry Lambert <email>tlambert@primenet.com</email> (Message ID: <literal>&lt;199906020108.SAA07001@usr09.primenet.com&gt;</literal>).</para>

    <indexterm><primary>execution class loader</primary></indexterm>

    <para>O FreeBSD tem uma abstração chamada <quote>loader de classes de execução</quote>. Esta é uma cunha na chamada de sistema <citerefentry><refentrytitle>execve</refentrytitle><manvolnum>2</manvolnum></citerefentry> .</para>

    <para>Historicamente, o loader <trademark class="registered">UNIX</trademark> examinava o número mágico (geralmente os primeiros 4 ou 8 bytes do arquivo) para ver se era um binário conhecido pelo sistema e, em caso afirmativo, invocava  o loader binário.</para>

    <para>Se o arquivo não fosse o tipo binário adequado para o sistema, a chamada <citerefentry><refentrytitle>execve</refentrytitle><manvolnum>2</manvolnum></citerefentry> retornava uma falha, e o shell tentava iniciar a execução do mesmo como um comando do shell. A suposição era um padrão de <quote>qualquer que seja o shell atual</quote>.</para>

    <para>Posteriormente, foi feito um hack para que o <citerefentry><refentrytitle>sh</refentrytitle><manvolnum>1</manvolnum></citerefentry> examinasse os dois primeiros caracteres e se eles fossem <literal>:\n</literal>, ele invocava o shell <citerefentry><refentrytitle>csh</refentrytitle><manvolnum>1</manvolnum></citerefentry> em seu lugar.</para>

    <para>O FreeBSD tem uma lista de loaders, em vez de um único loader, com um fallback para o loader <literal>#!</literal> para executar interpretadores de shell ou scripts de shell.</para>

    <indexterm><primary>ELF</primary></indexterm>

    <indexterm><primary>Solaris</primary></indexterm>

    <para>Para o suporte ao <trademark class="registered">Linux</trademark> <acronym>ABI</acronym>, o FreeBSD vê o número mágico como um binário ELF. O loader ELF procura por uma <emphasis>marca</emphasis> especializada, que é uma seção de comentários na imagem ELF e que não esteja presente nos binários ELF SVR4/<trademark>Solaris</trademark>.</para>

    <para>Para que os binários <trademark class="registered">Linux</trademark> funcionem, eles devem ser <emphasis>marcados</emphasis> como tipo <literal>Linux</literal> usando o comando <citerefentry><refentrytitle>brandelf</refentrytitle><manvolnum>1</manvolnum></citerefentry>:</para>

    <screen><prompt>#</prompt> <userinput>brandelf -t Linux file</userinput></screen>

    <indexterm><primary>ELF</primary> <secondary>branding</secondary></indexterm>

    <para>Quando o loader ELF vê a marca <literal>Linux</literal>, ele substitui um ponteiro na estrutura <literal>proc</literal>. Todas as chamadas do sistema são indexadas por esse ponteiro. Além disso, o processo é sinalizado para manipulação especial do vetor trap para o código de trampolim de sinal, e vários outros (menores) reparos que são manipulados pelo módulo do kernel <trademark class="registered">Linux</trademark>.</para>

    <para>O vetor de chamada do sistema <trademark class="registered">Linux</trademark> contém, entre outras coisas, uma lista de entradas <literal>sysent[]</literal> cujos endereços residem no módulo do kernel.</para>

    <para>Quando uma chamada de sistema é acionada pelo binário <trademark class="registered">Linux</trademark>, o código de interceptação desreferencia o ponteiro de função de chamada do sistema da estrutura <literal>proc</literal> e obtém a classe <trademark class="registered">Linux</trademark>, não a FreeBSD, como ponto de entrada para a chamada do sistema.</para>

    <para>O modo <trademark class="registered">Linux</trademark> procura fazer <emphasis>reroots</emphasis> dinamicamente. Isso é, na verdade, equivalente ao <option>union</option> para montagens de sistema de arquivos. Primeiro, é feita uma tentativa de procurar o arquivo em <filename>/compat/linux/<replaceable>original-path</replaceable></filename>. Se isso falhar, a pesquisa será feita em <filename>/<replaceable>original-path</replaceable></filename>. Isso garante que os binários que exigem outros binários possam ser executados. Por exemplo, o conjunto de ferramentas <trademark class="registered">Linux</trademark> pode ser executado sob o suporte da <trademark class="registered">Linux</trademark> <acronym>ABI</acronym>. Isso também significa que os binários <trademark class="registered">Linux</trademark> podem carregar e executar binários do FreeBSD, se não houver binários <trademark class="registered">Linux</trademark> correspondentes, e que o comando <citerefentry><refentrytitle>uname</refentrytitle><manvolnum>1</manvolnum></citerefentry> pode ser colocado na árvore de diretórios <filename>/compat/linux</filename> para garantir que os binários <trademark class="registered">Linux</trademark> não possam dizer que não estão rodando em <trademark class="registered">Linux</trademark>.</para>

    <para>De fato, existe um kernel <trademark class="registered">Linux</trademark> no kernel do FreeBSD. As várias funções subjacentes que implementam todos os serviços fornecidos pelo kernel são idênticas às entradas da tabela de chamada do sistema FreeBSD, e às entradas da tabela de chamada do sistema <trademark class="registered">Linux</trademark>: operações do sistema de arquivos, operações de memória virtual, entrega de sinal e System V IPC. A única diferença é que os binários do FreeBSD obtêm as funções de <emphasis>cola</emphasis> do FreeBSD, e os binários <trademark class="registered">Linux</trademark> recebem as  funções de <emphasis>cola</emphasis> do <trademark class="registered">Linux</trademark>. As funções de <emphasis>cola</emphasis> do FreeBSD estão estaticamente ligadas ao kernel, e as funções de <emphasis>cola</emphasis> do <trademark class="registered"> Linux </trademark>  podem ser estaticamente ligadas, ou podem ser acessadas através de um módulo do kernel.</para>

    <para>Tecnicamente, isso não é realmente emulação, é uma implementação de <acronym>ABI</acronym>. Às vezes é chamado de <quote> <trademark class="registered">emulação</trademark> Linux </quote> porque a implementação foi feita num momento em que não havia outra palavra para descrever o que estava acontecendo. Dizer que o FreeBSD executava os binários do <trademark class="registered">Linux</trademark> não era verdade, já que o código não era compilado nele.</para>
  </sect1>
</chapter>

  </part>

  <part xml:id="system-administration">
    <title>Administração do Sistema</title>

    <partintro>
      <para>Os capítulos restantes cobrem todos os aspectos da administração do sistema FreeBSD. Cada capítulo começa descrevendo o que será aprendido como resultado da leitura do capítulo e também detalha o que o leitor deve saber antes de abordar o material.</para>

      <para>Estes capítulos são projetados para serem lidos conforme as informações são necessárias. Eles não precisam ser lidos em nenhuma ordem específica, nem todos precisam ser lidos antes de começar a usar o FreeBSD.</para>
    </partintro>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<chapter version="5.0" xml:id="config-tuning">

  <info>
    <title>Configuração e Ajuste</title>

    <authorgroup>
      <author><personname> <firstname>Chern</firstname> <surname>Lee</surname> </personname> <contrib>Escrito por</contrib></author>
    </authorgroup>

    <authorgroup>
      <author><personname> <firstname>Mike</firstname> <surname>Smith</surname> </personname> <contrib>Baseado em um tutorial escrito por</contrib></author>
    </authorgroup>

    <authorgroup>
      <author><personname> <firstname>Matt</firstname> <surname>Dillon</surname> </personname> <contrib>Também baseado em tuning (7) escrito por</contrib></author>
    </authorgroup>
  </info>

  <sect1 xml:id="config-synopsis">
    <title>Sinopse</title>

    <indexterm><primary>system configuration</primary></indexterm>
    <indexterm><primary>system optimization</primary></indexterm>

    <para>Um dos aspectos importantes do FreeBSD é a configuração adequada do sistema. Este capítulo explica muito do processo de configuração do FreeBSD, incluindo alguns dos parâmetros que podem ser configurados para ajustar um sistema FreeBSD.</para>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>O básico da configuração do <filename>rc.conf</filename> e dos scripts de inicialização <filename>/usr/local/etc/rc.d</filename>.</para>
      </listitem>

      <listitem>
	<para>Como configurar e testar uma placa de rede.</para>
      </listitem>

      <listitem>
	<para>Como configurar hosts virtuais em dispositivos de rede.</para>
      </listitem>

      <listitem>
	<para>Como usar os vários arquivos de configuração em <filename>/etc</filename>.</para>
      </listitem>

      <listitem>
	<para>Como ajustar o FreeBSD usando variáveis <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
      </listitem>

      <listitem>
	<para>Como ajustar o desempenho do disco e modificar as limitações do kernel.</para>
      </listitem>
    </itemizedlist>

    <para>Antes de ler este capítulo, você deve:</para>

    <itemizedlist>
      <listitem>
	<para>Entender os fundamentos do <trademark class="registered">UNIX</trademark> e do FreeBSD (<xref linkend="basics"/>).</para>
      </listitem>

      <listitem>
	<para>Estar familiarizado com os conceitos básicos de configuração e compilação do kernel (<xref linkend="kernelconfig"/>).</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="configtuning-starting-services">
    <info>
      <title>Inicialização de Serviços</title>

      <authorgroup>
	<author><personname> <firstname>Tom</firstname> <surname>Rhodes</surname> </personname> <contrib>Contribuído por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>services</primary></indexterm>

    <para>Muitos usuários instalam software de terceiros no FreeBSD a partir da coleção de Ports e precisam que os serviços instalados sejam iniciados durante a inicialização do sistema. Serviços como <package>mail/postfix</package> ou <package>www/apache22</package> são apenas dois dos muitos pacotes de software que podem ser iniciados durante a inicialização do sistema. Esta seção explica os procedimentos disponíveis para iniciar o software de terceiros.</para>

    <para>No FreeBSD, a maioria dos serviços incluídos, como o <citerefentry><refentrytitle>cron</refentrytitle><manvolnum>8</manvolnum></citerefentry>, são iniciados através dos scripts de inicialização do sistema.</para>

    <sect2>
      <title>Configuração Estendida dos Aplicativos</title>

      <para>Agora que o FreeBSD inclui o <filename>rc.d</filename>, a configuração da inicialização do aplicativo é mais fácil e fornece mais recursos. Usando as palavras-chave discutidas em <xref linkend="configtuning-rcd"/>, os aplicativos podem ser configurados para iniciar depois de certos outros serviços e flags extras poderem ser passadas através do <filename>/etc/rc.conf</filename> no lugar de sinalizadores codificados no script de inicialização. Um script básico pode ser semelhante ao seguinte:</para>

      <programlisting>#!/bin/sh
#
# PROVIDE: utility
# REQUIRE: DAEMON
# KEYWORD: shutdown

. /etc/rc.subr

name=utility
rcvar=utility_enable

command="/usr/local/sbin/utility"

load_rc_config $name

#
# DO NOT CHANGE THESE DEFAULT VALUES HERE
# SET THEM IN THE /etc/rc.conf FILE
#
utility_enable=${utility_enable-"NO"}
pidfile=${utility_pidfile-"/var/run/utility.pid"}

run_rc_command "$1"</programlisting>

      <para>Este script irá garantir que o <literal>utilitário</literal> fornecido será iniciado após o pseudo-serviço <literal>DAEMON</literal>. Ele também fornece um método para definir e rastrear o ID do processo (<acronym>PID</acronym>).</para>

      <para>Esta aplicação poderia então ter a seguinte linha colocada no <filename>/etc/rc.conf</filename>:</para>

      <programlisting>utility_enable="YES"</programlisting>

      <para>Este método permite a manipulação mais fácil de argumentos de linha de comando, inclusão das funções padrões fornecidas em <filename>/etc/rc.subr</filename>, compatibilidade com o <citerefentry><refentrytitle>rcorder</refentrytitle><manvolnum>8</manvolnum></citerefentry>, e fornece uma configuração mais fácil via <filename>rc.conf</filename>.</para>
    </sect2>

    <sect2>
      <title>Usando o Services para Inicializar Serviços</title>

      <para>Outros serviços podem ser iniciados usando o <citerefentry><refentrytitle>inetd</refentrytitle><manvolnum>8</manvolnum></citerefentry>. O uso do <citerefentry><refentrytitle>inetd</refentrytitle><manvolnum>8</manvolnum></citerefentry> e sua configuração é descrita em profundidade em <xref linkend="network-inetd"/>.</para>

      <para>Em alguns casos, pode fazer mais sentido usar o <citerefentry><refentrytitle>cron</refentrytitle><manvolnum>8</manvolnum></citerefentry> para iniciar os serviços do sistema. Esta abordagem tem várias vantagens, pois o <citerefentry><refentrytitle>cron</refentrytitle><manvolnum>8</manvolnum></citerefentry> executa estes processos como o proprietário do <citerefentry><refentrytitle>crontab</refentrytitle><manvolnum>5</manvolnum></citerefentry>. Isto permite que usuários regulares iniciem e mantenham seus próprios aplicativos.</para>

      <para>O recurso <literal>@reboot</literal> do <citerefentry><refentrytitle>cron</refentrytitle><manvolnum>8</manvolnum> </citerefentry>, pode ser usado no lugar da especificação de hora. Isso faz com que o job seja executado quando <citerefentry><refentrytitle>cron</refentrytitle><manvolnum>8</manvolnum></citerefentry> é iniciado, normalmente durante a inicialização do sistema.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="configtuning-cron">
    <info>
      <title>Configurando o <citerefentry><refentrytitle>cron</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <authorgroup>
	<author><personname> <firstname>Tom</firstname> <surname>Rhodes</surname> </personname> <contrib>Contribuído por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>cron</primary> <secondary>configuration</secondary></indexterm>

    <para>Um dos utilitários mais úteis no FreeBSD é o <application>cron</application>. Este utilitário é executado em segundo plano e verifica regularmente o <filename>/etc/crontab</filename> para que as tarefas sejam executadas e procura <filename>/var/cron/tabs</filename> para arquivos crontab personalizados. Estes arquivos são usados para planejar tarefas que o <application>cron</application> executa nos horários especificados. Cada entrada em um crontab define uma tarefa para ser executada e é conhecida como uma <firstterm>tarefa do cron</firstterm>.</para>

    <para>Dois tipos diferentes de arquivos de configuração são usados: o crontab do sistema, que não deve ser modificado, e crontabs de usuário, que podem ser criados e editados conforme necessário. O formato usado por esses arquivos está documentado em <citerefentry><refentrytitle>crontab</refentrytitle><manvolnum>5</manvolnum></citerefentry>. O formato do sistema crontab, <filename>/etc/crontab</filename> inclui uma coluna <literal>who</literal> que não existe nos crontabs de usuário. No crontab do sistema , o <application>cron</application> executa o comando como o usuário especificado nesta coluna. Em um crontab de usuário, todos os comandos são executados como o usuário que criou o crontab.</para>

    <para>Os crontabs de usuário permitem que usuários individuais programem suas próprias tarefas. O usuário <systemitem class="username">root</systemitem> também pode ter um <filename>crontab</filename> de usuário que pode ser usado para agendar tarefas que não existem no <filename>crontab</filename> do sistema .</para>

    <para>Aqui está uma entrada de amostra do crontab do sistema, <filename>/etc/crontab</filename>:</para>

    <programlisting># /etc/crontab - root's crontab for FreeBSD
#
# <phrase its:translate="no">$FreeBSD$</phrase>
# <co xml:id="co-comments"/>
SHELL=/bin/sh
PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin <co xml:id="co-env"/>
#
#minute	hour	mday	month	wday	who	command <co xml:id="co-field-descr"/>
#
*/5	*	*	*	*	root	/usr/libexec/atrun <co xml:id="co-main"/></programlisting>

    <calloutlist>
      <callout arearefs="co-comments">
	<para>Linhas que começam com o caractere <literal>#</literal> são comentários. Um comentário pode ser colocado no arquivo como um lembrete do que uma ação faz e do porque a sua execução é desejada. Comentários não podem estar na mesma linha que um comando ou então serão interpretados como parte do comando; eles devem estar em uma nova linha. Linhas em branco são ignoradas.</para>
      </callout>

      <callout arearefs="co-env">
	<para>O caractere igual (<literal>=</literal>) é usado para definir qualquer configuração de ambiente. Neste exemplo, ele é usado para definir o <envar>SHELL</envar> e o <envar>PATH</envar>. Se o <envar>SHELL</envar> for omitido, o <application>cron</application> usará o shell Bourne padrão. Se o <envar>PATH</envar> for omitido, o caminho completo deverá ser fornecido ao comando ou script a ser executado.</para>
      </callout>

      <callout arearefs="co-field-descr">
	<para>Esta linha define os sete campos usados em um crontab do sistema: <literal>minute</literal>, <literal>hora</literal>, <literal>mday</literal>, <literal>month</literal>, <literal>wday</literal>, <literal>who</literal> e <literal>command</literal>. O campo <literal>minute</literal> é o tempo em minutos quando o comando especificado será executado, a <literal>hour</literal> é a hora em que o comando especificado será executado, o <literal>mday</literal>  é o dia do mês, <literal>month</literal> é o mês e <literal>wday</literal> é o dia da semana. Estes campos devem ser valores numéricos, representando o relógio de vinte e quatro horas, ou um <literal>*</literal>, representando todos os valores desse campo. O campo <literal>who</literal> existe somente no crontab do sistema e especifica com qual usuário o comando deve ser executado. O último campo é o comando a ser executado.</para>
      </callout>

      <callout arearefs="co-main">
	<para>Esta entrada define os valores para este trabalho do cron. O <literal>*/5</literal>, seguido por vários outros caracteres <literal>*</literal>, especifica que <command>/usr/libexec/atrun</command> é invocado pelo <systemitem class="username">root</systemitem> a cada cinco minutos de cada hora, de cada dia e dia da semana, de cada mês.</para>

	<para>Comandos podem incluir qualquer número de opções. No entanto, os comandos que se estendem a várias linhas precisam ser quebrados com o caractere de continuação da barra invertida <quote>\</quote>.</para>
      </callout>
    </calloutlist>

    <sect2 xml:id="configtuning-installcrontab">
      <title>Criando um Crontab de Usuário</title>

      <para>Para criar um crontab de usuário, invoque o <command>crontab</command> no modo editor:</para>

      <screen><prompt>%</prompt> <userinput>crontab -e</userinput></screen>

      <para>Isto irá abrir o crontab do usuário usando o editor de texto padrão. A primeira vez que um usuário executa este comando, ele abre um arquivo vazio. Depois que um usuário cria um crontab, esse comando abrirá este arquivo para edição.</para>

      <para>É útil adicionar estas linhas a parte superior do arquivo crontab para configurar as variáveis de ambiente e lembrar os significados dos campos no crontab:</para>

      <programlisting>SHELL=/bin/sh
PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin
# Order of crontab fields
# minute	hour	mday	month	wday	command</programlisting>

      <para>Em seguida, adicione uma linha para cada comando ou script a ser executado, especificando o horário para executar o comando. Este exemplo executa o script de shell Bourne personalizado especificado todos os dias às duas da tarde. Como o caminho para o script não está especificado em <literal>PATH</literal>, o caminho completo para o script é fornecido:</para>

      <programlisting>0	14	*	*	*	/usr/home/dru/bin/mycustomscript.sh</programlisting>

      <tip>
	<para>Antes de usar um script personalizado, verifique se ele é executável e teste-o com o conjunto limitado de variáveis de ambiente definidas pelo cron. Para replicar o ambiente que seria usado para executar a entrada do cron acima, use:</para>

	<programlisting>env -i SHELL=/bin/sh PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin HOME=/home/<replaceable>dru</replaceable> LOGNAME=<replaceable>dru</replaceable> <replaceable>/usr/home/dru/bin/mycustomscript.sh</replaceable></programlisting>

	<para>O ambiente definido pelo cron é discutido em <citerefentry><refentrytitle>crontab</refentrytitle><manvolnum>5</manvolnum></citerefentry>. Verificar se os scripts operam corretamente em um ambiente cron é especialmente importante se incluírem quaisquer comandos que excluam arquivos usando curingas.</para>
      </tip>

      <para>Quando terminar de editar o crontab, salve o arquivo. Ele será instalado automaticamente e o <application>cron</application> lerá o crontab e executará seus cron jobs nos horários especificados. Para listar as tarefas agendadas em um crontab, use este comando:</para>

      <screen><prompt>%</prompt> <userinput>crontab -l</userinput>
0	14	*	*	*	/usr/home/dru/bin/mycustomscript.sh</screen>

      <para>Para remover todas as tarefas cron em um crontab de usuário:</para>

      <screen><prompt>%</prompt> <userinput>crontab -r</userinput>
remove crontab for dru? <userinput>y</userinput></screen>
    </sect2>
  </sect1>

  <sect1 xml:id="configtuning-rcd">
    <info>
      <title>Gerenciando Serviços no FreeBSD</title>

      <authorgroup>
	<author><personname> <firstname>Tom</firstname> <surname>Rhodes</surname> </personname> <contrib>Contribuído por </contrib></author>
      </authorgroup>
    </info>

    <para>O FreeBSD usa o sistema <citerefentry><refentrytitle>rc</refentrytitle><manvolnum>8</manvolnum></citerefentry> de scripts de inicialização durante a inicialização do sistema e para gerenciar serviços. Os scripts listados em <filename>/etc/rc.d</filename> fornecem serviços básicos que podem ser controlados com <option>start</option>, <option>stop</option> e <option>restart</option> opções para <citerefentry><refentrytitle>service</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Por exemplo, <citerefentry><refentrytitle>sshd</refentrytitle><manvolnum>8</manvolnum></citerefentry> pode ser reiniciado com o seguinte comando:</para>

    <screen><prompt>#</prompt> <userinput>service sshd restart</userinput></screen>

    <para>Este procedimento pode ser usado para iniciar serviços em um sistema em execução. Os serviços serão iniciados automaticamente no momento da inicialização, conforme especificado em <citerefentry><refentrytitle>rc.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>. Por exemplo, para ativar o <citerefentry><refentrytitle>natd</refentrytitle><manvolnum>8</manvolnum></citerefentry> na inicialização do sistema, adicione a seguinte linha ao <filename>/etc/rc.conf</filename>:</para>

    <programlisting>natd_enable="YES"</programlisting>

    <para>Se uma linha <option>natd_enable="NO"</option> já estiver presente, altere o <literal>NO</literal> para <literal>YES</literal>. Os scripts <citerefentry><refentrytitle>rc</refentrytitle><manvolnum>8</manvolnum></citerefentry> carregarão automaticamente todos os serviços dependentes durante a próxima inicialização, conforme descrito abaixo.</para>

    <para>Como o sistema <citerefentry><refentrytitle>rc</refentrytitle><manvolnum>8</manvolnum></citerefentry> é destinado principalmente a iniciar e parar serviços na inicialização do sistema e no tempo de desligamento, o <option>start</option>, as opções <option>stop</option> e <option>restart</option> somente executarão suas ações se a variável apropriada estiver configurada no <filename>/etc/rc.conf</filename>. Por exemplo, o <command>sshd restart</command> só funcionará se <varname>sshd_enable</varname> estiver definido como <option>YES</option> em <filename>/etc/rc.conf</filename>. Para <option>iniciar</option>, <option>parar</option> ou <option>reiniciar</option> um serviço independente das configurações em <filename>/etc/rc.conf</filename>, estes comandos deve ser prefixado com <quote>one</quote>. Por exemplo, para reiniciar <citerefentry><refentrytitle>sshd</refentrytitle><manvolnum>8</manvolnum></citerefentry> independentemente da configuração atual do <filename>/etc/rc.conf</filename>, execute o seguinte comando:</para>

    <screen><prompt>#</prompt> <userinput>service sshd onerestart</userinput></screen>

    <para>Para verificar se um serviço está habilitado em <filename>/etc/rc.conf</filename>, execute o script apropriado <citerefentry><refentrytitle>rc</refentrytitle><manvolnum>8</manvolnum></citerefentry> com <option>rcvar</option>. Este exemplo verifica se o <citerefentry><refentrytitle>sshd</refentrytitle><manvolnum>8</manvolnum></citerefentry> está habilitado no  <filename>/etc/rc.conf</filename>:</para>

    <screen><prompt>#</prompt> <userinput>service sshd rcvar</userinput>
# sshd
#
sshd_enable="YES"
#   (default: "")</screen>

    <note>
      <para>A linha <literal># sshd</literal> é gerada pelo comando acima, não pelo console do <systemitem class="username">root</systemitem>.</para>
    </note>

    <para>Para determinar se um serviço está ou não em execução, use <option>status</option>. Por exemplo, para verificar se o <citerefentry><refentrytitle>sshd</refentrytitle><manvolnum>8</manvolnum></citerefentry> está em execução:</para>

    <screen><prompt>#</prompt> <userinput>service sshd status</userinput>
sshd is running as pid 433.</screen>

    <para>Em alguns casos, também é possível fazer o <option>reload</option> denum serviço. Isso tenta enviar um sinal para um serviço individual, forçando o serviço a recarregar seus arquivos de configuração. Na maioria dos casos, isso significa enviar ao serviço um sinal <literal>SIGHUP</literal>. O suporte para esse recurso não está incluído para todos os serviços.</para>

    <para>O sistema <citerefentry><refentrytitle>rc</refentrytitle><manvolnum>8</manvolnum></citerefentry> é usado para serviços de rede e também contribui para a maior parte da inicialização do sistema. Por exemplo, quando o script <filename>/etc/rc.d/bgfsck</filename> é executado, ele imprime a seguinte mensagem:</para>

    <screen>Starting background file system checks in 60 seconds.</screen>

    <para>Esse script é usado para verificações do sistema de arquivos em segundo plano, que ocorrem apenas durante a inicialização do sistema.</para>

    <para>Muitos serviços do sistema dependem de outros serviços para funcionar corretamente. Por exemplo, o <citerefentry><refentrytitle>yp</refentrytitle><manvolnum>8</manvolnum></citerefentry> e outros serviços baseados em <acronym>RPC</acronym> podem falhar ao iniciar até que o <citerefentry><refentrytitle>rpcbind</refentrytitle><manvolnum>8</manvolnum></citerefentry> seja iniciado. Para resolver esse problema, informações sobre dependências e outros meta-dados são incluídas nos comentários na parte superior de cada script de inicialização. O programa <citerefentry><refentrytitle>rcorder</refentrytitle><manvolnum>8</manvolnum></citerefentry> é usado para analisar esses comentários durante a inicialização do sistema para determinar a ordem na qual os serviços do sistema devem ser invocados para satisfazer as dependências.</para>

    <para>A seguinte palavra-chave deve ser incluída em todos os scripts de inicialização, conforme exigido pelo <citerefentry><refentrytitle>rc.subr</refentrytitle><manvolnum>8</manvolnum></citerefentry> para <quote>habilitar</quote> o script de inicialização:</para>

    <itemizedlist>
      <listitem>
	<para><literal>PROVIDE</literal>: Especifica os serviços que este arquivo fornece.</para>
      </listitem>
    </itemizedlist>

    <para>As seguintes palavras-chave podem ser incluídas na parte superior de cada script de inicialização. Eles não são estritamente necessárias, mas são úteis como sugestões para <citerefentry><refentrytitle>rcorder</refentrytitle><manvolnum>8</manvolnum></citerefentry>:</para>

    <itemizedlist>
      <listitem>
	<para><literal>REQUIRE</literal>: lista os serviços necessários para este serviço. O script que contém esta palavra chave será executado <emphasis>após</emphasis> os serviços especificados.</para>
      </listitem>

      <listitem>
	<para><literal>BEFORE</literal>: lista os serviços que dependem deste serviço. O script que contém esta palavra chave será executado <emphasis>antes</emphasis> dos serviços especificados.</para>
      </listitem>
    </itemizedlist>

    <para>Ao definir cuidadosamente essas palavras-chave para cada script de inicialização, um administrador passa a ter um nível refinado de controle da ordem de inicialização dos scripts, sem a necessidade dos <quote>runlevels</quote> usados por alguns sistemas operacionais <trademark class="registered">UNIX</trademark>.</para>

    <para>Informações adicionais podem ser encontradas em <citerefentry><refentrytitle>rc</refentrytitle><manvolnum>8</manvolnum></citerefentry> e <citerefentry><refentrytitle>rc.subr</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Consulte <link xlink:href="@@URL_RELPREFIX@@/doc/en_US.ISO8859-1/articles/rc-scripting">este artigo</link> para obter instruções sobre como criar um script <citerefentry><refentrytitle>rc</refentrytitle><manvolnum>8</manvolnum></citerefentry> personalizado.</para>

    <sect2 xml:id="configtuning-core-configuration">
      <title>Gerenciando a configuração específica do sistema</title>

      <indexterm><primary>rc files</primary> <secondary><filename>rc.conf</filename></secondary></indexterm>

      <para>A localização principal das informações de configuração do sistema é arquivo <filename>/etc/rc.conf</filename>. Este arquivo contém uma ampla gama de informações de configuração e é lido na inicialização do sistema para configurar o sistema. Ele fornece as informações de configuração para os arquivos <filename>rc*</filename>.</para>

      <para>As entradas em <filename>/etc/rc.conf</filename> substituem as configurações padrões em <filename>/etc/defaults/rc.conf</filename>. O arquivo contendo as configurações padrões não deve ser editado. Ao invés disso, todas as alterações específicas do sistema devem ser feitas em <filename>/etc/rc.conf</filename>.</para>

      <para>Várias estratégias podem ser aplicadas em aplicativos em cluster para separar as configurações que afetam todo o site da configuração específica do sistema para reduzir a sobrecarga de administração. A abordagem recomendada é colocar a configuração específica do sistema em <filename>/etc/rc.conf.local</filename>. Por exemplo, estas entradas em <filename>/etc/rc.conf</filename> aplicam-se a todos os sistemas:</para>

      <programlisting>sshd_enable="YES"
keyrate="fast"
defaultrouter="10.1.1.254"</programlisting>

      <para>Considerando que estas entradas em <filename>/etc/rc.conf.local</filename> se aplicam somente a este sistema:</para>

      <programlisting>hostname="node1.example.org"
ifconfig_fxp0="inet 10.1.1.1/8"</programlisting>

      <para>Distribua o <filename>/etc/rc.conf</filename> para cada sistema usando um aplicativo como o <application>rsync</application> ou o <application>puppet</application>, enquanto o <filename>/etc/rc.conf.local</filename> permanece único.</para>

      <para>A atualização do sistema não sobrescreverá o <filename>/etc/rc.conf</filename>, portanto as informações de configuração do sistema não serão perdidas.</para>

      <tip>
	<para>Ambos <filename>/etc/rc.conf</filename> e <filename>/etc/rc.conf.local</filename> são analisados pelo <citerefentry><refentrytitle>sh</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Isto permite que os operadores do sistema criem cenários de configuração complexos. Consulte <citerefentry><refentrytitle>rc.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry> para obter mais informações sobre este tópico.</para>
      </tip>
    </sect2>
  </sect1>

  <sect1 xml:id="config-network-setup">
    <info>
      <title>Configurando Placas de Interface de Rede</title>

      <authorgroup>
	<author><personname><firstname>Marc</firstname> <surname>Fonvieille</surname></personname> <contrib>Contribuído por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>placas de rede</primary> <secondary>configuração</secondary></indexterm>

    <para>Adicionar e configurar uma placa de interface de rede (<acronym>NIC</acronym>) é uma tarefa comum para qualquer administrador do FreeBSD.</para>

    <sect2>
      <title>Localizando o Driver Correto</title>

      <indexterm><primary>placas de rede</primary> <secondary>configuração</secondary></indexterm>

      <para>Primeiro, determine o modelo da <acronym>NIC</acronym> e o chip utilizado. O FreeBSD suporta uma ampla variedade de <acronym>NIC</acronym>s. Verifique a lista de compatibilidade de hardware para a release do FreeBSD para ver se a <acronym>NIC</acronym> é suportada.</para>

      <para>Se a <acronym>NIC</acronym> é suportada, determine o nome do driver do FreeBSD para a <acronym>NIC</acronym>. Consulte <filename>/usr/src/sys/conf/NOTES</filename> e <filename>/usr/src/sys/<replaceable>arch</replaceable>/conf/NOTES</filename> para a lista de Drivers <acronym>NIC</acronym> com algumas informações sobre os chipsets suportados. Em caso de dúvida, leia a página de manual do driver, pois ele fornecerá mais informações sobre o hardware suportado e quaisquer limitações conhecidas do driver.</para>

      <para>Os drivers para as <acronym>NIC</acronym>s comuns já estão presentes no kernel <filename>GENERIC</filename>, o que significa que a <acronym>NIC</acronym> deve ser verificada durante a inicialização. As mensagens de inicialização do sistema podem ser visualizadas digitando <command>more /var/run/dmesg.boot</command> e usando a barra de espaço para percorrer o texto. Neste exemplo, duas <acronym>NIC</acronym>s Ethernet 
 que utilizam o driver <citerefentry><refentrytitle>dc</refentrytitle><manvolnum>4</manvolnum></citerefentry> estão presentes no sistema:</para>

      <screen>dc0: &lt;82c169 PNIC 10/100BaseTX&gt; port 0xa000-0xa0ff mem 0xd3800000-0xd38
000ff irq 15 at device 11.0 on pci0
miibus0: &lt;MII bus&gt; on dc0
bmtphy0: &lt;BCM5201 10/100baseTX PHY&gt; PHY 1 on miibus0
bmtphy0:  10baseT, 10baseT-FDX, 100baseTX, 100baseTX-FDX, auto
dc0: Ethernet address: 00:a0:cc:da:da:da
dc0: [ITHREAD]
dc1: &lt;82c169 PNIC 10/100BaseTX&gt; port 0x9800-0x98ff mem 0xd3000000-0xd30
000ff irq 11 at device 12.0 on pci0
miibus1: &lt;MII bus&gt; on dc1
bmtphy1: &lt;BCM5201 10/100baseTX PHY&gt; PHY 1 on miibus1
bmtphy1:  10baseT, 10baseT-FDX, 100baseTX, 100baseTX-FDX, auto
dc1: Ethernet address: 00:a0:cc:da:da:db
dc1: [ITHREAD]</screen>

      <para>Se o driver da <acronym>NIC</acronym> não estiver presente em <filename>GENERIC</filename>, mas houver um driver disponível, o driver precisará ser carregado antes que a <acronym>NIC</acronym> possa ser configurada e usada. Isso pode ser feito de duas maneiras:</para>

      <itemizedlist>
	<listitem>
	  <para>A maneira mais fácil é carregar um módulo do kernel para a <acronym>NIC</acronym> usando o <citerefentry><refentrytitle>kldload</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Para carregar automaticamente o driver no momento da inicialização, adicione a linha apropriada ao <filename>/boot/loader.conf</filename>. Nem todos os drivers <acronym>NIC</acronym> estão disponíveis como módulos.</para>
	</listitem>

	<listitem>
	  <para>Como alternativa, compile estaticamente o suporte para a <acronym>NIC</acronym> em um kernel personalizado. Consulte <filename>/usr/src/sys/conf/NOTES</filename>, <filename>/usr/src/sys/<replaceable>arch</replaceable>/conf/NOTES</filename> e a página de manual do driver para determinar qual linha adicionar ao arquivo de configuração do kernel personalizado. Para mais informações sobre como recompilar o kernel, consulte <xref linkend="kernelconfig"/>. Se a <acronym>NIC</acronym> foi detectada na inicialização, o kernel não precisa ser recompilado.</para>
	</listitem>
      </itemizedlist>

      <sect3 xml:id="config-network-ndis">
	<title>Utilizando os Drivers <trademark class="registered">Windows</trademark> <acronym>NDIS</acronym></title>

	<indexterm><primary><acronym>NDIS</acronym></primary></indexterm>
	<indexterm><primary>NDISulator</primary></indexterm>
	<indexterm><primary><trademark class="registered">Windows</trademark> drivers</primary></indexterm>
	<indexterm><primary><trademark class="registered">Microsoft</trademark> <trademark class="registered">Windows</trademark></primary> <secondary>device drivers</secondary></indexterm>
	<indexterm><primary><acronym>KLD</acronym> (kernel loadable object)</primary></indexterm>
<!-- We should probably omit the expanded name, and add a <see> entry
for it.  Whatever is done must also be done to the same indexterm in
linuxemu/chapter.xml -->

	<para>Infelizmente, ainda existem muitos fornecedores que não fornecem esquemas para seus drivers para a comunidade de código aberto porque consideram essas informações como segredos comerciais. Consequentemente, os desenvolvedores do FreeBSD e de outros sistemas operacionais são deixados com duas opções: desenvolver os drivers por um processo longo e complexo de engenharia reversa ou usar os binários de drivers existentes disponíveis para plataforma <trademark class="registered">Microsoft</trademark> <trademark class="registered">Windows</trademark>.</para>

	<para>O FreeBSD fornece suporte <quote>nativo</quote> para a especificação de interface de driver de rede (<acronym>NDIS</acronym>). Ele inclui o <citerefentry><refentrytitle>ndisgen</refentrytitle><manvolnum>8</manvolnum></citerefentry> que pode ser utilizado para converter um driver <trademark class="registered">Windows</trademark> XP num formato que pode ser usado no FreeBSD. Como o driver <citerefentry><refentrytitle>ndis</refentrytitle><manvolnum>4</manvolnum></citerefentry> usa um binário <trademark class="registered">Windows</trademark> XP, ele só é executado em sistemas <trademark>i386</trademark> e amd64. Dispositivos <acronym>PCI</acronym>, CardBus, <acronym>PCMCIA</acronym> e <acronym>USB</acronym> são suportados.</para>

	<para>Para usar o <citerefentry><refentrytitle>ndisgen</refentrytitle><manvolnum>8</manvolnum></citerefentry>, três coisas são necessárias:</para>

	<orderedlist>
	  <listitem>
	    <para>Código-fonte do kernel do FreeBSD.</para>
	  </listitem>

	  <listitem>
	    <para>Um binário do driver do <trademark class="registered">Windows</trademark> XP com uma extensão <filename>.SYS</filename>.</para>
	  </listitem>

	  <listitem>
	    <para>Um arquivo de configuração do driver do <trademark class="registered">Windows</trademark> XP com uma extensão <filename>.INF</filename>.</para>
	  </listitem>
	</orderedlist>

	<para>Faça o download dos arquivos <filename>.SYS</filename> e <filename>.INF</filename> para a <acronym>NIC</acronym> específica. Geralmente, eles podem ser encontrados no CD do driver ou no site do fornecedor. Os exemplos a seguir usam o <filename>W32DRIVER.SYS</filename> e o <filename>W32DRIVER.INF</filename>.</para>

	<para>A largura do bit do driver deve corresponder à versão do FreeBSD. Para FreeBSD/i386, use um driver de 32 bits <trademark class="registered">Windows</trademark>. Para o FreeBSD/amd64, é necessário um driver de 64 bits do <trademark class="registered">Windows</trademark>.</para>

	<para>O próximo passo é compilar o binário do driver em um módulo do kernel carregável. Como <systemitem class="username">root</systemitem>, use <citerefentry><refentrytitle>ndisgen</refentrytitle><manvolnum>8</manvolnum></citerefentry>:</para>

	<screen><prompt>#</prompt> <userinput>ndisgen <replaceable>/path/to/W32DRIVER.INF</replaceable> <replaceable>/path/to/W32DRIVER.SYS</replaceable></userinput></screen>

	<para>Este comando é interativo e solicita qualquer informação extra necessária. Um novo módulo do kernel será gerado no diretório atual. Use <citerefentry><refentrytitle>kldload</refentrytitle><manvolnum>8</manvolnum></citerefentry> para carregar o novo módulo:</para>

	<screen><prompt>#</prompt> <userinput>kldload <replaceable>./W32DRIVER_SYS.ko</replaceable></userinput></screen>

	<para>Além do módulo do kernel gerado, os módulos <filename>ndis.ko</filename> e <filename>if_ndis.ko</filename> devem ser carregados. Isso deve acontecer automaticamente quando qualquer módulo que dependa do <citerefentry><refentrytitle>ndis</refentrytitle><manvolnum>4</manvolnum></citerefentry> for carregado. Caso contrário, carregue-os manualmente, usando os seguintes comandos:</para>

	<screen><prompt>#</prompt> <userinput>kldload ndis</userinput>
<prompt>#</prompt> <userinput>kldload if_ndis</userinput></screen>

	<para>O primeiro comando carrega o wrapper do driver da miniporta <citerefentry><refentrytitle>ndis</refentrytitle><manvolnum>4</manvolnum></citerefentry> e o segundo carrega o driver <acronym>NIC</acronym> gerado.</para>

	<para>Execute o comando <citerefentry><refentrytitle>dmesg</refentrytitle><manvolnum>8</manvolnum></citerefentry> para ver se houve algum erro de carregamento. Se tudo correu bem, a saída deve ser semelhante à seguinte:</para>

	<screen>ndis0: &lt;Wireless-G PCI Adapter&gt; mem 0xf4100000-0xf4101fff irq 3 at device 8.0 on pci1
ndis0: NDIS API version: 5.0
ndis0: Ethernet address: 0a:b1:2c:d3:4e:f5
ndis0: 11b rates: 1Mbps 2Mbps 5.5Mbps 11Mbps
ndis0: 11g rates: 6Mbps 9Mbps 12Mbps 18Mbps 36Mbps 48Mbps 54Mbps</screen>

	<para>A partir daqui, o <filename>ndis0</filename> pode ser configurado como qualquer outra <acronym>NIC</acronym>.</para>

	<para>Para configurar o sistema para carregar os módulos <citerefentry><refentrytitle>ndis</refentrytitle><manvolnum>4</manvolnum></citerefentry> no momento da inicialização, copie o módulo gerado, <filename>W32DRIVER_SYS.ko</filename>, para <filename>/boot/modules</filename>. Em seguida, adicione a seguinte linha ao <filename>/boot/loader.conf</filename>:</para>

	<programlisting>W32DRIVER_SYS_load="YES"</programlisting>
      </sect3>
    </sect2>

    <sect2>
      <title>Configurando a placa de rede</title>

      <indexterm><primary>placas de rede</primary> <secondary>configuração</secondary></indexterm>

      <para>Quando o driver correto é carregado para a <acronym>NIC</acronym>, a placa precisa ser configurada. Ele pode ter sido configurado no momento da instalação por <citerefentry><refentrytitle>bsdinstall</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>

      <para>Para exibir a configuração da <acronym>NIC</acronym>, digite o seguinte comando:</para>

      <screen><prompt>%</prompt> <userinput>ifconfig</userinput>
dc0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=80008&lt;VLAN_MTU,LINKSTATE&gt;
        ether 00:a0:cc:da:da:da
        inet 192.168.1.3 netmask 0xffffff00 broadcast 192.168.1.255
        media: Ethernet autoselect (100baseTX &lt;full-duplex&gt;)
        status: active
dc1: flags=8802&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=80008&lt;VLAN_MTU,LINKSTATE&gt;
        ether 00:a0:cc:da:da:db
        inet 10.0.0.1 netmask 0xffffff00 broadcast 10.0.0.255
        media: Ethernet 10baseT/UTP
        status: no carrier
lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; metric 0 mtu 16384
        options=3&lt;RXCSUM,TXCSUM&gt;
        inet6 fe80::1%lo0 prefixlen 64 scopeid 0x4
        inet6 ::1 prefixlen 128
        inet 127.0.0.1 netmask 0xff000000
        nd6 options=3&lt;PERFORMNUD,ACCEPT_RTADV&gt;</screen>

      <para>Neste exemplo, os seguintes dispositivos foram exibidos:</para>

      <itemizedlist>
	<listitem>
	  <para><filename>dc0</filename>: A primeira interface Ethernet.</para>
	</listitem>

	<listitem>
	  <para><filename>dc1</filename>: A segunda interface Ethernet.</para>
	</listitem>

	<listitem>
	  <para><filename>lo0</filename>: o dispositivo de loopback.</para>
	</listitem>
      </itemizedlist>

      <para>O FreeBSD usa o nome do driver seguido da ordem em que a placa é detectada na inicialização para nomear a <acronym>NIC</acronym>. Por exemplo, <filename>sis2</filename> é a terceira <acronym>NIC</acronym> no sistema usando driver <citerefentry><refentrytitle>sis</refentrytitle><manvolnum>4</manvolnum></citerefentry>.</para>

      <para>Neste exemplo, o <filename>dc0</filename> está ativo e em execução. Os principais indicadores são:</para>

      <orderedlist>
	<listitem>
	  <para><literal>UP</literal> significa que a placa está configurada e pronta.</para>
	</listitem>

	<listitem>
	  <para>A placa tem um endereço da Internet (<literal>inet</literal>), <systemitem class="ipaddress">192.168.1.3</systemitem>.</para>
	</listitem>

	<listitem>
	  <para>Ela tem uma máscara de sub-rede válida (<literal>netmask</literal>), onde <systemitem class="netmask">0xffffff00</systemitem> é o mesmo que <systemitem class="netmask">255.255.255.0</systemitem> .</para>
	</listitem>

	<listitem>
	  <para>Tem um endereço de broadcast válido, <systemitem class="ipaddress">192.168.1.255</systemitem>.</para>
	</listitem>

	<listitem>
	  <para>O endereço <acronym>MAC</acronym> da placa (<literal>ether</literal>) é <systemitem class="etheraddress">00:a0:cc:da:da:da</systemitem>.</para>
	</listitem>

	<listitem>
	  <para>A seleção de mídia física está no modo de seleção automática (<literal>media:Ethernet autoselect (100baseTX &lt;full-duplex&gt;)</literal>). Neste exemplo, o <filename>dc1</filename> está configurado para ser executado com a mídia <literal>10baseT/UTP</literal>. Para obter mais informações sobre tipos de mídia disponíveis para um driver, consulte sua página de manual.</para>
	</listitem>

	<listitem>
	  <para>O status do link (<literal>status</literal>) é <literal>active</literal>, indicando que o sinal da portadora foi detectado. Para <filename>dc1</filename>, o status <literal>status: no carrier</literal> é normal quando um cabo Ethernet não está conectado à placa.</para>
	</listitem>
      </orderedlist>

      <para>Se a saída <citerefentry><refentrytitle>ifconfig</refentrytitle><manvolnum>8</manvolnum></citerefentry> tivesse mostrado algo semelhante a:</para>

      <screen>dc0: flags=8843&lt;BROADCAST,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	options=80008&lt;VLAN_MTU,LINKSTATE&gt;
	ether 00:a0:cc:da:da:da
	media: Ethernet autoselect (100baseTX &lt;full-duplex&gt;)
	status: active</screen>

      <para>isso indicaria que a placa não foi configurada.</para>

      <para>A placa deve ser configurada como <systemitem class="username">root</systemitem>. A configuração da  <acronym>NIC</acronym> pode ser realizada a partir da linha de comando com o <citerefentry><refentrytitle>ifconfig</refentrytitle><manvolnum>8</manvolnum></citerefentry>, mas não persistirá após uma reinicialização, a menos que a configuração também seja adicionada ao <filename>/etc/rc.conf</filename>. Se um servidor <acronym>DHCP</acronym> estiver presente na LAN, basta adicionar esta linha:</para>

      <programlisting>ifconfig_dc0="DHCP"</programlisting>

      <para>Substitua <replaceable>dc0</replaceable> com o valor correto para o sistema.</para>

      <para>A linha adicionada, então, segue as instruções dadas em <xref linkend="config-network-testing"/>.</para>

      <note>
	<para>Se a rede foi configurada durante a instalação, algumas entradas para a <acronym>NIC</acronym> podem já estar presentes. Verifique novamente o <filename>/etc/rc.conf</filename> antes de adicionar novas linhas.</para>
      </note>

      <para>Se não existir um servidor  <acronym>DHCP</acronym>, a <acronym>NIC</acronym> deve ser configurada manualmente. Adicione uma linha para cada <acronym>NIC</acronym> presente no sistema, conforme mostrado neste exemplo:</para>

      <programlisting>ifconfig_dc0="inet 192.168.1.3 netmask 255.255.255.0"
ifconfig_dc1="inet 10.0.0.1 netmask 255.255.255.0 media 10baseT/UTP"</programlisting>

      <para>Substitua <filename>dc0</filename> e <filename>dc1</filename> e as informações de endereço <acronym>IP</acronym> com os valores corretos para o sistema. Consulte a man page do driver, <citerefentry><refentrytitle>ifconfig</refentrytitle><manvolnum>8</manvolnum></citerefentry> e <citerefentry><refentrytitle>rc.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry> para maiores detalhes sobre as opções permitidas e a sintaxe de <filename>/etc/rc.conf</filename>.</para>

      <para>Se a rede não estiver usando <acronym>DNS</acronym>, edite o <filename>/etc/hosts</filename> para adicionar os nomes e endereços <acronym>IP</acronym> dos hosts na <acronym>LAN</acronym>, se eles ainda não estiverem lá. Para maiores informações, consulte <citerefentry><refentrytitle>hosts</refentrytitle><manvolnum>5</manvolnum></citerefentry> e <filename>/usr/share/examples/etc/hosts</filename>.</para>

      <note>
	<para>Se não houver um servidor <acronym>DHCP</acronym> e o acesso à Internet for necessário, configure manualmente o gateway padrão e o nameserver:</para>

	<screen><prompt>#</prompt> <userinput>echo 'defaultrouter="<replaceable>your_default_router</replaceable>"' &gt;&gt; /etc/rc.conf</userinput>
<prompt>#</prompt> <userinput>echo 'nameserver <replaceable>your_DNS_server</replaceable>' &gt;&gt; /etc/resolv.conf</userinput></screen>
      </note>
    </sect2>

    <sect2 xml:id="config-network-testing">
      <title>Teste e solução de problemas</title>

      <para>Uma vez que as alterações necessárias no <filename>/etc/rc.conf</filename> sejam salvas, uma reinicialização pode ser usada para testar a configuração de rede e verificar se o sistema é reiniciado sem nenhum erro. Como alternativa, aplique as configurações ao sistema de rede com este comando:</para>

      <screen><prompt>#</prompt> <userinput>service netif restart</userinput></screen>

      <note>
	<para>Se um gateway padrão foi configurado no <filename>/etc/rc.conf</filename>, também execute este comando:</para>

	<screen><prompt>#</prompt> <userinput>service routing restart</userinput></screen>
      </note>

      <para>Uma vez que o sistema de rede tiver sido reiniciado, teste as <acronym>NIC</acronym>.</para>

      <sect3>
	<title>Testando uma placa Ethernet</title>

	<indexterm><primary>network cards</primary> <secondary>testing</secondary></indexterm>

	<para>Para verificar se uma placa Ethernet está configurada corretamente, execute um  <citerefentry><refentrytitle>ping</refentrytitle><manvolnum>8</manvolnum></citerefentry> na própria interface e, em seguida, <citerefentry><refentrytitle>ping</refentrytitle><manvolnum>8</manvolnum></citerefentry> outra máquina na <acronym>LAN</acronym>:</para>

	<screen><prompt>%</prompt> <userinput>ping -c5 192.168.1.3</userinput>
PING 192.168.1.3 (192.168.1.3): 56 data bytes
64 bytes from 192.168.1.3: icmp_seq=0 ttl=64 time=0.082 ms
64 bytes from 192.168.1.3: icmp_seq=1 ttl=64 time=0.074 ms
64 bytes from 192.168.1.3: icmp_seq=2 ttl=64 time=0.076 ms
64 bytes from 192.168.1.3: icmp_seq=3 ttl=64 time=0.108 ms
64 bytes from 192.168.1.3: icmp_seq=4 ttl=64 time=0.076 ms

--- 192.168.1.3 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 0.074/0.083/0.108/0.013 ms</screen>

	<screen><prompt>%</prompt> <userinput>ping -c5 192.168.1.2</userinput>
PING 192.168.1.2 (192.168.1.2): 56 data bytes
64 bytes from 192.168.1.2: icmp_seq=0 ttl=64 time=0.726 ms
64 bytes from 192.168.1.2: icmp_seq=1 ttl=64 time=0.766 ms
64 bytes from 192.168.1.2: icmp_seq=2 ttl=64 time=0.700 ms
64 bytes from 192.168.1.2: icmp_seq=3 ttl=64 time=0.747 ms
64 bytes from 192.168.1.2: icmp_seq=4 ttl=64 time=0.704 ms

--- 192.168.1.2 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 0.700/0.729/0.766/0.025 ms</screen>

	<para>Para testar a resolução da rede, use o nome do host em vez do endereço <acronym>IP</acronym>. Se não houver nenhum servidor <acronym>DNS</acronym> na rede, o <filename>/etc/hosts</filename> deve ser configurado primeiro. Para este propósito, edite o <filename>/etc/hosts</filename> para adicionar os nomes e os endereços <acronym>IP</acronym> dos hosts na <acronym>LAN</acronym>, se eles ainda não estiverem lá . Para maiores informações, consulte <citerefentry><refentrytitle>hosts</refentrytitle><manvolnum>5</manvolnum></citerefentry> e <filename>/usr/share/examples/etc/hosts</filename>.</para>
      </sect3>

      <sect3>
	<title>Solução de problemas</title>

	<indexterm><primary>network cards</primary> <secondary>troubleshooting</secondary></indexterm>

	<para>Ao solucionar problemas de configurações de hardware e software, verifique primeiro as coisas simples. O cabo de rede está conectado? Os serviços de rede estão configurados corretamente? O firewall está configurado corretamente? A <acronym>NIC</acronym> é suportada pelo FreeBSD? Antes de enviar um relatório de bug, sempre verifique as Notas de Hardware, atualize a versão do FreeBSD para a versão mais recente do STABLE, verifique os arquivos da lista de discussão e pesquise na Internet.</para>

	<para>Se a placa funcionar, mas o desempenho for ruim, leia <citerefentry><refentrytitle>tuning</refentrytitle><manvolnum>7</manvolnum></citerefentry>. Além disso, verifique a configuração da rede, pois configurações de rede incorretas podem causar conexões lentas.</para>

	<para>Alguns usuários experimentam uma ou duas mensagens de <errorname>device timeout</errorname>, o que é normal para algumas placas. Se eles continuarem ou forem incômodos, verifique se o dispositivo está em conflito com outro. Verifique novamente as conexões dos cabos. Considere tentar outra placa.</para>

	<para>Para resolver erros de <errorname>watchdog timeout</errorname>, primeiro verifique o cabo de rede. Muitas placas requerem um slot <acronym>PCI</acronym> que suporte a masterização de barramento. Em algumas placas-mãe antigas, apenas um slot <acronym>PCI</acronym> permite, normalmente o slot 0. Verifique a <acronym>NIC</acronym> e a documentação da placa-mãe para determinar se esse pode ser o problema.</para>

	<para>As mensagens <errorname>No route to host</errorname> ocorrem se o sistema não puder rotear um pacote para o host de destino. Isso pode acontecer se nenhuma rota padrão for especificada ou se um cabo for desconectado. Verifique a saída do <command>netstat -rn</command> e certifique-se de que haja uma rota válida para o host. Se não houver, leia <xref linkend="network-routing"/>.</para>

	<para>As mensagens de erro <errorname>ping: sendto: Permission denied</errorname> são geralmente causadas por um firewall mal configurado. Se um firewall está habilitado no FreeBSD, mas nenhuma regra foi definida, a política padrão é negar todo o tráfego, mesmo o <citerefentry><refentrytitle>ping</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Consulte <xref linkend="firewalls"/> para maiores informações.</para>

	<para>Às vezes, o desempenho da placa é ruim ou abaixo da média. Nesses casos, tente configurar o modo de seleção de mídia de <literal>autoselect</literal> para a seleção de mídia correta. Embora isso funcione para a maioria dos hardwares, isso pode ou não resolver o problema. Novamente, verifique todas as configurações de rede e consulte <citerefentry><refentrytitle>tuning</refentrytitle><manvolnum>7</manvolnum></citerefentry>.</para>
      </sect3>
    </sect2>
  </sect1>

  <sect1 xml:id="configtuning-virtual-hosts">
    <title>Hosts Virtuais</title>

    <indexterm><primary>virtual hosts</primary></indexterm>
    <indexterm><primary><acronym>IP</acronym> aliases</primary></indexterm>

    <para>Um uso comum do FreeBSD é a hospedagem de sites virtuais, onde um servidor aparece na rede como muitos servidores. Isso é conseguido atribuindo vários endereços de rede a uma única interface.</para>

    <para>Uma determinada interface de rede tem um endereço <quote>real</quote> e pode ter qualquer número de endereços <quote>alias</quote>. Esses aliases são normalmente adicionados colocando entradas de alias no <filename>/etc/rc.conf</filename>, como mostrado neste exemplo:</para>

    <programlisting>ifconfig_fxp0_alias0="inet xxx.xxx.xxx.xxx netmask xxx.xxx.xxx.xxx"</programlisting>

    <para>As entradas de alias devem começar com <literal>alias<replaceable>0</replaceable></literal> usando um número sequencial como <literal>alias0</literal>, <literal>alias1</literal> e assim por diante. O processo de configuração será interrompido no primeiro número ausente.</para>

    <para>O cálculo de máscaras de alias é importante. Para uma determinada interface, deve haver um endereço que represente corretamente a máscara de rede da rede. Qualquer outro endereço dentro dessa rede deve ter uma máscara de rede toda de <literal>1</literal>s, expressa como <systemitem class="netmask">255.255.255.255</systemitem> ou <systemitem class="netmask">0xffffffff</systemitem>.</para>

    <para>Por exemplo, considere o caso em que a interface <filename>fxp0</filename> está conectada a duas redes: <systemitem class="ipaddress">10.1.1.0</systemitem> com uma máscara de rede de <systemitem class="netmask">255.255.255.0</systemitem> e <systemitem class="ipaddress">202.0.75.16</systemitem> com uma máscara de rede de <systemitem class="netmask">255.255.255.240</systemitem>. O sistema deve ser configurado para aparecer nos intervalos <systemitem class="ipaddress">10.1.1.1</systemitem> até <systemitem class="ipaddress">10.1.1.5</systemitem> e <systemitem class="ipaddress">202.0.75.17</systemitem> até <systemitem class="ipaddress">202.0.75.20</systemitem>. Somente o primeiro endereço em um determinado intervalo de rede deve ter uma máscara de rede real. Todo o resto de  (<systemitem class="ipaddress">10.1.1.2</systemitem> até <systemitem class="ipaddress">10.1.1.5</systemitem> e de <systemitem class="ipaddress">202.0.75.18</systemitem> até <systemitem class="ipaddress">202.0.75.20</systemitem>) deve ser configurado com uma máscara de rede <systemitem class="netmask">255.255.255.255</systemitem>.</para>

    <para>As seguintes entradas <filename>/etc/rc.conf</filename> configuram o adaptador corretamente para este cenário:</para>

    <programlisting>ifconfig_fxp0="inet 10.1.1.1 netmask 255.255.255.0"
ifconfig_fxp0_alias0="inet 10.1.1.2 netmask 255.255.255.255"
ifconfig_fxp0_alias1="inet 10.1.1.3 netmask 255.255.255.255"
ifconfig_fxp0_alias2="inet 10.1.1.4 netmask 255.255.255.255"
ifconfig_fxp0_alias3="inet 10.1.1.5 netmask 255.255.255.255"
ifconfig_fxp0_alias4="inet 202.0.75.17 netmask 255.255.255.240"
ifconfig_fxp0_alias5="inet 202.0.75.18 netmask 255.255.255.255"
ifconfig_fxp0_alias6="inet 202.0.75.19 netmask 255.255.255.255"
ifconfig_fxp0_alias7="inet 202.0.75.20 netmask 255.255.255.255"</programlisting>

    <para>Uma maneira mais simples de expressar isso é com uma lista separada por espaço de intervalos de endereços <acronym>IP</acronym>. O primeiro endereço receberá a máscara de sub-rede indicada e os endereços adicionais terão uma máscara de sub-rede <literal>255.255.255.255</literal>.</para>

    <programlisting>ifconfig_fxp0_aliases="inet 10.1.1.1-5/24 inet 202.0.75.17-20/28"</programlisting>
  </sect1>

  <sect1 xml:id="configtuning-syslog">
    <info>
      <title>Configurando o log do sistema</title>

      <authorgroup>
	<author><personname> <firstname> Niclas </firstname> <surname> Zeising </surname> </personname> <contrib> Contribuído por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>system logging</primary></indexterm>
    <indexterm><primary>syslog</primary></indexterm>
    <indexterm><primary><citerefentry><refentrytitle>syslogd</refentrytitle><manvolnum>8</manvolnum></citerefentry></primary></indexterm>

    <para>Gerar e ler logs do sistema é um aspecto importante da administração do sistema. As informações nos registros do sistema podem ser usadas para detectar problemas de hardware e software, bem como erros de configuração dos aplicativos e do sistema. Essas informações também desempenham um papel importante na auditoria de segurança e na resposta a incidentes. A maioria dos daemons e aplicativos do sistema geram entradas de log.</para>

    <para>O FreeBSD fornece um registrador de sistema, o <application>syslogd</application>, para gerenciar o registro. Por padrão, o <application>syslogd</application> é iniciado quando o sistema é inicializado. Isto é controlado pela variável <literal>syslogd_enable</literal> no <filename>/etc/rc.conf</filename>. Existem vários argumentos de aplicação que podem ser definidos usando <literal>syslogd_flags</literal> no <filename>/etc/rc.conf</filename>. Consulte <citerefentry><refentrytitle>syslogd</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter maiores informações sobre os argumentos disponíveis.</para>

    <para>Esta seção descreve como configurar o criador de logs do sistema FreeBSD para log local e remoto e como executar a rotação de log e o gerenciamento de log.</para>

    <sect2>
      <title>Configurando os logs locais</title>

      <indexterm><primary>syslog.conf</primary></indexterm>

      <para>O arquivo de configuração, <filename>/etc/syslog.conf</filename>, controla o que o <application>syslogd</application> faz com as entradas de log à medida que são recebidas. Existem vários parâmetros para controlar o tratamento de eventos recebidos. O <firstterm>facility</firstterm> descreve qual subsistema gerou a mensagem, como o kernel ou um daemon, e o <firstterm>level</firstterm> descreve a gravidade do evento que ocorreu. Isso possibilita configurar onde uma mensagem de log é registrada, dependendo da instalação e do nível. Também é possível executar uma ação dependendo do aplicativo que enviou a mensagem e, no caso de log remoto, o nome do host da máquina que gera o evento de log.</para>

      <para>Este arquivo de configuração contém uma linha por ação, em que a sintaxe de cada linha é um campo seletor seguido por um campo de ação. A sintaxe do campo seletor é <replaceable>facility.level</replaceable>, que corresponderá às mensagens de log de <replaceable>facility</replaceable> no nível <replaceable>level</replaceable> ou superior. Também é possível adicionar um sinalizador de comparação opcional antes do nível para especificar mais precisamente o que está registrado. Vários campos seletores podem ser usados para a mesma ação e são separados por um ponto-e-vírgula (<literal>;</literal>). Usar <literal>*</literal> irá corresponder a tudo. O campo de ação indica para onde enviar a mensagem de log, como para um arquivo ou host de log remoto. Por exemplo, aqui está o <filename>syslog.conf</filename> padrão do FreeBSD:</para>

      <programlisting># <phrase its:translate="no">$FreeBSD$</phrase>
#
#       Spaces ARE valid field separators in this file. However,
#       other *nix-like systems still insist on using tabs as field
#       separators. If you are sharing this file between systems, you
#       may want to use only tabs as field separators here.
#       Consult the syslog.conf(5) manpage.
*.err;kern.warning;auth.notice;mail.crit                /dev/console
*.notice;authpriv.none;kern.debug;lpr.info;mail.crit;news.err   /var/log/messages
security.*                                      /var/log/security
auth.info;authpriv.info                         /var/log/auth.log
mail.info                                       /var/log/maillog
lpr.info                                        /var/log/lpd-errs
ftp.info                                        /var/log/xferlog
cron.*                                          /var/log/cron
!-devd
*.=debug                                        /var/log/debug.log
*.emerg                                         *
# uncomment this to log all writes to /dev/console to /var/log/console.log
#console.info                                   /var/log/console.log
# uncomment this to enable logging of all log messages to /var/log/all.log
# touch /var/log/all.log and chmod it to mode 600 before it will work
#*.*                                            /var/log/all.log
# uncomment this to enable logging to a remote loghost named loghost
#*.*                                            @loghost
# uncomment these if you're running inn
# news.crit                                     /var/log/news/news.crit
# news.err                                      /var/log/news/news.err
# news.notice                                   /var/log/news/news.notice
# Uncomment this if you wish to see messages produced by devd
# !devd
# *.&gt;=info
!ppp
*.*                                             /var/log/ppp.log
!*</programlisting>

      <para>Neste exemplo:</para>

      <itemizedlist>
	<listitem>
	  <para>A linha 8 combina todas as mensagens com um nível de <literal>err</literal> ou superior, bem como <literal>kern.warning</literal>, <literal>auth.notice</literal> e <literal>mail.crit</literal>, e envia essas mensagens de log para o console (<filename>/dev/console</filename>).</para>
	</listitem>

	<listitem>
	  <para>A linha 12 combina todas as mensagens do recurso <literal>mail</literal> no nível <literal>info</literal> ou acima e registra as mensagens em <filename>/var/log/maillog</filename>.</para>
	</listitem>

	<listitem>
	  <para>A linha 17 usa um sinalizador de comparação (<literal>=</literal>) para corresponder apenas as mensagens no nível <literal>debug</literal> e registrá-las em <filename>/var/log/debug.log</filename>.</para>
	</listitem>

	<listitem>
	  <para>A linha 33 é um exemplo de uso de uma especificação de programa. Isso faz com que as regras que a seguem apenas sejam válidas para o programa especificado. Neste caso, somente as mensagens geradas pelo <application>ppp</application> são registradas em <filename>/var/log/ppp.log</filename>.</para>
	</listitem>
      </itemizedlist>

      <para>Os níveis disponíveis, na ordem dos mais para o menos críticos, são <literal>emerg</literal>, <literal>alert</literal>, <literal>crit</literal>, <literal>err</literal>, <literal>warning</literal>, <literal>notice</literal>, <literal>info</literal>, and <literal>debug</literal>.</para>

      <para>As facilities, em nenhuma ordem particular, são <literal>auth</literal>, <literal>authpriv</literal>, <literal>console</literal>, <literal>cron</literal>, <literal>daemon</literal>, <literal>ftp</literal>, <literal>kern</literal>, <literal>lpr</literal>, <literal>mail</literal>, <literal>mark</literal>, <literal>news</literal>, <literal>security</literal>, <literal>syslog</literal>, <literal>user</literal>, <literal>uucp</literal>, and <literal>local0</literal> through <literal>local7</literal>. Esteja ciente de que outros sistemas operacionais podem ter recursos diferentes.</para>

      <para>Para registrar tudo do nível <literal>notice</literal> e superior para <filename>/var/log/daemon.log</filename>, adicione a seguinte entrada:</para>

      <programlisting>daemon.notice                                        /var/log/daemon.log</programlisting>

      <para>Para obter mais informações sobre os diferentes níveis e facilities, consulte <citerefentry><refentrytitle>syslog</refentrytitle><manvolnum>3</manvolnum></citerefentry> e <citerefentry><refentrytitle>syslogd</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Para maiores informações sobre <filename>/etc/syslog.conf</filename>, sua sintaxe e exemplos de uso mais avançados, veja <citerefentry><refentrytitle>syslog.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>
    </sect2>

    <sect2>
      <title>Gerenciamento de log e rotação</title>

      <indexterm><primary>newsyslog</primary></indexterm>
      <indexterm><primary>newsyslog.conf</primary></indexterm>
      <indexterm><primary>log rotation</primary></indexterm>
      <indexterm><primary>log management</primary></indexterm>

      <para>Os arquivos de log podem crescer rapidamente, ocupando espaço em disco e dificultando a localização de informações úteis. O gerenciamento de log tenta atenuar isso. No FreeBSD, o <application>newsyslog</application> é usado para gerenciar arquivos de log. Este programa interno rotaciona e comprime periodicamente arquivos de log e, opcionalmente, cria arquivos de log ausentes e sinaliza os programas quando os arquivos de log são movidos. Os arquivos de log podem ser gerados pelo <application>syslogd</application> ou por qualquer outro programa que gere arquivos de log. Enquanto o <application>newsyslog</application> é normalmente executado a partir do <citerefentry><refentrytitle>cron</refentrytitle><manvolnum>8</manvolnum></citerefentry>, ele não é um daemon do sistema. Na configuração padrão, ele é executado a cada hora.</para>

      <para>Para saber quais ações executar, o <application>newsyslog</application> lê seu arquivo de configuração, <filename>/etc/newsyslog.conf</filename>. Este arquivo contém uma linha para cada arquivo de log que o <application>newsyslog</application> gerencia. Cada linha indica o proprietário do arquivo, suas permissões, quando rotacionar esse arquivo, flags opcionais que afetam a rotação do log, como compactação, e programas para sinalizar quando o log é rotacionado. Aqui está a configuração padrão no FreeBSD:</para>

      <programlisting># configuration file for newsyslog
# <phrase its:translate="no">$FreeBSD$</phrase>
#
# Entries which do not specify the '/pid_file' field will cause the
# syslogd process to be signalled when that log file is rotated.  This
# action is only appropriate for log files which are written to by the
# syslogd process (ie, files listed in /etc/syslog.conf).  If there
# is no process which needs to be signalled when a given log file is
# rotated, then the entry for that file should include the 'N' flag.
#
# The 'flags' field is one or more of the letters: BCDGJNUXZ or a '-'.
#
# Note: some sites will want to select more restrictive protections than the
# defaults.  In particular, it may be desirable to switch many of the 644
# entries to 640 or 600.  For example, some sites will consider the
# contents of maillog, messages, and lpd-errs to be confidential.  In the
# future, these defaults may change to more conservative ones.
#
# logfilename          [owner:group]    mode count size when  flags [/pid_file] [sig_num]
/var/log/all.log                        600  7     *    @T00  J
/var/log/amd.log                        644  7     100  *     J
/var/log/auth.log                       600  7     100  @0101T JC
/var/log/console.log                    600  5     100  *     J
/var/log/cron                           600  3     100  *     JC
/var/log/daily.log                      640  7     *    @T00  JN
/var/log/debug.log                      600  7     100  *     JC
/var/log/kerberos.log                   600  7     100  *     J
/var/log/lpd-errs                       644  7     100  *     JC
/var/log/maillog                        640  7     *    @T00  JC
/var/log/messages                       644  5     100  @0101T JC
/var/log/monthly.log                    640  12    *    $M1D0 JN
/var/log/pflog                          600  3     100  *     JB    /var/run/pflogd.pid
/var/log/ppp.log        root:network    640  3     100  *     JC
/var/log/devd.log                       644  3     100  *     JC
/var/log/security                       600  10    100  *     JC
/var/log/sendmail.st                    640  10    *    168   B
/var/log/utx.log                        644  3     *    @01T05 B
/var/log/weekly.log                     640  5     1    $W6D0 JN
/var/log/xferlog                        600  7     100  *     JC</programlisting>

      <para>Cada linha começa com o nome do log a ser rotacionado, seguido opcionalmente por um proprietário e um grupo para arquivos rotacionados e recém-criados. O campo <literal>mode</literal> define as permissões no arquivo de log e <literal>count</literal> indica quantos arquivos de log rotacionados devem ser mantidos. Os campos <literal>size</literal> e <literal>when</literal> informam o <application>newsyslog</application> quando rotacionar o arquivo. Um arquivo de log é rotacionado quando seu tamanho é maior que o campo <literal>size</literal> ou quando o tempo no campo <literal>when</literal> tiver terminado. Um asterisco (<literal>*</literal>) significa que este campo é ignorado. O campo <replaceable>flags</replaceable> fornece instruções adicionais, por exemplo, como compactar o arquivo rotacionado ou criar o arquivo de log se ele estiver ausente. Os dois últimos campos são opcionais e especificam o nome do arquivo de ID de Processo (<acronym>PID</acronym>) e um número de sinal para enviar a esse processo quando o arquivo é rotacionado.</para>

      <para>Para obter maiores informações sobre todos os campos, sinalizadores válidos e como sobre especificar o tempo de rotação, consulte <citerefentry><refentrytitle>newsyslog.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>. Como o <application>newsyslog</application> é executado a partir do <citerefentry><refentrytitle>cron</refentrytitle><manvolnum>8</manvolnum></citerefentry>, ele não pode rotacionar arquivos com mais frequência do que a que está planejada para ser executada no <citerefentry><refentrytitle>cron</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
    </sect2>

    <sect2 xml:id="network-syslogd">
      <info>
	<title>Configurando o log remoto</title>

	<authorgroup>
	  <author><personname> <firstname>Tom</firstname> <surname>Rhodes</surname> </personname> <contrib>Contribuído por </contrib></author>
	</authorgroup>
      </info>

      <para>Monitorar os arquivos de log de vários hosts pode se tornar difícil à medida que o número de sistemas aumenta. Configurar o log centralizado pode reduzir parte da carga administrativa da administração dos arquivos de log.</para>

      <para>No FreeBSD, a agregação, a fusão e a rotação centralizada de arquivos de log podem ser configuradas usando o <application>syslogd</application> e o <application>newsyslog</application>. Esta seção demonstra um exemplo de configuração, em que host o <systemitem>A</systemitem>, chamado <systemitem class="fqdomainname">logserv.example.com</systemitem>, coletará informações de log para a rede local. O host <systemitem>B</systemitem>, denominado <systemitem class="fqdomainname">logclient.example.com</systemitem>, será configurado para transmitir informações de log para o servidor de registro em log.</para>

      <sect3>
	<title>Configuração do servidor de log</title>

	<para>Um servidor de log é um sistema que foi configurado para aceitar informações de log de outros hosts. Antes de configurar um servidor de log, verifique o seguinte:</para>

	<itemizedlist>
	  <listitem>
	    <para>Se houver um firewall entre o servidor de log e qualquer cliente de log, certifique-se de que o conjunto de regras do firewall permita a porta 514 do <acronym>UDP</acronym> para os clientes e o servidor.</para>
	  </listitem>

	  <listitem>
	    <para>O servidor de log e todas as máquinas clientes devem ter entradas de nome  diretas e reversas no <acronym>DNS</acronym> local. Se a rede não tiver um servidor <acronym>DNS</acronym>, crie entradas no <filename>/etc/hosts</filename> de cada sistema. A resolução adequada de nomes é necessária para que as entradas de log não sejam rejeitadas pelo servidor de log.</para>
	  </listitem>
	</itemizedlist>

	<para>No servidor de log, edite o <filename>/etc/syslog.conf</filename> para especificar o nome do cliente para receber as entradas de log, o recurso de log a ser usado e o nome do log para armazenar as entradas de log do host. Este exemplo adiciona o nome do host de <systemitem>B</systemitem>, registra todos os recursos e armazena as entradas de log em <filename>/var/log/logclient.log</filename>.</para>

	<example>
	  <title>Configuração do servidor de log de exemplo</title>

	  <programlisting>+logclient.example.com
*.*     /var/log/logclient.log</programlisting>
	</example>

	<para>Ao adicionar vários clientes de log, adicione uma entrada semelhante de duas linhas para cada cliente. Maiores informações sobre os recursos disponíveis podem ser encontradas em <citerefentry><refentrytitle>syslog.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>

	<para>Em seguida, configure o <filename>/etc/rc.conf</filename>:</para>

	<programlisting>syslogd_enable="YES"
syslogd_flags="-a logclient.example.com -v -v"</programlisting>

	<para>A primeira entrada inicia o <application>syslogd</application> na inicialização do sistema. A segunda entrada permite entradas de log do cliente especificado. A opção <option>-v -v</option> aumenta a verbosidade das mensagens registradas. Isso é útil para ajustar os recursos, pois os administradores podem ver o tipo de mensagens que estão sendo registradas em cada facility.</para>

	<para>Múltiplas opções <option>-a</option> podem ser especificadas para permitir o registro de múltiplos clientes. Endereços <acronym>IP</acronym> e netblocks inteiros também podem ser especificados. Consulte <citerefentry><refentrytitle>syslogd</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter uma lista completa de opções possíveis.</para>

	<para>Finalmente, crie o arquivo de log:</para>

	<screen><prompt>#</prompt> <userinput>touch /var/log/logclient.log</userinput></screen>

	<para>Neste ponto, o <application>syslogd</application> deve ser reiniciado e verificado:</para>

	<screen><prompt>#</prompt> <userinput>service syslogd restart</userinput>
<prompt>#</prompt> <userinput>pgrep syslog</userinput></screen>

	<para>Se um <acronym>PID</acronym> for retornado, o servidor será reiniciado com êxito e a configuração do cliente poderá ser iniciada. Se o servidor não reiniciar, consulte <filename>/var/log/messages</filename> para visualizar o erro.</para>
      </sect3>

      <sect3>
	<title>Configuração do cliente de log</title>

	<para>Um cliente de log envia entradas de log para um servidor de log na rede. O cliente também mantém uma cópia local de seus próprios logs.</para>

	<para>Uma vez que o servidor de log foi configurado, edite o <filename>/etc/rc.conf</filename> no cliente de registro:</para>

	<programlisting>syslogd_enable="YES"
syslogd_flags="-s -v -v"</programlisting>

	<para>A primeira entrada ativa o <application>syslogd</application> na inicialização. A segunda entrada impede que os logs sejam aceitos por esse cliente de outros hosts (<option>-s</option>) e aumenta a verbosidade das mensagens registradas.</para>

	<para>Em seguida, defina o servidor de log no <filename>/etc/syslog.conf</filename> do cliente. Neste exemplo, todos os facilities registrados são enviados para um sistema remoto, indicado pelo símbolo <literal>@</literal>, com o nome do host especificado:</para>

	<programlisting>*.*		@logserv.example.com</programlisting>

	<para>Depois de salvar a edição, reinicie o <application>syslogd</application> para que as alterações entrem em vigor:</para>

	<screen><prompt>#</prompt> <userinput>service syslogd restart</userinput></screen>

	<para>Para testar se as mensagens de log estão sendo enviadas pela rede, use o <citerefentry><refentrytitle>logger</refentrytitle><manvolnum>1</manvolnum></citerefentry> no cliente para enviar uma mensagem para <application>syslogd</application>:</para>

	<screen><prompt>#</prompt> <userinput>logger "<replaceable>Test message from logclient</replaceable>"</userinput></screen>

	<para>Esta mensagem agora deve existir tanto no <filename>/var/log/messages</filename> do cliente e no <filename>/var/log/logclient.log</filename> do servidor de log.</para>
      </sect3>

      <sect3>
	<title>Debugando servidores de log</title>

	<para>Se nenhuma mensagem estiver sendo recebida no servidor de log, a causa provavelmente é um problema de conectividade de rede, um problema de resolução de nome de host ou um erro de digitação em um arquivo de configuração. Para isolar a causa, certifique-se de que o servidor de log e o cliente de log sejam capazes de comunicarem através do <command>ping</command> usando o nome do host especificado em seu <filename>/etc/rc.conf</filename>. Se isso falhar, verifique o cabeamento da rede, o conjunto de regras do firewall e as entradas de nome de host no servidor <acronym>DNS</acronym> ou <filename>/etc/hosts</filename> no servidor de log e nos clientes. Repita até que o <command>ping</command> seja bem-sucedido em ambos os hosts.</para>

	<para>Se o <command>ping</command> for bem-sucedido em ambos os hosts, mas as mensagens de log ainda não estiverem sendo recebidas, aumente temporariamente o detalhamento do log para diminuir o problema de configuração. No exemplo a seguir, o <filename>/var/log/logclient.log</filename> no servidor de log está vazio e o <filename>/var/log/messages</filename> no cliente de log não indica uma razão para a falha. Para aumentar a saída de debug, edite a entrada <literal>syslogd_flags</literal> no servidor de log e execute uma reinicialização:</para>

	<programlisting>syslogd_flags="-d -a logclient.example.com -v -v"</programlisting>

	<screen><prompt>#</prompt> <userinput>service syslogd restart</userinput></screen>

	<para>Dados de debug semelhantes aos seguintes irão aparecer no console imediatamente após a reinicialização:</para>

	<screen>logmsg: pri 56, flags 4, from logserv.example.com, msg syslogd: restart
syslogd: restarted
logmsg: pri 6, flags 4, from logserv.example.com, msg syslogd: kernel boot file is /boot/kernel/kernel
Logging to FILE /var/log/messages
syslogd: kernel boot file is /boot/kernel/kernel
cvthname(192.168.1.10)
validate: dgram from IP 192.168.1.10, port 514, name logclient.example.com;
rejected in rule 0 due to name mismatch.</screen>

	<para>Neste exemplo, as mensagens de log estão sendo rejeitadas devido a um erro de digitação que resulta em uma incompatibilidade de nome de host. O nome do host do cliente deve ser <literal>logclient</literal>, não <literal>logclien</literal>. Corrija o erro de digitação, execute uma reinicialização e verifique os resultados:</para>

	<screen><prompt>#</prompt> <userinput>service syslogd restart</userinput>
logmsg: pri 56, flags 4, from logserv.example.com, msg syslogd: restart
syslogd: restarted
logmsg: pri 6, flags 4, from logserv.example.com, msg syslogd: kernel boot file is /boot/kernel/kernel
syslogd: kernel boot file is /boot/kernel/kernel
logmsg: pri 166, flags 17, from logserv.example.com,
msg Dec 10 20:55:02 &lt;syslog.err&gt; logserv.example.com syslogd: exiting on signal 2
cvthname(192.168.1.10)
validate: dgram from IP 192.168.1.10, port 514, name logclient.example.com;
accepted in rule 0.
logmsg: pri 15, flags 0, from logclient.example.com, msg Dec 11 02:01:28 trhodes: Test message 2
Logging to FILE /var/log/logclient.log
Logging to FILE /var/log/messages</screen>

	<para>Neste ponto, as mensagens estão sendo recebidas e colocadas corretamente no arquivo correto.</para>
      </sect3>

      <sect3>
	<title>Considerações de segurança</title>

	<para>Como com qualquer serviço de rede, os requisitos de segurança devem ser considerados antes de implementar um servidor de log. Os arquivos de log podem conter dados confidenciais sobre serviços ativados no host local, contas de usuário e dados de configuração. Os dados enviados pela rede do cliente para o servidor não serão criptografados nem protegidos por senha. Se houver necessidade de criptografia, considere o uso do <package>security/stunnel</package>, que transmitirá os dados de log em um túnel criptografado.</para>

	<para>A segurança local também é um problema. Os arquivos de log não são criptografados durante o uso ou após a rotação do log. Usuários locais podem acessar arquivos de log para obter informações adicionais sobre a configuração do sistema. Definir permissões adequadas nos arquivos de log é crítico. O rotacionador de log integrado, <application>newsyslog</application>, suporta a configuração de permissões em arquivos de log recém-criados e rotacionados. A configuração de arquivos de log no modo <literal>600</literal> deve impedir o acesso indesejado por usuários locais. Consulte <citerefentry><refentrytitle>newsyslog.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry> para obter informações adicionais.</para>
      </sect3>
    </sect2>
  </sect1>

  <sect1 xml:id="configtuning-configfiles">
    <title>Arquivos de Configuração</title>

    <sect2>
      <title>Layout do <filename>/etc</filename></title>

      <para>Existem vários diretórios nos quais as informações de configuração são mantidas. Estes incluem:</para>

      <informaltable frame="none" pgwide="1">
	<tgroup cols="2">
	  <colspec colwidth="1*"/>
	  <colspec colwidth="2*"/>

	  <tbody>
	    <row>
	      <entry><filename>/etc</filename></entry>
	      <entry>Informações de configuração específica do sistema genérico.</entry>
	    </row>

	    <row>
	      <entry><filename>/etc/defaults</filename></entry>
	      <entry>Versões padrão dos arquivos de configuração do sistema.</entry>
	    </row>

	    <row>
	      <entry><filename>/etc/mail</filename></entry>
	      <entry>Configuração extra do <citerefentry><refentrytitle>sendmail</refentrytitle> <manvolnum>8</manvolnum></citerefentry> e outros arquivos de configuração  <acronym>MTA</acronym>.</entry>
	    </row>

	    <row>
	      <entry><filename>/etc/ppp</filename></entry>
	      <entry>Configuração para ambos os programas, user- e kernel-ppp.</entry>
	    </row>

	    <row>
	      <entry><filename>/usr/local/etc</filename></entry>
	      <entry>Arquivos de configuração para aplicativos instalados. Pode conter subdiretórios para cada aplicativo.</entry>
	    </row>

	    <row>
	      <entry><filename>/usr/local/etc/rc.d</filename></entry>
	      <entry>scripts <citerefentry><refentrytitle>rc</refentrytitle><manvolnum>8</manvolnum></citerefentry> para os aplicativos instalados.</entry>
	    </row>

	    <row>
	      <entry><filename>/var/db</filename></entry>
	      <entry>Arquivos de banco de dados específicos do sistema gerados automaticamente, como o banco de dados de pacotes e o banco de dados <citerefentry><refentrytitle>locate</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </informaltable>
    </sect2>

    <sect2>
      <title>Hostnames</title>

      <indexterm><primary>hostname</primary></indexterm>
      <indexterm><primary>DNS</primary></indexterm>

      <sect3>
	<title><filename>/etc/resolv.conf</filename></title>

	<indexterm><primary><filename>resolv.conf</filename></primary></indexterm>

	<para>Como um sistema FreeBSD acessa o Sistema de Nomes de Domínio da Internet (Internet Domain Name System - <acronym>DNS</acronym>) é controlado por <citerefentry><refentrytitle>resolv.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>

	<para>As entradas mais comuns para o <filename>/etc/resolv.conf</filename> são:</para>

	<informaltable frame="none" pgwide="1">
	  <tgroup cols="2">
	    <colspec colwidth="1*"/>
	    <colspec colwidth="2*"/>

	    <tbody>
	      <row>
		<entry><literal>nameserver</literal></entry>
		<entry>O endereço <acronym>IP</acronym> de um servidor de nomes que o resolvedor deve consultar. Os servidores são consultados na ordem listada com um máximo de três.</entry>
	      </row>

	      <row>
		<entry><literal>search</literal></entry>
		<entry>Lista de pesquisa, para busca de nomes de host. Isso é normalmente determinado pelo domínio do nome do host local.</entry>
	      </row>

	      <row>
		<entry><literal>domain</literal></entry>
		<entry>O nome do domínio local.</entry>
	      </row>
	    </tbody>
	  </tgroup>
	</informaltable>

	<para>Um típico <filename>/etc/resolv.conf</filename> é assim:</para>

	<programlisting>search example.com
nameserver 147.11.1.11
nameserver 147.11.100.30</programlisting>

	<note>
	  <para>Apenas uma das opções <literal>search</literal> e <literal>domain</literal> deve ser usada.</para>
	</note>

	<para>Ao usar o <acronym>DHCP</acronym>, o <citerefentry><refentrytitle>dhclient</refentrytitle><manvolnum>8</manvolnum></citerefentry> geralmente reescreve o <filename>/etc/resolv.conf</filename> com informações recebidas do servidor <acronym>DHCP</acronym>.</para>
      </sect3>

      <sect3>
	<title><filename>/etc/hosts</filename></title>

	<indexterm><primary>hosts</primary></indexterm>

	<para>O <filename>/etc/hosts</filename> é um banco de dados de texto simples que funciona em conjunto com o <acronym>DNS</acronym> e o <acronym>NIS</acronym> para fornecer o nome do host aos mapeamentos de endereços <acronym>IP</acronym>. Entradas para computadores locais conectados através de uma <acronym>LAN</acronym> podem ser adicionadas a este arquivo para propósitos simplistas de nomeação em vez de configurar um servidor <citerefentry><refentrytitle>named</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Além disso, o <filename>/etc/hosts</filename> pode ser usado para fornecer um registro local de nomes da Internet, reduzindo a necessidade de consultar servidores <acronym>DNS</acronym> externos para nomes comumente acessados.</para>

	<programlisting># <phrase its:translate="no">$FreeBSD$</phrase>
#
#
# Host Database
#
# This file should contain the addresses and aliases for local hosts that
# share this file.  Replace 'my.domain' below with the domainname of your
# machine.
#
# In the presence of the domain name service or NIS, this file may
# not be consulted at all; see /etc/nsswitch.conf for the resolution order.
#
#
::1			localhost localhost.my.domain
127.0.0.1		localhost localhost.my.domain
#
# Imaginary network.
#10.0.0.2		myname.my.domain myname
#10.0.0.3		myfriend.my.domain myfriend
#
# According to RFC 1918, you can use the following IP networks for
# private nets which will never be connected to the Internet:
#
#	10.0.0.0	-   10.255.255.255
#	172.16.0.0	-   172.31.255.255
#	192.168.0.0	-   192.168.255.255
#
# In case you want to be able to connect to the Internet, you need
# real official assigned numbers.  Do not try to invent your own network
# numbers but instead get one from your network provider (if any) or
# from your regional registry (ARIN, APNIC, LACNIC, RIPE NCC, or AfriNIC.)
#</programlisting>

	<para>O formato do <filename>/etc/hosts</filename> é o seguinte:</para>

	<programlisting>[Internet address] [official hostname] [alias1] [alias2] ...</programlisting>

	<para>Por exemplo:</para>

	<programlisting>10.0.0.1 myRealHostname.example.com myRealHostname foobar1 foobar2</programlisting>

	<para>Consulte <citerefentry><refentrytitle>hosts</refentrytitle> <manvolnum>5</manvolnum></citerefentry> para obter maiores informações.</para>
      </sect3>
    </sect2>
  </sect1>

  <sect1 xml:id="configtuning-sysctl">
    <title>Efetuando ajustes com o <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

    <indexterm><primary>sysctl</primary></indexterm>
    <indexterm><primary>tuning</primary> <secondary>with sysctl</secondary></indexterm>

    <para>O <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> é usado para fazer mudanças em um sistema FreeBSD em execução. Isso inclui muitas opções avançadas da stack <acronym>TCP/IP</acronym> e do sistema de memória virtual as quais podem melhorar drasticamente o desempenho do FreeBSD para um administrador de sistema experiente. Mais de quinhentas variáveis do sistema podem ser lidas e definidas usando o <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>

    <para>Em sua essência, o <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> serve duas funções: ler e modificar as configurações do sistema.</para>

    <para>Para ver todas as variáveis legíveis:</para>

    <screen><prompt>%</prompt> <userinput>sysctl -a</userinput></screen>

    <para>Para ler uma variável específica, especifique seu nome:</para>

    <screen><prompt>%</prompt> <userinput>sysctl kern.maxproc</userinput>
kern.maxproc: 1044</screen>

    <para>Para definir uma variável específica, use a sintaxe <replaceable>variable</replaceable>=<replaceable>value</replaceable>:</para>

    <screen><prompt>#</prompt> <userinput>sysctl kern.maxfiles=5000</userinput>
kern.maxfiles: 2088 -&gt; 5000</screen>

    <para>As configurações das variáveis sysctl são geralmente strings, números ou booleanos, onde um booleano é <literal>1</literal> para  
sim <literal>0</literal> para não.</para>

    <para>Para definir automaticamente algumas variáveis sempre que a máquina inicializar, adicione-as ao <filename>/etc/sysctl.conf</filename>. Para maiores informações, consulte <citerefentry><refentrytitle>sysctl.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry> e <xref linkend="configtuning-sysctlconf"/>.</para>

    <sect2 xml:id="configtuning-sysctlconf">
      <title><filename>sysctl.conf</filename></title>

      <indexterm><primary>sysctl.conf</primary></indexterm>
      <indexterm><primary>sysctl</primary></indexterm>

      <para>O arquivo de configuração para o <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>, <filename>/etc/sysctl.conf</filename>, se parece muito com o <filename>/etc /rc.conf</filename>. Os valores são definidos na forma  <literal>variable=value</literal>. Os valores especificados são definidos após o sistema entrar no modo multiusuário. Nem todas as variáveis são configuráveis neste modo.</para>

      <para>Por exemplo, para desativar o log de saídas de sinais fatais e impedir que os usuários vejam processos iniciados por outros usuários, os seguintes ajustes podem ser configurados em <filename>/etc/sysctl.conf</filename>:</para>

      <programlisting># Do not log fatal signal exits (e.g., sig 11)
kern.logsigexit=0

# Prevent users from seeing information about processes that
# are being run under another UID.
security.bsd.see_other_uids=0</programlisting>
    </sect2>

    <sect2 xml:id="sysctl-readonly">
      <info>
	<title>Variáveis <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> apenas de leitura</title>

	<authorgroup>
	  <author><personname> <firstname>Tom</firstname> <surname>Rhodes</surname> </personname> <contrib>Contribuído por </contrib></author>
	</authorgroup>
      </info>

      <para>Em alguns casos, pode ser desejável modificar os valores de variáveis do <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> que são somente de leitura, o que exigirá uma reinicialização do sistema.</para>

      <para>Por exemplo, em alguns modelos de laptops, o dispositivo <citerefentry><refentrytitle>cardbus</refentrytitle><manvolnum>4</manvolnum></citerefentry> não examinará os intervalos de memória e falhará com erros semelhantes a:</para>

      <screen>cbb0: Could not map register memory
device_probe_and_attach: cbb0 attach returned 12</screen>

      <para>A correção requer a modificação de uma configuração definida por uma variável do <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> que é somente de leitura. Adicione <option>hw.pci.allow_unsupported_io_range=1</option> ao arquivo <filename>/boot/loader.conf</filename> e reinicie. Agora o <citerefentry><refentrytitle>cardbus</refentrytitle><manvolnum>4</manvolnum></citerefentry> deve funcionar corretamente.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="configtuning-disk">
    <title>Otimização de Discos</title>

    <para>A seção a seguir discutirá vários mecanismos e opções de ajuste que podem ser aplicados a dispositivos de disco. Em muitos casos, discos com partes mecânicas, como unidades <acronym>SCSI</acronym>, serão o gargalo que reduz o desempenho geral do sistema. Embora a solução seja instalar uma unidade sem peças mecânicas, como uma unidade de estado sólido, as unidades mecânicas não irão desaparecer num futuro próximo. Quando estiver otimizando discos, é aconselhável utilizar os recursos do comando <citerefentry><refentrytitle>iostat</refentrytitle><manvolnum>8</manvolnum></citerefentry> para testar várias mudanças no sistema. Este comando permitirá ao usuário obter informações valiosas sobre o sistema <acronym>IO</acronym>.</para>

    <sect2>
      <title>Variáveis Sysctl</title>

      <sect3>
	<title><varname>vfs.vmiodirenable</varname></title>

	<indexterm><primary><varname>vfs.vmiodirenable</varname></primary></indexterm>

	<para>A variável <varname>vfs.vmiodirenable</varname> <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> pode ser definida como <literal>0</literal> (off ) ou <literal>1</literal> (on). Está definida para <literal>1</literal> por padrão. Esta variável controla como os diretórios são armazenados em cache pelo sistema. A maioria dos diretórios é pequena, usando apenas um único fragmento (normalmente 1K) no sistema de arquivos e, normalmente, 512 bytes no cache de buffer. Com esta variável desativada, o cache de buffer armazenará apenas um número fixo de diretórios, mesmo que o sistema tenha uma quantidade enorme de memória. Quando ativado, este <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> permite que o cache de buffer use o cache de página <acronym>VM</acronym> para armazenar em cache os diretórios, disponibilizando toda a memória para fazer cache dos diretórios. No entanto, a memória mínima no núcleo usada para armazenar em cache um diretório é o tamanho da página física (geralmente 4K) em vez de 512 bytes. Manter esta opção ativada é recomendado se o sistema estiver executando quaisquer serviços que manipulem um grande número de arquivos. Esses serviços podem incluir caches da web, grandes sistemas de correio e sistemas de notícias. Manter essa opção geralmente não reduz o desempenho, mesmo com a memória desperdiçada, mas deve-se experimentar para descobrir.</para>
      </sect3>

      <sect3>
	<title><varname>vfs.write_behind</varname></title>

	<indexterm><primary><varname>vfs.write_behind</varname></primary></indexterm>

	<para>A variável <varname>vfs.write_behind</varname> <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> é padronizada para <literal>1</literal> (ligada). Isso informa ao sistema de arquivos para emitir gravações de mídia à medida que clusters completos são coletados, o que normalmente ocorre ao gravar arquivos sequenciais grandes. Isso evita saturar o cache de buffer com buffers sujos quando não beneficia o desempenho de I/O. No entanto, isso pode atrasar os processos e, sob certas circunstâncias, deve ser desativado.</para>
      </sect3>

      <sect3>
	<title><varname>vfs.hirunningspace</varname></title>

	<indexterm><primary><varname>vfs.hirunningspace</varname></primary></indexterm>

	<para>A variável <varname>vfs.hirunningspace</varname> <citerefentry> <refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> determina quanto de I/O de gravação pendente pode ser enfileirado no sistema de controladores de disco como um todo em qualquer instância. O padrão é geralmente suficiente, mas em máquinas com muitos discos, tente aumentar para quatro ou cinco <emphasis>megabytes</emphasis>. Definir um valor muito alto, que exceda o limite de gravação do cache de buffer, pode levar a um mau desempenho de cluster. Não defina esse valor arbitrariamente alto, pois valores de gravação mais altos podem adicionar latência a leituras que ocorrem ao mesmo tempo.</para>

	<para>Há vários outros caches de buffer e valores de cache de página <acronym>VM</acronym> relacionados a <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Modificar esses valores não é recomendado, pois o sistema <acronym>VM</acronym> faz um bom trabalho de ajuste automático.</para>
      </sect3>

      <sect3>
	<title><varname>vm.swap_idle_enabled</varname></title>

	<indexterm><primary><varname>vm.swap_idle_enabled</varname></primary></indexterm>

	<para>A variável <varname>vm.swap_idle_enabled</varname> <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> é útil em grandes sistemas multiusuários com muitos usuários ativos, e muitos processos ociosos. Tais sistemas tendem a gerar pressão contínua nas reservas de memória livre. Ativar esse recurso e aprimorar a histerese de troca (em segundos ociosos) por meio de <varname>vm.swap_idle_threshold1</varname> e <varname>vm.swap_idle_threshold2</varname> reduz a prioridade das páginas de memória associadas aos processos inativos mais rapidamente do que no  algoritmo de pageout normal. Isso dá uma ajuda ao daemon de pageout. Apenas ative essa opção se necessário, porque a compensação é essencialmente fazer o pre-page da memoria mais cedo, o que consome mais swap e largura de banda de disco. Em um sistema pequeno, esta opção terá um efeito determinável, mas em um sistema grande que já está paginando moderadamente, esta opção permite que o sistema <acronym>VM</acronym> instale processos inteiros dentro e fora da memória facilmente.</para>
      </sect3>

      <sect3>
	<title><varname>hw.ata.wc</varname></title>

	<indexterm><primary><varname>hw.ata.wc</varname></primary></indexterm>

	<para>Desativar o cache de gravação <acronym>IDE</acronym> reduz a largura de banda de gravação em discos <acronym>IDE</acronym>, mas às vezes pode ser necessário devido a problemas de consistência de dados introduzidos por fornecedores de disco rígido. O problema é que algumas unidades <acronym>IDE</acronym> mentem sobre quando uma gravação é concluída. Com o cache de gravação <acronym>IDE</acronym> ativado, os discos rígidos <acronym>IDE</acronym> gravam os dados fora de ordem e às vezes atrasam a gravação de alguns blocos indefinidamente quando estão sob carga pesada de disco. Uma falha ou falha de energia pode causar corrupção séria do sistema de arquivos. Verifique o padrão no sistema observando a variável <varname>hw.ata.wc</varname> <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Se o cache de gravação <acronym>IDE</acronym> estiver desativado, pode-se definir essa variável somente leitura como <literal>1</literal> em <filename>/boot/loader.conf</filename> para ativar no momento da inicialização.</para>

	<para>Para maiores informações, consulte <citerefentry><refentrytitle>ata</refentrytitle><manvolnum>4</manvolnum></citerefentry>.</para>
      </sect3>

      <sect3>
	<title><literal>SCSI_DELAY</literal> (<varname>kern.cam.scsi_delay</varname>)</title>

	<indexterm><primary><varname>kern.cam.scsi_delay</varname></primary></indexterm>

	<indexterm><primary>kernel options</primary> <secondary><literal>SCSI DELAY</literal></secondary></indexterm>

	<para>A opção de configuração do kernel <literal>SCSI_DELAY</literal> pode ser usada para reduzir os tempos de inicialização do sistema. Os padrões são razoavelmente altos e podem ser responsáveis por <literal>15</literal> segundos de atraso no processo de inicialização. Reduzindo-o para <literal>5</literal> segundos geralmente funciona com unidades modernas. A variável de tempo de inicialização <varname>kern.cam.scsi_delay</varname> deve ser usada. A opção de configuração ajustável e a configuração do kernel aceitam valores em termos de <emphasis>milissegundos</emphasis> e <emphasis>não</emphasis> <emphasis>segundos</emphasis>.</para>
      </sect3>
    </sect2>

    <sect2 xml:id="soft-updates">
      <title>Soft Updates</title>

      <indexterm><primary>Soft Updates</primary></indexterm>
      <indexterm><primary><citerefentry><refentrytitle>tunefs</refentrytitle><manvolnum>8</manvolnum></citerefentry></primary></indexterm>

      <para>Para ajustar um sistema de arquivos, use <citerefentry><refentrytitle>tunefs</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Este programa tem muitas opções diferentes. Para ativar e desativar o Soft  Updates, use:</para>

      <screen><prompt>#</prompt> <userinput>tunefs -n enable /filesystem</userinput>
<prompt>#</prompt> <userinput>tunefs -n disable /filesystem</userinput></screen>

      <para>Um sistema de arquivos não pode ser modificado com <citerefentry><refentrytitle>tunefs</refentrytitle><manvolnum>8</manvolnum></citerefentry> enquanto estiver montado. Um bom momento para ativar o Soft Updates é antes que qualquer partição tenha sido montada, no modo de single-user.</para>

      <para>O Soft Updates é recomendado para sistemas de arquivos <acronym>UFS</acronym>, pois melhora drasticamente o desempenho de metadados, principalmente a criação e exclusão de arquivos, através do uso de um cache em memória. Há duas desvantagens no Soft Updates que você deve conhecer. Primeiro, o Soft Updates garante a consistência do sistema de arquivos no caso de uma falha, mas pode facilmente levar vários segundos ou até um minuto para atualizar o disco físico. Se o sistema falhar, os dados não gravados poderão ser perdidos. Em segundo lugar, os Soft Updates atrasam a liberação de blocos do sistema de arquivos. Se o sistema de arquivos raiz estiver quase cheio, a execução de uma atualização importante, como <command>make installworld</command>, poderá causar a falta de espaço do sistema de arquivos e a atualização falhará.</para>

      <sect3>
	<title>Mais detalhes sobre soft updates</title>

	<indexterm><primary>Soft Updates</primary> <secondary>details</secondary></indexterm>

	<para>As atualizações de metadados são atualizações para dados que não são de conteúdo, como inodes ou diretórios. Existem duas abordagens tradicionais para gravar os metadados de um sistema de arquivos em disco.</para>

	<para>Historicamente, o comportamento padrão era gravar atualizações de metadados de forma síncrona. Se um diretório fosse alterado, o sistema aguardava até que a alteração fosse gravada no disco. Os buffers de dados do arquivo (conteúdo do arquivo) foram passados pelo cache de buffer e foram copiados para o disco posteriormente de maneira assíncrona. A vantagem dessa implementação é que ela opera com segurança. Se houver uma falha durante uma atualização, os metadados estarão sempre em um estado consistente. Um arquivo é criado completamente ou não é de todo. Se os blocos de dados de um arquivo não encontrarem saída do cache de buffer para o disco no momento da falha, o <citerefentry><refentrytitle>fsck</refentrytitle><manvolnum>8</manvolnum></citerefentry> reconhece isso e repara o sistema de arquivos definindo o comprimento do arquivo como <literal>0</literal>. Além disso, a implementação é clara e simples. A desvantagem é que as alterações nos metadados são lentas. Por exemplo, <command>rm -r</command> toca todos os arquivos em um diretório sequencialmente, mas cada alteração de diretório será gravada de forma síncrona no disco. Isso inclui atualizações para o próprio diretório, para a tabela de inode e possivelmente para blocos indiretos alocados pelo arquivo. Considerações semelhantes aplicam-se ao desenrolar hierarquias grandes usando <command>tar -x</command>.</para>

	<para>A segunda abordagem é usar atualizações de metadados assíncronas. Este é o padrão para um sistema de arquivos <acronym>UFS</acronym> montado com <command>mount -o async</command>. Como todas as atualizações de metadados também são passadas pelo cache de buffer, elas serão mescladas com as atualizações dos dados de conteúdo do arquivo. A vantagem dessa implementação é que não há necessidade de esperar até que cada atualização de metadados seja gravada no disco, portanto, todas as operações que causam grandes quantidades de atualizações de metadados funcionam muito mais rápido do que no caso síncrono. Essa implementação ainda é clara e simples, portanto, há um baixo risco de erros se infiltrarem no código. A desvantagem é que não há garantia para um estado consistente do sistema de arquivos. Se houver uma falha durante uma operação que atualizou grandes quantidades de metadados, como uma falha de energia ou alguém pressionando o botão de reinicialização, o sistema de arquivos será deixado em um estado imprevisível. Não há oportunidade de examinar o estado do sistema de arquivos quando o sistema é reativado, pois os blocos de dados de um arquivo já podem ter sido gravados no disco enquanto as atualizações da tabela de inodes ou do diretório associado não foram. É impossível implementar um <citerefentry><refentrytitle>fsck</refentrytitle><manvolnum>8</manvolnum></citerefentry> que é capaz de limpar o caos resultante porque as informações necessárias não estão disponíveis no disco. Se o sistema de arquivos foi danificado além do reparo, a única opção é reformatá-lo e restaurá-lo a partir do backup.</para>

	<para>A solução usual para este problema é implementar <emphasis>dirty region logging</emphasis>, que também é chamado de <emphasis>journaling</emphasis>. As atualizações de metadados ainda são gravadas de forma síncrona, mas apenas em uma pequena região do disco. Mais tarde, eles são movidos para o local apropriado. Como a área de registro é uma região pequena e contígua no disco, não há longas distâncias para as cabeças de disco se moverem, mesmo durante operações pesadas, portanto, essas operações são mais rápidas do que as atualizações síncronas. Além disso, a complexidade da implementação é limitada, portanto, o risco de erros estarem presentes é baixo. Uma desvantagem é que todos os meta-dados são gravados duas vezes, uma vez na região de registro e uma vez no local apropriado, portanto, pode resultar em <quote>piora</quote> na performance. Por outro lado, em caso de falha, todas as operações de metadados pendentes podem ser rapidamente recuperadas ou concluídas a partir da área de registro depois que o sistema for ativado novamente, resultando em uma inicialização rápida do sistema de arquivos.</para>

	<para>Kirk McKusick, o desenvolvedor do Berkeley <acronym>FFS</acronym>, resolveu esse problema com o Soft Updates. Todas as atualizações de meta-dados pendentes são mantidas na memória e gravadas no disco em uma sequência ordenada (<quote>atualizações de metadados ordenadas</quote>). Isso tem o efeito de que, no caso de operações pesadas de meta-dados, atualizações posteriores em um item <quote>catch</quote> as anteriores que ainda estão na memória e ainda não foram gravadas no disco. Todas as operações são geralmente executadas na memória antes da atualização ser gravada no disco e os blocos de dados são classificados de acordo com sua posição, de modo que não estarão no disco antes de seus meta-dados. Se o sistema travar, um <quote>reenvio de log</quote> implícito faz com que todas as operações que não foram gravadas no disco apareçam como se nunca tivessem acontecido. Um estado consistente do sistema de arquivos é mantido e parece ser o de 30 a 60 segundos antes. O algoritmo usado garante que todos os recursos em uso sejam marcados como tal em seus blocos e inodes. Após uma falha, o único erro de alocação de recursos que ocorre é que os recursos são marcados como <quote>used</quote>, que são, na verdade, <quote>free</quote>. O <citerefentry><refentrytitle>fsck</refentrytitle><manvolnum>8</manvolnum></citerefentry> reconhece essa situação e libera os recursos que não são mais usados. É seguro ignorar o estado sujo do sistema de arquivos após uma falha forçando a montagem com <command>mount -f</command>. Para liberar recursos que podem não ser utilizados, O <citerefentry><refentrytitle>fsck</refentrytitle><manvolnum>8</manvolnum></citerefentry> precisa ser executado posteriormente. Esta é a idéia por trás do <emphasis><citerefentry><refentrytitle>fsck</refentrytitle><manvolnum>8</manvolnum></citerefentry> em background</emphasis>: no momento da inicialização do sistema, apenas um <emphasis>snapshot</emphasis> do sistema de arquivos é gravado e o <citerefentry><refentrytitle>fsck</refentrytitle><manvolnum>8</manvolnum></citerefentry> é executado posteriormente. Todos os sistemas de arquivos podem ser montados <quote>sujos</quote>, para que a inicialização do sistema prossiga no modo multiusuário. Em seguida, o  <citerefentry><refentrytitle>fsck</refentrytitle><manvolnum>8</manvolnum></citerefentry> em background é planejado para todos os sistemas de arquivos em que isso é necessário, para liberar recursos que podem não ser utilizados. Os sistemas de arquivos que não usam Soft Updates ainda precisam executar o <citerefentry><refentrytitle>fsck</refentrytitle><manvolnum>8</manvolnum></citerefentry> em primeiro plano de forma usual .</para>

	<para>A vantagem é que as operações de meta-dados são quase tão rápidas quanto as atualizações assíncronas e são mais rápidas que o <emphasis>logging</emphasis>, que precisa escrever os meta-dados duas vezes. As desvantagens são a complexidade do código, um maior consumo de memória e algumas idiosincrasias. Depois de uma falha, o estado do sistema de arquivos parece ser um pouco mais <quote>velho</quote>. Em situações onde a abordagem síncrona padrão teria causado a existencia de alguns arquivos de comprimento zero após o <citerefentry><refentrytitle>fsck</refentrytitle><manvolnum>8</manvolnum></citerefentry>, esses arquivos sequer chegam a existir com Soft Updates porque nem os metadados e nem o conteúdo do arquivo foram gravados no disco. O espaço em disco não é liberado até que as atualizações tenham sido gravadas no disco, o que pode ocorrer algum tempo depois de executar <citerefentry><refentrytitle>rm</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Isso pode causar problemas ao instalar grandes quantidades de dados em um sistema de arquivos que não tenha espaço livre suficiente para armazenar todos os arquivos duas vezes.</para>
      </sect3>
    </sect2>
  </sect1>

  <sect1 xml:id="configtuning-kernel-limits">
    <title>Ajustando os Limites do Kernel</title>

    <indexterm><primary>tuning</primary> <secondary>kernel limits</secondary></indexterm>

    <sect2 xml:id="file-process-limits">
      <title>Limites de arquivos/processos</title>

      <sect3 xml:id="kern-maxfiles">
	<title><varname>kern.maxfiles</varname></title>

	<indexterm><primary><varname>kern.maxfiles</varname></primary></indexterm>

	<para>A variável <varname>kern.maxfiles</varname> <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> pode ser aumentada ou diminuída com base nos requisitos do sistema. Essa variável indica o número máximo de descritores de arquivos no sistema. Quando a tabela do descritor de arquivos estiver cheia, o erro <errorname>file: table is full</errorname> aparecerá repetidamente no buffer de mensagem do sistema, que pode ser visualizado usando <citerefentry><refentrytitle>dmesg</refentrytitle><manvolnum>8</manvolnum> </citerefentry>.</para>

	<para>Cada arquivo aberto, socket ou fifo usa um descritor de arquivo. Um servidor de produção em larga escala pode facilmente exigir muitos milhares de descritores de arquivos, dependendo do tipo e número de serviços executados simultaneamente.</para>

	<para>Em versões mais antigas do FreeBSD, o valor padrão de <varname>kern.maxfiles</varname> é derivado do <option>maxusers</option> no arquivo de configuração do kernel. O <varname>kern.maxfiles</varname> cresce proporcionalmente ao valor do <option>maxusers</option>. Ao compilar um kernel personalizado, considere configurar esta opção de configuração do kernel de acordo com o uso do sistema. A partir desse número, o kernel recebe a maioria dos seus limites predefinidos. Mesmo que uma máquina de produção não tenha 256 usuários simultâneos, os recursos necessários podem ser semelhantes a um servidor da Web de alta escala.</para>

	<para>A variável read-only <citerefentry> <refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry><varname>kern.maxusers</varname> é dimensionada automaticamente na inicialização com base na quantidade de memória disponível no sistema, e pode ser determinado em tempo de execução, inspecionando o valor de <varname>kern.maxusers</varname>. Alguns sistemas requerem valores maiores ou menores de <varname>kern.maxusers</varname> e valores de <literal>64</literal>, <literal>128</literal>, e <literal>256</literal> não são incomuns. Ir acima de <literal>256</literal> não é recomendado, a menos que seja necessário um grande número de descritores de arquivos. Muitos dos valores ajustáveis definidos para seus padrões por <varname>kern.maxusers</varname> podem ser individualmente sobrescritos no tempo de inicialização ou em tempo de execução no <filename>/boot/loader.conf</filename>. Consulte <citerefentry><refentrytitle>loader.conf</refentrytitle> <manvolnum> 5 </manvolnum> </citerefentry> e <filename>/boot/defaults/loader.conf</filename> para mais detalhes e algumas dicas.</para>

	<para>Em versões mais antigas, o sistema ajustará automaticamente o <literal>maxusers</literal> se ele estiver definido como <literal>0</literal>. <footnote><para>O algoritmo de ajuste automático define o <literal>maxusers</literal> igual à quantidade de memória no sistema, com um mínimo de <literal>32</literal> e um máximo de <literal>384</literal>.</para></footnote>. Ao configurar esta opção, configure o <literal>maxusers</literal> para pelo menos <literal>4</literal>, especialmente se o sistema executar o <application>Xorg</application> ou se for usado para compilar software. A tabela mais importante definida por <literal>maxusers</literal> é o número máximo de processos, que é definido como <literal>20 + 16 * maxusers</literal>. Se <literal>maxusers</literal> for definido como <literal>1</literal>, só podem existir <literal>36</literal> processos simultâneos, incluindo <literal>18</literal> ou mais para que o sistema seja iniciado no boot ou <literal>15</literal> usado pelo <application>Xorg</application>. Até mesmo uma tarefa simples, como ler uma página de manual, iniciará nove processos para filtrar, descompactar e visualizar. Configurar o <literal>maxusers</literal> para <literal>64</literal> permite até <literal>1044</literal> processos simultâneos, o que deve ser suficiente para quase todos os usos. Se, no entanto, o erro <errortype>proc table full</errortype> for exibido ao tentar iniciar outro programa ou se um servidor estiver sendo executado com um grande número de usuários simultâneos, aumente o número e recompile.</para>

	<note>
	  <para>O <literal>maxusers</literal> <emphasis>não</emphasis> limita o número de usuários que podem logar na máquina. Em vez disso, ele configura vários tamanhos de tabela para valores razoáveis, considerando o número máximo de usuários no sistema e quantos processos cada usuário executará.</para>
	</note>
      </sect3>

      <sect3>
	<title><varname>kern.ipc.soacceptqueue</varname></title>

	<indexterm><primary><varname>kern.ipc.soacceptqueue</varname></primary></indexterm>

	<para>A variável <varname>kern.ipc.soacceptqueue</varname> do <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> limita o tamanho da fila de escuta para aceitar novas conexões <literal>TCP</literal>. O valor padrão de <literal>128</literal> é normalmente muito baixo para o manuseio robusto de novas conexões em um servidor Web com carga pesada. Para tais ambientes, recomenda-se aumentar este valor para <literal>1024</literal> ou superior. Um serviço como o <citerefentry><refentrytitle>sendmail</refentrytitle><manvolnum>8</manvolnum></citerefentry>, ou <application>Apache</application> pode limitar por ele mesmo o tamanho da fila de escuta, mas frequentemente terá uma diretiva em seu arquivo de configuração para ajustar o tamanho da fila. Filas de escuta grandes fazem um trabalho melhor evitando ataques de negação de serviço (Denial of Service - <acronym>DoS</acronym>).</para>
      </sect3>
    </sect2>

    <sect2 xml:id="nmbclusters">
      <title>Limites de rede</title>

      <para>A opção de configuração do kernel <literal>NMBCLUSTERS</literal> determina a quantidade de Mbufs de rede disponível para o sistema. Um servidor com muito tráfego e um baixo número de Mbufs prejudicará o desempenho. Cada cluster representa aproximadamente 2K de memória, portanto, um valor de <literal>1024</literal> representa <literal>2</literal> megabytes de memória do kernel reservada para buffers de rede. Um cálculo simples pode ser feito para descobrir quantos são necessários. Um servidor web que suporte um maximo de  <literal>1000</literal> conexões simultâneas onde cada conexão usa um buffer de envio de 16K e recebe 6K, requer aproximadamente 32 MB de buffers de rede para cobrir o servidor web. Uma boa regra é multiplicar por <literal>2</literal>, então 2x32MB / 2KB = 64MB / 2kB = <literal>32768</literal>. Valores entre <literal>4096</literal> e <literal>32768</literal> são recomendados para máquinas com maiores quantidades de memória. Nunca especifique um valor arbitrariamente alto para este parâmetro, pois isso pode levar a uma falha no tempo de inicialização. Para observar o uso do cluster de rede, use a opção <option>-m</option> com o <citerefentry><refentrytitle>netstat</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</para>

      <para>A variável <varname>kern.ipc.nmbclusters</varname> deve ser usada para configurar isso no momento da inicialização. Apenas as versões mais antigas do FreeBSD irão requerer o uso da opção <literal>NMBCLUSTERS</literal> no  <citerefentry><refentrytitle>config</refentrytitle><manvolnum>8</manvolnum></citerefentry> do kernel.</para>

      <para>Para servidores ocupados que fazem uso extensivo da chamada de sistema <citerefentry><refentrytitle>sendfile</refentrytitle><manvolnum>2</manvolnum></citerefentry>, pode ser necessário aumentar o número de buffers <citerefentry><refentrytitle>sendfile</refentrytitle><manvolnum>2</manvolnum></citerefentry> através da opção de configuração do kernel <literal>NSFBUFS</literal> ou definindo seu valor no <filename>/boot/loader.conf</filename> (veja <citerefentry><refentrytitle>loader</refentrytitle><manvolnum>8</manvolnum></citerefentry> para detalhes). Um indicador comum de que esse parâmetro precisa ser ajustado é quando os processos são vistos no estado <literal>sfbufa</literal>. A variável <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> <varname>kern.ipc.nsfbufs</varname> é somente de leitura. Este parâmetro nominalmente escala com o <varname>kern.maxusers</varname>, no entanto, pode ser necessário ajustar de acordo.</para>

      <important>
	<para>Mesmo que um socket tenha sido marcado como non-blocking, chamar o <citerefentry><refentrytitle>sendfile</refentrytitle><manvolnum>2</manvolnum></citerefentry> em um socket non-blocking pode resultar no bloqueio do <citerefentry><refentrytitle>sendfile</refentrytitle><manvolnum>2</manvolnum></citerefentry> até que sejam disponibilizados <literal>struct sf_buf</literal> suficientes.</para>
      </important>

      <sect3>
	<title><varname>net.inet.ip.portrange.*</varname></title>

	<indexterm><primary>net.inet.ip.portrange.*</primary></indexterm>

	<para>As variáveis <varname>net.inet.ip.portrange.*</varname> do <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> controlam os intervalos de números de porta automaticamente ligados a sockets <literal>TCP</literal> e <literal>UDP</literal>. Existem três intervalos: um intervalo baixo, um intervalo padrão e um intervalo alto. A maioria dos programas de rede usam o intervalo padrão que é controlado por <varname>net.inet.ip.portrange.first</varname> e <varname>net.inet.ip.portrange.last</varname>, cujo padrão é <literal>1024</literal> e <literal>5000</literal>, respectivamente. Intervalos de porta ligados são usados para conexões de saída e é possível executar o sistema fora das portas sob certas circunstâncias. Isso ocorre mais comumente ao executar um proxy web com muita carga. O intervalo de portas não é um problema ao executar um servidor que lida principalmente com conexões de entrada, como um servidor Web, ou que tenha um número limitado de conexões de saída, como um mail relay. Para situações em que há falta de portas, é recomendado aumentar modestamente o <varname>net.inet.ip.portrange.last</varname>. Um valor de <literal>10000</literal>, <literal>20000</literal> ou <literal>30000</literal> pode ser razoável. Considere os efeitos do firewall ao alterar o intervalo de portas. Alguns firewalls podem bloquear grandes intervalos de portas, geralmente portas de numeração baixa, e esperam que os sistemas usem intervalos mais altos de portas para conexões de saída. Por esta razão, não é recomendado que o valor de <varname>net.inet.ip.portrange.first</varname> seja diminuído.</para>
      </sect3>

      <sect3>
	<title>Produto de atraso de largura de banda <literal>TCP</literal></title>

	<indexterm><primary><literal>TCP</literal> Bandwidth Delay Product Limiting</primary> <secondary><varname>net.inet.tcp.inflight.enable</varname></secondary></indexterm>

	<para>A limitação do produto de atraso de largura de banda <literal>TCP</literal> pode ser ativada configurando a variável   <varname>net.inet.tcp.inflight.enable</varname> do <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> para <literal>1</literal>. Isso instrui o sistema a tentar calcular o produto de atraso de largura de banda para cada conexão e a  limitar a quantidade de dados na fila para envio à rede para a quantidade necessária para manter o rendimento ideal.</para>

	<para>Esse recurso é útil ao servir dados sobre modems, Gigabit Ethernet, links <literal>WAN</literal> de alta velocidade ou qualquer outro link com um produto de atraso de largura de banda alta, especialmente quando também estiver usando dimensionamento de janela ou quando uma janela de envio grande tiver sido configurado. Ao habilitar essa opção, defina também a variável <varname>net.inet.tcp.inflight.debug</varname> para <literal>0</literal> para desabilitar a depuração. Para uso em produção, definir a variável <varname>net.inet.tcp.inflight.min</varname> para pelo menos <literal>6144</literal> pode ser benéfico. Definir valores mínimos altos pode efetivamente desabilitar a limitação de largura de banda, dependendo do link. O recurso de limitação reduz a quantidade de dados acumulados nas rotas intermediárias e nas filas de pacotes de switchs e reduz a quantidade de dados acumulados na fila de interface do host local. Com menos pacotes enfileirados, as conexões interativas, especialmente os modems lentos, funcionarão com menores <emphasis>Round Trip Times</emphasis>. Esse recurso afeta apenas a transmissão de dados do lado do servidor, como o upload. Não tem efeito na recepção ou download de dados.</para>

	<para>Ajustar o valor da variável <varname>net.inet.tcp.inflight.stab</varname> <emphasis>não</emphasis> é recomendado. Este parâmetro é padronizado para <literal>20</literal>, representando 2 pacotes máximos adicionados ao cálculo da janela de produto de atraso de largura de banda. A janela adicional é necessária para estabilizar o algoritmo e melhorar a capacidade de resposta às mudanças de condições, mas também pode resultar em um <citerefentry><refentrytitle>ping</refentrytitle><manvolnum>8</manvolnum></citerefentry> mais alto em links lentos , embora ainda muito menor do que sem o algoritmo inflight. Nesses casos, tente reduzir esse parâmetro para <literal>15</literal>, <literal>10</literal> ou <literal>5</literal> e reduza a variável <varname>net.inet.tcp.inflight.min</varname> para um valor como <literal>3500</literal> para obter o efeito desejado. A redução desses parâmetros deve ser feita apenas como último recurso.</para>
      </sect3>
    </sect2>

    <sect2>
      <title>Memória virtual</title>

      <sect3>
	<title><varname>kern.maxvnodes</varname></title>

	<para>Um vnode é a representação interna de um arquivo ou diretório. Aumentar o número de vnodes disponíveis para o sistema operacional reduz a I/O do disco. Normalmente, isso é tratado pelo sistema operacional e não precisa ser alterado. Em alguns casos em que o I/O de disco é um gargalo e o sistema está ficando sem vnodes, essa configuração precisa ser aumentada. A quantidade de <acronym>RAM</acronym> inativa e livre precisará ser levada em conta.</para>

	<para>Para ver o número atual de vnodes em uso:</para>

	<screen><prompt>#</prompt> <userinput>sysctl vfs.numvnodes</userinput>
vfs.numvnodes: 91349</screen>

	<para>Para ver o máximo de vnodes:</para>

	<screen><prompt>#</prompt> <userinput>sysctl kern.maxvnodes</userinput>
kern.maxvnodes: 100000</screen>

	<para>Se o uso atual do vnode estiver próximo do máximo, tente aumentar o <varname>kern.maxvnodes</varname> por um valor de <literal>1000</literal>. Fique de olho no número de <varname>vfs.numvnodes</varname>. Se subir até o máximo novamente, o <varname>kern.maxvnodes</varname> precisará ser aumentado ainda mais. Caso contrário, uma mudança no uso da memória como reportado pelo  <citerefentry><refentrytitle>top</refentrytitle><manvolnum>1</manvolnum></citerefentry> deve estar visível e mais memória deve estar ativa.</para>
      </sect3>
    </sect2>
  </sect1>

  <sect1 xml:id="adding-swap-space">
    <title>Adicionando Espaço de Swap</title>

    <para>Às vezes, um sistema requer mais espaço de swap. Esta seção descreve dois métodos para aumentar o espaço de troca: adicionar swap a uma partição existente ou em um novo disco rígido e criar um arquivo de swap em uma partição existente.</para>

    <para>Para obter informações sobre como criptografar o espaço de swap, quais opções existem e por que isso deve ser feito, consulte <xref linkend="swap-encrypting"/>.</para>

    <sect2 xml:id="new-drive-swap">
      <title>Swap em um novo disco rígido ou partição existente</title>

      <para>Adicionar um novo disco rígido para swap resulta em um melhor desempenho do que usando uma partição em uma unidade existente. A configuração de partições e discos rígidos é explicada em <xref linkend="disks-adding"/> enquanto <xref linkend="configtuning-initial"/> discute layouts de partições e considerações sobre o tamanho de partições de swap.</para>

      <para>Use o <command>swapon</command> para adicionar uma partição swap ao sistema. Por exemplo:</para>

      <screen><prompt>#</prompt> <userinput>swapon <replaceable>/dev/ada1s1b</replaceable></userinput></screen>

      <warning>
	<para>É possível usar qualquer partição que não esteja atualmente montada, mesmo que já contenha dados. O uso do <command>swapon</command> em uma partição que contém dados sobrescreverá e destruirá esses dados. Certifique-se de que a partição a ser incluída como swap seja realmente a partição pretendida antes de executar o <command>swapon</command>.</para>
      </warning>

      <para>Para adicionar automaticamente essa partição swap na inicialização, adicione uma entrada ao <filename>/etc/fstab</filename>:</para>

      <programlisting><replaceable>/dev/ada1s1b</replaceable>	none	swap	sw	0	0</programlisting>

      <para>Veja <citerefentry> <refentrytitle>fstab</refentrytitle><manvolnum>5</manvolnum></citerefentry> para uma explicação das entradas do <filename>/etc/fstab</filename>. Maiores informações sobre <command>swapon</command> podem ser encontradas em <citerefentry><refentrytitle>swapon</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
    </sect2>

    <sect2 xml:id="create-swapfile">
      <title>Criando um arquivo de swap</title>

      <para>Esses exemplos criam um arquivo de swap de 512M chamado <filename>/usr/swap0</filename> em vez de usar uma partição.</para>

      <para>O uso de arquivos de swap requer que o módulo necessário pelo <citerefentry><refentrytitle>md</refentrytitle><manvolnum>4</manvolnum></citerefentry> tenha sido embutido no kernel ou tenha sido carregado antes do swap ser ativado. Veja <xref linkend="kernelconfig"/> para informações sobre como compilar um kernel customizado.</para>

      <example xml:id="swapfile-10-and-later">
	<title>Criando um arquivo de swap</title>

	<procedure>
	  <step>
	    <para>Crie o arquivo de swap:</para>

	    <screen><prompt>#</prompt> <userinput>dd if=/dev/zero of=<replaceable>/usr/swap0</replaceable> bs=1m count=<replaceable>512</replaceable></userinput></screen>
	  </step>

	  <step>
	    <para>Defina as permissões adequadas no novo arquivo:</para>

	    <screen><prompt>#</prompt> <userinput>chmod 0600 <replaceable>/usr/swap0</replaceable></userinput></screen>
	  </step>

	  <step>
	    <para>Informe o sistema sobre o arquivo de swap adicionando uma linha ao <filename>/etc/fstab</filename>:</para>

	    <programlisting>md99	none	swap	sw,file=/usr/swap0,late	0	0</programlisting>

	    <para>O dispositivo <filename>md99</filename> do <citerefentry><refentrytitle>md</refentrytitle><manvolnum>4</manvolnum></citerefentry>  é usado, deixando números de dispositivos inferiores disponíveis para uso interativo.</para>
	  </step>

	  <step>
	    <para>O espaço de swap será adicionado na inicialização do sistema. Para adicionar espaço de swap imediatamente, use o <citerefentry><refentrytitle>swapon</refentrytitle><manvolnum>8</manvolnum></citerefentry>:</para>

	    <screen><prompt>#</prompt> <userinput>swapon -aL</userinput></screen>
	  </step>
	</procedure>
      </example>
    </sect2>
  </sect1>

  <sect1 xml:id="acpi-overview">
    <info>
      <title>Gerenciamento de energia e recursos</title>

      <authorgroup>
	<author><personname> <firstname> Hiten </firstname> <surname> Pandya </surname> </personname> <contrib> Escrito por </contrib></author>

	<author><personname> <firstname> Tom </firstname> <surname> Rhodes </surname> </personname></author>
      </authorgroup>
    </info>

    <para>É importante utilizar recursos de hardware de maneira eficiente. O gerenciamento de energia e recursos permite que o sistema operacional monitore os limites do sistema e, possivelmente, forneça um alerta se a temperatura do sistema aumentar inesperadamente. Uma especificação anterior para fornecer gerenciamento de energia foi o recurso Gerenciamento Avançado de Energia (Advanced Power Management - <acronym>APM</acronym>). O <acronym>APM</acronym> controla o uso de energia de um sistema com base em sua atividade. No entanto, era difícil e inflexível para os sistemas operacionais gerenciar o uso de energia e as propriedades térmicas de um sistema. O hardware era gerenciado pelo <acronym>BIOS</acronym> e o usuário tinha configuração e visibilidade limitadas nas configurações de gerenciamento de energia. O <acronym>APM</acronym> <acronym>BIOS</acronym> fornecido é específico da plataforma de hardware. Um driver <acronym>APM</acronym> no sistema operacional intermedia o acesso à interface do software <acronym>APM</acronym>, que permite o gerenciamento dos níveis de energia.</para>

    <para>Existem quatro problemas principais no <acronym>APM</acronym>. Primeiro, o gerenciamento de energia é feito pelo <acronym>BIOS</acronym> específico do fornecedor, separado do sistema operacional. Por exemplo, o usuário pode definir valores de tempo ocioso para um disco rígido no <acronym>APM</acronym> <acronym>BIOS</acronym> para que, quando excedido, o <acronym>BIOS</acronym> diminua o disco rígido sem o consentimento do sistema operacional. Segundo, a lógica do <acronym> APM</acronym> é incorporada no <acronym>BIOS</acronym> e opera fora do escopo do sistema operacional. Isso significa que os usuários só podem corrigir problemas no <acronym>APM</acronym> <acronym>BIOS</acronym>, fazendo o flash de um novo <acronym>ROM</acronym>, que é um procedimento perigoso com potencial para deixar o sistema em um estado irrecuperável se falhar. Terceiro, o <acronym>APM</acronym> é uma tecnologia específica do fornecedor, o que significa que há muita duplicidade de esforços e que os erros encontrados no <acronym>BIOS</acronym> de um fornecedor podem não serem resolvidos em outros. Por fim, o <acronym>APM</acronym> <acronym>BIOS</acronym> não tinha espaço suficiente para implementar uma política de energia sofisticada ou que pudesse se adaptar bem ao propósito da máquina.</para>

    <para>O <acronym>BIOS</acronym> plug and play (<acronym>PNPBIOS</acronym>) não era confiável em muitas situações. O <acronym>PNPBIOS</acronym> é uma tecnologia de 16 bits, portanto, o sistema operacional precisa usar a emulação de 16 bits para fazer interface com os métodos <acronym>PNPBIOS</acronym>. O FreeBSD fornece um driver <acronym>APM</acronym>, pois o <acronym>APM</acronym> ainda deve ser usado para sistemas fabricados antes do ano 2000. O driver está documentado em <citerefentry><refentrytitle>apm</refentrytitle><manvolnum>4</manvolnum></citerefentry>.</para>

    <indexterm><primary>ACPI</primary></indexterm>

    <indexterm><primary>APM</primary></indexterm>

    <para>O sucessor do <acronym>APM</acronym> é a Interface Avançada de Configuração e Energia (Advanced Configuration and Power Interface -
<acronym>ACPI</acronym>). O <acronym>ACPI</acronym> é um padrão escrito por uma aliança de fornecedores para fornecer uma interface para recursos de hardware e gerenciamento de energia. É um elemento-chave na <emphasis>configuração direcionada do sistema operacional e gerenciamento de energia</emphasis>, pois proporciona mais controle e flexibilidade ao sistema operacional.</para>

    <para>Este capítulo demonstra como configurar o <acronym>ACPI</acronym> no FreeBSD. Em seguida, ele oferece algumas dicas sobre como depurar o <acronym>ACPI</acronym> e como enviar um relatório de problemas contendo informações de depuração para que os desenvolvedores possam diagnosticar e corrigir problemas no <acronym>ACPI</acronym>.</para>

    <sect2 xml:id="acpi-config">
      <title>Configurando o <acronym>ACPI</acronym></title>

      <para>No FreeBSD, o driver <citerefentry><refentrytitle>acpi</refentrytitle><manvolnum>4</manvolnum></citerefentry> é carregado por padrão na inicialização do sistema e <emphasis>não</emphasis> deve ser compilado no kernel. Este driver não pode ser descarregado após a inicialização porque o barramento do sistema o utiliza para várias interações de hardware. No entanto, se o sistema estiver com problemas, o <acronym>ACPI</acronym> pode ser desativado completamente ao reinicializar após a configurar <literal>hint.acpi.0.disabled="1"</literal> no <filename>/boot/loader.conf</filename> ou definindo esta variável no prompt do loader, como descrito em <xref linkend="boot-loader"/>.</para>

      <note>
	<para>O <acronym>ACPI</acronym> e o <acronym>APM</acronym> não podem coexistir e devem ser usados separadamente. O último a ser carregado terminará se o driver perceber que o outro já está sendo executado.</para>
      </note>

      <para>O <acronym>ACPI</acronym> pode ser usado para colocar o sistema em modo de suspensão com o <command>acpiconf</command>, a opção <option>-s</option> e um número de <literal>1</literal> a <literal>5</literal>. A maioria dos usuários só precisa de <literal>1</literal> (suspensão rápida para <acronym>RAM</acronym>) ou <literal>3</literal> (suspender para <acronym>RAM</acronym>). A opção <literal>5</literal> executa um soft-off que é o mesmo que executar <command>halt -p</command>.</para>

      <para>Outras opções estão disponíveis usando o <command>sysctl</command>. Consulte <citerefentry><refentrytitle>acpi</refentrytitle><manvolnum>4</manvolnum></citerefentry> e <citerefentry vendor="current"><refentrytitle>acpiconf</refentrytitle><manvolnum>8</manvolnum></citerefentry> para maiores informações.</para>
    </sect2>

    <sect2 xml:id="ACPI-comprob">
      <title>Problemas comuns</title>

      <indexterm><primary><acronym>ACPI</acronym></primary></indexterm>

      <para>O <acronym>ACPI</acronym> está presente em todos os computadores modernos que estão em conformidade com as arquiteturas ia32 (x86) e amd64 (<acronym>AMD</acronym>). O padrão completo tem muitos recursos, incluindo gerenciamento de desempenho da <acronym>CPU</acronym>, controle de planos de energia, zonas térmicas, vários sistemas de bateria, controladores incorporados e enumeração de barramento. A maioria dos sistemas implementa menos que o padrão completo. Por exemplo, um sistema de desktop geralmente só implementa a enumeração de barramento, enquanto um laptop também pode ter suporte a refrigeração e gerenciamento de bateria. Os laptops também têm suspensão e retomada, com sua própria complexidade associada.</para>

      <para>Um sistema compatível com <acronym>ACPI</acronym> possui vários componentes. Os fornecedores de <acronym>BIOS</acronym> e chipset fornecem várias tabelas fixas, como <acronym>FADT</acronym>, na memória que especificam coisas como o mapa <acronym>APIC</acronym> (usado para <acronym>SMP</acronym>), registros de configuração e valores simples de configuração. Além disso, uma tabela de bytecode, a Tabela de Descrição de Sistema Diferenciada <acronym>DSDT</acronym>, especifica um espaço de nome de dispositivos e métodos em forma de árvore.</para>

      <para>O driver <acronym>ACPI</acronym> deve analisar as tabelas fixas, implementar um interpretador para o bytecode e modificar os drivers de dispositivos e o kernel para aceitar informações do subsistema <acronym>ACPI</acronym>. Para o FreeBSD, a <trademark class="registered">Intel</trademark> forneceu um interpretador (<acronym>ACPI-CA</acronym>) que é compartilhado com o  <trademark class="registered">Linux</trademark> e o NetBSD. O caminho para o código-fonte <acronym>ACPI-CA</acronym> é <filename>src/sys/contrib/dev/acpica</filename>. O código especifico que permite que o <acronym>ACPI-CA</acronym> funcione no FreeBSD está em <filename>src/sys/dev/acpica/Osd</filename>. Finalmente, drivers que implementam vários dispositivos <acronym>ACPI</acronym> são encontrados em <filename>src/sys/dev/acpica</filename>.</para>

      <indexterm><primary>ACPI</primary> <secondary>problems</secondary></indexterm>

      <para>Para que o <acronym>ACPI</acronym> funcione corretamente, todas as partes devem funcionar corretamente. Aqui estão alguns problemas comuns, em ordem de freqüência em que ocorrem, e algumas possíveis soluções ou correções. Se uma correção não resolver o problema, consulte <xref linkend="ACPI-submitdebug"/> para obter instruções sobre como enviar um relatório de bug.</para>

      <sect3>
	<title>Problemas do mouse</title>

	<para>Em alguns casos, retomar a partir de uma operação de suspensão fará com que o mouse falhe. Um work around conhecido é adicionar <literal>hint.psm.0.flags="0x3000"</literal> ao <filename>/boot/loader.conf</filename>.</para>
      </sect3>

      <sect3>
	<title>Suspend/Resume</title>

	<para>O <acronym>ACPI</acronym> tem três estados de suspensão para <acronym>RAM</acronym> (<acronym>STR</acronym>), <literal>S1</literal>-<literal>S3</literal>, e um de suspensão de estado para disco (<acronym>STD</acronym>), chamado <literal>S4</literal>. O <acronym>STD</acronym> pode ser implementado de duas maneiras separadas. O <literal>S4</literal><acronym>BIOS</acronym> é uma suspensão para disco auxiliada pelo <acronym>BIOS</acronym>e o <literal>S4</literal><acronym>OS</acronym> é implementado inteiramente pelo sistema operacional. O estado normal em que o sistema se encontra quando conectado, mas não ligado, é <quote>soft off</quote> (<literal>S5</literal>).</para>

	<para>Use o <command>sysctl hw.acpi</command> para verificar os itens relacionados à suspensão. Estes resultados de exemplo são de um Thinkpad:</para>

	<screen>hw.acpi.supported_sleep_state: S3 S4 S5
hw.acpi.s4bios: 0</screen>

	<para>Use o <command>acpiconf -s</command> para testar os estados <literal>S3</literal>, <literal>S4</literal> e <literal>S5</literal>. Um <option>s4bios</option> de um (<literal>1</literal>) indica suporte ao <literal>S4</literal><acronym>BIOS</acronym> em vez do <literal>S4</literal> suportado pelo sistema operacional.</para>

	<para>Ao testar as ações de suspend/resume, inicie com o <literal>S1</literal>, se suportado. É mais provável que esse estado funcione, pois não requer muito suporte ao driver. Ninguém implementou <literal>S2</literal>, que é similar ao <literal>S1</literal>. Em seguida, tente o <literal>S3</literal>. Este é o estado mais profundo do <acronym>STR</acronym> e requer muito suporte ao driver para reinicializar corretamente o hardware.</para>

	<para>Um problema comum com suspend/resume é que muitos drivers de dispositivo não salvam, restauram ou reinicializam seu firmware, registros ou memória do dispositivo adequadamente. Como primeira tentativa de depuração do problema, tente:</para>

	<screen><prompt>#</prompt> <userinput>sysctl debug.bootverbose=1</userinput>
<prompt>#</prompt> <userinput>sysctl debug.acpi.suspend_bounce=1</userinput>
<prompt>#</prompt> <userinput>acpiconf -s 3</userinput></screen>

	<para>Esse teste emula o ciclo de suspend/resume de todos os drivers de dispositivo sem entrar realmente no estado <literal>S3</literal>. Em alguns casos, problemas como perder o estado do firmware, tempo limite do watchdog do dispositivo e tentar novamente para sempre podem ser capturados com esse método. Note que o sistema não entrará realmente no estado <literal>S3</literal>, o que significa que os dispositivos não perderão energia, e muitos funcionarão bem mesmo se os métodos suspend/resume estiverem totalmente ausentes, ao contrário do real  estado <literal>S3</literal>.</para>

	<para>Casos mais difíceis requerem hardware adicional, como uma porta serial e um  cabo para depuração através de um console serial, uma porta Firewire e um cabo para o uso do <citerefentry><refentrytitle>dcons</refentrytitle><manvolnum>4</manvolnum></citerefentry> e habilidades de depuração do kernel.</para>

	<para>Para ajudar a isolar o problema, descarregue o maior número possível de drivers. Se funcionar, diminua o driver que é o problema carregando os drivers até que ele falhe novamente. Normalmente, drivers binários como <filename>nvidia.ko</filename>, drivers de exibição e <acronym>USB</acronym> terão mais problemas, enquanto as interfaces Ethernet normalmente funcionam bem. Se os drivers puderem ser carregados e descarregados adequadamente, automatize isso colocando os comandos apropriados em <filename>/etc/rc.suspend</filename> e <filename>/etc/rc.resume</filename>. Tente configurar o <option>hw.acpi.reset_video</option> para <literal>1</literal> se a tela estiver desarrumada após a retomada. Tente definir valores mais longos ou mais curtos para <option>hw.acpi.sleep_delay</option> para ver se isso ajuda.</para>

	<para>Tente carregar uma distribuição recente do <trademark class="registered">Linux</trademark> para ver se o suspend/resume funciona no mesmo hardware. Se funciona no <trademark class="registered">Linux</trademark>, é provável que seja um problema no driver do FreeBSD. Descobrir qual driver causa o problema ajudará os desenvolvedores a corrigir o problema. Como os mantenedores do <acronym>ACPI</acronym> raramente mantêm outros drivers, como som ou <acronym>ATA</acronym>, qualquer problema de driver também deve ser postado na lista <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current">freebsd-current</link> e enviada para o mantenedor do driver. Os usuários avançados podem incluir os <citerefentry><refentrytitle>printf</refentrytitle><manvolnum>3</manvolnum></citerefentry>s  de debug do driver problemático para rastrear onde, em sua função de reinício, ele é interrompido.</para>

	<para>Por fim, tente desativar o <acronym>ACPI</acronym> e ativar o <acronym>APM</acronym>. Se o comando suspend/resume funcionar com <acronym>APM</acronym>, use o <acronym>APM</acronym>, especialmente em hardware mais antigo (anterior a 2000). Demorou algum tempo para que os fornecedores obtivessem suporte <acronym>ACPI</acronym> correto e os  hardwares antigos são mais prováveis de terem problemas de <acronym>BIOS</acronym> com <acronym>ACPI</acronym>.</para>
      </sect3>

      <sect3>
	<title>Travamentos do sistema</title>

	<para>A maioria dos travamentos do sistema é resultado de interrupções perdidas ou de uma tempestade de interrupções. Chipsets podem ter problemas com base na inicialização, como o <acronym>BIOS</acronym> configura as interrupções antes da correção da tabela <acronym>APIC</acronym> (<acronym>MADT</acronym>) e o roteamento do sistema de controle de interrupções  (<acronym>SCI</acronym>).</para>

	<indexterm><primary>interrupt storms</primary></indexterm>

	<para>Tempestades de interrupção podem ser distinguidas de interrupções perdidas, verificando a saída do <command>vmstat -i</command> e observando a linha que possui <literal>acpi0</literal>. Se o contador está aumentando em mais de um par por segundo, há uma tempestade de interrupção. Se o sistema parece travado, tente acessar o <acronym>DDB</acronym> (<keycombo action="simul"> <keycap>CTRL</keycap><keycap>ALT</keycap><keycap>ESC</keycap></keycombo> no console) e digite <literal>show interrupts</literal>.</para>

	<indexterm><primary>APIC</primary> <secondary>disabling</secondary></indexterm>

	<para>Ao lidar com problemas de interrupção, tente desativar o suporte ao  <acronym>APIC</acronym> com <literal>hint.apic.0.disabled="1"</literal> no <filename>/boot/loader.conf</filename> .</para>
      </sect3>

      <sect3>
	<title>Panics</title>

	<para>Os panics são relativamente raros para <acronym>ACPI</acronym> e são a prioridade máxima a ser corrigida. O primeiro passo é isolar as etapas para reproduzir o panic, se possível, e obter um backtrace. Siga as instruções para habilitar <literal>options DDB</literal> e configurar um console serial em <xref linkend="serialconsole-ddb"/> ou configurar uma partição de despejo. Para obter um backtrace no <acronym>DDB</acronym>, use <literal>tr</literal>. Ao escrever o backtrace, obtenha pelo menos as cinco últimas e as cinco principais linhas do rastro.</para>

	<para>Em seguida, tente isolar o problema inicializando com <acronym>ACPI</acronym> desabilitado. Se isso funcionar, isole o subsistema <acronym>ACPI</acronym> usando vários valores de <option>debug.acpi.disable</option>. Veja <citerefentry><refentrytitle>acpi</refentrytitle><manvolnum>4</manvolnum></citerefentry> para alguns exemplos.</para>
      </sect3>

      <sect3>
	<title>O sistema é ativado após a sua suspensão ou desligamento</title>

	<para>Primeiro, tente definir <literal>hw.acpi.disable_on_poweroff="0"</literal> no <filename>/boot/loader.conf</filename>. Isso impede que a <acronym>ACPI</acronym> desative vários eventos durante o processo de desligamento. Alguns sistemas precisam desse valor definido como <literal>1</literal> (o padrão) pelo mesmo motivo. Isso geralmente corrige o problema de um sistema ser ativado espontaneamente após uma suspensão ou desligamento.</para>
      </sect3>

      <sect3 xml:id="ACPI-aslanddump">
	<title>BIOS contém Bytecode com bugs</title>

	<indexterm><primary><acronym>ACPI</acronym></primary> <secondary><acronym>ASL</acronym></secondary></indexterm>

	<para>Alguns fornecedores de <acronym>BIOS</acronym> fornecem bytecode incorreto ou com bugs. Isso geralmente é manifestado por mensagens do console do kernel como esta:</para>

	<screen>ACPI-1287: *** Error: Method execution failed [\\_SB_.PCI0.LPC0.FIGD._STA] \\
(Node 0xc3f6d160), AE_NOT_FOUND</screen>

	<para>Geralmente, esses problemas podem ser resolvidos com a atualização do <acronym>BIOS</acronym> para a revisão mais recente. A maioria das mensagens do console é inofensiva, mas se houver outros problemas, como o status da bateria não estar funcionando, essas mensagens são um bom lugar para começar a procurar por problemas.</para>
      </sect3>
    </sect2>

    <sect2>
      <title>Substituindo o padrão <acronym>AML</acronym></title>

      <para>O bytecode do <acronym>BIOS</acronym>, conhecido como <acronym>ACPI</acronym> Machine Language (<acronym>AML</acronym>), é compilado de uma linguagem de origem chamada <acronym>ACPI</acronym> Source Language (<acronym>ASL</acronym>). O <acronym>AML</acronym> é encontrado na tabela conhecida como Tabela de Descrição do Sistema Diferenciado (Differentiated System Description Table - <acronym>DSDT</acronym>).</para>
      <indexterm><primary><acronym>ACPI</acronym></primary> <secondary><acronym>ASL</acronym></secondary></indexterm>

      <para>O objetivo do FreeBSD é que todos trabalhem com <acronym>ACPI</acronym> sem qualquer intervenção do usuário. Soluções alternativas ainda estão sendo desenvolvidas para erros comuns feitos pelos fornecedores de <acronym>BIOS</acronym>. O interpretador <trademark class="registered">Microsoft</trademark> (<filename>acpi.sys</filename> e <filename>acpiec.sys</filename>) não verifica rigorosamente a conformidade com o padrão e, portanto, muitos fornecedores de <acronym>BIOS</acronym> que testam apenas <acronym>ACPI</acronym> sob <trademark class="registered">Windows</trademark> nunca corrigem seu <acronym>ASL</acronym>. Os desenvolvedores do FreeBSD continuam a identificar e documentar qual comportamento não padrão é permitido pelo interpretador da <trademark class="registered">Microsoft</trademark> para replicá-lo para que o FreeBSD possa funcionar sem forçar os usuários a corrigir o <acronym>ASL</acronym>.</para>

      <para>Para ajudar a identificar o comportamento de bugs e possivelmente corrigi-lo manualmente, uma cópia pode ser feita do <acronym>ASL</acronym> do sistema. Para copiar o <acronym>ASL</acronym> do sistema para um nome de arquivo especificado, use <command>acpidump</command> com <option>-t</option>, para mostrar o conteúdo das tabelas fixas e <option>-d</option>, para desmontar o <acronym>AML</acronym>:</para>

      <screen><prompt>#</prompt> <userinput>acpidump -td &gt; <replaceable>my.asl</replaceable></userinput></screen>

      <para>Algumas versões de <acronym>AML</acronym> assumem que o usuário está executando o <trademark class="registered">Windows</trademark>. Para sobrescrever isto, defina <literal>hw.acpi.osname=<replaceable>"Windows 2009"</replaceable></literal> no <filename>/boot/loader.conf</filename>, usando a mais recente versão do <trademark class="registered">Windows</trademark> listada no <acronym>ASL</acronym>.</para>

      <para>Outras soluções alternativas podem exigir que o <filename>my.asl</filename> seja personalizado. Se este arquivo for editado, compile o novo <acronym>ASL</acronym> usando o seguinte comando. Os avisos geralmente podem ser ignorados, mas erros são bugs que geralmente impedem que o <acronym>ACPI</acronym> funcione corretamente.</para>

      <screen><prompt>#</prompt> <userinput>iasl -f <replaceable>my.asl</replaceable></userinput></screen>

      <para>Incluir <option>-f</option> força a criação do <acronym>AML</acronym>, mesmo que haja erros durante a compilação. Alguns erros, como a falta de declarações de retorno, são automaticamente contornados pelo interpretador do FreeBSD.</para>

      <para>O nome do arquivo de saída padrão para <command>iasl</command> é <filename>DSDT.aml</filename>. Carregue este arquivo em vez da cópia com bugs do <acronym>BIOS</acronym>, que ainda está presente na memória flash, editando o <filename>/boot/loader.conf</filename> como segue:</para>

      <programlisting>acpi_dsdt_load="YES"
acpi_dsdt_name="/boot/DSDT.aml"</programlisting>

      <para>Certifique-se de copiar o <filename>DSDT.aml</filename> para <filename>/boot</filename> e, em seguida, reinicialize o sistema. Se isso resolver o problema, envie um <citerefentry><refentrytitle>diff</refentrytitle><manvolnum>1</manvolnum></citerefentry> do antigo e novo <acronym>ASL</acronym> para a lista <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi">freebsd-acpi</link> para que os desenvolvedores possam contornar o comportamento de bugs no <filename>acpica</filename>.</para>
    </sect2>

    <sect2 xml:id="ACPI-submitdebug">
      <info>
	<title>Obtendo e enviando informações de depuração</title>

	<authorgroup>
	  <author><personname> <firstname> Nate </firstname> <surname> Lawson </surname> </personname> <contrib> Escrito por </contrib></author>
	</authorgroup>

	<authorgroup>
	  <author><personname> <firstname> Pedro </firstname> <surname> Schultz </surname> </personname> <contrib> com contribuições de </contrib></author>

	  <author><personname> <firstname> Tom </firstname> <surname> Rhodes </surname> </personname></author>
	</authorgroup>
      </info>

      <indexterm><primary>ACPI</primary> <secondary>problems</secondary></indexterm>

      <indexterm><primary>ACPI</primary> <secondary>debugging</secondary></indexterm>

      <para>O driver <acronym>ACPI</acronym> possui um recurso de depuração flexível. Um conjunto de subsistemas e o nível de detalhamento podem ser especificados. Os subsistemas a serem depurados são especificados como camadas e são divididos em componentes (<literal>ACPI_ALL_COMPONENTS</literal>) e suporte de hardware <acronym>ACPI</acronym> (<literal>ACPI_ALL_DRIVERS</literal>). O detalhamento da saída de depuração é especificado como o nível e varia de apenas erros de relatório (<literal>ACPI_LV_ERROR</literal>) para tudo (<literal>ACPI_LV_VERBOSE</literal>). O nível é uma máscara de bits, por isso, várias opções podem ser definidas de uma só vez, separadas por espaços. Na prática, um console serial deve ser usado para registrar a saída para que ela não seja perdida quando o buffer de mensagem do console for liberado. Uma lista completa das camadas e níveis individuais é encontrada em <citerefentry><refentrytitle>acpi</refentrytitle><manvolnum>4</manvolnum></citerefentry>.</para>

      <para>A saída de depuração não está ativada por padrão. Para ativá-la, adicione as opções <literal>ACPI_DEBUG</literal> ao arquivo de configuração do kernel personalizado se <acronym>ACPI</acronym> estiver compilado no kernel. Adicione <literal>ACPI_DEBUG=1</literal> ao <filename>/etc/make.conf</filename> para ativá-lo globalmente. Se um módulo for usado em vez de um kernel personalizado, recompile apenas o módulo <filename>acpi.ko</filename> como segue:</para>

      <screen><prompt>#</prompt> <userinput>cd /sys/modules/acpi/acpi &amp;&amp; make clean &amp;&amp; make ACPI_DEBUG=1</userinput></screen>

      <para>Copie o <filename>acpi.ko</filename> compilado para <filename>/boot/kernel</filename> e adicione o nível e camada desejados ao <filename>/boot/loader.conf</filename>. As entradas neste exemplo permitem mensagens de depuração para todos os componentes e drivers de hardware <acronym>ACPI</acronym> e mensagens de erro de saída no nível menos detalhado:</para>

      <programlisting>debug.acpi.layer="ACPI_ALL_COMPONENTS ACPI_ALL_DRIVERS"
debug.acpi.level="ACPI_LV_ERROR"</programlisting>

      <para>Se as informações necessárias forem acionadas por um evento específico, como suspend e resume, não modifique o <filename>/boot/loader.conf</filename>. Em vez disso, use o <command>sysctl</command> para especificar o layer e o nível após inicializar e preparar o sistema para o evento específico. As variáveis que podem ser definidas usando <command>sysctl</command> são nomeadas da mesma forma que os parâmetros no <filename>/boot/loader.conf</filename>.</para>

      <indexterm><primary>ACPI</primary> <secondary>problems</secondary></indexterm>

      <para>Depois que as informações de depuração forem coletadas, elas podem ser enviadas para a lista <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi">freebsd-acpi</link> para que possam ser usadas pelos mantenedores do FreeBSD <acronym>ACPI</acronym> para identificar a causa raiz do problema e desenvolver uma solução.</para>

      <note>
	<para>Antes de enviar as informações de depuração para esta lista, certifique-se de que a versão mais recente do <acronym>BIOS</acronym> esteja instalada e, se disponível, a versão do firmware do controlador incorporado.</para>
      </note>

      <para>Ao enviar um relatório de problemas, inclua as seguintes informações:</para>

      <itemizedlist>
	<listitem>
	  <para>Descrição do comportamento de bugs, incluindo tipo de sistema, modelo e qualquer coisa que faça com que o erro apareça. Explique com a maior precisão possível quando o bug começou a ocorrer se for novo.</para>
	</listitem>

	<listitem>
	  <para>A saída do <command>dmesg</command> após executar <command>boot -v</command>, incluindo quaisquer mensagens de erro geradas pelo bug.</para>
	</listitem>

	<listitem>
	  <para>A saída <command>dmesg</command> do <command>boot -v</command> com o <acronym>ACPI</acronym> desabilitado, se a desativação do <acronym>ACPI</acronym> ajudar a corrigir o problema.</para>
	</listitem>

	<listitem>
	  <para>Saída do <command>sysctl hw.acpi</command>. Isso lista quais recursos o sistema oferece.</para>
	</listitem>

	<listitem>
	  <para>A <acronym>URL</acronym> para uma versão do <acronym>ASL</acronym> do sistema hospedada na web. <emphasis>Não</emphasis> envie o <acronym>ASL</acronym> diretamente para a lista, pois pode ser muito grande. Gere uma cópia do <acronym>ASL</acronym> executando este comando:</para>

	  <screen><prompt>#</prompt> <userinput>acpidump -dt &gt; <replaceable>name</replaceable>-<replaceable>system</replaceable>.asl</userinput></screen>

	  <para>Substitua o nome de login para <replaceable>name</replaceable> e fabricante/modelo para <replaceable>system</replaceable>. Por exemplo, use <filename>njl-FooCo6000.asl</filename>.</para>
	</listitem>
      </itemizedlist>

      <para>A maioria dos desenvolvedores do FreeBSD assina a lista de discussão <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current">FreeBSD-CURRENT</link>, mas deve-se enviar os problemas para a lista <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi">freebsd-acpi</link> para ter certeza de que ele será visto. Seja paciente ao esperar por uma resposta. Se o bug não for imediatamente aparente, envie um relatório de bug. Ao inserir um <acronym>PR</acronym>, inclua as mesmas informações solicitadas acima. Isso ajuda os desenvolvedores a rastrear o problema e resolvê-lo. Não envie um <acronym>PR</acronym> sem enviar primeiro um e-mail para a lista <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi">freebsd-acpi</link> pois é provável que o problema já tenha sido relatado antes.</para>
    </sect2>

    <sect2 xml:id="ACPI-References">
      <title>Referências</title>

      <para>Mais informações sobre <acronym>ACPI</acronym> podem ser encontradas nos seguintes locais:</para>

      <itemizedlist>
	<listitem>
	  <para>Arquivos da lista de e-mail do FreeBSD <acronym>ACPI</acronym> (<uri xlink:href="https://lists.freebsd.org/pipermail/freebsd-acpi/">https://lists.freebsd.org/pipermail/freebsd-acpi/</uri>)</para>
	</listitem>

	<listitem>
	  <para>A especificação <acronym>ACPI</acronym> 2.0 (<uri xlink:href="http://acpi.info/spec.htm">http://acpi.info/spec.htm</uri>)</para>
	</listitem>

	<listitem>
	  <para><citerefentry><refentrytitle>acpi</refentrytitle><manvolnum>4</manvolnum></citerefentry>, <citerefentry><refentrytitle>acpi_thermal</refentrytitle><manvolnum>4</manvolnum></citerefentry>, <citerefentry><refentrytitle>acpidump</refentrytitle><manvolnum>8</manvolnum></citerefentry>, <citerefentry><refentrytitle>iasl</refentrytitle><manvolnum>8</manvolnum></citerefentry>, e <citerefentry><refentrytitle>acpidb</refentrytitle><manvolnum>8</manvolnum></citerefentry></para>
	</listitem>
      </itemizedlist>
    </sect2>
  </sect1>
</chapter>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->

<chapter version="5.0" xml:id="boot">

  <title>O processo de inicialização do FreeBSD</title>

  <sect1 xml:id="boot-synopsis">
    <title>Sinopse</title>

    <indexterm><primary>booting</primary></indexterm>
    <indexterm><primary>bootstrap</primary></indexterm>

    <para>O processo de iniciar um computador e carregar o sistema operacional é chamado de <quote>processo de bootstrap</quote>, ou de <quote>inicialização</quote>. O processo de boot do FreeBSD fornece uma grande flexibilidade na personalização do que acontece quando o sistema é iniciado, incluindo a capacidade de selecionar diferentes sistemas operacionais instalados no mesmo computador, diferentes versões do mesmo sistema operacional ou um kernel instalado diferente.</para>

    <para>Este capítulo detalha as opções de configuração que podem ser definidas. Ele demonstra como personalizar o processo de inicialização do FreeBSD, incluindo tudo o que acontece até que o kernel do FreeBSD tenha iniciado, procurado por dispositivos e iniciado o <citerefentry><refentrytitle>init</refentrytitle> <manvolnum>8</manvolnum></citerefentry>. Isso ocorre quando a cor do texto das mensagens de inicialização muda de branco brilhante para cinza.</para>

    <para>Depois de ler este capítulo, você reconhecerá:</para>

    <itemizedlist>
      <listitem>
	<para>Os componentes do sistema de boot do FreeBSD e como eles interagem.</para>
      </listitem>

      <listitem>
	<para>As opções que podem ser passadas para os componentes no bootstrap do FreeBSD para controlar o processo de inicialização.</para>
      </listitem>

      <listitem>
	<para>Como configurar uma tela personalizada de inicialização.</para>
      </listitem>

      <listitem>
	<para>O básico da configuração de device hints.</para>
      </listitem>

      <listitem>
	<para>Como inicializar no modo de usuário único e multiusuário e como encerrar corretamente um sistema FreeBSD.</para>
      </listitem>
    </itemizedlist>

    <note>
      <para>Este capítulo descreve apenas o processo de inicialização do FreeBSD rodando em sistemas x86 e amd64.</para>
    </note>
  </sect1>

  <sect1 xml:id="boot-introduction">
    <title>Processo de Inicialização do FreeBSD</title>

    <para>Ligar um computador e iniciar o sistema operacional representa um dilema interessante. Por definição, o computador não sabe como fazer nada até que o sistema operacional seja iniciado. Isso inclui executar programas a partir do disco. Se o computador não pode executar um programa a partir do disco sem o sistema operacional e os programas do sistema operacional estão no disco, como o sistema operacional é iniciado?</para>

    <para>Este problema é semelhante ao do livro <citetitle>As Aventuras do Barão de Munchausen</citetitle>. Um personagem tinha caído no meio de um bueiro, e se retirou agarrando suas botas e levantando. Nos primeiros dias da computação, o termo <firstterm>bootstrap</firstterm> era aplicado ao mecanismo usado para carregar o sistema operacional. Desde então, foi encurtado para <quote>booting</quote>.</para>

    <indexterm><primary><acronym>BIOS</acronym></primary></indexterm>

    <indexterm><primary>Basic Input/Output System</primary><see><acronym>BIOS</acronym></see></indexterm>

    <para>No hardware x86, o Sistema Básico de Entrada/Saída (<acronym>BIOS</acronym>) é responsável por carregar o sistema operacional. O <acronym>BIOS</acronym> procura no disco rígido pelo Master Boot Record (<acronym>MBR</acronym>), que deve estar localizado em um local específico do disco. O <acronym>BIOS</acronym> tem conhecimento suficiente para carregar e executar o <acronym>MBR</acronym>, e assume que o <acronym>MBR</acronym> pode então executar o restante das tarefas envolvidas no carregamento do sistema operacional, possivelmente com a ajuda do <acronym>BIOS</acronym>.</para>

    <note>
      <para>O FreeBSD permite inicializar a partir do padrão mais antigo do <acronym>MBR</acronym> e da nova Tabela de Partição GUID (<acronym>GPT</acronym>). O particionamento <acronym>GPT</acronym> geralmente é encontrado em computadores com a Interface de Firmware Unificada e Extensivel (<acronym>UEFI</acronym>). No entanto, o FreeBSD pode inicializar a partir de partições de <acronym>GPT</acronym> mesmo em máquinas com apenas <acronym>BIOS</acronym> legado com o <citerefentry><refentrytitle>gptboot</refentrytitle><manvolnum> 8</manvolnum></citerefentry>. O trabalho está em andamento para fornecer a inicialização direta a partir do  <acronym>UEFI</acronym>.</para>
    </note>

    <indexterm><primary>Master Boot Record (<acronym>MBR</acronym>)</primary></indexterm>

    <indexterm><primary>Boot Manager</primary></indexterm>

    <indexterm><primary>Boot Loader</primary></indexterm>

    <para>O código dentro do <acronym>MBR</acronym> é normalmente chamado de <emphasis>gerenciador de inicialização</emphasis>, especialmente quando ele interage com o usuário. O gerenciador de inicialização geralmente tem mais código na primeira faixa do disco ou dentro do sistema de arquivos. Exemplos de gerenciadores de inicialização incluem o gerenciador de boot padrão do FreeBSD <application>boot0</application>, também chamado <application>Boot Easy</application>, e o <application>Grub</application>, que é usado por muitas distribuições <trademark class="registered">Linux</trademark>.</para>

    <para>Se apenas um sistema operacional estiver instalado, o <acronym>MBR</acronym> procura pelo primeiro slice inicializável (ativo) no disco e, em seguida, executa o código nesse slice para carregar o restante do sistema operacional. Quando vários sistemas operacionais estão presentes, um gerenciador de inicialização diferente pode ser instalado para exibir uma lista de sistemas operacionais para que o usuário possa selecionar um para inicializar.</para>

    <para>O restante do sistema de boot do FreeBSD é dividido em três estágios. O primeiro estágio sabe apenas o suficiente para colocar o computador em um estado específico e executar o segundo estágio. O segundo estágio pode fazer um pouco mais, antes de executar o terceiro estágio. O terceiro estágio termina a tarefa de carregar o sistema operacional. O trabalho é dividido em três etapas porque o <acronym>MBR</acronym> coloca limites no tamanho dos programas que podem ser executados nos estágios um e dois. Encadear as tarefas juntas permite que o FreeBSD forneça um carregador mais flexível.</para>

    <indexterm><primary>kernel</primary></indexterm>
    <indexterm><primary><citerefentry><refentrytitle>init</refentrytitle><manvolnum>8</manvolnum></citerefentry></primary></indexterm>

    <para>O kernel é então iniciado e começa a sondar os dispositivos e inicializá-los para uso. Quando o processo de inicialização do kernel é finalizado, o kernel passa o controle para o processo de usuário <citerefentry><refentrytitle>init</refentrytitle><manvolnum>8</manvolnum></citerefentry>, que garante que os discos estejam em estado utilizável, inicia a configuração de recursos no nível de usuário que monta sistemas de arquivos, configura placas de rede para se comunicar na rede e inicia os processos que foram configurados para serem executados na inicialização.</para>

    <para>Esta seção descreve esses estágios em mais detalhes e demonstra como interagir com o processo de inicialização do FreeBSD.</para>

    <sect2 xml:id="boot-boot0">
      <title>O gerenciador de inicialização</title>

      <indexterm><primary>Boot Manager</primary></indexterm>

      <indexterm><primary>Master Boot Record (<acronym>MBR</acronym>)</primary></indexterm>

      <para>O código do gerenciador de inicialização no <acronym>MBR</acronym> é às vezes chamado de <emphasis>estágio zero</emphasis> do processo de inicialização. Por padrão, o FreeBSD usa o gerenciador de boot <application>boot0</application>.</para>

      <para>O <acronym>MBR</acronym> instalado pelo instalador do FreeBSD é baseado no  <filename>/boot/boot0</filename>. O tamanho e a capacidade do <application>boot0</application> são restritos a 446 bytes devido à tabela de slices e ao identificador <literal>0x55AA</literal> no final do <acronym>MBR</acronym>. Se o <application>boot0</application> e vários sistemas operacionais estiverem instalados, uma mensagem semelhante a este exemplo será exibida no momento da inicialização:</para>

      <example xml:id="boot-boot0-example">
	<title>Captura de tela do <filename>boot0</filename></title>

	<screen>F1 Win
F2 FreeBSD

Default: F2</screen>
      </example>

      <para>Outros sistemas operacionais sobrescreverão um <acronym>MBR</acronym> existente se forem instalados após o FreeBSD. Se isto acontecer, ou para substituir o <acronym>MBR</acronym> existente com o <acronym>MBR</acronym> do FreeBSD, use o seguinte comando:</para>

      <screen><prompt>#</prompt> <userinput>fdisk -B -b /boot/boot0 <replaceable>device</replaceable></userinput></screen>

      <para>onde <replaceable>device</replaceable> é o disco de inicialização, como <filename>ad0</filename> para o primeiro disco <acronym>IDE</acronym>, <filename>ad2</filename> para o primeiro disco <acronym>IDE</acronym> em um segundo controlador <acronym>IDE</acronym>, ou <filename>da0</filename> para o primeiro disco <acronym>SCSI</acronym>. Para criar uma configuração personalizada do <acronym>MBR</acronym>, consulte <citerefentry><refentrytitle>boot0cfg</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
    </sect2>

    <sect2 xml:id="boot-boot1">
      <title>Estágio Um e Estágio Dois</title>

      <para>Conceitualmente, o primeiro e o segundo estágios fazem parte do mesmo programa na mesma área do disco. Por causa das restrições de espaço, eles foram divididos em dois, mas são sempre instalados juntos. Eles são copiados do combinado <filename>/boot/boot</filename> pelo instalador do FreeBSD ou pelo  <command>bsdlabel</command>.</para>

      <para>Estes dois estágios estão localizados fora do sistema de arquivos, na primeira trilha do slice de inicialização, começando pelo primeiro setor. É ali onde o <application>boot0</application>, ou qualquer outro gerenciador de inicialização, espera encontrar um programa para executar, o qual continuará o processo de inicialização.</para>

      <para>O primeiro estágio, <filename>boot1</filename>, é muito simples, pois pode ter apenas 512 bytes de tamanho. Ele sabe o suficiente sobre o FreeBSD <firstterm>bsdlabel</firstterm>, que armazena informações sobre o slice, para localizar e executar o <filename>boot2</filename>.</para>

      <para>O estágio dois, <filename>boot2</filename>, é um pouco mais sofisticado, e entende o sistema de arquivos do FreeBSD o suficiente para encontrar arquivos. Ele pode fornecer uma interface simples para escolher o kernel ou loader para ser executado. Ele executa o <application>loader</application>, que é muito mais sofisticado e fornece um arquivo de configuração de inicialização. Se o processo de inicialização for interrompido no estágio dois, a seguinte tela interativa será exibida:</para>

      <example xml:id="boot-boot2-example">
	<title>Captura de tela do <filename>boot2</filename></title>

	<screen>&gt;&gt; FreeBSD/i386 BOOT
Default: 0:ad(0,a)/boot/loader
boot:</screen>
      </example>

      <para>Para substituir o <filename>boot1</filename> e <filename>boot2</filename> instalados, use o <command>bsdlabel</command>, onde <replaceable>diskslice</replaceable> é o disco e o slice para inicializar, como <filename>ad0s1</filename> para o primeiro slice no primeiro disco <acronym>IDE</acronym>:</para>

      <screen><prompt>#</prompt> <userinput>bsdlabel -B <replaceable>diskslice</replaceable></userinput></screen>

      <warning>
	<para>Se apenas o nome do disco for usado, como <filename>ad0</filename>, o <command>bsdlabel</command> criará o disco no <quote>modo perigosamente dedicado</quote>, sem slices. Esta provavelmente não é a ação desejada, então verifique novamente o <replaceable>diskslice</replaceable> antes de pressionar <keycap>Return</keycap>.</para>
      </warning>
    </sect2>

    <sect2 xml:id="boot-loader">
      <title>Estágio três</title>

      <indexterm><primary>boot-loader</primary></indexterm>

      <para>O <application>loader</application> é o estágio final do processo de bootstrap de três estágios. Ele está localizado no sistema de arquivos, geralmente como <filename>/boot/loader</filename>.</para>

      <para>O <application>loader</application> é projetado como um método interativo para configuração, usando um conjunto de comandos embutidos, auxiliado por um interpretador mais poderoso que possui um conjunto de comandos mais complexo.</para>

      <para>Durante a inicialização, o <application>loader</application> procurará por um console e por discos, e descobrirá de qual disco está sendo inicializado. Ele irá definir as variáveis de acordo, e um interpretador é iniciado onde os comandos do usuário podem ser passados a partir de um script ou usados interativamente.</para>

      <indexterm><primary>loader</primary></indexterm>
      <indexterm><primary>loader configuration</primary></indexterm>

      <para>O <application>loader</application> então lerá o <filename>/boot/loader.rc</filename>, que por padrão lê o <filename>/boot/defaults/loader.conf</filename> que define padrões razoáveis para variáveis e lê o <filename>/boot/loader.conf</filename> para mudanças locais nessas variáveis. O <filename>loader.rc</filename> então age sobre essas variáveis, carregando os módulos e o kernel selecionados.</para>

      <para>Finalmente, por padrão, o <application>loader</application> realiza uma espera de 10 segundos por pressionamentos de teclas, e inicializa o kernel se não for interrompido. Se interrompido, o usuário é apresentado a um prompt que compreende o conjunto de comandos, no qual o usuário pode ajustar variáveis, descarregar todos os módulos, carregar módulos e finalmente inicializar ou reinicializar. <xref linkend="boot-loader-commands"/> lista os comandos do <application>loader</application> mais usados. Para uma discussão completa de todos os comandos disponíveis, consulte <citerefentry><refentrytitle>loader</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>

      <table xml:id="boot-loader-commands" frame="none" pgwide="1">
	<title>Comandos Internos do Loader</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Variável</entry>
	      <entry>Descrição</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry>autoboot <replaceable>segundos</replaceable></entry>
	      <entry>Prossegue para inicializar o kernel se não for interrompido dentro do intervalo de tempo dado, em segundos. Ele exibe uma contagem regressiva e o intervalo de tempo padrão é de 10 segundos.</entry>
	    </row>

	    <row>
	      <entry>boot <optional><replaceable>-options</replaceable></optional> <optional><replaceable>kernelname</replaceable></optional></entry>
	      <entry>Imediatamente prossegue a inicialização do kernel, com qualquer opção especificada ou nome do kernel. Fornecer um nome de kernel na linha de comando só é aplicável depois que um <command>unload</command> foi emitido. Caso contrário, o kernel previamente carregado será usado. Se o <emphasis>nomedokernel</emphasis> não estiver qualificado, ele será pesquisado em <emphasis>/boot/kernel</emphasis> e <emphasis>/boot/modules</emphasis>.</entry>
	    </row>

	    <row>
	      <entry>boot-conf</entry>
	      <entry>Passa pela mesma configuração automática de módulos baseada em variáveis especificadas, mais comumente <envar>kernel</envar>. Isso só faz sentido se <command>unload</command> for usado primeiro, antes de alterar algumas variáveis.</entry>
	    </row>

	    <row>
	      <entry>help <optional><replaceable>tópico</replaceable></optional></entry>
	      <entry>Mostra mensagens de ajuda lidas de <filename>/boot/loader.help</filename>. Se o tópico fornecido for <literal>index</literal>, a lista de tópicos disponíveis será exibida.</entry>
	    </row>

	    <row>
	      <entry>include <replaceable>nomedoarquivo</replaceable>…</entry>
	      <entry>Lê o arquivo especificado e interpreta-o linha por linha. Um erro interrompe imediatamente o <command>include</command>.</entry>
	    </row>

	    <row>
	      <entry>load <optional>-t <replaceable>type</replaceable></optional> <replaceable>filename</replaceable></entry>
	      <entry>Carrega o kernel, módulo do kernel ou arquivo do tipo especificado, com o nome de arquivo especificado. Quaisquer argumentos após o <replaceable>nomedoarquivo</replaceable> são passados para o arquivo. Se <emphasis>nomedoarquivo</emphasis> não estiver qualificado, ele será pesquisado em <emphasis>/boot/kernel</emphasis> e <emphasis>/boot/modules</emphasis>.</entry>
	    </row>

	    <row>
	      <entry>ls <optional>-l</optional> <optional><replaceable>path</replaceable></optional></entry>
	      <entry>Exibe uma listagem de arquivos do caminho fornecido ou do diretório raiz, se o caminho não for especificado. Se <option>-l</option> for especificado, os tamanhos dos arquivos também serão mostrados.</entry>
	    </row>

	    <row>
	      <entry>lsdev <optional>-v</optional></entry>
	      <entry>Lista todos os dispositivos dos quais é possível carregar módulos. Se <option>-v</option> for especificado, mais detalhes serão impressos.</entry>
	    </row>

	    <row>
	      <entry>lsmod <optional>-v</optional></entry>
	      <entry>Exibe os módulos carregados. Se <option>-v</option> for especificado, mais detalhes serão mostrados.</entry>
	    </row>

	    <row>
	      <entry>more <replaceable>nomedoarquivo</replaceable></entry>
	      <entry>Exibe os arquivos especificados, com uma pausa em cada <varname>LINES</varname> exibidas.</entry>
	    </row>

	    <row>
	      <entry>reboot</entry>
	      <entry>Reinicia imediatamente o sistema.</entry>
	    </row>

	    <row>
	      <entry>set <replaceable>variable</replaceable>, set <replaceable>variable</replaceable>=<replaceable>value</replaceable></entry>
	      <entry>Define as variáveis de ambiente especificadas.</entry>
	    </row>

	    <row>
	      <entry>unload</entry>
	      <entry>Remove todos os módulos carregados.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Aqui estão alguns exemplos práticos de uso do loader. Para inicializar o kernel usual no modo single-user <indexterm><primary>single-user
	  mode</primary></indexterm>:</para>

      <screen><userinput>boot -s</userinput></screen>

      <para>Para descarregar o kernel e os módulos usuais e, em seguida, carregar o kernel anterior ou outro especificado:</para>

      <screen xml:lang="en"><userinput>unload</userinput>
<userinput>load <replaceable>/path/to/kernelfile</replaceable></userinput></screen>

      <para xml:lang="en">Use the qualified
	<filename>/boot/GENERIC/kernel</filename> to refer to
	the default kernel that comes with an installation, or
	<filename>/boot/kernel.old/kernel</filename>, to refer to the
	previously installed kernel before a system upgrade or before
	configuring a custom kernel.</para>

      <para xml:lang="en">Use the following to load the usual modules with another
	kernel.  Note that in this case it is not necessary the
	qualified name:</para>

      <screen xml:lang="en"><userinput>unload</userinput>
<userinput>set kernel="<replaceable>mykernel</replaceable>"</userinput>
<userinput>boot-conf</userinput></screen>

      <para>Para carregar um script de configuração do kernel automatizado:</para>

      <screen><userinput>load -t userconfig_script <replaceable>/boot/kernel.conf</replaceable></userinput></screen>

      <indexterm><primary>kernel</primary> <secondary>boot interaction</secondary></indexterm>
    </sect2>

    <sect2 xml:id="boot-init">
      <title>Último estágio</title>

      <indexterm><primary><citerefentry><refentrytitle>init</refentrytitle><manvolnum>8</manvolnum></citerefentry></primary></indexterm>

      <para>Quando o kernel é carregado pelo <application>loader</application> ou pelo <application>boot2</application>, que ignora o <application>loader</application>, ele examina qualquer flag de inicialização e ajusta seu comportamento conforme necessário. <xref linkend="boot-kernel"/> lista os flags de inicialização comumente usados. Consulte <citerefentry><refentrytitle>boot</refentrytitle><manvolnum>8</manvolnum> </citerefentry> para obter mais informações sobre os outros sinalizadores de inicialização.</para>

      <indexterm><primary>kernel</primary> <secondary>bootflags</secondary></indexterm>

      <table xml:id="boot-kernel" frame="none" pgwide="1">
	<title>Interação do Kernel durante o Boot</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Opção</entry>
	      <entry>Descrição</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><option>-a</option></entry>
	      <entry>Durante a inicialização do kernel, solicita que o dispositivo seja montado como o sistema de arquivos raiz.</entry>
	    </row>

	    <row>
	      <entry><option>-C</option></entry>
	      <entry>Inicialize o sistema de arquivos raiz a partir de um <acronym>CDROM</acronym>.</entry>
	    </row>

	    <row>
	      <entry><option>-s</option></entry>
	      <entry>Inicialize no modo single-user.</entry>
	    </row>

	    <row>
	      <entry><option>-v</option></entry>
	      <entry>Seja mais detalhado durante a inicialização do kernel.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Uma vez que o kernel terminou a inicialização, ele passa o controle para o processo de usuário <citerefentry><refentrytitle>init</refentrytitle><manvolnum>8</manvolnum></citerefentry>, localizado em <filename>/sbin/init</filename>, ou o caminho do programa especificado na variável <envar>init_path</envar> no <command>loader</command>. Este é o último estágio do processo de inicialização.</para>

      <para>A sequência de inicialização garante que os sistemas de arquivos disponíveis no sistema estejam consistentes. Se um sistema de arquivos <acronym>UFS</acronym> não estiver e o <command>fsck</command> não puder corrigir as inconsistências, o <application>init</application> jogará o sistema no modo single-user para que o administrador do sistema possa resolver o problema diretamente. Caso contrário, o sistema é inicializado no modo multi-user.</para>

      <sect3 xml:id="boot-singleuser">
	<title>Modo Single-User</title>

	<indexterm><primary>single-user mode</primary></indexterm>
	<indexterm><primary>console</primary></indexterm>

	<para>Um usuário pode especificar este modo inicializando com <option>-s</option> ou definindo a variável <envar>boot_single</envar> no <application>loader</application>. Ele também pode ser alcançado executando o <command>shutdown now</command> do modo multi-user. O modo single-user começa com esta mensagem:</para>

	<programlisting>Enter full pathname of shell or RETURN for /bin/sh:</programlisting>

	<para>Se o usuário pressionar <keycap>Enter</keycap>, o sistema entrará no Bourne shell padrão. Para especificar um shell diferente, insira o caminho completo para o shell.</para>

	<para>O modo single-user é geralmente usado para reparar um sistema que não inicializa devido a um sistema de arquivos inconsistente ou a um erro em um arquivo de configuração de inicialização. Ele também pode ser usado para redefinir a senha do <systemitem class="username">root</systemitem> quando ela é desconhecida. Essas ações são possíveis porque o prompt do modo single-user fornece acesso local completo ao sistema e seus arquivos de configuração. Não há rede neste modo.</para>

	<para>Embora o modo single-user seja útil para reparar um sistema, ele representa um risco de segurança, a menos que o sistema esteja em um local fisicamente seguro. Por padrão, qualquer usuário que possa obter acesso físico a um sistema terá controle total desse sistema após a inicialização no modo single-user.</para>

	<para>Se o <literal>console</literal> do sistema for alterado para <literal>insecure</literal> em <filename>/etc/ttys</filename>, o sistema solicitará primeiro a senha do <systemitem class="username">root</systemitem> antes de iniciar o modo single-user. Isso adiciona uma medida de segurança ao remover a capacidade de redefinir a senha do <systemitem class="username">root</systemitem> quando ela é desconhecida.</para>

	<example xml:id="boot-insecure-console">
	  <title>Configurando um Console Inseguro em <filename>/etc/ttys</filename></title>

	  <programlisting># name  getty                           type    status          comments
#
# If console is marked "insecure", then init will ask for the root password
# when going to single-user mode.
console none                            unknown off <replaceable>insecure</replaceable></programlisting>
	</example>

	<para>Um console <literal>inseguro</literal> significa que a segurança física para o console é considerada insegura, portanto, apenas alguém que conheça a senha do <systemitem class="username">root</systemitem> pode usar o modo single-user.</para>
      </sect3>

      <sect3 xml:id="boot-multiuser">
	<title>Modo Multi-User</title>

	<indexterm><primary>multi-user mode</primary></indexterm>

	<para>Se o <application>init</application> encontrar os sistemas de arquivos em ordem, ou quando o usuário tiver concluído seus comandos no modo de usuário único e tiver digitado <command>exit</command> para deixar o modo single-user, o sistema entra no modo multi-user, no qual inicia a configuração de recursos do sistema.</para>

	<indexterm><primary>rc files</primary></indexterm>

	<para>O sistema de configuração de recursos lê os padrões de configuração do <filename>/etc/defaults/rc.conf</filename> e detalhes específicos do sistema a partir do <filename>/etc/rc.conf</filename>. Em seguida, ele monta os sistemas de arquivos do sistema listados em <filename>/etc/fstab</filename>. Ele inicia serviços de rede, daemons diversos do sistema e, em seguida, os scripts de inicialização dos pacotes instalados localmente.</para>

	<para>Para saber mais sobre o sistema de configuração de recursos, consulte <citerefentry><refentrytitle>rc</refentrytitle><manvolnum>8</manvolnum> </citerefentry> e examine os scripts localizados em <filename>/etc/rc.d</filename>.</para>
      </sect3>
    </sect2>
  </sect1>
  <!--
  <sect2 id="boot-kernel-userconfig">
      <title>UserConfig: the Boot-time Kernel Configurator</title>

      <para> </para>
  </sect2> -->

  <sect1 xml:id="boot-splash">
    <info>
      <title>Configurando telas iniciais de inicialização</title>

      <authorgroup>
	<author><personname> <firstname>Joseph J.</firstname> <surname>Barbish</surname> </personname> <contrib>Contribuído por </contrib></author>
      </authorgroup>
    </info>

    <para>Normalmente, quando um sistema FreeBSD inicializa, ele exibe seu progresso com uma série de mensagens no console. Uma tela inicial de inicialização cria uma tela de inicialização alternativa que oculta todo o probe de inicialização e as mensagens de inicialização de serviços. Algumas mensagens do boot loader, incluindo o menu de opções de inicialização e um prompt de contagem regressiva de espera, são exibidas no momento da inicialização, mesmo quando a tela inicial está ativada. A exibição da tela inicial pode ser desativada pressionando qualquer tecla do teclado durante o processo de inicialização.</para>

    <para>Existem dois ambientes básicos disponíveis no FreeBSD. O primeiro é o ambiente padrão de linha de comando do console virtual legado. Depois que o sistema conclui a inicialização, é exibido um prompt de login do console. O segundo ambiente é um ambiente gráfico configurado. Consulte <xref linkend="x11"/> para obter maiores informações sobre como instalar e configurar um gerenciador gráfico de tela e um gerenciador gráfico de login.</para>

    <para>Depois que o sistema inicializa, a tela inicial é definida como proteção de tela. Após um período sem uso, a tela inicial será exibida e passará por etapas de mudança de intensidade da imagem, de brilhante a muito escuro e vice-versa. A configuração do protetor de tela inicial pode ser sobrescrita, adicionando-se uma linha <literal>saver=</literal> ao <filename>/etc/rc.conf</filename>. Vários protetores de tela embutidos estão disponíveis e descritos em <citerefentry><refentrytitle>splash</refentrytitle><manvolnum>4</manvolnum></citerefentry>. A opção <literal>saver=</literal> aplica-se apenas aos consoles virtuais e não tem efeito nos gerenciadores gráficos de telas.</para>

    <para>Ao instalar o pacote ou port <package>sysutils/bsd-splash-changer</package>, uma imagem inicial aleatória de uma coleção será exibida na inicialização. A função tela inicial suporta 256 cores nos formatos bitmap (<filename>.bmp</filename>), ZSoft <acronym>PCX</acronym> (<filename>.pcx</filename>), ou TheDraw (<filename>.bin</filename>). A imagem <filename>.bmp</filename>, <filename>.pcx</filename>, ou <filename>.bin</filename> tem que ser colocada na partição root, em <filename>/boot</filename> por exemplo. Os arquivos de imagens iniciais tem que ter a resolução de 320 por 200 pixels ou menos para funcionarem em adaptadores <acronym>VGA</acronym> padrão. Para a tela inicial padrão de 256 cores e 320 por 200 pixels ou menos, adicione as seguintes linhas ao <filename>/boot/loader.conf</filename>. Substitua <replaceable>splash.bmp</replaceable> com o nome do arquivo bitmap a ser utilizado:</para>

    <programlisting>splash_bmp_load="YES"
bitmap_load="YES"
bitmap_name="/boot/<replaceable>splash.bmp</replaceable>"</programlisting>

    <para>Para usar um arquivo <acronym>PCX</acronym> em vez de um arquivo bitmap:</para>

    <programlisting>splash_pcx_load="YES"
bitmap_load="YES"
bitmap_name="/boot/<replaceable>splash.pcx</replaceable>"</programlisting>

    <para>Em vez disso, use ASCII art no formato <link xlink:href="https://en.wikipedia.org/wiki/TheDraw">https://en.wikipedia.org/wiki/TheDraw</link>:</para>

    <programlisting>splash_txt="YES"
bitmap_load="YES"
bitmap_name="/boot/<replaceable>splash.bin</replaceable>"</programlisting>

    <para>Outras opções interessantes do arquivo <filename>loader.conf</filename> incluem:</para>

    <variablelist>
      <varlistentry><term><literal>beastie_disable="YES"</literal></term>

	<listitem>
	  <para>Isso impedirá que o menu de opções de inicialização seja exibido, mas o prompt de contagem regressiva da espera programada ainda estará presente. Mesmo com a exibição do menu de opções de inicialização desabilitada, entrar com uma seleção de opção no prompt de contagem decrescente de tempo programado ativará a opção de inicialização correspondente.</para>
	</listitem>
      </varlistentry>

      <varlistentry><term><literal>loader_logo="beastie"</literal></term>

	<listitem>
	  <para>Isso substituirá as palavras padrão <quote>FreeBSD</quote>, que são exibidas à direita do menu de opções de inicialização, com o logotipo colorido do beastie.</para>
	</listitem>
      </varlistentry>
    </variablelist>

    <para>Para maiores informações, consulte <citerefentry><refentrytitle>splash</refentrytitle><manvolnum>4</manvolnum></citerefentry>, <citerefentry><refentrytitle>loader.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>, and <citerefentry><refentrytitle>vga</refentrytitle><manvolnum>4</manvolnum></citerefentry>.</para>
  </sect1>

  <sect1 xml:id="device-hints">
    <info>
      <title>Sugestões de dispositivos</title>

      <authorgroup>
	<author><personname> <firstname>Tom</firstname> <surname>Rhodes</surname> </personname> <contrib>Contribuído por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>device.hints</primary></indexterm>

    <para>Durante o começo da inicialização do sistema, o boot <citerefentry><refentrytitle>loader</refentrytitle><manvolnum>8</manvolnum></citerefentry> lê o <citerefentry vendor="current"><refentrytitle>device.hints</refentrytitle><manvolnum>5</manvolnum></citerefentry>. Este arquivo armazena informações de inicialização do kernel conhecidas como variáveis, algumas vezes referenciadas como <quote>sugestão de devices</quote>. Estas <quote>sugestões de devices</quote> são usados pelos drivers de dispositivo para configuração do dispositivo.</para>

    <para>As sugestões de dispositivos também são especificadas no  estágio 3 do prompt do boot loader, conforme demonstrado em <xref linkend="boot-loader"/>. As variáveis podem ser adicionadas usando <command>set</command>, removidas com <command>unset</command> e visualizadas <command>show</command>. Variáveis configuradas no arquivo <filename>/boot/device.hints</filename> também podem ser sobrescritas. As sugestões de dispositivos inseridas no boot loader não são permanentes e não serão aplicadas na próxima reinicialização.</para>

    <para>Uma vez que o sistema é inicializado, <citerefentry><refentrytitle>kenv</refentrytitle><manvolnum>1</manvolnum></citerefentry> pode ser usado para despejar todas as variáveis.</para>

    <para>A sintaxe para o arquivo <filename>/boot/device.hints</filename> é uma variável por linha, usando o hash <quote>#</quote> como marcadores de comentário. As linhas são construídas da seguinte forma:</para>

    <screen><userinput>hint.driver.unit.keyword="<replaceable>value</replaceable>"</userinput></screen>

    <para>A sintaxe para o estágio 3 do boot loader é:</para>

    <screen><userinput>set hint.driver.unit.keyword=<replaceable>value</replaceable></userinput></screen>

    <para>onde <literal>driver</literal> é o nome do driver de dispositivo, <literal>unit</literal> é o número da unidade de driver do dispositivo, e <literal>keyword</literal> é a palavra-chave sugerida. A palavra-chave pode consistir das seguintes opções:</para>

    <itemizedlist>
      <listitem>
	<para><literal>at</literal>: especifica o barramento ao qual o dispositivo está conectado.</para>
      </listitem>

      <listitem>
	<para><literal>port</literal>: especifica o endereço inicial de <acronym>I/O</acronym> a ser usado.</para>
      </listitem>

      <listitem>
	<para><literal>irq</literal>: especifica o número da requisição de interrupção a ser usada.</para>
      </listitem>

      <listitem>
	<para><literal>drq</literal>: especifica o número do canal DMA.</para>
      </listitem>

      <listitem>
	<para><literal>maddr</literal>: especifica o endereço de memória física ocupado pelo dispositivo.</para>
      </listitem>

      <listitem>
	<para><literal>flags</literal>: define vários bits de flags para o dispositivo.</para>
      </listitem>

      <listitem>
	<para><literal>disabled</literal>: se definido como <literal>1</literal>, o dispositivo é desativado.</para>
      </listitem>
    </itemizedlist>

    <para>Como os drivers de dispositivo podem aceitar ou exigir mais sugestões não listadas aqui, é recomendável exibir uma página de manual do driver. Para obter mais informações, consulte  <citerefentry vendor="current"><refentrytitle>device.hints</refentrytitle><manvolnum>5</manvolnum></citerefentry>, <citerefentry><refentrytitle>kenv</refentrytitle><manvolnum>1</manvolnum></citerefentry>, <citerefentry><refentrytitle>loader.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>, e <citerefentry><refentrytitle>loader</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
  </sect1>

  <sect1 xml:id="boot-shutdown">
    <title>Sequência de Desligamento</title>

    <indexterm><primary><citerefentry><refentrytitle>shutdown</refentrytitle><manvolnum>8</manvolnum></citerefentry></primary></indexterm>

    <para>Após desligamento controlado usando <citerefentry><refentrytitle>shutdown</refentrytitle><manvolnum>8</manvolnum></citerefentry>, o <citerefentry><refentrytitle>init</refentrytitle><manvolnum>8</manvolnum></citerefentry> tentará executar o script <filename>/etc/rc.shutdown</filename> e, em seguida, enviará a todos os processos o sinal <literal>TERM</literal> e, subsequentemente, o sinal  <literal>KILL</literal> para qualquer um que não termine em tempo hábil.</para>

    <para>Para desligar uma máquina FreeBSD em arquiteturas e sistemas que suportam gerenciamento de energia, use o <command>shutdown -p now</command> para desligar a energia imediatamente. Para reinicializar um sistema FreeBSD, use o <command>shutdown -r now</command>. É preciso ser <systemitem class="username">root</systemitem> ou um membro de <systemitem class="groupname">operator</systemitem> para executar <citerefentry><refentrytitle>shutdown</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Também é possível usar <citerefentry><refentrytitle>halt</refentrytitle><manvolnum>8</manvolnum></citerefentry> e <citerefentry><refentrytitle>reboot</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Consulte as páginas de manual e o <citerefentry><refentrytitle>shutdown</refentrytitle><manvolnum>8</manvolnum> </citerefentry> para obter mais informações.</para>

    <para>Modifique a associação ao grupo referindo-se a <xref linkend="users-synopsis"/>.</para>

    <note>
      <para>O gerenciamento de energia requer que o <citerefentry><refentrytitle>acpi</refentrytitle><manvolnum>4</manvolnum></citerefentry> seja carregado como um módulo ou estaticamente compilado em um kernel personalizado.</para>
    </note>
  </sect1>
</chapter>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<chapter version="5.0" xml:id="security">

  <info>
    <title>Segurança</title>

    <authorgroup>
      <author><personname> <firstname>Tom</firstname> <surname>Rhodes</surname> </personname> <contrib>Reescrito por </contrib></author>
    </authorgroup>
  </info>

  <indexterm><primary>Segurança</primary></indexterm>

  <sect1 xml:id="security-synopsis">
    <title>Sinopse</title>

    <para>A segurança, seja física ou virtual, é um tópico tão amplo que todo um setor evoluiu em torno dele. Centenas de práticas padrão foram criadas sobre como proteger sistemas e redes e, como usuário do FreeBSD, é essencial entender como se proteger contra ataques e intrusos.</para>

    <para>Neste capítulo, vários fundamentos e técnicas serão discutidos. O sistema FreeBSD vem com múltiplas camadas de segurança, e muitos outros utilitários de terceiros podem ser adicionados para aumentar a segurança.</para>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>Conceitos básicos de segurança do sistema FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Os vários mecanismos de criptografia disponíveis no FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como configurar a autenticação de senha única.</para>
      </listitem>

      <listitem>
	<para>Como configurar o <application>TCP Wrapper</application> para uso com o <citerefentry><refentrytitle>inetd</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
      </listitem>

      <listitem>
	<para>Como configurar o <application>Kerberos</application> no FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como configurar o <acronym>IPsec</acronym> e criar uma <acronym>VPN</acronym>.</para>
      </listitem>

      <listitem>
	<para>Como configurar e usar o <application>OpenSSH</application> no FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como usar <acronym>ACL</acronym>s para o sistema de arquivos .</para>
      </listitem>

      <listitem>
	<para>Como usar o <application>pkg</application> para auditar pacotes de software de terceiros instalados a partir da Coleção de Ports.</para>
      </listitem>

      <listitem>
	<para>Como utilizar os alertas de segurança do FreeBSD.</para>
      </listitem>

      <listitem>
	<para>O que é Auditoria de Processos e como ativá-la no FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como controlar os recursos do usuário usando classes de login ou o banco de dados de limites de recursos.</para>
      </listitem>
    </itemizedlist>

    <para>Antes de ler este capítulo, você deve:</para>

    <itemizedlist>
      <listitem>
	<para>Entender os conceitos básicos do FreeBSD e de Internet.</para>
      </listitem>
    </itemizedlist>

    <para>Tópicos de segurança adicionais são abordados em outras partes deste Manual. Por exemplo, o Controle de Acesso Obrigatório é discutido em <xref linkend="mac"/> e os firewalls da Internet são discutidos em <xref linkend="firewalls"/>.</para>
  </sect1>

  <sect1 xml:id="security-intro">
    <title>Introdução</title>

    <para>Segurança é responsabilidade de todos. Um ponto de entrada fraco em qualquer sistema pode permitir que intrusos obtenham acesso a informações críticas e causem estragos em toda a rede. Um dos princípios centrais da segurança da informação é a tríade <acronym>CIA</acronym>, que significa Confidencialidade, Integridade e Disponibilidade dos sistemas de informação.</para>

    <para>A tríade <acronym>CIA</acronym> é um conceito básico de segurança de computadores, pois os clientes e usuários esperam que seus dados sejam protegidos. Por exemplo, um cliente espera que as informações do cartão de crédito sejam armazenadas com segurança (confidencialidade), que os pedidos não sejam alterados nos bastidores (integridade) e que tenham acesso às informações do pedido em todos os momentos (disponibilidade).</para>

    <para>Para fornecer <acronym>CIA</acronym>, os profissionais de segurança aplicam uma estratégia de defesa em profundidade. A ideia de defesa em profundidade é adicionar várias camadas de segurança para evitar que uma falha em uma única camada e faça com que todo o sistema de segurança entre em colapso. Por exemplo, um administrador do sistema não pode simplesmente ativar um firewall e considerar a rede ou o sistema seguro. É preciso também auditar contas, verificar a integridade dos binários e garantir que ferramentas maliciosas não estejam instaladas. Para implementar uma estratégia de segurança eficaz, é preciso entender as ameaças e como se defender delas.</para>

    <para>O que é uma ameaça no que se refere à segurança do computador? As ameaças não se limitam a invasores remotos que tentam acessar um sistema sem permissão de um local remoto. As ameaças também incluem funcionários, softwares mal-intencionados, dispositivos de rede não autorizados, desastres naturais, vulnerabilidades de segurança e até corporações concorrentes.</para>

    <para>Sistemas e redes podem ser acessados sem permissão, às vezes por acidente, ou por atacantes remotos e, em alguns casos, por meio de espionagem corporativa ou ex-funcionários. Como usuário, é importante se preparar e admitir quando um erro levou a uma violação de segurança e relatar possíveis problemas à equipe de segurança. Como administrador, é importante conhecer as ameaças e estar preparado para mitigá-las.</para>

    <para>Ao aplicar a segurança aos sistemas, recomenda-se começar protegendo as contas básicas e a configuração do sistema e, em seguida, proteger a camada de rede de modo a aderir à política do sistema e aos procedimentos de segurança da organização. Muitas organizações já possuem uma política de segurança que abrange a configuração de dispositivos de tecnologia. A política deve incluir a configuração de segurança de estações de trabalho, desktops, dispositivos móveis, telefones, servidores de produção e servidores de desenvolvimento. Em muitos casos, procedimentos operacionais padrão (<acronym>SOP</acronym>s) já existem. Em caso de dúvida, pergunte à equipe de segurança.</para>

    <para>O restante desta introdução descreve como algumas dessas configurações básicas de segurança são executadas em um sistema FreeBSD. O restante deste capítulo descreve algumas ferramentas específicas que podem ser usadas ao implementar uma política de segurança em um sistema FreeBSD.</para>

    <sect2 xml:id="security-accounts">
      <title>Prevenindo Logins</title>

      <para>Ao garantir a segurança de um sistema, um bom ponto de partida é uma auditoria de contas. Assegure-se de que o <systemitem class="username">root</systemitem> tenha uma senha forte e que essa senha não seja compartilhada. Desabilite todas as contas que não precisam de acesso de para logar.</para>

      <para>Para negar acesso de login a contas, existem dois métodos. O primeiro é bloquear a conta. Este exemplo bloqueia a conta <systemitem class="username">toor</systemitem>:</para>

      <screen><prompt>#</prompt> <userinput>pw lock <replaceable>toor</replaceable></userinput></screen>

      <para>O segundo método é impedir o acesso ao login alterando o shell para <filename>/usr/sbin/nologin</filename>. Apenas o superusuário pode alterar o shell para outros usuários:</para>

      <screen><prompt>#</prompt> <userinput>chsh -s /usr/sbin/nologin <replaceable>toor</replaceable></userinput></screen>

      <para>O shell <filename>/usr/sbin/nologin</filename> impede que o sistema atribua um shell ao usuário quando ele tenta efetuar login.</para>
    </sect2>

    <sect2 xml:id="security-accountmgmt">
      <title>Escalonamento de Contas Permitido</title>

      <para>Em alguns casos, a administração do sistema precisa ser compartilhada com outros usuários. O FreeBSD tem dois métodos para lidar com isso. O primeiro, que não é recomendado, é uma senha de root compartilhada usada por membros do grupo <systemitem class="groupname">wheel</systemitem>. Com esse método, um usuário digita <command>su</command> e insere a senha para <systemitem class="groupname">wheel</systemitem> sempre que o acesso do superusuário for necessário. O usuário deve então digitar <command>exit</command> para deixar o acesso privilegiado após terminar os comandos que requereram acesso administrativo. Para adicionar um usuário a este grupo, edite <filename>/etc/group</filename> e adicione o usuário ao final da entrada <literal>wheel</literal>. O usuário deve ser separado por um caractere vírgula sem espaço.</para>

      <para>O segundo e recomendado método para permitir o escalonamento de privilégios é instalar o pacote ou port <package>security/sudo</package>. Este software fornece auditoria adicional, controle de usuário mais refinado e pode ser configurado para bloquear os usuários para que executem apenas os comandos privilegiados especificados.</para>

      <para>Após a instalação, use o <command>visudo</command> para editar o <filename>/usr/local/etc/sudoers</filename>. Este exemplo cria um novo grupo <systemitem class="groupname">webadmin</systemitem>, adiciona a conta <systemitem class="username">trhodes</systemitem> a esse grupo e configura esse acesso de grupo para reiniciar o <package>apache24</package>:</para>

      <screen><prompt>#</prompt> <userinput>pw groupadd webadmin -M trhodes -g 6000</userinput>
<prompt>#</prompt> <userinput>visudo</userinput>
%webadmin ALL=(ALL) /usr/sbin/service apache24 *</screen>
    </sect2>

    <sect2 xml:id="security-passwords">
      <title>Hashes de Senhas</title>

      <para>As senhas são um mal necessário da tecnologia. Quando elas devem ser usadas, elas devem ser complexas e um poderoso mecanismo de hash deve ser usado para criptografar a versão armazenada no banco de dados de senhas. O FreeBSD suporta os algoritmos de <acronym>DES</acronym>, <acronym>MD5</acronym>, <acronym>SHA256</acronym>, <acronym>SHA512</acronym> e Blowfish na sua biblioteca <function>crypt()</function>. O padrão de <acronym>SHA512</acronym> não deve ser alterado para um algoritmo hash menos seguro, mas pode ser alterado para o algoritmo Blowfish mais seguro.</para>

      <note>
	<para>O Blowfish não faz parte do <acronym>AES</acronym> e não é considerado compatível com nenhum Federal Information Processing Standard (<acronym>FIPS</acronym>). Seu uso pode não ser permitido em alguns ambientes.</para>
      </note>

      <para>Para determinar qual algoritmo de hash é usado para criptografar a senha de um usuário, o superusuário pode visualizar o hash do usuário no banco de dados de senhas do FreeBSD. Cada hash começa com um símbolo que indica o tipo de mecanismo de hash usado para criptografar a senha. Se <acronym>DES</acronym> for usado, não haverá símbolo de início. Para <acronym>MD5</acronym>, o símbolo é <literal>$</literal>. Para <acronym>SHA256</acronym> e <acronym>SHA512</acronym>, o símbolo é <literal>$6$</literal>. Para o Blowfish, o símbolo é <literal>$2a$</literal>. Neste exemplo, a senha para <systemitem class="username">dru</systemitem> é criptografada usando o algoritmo <acronym>SHA512</acronym> padrão quando o hash começa com <literal>$6$</literal>. Observe que o hash criptografado, não a senha em si, é armazenado no banco de dados de senhas:</para>

      <screen><prompt>#</prompt> <userinput>grep dru /etc/master.passwd</userinput>
dru:$6$pzIjSvCAn.PBYQBA$PXpSeWPx3g5kscj3IMiM7tUEUSPmGexxta.8Lt9TGSi2lNQqYGKszsBPuGME0:1001:1001::0:0:dru:/usr/home/dru:/bin/csh</screen>

      <para>O mecanismo de hash é definido na classe de login do usuário. Para este exemplo, o usuário está na classe de login <literal>default</literal> e o algoritmo de hash é definido com esta linha em <filename>/etc/login.conf</filename>:</para>

      <programlisting>        :passwd_format=sha512:\</programlisting>

      <para>Para alterar o algoritmo para Blowfish, modifique a linha para ficar assim:</para>

      <programlisting>        :passwd_format=blf:\</programlisting>

      <para>Em seguida, execute <command>cap_mkdb /etc/login.conf</command> conforme descrito em <xref linkend="users-limiting"/>. Observe que essa alteração não afetará os hashes de senha existentes. Isso significa que todas as senhas devem ser refeitas pedindo aos usuários que executem <command>passwd</command> para alterar sua senha.</para>

      <para>Para logins remotos, a autenticação de dois fatores deve ser usada. Um exemplo de autenticação de dois fatores é <quote>algo que você tem</quote>, como uma chave, e <quote>algo que você conhece</quote>, como a senha para essa chave. Como o <application>OpenSSH</application> é parte do sistema básico do FreeBSD, todos os logins de rede devem ser sobre uma conexão criptografada e usar autenticação baseada em chave em vez de senhas. Para mais informações, consulte <xref linkend="openssh"/>. Os usuários do Kerberos podem precisar fazer alterações adicionais para implementar o <application>OpenSSH</application> em sua rede. Essas alterações são descritas em <xref linkend="kerberos5"/>.</para>
    </sect2>

    <sect2 xml:id="security-pwpolicy">
      <title>Aplicação de Política de Senha</title>

      <para>Aplicar uma política de senha forte para contas locais é um aspecto fundamental da segurança do sistema. No FreeBSD, o tamanho da senha, a força da senha e a complexidade da senha podem ser implementados usando os Módulos de Autenticação Conectáveis (<acronym>PAM</acronym>).</para>

      <para>Esta seção demonstra como configurar o tamanho mínimo e máximo da senha e a imposição de caracteres mistos usando o módulo <filename>pam_passwdqc.so</filename>. Este módulo é aplicado quando um usuário altera sua senha.</para>

      <para>Para configurar este módulo, torne-se o superusuário e remova o comentário da linha contendo <literal>pam_passwdqc.so</literal> em <filename>/etc/pam.d/passwd</filename>. Em seguida, edite essa linha para corresponder à política de senha:</para>

      <programlisting>password        requisite       pam_passwdqc.so         <replaceable>min=disabled,disabled,disabled,12,10 similar=deny retry=3</replaceable> enforce=users</programlisting>

      <para>Este exemplo define vários requisitos para novas senhas. A configuração <literal>min</literal> controla o tamanho mínimo da senha. Ele tem cinco valores porque este módulo define cinco tipos diferentes de senhas com base em sua complexidade. Complexidade é definida pelo tipo de caracteres que devem existir em uma senha, como letras, números, símbolos e maiúsculas e minúsculas. Os tipos de senhas são descritos em <citerefentry><refentrytitle>pam_passwdqc</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Neste exemplo, os três primeiros tipos de senha são desativados, o que significa que as senhas que atendem a esses requisitos de complexidade não serão aceitas, independentemente da sua duração. O <literal>12</literal> define uma política de senha mínima de pelo menos doze caracteres, se a senha também contiver caracteres com três tipos de complexidade. O <literal>10</literal> define a política de senha para também permitir senhas de pelo menos dez caracteres, se a senha contiver caracteres com quatro tipos de complexidade.</para>

      <para>A configuração <literal>similar</literal> nega senhas semelhantes à senha anterior do usuário. A configuração <literal>retry</literal> fornece ao usuário três oportunidades para inserir uma nova senha.</para>

      <para>Depois que este arquivo for salvo, um usuário que alterar sua senha verá uma mensagem semelhante a seguinte:</para>

      <screen><prompt>%</prompt> <userinput>passwd</userinput>
Changing local password for trhodes
Old Password:

You can now choose the new password.
A valid password should be a mix of upper and lower case letters,
digits and other characters.  You can use a 12 character long
password with characters from at least 3 of these 4 classes, or
a 10 character long password containing characters from all the
classes.  Characters that form a common pattern are discarded by
the check.
Alternatively, if no one else can see your terminal now, you can
pick this as your password: "trait-useful&amp;knob".
Enter new password:</screen>

      <para>Se uma senha que não corresponde à política for inserida, ela será rejeitada com um aviso e o usuário terá a oportunidade de tentar novamente, até o número configurado de novas tentativas.</para>

      <para>A maioria das políticas de senha exige que as senhas expirem depois de tantos dias. Para definir um tempo de expiração da senha no FreeBSD, defina <option>passwordtime</option> para a classe de login do usuário em <filename>/etc/login.conf</filename>. A classe de login <literal>default</literal> contém um exemplo:</para>

      <programlisting>#       :passwordtime=90d:\</programlisting>

      <para>Portanto, para definir uma expiração de 90 dias para esta classe de login, remova o símbolo de comentário (<literal>#</literal>), salve a edição e execute o <command>cap_mkdb /etc/login.conf</command>.</para>

      <para>Para definir a expiração em usuários individuais, passe uma data de expiração ou o número de dias para expirar e um nome de usuário para o comando <command>pw</command>:</para>

      <screen><prompt>#</prompt> <userinput>pw usermod -p <replaceable>30-apr-2015</replaceable> -n <replaceable>trhodes</replaceable></userinput></screen>

      <para>Como visto aqui, uma data de expiração é definida na forma de dia, mês e ano. Para obter maiores informações, consulte <citerefentry><refentrytitle>pw</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
    </sect2>

    <sect2 xml:id="security-rkhunter">
      <title>Detectando Rootkits</title>

      <para>Um <firstterm>rootkit</firstterm> é qualquer software não autorizado que tente obter acesso como <systemitem class="username">root</systemitem> a um sistema. Uma vez instalado, esse software mal-intencionado normalmente abrirá outro caminho de entrada para um invasor. Realisticamente, uma vez que um sistema foi comprometido por um rootkit e uma investigação foi realizada, o sistema deve ser reinstalado do zero. Existe um tremendo risco de que mesmo o engenheiro de sistemas ou segurança mais prudente perca algo que um invasor deixou para trás.</para>

      <para>Um rootkit faz uma coisa útil para administradores: uma vez detectado, é um sinal de que um comprometimento aconteceu em algum momento. Mas, esses tipos de aplicativos tendem a ser muito bem ocultos. Esta seção demonstra uma ferramenta que pode ser usada para detectar rootkits, <package>security/rkhunter</package>.</para>

      <para>Após a instalação deste pacote ou port, o sistema pode ser verificado usando o seguinte comando. Ele produzirá muitas informações e exigirá uma entrada manual da tecla <keycap>ENTER</keycap>:</para>

      <screen><prompt>#</prompt> <userinput>rkhunter -c</userinput></screen>

      <para>Depois que o processo for concluído, uma mensagem de status será impressa na tela. Esta mensagem incluirá a quantidade de arquivos verificados, arquivos suspeitos, possíveis rootkits e mais. Durante a verificação, alguns avisos de segurança genéricos podem ser produzidos sobre arquivos ocultos, a seleção do protocolo <application>OpenSSH</application> e versões vulneráveis conhecidas do software instalado. Estes podem ser tratados agora ou após uma análise mais detalhada ter sido realizada.</para>

      <para>Todo administrador deve saber o que está sendo executado nos sistemas pelos quais é responsável. Ferramentas de terceiros como o <application>rkhunter</application> e o <package>sysutils/lsof</package> e comandos nativos como o <command>netstat</command> e o <command>ps</command>, podem mostrar uma grande quantidade de informações sobre o sistema. Faça anotações sobre o que é normal, faça perguntas quando algo parecer fora do lugar e seja paranoico. Embora evitar um comprometimento seja ideal, detectar um comprometimento é imprescindível.</para>
    </sect2>

    <sect2 xml:id="security-ids">
      <title>Verificação Binária</title>

      <para>A verificação de arquivos e binários do sistema é importante porque fornece às equipes de administração e segurança do sistema informações sobre alterações no sistema. Uma aplicação de software que monitora o sistema para alterações é chamado de Sistema de Detecção de Intrusão (<acronym>IDS</acronym>).</para>

      <para>O FreeBSD fornece suporte nativo para um sistema de <acronym>IDS</acronym> básico. Embora os emails de segurança noturnos notifiquem o administrador sobre alterações, as informações são armazenadas localmente e há uma chance de que um usuário mal-intencionado modifique essas informações para ocultar suas alterações no sistema. Como tal, recomenda-se criar um conjunto separado de assinaturas binárias e armazená-las em um diretório de read-only, propriedade do root ou, de preferência, em um disco <acronym>USB</acronym> removível ou servidor <application>rsync</application> remoto.</para>

      <para>O utilitário <command>mtree</command> embutido pode ser usado para gerar uma especificação do conteúdo de um diretório. Um seed, ou uma constante numérica, é usada para gerar a especificação e é necessária para verificar se a especificação não foi alterada. Isso possibilita determinar se um arquivo ou binário foi modificado. Como o valor inicial do seed é desconhecido por um invasor, disfarçar ou impossibilitar a verificação dos valores de checksum dos arquivos será difícil ou impossível. O exemplo a seguir gera um conjunto de hashes <acronym>SHA256</acronym>, um para cada sistema binário no diretório <filename>/bin</filename> e salva esses valores em um arquivo oculto no diretório inicial do <systemitem class="username">root</systemitem>, <filename>/root/.bin_chksum_mtree</filename>:</para>

      <screen><prompt>#</prompt> <userinput>mtree -s <replaceable>3483151339707503</replaceable> -c -K cksum,sha256digest -p <replaceable>/bin</replaceable> &gt; <replaceable>/root/.bin_chksum_mtree</replaceable></userinput>
<prompt>#</prompt> mtree: /bin checksum: 3427012225</screen>

      <para>O <replaceable>3483151339707503</replaceable> representa o seed. Este valor deve ser lembrado, mas não compartilhado.</para>

      <para>Visualizar o arquivo <filename>/root/.bin_cksum_mtree</filename> deve produzir uma saída semelhante à seguinte:</para>

      <programlisting>#          user: root
#       machine: dreadnaught
#          tree: /bin
#          date: Mon Feb  3 10:19:53 2014

# .
/set type=file uid=0 gid=0 mode=0555 nlink=1 flags=none
.               type=dir mode=0755 nlink=2 size=1024 \
                time=1380277977.000000000
    \133        nlink=2 size=11704 time=1380277977.000000000 \
                cksum=484492447 \
                sha256digest=6207490fbdb5ed1904441fbfa941279055c3e24d3a4049aeb45094596400662a
    cat         size=12096 time=1380277975.000000000 cksum=3909216944 \
                sha256digest=65ea347b9418760b247ab10244f47a7ca2a569c9836d77f074e7a306900c1e69
    chflags     size=8168 time=1380277975.000000000 cksum=3949425175 \
                sha256digest=c99eb6fc1c92cac335c08be004a0a5b4c24a0c0ef3712017b12c89a978b2dac3
    chio        size=18520 time=1380277975.000000000 cksum=2208263309 \
                sha256digest=ddf7c8cb92a58750a675328345560d8cc7fe14fb3ccd3690c34954cbe69fc964
    chmod       size=8640 time=1380277975.000000000 cksum=2214429708 \
                sha256digest=a435972263bf814ad8df082c0752aa2a7bdd8b74ff01431ccbd52ed1e490bbe7</programlisting>

      <para>O nome do host da máquina, a data e a hora em que a especificação foi criada e o nome do usuário que criou a especificação são incluídos neste relatório. Há um checksum, tamanho, hora e um digest <acronym>SHA</acronym>256 para cada binário no diretório.</para>

      <para>Para verificar se as assinaturas binárias não foram alteradas, compare o conteúdo atual do diretório com a especificação gerada anteriormente e salve os resultados em um arquivo. Este comando requer o seed que foi usado para gerar a especificação original:</para>

      <screen><prompt>#</prompt> <userinput>mtree -s <replaceable>3483151339707503</replaceable> -p <replaceable>/bin</replaceable> &lt; <replaceable>/root/.bin_chksum_mtree</replaceable> &gt;&gt; <replaceable>/root/.bin_chksum_output</replaceable></userinput>
<prompt>#</prompt> mtree: /bin checksum: 3427012225</screen>

      <para>Isso deve produzir o mesmo checksum para <filename>/bin</filename> que foi produzido quando a especificação foi criada. Se nenhuma alteração tiver ocorrido nos binários nesse diretório, o arquivo de saída <filename>/root/.bin_chksum_output</filename> estará vazio. Para simular uma alteração, altere a data no arquivo <filename>/bin/cat</filename> usando o <command>touch</command> e execute o comando de verificação novamente:</para>

      <screen><prompt>#</prompt> <userinput>touch /bin/cat</userinput>
<prompt>#</prompt> <userinput>mtree -s <replaceable>3483151339707503</replaceable> -p <replaceable>/bin</replaceable> &lt; <replaceable>/root/.bin_chksum_mtree</replaceable> &gt;&gt; <replaceable>/root/.bin_chksum_output</replaceable></userinput>
<prompt>#</prompt> <userinput>more /root/.bin_chksum_output</userinput>
cat changed
	modification time expected Fri Sep 27 06:32:55 2013 found Mon Feb  3 10:28:43 2014</screen>

      <para>Recomenda-se criar especificações para os diretórios que contêm binários e arquivos de configuração, bem como quaisquer diretórios que contenham dados sensíveis. Normalmente, as especificações são criadas para <filename>/bin</filename>, <filename>/sbin</filename>, <filename>/usr/bin</filename>, <filename>/usr/sbin</filename>, <filename>/usr/local/bin</filename>, <filename>/etc</filename> e <filename>/usr/local/etc</filename>.</para>

      <para>Existem sistemas de <acronym>IDS</acronym> mais avançados, como o <package>security/aide</package>. Na maioria dos casos, o <command>mtree</command> fornece a funcionalidade que os administradores precisam. É importante manter o valor inicial e a saída do checksum oculta de usuários mal-intencionados. Maiores informações sobre o <command>mtree</command> podem ser encontradas em <citerefentry><refentrytitle>mtree</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
    </sect2>

    <sect2 xml:id="security-tuning">
      <title>Otimizando o Sistema para Segurança</title>

      <para>No FreeBSD, muitos recursos do sistema podem ser ajustados usando o <command>sysctl</command>. Alguns dos recursos de segurança que podem ser ajustados para impedir ataques de negação de serviço (<acronym>DoS</acronym>) serão abordados nesta seção. Mais informações sobre o uso do <command>sysctl</command>, incluindo como alterar temporariamente os valores e como tornar as alterações permanentes após o teste, podem ser encontradas em <xref linkend="configtuning-sysctl"/>.</para>

      <note>
	<para>Sempre que uma configuração é alterada com o <command>sysctl</command>, a chance de causar danos indesejados é aumentada, afetando a disponibilidade do sistema. Todas as alterações devem ser monitoradas e, se possível, testadas em um sistema de teste antes de serem usadas em um sistema de produção.</para>
      </note>

      <para>Por padrão, o kernel do FreeBSD é inicializado com um nível de segurança <literal>-1 </literal>. Isso é chamado de <quote>modo inseguro</quote> porque as flags de arquivos imutáveis podem ser desativadas e todos os dispositivos podem ser lidos ou gravados. O nível de segurança permanecerá em <literal>-1</literal>, a menos que seja alterado através do <command>sysctl</command> ou por uma configuração nos scripts de inicialização. O nível de segurança pode ser aumentado durante a inicialização do sistema, definindo <varname>kern_securelevel_enable</varname> para <literal>YES</literal> no arquivo <filename>/etc/rc.conf</filename>, e o valor de <varname>kern_securelevel</varname> para o nível de segurança desejado. Veja <citerefentry><refentrytitle>security</refentrytitle><manvolnum>7</manvolnum></citerefentry> e <citerefentry><refentrytitle>init</refentrytitle><manvolnum>8</manvolnum></citerefentry> para maiores informações sobre essas configurações e os níveis de segurança disponíveis.</para>

      <warning>
	<para>Aumentar o valor da variável <varname>securelevel</varname> pode quebrar o <application>Xorg</application> e causar outros problemas. Esteja preparado para fazer alguma depuração.</para>
      </warning>

      <para>As configurações da variável <varname>net.inet.tcp.blackhole</varname> e <varname>net.inet.udp.blackhole</varname> podem ser usadas para descartar pacotes <acronym>SYN</acronym> de entrada em portas fechadas sem enviar uma resposta  <acronym>RST</acronym>. O comportamento padrão é retornar um <acronym>RST</acronym> para mostrar que uma porta está fechada. A alteração do padrão fornece algum nível de proteção contra varreduras de portas, que são usadas para determinar quais aplicativos estão sendo executados em um sistema. Defina <varname>net.inet.tcp.blackhole</varname> para <literal>2</literal> e <varname>net.inet.udp.blackhole</varname> para <literal>1</literal>. Consulte <citerefentry><refentrytitle>blackhole</refentrytitle><manvolnum>4</manvolnum></citerefentry> para obter maiores informações sobre essas configurações.</para>

      <para>As configurações das variáveis <varname>net.inet.icmp.drop_redirect</varname> e <varname>net.inet.ip.redirect</varname> ajudam a evitar <firstterm>ataques de redirecionamento</firstterm>. Um ataque de redirecionamento é um tipo de <acronym>DoS</acronym> que envia um grande número de pacotes <acronym>ICMP</acronym> tipo 5. Como esses pacotes não são necessários, configure <varname>net.inet.icmp.drop_redirect</varname> para <literal>1</literal> e configure <varname>net.inet.ip.redirect</varname> para <literal>0</literal>.</para>

      <para>O roteamento de origem é um método para detectar e acessar endereços não roteáveis na rede interna. Isso deve ser desativado, pois endereços não roteáveis normalmente não são roteáveis de propósito. Para desativar este recurso, defina <varname>net.inet.ip.sourceroute</varname> e <varname>net.inet.ip.accept_sourceroute</varname> como <literal>0</literal>.</para>

      <para>Quando uma máquina na rede precisa enviar mensagens para todos os hosts em uma sub-rede, uma mensagem de solicitação echo do <acronym>ICMP</acronym> é enviada para o endereço de broadcast. No entanto, não há motivo para um host externo executar essa ação. Para rejeitar todas as solicitações externas de transmissão, defina <varname>net.inet.icmp.bmcastecho</varname> como <literal>0</literal>.</para>

      <para>Algumas configurações adicionais estão documentadas em <citerefentry><refentrytitle>security</refentrytitle><manvolnum>7</manvolnum></citerefentry>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="one-time-passwords">
    <title>Senhas de Uso Unico</title>

    <indexterm><primary>one-time passwords</primary></indexterm>
    <indexterm><primary>security</primary> <secondary>one-time passwords</secondary></indexterm>

    <para>Por padrão, o FreeBSD inclui suporte para senhas de uso único em tudo (<acronym>OPIE</acronym>). O <acronym>OPIE</acronym> é projetado para evitar ataques repetidos, nos quais um atacante descobre a senha de um usuário e a usa para acessar um sistema. Como uma senha é usada apenas uma vez em <acronym>OPIE</acronym>, uma senha descoberta é de pouca utilidade para um invasor. O <acronym>OPIE</acronym> usa um hash seguro e um sistema de desafio/resposta para gerenciar senhas. A implementação do FreeBSD usa o hash <acronym>MD5</acronym> por padrão.</para>

    <para>O <acronym>OPIE</acronym> usa três tipos diferentes de senhas. A primeira é a senha usual <trademark class="registered">UNIX</trademark> ou Kerberos. A segunda é a senha única que é gerada pelo <command>opiekey</command>. O terceiro tipo de senha é a <quote>senha secreta</quote> que é usada para gerar senhas de uso único. A senha secreta não tem nada a fazer com ela e deve ser diferente da senha <trademark class="registered">UNIX</trademark>.</para>

    <para>Existem duas outras partes de dados importantes para o <acronym>OPIE</acronym>. Uma é o <quote>seed</quote> ou <quote>chave</quote>, composta por duas letras e cinco dígitos. A outra é a <quote>contagem de iteração</quote>, um número entre 1 e 100. O <acronym>OPIE</acronym> cria a senha única concatenando o seed e a senha secreta, aplicando o hash <acronym> MD5 </acronym> quantas vezes forem especificadas pela contagem de iterações e transformando o resultado em seis palavras inglesas curtas que representam a senha de uso único. O sistema de autenticação controla a última senha descartável usada e o usuário é autenticado se o hash da senha fornecida pelo usuário for igual à senha anterior. Como um hash unidirecional é usado, é impossível gerar futuras senhas de uso único se uma senha usada com êxito for capturada. A contagem de iteração é diminuída após cada login bem-sucedido para manter o usuário e o programa de login em sincronia. Quando a contagem de iterações descer para <literal>1</literal>, o <acronym>OPIE</acronym> deve ser reinicializado.</para>

    <para>Existem alguns programas envolvidos neste processo. Uma senha de uso único, ou uma lista consecutiva de senhas de uso único, é gerada passando uma contagem de iteração, um seed e uma senha secreta para o <citerefentry><refentrytitle>opiekey</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Além de inicializar o <acronym>OPIE</acronym>, o <citerefentry><refentrytitle>opiepasswd</refentrytitle><manvolnum>1</manvolnum></citerefentry> é usado para alterar senhas, contagens de iteração ou seeds. Os arquivos de credenciais relevantes em <filename>/etc/opiekeys</filename> são examinados pelo <citerefentry><refentrytitle>opieinfo</refentrytitle><manvolnum>1</manvolnum></citerefentry> o qual imprime a iteração atual e o seed do usuário solicitante atual.</para>

    <para>Esta seção descreve quatro tipos diferentes de operações. A primeira é como configurar senhas de uso único pela primeira vez em uma conexão segura. A segunda é como usar o <command>opiepasswd</command> em uma conexão insegura. A terceira é como efetuar login em uma conexão insegura. A quarta é como gerar um número de chaves que podem ser escritas ou impressas para uso em locais inseguros.</para>

    <sect2>
      <title>Inicializando o <acronym>OPIE</acronym></title>

      <para>Para inicializar o <acronym>OPIE</acronym> pela primeira vez, execute este comando a partir de um local seguro:</para>

      <screen><prompt>%</prompt> <userinput>opiepasswd -c</userinput>
Adding unfurl:
Only use this method from the console; NEVER from remote. If you are using
telnet, xterm, or a dial-in, type ^C now or exit with no password.
Then run opiepasswd without the -c parameter.
Using MD5 to compute responses.
Enter new secret pass phrase:
Again new secret pass phrase:

ID unfurl OTP key is 499 to4268
MOS MALL GOAT ARM AVID COED</screen>

      <para xml:lang="en">The <option>-c</option> sets console mode which assumes
	that the command is being run from a secure location, such as
	a computer under the user's control or an
	<acronym>SSH</acronym> session to a computer under the user's
	control.</para>

      <para>Quando solicitado, insira a senha secreta que será usada para gerar as chaves de login de uso único. Essa senha deve ser difícil de adivinhar e deve ser diferente da senha associada à conta de login do usuário. Deve ter entre 10 e 127 caracteres. Lembre-se desta senha.</para>

      <para>A linha <literal>ID</literal> lista o nome de login (<literal>unfurl</literal>), a contagem de iterações padrão (<literal>499</literal>) e o seed padrão (<literal>to4268</literal>). Ao efetuar o login, o sistema lembrará esses parâmetros e os exibirá, o que significa que eles não precisam ser memorizados. A última linha lista a senha única gerada que corresponde a esses parâmetros e a senha secreta. No próximo login, use essa senha única.</para>
    </sect2>

    <sect2>
      <title>Inicialização de uma Conexão Insegura</title>

      <para>Para inicializar ou alterar a senha secreta em um sistema inseguro, é necessária uma conexão segura em algum lugar onde o <command>opiekey</command> possa ser executado. Isso pode ser um prompt de shell em uma máquina confiável. Uma contagem de iteração é necessária, em que 100 é provavelmente um bom valor, e o seed pode ser especificado ou a gerado aleatoriamente. Na conexão insegura, a máquina sendo inicializada, use <citerefentry><refentrytitle>opiepasswd</refentrytitle><manvolnum>1</manvolnum></citerefentry>:</para>

      <screen><prompt>%</prompt> <userinput>opiepasswd</userinput>

Updating unfurl:
You need the response from an OTP generator.
Old secret pass phrase:
	otp-md5 498 to4268 ext
	Response: GAME GAG WELT OUT DOWN CHAT
New secret pass phrase:
	otp-md5 499 to4269
	Response: LINE PAP MILK NELL BUOY TROY

ID mark OTP key is 499 gr4269
LINE PAP MILK NELL BUOY TROY</screen>

      <para>Para aceitar o seed padrão, pressione <keycap>Return</keycap>. Antes de inserir uma senha de acesso, passe para a conexão segura e forneça os mesmos parâmetros:</para>

      <screen><prompt>%</prompt> <userinput>opiekey 498 to4268</userinput>
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase:
GAME GAG WELT OUT DOWN CHAT</screen>

      <para>Volte para a conexão insegura e copie a senha única gerada para o programa relevante.</para>
    </sect2>

    <sect2>
      <title>Gerando uma Senha de Uso Único</title>

      <para>Depois de inicializar o <acronym>OPIE</acronym> e efetuar login, um prompt como este será exibido:</para>

      <screen><prompt>%</prompt> <userinput>telnet example.com</userinput>
Trying 10.0.0.1...
Connected to example.com
Escape character is '^]'.

FreeBSD/i386 (example.com) (ttypa)

login: <userinput>&lt;username&gt;</userinput>
otp-md5 498 gr4269 ext
Password: </screen>

      <para>Os prompts do <acronym>OPIE</acronym> fornecem um recurso útil. Se o <keycap>Enter</keycap> for pressionado no prompt de senha, o prompt ativará o echo e exibirá o que foi digitado. Isso pode ser útil ao tentar digitar uma senha manualmente a partir de uma impressão.</para>

      <indexterm><primary>MS-DOS</primary></indexterm>
      <indexterm><primary>Windows</primary></indexterm>
      <indexterm><primary>MacOS</primary></indexterm>

      <para>Neste ponto, gere a senha de uso único para responder a este aviso de login. Isso deve ser feito em um sistema confiável em que seja seguro executar o <citerefentry><refentrytitle>opiekey</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Existem versões deste comando para <trademark class="registered">Windows</trademark>, <trademark class="registered">Mac OS</trademark> e FreeBSD. Esse comando precisa da contagem de iteração e do seed como opções da linha de comandos. Use recortar e colar no prompt de login da máquina que está sendo conectada.</para>

      <para>No sistema confiável:</para>

      <screen><prompt>%</prompt> <userinput>opiekey 498 to4268</userinput>
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase:
GAME GAG WELT OUT DOWN CHAT</screen>

      <para>Depois que a senha descartável for gerada, continue a logar.</para>
    </sect2>

    <sect2>
      <title>Gerando Múltiplas Senhas de Uso Único</title>

      <para>Às vezes, não há acesso a uma máquina confiável ou conexão segura. Neste caso, é possível usar o <citerefentry><refentrytitle>opiekey</refentrytitle><manvolnum>1</manvolnum></citerefentry> para gerar algumas de senhas de uso único antecipadamente. Por exemplo:</para>

      <screen><prompt>%</prompt> <userinput>opiekey -n 5 30 zz99999</userinput>
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase: <userinput>&lt;secret password&gt;</userinput>
26: JOAN BORE FOSS DES NAY QUIT
27: LATE BIAS SLAY FOLK MUCH TRIG
28: SALT TIN ANTI LOON NEAL USE
29: RIO ODIN GO BYE FURY TIC
30: GREW JIVE SAN GIRD BOIL PHI</screen>

      <para>A opção <option>-n 5</option> solicita cinco chaves em seqüência e <option>30</option> especifica qual deve ser o último número de iteração. Note que estes são impressos na ordem <emphasis>reversa</emphasis> de uso. O usuário realmente paranóico pode querer escrever os resultados manualmente; caso contrário, imprima a lista. Cada linha mostra a contagem de iteração e a senha de uso único. Risque as senhas conforme elas forem usadas.</para>
    </sect2>

    <sect2>
      <title>Restringindo o Uso de Senhas <trademark class="registered">UNIX</trademark></title>

      <para>O <acronym>OPIE</acronym> pode restringir o uso de senhas <trademark class="registered">UNIX</trademark> com base no endereço IP de uma sessão de login. O arquivo relevante é o <filename>/etc/opieaccess</filename>, que está presente por padrão. Consulte <citerefentry><refentrytitle>opieaccess</refentrytitle><manvolnum>5</manvolnum></citerefentry> para obter maiores informações sobre esse arquivo e sobre quais considerações de segurança você deve estar ciente ao usá-lo.</para>

      <para>Aqui está um exemplo do arquivo <filename>opieaccess</filename>:</para>

      <programlisting>permit 192.168.0.0 255.255.0.0</programlisting>

      <para>Esta linha permite que os usuários cujo endereço de origem IP (que é vulnerável a spoofing) corresponda ao valor e à máscara especificados, para usar as senhas <trademark class="registered">UNIX</trademark> a qualquer momento.</para>

      <para>Se nenhuma regra do arquivo <filename>opieaccess</filename> for correspondida, o padrão é negar logins que não sejam <acronym>OPIE</acronym>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="tcpwrappers">
    <info>
      <title>TCP Wrapper</title>

      <authorgroup>
	<author><personname><firstname>Tom</firstname><surname>Rhodes</surname></personname><contrib>Escrito por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>TCP Wrapper</primary></indexterm>

    <para>O <application>TCP Wrapper</application> é um sistema de controle de acesso baseado em host que estende as habilidades do <xref linkend="network-inetd"/>. Ele pode ser configurado para fornecer suporte de registro, mensagens de retorno e restrições de conexão para os daemons do servidor sob o controle do <application>inetd</application>. Consulte <citerefentry><refentrytitle>tcpd</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter maiores informações sobre o <application>TCP Wrapper</application> e seus recursos.</para>

    <para>O <application>TCP Wrapper</application> não deve ser considerado um substituto para um firewall configurado adequadamente. Em vez disso, <application>TCP Wrapper</application> deve ser usado em conjunto com um firewall e outros aprimoramentos de segurança para fornecer outra camada de proteção na implementação de uma política de segurança.</para>

    <sect2>
      <title>Configuração Inicial</title>

      <para>Para ativar o <application>TCP Wrapper</application> no FreeBSD, adicione as seguintes linhas ao arquivo <filename>/etc/rc.conf</filename>:</para>

      <programlisting>inetd_enable="YES"
inetd_flags="-Ww"</programlisting>

      <para>Então, configure corretamente o arquivo <filename>/etc/hosts.allow</filename>.</para>

      <note>
	<para>Ao contrário de outras implementações do <application>TCP Wrapper</application>, o uso do arquivo <filename>hosts.deny</filename> foi preterido no FreeBSD. Todas as opções de configuração devem ser colocadas no arquivo <filename>/etc/hosts.allow</filename>.</para>
      </note>

      <para>Na configuração mais simples, as políticas de conexão do daemon são configuradas para permitir ou bloquear, dependendo das opções no arquivo <filename>/etc/hosts.allow</filename>. A configuração padrão no FreeBSD é permitir todas as conexões para os daemons iniciados com o <application>inetd</application>.</para>

      <para>A configuração básica geralmente assume a forma de <literal>daemon : address : action</literal>, onde <literal>daemon</literal> é o daemon que o <application>inetd</application> iniciou, <literal>address</literal> é um nome de host válido ou um endereço <acronym>IP</acronym> ou um endereço IPv6 entre colchetes ([]) e <literal>action</literal> é <literal>allow</literal> ou <literal>deny</literal>. O <application>TCP Wrapper</application> usa uma semântica de correspondência de primeira regra, o que significa que o arquivo de configuração é varrido desde o início para uma regra correspondente. Quando uma correspondência é encontrada, a regra é aplicada e o processo de pesquisa é interrompido.</para>

      <para>Por exemplo, para permitir conexões <acronym>POP</acronym>3 através do daemon <package>mail/qpopper</package>, as seguintes linhas devem ser anexadas ao arquivo <filename>hosts.allow</filename>:</para>

      <programlisting># This line is required for POP3 connections:
qpopper : ALL : allow</programlisting>

      <para>Sempre que este arquivo for editado, reinicie o <application>inetd</application>:</para>

      <screen><prompt>#</prompt> <userinput>service inetd restart</userinput></screen>
    </sect2>

    <sect2>
      <title>Configuração Avançada</title>

      <para>O <application>TCP Wrapper</application> fornece opções avançadas para permitir mais controle sobre o modo como as conexões são tratadas. Em alguns casos, pode ser apropriado retornar um comentário para determinados hosts ou conexões de daemon. Em outros casos, uma entrada de log deve ser registrada ou um email enviado ao administrador. Outras situações podem exigir o uso de um serviço apenas para conexões locais. Isso tudo é possível através do uso de opções de configuração conhecidas como wildcards, caracteres de expansão e execução de comandos externos.</para>

      <para>Suponha que uma situação ocorra onde uma conexão deva ser negada, mas uma razão deve ser enviada ao host que tentou estabelecer essa conexão. Essa ação é possível com a opção <option>twist</option>. Quando uma tentativa de conexão é feita, o <option>twist</option> executa um comando ou script shell. Existe um exemplo no arquivo <filename>hosts.allow</filename>:</para>

      <programlisting># The rest of the daemons are protected.
ALL : ALL \
	: severity auth.info \
	: twist /bin/echo "You are not welcome to use %d from %h."</programlisting>

      <para>Neste exemplo, a mensagem <quote>You are not allowed to use <replaceable>daemon name</replaceable> from <replaceable>hostname</replaceable>.</quote> será retornada para qualquer daemon não configurado no <filename>hosts.allow </filename>. Isso é útil para enviar uma resposta de volta ao inicializador de conexão logo após a conexão estabelecida ser descartada. Qualquer mensagem a ser retornada <emphasis>deve</emphasis> ser delimitada por caracteres de aspas duplas (<literal>"</literal>).</para>

      <warning>
	<para>Pode ser possível iniciar um ataque de negação de serviço no servidor se um invasor inunda esses daemons com solicitações de conexão.</para>
      </warning>

      <para>Outra possibilidade é usar a opção <option>spawn</option>. Como a opção <option>twist</option>, a opção<option>spawn</option> implicitamente nega a conexão e pode ser usado para executar comandos ou scripts externos do shell. Ao contrário da <option>twist</option>, a <option>spawn</option> não enviará uma resposta ao host que estabeleceu a conexão. Por exemplo, considere a seguinte configuração:</para>

      <programlisting># We do not allow connections from example.com:
ALL : .example.com \
	: spawn (/bin/echo %a from %h attempted to access %d &gt;&gt; \
	  /var/log/connections.log) \
	: deny</programlisting>

      <para>Isso negará todas as tentativas de conexão de <systemitem class="fqdomainname">*.example.com</systemitem> e registrará o nome do host, endereço <acronym>IP</acronym> e o daemon ao qual o acesso foi tentado no arquivo <filename>/var/log/connections.log</filename>. Este exemplo usa os caracteres de substituição <literal>%a</literal> e <literal>%h</literal>. Consulte <citerefentry><refentrytitle>hosts_access</refentrytitle><manvolnum>5</manvolnum></citerefentry> para a lista completa.</para>

      <para>Para corresponder a cada instância de um daemon, domínio ou endereço <acronym>IP</acronym>, use <literal>ALL</literal>. Outro wildcard é o <literal>PARANOID</literal>, que pode ser usado para corresponder a qualquer host que forneça um endereço <acronym>IP</acronym> que possa ser forjado, porque o endereço <acronym>IP</acronym> difere do nome resolvido para o host. Neste exemplo, todas as solicitações de conexão para o <application>Sendmail</application> que possuem um endereço <acronym>IP</acronym> que varia de seu nome de host serão negadas:</para>

      <programlisting># Block possibly spoofed requests to sendmail:
sendmail : PARANOID : deny</programlisting>

      <caution>
	<para>Usar o wildcard <literal>PARANOID</literal> resultará em conexões negadas se o cliente ou servidor tiver uma configuração de <acronym>DNS</acronym> incorreta.</para>
      </caution>

      <para>Para saber mais sobre wildcards e sua funcionalidade associada, consulte <citerefentry><refentrytitle>hosts_access</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>

      <note>
	<para>Ao adicionar novas linhas de configuração, certifique-se de que quaisquer entradas desnecessárias para esse daemon sejam comentadas no arquivo <filename>hosts.allow</filename>.</para>
      </note>
    </sect2>
  </sect1>

  <sect1 xml:id="kerberos5">
    <info>
      <title><application>Kerberos</application></title>

      <authorgroup>
	<author><personname> <firstname>Tillman</firstname> <surname>Hodgson</surname> </personname> <contrib>Contribuído por </contrib></author>
      </authorgroup>

      <authorgroup>
	<author><personname> <firstname>Mark</firstname> <surname>Murray</surname> </personname> <contrib>Baseado em uma contribuição de </contrib></author>
      </authorgroup>
    </info>

    <para>O <application>Kerberos</application> é um protocolo de autenticação de rede que foi originalmente criado pelo Instituto de Tecnologia de Massachusetts (<acronym>MIT</acronym>) como uma maneira segura de fornecer autenticação em uma rede potencialmente hostil. O protocolo <application>Kerberos</application> usa criptografia robusta para que tanto um cliente quanto um servidor possam provar sua identidade sem enviar nenhum segredo não criptografado pela rede. O <application>Kerberos</application> pode ser descrito como um sistema proxy de verificação de identidade e como um sistema confiável de autenticação de terceiros. Depois que um usuário autentica com <application>Kerberos</application>, suas comunicações podem ser criptografadas para garantir privacidade e integridade dos dados.</para>

    <para>A única função do <application>Kerberos</application> é fornecer a autenticação segura de usuários e servidores na rede. Ele não fornece funções de autorização ou auditoria. Recomenda-se que o <application>Kerberos</application> seja usado com outros métodos de segurança que forneçam serviços de autorização e auditoria.</para>

    <para>A versão atual do protocolo é a versão 5, descrita na <acronym>RFC</acronym> 4120. Várias implementações gratuitas deste protocolo estão disponíveis, abrangendo uma ampla gama de sistemas operacionais. O <acronym>MIT</acronym> continua desenvolvendo o pacote <application>Kerberos</application>. É comumente usado no <acronym>US</acronym> como um produto de criptografia e, historicamente, está sujeito aos regulamentos de exportação dos <acronym>US</acronym>. No FreeBSD, o <acronym>MIT</acronym> <application>Kerberos</application> está disponível como o pacote ou port <package>security/krb5</package>. A implementação do <application>Kerberos</application> do Heimdal foi explicitamente desenvolvida fora do <acronym>US</acronym> para evitar regulamentações de exportação. A distribuição <application>Kerberos</application> do Heimdal está incluída na instalação base do FreeBSD, e outra distribuição com opções mais configuráveis está disponível como <package>security/heimdal</package> na Coleção de Ports.</para>

    <para>No <application>Kerberos</application>, os usuários e serviços são identificados como <quote>principals</quote>, que estão contidos em um agrupamento administrativo chamado de <quote>realm</quote>. Um usuário principal típico teria o formato <literal><replaceable>user</replaceable>@<replaceable>REALM</replaceable></literal> (os realms são tradicionalmente em caracteres maiúsculos).</para>

    <para>Esta seção fornece um guia sobre como configurar o <application>Kerberos</application> usando a distribuição Heimdal incluída no FreeBSD.</para>

    <para>Para fins de demonstração de uma instalação do <application>Kerberos </application>, os namespaces serão os seguintes:</para>

    <itemizedlist>
      <listitem>
	<para>O domínio (zona) de domínio <acronym>DNS</acronym> será <systemitem class="fqdomainname">example.org</systemitem>.</para>
      </listitem>

      <listitem>
	<para>O realm <application>Kerberos</application> será <literal>EXAMPLE.ORG</literal>.</para>
      </listitem>
    </itemizedlist>

    <note>
      <para>Use nomes de domínio reais ao configurar o <application>Kerberos</application>, mesmo que ele seja executado internamente. Isso evita problemas de <acronym>DNS</acronym> e garante a interoperabilidade com outros realms do <application>Kerberos</application>.</para>
    </note>

    <sect2>
      <title>Configurando um <acronym>KDC</acronym> do Heimdal</title>

      <indexterm><primary>Kerberos5</primary> <secondary>Key Distribution Center</secondary></indexterm>

      <para>O Centro de Distribuição de Chaves (<acronym>KDC</acronym>) é o serviço de autenticação centralizada que o <application>Kerberos</application> fornece, a <quote>a parte de terceiros confiáveis</quote> do sistema. É o computador que emite os tíquetes <application>Kerberos</application>, que são usados para autenticação dos clientes nos servidores. Como o <acronym>KDC</acronym> é considerado confiável por todos os outros computadores no realm do <application>Kerberos</application>, isso aumenta as preocupações com a segurança. O acesso direto ao KDC deve ser limitado.</para>

      <para>Embora a execução de um <acronym>KDC</acronym> exija poucos recursos de computação, uma máquina dedicada que atua apenas como um <acronym>KDC</acronym> é recomendada por motivos de segurança.</para>

      <para>Para começar, instale o pacote <package>security/heimdal</package> assim:</para>

      <screen><prompt>#</prompt> <userinput>pkg install heimdal</userinput></screen>

      <para>Em seguida, edite o <filename>/etc/rc.conf</filename> como a seguir:</para>

      <screen><prompt>#</prompt> <userinput>sysrc kdc_enable=yes</userinput>
<prompt>#</prompt> <userinput>sysrc kadmind_enable=yes</userinput></screen>

      <para>Em seguida, edite o arquivo <filename>/etc/krb5.conf</filename> como a seguir:</para>

      <programlisting>[libdefaults]
    default_realm = <replaceable>EXAMPLE.ORG</replaceable>
[realms]
    <replaceable>EXAMPLE.ORG</replaceable> = {
	kdc = <replaceable>kerberos.example.org</replaceable>
	admin_server = <replaceable>kerberos.example.org</replaceable>
    }
[domain_realm]
    <replaceable>.example.org</replaceable> = <replaceable>EXAMPLE.ORG</replaceable></programlisting>

      <para>Neste exemplo, o <acronym>KDC</acronym> usará o nome completo do host <systemitem class="fqdomainname">kerberos.example.org</systemitem>. O nome do host do KDC precisa ser resolvido no <acronym>DNS</acronym>.</para>

      <para>O <application>Kerberos</application> também pode usar o <acronym>DNS</acronym> para localizar os KDCs, em vez de uma seção <literal>[realms]</literal> no arquivo <filename>/etc/krb5.conf</filename>. Para grandes organizações que possuem seus próprios servidores <acronym>DNS</acronym>, o exemplo acima pode ser reduzido para:</para>

      <programlisting>[libdefaults]
      default_realm = <replaceable>EXAMPLE.ORG</replaceable>
[domain_realm]
    <replaceable>.example.org</replaceable> = <replaceable>EXAMPLE.ORG</replaceable></programlisting>

      <para>Com as seguintes linhas sendo incluídas no arquivo de zona do domínio <systemitem class="fqdomainname">example.org</systemitem>:</para>

      <programlisting>_kerberos._udp      IN  SRV     01 00 88 <replaceable>kerberos.example.org</replaceable>.
_kerberos._tcp      IN  SRV     01 00 88 <replaceable>kerberos.example.org</replaceable>.
_kpasswd._udp       IN  SRV     01 00 464 <replaceable>kerberos.example.org</replaceable>.
_kerberos-adm._tcp  IN  SRV     01 00 749 <replaceable>kerberos.example.org</replaceable>.
_kerberos           IN  TXT     <replaceable>EXAMPLE.ORG</replaceable></programlisting>

      <note>
	<para>Para que os clientes possam encontrar os serviços <application>Kerberos</application>, eles <emphasis>devem</emphasis> ter um <filename>/etc/krb5.conf</filename> totalmente configurado ou um <filename>/etc/krb5.conf</filename> minimamente configurado  <emphasis>e</emphasis> um servidor <acronym>DNS</acronym> corretamente configurado.</para>
      </note>

      <para>Em seguida, crie o banco de dados do <application>Kerberos</application> que contém as chaves de todos os principals (usuários e hosts) criptografados com uma senha master. Não é necessário lembrar essa senha, pois ela será armazenada no arquivo <filename>/var/heimdal/m-key</filename>; Seria razoável usar uma senha aleatória de 45 caracteres para essa finalidade. Para criar a chave master, execute <command>kstash</command> e digite uma senha:</para>

      <screen><prompt>#</prompt> <userinput>kstash</userinput>
Master key: <userinput><replaceable>xxxxxxxxxxxxxxxxxxxxxxx</replaceable></userinput>
Verifying password - Master key: <userinput><replaceable>xxxxxxxxxxxxxxxxxxxxxxx</replaceable></userinput></screen>

      <para>Depois que a chave master é criada, o banco de dados deve ser inicializado. A ferramenta administrativa do <application>Kerberos</application> <citerefentry><refentrytitle>kadmin</refentrytitle><manvolnum>8</manvolnum></citerefentry> pode ser usada no KDC em um modo que opera diretamente no banco de dados, sem usar o serviço de rede <citerefentry><refentrytitle>kadmind</refentrytitle><manvolnum>8</manvolnum></citerefentry>, como <command>kadmin -l</command>. Isso resolve o problema do ovo e da galinha de tentar se conectar ao banco de dados antes de criá-lo. No prompt do <command>kadmin</command>, use o <command>init</command> para criar o banco de dados inicial do realm:</para>

      <screen><prompt>#</prompt> <userinput>kadmin -l</userinput>
kadmin&gt; <userinput>init <replaceable>EXAMPLE.ORG</replaceable></userinput>
Realm max ticket life [unlimited]:</screen>

      <para>Por fim, enquanto ainda estiver no <command>kadmin</command>, crie o primeiro principal usando <command>add</command>. Atenha-se às opções padrão para o principal por enquanto, pois elas podem ser alteradas posteriormente com <command>modify</command>. Digite <literal>?</literal> no prompt para ver as opções disponíveis.</para>

      <screen>kadmin&gt; <userinput>add tillman</userinput>
Max ticket life [unlimited]:
Max renewable life [unlimited]:
Principal expiration time [never]:
Password expiration time [never]:
Attributes []:
Password: <userinput><replaceable>xxxxxxxx</replaceable></userinput>
Verifying password - Password: <userinput><replaceable>xxxxxxxx</replaceable></userinput></screen>

      <para>Em seguida, inicie o serviço <acronym>KDC</acronym> executando:</para>

      <screen><prompt>#</prompt> <userinput>service kdc start</userinput>
<prompt>#</prompt> <userinput>service kadmind start</userinput></screen>

      <para>Embora não tenha nenhum daemon do kerberos em execução neste ponto, é possível confirmar que o <acronym>KDC</acronym> está funcionando obtendo um ticket para o principal que acabou de ser criado:</para>

      <screen><prompt>%</prompt> <userinput>kinit <replaceable>tillman</replaceable></userinput>
tillman@EXAMPLE.ORG's Password:</screen>

      <para>Confirme se um ticket foi obtido com sucesso usando <command>klist</command>:</para>

      <screen><prompt>%</prompt> <userinput>klist</userinput>
Credentials cache: FILE:/tmp/krb5cc_1001
	Principal: tillman@EXAMPLE.ORG

  Issued                Expires               Principal
Aug 27 15:37:58 2013  Aug 28 01:37:58 2013  krbtgt/EXAMPLE.ORG@EXAMPLE.ORG</screen>

      <para>O ticket temporário pode ser destruído quando o teste terminar:</para>

      <screen><prompt>%</prompt> <userinput>kdestroy</userinput></screen>
    </sect2>

    <sect2>
      <title>Configurando um Servidor para Usar o <application>Kerberos</application></title>

      <indexterm><primary>Kerberos5</primary> <secondary>enabling services</secondary></indexterm>

      <para>A primeira etapa na configuração de um servidor para usar a autenticação <application>Kerberos</application> é garantir que ele tenha a configuração correta no arquivo <filename>/etc/krb5.conf</filename>. A versão do <acronym>KDC</acronym> pode ser usada como está, ou pode ser regenerada no novo sistema.</para>

      <para>Em seguida, crie o arquivo <filename>/etc/krb5.keytab</filename> no servidor. Esta é a parte principal de <quote>Kerberizar</quote> um serviço - ele corresponde a gerar uma chave secreta compartilhada entre o serviço e o <acronym>KDC</acronym>. O segredo é uma chave criptográfica, armazenada em um <quote>keytab</quote>. O keytab contém a chave do host do servidor, que permite que ele e o <acronym>KDC</acronym> verifiquem a identidade um do outro. Ele deve ser transmitido para o servidor de maneira segura, pois a segurança do servidor pode ser quebrada se a chave for tornada pública. Normalmente, o <filename>keytab</filename> é gerado na máquina confiável de um administrador usando o <command>kadmin</command>, e então transferido com segurança para o servidor, por exemplo, com <citerefentry><refentrytitle>scp</refentrytitle><manvolnum>1</manvolnum></citerefentry>; Ele também pode ser criado diretamente no servidor, se isso for consistente com a política de segurança desejada. É muito importante que o keytab seja transmitido para o servidor de forma segura: se a chave for conhecida por outra parte, essa parte pode representar qualquer usuário para o servidor! Usar o <command>kadmin</command> diretamente no servidor é conveniente, porque a entrada para o principal do host no banco de dados do <acronym>KDC</acronym> também é criada usando o <command>kadmin</command>.</para>

      <para>Naturalmente, o <command>kadmin</command> é um serviço kerberizado; um tíquete <application>Kerberos</application> é necessário para autenticar-se no serviço de rede, mas para garantir que o usuário que está executando o <command>kadmin</command> esteja presente (e sua sessão não tenha sido invadida), o <command>kadmin</command> solicitará a senha para obter um novo ticket. O principal autenticando no serviço kadmin deve ter permissão para usar a interface <command>kadmin</command>, conforme especificado no arquivo <filename>/var/heimdal/kadmind.acl</filename>. Veja a seção intitulada <quote>Administração Remota</quote> em <command>info heimdal</command> para detalhes sobre a criação de listas de controle de acesso. Em vez de ativar o acesso remoto ao <command>kadmin</command>, o administrador pode conectar-se com segurança ao <acronym>KDC</acronym> através do console local ou por <citerefentry><refentrytitle>ssh</refentrytitle><manvolnum/></citerefentry> e executar a administração localmente usando o <command>kadmin -l</command>.</para>

      <para>Depois de instalar o arquivo <filename>/etc/krb5.conf</filename>, use o <command>add --random-key</command> no <command>kadmin</command>. Isso adiciona o principal do host do servidor ao banco de dados, mas não extrai uma cópia da chave principal do host para um keytab. Para gerar o keytab, use <command>ext</command> para extrair a chave principal do host do servidor para seu próprio keytab:</para>

      <screen><prompt>#</prompt> <userinput>kadmin</userinput>
kadmin&gt;<userinput> add --random-key host/myserver.example.org</userinput>
Max ticket life [unlimited]:
Max renewable life [unlimited]:
Principal expiration time [never]:
Password expiration time [never]:
Attributes []:
kadmin&gt;<userinput> ext_keytab <replaceable>host/myserver.example.org</replaceable></userinput>
kadmin&gt;<userinput> exit</userinput></screen>

      <para>Note que o <command>ext_keytab</command> por padrão armazena a chave extraída no arquivo <filename>/etc/krb5.keytab</filename>. Isso é bom quando executado no servidor que está sendo kerberizado, mas o argumento <command>--keytab <replaceable>path/to/file</replaceable></command> deve ser usado quando o keytab estiver sendo extraído em outro lugar:</para>

      <screen><prompt>#</prompt> <userinput>kadmin</userinput>
kadmin&gt;<userinput> ext_keytab --keytab=/tmp/example.keytab <replaceable>host/myserver.example.org</replaceable></userinput>
kadmin&gt;<userinput> exit</userinput></screen>

      <para>O keytab pode então ser copiado com segurança para o servidor usando o <citerefentry><refentrytitle>scp</refentrytitle><manvolnum>1</manvolnum></citerefentry> ou uma mídia removível. Certifique-se de especificar um nome de keytab não padrão para evitar a inserção de chaves desnecessárias na keytab do sistema.</para>

      <para>Neste ponto, o servidor pode ler mensagens criptografadas do <acronym>KDC</acronym> usando sua chave compartilhada, armazenada no arquivo <filename>krb5.keytab</filename>. Agora ele está pronto para ativar os serviços de uso do <application>Kerberos</application>. Um dos serviços mais comuns é o <citerefentry><refentrytitle>sshd</refentrytitle><manvolnum>8</manvolnum></citerefentry>, que suporta o <application>Kerberos</application> através do <acronym>GSS-API</acronym>. No arquivo <filename>/etc/ssh/sshd_config</filename>, adicione a linha:</para>

      <programlisting>GSSAPIAuthentication yes</programlisting>

      <para>Depois de fazer essa alteração, o <citerefentry><refentrytitle>sshd</refentrytitle><manvolnum>8</manvolnum></citerefentry> deve ser reiniciado para que a nova configuração tenha efeito: <command>service sshd restart</command>.</para>
    </sect2>

    <sect2>
      <title>Configurando um cliente para usar o <application>Kerberos</application></title>

      <indexterm><primary>Kerberos5</primary> <secondary>configure clients</secondary></indexterm>

      <para>Assim como foi no servidor, o cliente requer configuração no arquivo <filename>/etc/krb5.conf</filename>. Copie o arquivo no local (com segurança) ou insira-o novamente conforme necessário.</para>

      <para>Teste o cliente usando o <command>kinit</command>, <command>klist</command> e <command>kdestroy</command> a partir do cliente para obter, mostrar e excluir um ticket para um principal existente. Os aplicativos <application>Kerberos</application> também devem poder se conectar a servidores habilitados pelo <application>Kerberos</application>. Se isso não funcionar, mas a obtenção de um ticket ocorrer, provavelmente o problema está no servidor e não no cliente ou no <acronym>KDC</acronym>. No caso do  <citerefentry><refentrytitle>ssh</refentrytitle><manvolnum>1</manvolnum></citerefentry> kerberizado, o <acronym>GSS-API</acronym> está desabilitado por padrão, portanto teste usando <command>ssh -o GSSAPIAuthentication=yes <replaceable>hostname</replaceable></command>.</para>

      <para>Ao testar um aplicativo Kerberizado, tente usar um sniffer de pacote, como o <command>tcpdump</command>, para confirmar que nenhuma informação confidencial é enviada sem proteção.</para>

      <para>Várias aplicações <application>Kerberos</application> cliente estão disponíveis. Com o advento de uma ponte para que aplicações usando <acronym>SASL</acronym> para autenticação possam usar mecanismos <acronym>GSS-API</acronym>, grandes classes de aplicativos clientes podem usar o <application>Kerberos</application> para autenticação, de clientes Jabber a clientes <acronym>IMAP</acronym>.</para>

      <indexterm><primary><filename>.k5login</filename></primary></indexterm>

      <indexterm><primary><filename>.k5users</filename></primary></indexterm>

      <para>Os usuários em um realm geralmente têm seu principal <application>Kerberos</application> mapeado para uma conta de usuário local. Ocasionalmente, é necessário conceder acesso a uma conta de usuário local a alguém que não tenha um principal <application>Kerberos</application> correspondente. Por exemplo, <systemitem class="username">tillman@EXAMPLE.ORG</systemitem> pode precisar de acesso à conta de usuário local <systemitem class="username">webdevelopers</systemitem>. Outros diretores também podem precisar de acesso a essa conta local.</para>

      <para>Os arquivos <filename>.k5login</filename> e <filename>.k5users</filename>, colocados no diretório home de um usuário, podem ser usados para resolver este problema. Por exemplo, se o seguinte <filename>.k5login</filename> for colocado no diretório inicial de <systemitem class="username">webdevelopers</systemitem>, os dois principals listados terão acesso a essa conta sem exigir uma senha compartilhada:</para>

      <programlisting>tillman@example.org
jdoe@example.org</programlisting>

      <para>Consulte <citerefentry><refentrytitle>ksu</refentrytitle><manvolnum>1</manvolnum></citerefentry> para obter maiores informações sobre o <filename>.k5users</filename>.</para>
    </sect2>

    <sect2>
      <title>Diferenças com a implementação do <acronym>MIT</acronym></title>

      <para>A principal diferença entre as implementações do <acronym>MIT</acronym> e a Heimdal é que o <command>kadmin</command> tem um conjunto de comandos diferente, mas equivalente, e usa um protocolo diferente. Se o <acronym>KDC</acronym> for <acronym>MIT</acronym>, a versão Heimdal do <command>kadmin</command> não poderá ser usada para administrar o <acronym>KDC</acronym> remotamente, e vice versa.</para>

      <para>Aplicações cliente também podem usar opções de linha de comando ligeiramente diferentes para realizar as mesmas tarefas. Seguir as instruções em <link xlink:href="http://web.mit.edu/Kerberos/www/">http://web.mit.edu/Kerberos/www/</link> é recomendado. Cuidado com os problemas de caminho: o port <acronym>MIT</acronym> é instalado em <filename>/usr/local/</filename> por padrão, e os aplicativos do sistema FreeBSD serão executados em vez das  versões do <acronym>MIT</acronym> se o <envar>PATH</envar> listar os diretórios do sistema primeiro.</para>

      <para>Ao usar o MIT Kerberos como um <acronym>KDC</acronym> no FreeBSD, as seguintes edições também devem ser feitas no <filename>rc.conf</filename>:</para>

      <programlisting>kdc_program="/usr/local/sbin/kdc"
kadmind_program="/usr/local/sbin/kadmind"
kdc_flags=""
kdc_enable="YES"
kadmind_enable="YES"</programlisting>
    </sect2>

    <sect2>
      <title>Dicas, Truques e Solução de Problemas do <application>Kerberos</application></title>

      <para>Ao configurar e solucionar problemas do <application>Kerberos</application>, tenha em mente os seguintes pontos:</para>

      <itemizedlist>
	<listitem>
	  <para>Ao usar o Heimdal ou <acronym>MIT</acronym> <application>Kerberos</application> do ports, certifique-se de que o <envar>PATH</envar> liste as versões do port dos aplicativos clientes antes das versões do sistema.</para>
	</listitem>

	<listitem>
	  <para>Se todos os computadores no realm não tiverem configurações de horário sincronizadas, a autenticação poderá falhar. <xref linkend="network-ntp"/> descreve como sincronizar os relógios usando o <acronym>NTP</acronym>.</para>
	</listitem>

	<listitem>
	  <para>Se o nome do host for alterado, o <systemitem class="username">host/</systemitem> principal deve ser alterado e o keytab atualizado. Isso também se aplica a entradas de keytab especiais como o <systemitem class="username">HTTP/</systemitem> principal usado para o <package>www/mod_auth_kerb</package> do Apache.</para>
	</listitem>

	<listitem>
	  <para>Todos os hosts no realm devem ser resolvidos tanto de forma direta quanto reversa no <acronym>DNS</acronym> ou, no mínimo, no arquivo <filename>/etc/hosts</filename>. Os CNAMEs funcionarão, mas os registros A e PTR devem estar corretos e no lugar. A mensagem de erro para hosts não resolvidos não é intuitiva: <errorname>Kerberos5 refuses authentication because Read req failed: Key table entry not found</errorname>.</para>
	</listitem>

	<listitem>
	  <para>Alguns sistemas operacionais que agem como clientes para o <acronym>KDC</acronym> não definem as permissões para o <command>ksu</command> para serem setuid <systemitem class="username">root</systemitem>. Isso significa que o <command>ksu</command> não funciona. Este é um problema de permissões, não um erro do <acronym>KDC</acronym>.</para>
	</listitem>

	<listitem>
	  <para>Com o <acronym>MIT</acronym> <application>Kerberos</application>, para permitir que um principal tenha uma duração de ticket maior que a duração padrão de dez horas, use <command>modify_principal</command> no <citerefentry><refentrytitle>kadmin</refentrytitle><manvolnum>8</manvolnum></citerefentry> para alterar o <literal>maxlife</literal> do principal em questão e do <systemitem class="username">krbtgt</systemitem> principal. O principal pode então usar o <command>kinit -l</command> para solicitar um ticket com uma vida útil mais longa.</para>
	</listitem>

	<listitem>
	  <para>Ao executar um sniffer de pacotes no <acronym>KDC</acronym> para auxiliar na solução de problemas enquanto executa <command>kinit</command> de uma estação de trabalho, o Ticket de Concessão de Tickets (<acronym>TGT</acronym>) é enviado imediatamente, mesmo antes da digitação da senha. Isso ocorre porque o servidor <application>Kerberos</application> transmite livremente um <acronym>TGT</acronym> para qualquer solicitação não autorizada. No entanto, cada <acronym>TGT</acronym> é criptografado em uma chave derivada da senha do usuário. Quando um usuário digita sua senha, ela não é enviada para o <acronym>KDC</acronym>, ela é usada para descriptografar o <acronym>TGT</acronym> que o <command>kinit</command> já obteve. Se o processo de descriptografia resultar em um tíquete válido com um registro de data e hora válido, o usuário terá credenciais do <application>Kerberos</application> válidas. Essas credenciais incluem uma chave de sessão para estabelecer comunicações seguras com o servidor <application>Kerberos</application> no futuro, bem como o <acronym>TGT</acronym>, que é criptografado com a chave do próprio servidor <application>Kerberos</application>. Essa segunda camada de criptografia permite que o servidor <application>Kerberos</application> verifique a autenticidade de cada <acronym>TGT</acronym>.</para>
	</listitem>

	<listitem>
	  <para>Os principals do host podem ter uma vida útil maior do ticket. Se o usuário do principal tiver uma vida útil de uma semana, mas o host ao qual está conectado tiver uma vida útil de nove horas, o cache do usuário terá um host principal expirado e o cache do ticket não funcionará como esperado.</para>
	</listitem>

	<listitem>
	  <para>Ao configurar o arquivo <filename>krb5.dict</filename> para evitar que senhas incorretas específicas sejam usadas, conforme descrito em <citerefentry><refentrytitle>kadmind</refentrytitle><manvolnum>8</manvolnum></citerefentry>, lembre-que só se aplica a entidades que tenham uma política de senha atribuída a elas. O formato usado em <filename>krb5.dict</filename> é uma string por linha. Criar um link simbólico para <filename>/usr/share/dict/words</filename> pode ser útil.</para>
	</listitem>
      </itemizedlist>
    </sect2>

    <sect2>
      <title>Atenuando as Limitações do <application>Kerberos</application></title>

      <indexterm><primary>Kerberos5</primary> <secondary>limitations and shortcomings</secondary></indexterm>

      <para>Uma vez que com o <application>Kerberos</application> a abordagem é tudo ou nada, cada serviço habilitado na rede deve ser modificado para funcionar com o <application>Kerberos</application> ou ser protegido contra ataques de rede. Isso impede que as credenciais do usuário sejam roubadas e reutilizadas. Um exemplo é quando o <application>Kerberos</application> está habilitado em todos os shells remotos, mas o servidor de email <acronym>POP3</acronym> não-Kerberizado envia senhas em texto simples.</para>

      <para>O <acronym>KDC</acronym> é um ponto único de falha. Por design, o <acronym>KDC</acronym> deve ser tão seguro quanto seu banco de dados de senhas master. O <acronym>KDC</acronym> não deve ter absolutamente nenhum outro serviço sendo executado e deve estar fisicamente seguro. O perigo é alto porque o <application>Kerberos</application> armazena todas as senhas criptografadas com a mesma chave mestra que é armazenada como um arquivo no <acronym>KDC</acronym>.</para>

      <para>Uma chave mestra comprometida não é tão ruim quanto se pode temer. A chave mestra é usada apenas para criptografar o banco de dados do <application>Kerberos</application> e como um seed para o gerador de números aleatórios. Desde que o acesso ao <acronym>KDC</acronym> seja seguro, um invasor não poderá fazer muito com a chave mestra.</para>

      <para>Se o <acronym>KDC</acronym> não estiver disponível, os serviços de rede não poderão ser utilizados, pois a autenticação não poderá ser executada. Isso pode ser mitigado com um único <acronym>KDC</acronym> master e um ou mais slaves, e com a implementação cuidadosa da autenticação secundária ou de fallback usando <acronym>PAM</acronym>.</para>

      <para xml:lang="en"><application>Kerberos</application> allows users, hosts
	and services to authenticate between themselves.  It does not
	have a mechanism to authenticate the
	<acronym>KDC</acronym> to the users, hosts, or services.  This
	means that a trojaned <command>kinit</command> could record
	all user names and passwords.  File system integrity checking
	tools like <package>security/tripwire</package> can
	alleviate this.</para>
    </sect2>

    <sect2>
      <title>Recursos e Outras Informações</title>

      <indexterm><primary>Kerberos5</primary> <secondary>external resources</secondary></indexterm>

      <itemizedlist>
	<listitem>
	  <para><link xlink:href="http://www.faqs.org/faqs/Kerberos-faq/general/preamble.html">A FAQ do <application>Kerberos</application></link></para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://web.mit.edu/Kerberos/www/dialogue.html">Criando um Sistema de Autenticação: um Diálogo em Quatro Cenas</link></para>
	</listitem>

	<listitem>
	  <para><link xlink:href="https://www.ietf.org/rfc/rfc4120.txt">RFC 4120, O Serviço de Autenticação em Rede (V5) do <application>Kerberos</application></link></para>
	</listitem>

	<listitem>
	  <para><link xlink:href="http://web.mit.edu/Kerberos/www/"><acronym>Página Web do </acronym> <application>Kerberos</application> MIT</link></para>
	</listitem>

	<listitem>
	  <para><link xlink:href="https://github.com/heimdal/heimdal/wiki">Página web do Heimdal <application>Kerberos</application></link></para>
	</listitem>
      </itemizedlist>
    </sect2>
  </sect1>

  <sect1 xml:id="openssl">
    <info>
      <title>OpenSSL</title>

      <authorgroup>
	<author><personname><firstname>Tom</firstname><surname>Rhodes</surname></personname><contrib>Escrito por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>security</primary> <secondary>OpenSSL</secondary></indexterm>

    <para>O <application>OpenSSL</application> é uma implementação de software livre dos protocolos <acronym>SSL</acronym> e <acronym>TLS</acronym>. Ele fornece uma camada de transporte de criptografia sobre a camada de comunicação normal, permitindo que ela seja entrelaçada com muitos aplicativos e serviços de rede.</para>

    <para>A versão do <application>OpenSSL</application> incluída no FreeBSD suporta os protocolos de segurança de redes Secure Sockets Layer 3.0 (SSLv3) e Transport Layer Security 1.0/1.1/1.2 (TLSv1/TLSv1.1/TLSv1.2) e pode ser usado como uma biblioteca de criptografia geral. No FreeBSD 12.0-RELEASE e posterior, OpenSSL também suporta Transport Layer Security 1.3 (TLSv1.3).</para>

    <para>O <application>OpenSSL</application> é muitas vezes usado para encriptar a autenticação de clientes de email e proteger transações baseadas na web como pagamentos com cartões de crédito. Alguns ports, como o <package>www/apache24</package> e <package>databases/postgresql11-server</package>, incluem uma opção de compilação para inserir o <application>OpenSSL</application>. Se selecionado, o port vai adicionar suporte ao <application>OpenSSL</application> da base do sistema. Para ter o port compilado com o suporte do <application>OpenSSL</application> do port 
 <package>security/openssl</package>, adicione o seguinte ao arquivo  <filename>/etc/make.conf</filename>:</para>

    <programlisting>DEFAULT_VERSIONS+= ssl=openssl</programlisting>

    <para>Outro uso comum do <application>OpenSSL</application> é fornecer certificados para uso com aplicaçõe de software. Os certificados podem ser usados para verificar as credenciais de uma empresa ou indivíduo. Se um certificado não tiver sido assinado por uma <firstterm>Autoridade de Certificação</firstterm> externa (<acronym> CA </acronym>), como <link xlink:href="http://www.verisign.com">http://www.verisign.com</link>, o aplicativo que usa o certificado produzirá um aviso. Há um custo associado à obtenção de um certificado assinado e o uso de um certificado assinado não é obrigatório, pois os certificados podem ser auto-assinados. No entanto, o uso de uma autoridade externa evitará avisos e poderá deixar os usuários mais à vontade.</para>

    <para>Esta seção demonstra como criar e usar certificados em um sistema FreeBSD. Consulte <xref linkend="ldap-config"/> para um exemplo de como criar uma <acronym>CA</acronym> para assinar seus próprios certificados.</para>

    <para>Para obter maiores informações sobre o <acronym>SSL</acronym>, leia o <link xlink:href="https://www.feistyduck.com/books/openssl-cookbook/">OpenSSL Cookbook </link> gratuito.</para>

    <sect2>
      <title>Gerando Certificados</title>

      <indexterm><primary>OpenSSL</primary> <secondary>certificate generation</secondary></indexterm>

      <para>Para gerar um certificado que será assinado por uma <acronym>CA</acronym> externa, emita o seguinte comando e insira as informações solicitadas nos prompts. Esta informação de entrada será gravada no certificado. No prompt <literal>Common Name</literal>, insira o nome completo para o sistema que usará o certificado. Se esse nome não corresponder ao servidor, a aplicação que estiver verificando o certificado emitirá um aviso para o usuário, tornando a verificação provida pelo certificado inútil.</para>
      <screen><prompt>#</prompt> <userinput>openssl req -new -nodes -out req.pem -keyout cert.key -sha256 -newkey rsa:2048</userinput>
Generating a 2048 bit RSA private key
..................+++
.............................................................+++
writing new private key to 'cert.key'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:<userinput><replaceable>US</replaceable></userinput>
State or Province Name (full name) [Some-State]:<userinput><replaceable>PA</replaceable></userinput>
Locality Name (eg, city) []:<userinput><replaceable>Pittsburgh</replaceable></userinput>
Organization Name (eg, company) [Internet Widgits Pty Ltd]:<userinput><replaceable>My Company</replaceable></userinput>
Organizational Unit Name (eg, section) []:<userinput><replaceable>Systems Administrator</replaceable></userinput>
Common Name (eg, YOUR name) []:<userinput><replaceable>localhost.example.org</replaceable></userinput>
Email Address []:<userinput><replaceable>trhodes@FreeBSD.org</replaceable></userinput>

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:<userinput><replaceable>Another Name</replaceable></userinput></screen>

      <para>Outras opções, como o tempo de expiração e algoritmos de criptografia alternativos, estão disponíveis ao criar um certificado. Uma lista completa de opções é descrita em <citerefentry><refentrytitle>openssl</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</para>

      <para>Este comando irá criar dois arquivos no diretório atual. A solicitação de certificado, <filename>req.pem</filename>, pode ser enviada para uma <acronym>CA</acronym> que validará as credenciais inseridas, assinará a solicitação e retornará o certificado assinado. O segundo arquivo, <filename>cert.key</filename>, é a chave privada do certificado e deve ser armazenado em um local seguro. Se ele cair nas mãos de outros, ele pode ser usado para representar o usuário ou o servidor.</para>

      <para>Como alternativa, se uma assinatura de uma <acronym>CA</acronym> não for necessária, um certificado auto-assinado poderá ser criado. Primeiro, gere a chave <acronym>RSA</acronym>:</para>

      <screen><prompt>#</prompt> <userinput>openssl genrsa -rand -genkey -out cert.key 2048</userinput>
0 semi-random bytes loaded
Generating RSA private key, 2048 bit long modulus
.............................................+++
.................................................................................................................+++
e is 65537 (0x10001)</screen>

      <para>Use essa chave para criar um certificado auto-assinado. Siga os prompts usuais para criar um certificado:</para>

      <screen><prompt>#</prompt> <userinput>openssl req -new -x509 -days 365 -key cert.key -out cert.crt -sha256</userinput>
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:<userinput><replaceable>US</replaceable></userinput>
State or Province Name (full name) [Some-State]:<userinput><replaceable>PA</replaceable></userinput>
Locality Name (eg, city) []:<userinput><replaceable>Pittsburgh</replaceable></userinput>
Organization Name (eg, company) [Internet Widgits Pty Ltd]:<userinput><replaceable>My Company</replaceable></userinput>
Organizational Unit Name (eg, section) []:<userinput><replaceable>Systems Administrator</replaceable></userinput>
Common Name (e.g. server FQDN or YOUR name) []:<userinput><replaceable>localhost.example.org</replaceable></userinput>
Email Address []:<userinput><replaceable>trhodes@FreeBSD.org</replaceable></userinput></screen>

      <para>Isso criará dois novos arquivos no diretório atual: um arquivo de chave privada <filename>cert.key</filename> e o próprio certificado, <filename>cert.crt</filename>. Estes devem ser colocados em um diretório, preferencialmente sob <filename>/etc/ssl/</filename>, que é legível somente pelo <systemitem class="username">root</systemitem>. As permissões de <literal>0700</literal> são apropriadas para esses arquivos e podem ser definidas usando o <command>chmod</command>.</para>
    </sect2>

    <sect2>
      <title>Usando Certificados</title>

      <para>Um uso para um certificado é criptografar conexões do servidor de email <application>Sendmail</application> para evitar o trafego de informações de autenticação em texto não criptografado.</para>

      <note>
	<para>Alguns clientes de email exibirão um erro se o usuário não tiver instalado uma cópia local do certificado. Consulte a documentação incluída com o software para obter maiores informações sobre a instalação do certificado.</para>
      </note>

      <para>No FreeBSD 10.0-RELEASE e posterior, é possível criar um certificado auto-assinado para o <application>Sendmail</application> automaticamente. Para habilitar isso, adicione as seguintes linhas ao arquivo <filename>/etc/rc.conf</filename>:</para>

      <programlisting>sendmail_enable="YES"
sendmail_cert_create="YES"
sendmail_cert_cn="<replaceable>localhost.example.org</replaceable>"</programlisting>

      <para>Isso criará automaticamente um certificado auto-assinado, <filename>/etc/mail/certs/host.cert</filename>, uma chave de assinatura, <filename>/etc/mail/certs/host.key</filename>, e um certificado <acronym>CA</acronym>, <filename>/etc/mail/certs/cacert.pem</filename>. O certificado usará o <literal>Common Name</literal> especificado em <option>sendmail_cert_cn</option>. Depois de salvar as edições, reinicie o <application>Sendmail</application>:</para>

      <screen><prompt>#</prompt> <userinput>service sendmail restart</userinput></screen>

      <para>Se tudo correr bem, não haverá mensagens de erro no arquivo <filename>/var/log/maillog</filename>. Para um teste simples, conecte-se à porta de escuta do servidor de correio usando o <command>telnet</command>:</para>

      <screen><prompt>#</prompt> <userinput>telnet <replaceable>example.com</replaceable> 25</userinput>
Trying 192.0.34.166...
Connected to example.com.
Escape character is '^]'.
220 example.com ESMTP Sendmail 8.14.7/8.14.7; Fri, 18 Apr 2014 11:50:32 -0400 (EDT)
<userinput>ehlo <replaceable>example.com</replaceable></userinput>
250-example.com Hello example.com [192.0.34.166], pleased to meet you
250-ENHANCEDSTATUSCODES
250-PIPELINING
250-8BITMIME
250-SIZE
250-DSN
250-ETRN
250-AUTH LOGIN PLAIN
250-STARTTLS
250-DELIVERBY
250 HELP
<userinput>quit</userinput>
221 2.0.0 example.com closing connection
Connection closed by foreign host.</screen>

      <para>Se a linha <literal>STARTTLS</literal> aparecer na saída, tudo está funcionando corretamente.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="ipsec">
    <info>
      <title><acronym>VPN</acronym> Sobre <acronym>IPsec</acronym></title>

      <authorgroup>
	<author><personname> <firstname>Nik</firstname> <surname>Clayton</surname> </personname> <affiliation> <address>
	      <email>nik@FreeBSD.org</email>
	    </address> </affiliation> <contrib>Escrito por </contrib></author>
      </authorgroup>

      <authorgroup>
	<author><personname> <firstname>Hiten M.</firstname> <surname>Pandya</surname> </personname> <affiliation> <address>
	      <email>hmp@FreeBSD.org</email>
	    </address> </affiliation> <contrib>Escrito por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary><acronym>IPsec</acronym></primary></indexterm>

    <para>O Protocolo de Segurança da Internet (<acronym>IPsec</acronym>) é um conjunto de protocolos que se situam no topo da camada do Protocolo da Internet (<acronym>IP</acronym>). Ele permite que dois ou mais hosts se comuniquem de maneira segura, autenticando e criptografando cada pacote <acronym>IP</acronym> de uma sessão de comunicação. A pilha de rede <acronym>IPsec</acronym> do FreeBSD é baseada na implementação do <link xlink:href="http://www.kame.net/">http://www.kame.net/</link> e suporta as sessões <acronym>IPv4</acronym> e <acronym>IPv6</acronym>.</para>

    <indexterm><primary><acronym>IPsec</acronym></primary> <secondary>ESP</secondary></indexterm>

    <indexterm><primary><acronym>IPsec</acronym></primary> <secondary>AH</secondary></indexterm>

    <para>O <acronym>IPsec</acronym> é composto pelos seguintes sub-protocolos:</para>

    <itemizedlist>
      <listitem>
	<para><emphasis>Encapsulated Securtity Payload (<acronym>ESP</acronym>)</emphasis>: este protocolo protege os dados do pacote <acronym>IP</acronym> da interferência de terceiros, criptografando o conteúdo usando algoritmos de criptografia simétricos, como Blowfish e <acronym>3DES</acronym>.</para>
      </listitem>

      <listitem>
	<para><emphasis>Authentication Header (<acronym>AH</acronym>) </emphasis>: este protocolo protege o cabeçalho do pacote <acronym>IP</acronym> da interferência e spoofing de terceiros calculando um checksum criptográfico e gerando o hash  dos campos de cabeçalho do pacote <acronym>IP</acronym> com uma função de hash segura. Isso é seguido por um cabeçalho adicional que contém o hash, para permitir que as informações no pacote sejam autenticadas.</para>
      </listitem>

      <listitem>
	<para><emphasis>IP Payload Compression Protocol (<acronym>IPComp</acronym>):</emphasis> este protocolo tenta aumentar o desempenho da comunicação comprimindo o payload <acronym>IP</acronym> para reduzir a quantidade de dados enviados .</para>
      </listitem>
    </itemizedlist>

    <para>Esses protocolos podem ser usados juntos ou separadamente, dependendo do ambiente.</para>

    <indexterm><primary><acronym>VPN</acronym></primary></indexterm>

    <indexterm><primary>virtual private network</primary> <see>VPN</see></indexterm>

    <para>O <acronym>IPsec</acronym> suporta dois modos de operação. O primeiro modo, <firstterm>Modo de Transporte</firstterm>, protege as comunicações entre dois hosts. O segundo modo, <firstterm>Modo de túnel</firstterm>, é usado para construir túneis virtuais, comumente conhecidos como redes privadas virtuais (<acronym>VPN</acronym>s). Consulte <citerefentry><refentrytitle>ipsec</refentrytitle><manvolnum>4</manvolnum></citerefentry> para obter informações detalhadas sobre o subsistema <acronym>IPsec</acronym> no FreeBSD.</para>

    <para>O suporte a <acronym>IPsec</acronym> é ativado por padrão no FreeBSD 11 e posteriores. Para versões anteriores do FreeBSD, adicione estas opções a um arquivo de configuração de kernel personalizado e recompile o kernel usando as instruções em <xref linkend="kernelconfig"/>:</para>

    <indexterm><primary>kernel options</primary> <secondary>IPSEC</secondary></indexterm>

    <screen>options   IPSEC        #IP security
device    crypto</screen>

    <indexterm><primary>kernel options</primary> <secondary>IPSEC_DEBUG</secondary></indexterm>

    <para>Se o suporte a depuração do <acronym>IPsec</acronym> for desejado, a seguinte opção de kernel também deve ser adicionada:</para>

    <screen>options   IPSEC_DEBUG  #debug for IP security</screen>

    <para>Este restante deste capítulo demonstra o processo de configuração de uma <acronym>VPN</acronym> <acronym>IPsec</acronym> entre uma rede doméstica e uma rede corporativa. No cenário de exemplo:</para>

    <itemizedlist>
      <listitem>
	<para>Ambos os sites estão conectados à Internet através de um gateway que está executando o FreeBSD.</para>
      </listitem>

      <listitem>
	<para>O gateway em cada rede tem pelo menos um endereço <acronym>IP</acronym> externo. Neste exemplo, o endereço <acronym>IP</acronym> externo da <acronym>LAN</acronym> corporativa é <systemitem class="ipaddress">172.16.5.4</systemitem> e  o <acronym>IP</acronym> externo
 da <acronym>LAN</acronym> doméstica é <systemitem class="ipaddress">192.168.1.12</systemitem>.</para>
      </listitem>

      <listitem>
	<para>Os endereços internos das duas redes podem ser endereços <acronym>IP</acronym>  públicos ou privados. No entanto, o espaço de endereço não deve colidir. Por exemplo, ambas as redes não podem usar <systemitem class="ipaddress">192.168.1.x</systemitem>. Neste exemplo, o endereço <acronym>IP</acronym> interno da <acronym>LAN</acronym> corporativa é <systemitem class="ipaddress">10.246.38.1</systemitem> e o endereço do <acronym>IP</acronym> interno da <acronym>LAN</acronym> doméstica é <systemitem class="ipaddress">10.0.0.5</systemitem>.</para>
      </listitem>
    </itemizedlist>

    <sect2>
      <info>
	<title>Configurando uma <acronym>VPN</acronym> no FreeBSD</title>

	<authorgroup>
	  <author><personname> <firstname>Tom</firstname> <surname>Rhodes</surname> </personname> <affiliation> <address>
		<email>trhodes@FreeBSD.org</email>
	      </address> </affiliation> <contrib>Escrito por </contrib></author>
	</authorgroup>
      </info>

      <para>Para começar, o <package>security/ipsec-tools</package> deve ser instalado a partir da Coleção de Ports. Este software fornece várias aplicações que suportam a configuração.</para>

      <para>O próximo requisito é criar dois pseudo-dispositivos <citerefentry><refentrytitle>gif</refentrytitle><manvolnum>4</manvolnum></citerefentry> que serão usados para encapsular pacotes e permitir que ambas as redes se comuniquem adequadamente. Como <systemitem class="username">root</systemitem>, execute os seguintes comandos, substituindo <replaceable>internal</replaceable> e <replaceable>external</replaceable> pelos endereços IP reais das interfaces internas e externas dos dois gateways:</para>

      <screen><prompt>#</prompt> <userinput>ifconfig gif0 create</userinput>
<prompt>#</prompt> <userinput>ifconfig gif0 <replaceable>internal1 internal2</replaceable></userinput>
<prompt>#</prompt> <userinput>ifconfig gif0 tunnel <replaceable>external1 external2</replaceable></userinput></screen>

      <para>Verifique a configuração em cada gateway, usando o <command>ifconfig</command>. Aqui está a saída do Gateway 1:</para>

      <programlisting>gif0: flags=8051 mtu 1280
tunnel inet 172.16.5.4 --&gt; 192.168.1.12
inet6 fe80::2e0:81ff:fe02:5881%gif0 prefixlen 64 scopeid 0x6
inet 10.246.38.1 --&gt; 10.0.0.5 netmask 0xffffff00</programlisting>

      <para>Aqui está a saída do Gateway 2:</para>

      <programlisting>gif0: flags=8051 mtu 1280
tunnel inet 192.168.1.12 --&gt; 172.16.5.4
inet 10.0.0.5 --&gt; 10.246.38.1 netmask 0xffffff00
inet6 fe80::250:bfff:fe3a:c1f%gif0 prefixlen 64 scopeid 0x4</programlisting>

      <para>Depois de concluídos, os dois endereços de <acronym>IP</acronym> internos devem ser acessados usando <citerefentry><refentrytitle>ping</refentrytitle><manvolnum>8</manvolnum></citerefentry>:</para>

      <screen>priv-net<prompt>#</prompt> <userinput>ping 10.0.0.5</userinput>
PING 10.0.0.5 (10.0.0.5): 56 data bytes
64 bytes from 10.0.0.5: icmp_seq=0 ttl=64 time=42.786 ms
64 bytes from 10.0.0.5: icmp_seq=1 ttl=64 time=19.255 ms
64 bytes from 10.0.0.5: icmp_seq=2 ttl=64 time=20.440 ms
64 bytes from 10.0.0.5: icmp_seq=3 ttl=64 time=21.036 ms
--- 10.0.0.5 ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss
round-trip min/avg/max/stddev = 19.255/25.879/42.786/9.782 ms</screen>

      <screen>corp-net<prompt>#</prompt> <userinput>ping 10.246.38.1</userinput>
PING 10.246.38.1 (10.246.38.1): 56 data bytes
64 bytes from 10.246.38.1: icmp_seq=0 ttl=64 time=28.106 ms
64 bytes from 10.246.38.1: icmp_seq=1 ttl=64 time=42.917 ms
64 bytes from 10.246.38.1: icmp_seq=2 ttl=64 time=127.525 ms
64 bytes from 10.246.38.1: icmp_seq=3 ttl=64 time=119.896 ms
64 bytes from 10.246.38.1: icmp_seq=4 ttl=64 time=154.524 ms
--- 10.246.38.1 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 28.106/94.594/154.524/49.814 ms</screen>

      <para>Como esperado, ambos os lados têm a capacidade de enviar e receber pacotes <acronym>ICMP</acronym> dos endereços configurados de forma privada. Em seguida, os dois gateways devem ser informados sobre como rotear pacotes para enviar corretamente o tráfego de qualquer rede. Os seguintes comandos atingirão esse objetivo:</para>

      <screen>corp-net<prompt>#</prompt> <userinput>route add <replaceable>10.0.0.0 10.0.0.5 255.255.255.0</replaceable></userinput>
corp-net<prompt>#</prompt> <userinput>route add net <replaceable>10.0.0.0: gateway 10.0.0.5</replaceable></userinput></screen>

      <screen>priv-net<prompt>#</prompt> <userinput>route add <replaceable>10.246.38.0 10.246.38.1 255.255.255.0</replaceable></userinput>
priv-net<prompt>#</prompt> <userinput>route add host <replaceable>10.246.38.0: gateway 10.246.38.1</replaceable></userinput></screen>

      <para>Neste ponto, as máquinas internas devem ser alcançadas de cada gateway, bem como das máquinas atrás dos gateways. Novamente, use o <citerefentry><refentrytitle>ping</refentrytitle><manvolnum>8</manvolnum></citerefentry> para confirmar:</para>

      <screen>corp-net<prompt>#</prompt> <userinput>ping 10.0.0.8</userinput>
PING 10.0.0.8 (10.0.0.8): 56 data bytes
64 bytes from 10.0.0.8: icmp_seq=0 ttl=63 time=92.391 ms
64 bytes from 10.0.0.8: icmp_seq=1 ttl=63 time=21.870 ms
64 bytes from 10.0.0.8: icmp_seq=2 ttl=63 time=198.022 ms
64 bytes from 10.0.0.8: icmp_seq=3 ttl=63 time=22.241 ms
64 bytes from 10.0.0.8: icmp_seq=4 ttl=63 time=174.705 ms
--- 10.0.0.8 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 21.870/101.846/198.022/74.001 ms</screen>

      <screen>priv-net<prompt>#</prompt> <userinput>ping 10.246.38.107</userinput>
PING 10.246.38.1 (10.246.38.107): 56 data bytes
64 bytes from 10.246.38.107: icmp_seq=0 ttl=64 time=53.491 ms
64 bytes from 10.246.38.107: icmp_seq=1 ttl=64 time=23.395 ms
64 bytes from 10.246.38.107: icmp_seq=2 ttl=64 time=23.865 ms
64 bytes from 10.246.38.107: icmp_seq=3 ttl=64 time=21.145 ms
64 bytes from 10.246.38.107: icmp_seq=4 ttl=64 time=36.708 ms
--- 10.246.38.107 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 21.145/31.721/53.491/12.179 ms</screen>

      <para>Configurar os túneis é a parte fácil. Configurar um link seguro é um processo mais aprofundado. A seguinte configuração usa chaves <acronym>RSA</acronym> pré-compartilhadas (<acronym>PSK</acronym>). Além dos endereços <acronym>IP</acronym>, o arquivo <filename>/usr/local/etc/racoon/racoon.conf</filename> em ambos os gateways será idêntico e será semelhante a:</para>

      <programlisting>path    pre_shared_key  "/usr/local/etc/racoon/psk.txt"; #location of pre-shared key file
log     debug;	#log verbosity setting: set to 'notify' when testing and debugging is complete

padding	# options are not to be changed
{
        maximum_length  20;
        randomize       off;
        strict_check    off;
        exclusive_tail  off;
}

timer	# timing options. change as needed
{
        counter         5;
        interval        20 sec;
        persend         1;
#       natt_keepalive  15 sec;
        phase1          30 sec;
        phase2          15 sec;
}

listen	# address [port] that racoon will listen on
{
        isakmp          172.16.5.4 [500];
        isakmp_natt     172.16.5.4 [4500];
}

remote  192.168.1.12 [500]
{
        exchange_mode   main,aggressive;
        doi             ipsec_doi;
        situation       identity_only;
        my_identifier   address 172.16.5.4;
        peers_identifier        address 192.168.1.12;
        lifetime        time 8 hour;
        passive         off;
        proposal_check  obey;
#       nat_traversal   off;
        generate_policy off;

                        proposal {
                                encryption_algorithm    blowfish;
                                hash_algorithm          md5;
                                authentication_method   pre_shared_key;
                                lifetime time           30 sec;
                                dh_group                1;
                        }
}

sainfo  (address 10.246.38.0/24 any address 10.0.0.0/24 any)	# address $network/$netmask $type address $network/$netmask $type ( $type being any or esp)
{								# $network must be the two internal networks you are joining.
        pfs_group       1;
        lifetime        time    36000 sec;
        encryption_algorithm    blowfish,3des;
        authentication_algorithm        hmac_md5,hmac_sha1;
        compression_algorithm   deflate;
}</programlisting>

      <para>Para descrições de cada opção disponível, consulte a página de manual do <filename>racoon.conf</filename>.</para>

      <para>O Banco de Dados da Política de Segurança (<acronym>SPD</acronym>) precisa ser configurado para que o FreeBSD e o <application>racoon</application> consigam criptografar e descriptografar o tráfego de rede entre os hosts.</para>

      <para>Isso pode ser obtido com um shell script, semelhante ao seguinte, no gateway corporativo. Este arquivo será usado durante a inicialização do sistema e deve ser salvo como <filename>/usr/local/etc/racoon/setkey.conf</filename>.</para>

      <programlisting>flush;
spdflush;
# To the home network
spdadd 10.246.38.0/24 10.0.0.0/24 any -P out ipsec esp/tunnel/172.16.5.4-192.168.1.12/use;
spdadd 10.0.0.0/24 10.246.38.0/24 any -P in ipsec esp/tunnel/192.168.1.12-172.16.5.4/use;</programlisting>

      <para>Uma vez que o arquivo estiver no seu lugar, o <application>racoon</application> pode ser iniciado em ambos os gateways usando o seguinte comando:</para>

      <screen><prompt>#</prompt> <userinput>/usr/local/sbin/racoon -F -f /usr/local/etc/racoon/racoon.conf -l /var/log/racoon.log</userinput></screen>

      <para>A saída deve ser semelhante à seguinte:</para>

      <screen>corp-net<prompt>#</prompt> <userinput>/usr/local/sbin/racoon -F -f /usr/local/etc/racoon/racoon.conf</userinput>
Foreground mode.
2006-01-30 01:35:47: INFO: begin Identity Protection mode.
2006-01-30 01:35:48: INFO: received Vendor ID: KAME/racoon
2006-01-30 01:35:55: INFO: received Vendor ID: KAME/racoon
2006-01-30 01:36:04: INFO: ISAKMP-SA established 172.16.5.4[500]-192.168.1.12[500] spi:623b9b3bd2492452:7deab82d54ff704a
2006-01-30 01:36:05: INFO: initiate new phase 2 negotiation: 172.16.5.4[0]192.168.1.12[0]
2006-01-30 01:36:09: INFO: IPsec-SA established: ESP/Tunnel 192.168.1.12[0]-&gt;172.16.5.4[0] spi=28496098(0x1b2d0e2)
2006-01-30 01:36:09: INFO: IPsec-SA established: ESP/Tunnel 172.16.5.4[0]-&gt;192.168.1.12[0] spi=47784998(0x2d92426)
2006-01-30 01:36:13: INFO: respond new phase 2 negotiation: 172.16.5.4[0]192.168.1.12[0]
2006-01-30 01:36:18: INFO: IPsec-SA established: ESP/Tunnel 192.168.1.12[0]-&gt;172.16.5.4[0] spi=124397467(0x76a279b)
2006-01-30 01:36:18: INFO: IPsec-SA established: ESP/Tunnel 172.16.5.4[0]-&gt;192.168.1.12[0] spi=175852902(0xa7b4d66)</screen>

      <para>Para garantir que o túnel esteja funcionando corretamente, mude para outro console e use o <citerefentry><refentrytitle>tcpdump</refentrytitle><manvolnum>1</manvolnum></citerefentry> para exibir o tráfego de rede usando o comando a seguir. Substitua <literal>em0</literal> pela placa de interface de rede conforme necessário:</para>

      <screen><prompt>#</prompt> <userinput>tcpdump -i em0 host <replaceable>172.16.5.4 and dst 192.168.1.12</replaceable></userinput></screen>

      <para>Dados semelhantes aos seguintes devem aparecer no console. Caso contrário, há um problema e a depuração dos dados retornados será necessária.</para>

      <programlisting>01:47:32.021683 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xa)
01:47:33.022442 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xb)
01:47:34.024218 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xc)</programlisting>

      <para>Neste ponto, as duas redes devem estar disponíveis e parecem fazer parte da mesma rede. Muito provavelmente ambas as redes estão protegidas por um firewall. Para permitir que o tráfego flua entre elas, regras precisam ser adicionadas para liberar a passagem dos pacotes. Para o firewall <citerefentry><refentrytitle>ipfw</refentrytitle><manvolnum>8</manvolnum></citerefentry>, adicione as seguintes linhas ao arquivo de configuração do firewall:</para>

      <programlisting>ipfw add 00201 allow log esp from any to any
ipfw add 00202 allow log ah from any to any
ipfw add 00203 allow log ipencap from any to any
ipfw add 00204 allow log udp from any 500 to any</programlisting>

      <note>
	<para>Os números das regras podem precisar ser alterados dependendo da configuração atual do host.</para>
      </note>

      <para>Para usuários do <citerefentry><refentrytitle>pf</refentrytitle><manvolnum>4</manvolnum> </citerefentry> ou do <citerefentry><refentrytitle>ipf</refentrytitle><manvolnum>8</manvolnum></citerefentry> , as seguintes regras devem fazer o truque:</para>

      <programlisting>pass in quick proto esp from any to any
pass in quick proto ah from any to any
pass in quick proto ipencap from any to any
pass in quick proto udp from any port = 500 to any port = 500
pass in quick on gif0 from any to any
pass out quick proto esp from any to any
pass out quick proto ah from any to any
pass out quick proto ipencap from any to any
pass out quick proto udp from any port = 500 to any port = 500
pass out quick on gif0 from any to any</programlisting>

      <para>Finalmente, para permitir que a máquina inicie o suporte para a <acronym>VPN</acronym> durante a inicialização do sistema, adicione as seguintes linhas ao arquivo <filename>/etc/rc.conf</filename>:</para>

      <programlisting>ipsec_enable="YES"
ipsec_program="/usr/local/sbin/setkey"
ipsec_file="/usr/local/etc/racoon/setkey.conf" # allows setting up spd policies on boot
racoon_enable="yes"</programlisting>
    </sect2>
  </sect1>

  <sect1 xml:id="openssh">
    <info>
      <title>OpenSSH</title>

      <authorgroup>
	<author><personname><firstname>Chern</firstname><surname>Lee</surname></personname><contrib>Contribuído por </contrib></author>
	<!-- 21 April 2001 -->
      </authorgroup>
    </info>

    <indexterm><primary>OpenSSH</primary></indexterm>
    <indexterm><primary>security</primary> <secondary>OpenSSH</secondary></indexterm>

    <para>O <application>OpenSSH</application> é um conjunto de ferramentas de conectividade de rede usadas para fornecer acesso seguro a máquinas remotas. Além disso, as conexões <acronym>TCP/IP</acronym> podem ser encapsuladas ou encaminhadas com segurança através de conexões <acronym>SSH</acronym>. O <application>OpenSSH</application> criptografa todo o tráfego para eliminar efetivamente a interceptação, o sequestro de conexão e outros ataques no nível da rede.</para>

    <para>O <application>OpenSSH</application> é mantido pelo projeto OpenBSD e é instalado por padrão no FreeBSD. É compatível com os protocolos de versão 1 e 2 do <acronym>SSH</acronym>.</para>

    <para>Quando os dados são enviados pela rede em um formato não criptografado, sniffers de rede posicionados em qualquer lugar entre o cliente e o servidor podem roubar as informações do usuário/senha ou os dados transferidos durante a sessão. O <application>OpenSSH</application> oferece uma variedade de métodos de autenticação e criptografia para evitar que isso aconteça. Mais informações sobre o <application>OpenSSH</application> estão disponíveis em <link xlink:href="http://www.openssh.com/">http://www.openssh.com/</link>.</para>

    <para>Esta seção fornece uma visão geral dos utilitários embutidos de cliente para acessar com segurança outros sistemas e transferir arquivos com segurança de um sistema FreeBSD. Em seguida, descreve como configurar um servidor <acronym>SSH</acronym> em um sistema FreeBSD. Maiores informações estão disponíveis nas páginas man mencionadas neste capítulo.</para>

    <sect2>
      <title>Usando os Utilitários de Cliente SSH</title>

      <indexterm><primary>OpenSSH</primary> <secondary>client</secondary></indexterm>

      <para>Para logar em um servidor <acronym>SSH</acronym>, use <command>ssh</command> e especifique um nome de usuário que exista naquele servidor e o endereço 
 <acronym>IP</acronym> ou nome de host do servidor. Se esta for a primeira vez que uma conexão foi feita ao servidor especificado, o usuário será solicitado a primeiro verificar a impressão digital do servidor:</para>

      <screen><prompt>#</prompt> <userinput>ssh <replaceable>user@example.com</replaceable></userinput>
The authenticity of host 'example.com (10.0.0.1)' can't be established.
ECDSA key fingerprint is 25:cc:73:b5:b3:96:75:3d:56:19:49:d2:5c:1f:91:3b.
Are you sure you want to continue connecting (yes/no)? <userinput>yes</userinput>
Permanently added 'example.com' (ECDSA) to the list of known hosts.
Password for user@example.com: <userinput><replaceable>user_password</replaceable></userinput></screen>

      <para>O <acronym>SSH</acronym> utiliza um sistema de impressão digital de chaves para verificar a autenticidade do servidor quando o cliente se conecta. Quando o usuário aceita a impressão digital da chave digitando <literal>yes</literal> ao conectar-se pela primeira vez, uma cópia da chave é salva em <filename>.ssh/known_hosts</filename> no diretório pessoal do usuário. Futuras tentativas de login são verificadas em relação à chave salva e o <command>ssh</command> exibirá um alerta se a chave do servidor não corresponder à chave salva. Se isso ocorrer, o usuário deve primeiro verificar por que a chave foi alterada antes de continuar com a conexão.</para>

      <para>Por padrão, versões recentes do <application>OpenSSH</application> aceitam apenas conexões <acronym>SSH</acronym> v2. Por padrão, o cliente usará a versão 2 se possível e voltará para a versão 1 se o servidor não suportar a versão 2. Para forçar o <command>ssh</command> a usar somente o protocolo especificado, inclua <option>-1</option> ou <option>-2</option>. Opções adicionais são descritas em <citerefentry><refentrytitle>ssh</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</para>

      <indexterm><primary>OpenSSH</primary> <secondary>secure copy</secondary></indexterm>
      <indexterm><primary><citerefentry><refentrytitle>scp</refentrytitle><manvolnum>1</manvolnum></citerefentry></primary></indexterm>

      <para>Use o <citerefentry><refentrytitle>scp</refentrytitle><manvolnum>1</manvolnum></citerefentry> para copiar com segurança um arquivo para ou de uma máquina remota. Este exemplo copia o arquivo <filename>COPYRIGHT</filename> do sistema remoto para um arquivo com o mesmo nome no diretório atual do sistema local:</para>

      <screen><prompt>#</prompt> <userinput>scp <replaceable>user@example.com:/COPYRIGHT COPYRIGHT</replaceable></userinput>
Password for user@example.com: <userinput><replaceable>*******</replaceable></userinput>
COPYRIGHT            100% |*****************************|  4735
00:00
<prompt>#</prompt></screen>

      <para>Como a impressão digital já foi verificada para esse host, a chave do servidor é verificada automaticamente antes de solicitar a senha do usuário.</para>

      <para>Os argumentos passados para o <command>scp</command> são semelhantes ao comando <command>cp</command>. O arquivo ou arquivos para copiar é o primeiro argumento e o destino para copiar é o segundo. Como o arquivo é buscado pela rede, um ou mais dos argumentos do arquivo assumem o formato <option>user@host:&lt;path_to_remote_file&gt;</option>. Esteja ciente ao copiar recursivamente diretórios que o <command>scp</command> usa a opção <option>-r</option>, enquanto <command>cp</command> usa a <option>-R</option>.</para>

      <para>Para abrir uma sessão interativa para copiar arquivos, use o <command>sftp</command>. Consulte <citerefentry><refentrytitle>sftp</refentrytitle><manvolnum>1</manvolnum></citerefentry> para obter uma lista de comandos disponíveis enquanto estiver em uma sessão <command>sftp</command>.</para>

      <sect3 xml:id="security-ssh-keygen">
	<title>Autenticação Baseada em Chave</title>

	<para>Em vez de usar senhas, um cliente pode ser configurado para se conectar à máquina remota usando chaves. Para gerar chaves de autenticação <acronym>RSA</acronym>, use o <command>ssh-keygen</command>. Para gerar um par de chaves pública e privada, especifique o tipo de chave e siga os prompts. Recomenda-se proteger as chaves com uma senha memorável, mas difícil de se adivinhar.</para>

	<screen><prompt>%</prompt> <userinput>ssh-keygen -t rsa</userinput>
Generating public/private rsa key pair.
Enter file in which to save the key (/home/user/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):  <co xml:id="co-ssh-keygen-passphrase1"/>
Enter same passphrase again:                 <co xml:id="co-ssh-keygen-passphrase2"/>
Your identification has been saved in /home/user/.ssh/id_rsa.
Your public key has been saved in /home/user/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:54Xm9Uvtv6H4NOo6yjP/YCfODryvUU7yWHzMqeXwhq8 user@host.example.com
The key's randomart image is:
+---[RSA 2048]----+
|                 |
|                 |
|                 |
|        . o..    |
|       .S*+*o    |
|      . O=Oo . . |
|       = Oo= oo..|
|      .oB.* +.oo.|
|       =OE**.o..=|
+----[SHA256]-----+</screen>

	<calloutlist>
	  <callout arearefs="co-ssh-keygen-passphrase1">
	    <para>Digite uma senha aqui. Pode conter espaços e símbolos.</para>
	  </callout>

	  <callout arearefs="co-ssh-keygen-passphrase2">
	    <para>Digite novamente a senha para verificá-la.</para>
	  </callout>
	</calloutlist>


	<para>A chave privada é armazenada no arquivo <filename>~/.ssh/id_rsa</filename> e a chave pública é armazenada no arquivo <filename>~/.ssh/id_rsa.pub</filename>. A chave <emphasis>publica</emphasis> deve ser copiada para <filename>~/.ssh/ authorized_keys</filename> na máquina remota para que a autenticação baseada em chave funcione.</para>

	<warning>
	  <para>Muitos usuários acreditam que as chaves são seguras por design e usarão uma chave sem uma senha. Este é um comportamento <emphasis>perigoso</emphasis>. Um administrador pode verificar se um par de chaves está protegido por uma senha, visualizando a chave privada manualmente. Se o arquivo de chave privada contiver a palavra <literal>ENCRYPTED</literal>, o dono da chave está usando uma senha. Além disso, para proteger melhor os usuários finais, o termo <literal>from</literal> pode ser colocado no arquivo de chave pública. Por exemplo, adicionar <literal>from "192.168.10.5"</literal> na frente do prefixo <literal>ssh-rsa</literal> só permitirá que esse usuário específico efetue login a partir desse endereço <acronym>IP</acronym>.</para>
	</warning>

	<para>As opções e arquivos variam de acordo com as diferentes versões do <application>OpenSSH</application>. Para evitar problemas, consulte <citerefentry><refentrytitle>ssh-keygen</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</para>

	<para>Se uma senha for usada, o usuário será solicitado a inserir a senha toda vez que uma conexão for feita ao servidor. Para carregar as chaves de <acronym>SSH</acronym> na memória e remover a necessidade de digitar a senha toda vez, use o <citerefentry><refentrytitle>ssh-agent</refentrytitle><manvolnum>1</manvolnum></citerefentry> e o <citerefentry><refentrytitle>ssh-add</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</para>

	<para>A autenticação é feita pelo <command>ssh-agent</command>, usando as chaves privadas que estão carregadas nele. O <command>ssh-agent</command> pode ser usado para iniciar outro aplicativo como um shell ou um gerenciador de janelas.</para>

	<para>Para usar o <command>ssh-agent</command> em um shell, inicie-o com um shell como um argumento. Adicione a identidade executando <command>ssh-add</command> e inserindo a senha para a chave privada. O usuário então poderá executar o <command>ssh</command> para se conectar em qualquer host que tenha a chave pública correspondente instalada. Por exemplo:</para>

	<screen><prompt>%</prompt> <userinput>ssh-agent <replaceable>csh</replaceable></userinput>
<prompt>%</prompt> <userinput>ssh-add</userinput>
Enter passphrase for key '/usr/home/user/.ssh/id_rsa':  <co xml:id="co-ssh-agent-passphrase"/>
Identity added: /usr/home/user/.ssh/id_rsa (/usr/home/user/.ssh/id_rsa)
<prompt>%</prompt></screen>

	<calloutlist>
	  <callout arearefs="co-ssh-agent-passphrase">
	    <para>Digite a senha para a chave.</para>
	  </callout>
	</calloutlist>

	<para>Para usar o <command>ssh-agent</command> no <application>Xorg</application>, adicione uma entrada para ele em <filename>~/.xinitrc</filename>. Isso fornece os serviços do <command>ssh-agent</command> para todos os programas iniciados no <application>Xorg</application>. Um exemplo do arquivo <filename>~/.xinitrc</filename> pode ter esta aparência:</para>

	<programlisting>exec ssh-agent <replaceable>startxfce4</replaceable></programlisting>

	<para>Isso inicia o <command>ssh-agent</command>, que, por sua vez, ativa o <application>XFCE</application>, sempre que o <application>Xorg</application> é iniciado. Uma vez que o <application>Xorg</application> tenha sido reiniciado para que as mudanças entrem em vigor, execute <command>ssh-add</command> para carregar todas as chaves <acronym>SSH</acronym>.</para>
      </sect3>

      <sect3 xml:id="security-ssh-tunneling">
	<title>Tunelamento <acronym> SSH </acronym></title>

	<indexterm><primary>OpenSSH</primary> <secondary>tunneling</secondary></indexterm>

	<para>O <application>OpenSSH</application> tem a capacidade de criar um tunel para encapsular outro protocolo em uma sessão criptografada.</para>

	<para>O comando a seguir informa ao <command>ssh</command> para criar um túnel para o <application>telnet</application>:</para>

	<screen><prompt>%</prompt> <userinput>ssh -2 -N -f -L <replaceable>5023:localhost:23 user@foo.example.com</replaceable></userinput>
<prompt>%</prompt></screen>

	<para>Este exemplo usa as seguintes opções:</para>

	<variablelist>
	  <varlistentry>
	    <term><option>-2</option></term>

	    <listitem>
	      <para>Força o comando <command>ssh</command> a usar a versão 2 para conectar-se ao servidor.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><option>-N</option></term>

	    <listitem>
	      <para>Indica nenhum comando ou apenas túnel. Se omitido, o <command>ssh</command> inicia uma sessão normal.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><option>-f</option></term>

	    <listitem>
	      <para>Força o comando <command>ssh</command> a ser executado em segundo plano.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><option>-L</option></term>

	    <listitem>
	      <para>Indica um túnel local no formato <replaceable>localport:remotehost:remoteport</replaceable>.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><option>user@foo.example.com</option></term>

	    <listitem>
	      <para>O nome de login para usar no servidor <acronym>SSH</acronym> remoto  especificado.</para>
	    </listitem>
	  </varlistentry>
	</variablelist>

	<para>Um túnel <acronym>SSH</acronym> funciona criando um socket de escuta em <systemitem>localhost</systemitem> na <literal>localport</literal> especificada. Em seguida, ele encaminha quaisquer conexões recebidas em <literal>localport</literal> por meio da conexão <acronym>SSH</acronym> com o <literal>remotehost:remoteport</literal> especificado. No exemplo, a porta <literal>5023</literal> no cliente é encaminhada para a porta <literal>23</literal> na máquina remota. Como a porta 23 é usada pelo <application>telnet</application>, isso cria uma sessão <application>telnet</application> criptografada através de um túnel <acronym>SSH</acronym>.</para>

	<para>Esse método pode ser usado para agrupar qualquer número de protocolos <acronym>TCP</acronym> inseguros, como <acronym>SMTP</acronym>, <acronym>POP3</acronym> e <acronym>FTP</acronym>, como visto nos exemplos a seguir.</para>

	<example>
	  <title>Criar um Túnel Seguro para <acronym>SMTP</acronym></title>

	  <screen><prompt>%</prompt> <userinput>ssh -2 -N -f -L <replaceable>5025:localhost:25 user@mailserver.example.com</replaceable></userinput>
user@mailserver.example.com's password: <userinput>*****</userinput>
<prompt>%</prompt> <userinput>telnet localhost 5025</userinput>
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
220 mailserver.example.com ESMTP</screen>

	  <para>Isso pode ser usado em conjunto com <command>ssh-keygen</command> e contas de usuário adicionais para criar um ambiente de encapsulamento <acronym>SSH</acronym> mais uniforme. As chaves podem ser usadas no lugar de digitar uma senha e os túneis podem ser executados como um usuário separado.</para>
	</example>

	<example>
	  <title>Acesso Seguro de um Servidor <acronym>POP3</acronym></title>

	  <para>Neste exemplo, há um servidor <acronym>SSH</acronym> que aceita conexões de fora. Na mesma rede, existe um servidor de email que executa um servidor <acronym>POP3</acronym>. Para verificar o e-mail de maneira segura, crie uma conexão <acronym>SSH</acronym> com o servidor <acronym>SSH</acronym> e encaminhe para o servidor de e-mail:</para>

	  <screen><prompt>%</prompt> <userinput>ssh -2 -N -f -L <replaceable>2110:mail.example.com:110 user@ssh-server.example.com</replaceable></userinput>
user@ssh-server.example.com's password: <userinput>******</userinput></screen>

	  <para>Quando o túnel estiver ativo e em execução, aponte o cliente de e-mail para enviar solicitações <acronym>POP3</acronym> para <systemitem>localhost</systemitem> na porta 2110. Essa conexão será encaminhada com segurança pelo encapsulamento para <systemitem>mail.example.com</systemitem>.</para>
	</example>

	<example>
	  <title>Ignorando um Firewall</title>

	  <para>Alguns firewalls filtram as conexões de entrada e saída. Por exemplo, um firewall pode limitar o acesso de máquinas remotas às portas 22 e 80 para permitir apenas o <acronym>SSH</acronym> e navegação na web. Isso impede o acesso a qualquer outro serviço que use uma porta diferente de 22 ou 80.</para>

	  <para>A solução é criar uma conexão <acronym>SSH</acronym> com uma máquina fora do firewall da rede e usá-la para encapsular o serviço desejado:</para>

	  <screen><prompt>%</prompt> <userinput>ssh -2 -N -f -L <replaceable>8888:music.example.com:8000 user@unfirewalled-system.example.org</replaceable></userinput>
user@unfirewalled-system.example.org's password: <userinput>*******</userinput></screen>

	  <para>Neste exemplo, um cliente Ogg Vorbis de streaming pode agora ser apontado para <systemitem>localhost</systemitem> na porta 8888, que será encaminhado para <systemitem>music.example.com</systemitem> na porta 8000, ignorando com êxito o firewall.</para>
	</example>
      </sect3>
    </sect2>

    <sect2>
      <title>Ativando o Servidor SSH</title>

      <indexterm><primary>OpenSSH</primary> <secondary>enabling</secondary></indexterm>

      <para>Além de fornecer utilitários de cliente <acronym>SSH</acronym> embutidos, um sistema FreeBSD pode ser configurado como um servidor <acronym>SSH</acronym>, aceitando conexões de outros clientes <acronym>SSH</acronym>.</para>

      <para>Para ver se o <application>sshd</application> está operando, use o comando <citerefentry><refentrytitle>service</refentrytitle><manvolnum>8</manvolnum></citerefentry>:</para>

      <screen><prompt>#</prompt> <userinput>service sshd status</userinput></screen>

      <para>Se o serviço não estiver em execução, adicione a seguinte linha ao arquivo <filename>/etc/rc.conf</filename>.</para>

      <programlisting>sshd_enable="YES"</programlisting>

      <para>Isso iniciará o <application>sshd</application>, o programa daemon para o <application>OpenSSH</application>, na próxima vez que o sistema for inicializado. Para iniciá-lo agora:</para>

      <screen><prompt>#</prompt> <userinput>service sshd start</userinput></screen>

      <para>A primeira vez que o <application>sshd</application> inicia em um sistema FreeBSD, as chaves de host do sistema serão criadas automaticamente e a impressão digital será exibida no console. Forneça aos usuários a impressão digital para que eles possam verificá-la na primeira vez que se conectarem ao servidor.</para>

      <para>Consulte o <citerefentry><refentrytitle>sshd</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter a lista de opções disponíveis ao iniciar o <application>sshd</application> e uma discussão mais completa sobre autenticação, processo de login e os vários arquivos de configuração.</para>

      <para>Neste ponto, o <application>sshd</application> deve estar disponível para todos os usuários com um nome de usuário e senha no sistema.</para>
    </sect2>

    <sect2>
      <title>Segurança do Servidor SSH</title>

      <para>Enquanto o <application>sshd</application> é o recurso de administração remota mais usado para o FreeBSD, a força bruta e o drive por ataques são comuns a qualquer sistema exposto a redes públicas. Vários parâmetros adicionais estão disponíveis para evitar o sucesso desses ataques e serão descritos nesta seção.</para>

      <para>É uma boa ideia limitar quais usuários podem efetuar login no servidor <acronym>SSH</acronym> e de onde usar a palavra-chave <literal>AllowUsers</literal> no arquivo de configuração do servidor <application>OpenSSH</application>. Por exemplo, para permitir que somente o <systemitem class="username">root</systemitem> efetue login de <systemitem class="ipaddress">192.168.1.32</systemitem>, inclua esta linha no arquivo <filename>/etc/ssh/sshd_config</filename>:</para>

      <programlisting>AllowUsers root@192.168.1.32</programlisting>

      <para>Para permitir que o usuário <systemitem class="username">admin</systemitem> efetue login de qualquer lugar, liste esse usuário sem especificar um endereço <acronym>IP</acronym>:</para>

      <programlisting>AllowUsers admin</programlisting>

      <para>Multiplos usuários devem ser listados na mesma linha, assim:</para>

      <programlisting>AllowUsers root@192.168.1.32 admin</programlisting>

      <para>Depois de fazer alterações no arquivo <filename>/etc/ssh/sshd_config</filename>, informe o <application>sshd</application> para recarregar seu arquivo de configuração executando:</para>

      <screen><prompt>#</prompt> <userinput>service sshd reload</userinput></screen>

      <note>
	<para>Quando essa palavra-chave é usada, é importante listar cada usuário que precisa efetuar login nesta máquina. Qualquer usuário que não esteja especificado nessa linha será bloqueado. Além disso, as palavras-chave usadas no arquivo de configuração do servidor <application>OpenSSH</application> fazem distinção entre maiúsculas e minúsculas. Se a palavra-chave não estiver escrita corretamente, incluindo esse detalhe, ela será ignorada. Sempre teste as alterações neste arquivo para garantir que as edições estejam funcionando conforme o esperado. Consulte o <citerefentry><refentrytitle>sshd_config</refentrytitle><manvolnum>5</manvolnum></citerefentry> para verificar a ortografia e o uso das palavras-chave disponíveis.</para>
      </note>

      <para>Além disso, os usuários podem ser forçados a usar a autenticação de dois fatores por meio do uso de uma chave pública e privada. Quando necessário, o usuário pode gerar um par de chaves usando o <citerefentry><refentrytitle>ssh-keygen</refentrytitle><manvolnum>1</manvolnum></citerefentry> e enviar ao administrador a chave pública. Este arquivo de chave será colocado no arquivo <filename>authorized_keys</filename> como descrito acima na seção cliente. Para forçar os usuários a usar apenas as chaves, a seguinte opção pode ser configurada:</para>

      <programlisting>AuthenticationMethods publickey</programlisting>

      <tip>
	<para>Não confunda o arquivo <filename>/etc/ssh/sshd_config</filename> com <filename>/etc/ssh/ssh_config</filename> (observe o <literal>d</literal> extra no primeiro nome do arquivo). O primeiro arquivo configura o servidor e o segundo arquivo configura o cliente. Consulte o <citerefentry><refentrytitle>ssh_config</refentrytitle><manvolnum>5</manvolnum></citerefentry> para obter uma listagem das configurações do cliente disponíveis.</para>
      </tip>
    </sect2>
  </sect1>

  <sect1 xml:id="fs-acl">
    <info>
      <title>Listas de Controle de Acesso</title>

      <authorgroup>
	<author><personname><firstname>Tom</firstname><surname>Rhodes</surname></personname><contrib>Contribuído por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>ACL</primary></indexterm>

    <para>As Listas de Controle de Acesso (<acronym>ACL</acronym>s) estendem o modelo de permissão padrão do <trademark class="registered">UNIX</trademark> em um compatível com o modo <trademark class="registered">POSIX</trademark>.1e. Isso permite que um administrador aproveite um modelo de permissões mais refinado.</para>

    <para>O kernel FreeBSD <filename>GENERIC</filename> fornece suporte a <acronym>ACL</acronym> para sistemas de arquivos <acronym>UFS</acronym>. Usuários que preferem compilar um kernel personalizado devem incluir a seguinte opção em seu arquivo de configuração do kernel personalizado:</para>

    <programlisting>options UFS_ACL</programlisting>

    <para>Se esta opção não for ativada na compilação, uma mensagem de aviso será exibida ao tentar montar um sistema de arquivos com o suporte a <acronym>ACL</acronym>. As <acronym>ACL</acronym>s dependem de atributos estendidos que são suportados nativamente pelo <acronym>UFS2</acronym>.</para>

    <para>Este capítulo descreve como ativar o suporte a <acronym>ACL</acronym> e fornece alguns exemplos de uso.</para>

    <sect2>
      <title>Ativando o Suporte a <acronym>ACL</acronym></title>

      <para>As <acronym>ACL</acronym>s são habilitadas pela flag administrativa de tempo de montagem, <option>acls</option>, que podem ser adicionadas ao arquivo <filename>/etc/fstab</filename>. As flags de tempo de montagem também podem ser configuradas automaticamente de forma persistente usando-se o <citerefentry><refentrytitle>tunefs</refentrytitle><manvolnum>8</manvolnum></citerefentry> para modificar um superbloco de flags <acronym>ACL</acronym>s no cabeçalho do sistema de arquivos. Em geral, é preferível usar flags de  superbloco por vários motivos:</para>

      <itemizedlist>
	<listitem>
	  <para>A flag de superbloco não pode ser alterada por um remount usando <option>mount -u</option>, pois requer um <command>umount</command> completo e um <command>mount</command> completo. Isso significa que as <acronym>ACL</acronym>s não podem ser ativadas no sistema de arquivos raiz após a inicialização. Isso também significa que o suporte a <acronym>ACL</acronym> em um sistema de arquivos não pode ser alterado enquanto o sistema estiver em uso.</para>
	</listitem>

	<listitem>
	  <para>Definir a flag de superbloco faz com que o sistema de arquivos seja sempre montado com a <acronym>ACL</acronym> ativada, mesmo que não haja uma entrada no <filename>fstab</filename> ou se os dispositivos forem reordenados. Isso evita a montagem acidental do sistema de arquivos sem o suporte a <acronym>ACL</acronym>.</para>
	</listitem>
      </itemizedlist>

      <note>
	<para>É desejável desencorajar a montagem acidental sem que a <acronym>ACL</acronym> esteja habilitada porque coisas desagradáveis podem acontecer se <acronym>ACL</acronym>s estiverem habilitadas, e então desabilitadas e então reativadas sem limpar os atributos estendidos. Em geral, uma vez que as <acronym>ACL</acronym>s forem habilitadas em um sistema de arquivos, elas não devem ser desabilitadas, pois as proteções de arquivos resultantes podem não ser compatíveis com aquelas pretendidas pelos usuários do sistema e <acronym>ACL</acronym>s reativadas podem reconectar as <acronym>ACL</acronym>s anteriores aos arquivos que tiveram suas permissões alteradas, resultando em um comportamento imprevisível.</para>
      </note>

      <para>Os sistemas de arquivos com a <acronym>ACL</acronym> ativada exibirão um sinal de mais (<literal>+</literal>) nas configurações de permissão:</para>

      <programlisting>drwx------  2 robert  robert  512 Dec 27 11:54 private
drwxrwx---+ 2 robert  robert  512 Dec 23 10:57 directory1
drwxrwx---+ 2 robert  robert  512 Dec 22 10:20 directory2
drwxrwx---+ 2 robert  robert  512 Dec 27 11:57 directory3
drwxr-xr-x  2 robert  robert  512 Nov 10 11:54 public_html</programlisting>

      <para>Neste exemplo, o <filename>directory1</filename>, <filename>directory2</filename> e <filename>directory3</filename> estão todos fazendo uso de <acronym>ACL</acronym>s, enquanto <filename>public_html</filename> não está.</para>
    </sect2>

    <sect2>
      <title>Usando <acronym>ACL</acronym>s</title>

      <para>As <acronym>ACL</acronym>s de um sistema de arquivos podem ser visualizadas usando <command>getfacl</command>. Por exemplo, para visualizar as configurações de <acronym>ACL</acronym> no arquivo <filename>test</filename>:</para>

      <screen><prompt>%</prompt> <userinput>getfacl test</userinput>
	#file:test
	#owner:1001
	#group:1001
	user::rw-
	group::r--
	other::r--</screen>

      <para>Para alterar as configurações de <acronym>ACL</acronym> neste arquivo, use <command>setfacl</command>. Para remover todos os <acronym>ACL</acronym>s atualmente definidos de um arquivo ou sistema de arquivos, inclua <option>-k</option>. No entanto, o método preferido é usar <option>-b</option>, pois ela deixa os campos básicos necessários para que as <acronym>ACL</acronym>s funcionem.</para>

      <screen><prompt>%</prompt> <userinput>setfacl -k test</userinput></screen>

      <para>Para modificar as entradas padrões das <acronym>ACL</acronym>s, use <option>-m</option>:</para>

      <screen><prompt>%</prompt> <userinput>setfacl -m u:trhodes:rwx,group:web:r--,o::--- test</userinput></screen>

      <para>Neste exemplo, não havia entradas predefinidas, pois elas foram removidas pelo comando anterior. Este comando restaura as opções padrões e atribui as opções listadas. Se um usuário ou grupo for adicionado e não existir no sistema, um erro de <errorname>Invalid argument</errorname> será exibido.</para>

      <para>Consulte <citerefentry><refentrytitle>getfacl</refentrytitle><manvolnum>1</manvolnum></citerefentry> e <citerefentry><refentrytitle>setfacl</refentrytitle><manvolnum>1</manvolnum></citerefentry> para maiores informações sobre as opções disponíveis para esses comandos.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="security-pkg">
    <info>
      <title>Monitorando Problemas de Segurança de Terceiros</title>

      <authorgroup>
	<author><personname><firstname>Tom</firstname><surname>Rhodes</surname></personname><contrib>Contribuído por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>pkg</primary></indexterm>

    <para>Nos últimos anos, o mundo da segurança fez muitas melhorias em como a avaliação de vulnerabilidades é tratada. A ameaça de invasão do sistema aumenta à medida que utilitários de terceiros são instalados e configurados para praticamente qualquer sistema operacional disponível atualmente.</para>

    <para>A avaliação de vulnerabilidade é um fator importante na segurança. Enquanto o FreeBSD libera avisos para o sistema base, fazê-lo para cada utilitário de terceiros está além da capacidade do Projeto FreeBSD. Existe uma maneira de mitigar vulnerabilidades de terceiros e avisar os administradores sobre problemas de segurança conhecidos. Um utilitário do FreeBSD conhecido como <application>pkg</application> inclui opções explicitamente para este propósito.</para>

    <para>O <application>pkg</application> pesquisa um banco de dados em busca de problemas de segurança. O banco de dados é atualizado e mantido pela equipe de segurança do FreeBSD e pelos desenvolvedores de ports.</para>

    <para>Por favor, consulte as <link xlink:href="@@URL_RELPREFIX@@/doc/en_US.ISO8859-1/books/handbook/pkgng-intro.html">instruções</link> para instalar o <application>pkg</application>.</para>

    <para>A instalação fornece arquivos de configuração do <citerefentry><refentrytitle>periodic</refentrytitle><manvolnum>8</manvolnum></citerefentry> para manter o banco de dados de auditoria do <application>pkg</application> e fornece um método programático para mantê-lo atualizado . Esta funcionalidade é ativada se <literal>daily_status_security_pkgaudit_enable</literal> estiver definido como <literal>YES</literal> em <citerefentry><refentrytitle>periodic.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry> . Certifique-se de que os e-mails de execução de segurança diários, que são enviados para a conta de e-mail do <systemitem class="username">root</systemitem>, estejam sendo lidos.</para>

    <para>Após a instalação e para auditar utilitários de terceiros como parte da Coleção de Ports a qualquer momento, um administrador pode optar por atualizar o banco de dados e visualizar as vulnerabilidades conhecidas dos pacotes instalados, invocando:</para>

    <screen><prompt>#</prompt> <userinput>pkg audit -F</userinput></screen>

    <para>O <application>pkg</application> exibe as vulnerabilidades publicadas dos pacotes instalados:</para>

    <programlisting>Affected package: cups-base-1.1.22.0_1
Type of problem: cups-base -- HPGL buffer overflow vulnerability.
Reference: &lt;https://www.FreeBSD.org/ports/portaudit/40a3bca2-6809-11d9-a9e7-0001020eed82.html&gt;

1 problem(s) in your installed packages found.

You are advised to update or deinstall the affected package(s) immediately.</programlisting>

    <para>Ao apontar um navegador da web para a <acronym>URL</acronym> exibida, um administrador pode obter mais informações sobre a vulnerabilidade. Isto incluirá as versões afetadas, pela versão do port do FreeBSD, juntamente com outros sites que podem conter avisos de segurança.</para>

    <para>O <application>pkg</application> é um poderoso utilitário e é extremamente útil quando acoplado com o <package>ports-mgmt/portmaster</package>.</para>
  </sect1>

  <sect1 xml:id="security-advisories">
    <info>
      <title>Avisos de Segurança do FreeBSD</title>

      <authorgroup>
	<author><personname><firstname>Tom</firstname><surname>Rhodes</surname></personname><contrib>Contribuído por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>FreeBSD Security Advisories</primary></indexterm>

    <para>Como muitos produtores de sistemas operacionais de qualidade, o Projeto FreeBSD tem uma equipe de segurança responsável por determinar a data de fim de vida (<acronym>EoL</acronym>) para cada versão do FreeBSD e para fornecer atualizações de segurança para versões suportadas que ainda não atingiram sua <acronym>EoL</acronym>. Mais informações sobre a equipe de segurança do FreeBSD e as versões suportadas estão disponíveis na <link xlink:href="@@URL_RELPREFIX@@/security">página de segurança do FreeBSD</link>.</para>

    <para>Uma tarefa da equipe de segurança é responder às vulnerabilidades de segurança reportadas no sistema operacional FreeBSD. Quando uma vulnerabilidade é confirmada, a equipe de segurança verifica as etapas necessárias para corrigir a vulnerabilidade e atualiza o código-fonte com a correção. Em seguida, publica os detalhes como um <quote>Aviso de Segurança</quote>. Os avisos de segurança são publicados no <link xlink:href="@@URL_RELPREFIX@@/security/advisories.html">site do FreeBSD</link> e enviados para as listas de discussão <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-security-notifications">freebsd-security-notifications</link>, <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-security">freebsd-security</link>, e <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-announce">freebsd-announce</link>.</para>

    <para>Esta seção descreve o formato de um alerta de segurança do FreeBSD.</para>

    <sect2>
      <title>Formato de um Comunicado de Segurança</title>

      <para>Aqui está um exemplo de um aviso de segurança do FreeBSD:</para>

      <programlisting>=============================================================================
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

=============================================================================
FreeBSD-SA-14:04.bind                                       Security Advisory
                                                          The FreeBSD Project

Topic:          BIND remote denial of service vulnerability

Category:       contrib
Module:         bind
Announced:      2014-01-14
Credits:        ISC
Affects:        FreeBSD 8.x and FreeBSD 9.x
Corrected:      2014-01-14 19:38:37 UTC (stable/9, 9.2-STABLE)
                2014-01-14 19:42:28 UTC (releng/9.2, 9.2-RELEASE-p3)
                2014-01-14 19:42:28 UTC (releng/9.1, 9.1-RELEASE-p10)
                2014-01-14 19:38:37 UTC (stable/8, 8.4-STABLE)
                2014-01-14 19:42:28 UTC (releng/8.4, 8.4-RELEASE-p7)
                2014-01-14 19:42:28 UTC (releng/8.3, 8.3-RELEASE-p14)
CVE Name:       CVE-2014-0591

For general information regarding FreeBSD Security Advisories,
including descriptions of the fields above, security branches, and the
following sections, please visit &lt;URL:http://security.FreeBSD.org/&gt;.

I.   Background

BIND 9 is an implementation of the Domain Name System (DNS) protocols.
The named(8) daemon is an Internet Domain Name Server.

II.  Problem Description

Because of a defect in handling queries for NSEC3-signed zones, BIND can
crash with an "INSIST" failure in name.c when processing queries possessing
certain properties.  This issue only affects authoritative nameservers with
at least one NSEC3-signed zone.  Recursive-only servers are not at risk.

III. Impact

An attacker who can send a specially crafted query could cause named(8)
to crash, resulting in a denial of service.

IV.  Workaround

No workaround is available, but systems not running authoritative DNS service
with at least one NSEC3-signed zone using named(8) are not vulnerable.

V.   Solution

Perform one of the following:

1) Upgrade your vulnerable system to a supported FreeBSD stable or
release / security branch (releng) dated after the correction date.

2) To update your vulnerable system via a source code patch:

The following patches have been verified to apply to the applicable
FreeBSD release branches.

a) Download the relevant patch from the location below, and verify the
detached PGP signature using your PGP utility.

[FreeBSD 8.3, 8.4, 9.1, 9.2-RELEASE and 8.4-STABLE]
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-release.patch
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-release.patch.asc
# gpg --verify bind-release.patch.asc

[FreeBSD 9.2-STABLE]
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-stable-9.patch
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-stable-9.patch.asc
# gpg --verify bind-stable-9.patch.asc

b) Execute the following commands as root:

# cd /usr/src
# patch &lt; /path/to/patch

Recompile the operating system using buildworld and installworld as
described in &lt;URL:https://www.FreeBSD.org/handbook/makeworld.html&gt;.

Restart the applicable daemons, or reboot the system.

3) To update your vulnerable system via a binary patch:

Systems running a RELEASE version of FreeBSD on the i386 or amd64
platforms can be updated via the freebsd-update(8) utility:

# freebsd-update fetch
# freebsd-update install

VI.  Correction details

The following list contains the correction revision numbers for each
affected branch.

Branch/path                                                      Revision
- -------------------------------------------------------------------------
stable/8/                                                         r260646
releng/8.3/                                                       r260647
releng/8.4/                                                       r260647
stable/9/                                                         r260646
releng/9.1/                                                       r260647
releng/9.2/                                                       r260647
- -------------------------------------------------------------------------

To see which files were modified by a particular revision, run the
following command, replacing NNNNNN with the revision number, on a
machine with Subversion installed:

# svn diff -cNNNNNN --summarize svn://svn.freebsd.org/base

Or visit the following URL, replacing NNNNNN with the revision number:

&lt;URL:https://svnweb.freebsd.org/base?view=revision&amp;revision=NNNNNN&gt;

VII. References

&lt;URL:https://kb.isc.org/article/AA-01078&gt;

&lt;URL:http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0591&gt;

The latest revision of this advisory is available at
&lt;URL:http://security.FreeBSD.org/advisories/FreeBSD-SA-14:04.bind.asc&gt;
-----BEGIN PGP SIGNATURE-----

iQIcBAEBCgAGBQJS1ZTYAAoJEO1n7NZdz2rnOvQP/2/68/s9Cu35PmqNtSZVVxVG
ZSQP5EGWx/lramNf9566iKxOrLRMq/h3XWcC4goVd+gZFrvITJSVOWSa7ntDQ7TO
XcinfRZ/iyiJbs/Rg2wLHc/t5oVSyeouyccqODYFbOwOlk35JjOTMUG1YcX+Zasg
ax8RV+7Zt1QSBkMlOz/myBLXUjlTZ3Xg2FXVsfFQW5/g2CjuHpRSFx1bVNX6ysoG
9DT58EQcYxIS8WfkHRbbXKh9I1nSfZ7/Hky/kTafRdRMrjAgbqFgHkYTYsBZeav5
fYWKGQRJulYfeZQ90yMTvlpF42DjCC3uJYamJnwDIu8OhS1WRBI8fQfr9DRzmRua
OK3BK9hUiScDZOJB6OqeVzUTfe7MAA4/UwrDtTYQ+PqAenv1PK8DZqwXyxA9ThHb
zKO3OwuKOVHJnKvpOcr+eNwo7jbnHlis0oBksj/mrq2P9m2ueF9gzCiq5Ri5Syag
Wssb1HUoMGwqU0roS8+pRpNC8YgsWpsttvUWSZ8u6Vj/FLeHpiV3mYXPVMaKRhVm
067BA2uj4Th1JKtGleox+Em0R7OFbCc/9aWC67wiqI6KRyit9pYiF3npph+7D5Eq
7zPsUdDd+qc+UTiLp3liCRp5w6484wWdhZO6wRtmUgxGjNkxFoNnX8CitzF8AaqO
UWWemqWuz3lAZuORQ9KX
=OQzQ
-----END PGP SIGNATURE-----</programlisting>

      <para>Todo comunicado de segurança usa o seguinte formato:</para>

      <itemizedlist>
	<listitem>
	  <para>Cada aviso de segurança é assinado pela chave <acronym>PGP</acronym> do Oficial de Segurança. A chave pública para o Oficial de Segurança pode ser verificada em <xref linkend="pgpkeys"/>.</para>
	</listitem>

	<listitem>
	  <para>O nome do alerta de segurança sempre começa com <literal>FreeBSD-SA-</literal> (para o FreeBSD Security Advisory), seguido pelo ano em formato de dois dígitos (<literal>14:</literal>), seguido pelo número de aviso para aquele ano (<literal>04.</literal>), seguido pelo nome do aplicativo ou subsistema afetado (<literal>bind</literal>). O comunicado mostrado aqui é o quarto comunicado de 2014 e afeta o <application>BIND</application>.</para>
	</listitem>

	<listitem>
	  <para>O campo <literal>Topic</literal> resume a vulnerabilidade.</para>
	</listitem>

	<listitem>
	  <para>O campo <literal>Category</literal> refere-se à parte afetada do sistema, que pode ser uma de <literal>core</literal>, <literal>contrib</literal>, ou <literal>ports</literal>. A categoria <literal>core</literal> significa que a vulnerabilidade afeta um componente principal do sistema operacional FreeBSD. A categoria <literal>contrib</literal> significa que a vulnerabilidade afeta um software incluído no FreeBSD, como o <application>BIND</application>. A categoria <literal>ports</literal> indica que a vulnerabilidade afeta um software disponível através da coleção de ports.</para>
	</listitem>

	<listitem>
	  <para>O campo <literal>Module</literal> refere-se ao local do componente. Neste exemplo, o módulo <literal>bind</literal> é afetado; Portanto, essa vulnerabilidade afeta um aplicativo instalado com o sistema operacional.</para>
	</listitem>

	<listitem>
	  <para>O campo <literal>Announced</literal> reflete a data em que o comunicado de segurança foi publicado. Isto significa que a equipe de segurança verificou que o problema existe e que um patch foi disponibilizado no repositório do código fonte do FreeBSD.</para>
	</listitem>

	<listitem>
	  <para>O campo <literal>Credits</literal> dá crédito ao indivíduo ou organização que encontrou a vulnerabilidade e a relatou.</para>
	</listitem>

	<listitem>
	  <para>O campo <literal>Affects</literal> explica quais versões do FreeBSD são afetadas por esta vulnerabilidade.</para>
	</listitem>

	<listitem>
	  <para>O campo <literal>Corrected</literal> indica a data, a hora, o deslocamento do horário e as releases que foram corrigidas. A seção entre parênteses mostra cada branch para a qual a correção foi mesclada e o número de versão da liberação correspondente dessa branch. O próprio identificador de release inclui o número da versão e, se apropriado, o nível do patch. O nível de correção é a letra <literal>p</literal> seguida de um número, indicando o número de seqüência do patch, permitindo que os usuários controlem quais patches já foram aplicados ao sistema.</para>
	</listitem>

	<listitem>
	  <para>O campo <literal>CVE Name</literal> lista o número de aviso, se existir, no banco de dados  público <link xlink:href="http://cve.mitre.org">cve.mitre.org</link> de vulnerabilidades de segurança.</para>
	</listitem>

	<listitem>
	  <para>O campo <literal>Background</literal> fornece uma descrição do módulo afetado.</para>
	</listitem>

	<listitem>
	  <para>O campo <literal>Problem Description</literal> explica a vulnerabilidade. Isso pode incluir informações sobre o código defeituoso e como o utilitário pode ser usado de maneira mal-intencionada.</para>
	</listitem>

	<listitem>
	  <para>O campo <literal>Impact</literal> descreve o tipo de impacto que o problema pode ter em um sistema.</para>
	</listitem>

	<listitem>
	  <para>O campo <literal>Workaround</literal> indica se uma solução alternativa está disponível para os administradores do sistema que não podem corrigir imediatamente o sistema.</para>
	</listitem>

	<listitem>
	  <para>O campo <literal>Solution</literal> fornece as instruções para corrigir o sistema afetado. Este é um método testado e verificado passo a passo para obter um sistema corrigido e funcionando com segurança.</para>
	</listitem>

	<listitem>
	  <para>O campo <literal>Correction Details</literal> exibe cada branch do Subversion afetada com o número de revisão que contém o código corrigido.</para>
	</listitem>

	<listitem>
	  <para>O campo <literal>References</literal> oferece fontes de informações adicionais sobre a vulnerabilidade.</para>
	</listitem>
      </itemizedlist>
    </sect2>
  </sect1>

  <sect1 xml:id="security-accounting">
    <info>
      <title>Auditoria de Processo</title>

      <authorgroup>
	<author><personname><firstname>Tom</firstname><surname>Rhodes</surname></personname><contrib>Contribuído por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>Process Accounting</primary></indexterm>

    <para>A auditoria de processos é um método de segurança no qual um administrador pode controlar os recursos do sistema utilizados e sua alocação entre os usuários, fornecer monitoramento do sistema e controlar minimamente os comandos de um usuário.</para>

    <para>A auditoria de processos tem pontos positivos e negativos. Um dos pontos positivos é que uma intrusão pode ser rastreada ao ponto de entrada. Um valor negativo é a quantidade de logs gerados pela contabilidade do processo e o espaço em disco necessário. Esta seção conduz um administrador pelos fundamentos da contabilidade de processo.</para>

    <note>
      <para>Se uma auditoria mais detalhada for necessária, consulte <xref linkend="audit"/>.</para>
    </note>

    <sect2>
      <title>Ativando e Utilizando a Auditoria de Processos</title>

      <para>Antes de usar a auditoria de processos, ela deve ser ativada usando os seguintes comandos:</para>

      <screen><prompt>#</prompt> <userinput>sysrc accounting_enable=yes</userinput>
<prompt>#</prompt> <userinput>service accounting start</userinput></screen>

      <para>As informações de auditoria são armazenadas em arquivos localizados em <filename>/var/account</filename>, que são criados automaticamente, se necessário, na primeira vez em que o serviço de auditoria é iniciado. Esses arquivos contêm informações confidenciais, incluindo todos os comandos executados por todos os usuários. O acesso de escrita aos arquivos é limitado ao <systemitem class="username">root</systemitem> e o acesso de leitura é limitado ao <systemitem class="username">root</systemitem> e aos membros do grupo <systemitem class="groupname">wheel</systemitem>. Para também impedir que membros do grupo <systemitem class="groupname">wheel</systemitem> leiam os arquivos, altere a permissão do diretório <filename>/var/account</filename> para permitir acesso apenas de <systemitem class="username">root</systemitem>.</para>

      <para>Uma vez ativada, a auditoria começará a rastrear informações, como estatísticas de <acronym>CPU</acronym> e comandos executados. Todos os logs auditados estão em um formato não legível que pode ser visualizado usando <command>sa</command>. Se executado sem nenhuma opção, o <command>sa</command> imprime informações relacionadas ao número de chamadas por usuário, o tempo total decorrido em minutos, o total de <acronym>CPU</acronym> e o tempo do usuário em minutos, e o número médio de operações de <acronym>I/O</acronym>. Consulte <citerefentry><refentrytitle>sa</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter a lista de opções disponíveis que controlam a saída.</para>

      <para>Para exibir os comandos emitidos pelos usuários, use o <command>lastcomm</command>. Por exemplo, este comando imprime todo o uso do comando <command>ls</command> pelo usuário <systemitem class="username">trhodes</systemitem> no terminal <literal>ttyp1</literal>:</para>

      <screen><prompt>#</prompt> <userinput>lastcomm ls trhodes ttyp1</userinput></screen>

      <para>Muitas outras opções úteis existem e são explicadas em <citerefentry><refentrytitle>lastcomm</refentrytitle><manvolnum>1</manvolnum></citerefentry>, <citerefentry><refentrytitle>acct</refentrytitle><manvolnum>5</manvolnum></citerefentry> e <citerefentry><refentrytitle>sa</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="security-resourcelimits">
    <info>
      <title>Limites de Recursos</title>

      <authorgroup>
	<author><personname><firstname>Tom</firstname><surname>Rhodes</surname></personname><contrib>Contribuído por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>Resource limits</primary></indexterm>

      <para>O FreeBSD fornece vários métodos para um administrador limitar a quantidade de recursos do sistema que um indivíduo pode usar. As cotas de disco limitam a quantidade de espaço em disco disponível para os usuários. As cotas são discutidas em <xref linkend="quotas"/>.</para>

      <indexterm><primary>quotas</primary></indexterm>
      <indexterm><primary>limiting users</primary> <secondary>quotas</secondary></indexterm>
      <indexterm><primary>disk quotas</primary></indexterm>

    <para>Limites para outros recursos, como <acronym>CPU</acronym> e memória, podem ser definidos usando um arquivo simples ou um comando para configurar um banco de dados de limites de recursos. O método tradicional define classes de login editando o arquivo <filename>/etc/login.conf</filename>. Embora esse método ainda seja suportado, qualquer alteração requer um processo de várias etapas para editar esse arquivo, reconstruir o banco de dados de recursos, fazer as alterações necessárias no arquivo <filename>/etc/master.passwd</filename> e reconstruir o banco de dados de senhas. Isso pode se tornar demorado, dependendo do número de usuários a serem configurados.</para>

    <para>O comando <command>rctl</command> pode ser usado para fornecer um método mais refinado para controlar limites de recursos. Esse comando suporta mais que limites de usuário, já que também pode ser usado para definir restrições de recursos em processos e jails.</para>

    <para>Esta seção demonstra os dois métodos para controlar recursos, começando com o método tradicional.</para>

    <sect2 xml:id="users-limiting">
      <title>Configurando Classes de Login</title>

      <indexterm><primary>limiting users</primary></indexterm>
      <indexterm><primary>accounts</primary> <secondary>limiting</secondary></indexterm>
      <indexterm><primary><filename>/etc/login.conf</filename></primary></indexterm>

      <para>No método tradicional, as classes de login e os limites de recursos a serem aplicados a uma classe de login são definidos no arquivo <filename>/etc/login.conf</filename>. Cada conta de usuário pode ser atribuída a uma classe de login, onde <literal>default</literal> é a classe de login padrão. Cada classe de login possui um conjunto de recursos de login associados a ele. Um recurso de login é um par <literal><replaceable>name</replaceable>=<replaceable>value</replaceable></literal>, em que <replaceable>name</replaceable> é um identificador conhecido e <replaceable>value</replaceable> é uma string arbitrária que é processada de acordo, dependendo do <replaceable>name</replaceable>.</para>

      <note>
	<para>Sempre que o arquivo <filename>/etc/login.conf</filename> for editado, o <filename>/etc/login.conf.db</filename> deve ser atualizado executando o seguinte comando:</para>

	<screen><prompt>#</prompt> <userinput>cap_mkdb /etc/login.conf</userinput></screen>
      </note>

      <para>Os limites de recursos diferem dos recursos de login padrão de duas maneiras. Primeiro, para cada limite, existe um limite <firstterm>soft</firstterm> e um <firstterm>hard</firstterm>. Um limite soft pode ser ajustado pelo usuário ou aplicativo, mas não pode ser definido como superior ao limite hard. O limite hard pode ser baixado pelo usuário, mas só pode ser aumentado pelo root. Segundo, a maioria dos limites de recursos se aplica por processo a um usuário específico.</para>

      <para><xref linkend="resource-limits"/> lista os limites de recursos mais usados. Todos os limites  de recursos disponíveis e capabilities são descritos em detalhes em <citerefentry><refentrytitle>login.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>

      <indexterm><primary>limiting users</primary> <secondary>coredumpsize</secondary></indexterm>
      <indexterm><primary>limiting users</primary> <secondary>cputime</secondary></indexterm>
      <indexterm><primary>limiting users</primary> <secondary>filesize</secondary></indexterm>
      <indexterm><primary>limiting users</primary> <secondary>maxproc</secondary></indexterm>
      <indexterm><primary>limiting users</primary> <secondary>memorylocked</secondary></indexterm>
      <indexterm><primary>limiting users</primary> <secondary>memoryuse</secondary></indexterm>
      <indexterm><primary>limiting users</primary> <secondary>openfiles</secondary></indexterm>
      <indexterm><primary>limiting users</primary> <secondary>sbsize</secondary></indexterm>
      <indexterm><primary>limiting users</primary> <secondary>stacksize</secondary></indexterm>

      <table xml:id="resource-limits" frame="none" pgwide="1">
	<title>Limites de Recursos de Classe de Login</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Limite de Recurso</entry>
	      <entry>Descrição</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry>coredumpsize</entry>
	      <entry>O limite do tamanho de um arquivo core gerado por um programa é subordinado a outros limites de uso do disco, como <literal>filesize</literal> ou cotas de disco. Esse limite é frequentemente usado como um método menos severo de controle do consumo de espaço em disco. Como os usuários não geram arquivos core e geralmente não os excluem, essa configuração pode evitar que eles fiquem sem espaço em disco caso ocorra um grande travamento de programa.</entry>
	    </row>

	    <row>
	      <entry>cputime</entry>
	      <entry>A quantidade máxima de tempo de <acronym>CPU</acronym> que o processo de um usuário pode consumir. Os processos ofensivos serão eliminados pelo kernel. Este é um limite no <emphasis>tempo</emphasis> de <acronym>CPU</acronym>  consumido, não a porcentagem do <acronym>CPU</acronym> como exibido em alguns dos campos gerados pelo <command>top</command> e <command>ps</command>.</entry>
	    </row>

	    <row>
	      <entry>filesize</entry>
	      <entry>O tamanho máximo de um arquivo que o usuário pode possuir. Ao contrário das cotas de disco (<xref linkend="quotas"/>), esse limite é imposto em arquivos individuais, não no conjunto de todos os arquivos que um usuário possui.</entry>
	    </row>

	    <row>
	      <entry>maxproc</entry>
	      <entry>O número máximo de processos de primeiro plano e de plano de fundo que um usuário pode executar. Esse limite pode não ser maior que o limite do sistema especificado pela variável  <varname>kern.maxproc</varname>. Definir um limite muito pequeno pode prejudicar a produtividade de um usuário, pois algumas tarefas, como compilar um programa grande, iniciam muitos processos.</entry>
	    </row>

	    <row>
	      <entry>memorylocked</entry>
	      <entry>A quantidade máxima de memória que um processo pode solicitar para ser bloqueado na memória principal usando o <citerefentry><refentrytitle>mlock</refentrytitle><manvolnum>2</manvolnum></citerefentry>. Alguns programas críticos do sistema, como <citerefentry><refentrytitle>amd</refentrytitle><manvolnum>8</manvolnum></citerefentry>, se bloqueiam na memória principal para que, se o sistema começar a fazer swap, eles não contribuam para surrar o disco.</entry>
	    </row>

	    <row>
	      <entry>memoryuse</entry>
	      <entry>A quantidade máxima de memória que um processo pode consumir a qualquer momento. Inclui tanto a memória principal quanto o uso de swap. Este não é um limite geral para restringir o consumo de memória, mas é um bom começo.</entry>
	    </row>

	    <row>
	      <entry>openfiles</entry>
	      <entry>O número máximo de arquivos que um processo pode ter aberto. No FreeBSD, os arquivos são usados para representar sockets e canais <acronym>IPC</acronym>, então tome cuidado para não definir isso muito baixo. O limite de todo o sistema para isso é definido por pela variável <varname>kern.maxfiles</varname>.</entry>
	    </row>

	    <row>
	      <entry>sbsize</entry>
	      <entry>O limite na quantidade de memória de rede que um usuário pode consumir. Isso geralmente pode ser usado para limitar as comunicações da rede.</entry>
	    </row>

	    <row>
	      <entry>stacksize</entry>
	      <entry>O tamanho máximo de uma pilha de processos. Isso por si só não é suficiente para limitar a quantidade de memória que um programa pode usar, por isso deve ser usado em conjunto com outros limites.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Existem algumas outras coisas para se lembrar ao definir limites de recursos:</para>

      <itemizedlist>
	<listitem>
	  <para>Os processos iniciados na inicialização do sistema pelo  <filename>/etc/rc</filename> são atribuídos à classe <literal>daemon</literal> de login.</para>
	</listitem>

	<listitem>
	  <para>Embora o arquivo <filename>/etc/login.conf</filename> padrão seja uma boa fonte de valores razoáveis para a maioria dos limites, eles podem não ser apropriados para todos os sistemas. Definir um limite muito alto pode abrir o sistema para uso abusivo, enquanto que defini-lo como muito baixo pode prejudicar a produtividade.</para>
	</listitem>

	<listitem>
	  <para>O <application>Xorg</application> utiliza muitos recursos e incentiva os usuários a executarem mais programas simultaneamente.</para>
	</listitem>

	<listitem>
	  <para>Muitos limites se aplicam a processos individuais, não ao usuário como um todo. Por exemplo, definir a variável <varname>openfiles</varname> como <literal>50</literal> significa que cada processo que o usuário executa pode abrir até <literal>50</literal> arquivos. A quantidade total de arquivos que um usuário pode abrir é o valor de <literal>openfiles</literal> multiplicado pelo valor de <literal>maxproc</literal>. Isso também se aplica ao consumo de memória.</para>
	</listitem>
      </itemizedlist>

      <para>Para mais informações sobre limites de recursos e classes de login e capacidades em geral, consulte <citerefentry><refentrytitle>cap_mkdb</refentrytitle><manvolnum>1</manvolnum></citerefentry>, <citerefentry><refentrytitle>getrlimit</refentrytitle><manvolnum>2</manvolnum></citerefentry> e <citerefentry><refentrytitle>login.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>
    </sect2>

    <sect2>
      <title>Ativando e Configurando Limites de Recursos</title>

      <para>A variável configurável <varname>kern.racct.enable</varname> deve ser configurada para um valor diferente de zero. Kernels personalizados requerem configuração específica:</para>

      <programlisting>options         RACCT
options         RCTL</programlisting>

      <para>Depois que o sistema for reinicializado no novo kernel, o <command>rctl</command> poderá ser usado para definir regras para o sistema.</para>

      <para>A sintaxe da regra é controlada por meio do uso de um subject, subject-id, resource e action, conforme visto nesta regra de exemplo:</para>

      <programlisting>user:trhodes:maxproc:deny=10/user</programlisting>

      <para>Nesta regra, o subject é <literal>user</literal>, o subject-id é <literal>trhodes</literal>, o resource, <literal>maxproc</literal>, é o número máximo de processos, e a action é <literal>deny</literal>, que bloqueia a criação de novos processos. Isso significa que o usuário, <literal>trhodes</literal>, será restrito a execução de no máximo <literal>10</literal> processos. Outras ações possíveis incluem o registro no console, passando uma notificação para o <citerefentry><refentrytitle>devd</refentrytitle><manvolnum>8</manvolnum></citerefentry> ou enviando um sigterm para o processo.</para>

      <para>Algum cuidado deve ser tomado ao adicionar regras. Como esse usuário está restrito a <literal>10</literal> processos, este exemplo impedirá que o usuário execute outras tarefas depois de efetuar login e executar uma sessão <command>screen</command>. Quando um limite de recurso for atingido, um erro será impresso, como neste exemplo:</para>

      <screen><prompt>%</prompt> <userinput>man test</userinput>
    /usr/bin/man: Cannot fork: Resource temporarily unavailable
eval: Cannot fork: Resource temporarily unavailable</screen>

      <para>Como outro exemplo, uma jail pode ser impedida de exceder um limite de memória. Esta regra pode ser escrita como:</para>

      <screen><prompt>#</prompt> <userinput>rctl -a jail:httpd:memoryuse:deny=2G/jail</userinput></screen>

      <para>As regras persistirão durante as reinicializações se tiverem sido adicionadas ao arquivo <filename>/etc/rctl.conf</filename>. O formato é uma regra, sem o comando anterior. Por exemplo, a regra anterior pode ser adicionada como:</para>

      <programlisting># Block jail from using more than 2G memory:
jail:httpd:memoryuse:deny=2G/jail</programlisting>

      <para>Para remover uma regra, use o <command>rctl</command> para removê-la da lista:</para>

      <screen><prompt>#</prompt> <userinput>rctl -r user:trhodes:maxproc:deny=10/user</userinput></screen>

      <para>Um método para remover todas as regras é documentado em <citerefentry><refentrytitle>rctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>. No entanto, se for necessário remover todas as regras para um único usuário, esse comando poderá ser emitido:</para>

      <screen><prompt>#</prompt> <userinput>rctl -r user:trhodes</userinput></screen>

      <para>Existem muitos outros recursos que podem ser usados para exercer controle adicional sobre vários <literal>subjects</literal>. Veja <citerefentry><refentrytitle>rctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> para aprender sobre eles.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="security-sudo">
    <info>
      <title>Administração Compartilhada com Sudo</title>

      <authorgroup>
	<author><personname><firstname>Tom</firstname><surname>Rhodes</surname></personname><contrib>Contribuído por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>Security</primary> <secondary>Sudo</secondary></indexterm>

    <para>Os administradores do sistema geralmente precisam conceder permissões avançadas aos usuários para que eles possam executar tarefas privilegiadas. A ideia de que os membros da equipe tenham acesso a um sistema FreeBSD para executar suas tarefas específicas abre desafios únicos para cada administrador. Esses membros da equipe precisam apenas de um subconjunto de acesso além dos níveis normais de usuário final; no entanto, eles quase sempre dizem ao gerenciadores que eles são incapazes de executar suas tarefas sem acesso de superusuário. Felizmente, não há motivo para fornecer tal acesso aos usuários finais porque existem ferramentas para gerenciar esse exato requisito.</para>

    <para>Até este ponto, o capítulo de segurança cobriu o acesso a usuários autorizados e a tentativa de impedir o acesso não autorizado. Outro problema surge quando os usuários autorizados têm acesso aos recursos do sistema. Em muitos casos, alguns usuários podem precisar acessar os scripts de inicialização do aplicativo ou uma equipe de administradores precisa manter o sistema. Tradicionalmente, os usuários e grupos padrão, as permissões de arquivo e até mesmo o comando <citerefentry><refentrytitle>su</refentrytitle><manvolnum/></citerefentry> gerenciariam esse acesso. E como os aplicativos exigiam mais acesso, à medida que mais usuários precisavam usar recursos do sistema, era necessária uma solução melhor. A aplicação mais usada atualmente é o <application>Sudo</application>.</para>

    <para>O <application>Sudo</application> permite que os administradores configurem um acesso mais rígido aos comandos do sistema e forneçam alguns recursos avançados de log. Como uma ferramenta, ele está disponível na coleção de ports como <package role="port">security/sudo</package> ou usando o utilitário <citerefentry><refentrytitle>pkg</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Para usar a ferramenta <citerefentry><refentrytitle>pkg</refentrytitle><manvolnum>8</manvolnum> </citerefentry>:</para>

    <screen><prompt>#</prompt> <userinput>pkg install sudo</userinput></screen>

    <para>Após a conclusão da instalação, o <command>visudo</command> instalado abrirá o arquivo de configuração com um editor de texto. O uso do <command>visudo</command> é altamente recomendado, pois vem com um verificador de sintaxe incorporado para verificar se não há erros antes que o arquivo seja salvo.</para>

    <para>O arquivo de configuração é composto de várias seções pequenas que permitem uma configuração extensiva. No exemplo a seguir, o mantenedor do aplicativo da web, user1, precisa iniciar, parar e reiniciar o aplicativo da web conhecido como <replaceable>webservice</replaceable>. Para conceder a este usuário permissão para executar estas tarefas, adicione esta linha ao final do arquivo <filename>/usr/local/etc/sudoers</filename>:</para>

    <programlisting>user1   ALL=(ALL)       /usr/sbin/service webservice *</programlisting>

    <para>O usuário pode agora iniciar o <replaceable>webservice</replaceable> usando este comando:</para>

    <screen><prompt>%</prompt> <userinput>sudo /usr/sbin/service <replaceable>webservice</replaceable> start</userinput></screen>

    <para>Embora essa configuração permita que um único usuário acesse o serviço <application>webservice</application>; No entanto, na maioria das organizações, existe uma equipe inteira da Web encarregada de gerenciar o serviço. Uma única linha também pode dar acesso a um grupo inteiro. Essas etapas criarão um grupo da Web, adicionarão um usuário a esse grupo e permitirão que todos os membros do grupo gerenciem o serviço:</para>

    <screen><prompt>#</prompt> <userinput>pw groupadd -g 6001 -n webteam</userinput></screen>

    <para>Usando o mesmo comando <citerefentry><refentrytitle>pw</refentrytitle><manvolnum>8</manvolnum></citerefentry>, o usuário é adicionado ao grupo webteam:</para>

    <screen><prompt>#</prompt> <userinput>pw groupmod -m user1 -n webteam</userinput></screen>

    <para>Finalmente, esta linha no arquivo <filename>/usr/local/etc/sudoers</filename> permite que qualquer membro do grupo webteam gerencie o <replaceable>webservice</replaceable>:</para>

    <programlisting>%webteam   ALL=(ALL)       /usr/sbin/service webservice *</programlisting>

    <para>Ao contrário do <citerefentry><refentrytitle>su</refentrytitle><manvolnum>1</manvolnum></citerefentry>, o <application>Sudo</application> requer apenas a senha do usuário final. Isso adiciona uma vantagem em que os usuários não precisarão de senhas compartilhadas, uma descoberta na maioria das auditorias de segurança e o que por si só já ruins em todos os aspectos.</para>

    <para>Os usuários autorizados a executar aplicativos com o <application>Sudo</application> só inserem suas próprias senhas. Isso é mais seguro e oferece melhor controle do que o <citerefentry><refentrytitle>su</refentrytitle><manvolnum>1</manvolnum></citerefentry>, onde a senha de <systemitem class="username">root</systemitem> é inserida e o usuário adquire todas as permissões de <systemitem class="username">root</systemitem>.</para>

    <tip>
      <para>A maioria das organizações está se movendo ou migrou para um modelo de autenticação de dois fatores. Nestes casos, o usuário pode não ter uma senha para entrar. O <application>Sudo</application> resolve estes casos com a variável <literal>NOPASSWD</literal>. Adicioná-lo à configuração acima permitirá que todos os membros do grupo <replaceable>webteam</replaceable> gerenciem o serviço sem o requisito de senha:</para>

      <programlisting>%webteam   ALL=(ALL)       NOPASSWD: /usr/sbin/service webservice *</programlisting>
    </tip>

    <sect2 xml:id="security-sudo-loggin">
      <title>Logando a Saída</title>

      <para>Uma vantagem para implementar o <application>Sudo</application> é a capacidade de ativar o log de sessão. Usando os mecanismos de log integrados e o comando <application>sudoreplay</application> incluído, todos os comandos iniciados por meio de <application>Sudo</application> são registrados para verificação posterior. Para ativar esse recurso, adicione uma entrada de diretório de log padrão, este exemplo usa uma variável de usuário. Existem várias outras convenções de nome de arquivo de log, consulte a página de manual do <application>sudoreplay</application> para obter informações adicionais.</para>

      <programlisting>Defaults iolog_dir=/var/log/sudo-io/%{user}</programlisting>

      <tip>
	<para>Este diretório será criado automaticamente após o logging ser configurado. É melhor deixar o sistema criar o diretório com permissões padrão apenas para estar seguro. Além disso, essa entrada também registra os administradores que usam o comando <application>sudoreplay</application>. Para alterar esse comportamento, leia e descomente as opções de log dentro do arquivo <filename>sudoers</filename>.</para>
      </tip>

      <para>Uma vez que esta diretiva tenha sido adicionada ao arquivo <filename>sudoers</filename>, qualquer configuração de usuário pode ser atualizada com a solicitação para acessar o log. No exemplo mostrado, a entrada <replaceable>webteam</replaceable> atualizada teria as seguintes alterações adicionais:</para>

      <programlisting>%webteam ALL=(ALL) NOPASSWD: LOG_INPUT: LOG_OUTPUT: /usr/sbin/service webservice *</programlisting>

      <para>Deste ponto em diante, todos os membros do grupo <replaceable>webteam</replaceable> que alteram o status do aplicativo <replaceable>webservice</replaceable> serão registrados. A lista de sessões anteriores e atuais pode ser exibida com:</para>

      <screen><prompt>#</prompt> <userinput>sudoreplay -l</userinput></screen>

      <para>Na saída, para reproduzir uma sessão específica, procure a entrada <literal>TSID=</literal> e passe-a para o <application>sudoreplay</application> sem outras opções para reproduzir a sessão na velocidade normal. Por exemplo:</para>

      <screen><prompt>#</prompt> <userinput>sudoreplay user1/00/00/02</userinput></screen>

      <warning>
	<para>Enquanto as sessões são registradas, qualquer administrador pode remover as sessões e deixar apenas uma questão de por que elas fizeram isso. Vale a pena adicionar uma verificação diária por meio de um sistema de detecção de intrusão (<acronym>IDS</acronym>) ou software semelhante para que outros administradores sejam alertados sobre alterações manuais.</para>
      </warning>

      <para>O <command>sudoreplay</command> é extremamente extensível. Consulte a documentação para mais informações.</para>
    </sect2>
  </sect1>
</chapter>

    
<!--
    The FreeBSD Documentation Project

    $FreeBSD$
-->
<chapter version="5.0" xml:id="jails">
  <info>
    <title>Jails</title>

    <authorgroup>
      <author><personname><firstname>Matteo</firstname><surname>Riondato</surname></personname><contrib>Contribuído por </contrib></author>
    </authorgroup>
  </info>

  <indexterm><primary>jails</primary></indexterm>

  <sect1 xml:id="jails-synopsis">
    <title>Sinopse</title>

    <para>Como a administração de sistemas é uma tarefa difícil, muitas ferramentas foram desenvolvidas para facilitar a vida do administrador. Essas ferramentas geralmente aprimoram a maneira como os sistemas são instalados, configurados e mantidos. Uma das ferramentas que podem ser usadas para melhorar a segurança de um sistema FreeBSD é <firstterm>jails</firstterm>. Jails estão disponíveis desde o FreeBSD 4.X e continuam sendo aprimoradas em sua utilidade, desempenho, confiabilidade e segurança.</para>

    <para>Jails são construídas em cima do conceito de <citerefentry><refentrytitle>chroot</refentrytitle><manvolnum>2</manvolnum></citerefentry>, que é usado para mudar o diretório raiz de um conjunto de processos. Isso cria um ambiente seguro, separado do resto do sistema. Os processos criados no ambiente chroot não podem acessar arquivos ou recursos fora dele. E por esse motivo, comprometer um serviço em execução em um ambiente chroot não deve permitir que o invasor comprometa todo o sistema. No entanto, um chroot tem várias limitações. É adequado para tarefas fáceis que não exigem muita flexibilidade ou recursos complexos e avançados. Ao longo do tempo, foram descobertas muitas maneiras de escapar de um ambiente chroot, tornando essa solução como não sendo a melhor para proteger os serviços.</para>

    <para>As jails aprimoram o conceito do ambiente chroot tradicional de várias maneiras. Em um ambiente chroot tradicional, os processos são limitados apenas na parte do sistema de arquivos que eles podem acessar. O restante dos recursos do sistema, os usuários, os processos em execução e o subsistema de rede são compartilhados pelos processos chroot e pelos processos do sistema host. As jails expandem esse modelo virtualizando o acesso ao sistema de arquivos, ao conjunto de usuários e ao subsistema de rede. Controles mais refinados estão disponíveis para ajustar o acesso de um ambiente em jail. As jails podem ser consideradas como um tipo de virtualização no nível do sistema operacional.</para>

    <para>Uma jail é caracterizada por quatro elementos:</para>

    <itemizedlist>
      <listitem>
	<para>Uma subárvore de diretórios: o ponto de partida a partir do qual uma jail é inserida. Uma vez dentro da jail, não é permitido que um processo escape fora dessa subárvore.</para>
      </listitem>

      <listitem>
	<para>Um nome de host: que será usado pela jail.</para>
      </listitem>

      <listitem>
	<para>Um endereço <acronym>IP</acronym>: atribuído à jail. O endereço <acronym>IP</acronym> de uma jail é geralmente um endereço de alias de uma interface de rede existente.</para>
      </listitem>

      <listitem>
	<para>Um comando: o nome do caminho de um executável para ser executado dentro da jail. O caminho é relativo ao diretório raiz do ambiente da jail.</para>
      </listitem>
    </itemizedlist>

    <para>As Jails possuem seu próprio conjunto de usuários e sua própria conta de <systemitem class="username">root</systemitem> que são limitados ao ambiente da jail. A conta <systemitem class="username">root</systemitem> de uma jail não tem permissão para executar operações no sistema fora do ambiente  da jail associada.</para>

    <para>Este capítulo fornece uma visão geral da terminologia e dos comandos para gerenciar as jail do FreeBSD. As jails são uma ferramenta poderosa para administradores de sistemas e usuários avançados.</para>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>O que é uma jail e qual finalidade ela pode servir nas instalações do FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como compilar, iniciar e parar uma jail.</para>
      </listitem>

      <listitem>
	<para>Os fundamentos da administração de jails, tanto de dentro como fora da jail.</para>
      </listitem>
    </itemizedlist>

    <important>
      <para>As jails são uma ferramenta poderosa, mas não são uma panaceia de segurança. Embora não seja possível que um processo rodando em jail burle a segurança por conta própria, existem várias maneiras pelas quais um usuário não privilegiado fora da jail pode cooperar com um usuário privilegiado dentro da jail para obter privilégios elevados no ambiente host.</para>

      <para>A maioria desses ataques podem ser mitigados apenas garantindo que o root da jail não seja acessível a usuários não privilegiados no ambiente host. Como regra geral, usuários não confiáveis com acesso privilegiado a uma jail não devem ter acesso ao ambiente do host.</para>
    </important>
  </sect1>

  <sect1 xml:id="jails-terms">
    <title>Termos Relacionados à Jails</title>

    <para>Para facilitar a compreensão de partes do sistema FreeBSD relacionadas a jails, seus componentes internos e a maneira como eles interagem com o resto do FreeBSD, os seguintes termos são usados mais adiante neste capítulo:</para>

    <variablelist>
      <varlistentry>
	<term><citerefentry><refentrytitle>chroot</refentrytitle><manvolnum>8</manvolnum></citerefentry> (comando)</term>
	<listitem>
	  <para>Utilitário, que usa a chamada de sistema <citerefentry><refentrytitle>chroot</refentrytitle><manvolnum>2</manvolnum></citerefentry> do FreeBSD para alterar o diretório raiz de um processo e todos os seus descendentes.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><citerefentry><refentrytitle>chroot</refentrytitle><manvolnum>2</manvolnum></citerefentry> (ambiente)</term>
	<listitem>
	  <para>O ambiente dos processos em execução em um <quote>chroot</quote>. Isso inclui recursos como a parte do sistema de arquivos que é visível, IDs de usuário e grupo que estão disponíveis, interfaces de rede e outros mecanismos de IPC, etc.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><citerefentry><refentrytitle>jail</refentrytitle><manvolnum>8</manvolnum></citerefentry> (comando)</term>
	<listitem>
	  <para>O utilitário de administração do sistema que permite o lançamento de processos dentro de um ambiente jail.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>host (sistema, processo, usuário, etc.)</term>
	<listitem>
	  <para>O sistema de controle de um ambiente jail. O sistema host tem acesso a todos os recursos de hardware disponíveis e pode controlar processos fora e dentro de um ambiente jail. Uma das diferenças importantes do sistema host de uma jail é que as limitações que se aplicam aos processos de super-usuário dentro de uma jail não são aplicadas aos processos do sistema host.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>hosted (sistema, processo, usuário, etc.)</term>
	<listitem>
	  <para>Um processo, usuário ou outra entidade, cujo acesso a recursos é restrito por uma jail do FreeBSD.</para>
	</listitem>
      </varlistentry>
    </variablelist>
  </sect1>

  <sect1 xml:id="jails-build">
    <title>Criando e Controlando Jails</title>

    <para>Alguns administradores dividem as jails nos dois seguintes tipos: jails <quote>completa</quote>, que se assemelham a um sistema real do FreeBSD, e jails de <quote>serviço</quote>, dedicados a um aplicativo ou serviço, possivelmente executando com privilégios. Esta é apenas uma divisão conceitual e o processo de criação de uma jail não é afetado por ela. Ao criar uma jail <quote>completa</quote>, há duas opções para a origem do userland: usar binários pré-compilados (como aqueles fornecidos em uma mídia de instalação) ou compila-los a partir do código fonte.</para>

    <sect2>
      <title>Instalando uma Jail</title>

      <sect3 xml:id="jails-install-internet">
        <title>Para instalar uma Jail pela Internet</title>
      
        <para>A ferramenta <citerefentry><refentrytitle>bsdinstall</refentrytitle><manvolnum>8</manvolnum> </citerefentry> pode ser usada para baixar e instalar os binários necessários para uma Jail. Será apresentando a seleção de um mirror, quais distribuições serão instaladas no diretório de destino e algumas configurações básicas da Jail:</para>
    
        <screen><prompt>#</prompt> <userinput>bsdinstall jail <replaceable>/here/is/the/jail</replaceable></userinput></screen>
      
        <para>Uma vez que o comando finalize, o próximo passo é configurar o host para rodar a jail.</para>
      </sect3>

      <sect3 xml:id="jails-install-iso">
        <title>Instalar uma Jail por uma imagem ISO</title>

    <para>Para instalar o userland da mídia de instalação, primeiro crie o diretório raiz da jail. Isso pode ser feito definindo a variável <varname>DESTDIR</varname> para o local adequado.</para>

    <para>Inicie um shell e defina a variável <varname>DESTDIR</varname>:</para>

    <screen><prompt>#</prompt> <userinput>sh</userinput>
<prompt>#</prompt> <userinput>export DESTDIR=<replaceable>/here/is/the/jail</replaceable></userinput></screen>

    <para>Monte a mídia de instalação como abordado em <citerefentry><refentrytitle>mdconfig</refentrytitle><manvolnum>8</manvolnum></citerefentry> ao usar a ISO de instalação:</para>

    <screen><prompt>#</prompt> <userinput>mount -t cd9660 /dev/`mdconfig -f cdimage.iso` /mnt</userinput>
<prompt>#</prompt> <userinput>cd /mnt/usr/freebsd-dist/</userinput></screen>

    <para>Extraia os binários dos tarballs na mídia de instalação dentro do destino declarado. Minimamente, apenas o conjunto base precisa ser extraído, mas uma instalação completa pode ser executada quando preferida.</para>

    <para>Para instalar apenas o sistema básico:</para>

    <screen><prompt>#</prompt> <userinput>tar -xf /mnt/usr/freebsd-dist/base.txz -C $DESTDIR</userinput></screen>

    <para>Para instalar tudo, exceto o kernel:</para>

    <screen><prompt>#</prompt> <userinput>for set in base ports; do tar -xf /mnt/usr/freebsd-dist/$set.txz -C $DESTDIR ; done</userinput></screen>
      </sect3>

      <sect3 xml:id="jails-install-source">
        <title>Para compilar e instalar uma Jail a partir do código fonte</title>

    <para>A página de manual <citerefentry><refentrytitle>jail</refentrytitle><manvolnum>8</manvolnum></citerefentry> explica o procedimento para compilar uma jail:</para>

    <screen><prompt>#</prompt> <userinput>setenv D <replaceable>/here/is/the/jail</replaceable></userinput>
<prompt>#</prompt> <userinput>mkdir -p $D</userinput>      <co xml:id="jailpath"/>
<prompt>#</prompt> <userinput>cd /usr/src</userinput>
<prompt>#</prompt> <userinput>make buildworld</userinput>  <co xml:id="jailbuildworld"/>
<prompt>#</prompt> <userinput>make installworld DESTDIR=$D</userinput>  <co xml:id="jailinstallworld"/>
<prompt>#</prompt> <userinput>make distribution DESTDIR=$D</userinput>  <co xml:id="jaildistrib"/>
<prompt>#</prompt> <userinput>mount -t devfs devfs $D/dev</userinput>   <co xml:id="jaildevfs"/></screen>

    <calloutlist>
      <callout arearefs="jailpath">
	<para>Selecionar um local para uma jail é o melhor ponto de partida. É aqui que a jail residirá fisicamente no sistema de arquivos do host da jail. Uma boa opção pode ser <filename>/usr/jail/<replaceable>jailname</replaceable></filename>, onde <replaceable>jailname</replaceable> é o nome do host que identifica a jail. Normalmente, <filename>/usr/</filename> tem espaço suficiente para o sistema de arquivos da jail, onde para jails <quote>completa</quote> é, essencialmente, uma replicação de todos os arquivos presentes em uma instalação padrão do sistema básico do FreeBSD.</para>
      </callout>

      <callout arearefs="jailbuildworld">
	<para>Se você já tiver recompilado seu userland usando <command>make world</command> ou <command>make buildworld</command>, você pode pular esta etapa e instalar seu userland existente na nova jail.</para>
      </callout>

      <callout arearefs="jailinstallworld">
	<para>Esse comando preencherá a sub-árvore de diretórios escolhida como o local físico da jail no sistema de arquivos com os binários, bibliotecas, páginas de manual e assim por diante.</para>
      </callout>

      <callout arearefs="jaildistrib">
	<para>O target <buildtarget>distribuição</buildtarget> do <application>make</application> instala todos os arquivos de configuração necessários. Em palavras simples, ele instala cada arquivo instalável de <filename>/usr/src/etc/</filename> no diretório <filename>/etc</filename> do ambiente jail: <filename>$D/etc/</filename>.</para>
      </callout>

      <callout arearefs="jaildevfs">
	<para>A montagem do sistema de arquivos <citerefentry><refentrytitle>devfs</refentrytitle><manvolnum>8</manvolnum></citerefentry> dentro de uma jail não é necessária. Por outro lado, qualquer, ou quase qualquer aplicativo requer acesso a pelo menos um dispositivo, dependendo da finalidade do aplicativo fornecido. É muito importante controlar o acesso a dispositivos de dentro de uma jail, pois configurações inadequadas podem permitir que um invasor faça coisas desagradáveis na jail. O controle sobre <citerefentry><refentrytitle>devfs</refentrytitle><manvolnum>8</manvolnum></citerefentry> é gerenciado por meio de conjuntos de regras que são descritos nas páginas de manual <citerefentry><refentrytitle>devfs</refentrytitle><manvolnum>8</manvolnum></citerefentry> e <citerefentry><refentrytitle>devfs.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>
      </callout>
    </calloutlist>
      </sect3>
    </sect2>

    <sect2>
      <title>Configurando o Host</title>

    <para>Uma vez que a jail é instalada, ela pode ser iniciada usando o utilitário <citerefentry><refentrytitle>jail</refentrytitle><manvolnum>8</manvolnum></citerefentry>. O utilitário <citerefentry><refentrytitle>jail</refentrytitle><manvolnum>8</manvolnum></citerefentry> possui quatro argumentos obrigatórios que são descritos em <xref linkend="jails-synopsis"/>. Outros argumentos podem ser especificados também, por exemplo, para executar o processo em jail com as credenciais de um usuário específico. O argumento de <option><replaceable>command</replaceable></option> depende do tipo de jail; para um <emphasis>sistema virtual</emphasis>, <filename>/etc/rc</filename> é uma boa escolha, já que ele irá replicar a sequência de inicialização de um sistema real do FreeBSD. Para uma jail de <emphasis>serviço</emphasis>, depende do serviço ou aplicativo que será executado dentro da jail.</para>

    <para>As jails geralmente são iniciadas no boot e o mecanismo <filename>rc</filename> do FreeBSD fornece uma maneira fácil de fazer isso.</para>

    <procedure>
      <step>
	<para>Configure os parâmetros da jail no arquivo <filename>jail.conf</filename>:</para>
	<programlisting><replaceable>www</replaceable> {
    host.hostname = <replaceable>www.example.org</replaceable>;           # Hostname
    ip4.addr = <replaceable>192.168.0.10</replaceable>;                   # IP address of the jail
    path = "<replaceable>/usr/jail/www</replaceable>";                    # Path to the jail
    devfs_ruleset = "<replaceable>www_ruleset</replaceable>";             # devfs ruleset
    mount.devfs;                               # Mount devfs inside the jail
    exec.start = "/bin/sh /etc/rc";            # Start command
    exec.stop = "/bin/sh /etc/rc.shutdown";    # Stop command
}</programlisting>

	<para>Configure as jails para iniciar no boot no arquivo <filename>rc.conf</filename>:</para>

	<programlisting>jail_enable="YES"   # Set to NO to disable starting of any jails</programlisting>

	<para>A inicialização padrão das jails configuradas no arquivo <citerefentry><refentrytitle>jail.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>, executará o script <filename>/etc/rc</filename> da jail, que assume que a jail é um sistema virtual completo. Para jails de serviço, o comando de inicialização padrão da jail deve ser alterado, definindo a opção <varname>exec.start</varname> apropriadamente.</para>

	<note>
	  <para>Para obter uma lista completa das opções disponíveis, consulte a página de manual <citerefentry><refentrytitle>jail.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>
	</note>
      </step>
    </procedure>

    <para><citerefentry><refentrytitle>service</refentrytitle><manvolnum>8</manvolnum></citerefentry> pode ser usado para iniciar ou parar uma jail manualmente, se uma entrada para ela existir no arquivo <filename>jail.conf</filename>:</para>

    <screen><prompt>#</prompt> <userinput>service jail start <replaceable>www</replaceable></userinput>
<prompt>#</prompt> <userinput>service jail stop <replaceable>www</replaceable></userinput></screen>

    <para>As jails podem ser desligadas com o <citerefentry><refentrytitle>jexec</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Use <citerefentry><refentrytitle>jls</refentrytitle><manvolnum>8</manvolnum></citerefentry> para identificar o <varname>JID</varname> da jail e, em seguida, use <citerefentry><refentrytitle>jexec</refentrytitle><manvolnum>8</manvolnum></citerefentry> para executar o script de desligamento nessa jail.</para>

    <screen><prompt>#</prompt> <userinput>jls</userinput>
   JID  IP Address      Hostname                      Path
     3  192.168.0.10    www                           /usr/jail/www
<prompt>#</prompt> <userinput>jexec <replaceable>3</replaceable> /etc/rc.shutdown</userinput></screen>

    <para>Mais informações sobre isso podem ser encontradas na página de manual <citerefentry><refentrytitle>jail</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="jails-tuning">
    <title>Tuning e Administração</title>

    <para>Existem várias opções que podem ser configuradas para qualquer jail, e várias maneiras de combinar um sistema host FreeBSD com jails, para produzir aplicações de alto nível. Esta seção apresenta:</para>

    <itemizedlist>
      <listitem>
	<para>Algumas das opções disponíveis para ajustar as restrições de comportamento e segurança implementadas pela instalação de uma jail.</para>
      </listitem>

      <listitem>
	<para>Alguns das aplicações de alto nível para gerenciamento de jail, que estão disponíveis através da Coleção de Ports do FreeBSD, e que podem ser usados para implementar soluções globais baseadas em jails.</para>
      </listitem>
    </itemizedlist>

    <sect2 xml:id="jails-tuning-utilities">
      <title>Ferramentas de Sistema para Tuning de Jail no FreeBSD</title>

      <para>O tuning da configuração de uma jail é feito principalmente configurando variáveis <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Uma sub-árvore especial do sysctl existe como base para organizar todas as opções relevantes: a hierarquia <varname>security.jail.*</varname> das opções do kernel do FreeBSD. Aqui está uma lista dos principais sysctls relacionados à jail, completas com seu valor padrão. Os nomes devem ser autoexplicativos, mas para obter mais informações sobre eles, consulte as páginas de manual <citerefentry><refentrytitle>jail</refentrytitle><manvolnum>8</manvolnum></citerefentry> e <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>

      <itemizedlist>
	<listitem>
	  <para><varname>security.jail.set_hostname_allowed: 1</varname></para>
	</listitem>

	<listitem>
	  <para><varname>security.jail.socket_unixiproute_only: 1</varname></para>
	</listitem>

	<listitem>
	  <para><varname>security.jail.sysvipc_allowed: 0</varname></para>
	</listitem>

	<listitem>
	  <para><varname>security.jail.enforce_statfs: 2</varname></para>
	</listitem>

	<listitem>
	  <para><varname>security.jail.allow_raw_sockets: 0</varname></para>
	</listitem>

	<listitem>
	  <para><varname>security.jail.chflags_allowed: 0</varname></para>
	</listitem>

	<listitem>
	  <para><varname>security.jail.jailed: 0</varname></para>
	</listitem>
      </itemizedlist>

      <para>Estas variáveis podem ser usadas pelo administrador de sistemas do <emphasis>sistema host</emphasis> para adicionar ou remover algumas das limitações impostas por padrão no usuário <systemitem class="username">root</systemitem>. Note que existem algumas limitações que não podem ser removidas. O usuário <systemitem class="username">root</systemitem> não tem permissão para montar ou desmontar sistemas de arquivos de dentro de uma <citerefentry><refentrytitle>jail</refentrytitle><manvolnum>8</manvolnum></citerefentry>. O <systemitem class="username">root</systemitem> dentro de uma jail não pode carregar ou descarregar conjuntos de regras <citerefentry><refentrytitle>devfs</refentrytitle><manvolnum>8</manvolnum></citerefentry>, definir regras de firewall, ou fazer muitas outras tarefas administrativas que requerem modificações de dados no kernel, como a configuração do <varname>securelevel</varname> do kernel.</para>

      <para>O sistema base do FreeBSD contém um conjunto básico de ferramentas para visualizar informações sobre as jails ativas e para se conectar a uma jail para executar comandos administrativos. Os comandos <citerefentry><refentrytitle>jls</refentrytitle><manvolnum>8</manvolnum></citerefentry> e <citerefentry><refentrytitle>jexec</refentrytitle><manvolnum>8</manvolnum></citerefentry> são parte do sistema base do FreeBSD, e podem ser usados para realizar as seguintes tarefas simples:</para>

      <itemizedlist>
	<listitem>
	  <para>Apresentar uma lista de jails ativas e seu identificador de jail correspondente (<acronym>JID</acronym>), endereço <acronym>IP</acronym>, hostname e path.</para>
	</listitem>

	<listitem>
	  <para>Se conectar a uma jail em execução, a partir de seu sistema host, e executar um comando dentro da jaijl ou executar tarefas administrativas dentro da própria jail. Isso é especialmente útil quando o usuário <systemitem class="username">root</systemitem> deseja desligar de maneira limpa uma jail. O utilitário <citerefentry><refentrytitle>jexec</refentrytitle><manvolnum>8</manvolnum></citerefentry> também pode ser usado para iniciar um shell em uma jail para administração; por exemplo:</para>

	  <screen><prompt>#</prompt> <userinput>jexec <replaceable>1</replaceable> tcsh</userinput></screen>
	</listitem>
      </itemizedlist>
    </sect2>

    <sect2 xml:id="jails-tuning-admintools">
      <title>Ferramentas Administrativas de Alto Nível na Coleção de Ports do FreeBSD</title>

      <para>Entre os muitos utilitários de terceiros para administração de jail, um dos mais completos e úteis é o <package>sysutils/ezjail</package>. É um conjunto de scripts que contribuem para o gerenciamento de <citerefentry><refentrytitle>jail</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Consulte a <link xlink:href="@@URL_RELPREFIX@@/doc/pt_BR.ISO8859-1/books/handbook/jails-ezjail.html">seção <application>ezjail</application> do handbook</link> para mais informações.</para>
    </sect2>

    <sect2 xml:id="jails-updating">
      <title>Mantendo as Jails com Alterações e Atualizadas</title>

      <para>As jails devem ser atualizadas a partir do sistema operacional do host, pois a tentativa de aplicar patchs no userland de dentro da jail pode falhar, já que o comportamento padrão no FreeBSD é não permitir o uso de <citerefentry><refentrytitle>chflags</refentrytitle><manvolnum>1</manvolnum></citerefentry> em uma jail, o que impede a substituição de alguns arquivos. É possível alterar esse comportamento, mas é recomendado usar o <citerefentry><refentrytitle>freebsd-update</refentrytitle><manvolnum>8</manvolnum></citerefentry> para atualizar as jails. Use <option>-b</option> para especificar o caminho da jail a ser atualizada.</para>

      <para>Para atualizar a Jail para o último release patch da versão do FreeBSD que já está em execução, execute os seguintes comandos no host:</para>

      <screen><prompt>#</prompt> <userinput>freebsd-update -b <replaceable>/here/is/the/jail</replaceable> fetch</userinput>
<prompt>#</prompt> <userinput>freebsd-update -b <replaceable>/here/is/the/jail</replaceable> install</userinput></screen>

      <para>Para atualizar a jail para uma versão maior ou menor, primeiro atualize o sistema hospedeiro com descrito em <xref linkend="freebsdupdate-upgrade"/>. Uma vez que o hospedeiro esteja atualizado e reiniciado, a jail pode então ser atualizada. Por exemplo, para atualizar de 12.0-RELEASE para 12.1-RELEASE, rode no hospedeiro:</para>

      <screen><prompt>#</prompt> <userinput>freebsd-update -b <replaceable>/here/is/the/jail</replaceable> --currently-running <replaceable>12.0-RELEASE</replaceable> -r <replaceable>12.1-RELEASE</replaceable> upgrade</userinput>
<prompt>#</prompt> <userinput>freebsd-update -b <replaceable>/here/is/the/jail</replaceable> install</userinput>
<prompt>#</prompt> <userinput>service jail restart <replaceable>myjail</replaceable></userinput>
<prompt>#</prompt> <userinput>freebsd-update -b <replaceable>/here/is/the/jail</replaceable> install</userinput></screen>

      <para>Então, se foi uma atualização de versão principal, reinstale todos os pacotes instalados e reinicie a jail novamente. Isso é necessário porque a versão ABI muda ao atualizar entre as versões principais do FreeBSD. Pelo host:</para>

      <screen><prompt>#</prompt> <userinput>pkg -j <replaceable>myjail</replaceable> upgrade -f</userinput>
<prompt>#</prompt> <userinput>service jail restart <replaceable>myjail</replaceable></userinput></screen>

    </sect2>
  </sect1>

  <sect1 xml:id="jails-application">
    <info>
      <title>Atualizando Múltiplas Jails</title>

      <authorgroup>
	<author><personname> <firstname>Daniel</firstname> <surname>Gerzo</surname> </personname> <contrib>Contribuido por </contrib></author>
      </authorgroup>
      <authorgroup>
	<author><personname> <firstname>Simon</firstname> <surname>L. B. Nielsen</surname> </personname> <contrib>Baseado em uma idéia apresentada por </contrib></author>
      </authorgroup>
      <authorgroup>
	<author><personname> <firstname>Ken</firstname> <surname>Tom</surname> </personname> <contrib>E artigo escrito por </contrib></author>
      </authorgroup>
    </info>

    <para>O gerenciamento de várias jails pode se tornar problemático porque toda jail tem que ser recompilada a partir do zero sempre que for atualizada. Isso pode ser demorado e entediante se muitas jails forem criadas e atualizadas manualmente.</para>

    <para>Esta seção demonstra um método para resolver esse problema compartilhando com segurança o máximo possível entre jails usando montagens somente leitura <citerefentry><refentrytitle>mount_nullfs</refentrytitle><manvolnum>8</manvolnum></citerefentry>, para que a atualização seja mais simples. Isso torna mais atraente colocar serviços únicos, como <acronym>HTTP</acronym>, <acronym>DNS</acronym> e <acronym>SMTP</acronym>, em jails individuais. Além disso, fornece uma maneira simples de adicionar, remover e atualizar jails.</para>

    <note>
      <para>Existem soluções mais simples, como o <application>ezjail</application>, que fornece um método mais fácil de administrar as jails do FreeBSD, mas é menos versátil que essa configuração. O <application>ezjail</application> é coberto com mais detalhes em <xref linkend="jails-ezjail"/>.</para>
    </note>

    <para>Os objetivos da configuração descrita nesta seção são:</para>

    <itemizedlist>
      <listitem>
	<para>Criar uma estrutura de jail simples e fácil de entender que não exija a execução de um installworld completo em todas as jails.</para>
      </listitem>

      <listitem>
	<para>Facilitar a adição de novas jails ou remoção das já existentes.</para>
      </listitem>

      <listitem>
	<para>Facilitar a atualização ou upgrade de jails existentes.</para>
      </listitem>

      <listitem>
	<para>Tornar possível a utilização de uma branch customizada do FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Seja paranoico com a segurança, reduzindo ao máximo a possibilidade de comprometimento.</para>
      </listitem>

      <listitem>
	<para>Economize espaço e inodes, tanto quanto possível.</para>
      </listitem>
    </itemizedlist>

    <para>Esse design depende de um template master único, read-only, que é montado em cada jail e em um dispositivo read-write por jail. Um dispositivo pode ser um disco físico separado, uma partição ou um dispositivo de memória com suporte a vnode. Este exemplo usa montagens <application>nullfs</application> read-write.</para>

    <para>O layout do sistema de arquivos é o seguinte:</para>

    <itemizedlist>
      <listitem>
	<para>As jails são hospedadas na partição <filename>/home</filename>.</para>
      </listitem>

      <listitem>
	<para>Cada jail será montada no diretório <filename>/home/j</filename>.</para>
      </listitem>

      <listitem>
	<para>O template para cada jail e a partição read-only para todos as jails é <filename>/home/j/mroot</filename>.</para>
      </listitem>

      <listitem>
	<para>Um diretório em branco será criado para cada jail no diretório <filename>/home/j</filename>.</para>
      </listitem>

      <listitem>
	<para>Cada jail terá um diretório <filename>/s</filename> que será vinculado à parte de read-write do sistema.</para>
      </listitem>

      <listitem>
	<para>Cada jail terá seu próprio sistema de read-write baseado em <filename>/home/j/skel</filename>.</para>
      </listitem>

      <listitem>
	<para>A parte de read-write de cada jail será criada em <filename>/home/js</filename>.</para>
      </listitem>
    </itemizedlist>

	<!-- Insert an image or drawing here to illustrate the example. -->

    <sect2 xml:id="jails-service-jails-template">
      <title>Criando o Template</title>

      <para>Esta seção descreve as etapas necessárias para criar o template master.</para>

      <para>É recomendado primeiramente atualizar o sistema host FreeBSD para a branch -RELEASE mais recente usando as instruções em <xref linkend="makeworld"/>. Adicionalmente, este template usa o pacote ou port <package>sysutils/cpdup</package> e o <application>portsnap</application> será utilizado para baixar a Coleção de Ports do FreeBSD.</para>

      <procedure>
	<step>
	  <para>Primeiro, crie uma estrutura de diretório para o sistema de arquivo read-only que conterá os binários do FreeBSD para as jails. Em seguida, altere para o diretório de código-fonte do FreeBSD e instale o sistema de arquivos read-only no template das jails:</para>

	  <screen><prompt>#</prompt> <userinput>mkdir /home/j /home/j/mroot</userinput>
<prompt>#</prompt> <userinput>cd /usr/src</userinput>
<prompt>#</prompt> <userinput>make installworld DESTDIR=/home/j/mroot</userinput></screen>
	</step>

	<step>
	  <para>Em seguida, prepare uma Coleção de Ports do FreeBSD para as jails, assim como uma árvore de código fonte do FreeBSD, que são necessários para o  <application>mergemaster</application>:</para>

	  <screen><prompt>#</prompt> <userinput>cd /home/j/mroot</userinput>
<prompt>#</prompt> <userinput>mkdir usr/ports</userinput>
<prompt>#</prompt> <userinput>portsnap -p /home/j/mroot/usr/ports fetch extract</userinput>
<prompt>#</prompt> <userinput>cpdup /usr/src /home/j/mroot/usr/src</userinput></screen>
	</step>

	<step>
	  <para>Crie um esqueleto para a parte de read-write do sistema:</para>

	  <screen><prompt>#</prompt> <userinput>mkdir /home/j/skel /home/j/skel/home /home/j/skel/usr-X11R6 /home/j/skel/distfiles</userinput>
<prompt>#</prompt> <userinput>mv etc /home/j/skel</userinput>
<prompt>#</prompt> <userinput>mv usr/local /home/j/skel/usr-local</userinput>
<prompt>#</prompt> <userinput>mv tmp /home/j/skel</userinput>
<prompt>#</prompt> <userinput>mv var /home/j/skel</userinput>
<prompt>#</prompt> <userinput>mv root /home/j/skel</userinput></screen>
	</step>

	<step>
	  <para>Use o <application>mergemaster</application> para instalar os arquivos de configuração ausentes. Em seguida, remova os diretórios extras criados pelo <application>mergemaster</application>:</para>

	  <screen><prompt>#</prompt> <userinput>mergemaster -t /home/j/skel/var/tmp/temproot -D /home/j/skel -i</userinput>
<prompt>#</prompt> <userinput>cd /home/j/skel</userinput>
<prompt>#</prompt> <userinput>rm -R bin boot lib libexec mnt proc rescue sbin sys usr dev</userinput></screen>
	</step>

	<step>
	  <para>Agora, faça os links dos sistema de arquivos read-write ao sistema de arquivos read-only. Certifique-se de que os links simbólicos sejam criados nos locais corretos de <filename>s/</filename>, pois a criação de diretórios nos locais errados fará com que a instalação falhe.</para>

	  <screen><prompt>#</prompt> <userinput>cd /home/j/mroot</userinput>
<prompt>#</prompt> <userinput>mkdir s</userinput>
<prompt>#</prompt> <userinput>ln -s s/etc etc</userinput>
<prompt>#</prompt> <userinput>ln -s s/home home</userinput>
<prompt>#</prompt> <userinput>ln -s s/root root</userinput>
<prompt>#</prompt> <userinput>ln -s ../s/usr-local usr/local</userinput>
<prompt>#</prompt> <userinput>ln -s ../s/usr-X11R6 usr/X11R6</userinput>
<prompt>#</prompt> <userinput>ln -s ../../s/distfiles usr/ports/distfiles</userinput>
<prompt>#</prompt> <userinput>ln -s s/tmp tmp</userinput>
<prompt>#</prompt> <userinput>ln -s s/var var</userinput></screen>
	</step>

	<step>
	  <para>Como último passo, crie um arquivo <filename>/home/j/skel/etc/make.conf</filename> genérico contendo esta linha:</para>

	  <programlisting>WRKDIRPREFIX?=  /s/portbuild</programlisting>

	  <para>Isto torna possível compilar ports do FreeBSD dentro de cada jail. Lembre-se de que o diretório do ports faz parte do sistema somente leitura. O caminho customizado para o <literal>WRKDIRPREFIX</literal> permite que compilações sejam feitas na parte read-write de cada jail.</para>
	</step>
      </procedure>
    </sect2>

    <sect2 xml:id="jails-service-jails-creating">
      <title>Criando Jails</title>

      <para>O template jail agora pode ser usado para preparar e configurar as jails no arquivo  <filename>/etc/rc.conf</filename>. Este exemplo demonstra a criação de 3 jails: <literal>NS</literal>, <literal>MAIL</literal> e <literal>WWW</literal>.</para>

      <procedure>
	<step>
	  <para>Adicione as seguintes linhas ao arquivo <filename>/etc/fstab</filename>, para que o template read-only e o espaço read-write das jails estejam disponível nas respectivas jails:</para>

	  <programlisting>/home/j/mroot   /home/j/ns     nullfs  ro  0   0
/home/j/mroot   /home/j/mail   nullfs  ro  0   0
/home/j/mroot   /home/j/www    nullfs  ro  0   0
/home/js/ns     /home/j/ns/s   nullfs  rw  0   0
/home/js/mail   /home/j/mail/s nullfs  rw  0   0
/home/js/www    /home/j/www/s  nullfs  rw  0   0</programlisting>

	  <para>Para evitar que o <application>fsck</application> verifique as montagens <application>nullfs</application> durante a inicialização e o <application>dump</application> faça backup das montagens nullfs read-only das jails, as duas últimas colunas são ambos definidos para <literal>0</literal>.</para>
	</step>

	<step>
	  <para>Configure as jails no arquivo <filename>/etc/rc.conf</filename>:</para>

	  <programlisting>jail_enable="YES"
jail_set_hostname_allow="NO"
jail_list="ns mail www"
jail_ns_hostname="ns.example.org"
jail_ns_ip="192.168.3.17"
jail_ns_rootdir="/usr/home/j/ns"
jail_ns_devfs_enable="YES"
jail_mail_hostname="mail.example.org"
jail_mail_ip="192.168.3.18"
jail_mail_rootdir="/usr/home/j/mail"
jail_mail_devfs_enable="YES"
jail_www_hostname="www.example.org"
jail_www_ip="62.123.43.14"
jail_www_rootdir="/usr/home/j/www"
jail_www_devfs_enable="YES"</programlisting>

	  <para>A variável <varname>jail_<replaceable>name</replaceable>_rootdir</varname> é configurada como <filename>/usr/home</filename> em vez de <filename>/home</filename> porque o caminho físico de <filename>/home</filename> em uma instalação padrão do FreeBSD é <filename>/usr/home</filename>. A variável <varname>jail_<replaceable>name</replaceable>_rootdir</varname> <emphasis>não</emphasis> deve ser configurada para um caminho que inclua um link simbólico, caso contrário as jails não serão iniciadas.</para>
	</step>

	<step>
	  <para>Crie os pontos de montagem necessários para o sistema de arquivos read-only de cada jail:</para>

	  <screen><prompt>#</prompt> <userinput>mkdir /home/j/ns /home/j/mail /home/j/www</userinput></screen>
	</step>

	<step>
	  <para>Instale o template read-write em cada jail usando <package>sysutils/cpdup</package>:</para>
	    <!-- keramida: Why is cpdup required here?  Doesn't cpio(1)
	     already include adequate functionality for performing this
	     job *and* have the advantage of being part of the base
	     system of FreeBSD? -->

	  <screen><prompt>#</prompt> <userinput>mkdir /home/js</userinput>
<prompt>#</prompt> <userinput>cpdup /home/j/skel /home/js/ns</userinput>
<prompt>#</prompt> <userinput>cpdup /home/j/skel /home/js/mail</userinput>
<prompt>#</prompt> <userinput>cpdup /home/j/skel /home/js/www</userinput></screen>
	</step>

	<step>
	  <para>Nesta fase, as jails estão compiladas e preparadas para execução. Primeiro, monte os sistemas de arquivos necessários para cada jail e, em seguida, inicie-as:</para>

	  <screen><prompt>#</prompt> <userinput>mount -a</userinput>
<prompt>#</prompt> <userinput>service jail start</userinput></screen>
	</step>
      </procedure>

      <para>As jails devem estar funcionando agora. Para verificar se eles foram iniciadas corretamente, use <command>jls</command>. Sua saída deve ser semelhante ao seguinte:</para>

      <screen><prompt>#</prompt> <userinput>jls</userinput>
   JID  IP Address      Hostname                      Path
     3  192.168.3.17    ns.example.org                /home/j/ns
     2  192.168.3.18    mail.example.org              /home/j/mail
     1  62.123.43.14    www.example.org               /home/j/www</screen>

      <para>Neste ponto, deve ser possível entrar em cada jail, adicionar novos usuários ou configurar daemons. A coluna <literal>JID</literal> indica o número de identificação da jail de cada jail em execução. Use o seguinte comando para executar tarefas administrativas na jail cujo <acronym>JID</acronym> é <literal>3</literal>:</para>

      <screen><prompt>#</prompt> <userinput>jexec 3 tcsh</userinput></screen>
    </sect2>

    <sect2 xml:id="jails-service-jails-upgrading">
      <title>Fazendo Upgrade</title>

      <para>O design dessa configuração fornece uma maneira fácil de atualizar as jails existentes, minimizando o tempo de downtime. Além disso, fornece uma maneira de reverter para a versão mais antiga, caso ocorra algum problema.</para>

      <procedure>
	<step>
	  <para>O primeiro passo é atualizar o sistema host. Em seguida, crie um novo template temporário read-only em <filename>/home/j/mroot2</filename>.</para>

	  <screen><prompt>#</prompt> <userinput>mkdir /home/j/mroot2</userinput>
<prompt>#</prompt> <userinput>cd /usr/src</userinput>
<prompt>#</prompt> <userinput>make installworld DESTDIR=/home/j/mroot2</userinput>
<prompt>#</prompt> <userinput>cd /home/j/mroot2</userinput>
<prompt>#</prompt> <userinput>cpdup /usr/src usr/src</userinput>
<prompt>#</prompt> <userinput>mkdir s</userinput></screen>

	  <para>O <buildtarget>installworld</buildtarget> cria alguns diretórios desnecessários, que devem ser removidos:</para>

	  <screen><prompt>#</prompt> <userinput>chflags -R 0 var</userinput>
<prompt>#</prompt> <userinput>rm -R etc var root usr/local tmp</userinput></screen>
	</step>

	<step>
	  <para>Recrie os links simbólicos read-write para o sistema de arquivos master:</para>

	  <screen><prompt>#</prompt> <userinput>ln -s s/etc etc</userinput>
<prompt>#</prompt> <userinput>ln -s s/root root</userinput>
<prompt>#</prompt> <userinput>ln -s s/home home</userinput>
<prompt>#</prompt> <userinput>ln -s ../s/usr-local usr/local</userinput>
<prompt>#</prompt> <userinput>ln -s ../s/usr-X11R6 usr/X11R6</userinput>
<prompt>#</prompt> <userinput>ln -s s/tmp tmp</userinput>
<prompt>#</prompt> <userinput>ln -s s/var var</userinput></screen>
	</step>

	<step>
	  <para>Em seguida, pare as jails:</para>

	  <screen><prompt>#</prompt> <userinput>service jail stop</userinput></screen>
	</step>

	<step>
	  <para>Desmonte os sistemas de arquivos originais, pois os sistemas read-write estão conectados ao sistema read-only (<filename>/s</filename>):</para>
	    <!-- keramida: Shouldn't we suggest a short script-based
	     loop here, instead of tediously copying the same commands
	     multiple times? -->

	  <screen><prompt>#</prompt> <userinput>umount /home/j/ns/s</userinput>
<prompt>#</prompt> <userinput>umount /home/j/ns</userinput>
<prompt>#</prompt> <userinput>umount /home/j/mail/s</userinput>
<prompt>#</prompt> <userinput>umount /home/j/mail</userinput>
<prompt>#</prompt> <userinput>umount /home/j/www/s</userinput>
<prompt>#</prompt> <userinput>umount /home/j/www</userinput></screen>
	</step>

	<step>
	  <para>Mova o antigo sistema de arquivos read-only e substitua-o pelo novo. Isso servirá como backup e arquivamento do antigo sistema de arquivos read-only se algo der errado. A convenção de nomenclatura usada aqui corresponde a quando um novo sistema de arquivos read-only foi criado. Mova a Coleção de Ports do FreeBSD original para o novo sistema de arquivos para economizar espaço e inodes:</para>

	  <screen><prompt>#</prompt> <userinput>cd /home/j</userinput>
<prompt>#</prompt> <userinput>mv mroot mroot.20060601</userinput>
<prompt>#</prompt> <userinput>mv mroot2 mroot</userinput>
<prompt>#</prompt> <userinput>mv mroot.20060601/usr/ports mroot/usr</userinput></screen>
	</step>

	<step>
	  <para>Neste ponto, o novo template read-only está pronto, então a única tarefa restante é remontar os sistemas de arquivos e iniciar as jails:</para>

	  <screen><prompt>#</prompt> <userinput>mount -a</userinput>
<prompt>#</prompt> <userinput>service jail start</userinput></screen>
	</step>
      </procedure>

      <para>Use <command>jls</command> para verificar se as jails foram iniciadas corretamente. Execute <command>mergemaster</command> em cada jail para atualizar os arquivos de configuração.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="jails-ezjail">
    <info>
      <title>Gerenciando Jails com o <application>ezjail</application></title>

      <authorgroup>
	<author><personname><firstname>Warren</firstname> <surname>Block</surname> </personname><contrib> Originalmente contribuído por </contrib></author>
      </authorgroup>
    </info>

    <para>Criar e gerenciar múltiplas jails pode se tornar um trabalho tedioso e propenso a erros. O <application>ezjail</application> de Dirk Engling automatiza e simplifica muito as tarefas de jails. Uma <emphasis>basejail</emphasis> é criada como um template. Jails adicionais usam <citerefentry><refentrytitle>mount_nullfs</refentrytitle><manvolnum>8</manvolnum></citerefentry> para compartilhar muitos dos diretórios da basejail sem usar espaço em disco adicional. Cada jail adicional leva apenas alguns megabytes de espaço em disco antes que os aplicativos sejam instalados. A atualização da cópia do userland na basejail atualiza automaticamente todas as outras jails.</para>

    <para>Benefícios e recursos adicionais são descritos em detalhes no site do <application>ezjail</application>, <link xlink:href="https://erdgeist.org/arts/software/ezjail/"/>.</para>

    <sect2 xml:id="jails-ezjail-install">
      <title>Instalando o <application>ezjail</application></title>

      <para>A instalação do <application>ezjail</application> consiste na inclusão de uma interface de loopback para uso nas jails, instalação do port ou pacote e ativação do serviço.</para>

      <procedure xml:id="jails-ezjail-install-procedure">
	<step>
	  <para>Para manter o tráfego de loopback da jail fora da interface de rede de loopback do host <literal>lo0</literal>, uma segunda interface de loopback é criada adicionando uma entrada no arquivo <filename>/etc/rc.conf</filename>:</para>

	  <programlisting>cloned_interfaces="lo1"</programlisting>

	  <para>A segunda interface de loopback <literal>lo1</literal> será criada quando o sistema for iniciado. Também pode ser criado manualmente sem reiniciar:</para>

	  <screen><prompt>#</prompt> <userinput>service netif cloneup</userinput>
Created clone interfaces: lo1.</screen>

	  <para>Jails podem ter permissão para usar aliases dessa interface de loopback secundária sem interferir no host.</para>

	  <para>Dentro de uma jail, o acesso ao endereço de loopback <systemitem class="ipaddress">127.0.0.1</systemitem> é redirecionado para o primeiro endereço de <acronym>IP</acronym> atribuído à jail. Para fazer com que o loopback da jail corresponda à nova interface <literal>lo1</literal>, essa interface deve ser especificada primeiro na lista de interfaces e endereços <acronym>IP</acronym> fornecidos ao criar uma nova jail.</para>

	  <para>Dê a cada jail um endereço de loopback exclusivo no bloco de rede <systemitem class="ipaddress">127.0.0.0</systemitem><systemitem class="netmask">/8</systemitem>.</para>
	</step>

	<step>
	  <para>Instale o <package role="port">sysutils/ezjail</package>:</para>

	  <screen><prompt>#</prompt> <userinput>cd /usr/ports/sysutils/ezjail</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>
	</step>

	<step>
	  <para>Ative o <application>ezjail</application> adicionando esta linha ao arquivo <filename>/etc/rc.conf</filename>:</para>

	  <programlisting>ezjail_enable="YES"</programlisting>
	</step>

	<step>
	  <para>O serviço será iniciado automaticamente na inicialização do sistema. Ele pode ser iniciado imediatamente na sessão atual:</para>

	  <screen><prompt>#</prompt> <userinput>service ezjail start</userinput></screen>
	</step>
      </procedure>
    </sect2>

    <sect2 xml:id="jails-ezjail-initialsetup">
      <title>Configuração inicial</title>

      <para>Com o <application>ezjail</application> instalado, a estrutura do diretório basejail pode ser criada e preenchida. Esta etapa é necessária apenas uma vez no computador host da jail.</para>

      <para>Em ambos os exemplos, <option>-p</option> faz com que a árvore de ports seja baixada com o <citerefentry><refentrytitle>portsnap</refentrytitle><manvolnum>8</manvolnum></citerefentry> para a basejail. Essa cópia única do diretório de ports será compartilhada por todas as jails. Usar uma cópia separada do diretório de ports para jails isola-os do host. O <application>ezjail</application> é explicado com mais detalhes no <acronym>FAQ</acronym>: <link xlink:href="http://erdgeist.org/arts/software/ezjail/#FAQ"/>.</para>

      <procedure xml:id="jails-ezjail-initialsetup-procedure">
	<step>
	  <stepalternatives>
	    <step>
	      <title>Preencher a Jail com o FreeBSD-RELEASE</title>

	      <para>Para uma basejail baseada na mesma versão FreeBSD RELEASE do computador host, use o comando <command>install</command>. Por exemplo, em um computador host executando o FreeBSD 10-STABLE, a versão mais recente do FreeBSD -10 será instalada na jail:</para>

	      <screen><prompt>#</prompt> <userinput>ezjail-admin install -p</userinput></screen>
	    </step>

	    <step>
	      <title>Preencher a Jail com o comando <command>installworld</command></title>

	      <para>A basejail pode ser instalada a partir de binários criados pelo <buildtarget>buildworld</buildtarget> no host com <command>ezjail-admin update</command>.</para>

	      <para>Neste exemplo, o FreeBSD 10-STABLE foi compilado a partir do código fonte. Os diretórios da jail são criados. E então <buildtarget>installworld</buildtarget> é executado, instalando o <filename>/usr/obj</filename> do host na basejail.</para>

	      <screen><prompt>#</prompt> <userinput>ezjail-admin update -i -p</userinput></screen>

	      <para>O <filename>/usr/src</filename> do host é usado por padrão. Um diretório de código fonte diferente no host pode ser especificado com <option>-s</option> e um caminho ou com <varname>ezjail_sourcetree</varname> em <filename>/usr/local/etc/ezjail.conf</filename>.</para>
	    </step>
	  </stepalternatives>
	</step>
      </procedure>

      <tip>
	<para>A árvore de ports da basejail é compartilhada por outras jails. No entanto, os distfiles baixados são armazenados na jail que os baixou. Por padrão, esses arquivos são armazenados em <filename>/var/ports/distfiles</filename> dentro de cada jail. <filename>/var/ports</filename> dentro de cada jail também é usado como um diretório de trabalho ao compilar ports.</para>
      </tip>

      <tip>
	<para>O protocolo <acronym>FTP</acronym> é usado por padrão para baixar pacotes para a instalação da basejail. Configurações de firewall ou proxy podem impedir ou interferir nas transferências de <acronym>FTP</acronym>. O protocolo <acronym>HTTP</acronym> funciona de maneira diferente e evita esses problemas. Ele pode ser escolhido especificando uma <acronym>URL</acronym> completa para um espelho de download específico no arquivo <filename>/usr/local/etc/ezjail.conf</filename>:</para>

	<programlisting>ezjail_ftphost=http://<replaceable>ftp.FreeBSD.org</replaceable></programlisting>

	<para>Veja <xref linkend="mirrors-ftp"/> para uma lista de sites.</para>
      </tip>
    </sect2>

    <sect2 xml:id="jails-ezjail-create">
      <title>Criando e Iniciando uma Nova Jail</title>

      <para>Novas jails são criadas com o comando <command>ezjail-admin create</command>. Nestes exemplos, a interface de loopback <literal>lo1</literal> é usada conforme descrito acima.</para>

      <procedure xml:id="jails-ezjail-create-steps">
	<title>Crie e Inicie uma Nova Jail</title>

	<step>
	  <para>Crie a jail, especificando um nome e as interfaces de loopback e de rede a serem usadas, junto com seus endereços <acronym>IP</acronym>. Neste exemplo, a jail é denominada <literal>dnsjail</literal>.</para>

	  <screen><prompt>#</prompt> <userinput>ezjail-admin create <replaceable>dnsjail</replaceable> '<replaceable>lo1|127.0.1.1</replaceable>,<replaceable>em0</replaceable>|<replaceable>192.168.1.50</replaceable>'</userinput></screen>

	  <tip xml:id="jails-ezjail-raw-network-sockets">
	    <para>A maioria dos serviços de rede são executados em jails sem problemas. Alguns serviços de rede, como <citerefentry><refentrytitle>ping</refentrytitle><manvolnum>8</manvolnum></citerefentry>, usam <emphasis>raw network sockets</emphasis>. Nas jails, raw network sockets são desativados por padrão para segurança. Serviços que exigem eles não irão funcionar.</para>

	    <para>Ocasionalmente, uma jail pode realmente precisar de raw sockets. Por exemplo, os aplicativos de monitoramento de rede geralmente usam <citerefentry><refentrytitle>ping</refentrytitle><manvolnum>8</manvolnum></citerefentry> para verificar a disponibilidade de outros computadores. Quando raw network sockets são realmente necessários em uma jail, eles podem ser ativados editando o arquivo de configuração do <application>ezjail</application> para uma jail individual, <filename>/usr/local/etc/ezjail/<replaceable>jailname</replaceable></filename>. Modifique a entrada <literal>parameters</literal>:</para>

	    <programlisting>export jail_<replaceable>jailname</replaceable>_parameters="allow.raw_sockets=1"</programlisting>

	    <para>Não habilite raw network sockets, a menos que os serviços na jail realmente precisem deles.</para>
	  </tip>
	</step>

	<step>
	  <para>Inicie a jail:</para>

	  <screen><prompt>#</prompt> <userinput>ezjail-admin start <replaceable>dnsjail</replaceable></userinput></screen>
	</step>

	<step>
	  <para>Use um console na jail:</para>

	  <screen><prompt>#</prompt> <userinput>ezjail-admin console <replaceable>dnsjail</replaceable></userinput></screen>
	</step>
      </procedure>

      <para>A jail está funcionando e configurações adicionais podem ser realizadas. Configurações típicas adicionadas neste momento incluem:</para>

      <procedure>
	<step>
	  <title>Defina a Senha de <systemitem class="username">root</systemitem></title>

	  <para>Conecte-se à jail e configure a senha do usuário <systemitem class="username">root</systemitem>:</para>

	  <screen><prompt>#</prompt> <userinput>ezjail-admin console <replaceable>dnsjail</replaceable></userinput>
<prompt>#</prompt> <userinput>passwd</userinput>
Changing local password for root
New Password:
Retype New Password:</screen>
	</step>

	<step>
	  <title>Configuração de Fuso Horário</title>

	  <para>O fuso horário da jail pode ser definido com <citerefentry><refentrytitle>tzsetup</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Para evitar mensagens de erro espúrias, a entrada <citerefentry><refentrytitle>adjkerntz</refentrytitle><manvolnum>8</manvolnum></citerefentry> em <filename>/etc/crontab</filename> pode ser comentada ou removida. Este comando tenta atualizar o relógio de hardware do computador com alterações de fuso horário, mas as jails não têm permissão para acessar esse hardware.</para>
	</step>

	<step>
	  <title>Servidores <acronym>DNS</acronym></title>

	  <para>Insira as linhas com o servidor de nomes de domínio no arquivo <filename>/etc/resolv.conf</filename> para que o <acronym>DNS</acronym> funcione na jail.</para>
	</step>

	<step>
	  <title>Edite o arquivo <filename>/etc/hosts</filename></title>

	  <para>Altere o endereço e adicione o nome da jail para as entradas <literal>localhost</literal> no <filename>/etc/hosts</filename>.</para>
	</step>

	<step>
	  <title>Configure o arquivo <filename>/etc/rc.conf</filename></title>

	  <para>Digite as definições de configuração no arquivo <filename>/etc/rc.conf</filename>. Isso é muito parecido com a configuração de um computador completo. O nome do host e o endereço <acronym>IP</acronym> não estão definidos aqui. Esses valores já são fornecidos pela configuração da jail.</para>
	</step>
      </procedure>

      <para>Com a jail configurada, os aplicativos para os quais a jail foi criada podem ser instalados.</para>

      <tip>
	<para>Alguns ports devem ser compilados com opções especiais para serem usados em uma jail. Por exemplo, os dois pacotes de plugin de monitoramento de rede <package role="port">net-mgmt/nagios-plugins</package> e <package role="port">net-mgmt/monitoring-plugins</package> possuem uma opção <literal>JAIL</literal> que deve ser ativada para que funcionem corretamente dentro de uma jail.</para>
      </tip>
    </sect2>

    <sect2 xml:id="jails-ezjail-update">
      <title>Atualizando as Jails</title>

      <sect3 xml:id="jails-ezjail-update-os">
	<title>Atualizando o Sistema Operacional</title>

	<para>Como a cópia do userland da basejail é compartilhada pelas outras jails, a atualização da basejail atualiza automaticamente todas as outras jails. Atualizações binárias ou por código fonte podem ser usadas.</para>

	<para>Para compilar o world a partir do código fonte no host, e depois instala-lo na basejail, use:</para>

	<screen><prompt>#</prompt> <userinput>ezjail-admin update -b</userinput></screen>

	<para>Se o world já estiver sido compilado no host, instale-o no basejail com:</para>

	<screen><prompt>#</prompt> <userinput>ezjail-admin update -i</userinput></screen>

	<para>Atualizações binárias usam o <citerefentry><refentrytitle>freebsd-update</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Essas atualizações têm as mesmas limitações como se o <citerefentry><refentrytitle>freebsd-update</refentrytitle><manvolnum>8</manvolnum></citerefentry> estivesse sendo executado diretamente. O mais importante é que apenas as versões -RELEASE do FreeBSD estão disponíveis com este método.</para>

	<para>Atualize a basejail para a última versão de patchs da versão do FreeBSD no host. Por exemplo, atualizando de RELEASE-p1 para RELEASE-p2.</para>

	<screen><prompt>#</prompt> <userinput>ezjail-admin update -u</userinput></screen>

	<para>Para atualizar a basejail para uma nova versão, primeiro atualize o sistema host como descrito em <xref linkend="freebsdupdate-upgrade"/>. Depois que o host tiver sido atualizado e reinicializado, a basejail poderá ser atualizada. O <citerefentry><refentrytitle>freebsd-update</refentrytitle><manvolnum>8</manvolnum></citerefentry> não tem como determinar qual versão está atualmente instalada na basejail, então a versão original deve ser especificada. Use o <citerefentry><refentrytitle>file</refentrytitle><manvolnum>1</manvolnum></citerefentry> para determinar a versão original na basejail:</para>

	<screen><prompt>#</prompt> <userinput>file /usr/jails/basejail/bin/sh</userinput>
/usr/jails/basejail/bin/sh: ELF 64-bit LSB executable, x86-64, version 1 (FreeBSD), dynamically linked (uses shared libs), for FreeBSD 9.3, stripped</screen>

	<para>Agora use essas informações para executar a atualização de <literal>9.3-RELEASE</literal> para a versão atual do sistema host:</para>

	<screen><prompt>#</prompt> <userinput>ezjail-admin update -U -s <replaceable>9.3-RELEASE</replaceable></userinput></screen>

	<para>Depois de atualizar a basejail, o <citerefentry><refentrytitle>mergemaster</refentrytitle><manvolnum>8</manvolnum></citerefentry> deve ser executado para atualizar os arquivos de configuração de cada jail.</para>

	<para>Como usar o <citerefentry><refentrytitle>mergemaster</refentrytitle><manvolnum>8</manvolnum></citerefentry> depende do propósito e da confiabilidade de uma jail. Se os serviços ou usuários de uma jail não são confiáveis, então o <citerefentry><refentrytitle>mergemaster</refentrytitle><manvolnum>8</manvolnum></citerefentry> deve ser executado somente dentro dessa jail:</para>

	<example xml:id="jails-ezjail-update-mergemaster-untrusted">
	  <title><citerefentry><refentrytitle>mergemaster</refentrytitle><manvolnum>8</manvolnum></citerefentry> em Jail Não Confiável</title>

	  <para>Exclua o link do <filename>/usr/src</filename> da jail para a basejail e crie um novo <filename>/usr/src</filename> na jail como um ponto de montagem. Monte o <filename>/usr/src</filename> do computador host como read-only no novo ponto de montagem <filename>/usr/src</filename> da jail:</para>

	  <screen><prompt>#</prompt> <userinput>rm /usr/jails/<replaceable>jailname</replaceable>/usr/src</userinput>
<prompt>#</prompt> <userinput>mkdir /usr/jails/<replaceable>jailname</replaceable>/usr/src</userinput>
<prompt>#</prompt> <userinput>mount -t nullfs -o ro /usr/src /usr/jails/<replaceable>jailname</replaceable>/usr/src</userinput></screen>

	  <para>Execute um console na jail:</para>

	  <screen><prompt>#</prompt> <userinput>ezjail-admin console <replaceable>jailname</replaceable></userinput></screen>

	  <para>Dentro da jail, execute <command>mergemaster</command>. Em seguida, saia do console da jail:</para>

	  <screen><prompt>#</prompt> <userinput>cd /usr/src</userinput>
<prompt>#</prompt> <userinput>mergemaster -U</userinput>
<prompt>#</prompt> <userinput>exit</userinput></screen>

	  <para>Finalmente, desmonte o <filename>/usr/src</filename> da jail:</para>

	  <screen><prompt>#</prompt> <userinput>umount /usr/jails/<replaceable>jailname</replaceable>/usr/src</userinput></screen>
	</example>

	<example xml:id="jails-ezjail-update-mergemaster-trusted">

	  <title><citerefentry><refentrytitle>mergemaster</refentrytitle><manvolnum>8</manvolnum></citerefentry> em Jail Confiável</title>

	  <para>Se os usuários e serviços em uma jail forem confiáveis, o <citerefentry><refentrytitle>mergemaster</refentrytitle><manvolnum>8</manvolnum></citerefentry> pode ser executado a partir do host:</para>

	  <screen><prompt>#</prompt> <userinput>mergemaster -U -D /usr/jails/<replaceable>jailname</replaceable></userinput></screen>
	</example>

	<tip>
	  <para>Após uma atualização de versão principal, é recomendado pelo <package>sysutils/ezjail</package> garantir que o <command>pkg</command> seja da versão correta. Portanto, digite:</para>

	    <screen><prompt>#</prompt> <userinput>pkg-static upgrade -f pkg</userinput></screen>

	  <para>para atualizar ou fazer o downgrade para a versão apropriada.</para>
	</tip>
      </sect3>

      <sect3 xml:id="jails-ezjail-update-ports">
	<title>Atualizando o Ports</title>

	<para>A árvore de ports na basejail é compartilhada pelas outras jails. A atualização dessa cópia da árvore de ports fornece às outras jails a versão atualizada também.</para>

	<para>A árvore de ports da basejail é atualizada com o <citerefentry><refentrytitle>portsnap</refentrytitle><manvolnum>8</manvolnum></citerefentry>:</para>

	<screen><prompt>#</prompt> <userinput>ezjail-admin update -P</userinput></screen>
      </sect3>
    </sect2>

    <sect2 xml:id="jails-ezjail-control">
      <title>Controlando as Jails</title>

      <sect3 xml:id="jails-ezjail-control-stop-start">
	<title>Parando e Iniciando Jails</title>

	<para>O <application>ezjail</application> inicia automaticamente as jails quando o computador é iniciado. As jails podem ser manualmente paradas e reiniciadas com <command>stop</command> e <command>start</command>:</para>

	<screen><prompt>#</prompt> <userinput>ezjail-admin stop <replaceable>sambajail</replaceable></userinput>
Stopping jails: sambajail.</screen>

	<para>Por padrão, as jails são iniciadas automaticamente quando o computador host é iniciado. A inicialização automática pode ser desativada com <command>config</command>:</para>

	<screen><prompt>#</prompt> <userinput>ezjail-admin config -r norun <replaceable>seldomjail</replaceable></userinput></screen>

	<para>Isso entrará em vigor na próxima vez em que o computador host for iniciado. Uma jail que já está em execução não será interrompida.</para>

	<para>A ativação do início automático é muito semelhante:</para>

	<screen><prompt>#</prompt> <userinput>ezjail-admin config -r run <replaceable>oftenjail</replaceable></userinput></screen>
      </sect3>

      <sect3 xml:id="jails-ezjail-control-backup">
	<title>Arquivando e Restaurando Jails</title>

	<para>Use <command>archive</command> para criar um arquivo <filename>.tar.gz</filename> de uma jail. O nome do arquivo é composto pelo nome da jail e pela data atual. Os archives são gravados no diretório de archive, <filename>/usr/jails/ezjail_archives</filename>. Um diretório de archive diferente pode ser escolhido configurando <varname>ezjail_archivedir</varname> no arquivo de configuração.</para>

	<para>O archive pode ser copiado em outro lugar como um backup, ou uma jail existente pode ser restaurada a partir dele com o <command>restore</command>. Uma nova jail pode ser criada a partir de um archive, fornecendo uma maneira conveniente de clonar as jails existentes.</para>

	<para>Pare e arquive uma jail chamada <literal>wwwserver</literal>:</para>

	<screen><prompt>#</prompt> <userinput>ezjail-admin stop <replaceable>wwwserver</replaceable></userinput>
Stopping jails: wwwserver.
<prompt>#</prompt> <userinput>ezjail-admin archive <replaceable>wwwserver</replaceable></userinput>
<prompt>#</prompt> <userinput>ls /usr/jails/ezjail-archives/</userinput>
wwwserver-201407271153.13.tar.gz</screen>

	<para>Crie uma nova jail chamada <literal>wwwserver-clone</literal> do archive criado na etapa anterior. Use a interface <filename>em1</filename> e atribua um novo endereço <acronym>IP</acronym> para evitar conflito com a original:</para>

	<screen><prompt>#</prompt> <userinput>ezjail-admin create -a /usr/jails/ezjail_archives/wwwserver-201407271153.13.tar.gz <replaceable>wwwserver-clone</replaceable> 'lo1|127.0.3.1,em1|192.168.1.51'</userinput></screen>
      </sect3>
    </sect2>

    <sect2 xml:id="jails-ezjail-example-bind">
      <title>Exemplo Completo: <application>BIND</application> em uma Jail</title>

      <para>Colocar o servidor <acronym>DNS</acronym> <application>BIND</application> em uma jail melhora a segurança ao isolá-lo. Este exemplo cria um servidor de nomes de cache simples.</para>

      <itemizedlist xml:id="jails-ezjail-example-bind-assumptions">
	<listitem>
	  <para>A jail será chamada de <literal>dns1</literal>.</para>
	</listitem>

	<listitem>
	  <para>A jail usará o endereço <acronym>IP</acronym> <literal>192.168.1.240</literal> na interface <literal>re0</literal> do host.</para>
	</listitem>

	<listitem>
	  <para>Os servidores DNS de upstream do <acronym>ISP</acronym> são <literal>10.0.0.62</literal> e <literal>10.0.0.61</literal>.</para>
	</listitem>

	<listitem>
	  <para>A basejail já foi criada e uma árvore de ports instalada como mostrado em <xref linkend="jails-ezjail-initialsetup"/>.</para>
	</listitem>
      </itemizedlist>

      <example xml:id="jails-ezjail-example-bind-steps">
	<title>Executando o BIND em uma Jail</title>

	<para>Crie uma interface de loopback clonada adicionando uma linha ao arquivo <filename>/etc/rc.conf</filename>:</para>

	<programlisting>cloned_interfaces="lo1"</programlisting>

	<para>Imediatamente crie a nova interface de loopback:</para>

	<screen><prompt>#</prompt> <userinput>service netif cloneup</userinput>
Created clone interfaces: lo1.</screen>

	<para>Crie a jail:</para>

	<screen><prompt>#</prompt> <userinput>ezjail-admin create dns1 'lo1|127.0.2.1,re0|192.168.1.240'</userinput></screen>

	<para>Inicie a jail, conecte-se a ao seu console e realize algumas configurações básicas:</para>

	<screen><prompt>#</prompt> <userinput>ezjail-admin start dns1</userinput>
<prompt>#</prompt> <userinput>ezjail-admin console dns1</userinput>
<prompt>#</prompt> <userinput>passwd</userinput>
Changing local password for root
New Password:
Retype New Password:
<prompt>#</prompt> <userinput>tzsetup</userinput>
<prompt>#</prompt> <userinput>sed -i .bak -e '/adjkerntz/ s/^/#/' /etc/crontab</userinput>
<prompt>#</prompt> <userinput>sed -i .bak -e 's/127.0.0.1/127.0.2.1/g; s/localhost.my.domain/dns1.my.domain dns1/' /etc/hosts</userinput></screen>

	<para>Configure temporariamente os servidores upstream de <acronym>DNS</acronym> no arquivo <filename>/etc/resolv.conf</filename> para que os ports possam ser baixados:</para>

	<programlisting>nameserver 10.0.0.62
nameserver 10.0.0.61</programlisting>

	<para>Ainda usando o console da jail, instale o <package role="port">dns/bind99</package>.</para>

	<screen><prompt>#</prompt> <userinput>make -C /usr/ports/dns/bind99 install clean</userinput></screen>

	<para>Configure o servidor de nomes editando o arquivo <filename>/usr/local/etc/namedb/named.conf</filename>.</para>

	<para>Crie uma Access Control List (<acronym>ACL</acronym>) de endereços e redes que têm permissão para enviar consultas <acronym>DNS</acronym> para este servidor de nomes. Esta seção é adicionada logo antes da seção <literal>options</literal> no arquivo:</para>

	<programlisting>...
// or cause huge amounts of useless Internet traffic.

acl "trusted" {
	192.168.1.0/24;
	localhost;
	localnets;
};

options {
...</programlisting>

	<para>Use o endereço <acronym>IP</acronym> da jail na configuração <literal>listen-on</literal> para aceitar consultas <acronym>DNS</acronym> de outros computadores na rede:</para>

	<programlisting>	listen-on	{ 192.168.1.240; };</programlisting>

	<para>Um servidor <acronym>DNS</acronym> de nomes para cache simples é criado alterando a seção <literal>forwarders</literal>. O arquivo original contém:</para>

	<programlisting>/*
	forwarders {
		127.0.0.1;
	};
*/</programlisting>

	<para>Descomente a seção removendo as linhas <literal>/*</literal> e <literal>*/</literal>. Digite os endereços <acronym>IP</acronym> dos servidores <acronym>DNS</acronym> upstream. Logo após a seção <literal>forwarders</literal>, adicione referências à <literal>trusted</literal> <acronym>ACL</acronym> definida anteriormente:</para>

	<programlisting>	forwarders {
		10.0.0.62;
		10.0.0.61;
	};

	allow-query       { any; };
	allow-recursion   { trusted; };
	allow-query-cache { trusted; };</programlisting>

	<para>Ative o serviço no arquivo <filename>/etc/rc.conf</filename>:</para>

	<programlisting>named_enable="YES"</programlisting>

	<para>Inicie e teste o servidor de nomes:</para>

	<screen><prompt>#</prompt> <userinput>service named start</userinput>
wrote key file "/usr/local/etc/namedb/rndc.key"
Starting named.
<prompt>#</prompt> <userinput>/usr/local/bin/dig @192.168.1.240 freebsd.org</userinput></screen>

	<para>Uma resposta que inclui</para>

	<screen>;; Got answer;</screen>

	<para>mostra que o novo servidor <acronym>DNS</acronym> está funcionando. Um longo delay seguido por uma resposta incluindo</para>

	<screen>;; connection timed out; no servers could be reached</screen>

	<para>mostra um problema. Verifique as definições de configuração e certifique-se de que quaisquer firewalls locais permitam que o novo <acronym>DNS</acronym> acesse os servidores upstream de <acronym>DNS</acronym>.</para>

	<para>O novo servidor <acronym>DNS</acronym> pode usar pra resolução de nomes seu próprio serviço, assim como outros computadores locais. Defina o endereço do servidor <acronym>DNS</acronym> no arquivo <filename>/etc/resolv.conf</filename> do computador-cliente:</para>

	<programlisting>nameserver 192.168.1.240</programlisting>

	<para>Um servidor <acronym>DHCP</acronym> local pode ser configurado para fornecer este endereço como servidor de <acronym>DNS</acronym> local, fornecendo configuração automática em clientes <acronym>DHCP</acronym>.</para>
      </example>
    </sect2>
  </sect1>
</chapter>

    
<!--
     The FreeBSD Documentation Project
     $FreeBSD$
-->
<chapter version="5.0" xml:id="mac">
  <info>
    <title>Controle de acesso obrigatório</title>

    <authorgroup>
      <author><personname><firstname>Tom</firstname><surname>Rhodes</surname></personname><contrib>Escrito por </contrib></author>
    </authorgroup>
  </info>

  <sect1 xml:id="mac-synopsis">
    <title>Sinopse</title>

    <indexterm><primary>MAC</primary></indexterm>
    <indexterm><primary>Mandatory Access Control</primary> <see>MAC</see></indexterm>

    <para>O FreeBSD suporta extensões de segurança baseadas no projeto <trademark class="registered">POSIX</trademark>.1e. Esses mecanismos de segurança incluem as Listas de Controle de Acesso do sistema de arquivos (<xref linkend="fs-acl"/>) e o Controle de Acesso Obrigatório, (Mandatory Access Control - <acronym>MAC</acronym>). O <acronym>MAC</acronym> permite que os módulos de controle de acesso sejam carregados para implementar políticas de segurança. Alguns módulos fornecem proteções para um subconjunto restrito do sistema, fortalecendo um serviço específico. Outros fornecem segurança rotulada abrangente em todos os assuntos e objetos. A parte obrigatória da definição indica que a imposição de controles é executada pelos administradores e pelo sistema operacional. Isso está em contraste com o mecanismo de segurança padrão do Controle de Acesso Discricionário (Discretionary Access Control - <acronym>DAC</acronym>), onde a imposição é deixada a critério dos usuários.</para>

    <para>Este capítulo enfoca o framework <acronym>MAC</acronym> e o conjunto de módulos de política de segurança plugáveis que o FreeBSD fornece para habilitar vários mecanismos de segurança.</para>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>A terminologia associada ao framework <acronym>MAC</acronym>.</para>
      </listitem>

      <listitem>
	<para>Os recursos dos módulos de política de segurança <acronym>MAC</acronym>, bem como a diferença entre uma política rotulada e não rotulada.</para>
      </listitem>

      <listitem>
	<para>As considerações a se levar em conta antes de configurar um sistema para usar o framework <acronym>MAC</acronym>.</para>
      </listitem>
      <listitem>
	<para>Quais módulos de política de segurança <acronym>MAC</acronym> estão incluídos no FreeBSD e como configurá-los.</para>
      </listitem>

      <listitem>
	<para>Como implementar um ambiente mais seguro usando o framework <acronym>MAC</acronym>.</para>
      </listitem>

      <listitem>
	<para>Como testar a configuração para garantir que o framework <acronym>MAC</acronym> foi implementado corretamente.</para>
      </listitem>
    </itemizedlist>

    <para>Antes de ler este capítulo, você deve:</para>

    <itemizedlist>
      <listitem>
	<para>Entender os fundamentos do <trademark class="registered">UNIX</trademark> e do FreeBSD (<xref linkend="basics"/>).</para>
      </listitem>

      <listitem>
	<para>Ter alguma familiaridade com segurança e como ela está presente no FreeBSD (<xref linkend="security"/>).</para>
      </listitem>
    </itemizedlist>

    <warning>
      <para>A configuração incorreta do <acronym>MAC</acronym> pode causar perda de acesso ao sistema, agravamento de usuários, ou incapacidade de acessar os recursos fornecidos pelo <application>Xorg</application>. Mais importante, o <acronym>MAC</acronym> não deve ser usado para proteger completamente um sistema. O framework <acronym>MAC</acronym> apenas aumenta uma política de segurança existente. Sem práticas de segurança sólidas e verificações regulares de segurança, o sistema nunca estará completamente seguro.</para>

      <para>Os exemplos contidos neste capítulo são para fins de demonstração e os exemplos de configurações <emphasis>não</emphasis> devem ser implementadas em um sistema de produção. A implementação de qualquer política de segurança requer um bom entendimento, design adequado e testes completos.</para>
    </warning>

    <para>Embora este capítulo abranja uma ampla gama de questões de segurança relacionadas à estrututa <acronym>MAC</acronym>, o desenvolvimento de novos módulos de políticas de segurança <acronym>MAC</acronym> não serão abrangidos. Vários módulos de política de segurança incluídos com o framework <acronym>MAC</acronym> possuem características específicas que são fornecidas tanto para o teste quanto para o desenvolvimento de novos módulos. Consulte <citerefentry><refentrytitle>mac_test</refentrytitle><manvolnum>4</manvolnum></citerefentry>, <citerefentry><refentrytitle>mac_stub</refentrytitle><manvolnum>4</manvolnum></citerefentry> e <citerefentry><refentrytitle>mac_none</refentrytitle><manvolnum>4</manvolnum></citerefentry> para obter mais informações sobre esses módulos de política de segurança e os diversos mecanismos que eles fornecem.</para>
  </sect1>

  <sect1 xml:id="mac-inline-glossary">
    <title>Termos chave</title>

    <para>Os seguintes termos chave são usados ao se referir ao framework <acronym>MAC</acronym>:</para>

    <itemizedlist>
      <listitem>
	<para><emphasis>compartment</emphasis>: um conjunto de programas e dados a serem particionados ou separados, onde os usuários recebem acesso explícito ao componente específico de um sistema. Um compartimento (compartment) representa um agrupamento, como um grupo de trabalho, departamento, projeto ou tópico. Os compartimentos possibilitam a implementação de uma política de segurança baseada na necessidade de conhecimento.</para>
      </listitem>

      <listitem>
	<para><emphasis>integrity</emphasis>: o nível de confiança que pode ser colocado nos dados. Como a integridade (integrity) dos dados é elevada, também aumenta a capacidade de confiar nesses dados.</para>
      </listitem>

      <listitem>
	<para><emphasis>level</emphasis>: a configuração aumentada ou diminuída de um atributo de segurança. À medida que o nível (level) aumenta, sua segurança também é considerada alta.</para>
      </listitem>

      <listitem>
	<para><emphasis>label</emphasis>: um atributo de segurança que pode ser aplicado a arquivos, diretórios ou outros itens no sistema. Pode ser considerado um selo de confidencialidade. Quando um rótulo (label) é colocado em um arquivo, ele descreve as propriedades de segurança desse arquivo e só permitirá acesso por arquivos, usuários e recursos com uma configuração de segurança semelhante. O significado e a interpretação dos valores do rótulo dependem da configuração da política. Algumas políticas tratam um rótulo como representando a integridade ou o sigilo de um objeto, enquanto outras políticas podem usar rótulos para manter regras de acesso.</para>
      </listitem>

      <listitem>
	<para><emphasis>multilabel</emphasis>: esta propriedade é uma opção de sistema de arquivos que pode ser configurada no modo usuário único (single-user) usando o <citerefentry><refentrytitle>tunefs</refentrytitle><manvolnum>8</manvolnum></citerefentry>, durante a inicialização usando o <citerefentry><refentrytitle>fstab</refentrytitle><manvolnum>5</manvolnum></citerefentry>, ou durante a criação de um novo sistema de arquivos. Essa opção permite que um administrador aplique rótulos <acronym>MAC</acronym> diferentes em objetos diferentes. Essa opção aplica-se somente aos módulos de política de segurança que suportam rotulagem.</para>
      </listitem>

      <listitem>
	<para><emphasis>single label</emphasis>: uma política em que o sistema de arquivos inteiro usa um rótulo para impor o controle de acesso sobre o fluxo de dados. Sempre que <option>multilabel</option> não estiver definido, todos os arquivos estarão em conformidade com a mesma configuração de rótulo.</para>
      </listitem>

      <listitem>
	<para><emphasis>object</emphasis>: uma entidade através da qual a informação flui sob a direção de um <emphasis>sujeito</emphasis>. Isso inclui diretórios, arquivos, campos, telas, teclados, memória, armazenamento magnético, impressoras ou qualquer outro dispositivo de armazenamento ou movimentação de dados. Um objeto (object) é um contêiner de dados ou um recurso do sistema. O acesso a um objeto significa efetivamente acesso aos seus dados.</para>
      </listitem>

      <listitem>
	<para><emphasis>subject</emphasis>: qualquer entidade ativa que faz com que as informações fluam entre <emphasis>objetos</emphasis>, como um usuário, processo do usuário ou processo do sistema. No FreeBSD, isso é quase sempre um segmento agindo em um processo em nome de um usuário.</para>
      </listitem>

      <listitem>
	<para><emphasis>policy</emphasis>: uma coleção de regras que define como os objetivos devem ser alcançados. Uma política (policy) geralmente documenta como determinados itens devem ser manipulados. Este capítulo considera uma política como uma coleção de regras que controla o fluxo de dados e informações e define quem tem acesso a esses dados e informações.</para>
      </listitem>

      <listitem>
	<para><emphasis>high-watermark</emphasis>: esse tipo de política permite o aumento dos níveis de segurança com o objetivo de acessar informações de nível superior. Na maioria dos casos, o nível original é restaurado depois que o processo é concluído. Atualmente, o framework <acronym>MAC</acronym> do FreeBSD  não inclui este tipo de política.</para>
      </listitem>

      <listitem>
	<para><emphasis>low-watermark</emphasis>: esse tipo de política permite reduzir os níveis de segurança com o objetivo de acessar informações menos seguras. Na maioria dos casos, o nível de segurança original do usuário é restaurado após a conclusão do processo. O único módulo de política de segurança no FreeBSD para usar isto é o <citerefentry><refentrytitle>mac_lomac</refentrytitle><manvolnum>4</manvolnum></citerefentry>.</para>
      </listitem>

      <listitem>
	<para><emphasis>sensitivity</emphasis>: normalmente usado quando se discute Segurança Multinível (Multilevel Security - <acronym>MLS</acronym>). Um nível de sensibilidade (sensitivity) descreve o quão importante ou secreto os dados devem ser. À medida que o nível de sensibilidade aumenta, também aumenta a importância do sigilo ou confidencialidade dos dados.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="mac-understandlabel">
    <title>Entendendo os rótulos MAC</title>

    <para>Um rótulo <acronym>MAC</acronym> é um atributo de segurança que pode ser aplicado a sujeitos e objetos em todo o sistema. Ao definir um rótulo, o administrador deve entender suas implicações para evitar o comportamento inesperado ou indesejado do sistema. Os atributos disponíveis em um objeto dependem do módulo de política carregado, pois os módulos de política interpretam seus atributos de maneiras diferentes.</para>

    <para>O rótulo de segurança em um objeto é usado como parte de uma decisão de controle de acesso de segurança por uma política. Com algumas políticas, o rótulo contém todas as informações necessárias para tomar uma decisão. Em outras políticas, os rótulos podem ser processados como parte de um conjunto de regras maior.</para>

    <para>Existem dois tipos de políticas de rótulos: rótulo único e rótulo múltiplo. Por padrão, o sistema usará rótulo único. O administrador deve estar ciente dos prós e contras de cada um para implementar políticas que atendam aos requisitos do modelo de segurança do sistema.</para>

    <para>Uma diretiva de segurança de rótulo único permite que apenas um rótulo seja usado para cada sujeito ou objeto. Como uma política de rótulo único impõe um conjunto de permissões de acesso em todo o sistema, ela fornece menor sobrecarga de administração, mas diminui a flexibilidade das políticas que suportam rotulagem. No entanto, em muitos ambientes, uma única diretiva de rótulo pode ser tudo o que é necessário.</para>

    <para>Uma diretiva de segurança de rótulo único é um pouco semelhante ao <acronym>DAC</acronym> pois o <systemitem class="username">root</systemitem> configura as políticas para que os usuários sejam colocados nas categorias e níveis de acesso apropriados. Uma diferença notável é que muitos módulos de política também podem restringir o <systemitem class="username">root</systemitem>. O controle básico sobre os objetos será então liberado para o grupo, mas o <systemitem class="username">root</systemitem> poderá revogar ou modificar as configurações a qualquer momento.</para>

    <para>Quando apropriado, uma política de rótulos múltiplos pode ser configurada em um sistema de arquivos <acronym>UFS</acronym> passando <option>multilabel</option> para o <citerefentry><refentrytitle>tunefs</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Uma política de rótulos múltiplos permite que cada sujeito ou objeto tenha seu próprio rótulo <acronym>MAC</acronym> independente. A decisão de usar uma política de rótulos múltiplos ou rótulo único é necessária apenas para políticas que implementam o recurso de rotulagem, como <literal>biba</literal>, <literal>lomac</literal> e <literal>mls</literal>. Algumas políticas, como <literal>seeotheruids</literal>, <literal>portacl</literal> e <literal>partition</literal>, não usam rótulos.</para>

    <para>Usar uma política de rótulos múltiplos em uma partição e estabelecer um modelo de segurança de rótulos múltiplos pode aumentar a sobrecarga administrativa, já que tudo nesse sistema de arquivos tem um rótulo. Isso inclui diretórios, arquivos e até mesmo nós de dispositivos.</para>

    <para>O comando a seguir definirá a flag <option>multilabel</option> no sistema de arquivos <acronym>UFS</acronym> especificado . Isso só pode ser feito no modo de usuário único e não é um requisito para o sistema de arquivos de swap:</para>

    <screen><prompt>#</prompt> <userinput>tunefs -l enable /</userinput></screen>

    <note>
      <para>Alguns usuários tiveram problemas com a configuração de flag <option>multilabel</option> na partição raiz. Se este for o caso, por favor consulte <xref linkend="mac-troubleshoot"/>.</para>
    </note>

    <para>Como a política de rótulos múltiplos é definida por sistema de arquivos, ela pode não ser necessária se o layout do sistema de arquivos for bem projetado. Considere um exemplo de modelo de segurança <acronym>MAC</acronym> para um servidor Web do FreeBSD. Esta máquina usa o rótulo único, <literal>biba/high</literal>, para tudo nos sistemas de arquivos padrão. Se o servidor Web precisar ser executado em <literal>biba/low</literal> para evitar recursos de gravação, ele poderá ser instalado em um sistema de arquivos <acronym>UFS</acronym> separado, <filename>/usr/local</filename>, definido com <literal>biba/low</literal>.</para>

    <sect2>
      <title>Configuração de rótulo</title>

      <para>Praticamente todos os aspectos da configuração do módulo de política de rótulo serão executados usando os utilitários do sistema base. Esses comandos fornecem uma interface simples para a configuração de objeto ou sujeito ou a manipulação e verificação da configuração.</para>

      <para>Toda a configuração pode ser feita usando <command>setfmac</command>, que é usado para definir rótulos <acronym>MAC</acronym> em objetos do sistema, e <command>setpmac</command>, que é usado para definir os rótulos em sujeitos do sistema. Por exemplo, para definir o rótulo <acronym>MAC</acronym> <literal>biba</literal> como <literal>high</literal> em <filename>test</filename>:</para>

      <screen><prompt>#</prompt> <userinput>setfmac biba/high test</userinput></screen>

      <para>Se a configuração for bem sucedida, o prompt será retornado sem erro. Um erro comum é <errorname>Permission denied</errorname>, que geralmente ocorre quando o rótulo está sendo definido ou modificado em um objeto restrito. Outras condições podem produzir falhas diferentes. Por exemplo, o arquivo pode não ser de propriedade do usuário que está tentando re-rotular o objeto, o objeto pode não existir ou o objeto pode ser somente de leitura. Uma política obrigatória não permitirá que o processo renomeie o arquivo, talvez devido a uma propriedade do arquivo, uma propriedade do processo ou uma propriedade do novo valor de rótulo proposto. Por exemplo, se um usuário que estiver executando com baixa integridade tentar alterar o rótulo de um arquivo de alta integridade, ou um usuário executando com baixa integridade tentar alterar o rótulo de um arquivo de baixa integridade para um rótulo de alta integridade, essas operações falharão.</para>

      <para>O administrador do sistema pode usar <command>setpmac</command> para substituir as configurações do módulo de política, atribuindo um rótulo diferente a chamada do processo:</para>

      <screen><prompt>#</prompt> <userinput>setfmac biba/high test</userinput>
<errorname>Permission denied</errorname>
<prompt>#</prompt> <userinput>setpmac biba/low setfmac biba/high test</userinput>
<prompt>#</prompt> <userinput>getfmac test</userinput>
test: biba/high</screen>

      <para>Para processos atualmente em execução, como o <application>sendmail</application>, o <command>getpmac</command> é normalmente usado. Esse comando usa uma ID de processo (<acronym>PID</acronym>) no lugar de um nome de comando. Se os usuários tentarem manipular um arquivo que não esteja em seu acesso, sujeito às regras dos módulos de política carregados, o erro <errorname>Operation not permitted</errorname> será exibido.</para>
    </sect2>

    <sect2>
      <title>Rótulos pré-definidos</title>

      <para>Alguns módulos de política do FreeBSD que suportam o recurso de rotulagem oferecem três rótulos predefinidos: <literal>low</literal>, <literal>equal</literal> e <literal>high</literal>, onde:</para>

      <itemizedlist>
	<listitem>
	  <para><literal>low</literal> é considerada a configuração de rótulo mais baixa que um objeto ou assunto pode ter. Definir isso em sujeitos ou objetos bloqueia o acesso a objetos ou sujeitos marcados como alto (high).</para>
	</listitem>

	<listitem>
	  <para><literal>equal</literal> define o sujeito ou objeto a ser desabilitado ou não afetado e deve ser colocado apenas em objetos considerados como isentos da política.</para>
	</listitem>

	<listitem>
	  <para><literal>high</literal> concede a um objeto ou sujeito a configuração mais alta disponível nos módulos de política Biba e <acronym>MLS</acronym>.</para>
	</listitem>
      </itemizedlist>

      <para>Esses módulos de política incluem <citerefentry><refentrytitle>mac_biba</refentrytitle><manvolnum>4</manvolnum></citerefentry>, <citerefentry><refentrytitle>mac_mls</refentrytitle><manvolnum>4</manvolnum></citerefentry> e <citerefentry><refentrytitle>mac_lomac</refentrytitle><manvolnum>4</manvolnum></citerefentry>. Cada um dos rótulos predefinidos estabelece uma diretiva de fluxo de informações diferentes. Consulte a página de manual do módulo para determinar as características das configurações genéricas de rótulos.</para>
    </sect2>

    <sect2>
      <title>Rótulos numéricos</title>

      <para>Os módulos de políticas Biba e <acronym>MLS</acronym> suportam um rótulo numérico que pode ser configurado para indicar o nível exato de controle hierárquico. Esse nível numérico é usado para particionar ou classificar informações em diferentes grupos de classificação, permitindo apenas o acesso a esse grupo ou a um nível de grupo mais alto. Por exemplo:</para>

      <programlisting>biba/10:2+3+6(5:2+3-20:2+3+4+5+6)</programlisting>

      <para>pode ser interpretado como <quote>Rótulo de Política Biba/Grau 10:Compartimentos 2, 3 e 6: (grau 5 ...</quote>)</para>

      <para>Neste exemplo, o primeiro grau seria considerado o grau efetivo com compartimentos efetivos, o segundo grau é o grau baixo e o último é o grau alto. Na maioria das configurações, essas definições refinadas não são necessárias, pois são consideradas configurações avançadas.</para>

      <para>Objetos do sistema possuem apenas um grau e compartimento atuais. Os sujeitos do sistema refletem o intervalo de direitos disponíveis no sistema e as interfaces de rede, onde são usados para controle de acesso.</para>

      <para>O grau e os compartimentos em um par de sujeito e objeto são usados para construir um relacionamento conhecido como <firstterm>dominance</firstterm>, em que um sujeito domina um objeto, o objeto domina o sujeito, nenhum domina o outro, ou ambos dominam cada um. O caso em que <quote>ambos dominam</quote> ocorre quando dois rótulos são iguais. Devido à natureza do fluxo de informações do Biba, um usuário tem direitos sobre um conjunto de compartimentos que podem corresponder aos projetos, mas os objetos também têm um conjunto de compartimentos. Os usuários podem ter que subconjuntar seus direitos usando <command>su</command> ou <command>setpmac</command> para acessar objetos em um compartimento a partir do qual eles não estão restritos.</para>
    </sect2>

    <sect2>
      <title>Rótulos de usuários</title>

      <para>Os usuários precisam ter rótulos para que seus arquivos e processos interajam adequadamente com a política de segurança definida no sistema. Isso é configurado no <filename>/etc/login.conf</filename> usando classes de login. Todo módulo de política que usa rótulos implementará a configuração da classe de usuário.</para>

      <para>Para definir o rótulo padrão da classe de usuário que será imposto pelo <acronym>MAC</acronym>, adicione uma entrada <option>label</option>. Um  exemplo de entrada <option>label</option> contendo todos os módulos de política é exibida abaixo. Observe que, em uma configuração real, o administrador nunca habilitaria todos os módulos de política. Recomenda-se que o restante deste capítulo seja revisado antes que qualquer configuração seja implementada.</para>

      <programlisting>default:\
	:copyright=/etc/COPYRIGHT:\
	:welcome=/etc/motd:\
	:setenv=MAIL=/var/mail/$,BLOCKSIZE=K:\
	:path=~/bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin:\
	:manpath=/usr/share/man /usr/local/man:\
	:nologin=/usr/sbin/nologin:\
	:cputime=1h30m:\
	:datasize=8M:\
	:vmemoryuse=100M:\
	:stacksize=2M:\
	:memorylocked=4M:\
	:memoryuse=8M:\
	:filesize=8M:\
	:coredumpsize=8M:\
	:openfiles=24:\
	:maxproc=32:\
	:priority=0:\
	:requirehome:\
	:passwordtime=91d:\
	:umask=022:\
	:ignoretime@:\
	:label=partition/13,mls/5,biba/10(5-15),lomac/10[2]:</programlisting>

      <para>Embora os usuários não possam modificar o valor padrão, eles podem alterar seu rótulo após o login, sujeito às restrições da política. O exemplo acima diz à política do Biba que a integridade mínima de um processo é <literal>5</literal>, seu máximo é <literal>15</literal> e o rótulo efetivo padrão é <literal>10</literal>. O processo será executado em <literal>10</literal> até que ele escolha alterar o rótulo, talvez devido ao usuário usar <command>setpmac</command>, que será restringido pelo Biba ao intervalo configurado.</para>

      <para>Após qualquer alteração no <filename>login.conf</filename>, o banco de dados de recursos da classe de login deve ser reconstruído usando o <command>cap_mkdb</command>.</para>

      <para>Muitos sites têm um grande número de usuários que exigem várias classes de usuário diferentes. Um planejamento detalhado é necessário, pois isso pode dificultar o gerenciamento.</para>
    </sect2>

    <sect2>
      <title>Rótulos de interface de rede</title>

      <para>Os rótulos podem ser definidos em interfaces de rede para ajudar a controlar o fluxo de dados através da rede. Políticas que usam rótulos de interface de rede funcionam da mesma maneira que as políticas funcionam em relação aos objetos. Usuários com configurações altas no Biba, por exemplo, não terão permissão para acessar interfaces de rede com um rótulo <literal>low</literal>.</para>

      <para>Ao definir o rótulo <acronym>MAC</acronym> em interfaces de rede, <option>maclabel</option> pode ser passado para o <command>ifconfig</command>:</para>

      <screen><prompt>#</prompt> <userinput>ifconfig bge0 maclabel biba/equal</userinput></screen>

      <para>Este exemplo irá definir o rótulo <acronym>MAC</acronym> de <literal>biba/equal</literal> na interface <literal>bge0</literal>. Ao usar uma configuração semelhante a <literal>biba/high(low-high)</literal>, o rótulo inteiro deve ser citado para evitar que um erro seja retornado.</para>

      <para>Cada módulo de política que suporta rotulagem tem um ajuste que pode ser usado para desativar o rótulo <acronym>MAC</acronym> em interfaces de rede. Configurar o rótulo para <option>equal</option> terá um efeito semelhante. Reveja a saída do <command>sysctl</command>, as páginas do manual de políticas e as informações no restante deste capítulo para obter mais informações sobre esses ajustes.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="mac-planning">
    <title>Planejando a configuração de segurança</title>

    <para>Antes de implementar qualquer política de <acronym>MAC</acronym>, recomenda-se uma fase de planejamento. Durante as etapas de planejamento, um administrador deve considerar os requisitos e metas de implementação, como:</para>

    <itemizedlist>
      <listitem>
	<para>Como classificar informações e recursos disponíveis nos sistemas de destino.</para>
      </listitem>

      <listitem>
	<para>Quais informações ou recursos para restringir o acesso, juntamente com o tipo de restrições que devem ser aplicadas.</para>
      </listitem>

      <listitem>
	<para>Quais módulos <acronym>MAC</acronym> serão necessários para atingir esse objetivo.</para>
      </listitem>
    </itemizedlist>

    <para>Um teste de sistema confiável e sua configuração deve ocorrer <emphasis>antes</emphasis> de uma implementação <acronym>MAC</acronym> ser usada em sistemas de produção. Como diferentes ambientes têm diferentes necessidades e requisitos, estabelecer um perfil de segurança completo diminuirá a necessidade de alterações quando o sistema entrar em operação.</para>

    <para>Considere como o framework <acronym>MAC</acronym> aumenta a segurança do sistema como um todo. Os vários módulos de política de segurança fornecidos pelo framework <acronym>MAC</acronym> podem ser usados para proteger a rede e os sistemas de arquivos ou para impedir que usuários acessem determinadas portas e soquetes. Talvez o melhor uso dos módulos de política seja carregar vários módulos de política de segurança por vez para fornecer um ambiente <acronym>MLS</acronym>. Essa abordagem difere de uma política rígida, que tipicamente endurece elementos de um sistema que são usados apenas para propósitos específicos. A desvantagem de <acronym>MLS</acronym> é o aumento da sobrecarga administrativa.</para>

    <para>A sobrecarga é mínima quando comparada ao efeito duradouro de uma estrutura que fornece a capacidade de escolher quais políticas são necessárias para uma configuração específica e que reduzem a sobrecarga de desempenho. A redução do suporte a políticas desnecessárias pode aumentar o desempenho geral do sistema, além de oferecer flexibilidade de escolha. Uma boa implementação consideraria os requisitos gerais de segurança e implementaria efetivamente os vários módulos de política de segurança oferecidos pelo framework.</para>

    <para>Um sistema que utiliza <acronym>MAC</acronym> garante que um usuário não terá permissão para alterar atributos de segurança à vontade. Todos os utilitários, programas e scripts de usuário devem funcionar dentro das restrições das regras de acesso fornecidas pelos módulos de política de segurança selecionados e o controle das regras de acesso do <acronym>MAC</acronym> está nas mãos do administrador do sistema.</para>

    <para>É dever do administrador do sistema selecionar cuidadosamente os módulos de política de segurança corretos. Para um ambiente que precisa limitar o controle de acesso na rede, o <citerefentry><refentrytitle>mac_portacl</refentrytitle><manvolnum>4</manvolnum></citerefentry>, <citerefentry><refentrytitle>mac_ifoff</refentrytitle><manvolnum>4</manvolnum></citerefentry>, e os módulos de políticas <citerefentry><refentrytitle>mac_biba</refentrytitle><manvolnum>4</manvolnum></citerefentry> são bons pontos de partida. Para um ambiente em que a confidencialidade rigorosa dos objetos do sistema de arquivos é necessária, considere <citerefentry><refentrytitle>mac_bsdextended</refentrytitle><manvolnum>4</manvolnum></citerefentry> e os módulos de política <citerefentry><refentrytitle>mac_mls</refentrytitle><manvolnum>4</manvolnum></citerefentry>.</para>

    <para>Decisões de políticas podem ser tomadas com base na configuração da rede. Se apenas determinados usuários tiverem permissão para acessar o <citerefentry><refentrytitle>ssh</refentrytitle><manvolnum>1</manvolnum></citerefentry>, o módulo de política <citerefentry><refentrytitle>mac_portacl</refentrytitle><manvolnum>4</manvolnum></citerefentry> é uma boa escolha. No caso de sistemas de arquivos, o acesso a objetos pode ser considerado confidencial para alguns usuários, mas não para outros. Como um exemplo, uma grande equipe de desenvolvimento pode ser dividida em projetos menores, onde os desenvolvedores do projeto A podem não ter permissão para acessar objetos escritos por desenvolvedores do projeto B. No entanto, ambos os projetos podem precisar acessar objetos criados por desenvolvedores do projeto C. Usando os diferentes módulos de política de segurança fornecidos pelo framework <acronym>MAC</acronym>, os usuários poderiam ser divididos nesses grupos e então receber acesso aos objetos apropriados.</para>

    <para>Cada módulo de política de segurança tem uma maneira exclusiva de lidar com a segurança geral de um sistema. A seleção de módulos deve se basear em uma política de segurança bem pensada, que pode exigir revisão e reimplementação. Entender os diferentes módulos da política de segurança oferecidos pelo framework <acronym>MAC</acronym> ajudará os administradores a escolher as melhores políticas para suas situações.</para>

    <para>O restante deste capítulo aborda os módulos disponíveis, descreve seu uso e configuração e, em alguns casos, fornece informações sobre as situações aplicáveis.</para>

    <caution>
      <para>A implementação do <acronym>MAC</acronym> é muito parecida com a implementação de um firewall, já que é preciso tomar cuidado para evitar que o sistema seja completamente bloqueado. A capacidade de reverter para uma configuração anterior deve ser considerada e a implementação do <acronym>MAC</acronym> em uma conexão remota deve ser feita com extrema cautela.</para>
    </caution>
  </sect1>

  <sect1 xml:id="mac-policies">
    <title>Políticas MAC Disponíveis</title>

    <para>O kernel padrão do FreeBSD inclui a diretiva <literal>options MAC</literal>. Isso significa que todos os módulos incluídos no framework <acronym>MAC</acronym> podem ser carregados com o comando <command>kldload</command> como um módulo do kernel em tempo de execução. Depois de testar o módulo, adicione o nome do módulo ao arquivo <filename>/boot/loader.conf</filename> para que ele seja carregado durante a inicialização. Cada módulo também fornece uma opção de kernel para os administradores que escolhem compilar seu próprio kernel personalizado.</para>

    <para>O FreeBSD inclui um grupo de políticas que cobrirá a maioria dos requisitos de segurança. Cada política é resumida abaixo. As três últimas políticas suportam configurações inteiras no lugar dos três rótulos padrão.</para>

    <sect2 xml:id="mac-seeotheruids">
      <title>O MAC vê a Política de Outros UIDs</title>

      <indexterm><primary>MAC See Other UIDs Policy</primary></indexterm>
      <para>Nome do módulo: <filename>mac_seeotheruids.ko</filename></para>

      <para>Linha de configuração do kernel: <literal>options MAC_SEEOTHERUIDS</literal></para>

      <para>Opção de inicialização: <literal>mac_seeotheruids_load="YES"</literal></para>

      <para>O módulo <citerefentry><refentrytitle>mac_seeotheruids</refentrytitle><manvolnum>4</manvolnum></citerefentry> amplia os ajustes <varname>security.bsd.see_other_uids</varname> e <varname>security.bsd.see_other_gids</varname> do  <command>sysctl</command>. Esta opção não requer que nenhum rótulo seja definido antes da configuração e pode operar de forma transparente com outros módulos.</para>

      <para>Depois de carregar o módulo, os seguintes ajustes <command>sysctl</command> podem ser usados para controlar seus recursos:</para>

      <itemizedlist>
	<listitem>
	  <para>O <varname>security.mac.seeotheruids.enabled</varname> ativa o módulo e implementa as configurações padrões que impedem que os usuários visualizem processos e soquetes pertencentes a outros usuários.</para>
	</listitem>

	<listitem>
	  <para><varname>security.mac.seeotheruids.specificgid_enabled</varname> permite que grupos especificados sejam isentos desta política. Para isentar grupos específicos, use a variável <varname>security.mac.seeotheruids.specificgid=<replaceable>XXX</replaceable></varname> do <command>sysctl</command>, substituindo <replaceable>XXX</replaceable> pelo ID numérico do grupo a ser isento.</para>
	</listitem>

	<listitem>
	  <para><varname>security.mac.seeotheruids.primarygroup_enabled</varname> é usado para isentar grupos primários específicos desta política. Ao usar este ajuste, o <varname>security.mac.seeotheruids.specificgid_enabled</varname> não pode estar definido.</para>
	</listitem>
      </itemizedlist>
    </sect2>

    <sect2 xml:id="mac-bsdextended">
      <title>A Política Estendida do BSD MAC</title>

      <indexterm><primary>MAC</primary> <secondary>File System Firewall Policy</secondary></indexterm>
      <para>Nome do módulo: <filename>mac_bsdextended.ko</filename></para>

      <para>Linha de configuração do kernel: <literal>options MAC_BSDEXTENDED</literal></para>

      <para>Opção de inicialização: <literal>mac_bsdextended_load="YES"</literal></para>

      <para>O módulo <citerefentry><refentrytitle>mac_bsdextended</refentrytitle><manvolnum>4</manvolnum></citerefentry> aplica um firewall no sistema de arquivos. Ele fornece uma extensão para o modelo de permissões do sistema de arquivos padrão, permitindo que um administrador crie um conjunto de regras semelhante a um firewall para proteger arquivos, utilitários e diretórios na hierarquia do sistema de arquivos. Quando se tenta acessar um objeto do sistema de arquivos, a lista de regras é iterada até que uma regra correspondente seja localizada ou o final seja atingido. Esse comportamento pode ser alterado usando <varname>security.mac.bsdextended.firstmatch_enabled</varname>. Semelhante a outros módulos de firewall no FreeBSD, um arquivo contendo as regras de controle de acesso pode ser criado e lido pelo sistema no momento da inicialização usando uma variável do <citerefentry><refentrytitle>rc.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>

      <para>A lista de regras pode ser inserida usando o <citerefentry><refentrytitle>ugidfw</refentrytitle><manvolnum>8</manvolnum></citerefentry> que possui uma sintaxe similar ao <citerefentry><refentrytitle>ipfw</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Mais ferramentas podem ser escritas usando as funções da biblioteca <citerefentry><refentrytitle>libugidfw</refentrytitle><manvolnum>3</manvolnum></citerefentry>.</para>

      <para>Depois que o módulo <citerefentry><refentrytitle>mac_bsdextended</refentrytitle><manvolnum>4</manvolnum></citerefentry> tiver sido carregado, o seguinte comando poderá ser usado para listar a configuração atual da regra:</para>

      <screen><prompt>#</prompt> <userinput>ugidfw list</userinput>
0 slots, 0 rules</screen>

      <para>Por padrão, nenhuma regra é definida e tudo está completamente acessível. Para criar uma regra que bloqueia todo o acesso dos usuários, mas que não afeta o <systemitem class="username"> root </systemitem>:</para>

      <screen><prompt>#</prompt> <userinput>ugidfw add subject not uid root new object not uid root mode n</userinput></screen>

      <para>Embora essa regra seja simples de implementar, é uma idéia muito ruim, pois impede que todos os usuários emitam comandos. Um exemplo mais realista bloqueia todo o acesso do <systemitem class="username">user1</systemitem>, incluindo listagens de diretórios, ao diretório inicial do usuário <systemitem class="username"><replaceable>user2</replaceable></systemitem> :</para>

      <screen><prompt>#</prompt> <userinput>ugidfw set 2 subject uid <replaceable>user1</replaceable> object uid <replaceable>user2</replaceable> mode n</userinput>
<prompt>#</prompt> <userinput>ugidfw set 3 subject uid <replaceable>user1</replaceable> object gid <replaceable>user2</replaceable> mode n</userinput></screen>

      <para>Em vez de <systemitem class="username">user1</systemitem>, <option>not uid<replaceable>user2</replaceable></option> poderia ser usado para impor as mesmas restrições de acesso para todos os usuários. No entanto, o usuário <systemitem class="username">root</systemitem> não é afetado por essas regras.</para>

      <note>
	<para>Deve-se ter extremo cuidado ao trabalhar com este módulo, pois o uso incorreto pode bloquear o acesso a certas partes do sistema de arquivos.</para>
      </note>
    </sect2>

    <sect2 xml:id="mac-ifoff">
      <title>A política de silenciamento da interface MAC</title>

      <indexterm><primary>MAC Interface Silencing Policy</primary></indexterm>
      <para>Nome do módulo: <filename>mac_ifoff.ko</filename></para>

      <para>Linha de configuração do kernel: <literal>options MAC_IFOFF</literal></para>

      <para>Opção de inicialização: <literal>mac_ifoff_load="YES"</literal></para>

      <para>O módulo <citerefentry><refentrytitle>mac_ifoff</refentrytitle><manvolnum>4</manvolnum></citerefentry> é usado para desabilitar as interfaces de rede e evitar que as interfaces de rede sejam ativadas durante a inicialização do sistema. Ele não usa rótulos e não depende de nenhum outro módulo <acronym>MAC</acronym>.</para>

      <para>A maior parte do controle deste módulo é realizada através destes ajustes <command>sysctl</command>:</para>

      <itemizedlist>
	<listitem>
	  <para><varname>security.mac.ifoff.lo_enabled</varname> ativa ou desativa todo o tráfego na interface de loopback, <citerefentry><refentrytitle>lo</refentrytitle><manvolnum>4</manvolnum></citerefentry>.</para>
	</listitem>

	<listitem>
	  <para><varname>security.mac.ifoff.bpfrecv_enabled</varname> ativa ou desativa todo o tráfego na interface do Filtro de Pacotes Berkeley, <citerefentry><refentrytitle>bpf</refentrytitle><manvolnum>4</manvolnum></citerefentry>.</para>
	</listitem>

	<listitem>
	  <para><varname>security.mac.ifoff.other_enabled</varname> ativa ou desativa o tráfego em todas as outras interfaces.</para>
	</listitem>
      </itemizedlist>

      <para>Um dos usos mais comuns do <citerefentry><refentrytitle>mac_ifoff</refentrytitle><manvolnum>4</manvolnum></citerefentry> é o monitoramento de rede em um ambiente onde o tráfego de rede não deve ser permitido durante a sequência de inicialização. Outro uso seria escrever um script que usa um aplicativo como o <package>security/aide</package> para bloquear automaticamente o tráfego da rede se encontrar arquivos novos ou alterados em diretórios protegidos.</para>
    </sect2>

    <sect2 xml:id="mac-portacl">
      <title>A política de lista de controle de acesso da porta MAC</title>

      <indexterm><primary>MAC Port Access Control List Policy</primary></indexterm>
      <para>Nome do módulo: <filename>mac_portacl.ko</filename></para>

      <para>Linha de configuração do kernel: <literal>MAC_PORTACL</literal></para>

      <para>Opção de inicialização: <literal>mac_portacl_load="YES"</literal></para>

      <para>O módulo <citerefentry><refentrytitle>mac_portacl </refentrytitle><manvolnum>4</manvolnum></citerefentry> é usado para limitar a ligação a portas <acronym>TCP</acronym> e <acronym>UDP</acronym> locais , tornando possível permitir que usuários non-<systemitem class="username">root</systemitem> sejam vinculados a portas privilegiadas especificadas abaixo de 1024.</para>

      <para>Uma vez carregado, este módulo habilita a política <acronym>MAC</acronym> em todos os sockets. Os seguintes ajustes estão disponíveis:</para>

      <itemizedlist>
	<listitem>
	  <para><varname>security.mac.portacl.enabled</varname> ativa ou desativa a política completamente.</para>
	</listitem>

	<listitem>
	  <para>A <varname>security.mac.portacl.port_high</varname> configura o número de porta mais alto que o <citerefentry><refentrytitle>mac_portacl</refentrytitle><manvolnum>4</manvolnum></citerefentry> protege.</para>
	</listitem>

	<listitem>
	  <para>A <varname>security.mac.portacl.suser_exempt</varname>, quando configurada para um valor diferente de zero, isenta o usuário <systemitem class="username">root</systemitem> desta política.</para>
	</listitem>

	<listitem>
	  <para>A <varname>security.mac.portacl.rules</varname> especifica a política como uma cadeia de texto no formato <literal>rule [, rule, ...]</literal>, com tantas regras quantas forem necessárias, e onde cada regra esta na forma <literal>idtype:id:protocol:port</literal>. O <parameter>idtype</parameter> é <literal>uid</literal> ou <literal>gid</literal>. O parâmetro <parameter>protocol</parameter> pode ser <literal>tcp</literal> ou <literal>udp</literal>. O parâmetro <parameter>port</parameter> é o número da porta para permitir que o usuário ou grupo especificado se vincule. Somente valores numéricos podem ser usados para os parâmetros ID do usuário, ID do grupo e porta.</para>
	</listitem>
      </itemizedlist>

      <para>Por padrão, as portas abaixo de 1024 só podem ser usadas por processos privilegiados que são executados como <systemitem class="username">root</systemitem>. Para que o <citerefentry><refentrytitle>mac_portacl</refentrytitle><manvolnum>4</manvolnum></citerefentry> permita que processos não privilegiados se vinculem a portas abaixo de 1024, defina os seguintes ajustes da seguinte forma:</para>

      <screen><prompt>#</prompt> <userinput>sysctl security.mac.portacl.port_high=1023</userinput>
<prompt>#</prompt> <userinput>sysctl net.inet.ip.portrange.reservedlow=0</userinput>
<prompt>#</prompt> <userinput>sysctl net.inet.ip.portrange.reservedhigh=0</userinput></screen>

      <para>Para evitar que o usuário <systemitem class="username">root</systemitem> seja afetado por esta política, configure <varname>security.mac.portacl.suser_exempt</varname> para um valor diferente de zero.</para>

      <screen><prompt>#</prompt> <userinput>sysctl security.mac.portacl.suser_exempt=1</userinput></screen>

      <para>Para permitir que o usuário <systemitem class="username">www</systemitem> com <acronym>UID</acronym> 80 seja vinculado à porta 80 sem precisar do privilégio <systemitem class="username">root</systemitem>:</para>

      <screen><prompt>#</prompt> <userinput>sysctl security.mac.portacl.rules=uid:80:tcp:80</userinput></screen>

      <para>Este próximo exemplo permite que o usuário com o <acronym>UID</acronym> de 1001 se vincule às portas <acronym>TCP</acronym> 110 (POP3) e 995 (POP3):</para>

      <screen><prompt>#</prompt> <userinput>sysctl security.mac.portacl.rules=uid:1001:tcp:110,uid:1001:tcp:995</userinput></screen>
    </sect2>

    <sect2 xml:id="mac-partition">
      <title>A Política de Partição MAC</title>

      <indexterm><primary>MAC Process Partition Policy</primary></indexterm>
      <para>Nome do módulo: <filename>mac_partition.ko</filename></para>

      <para>Linha de configuração do kernel: <literal>options MAC_PARTITION</literal></para>

      <para>Opção de inicialização: <literal>mac_partition_load="YES"</literal></para>

      <para>A política <citerefentry><refentrytitle>mac_partition</refentrytitle><manvolnum>4</manvolnum></citerefentry> coloca os processos em  <quote>partições</quote> específicas com base no rótulo <acronym>MAC</acronym>. A maioria das configurações para esta política é feita usando <citerefentry><refentrytitle>setpmac</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Uma vari[avek <command>sysctl</command> está disponível para esta política:</para>

      <itemizedlist>
	<listitem>
	  <para>A <varname>security.mac.partition.enabled</varname> permite a aplicação de partições de processo <acronym>MAC</acronym>.</para>
	</listitem>
      </itemizedlist>

      <para>Quando essa política esta ativada, os usuários só poderão ver seus processos e quaisquer outros em sua partição, mas não terão permissão para trabalhar com utilitários fora do escopo dessa partição. Por exemplo, um usuário na classe <literal>insecure</literal> não terá permissão para acessar <command>top</command>, bem como muitos outros comandos que devem fazer spawn de um processo.</para>

      <para>Este exemplo adiciona o <command>top</command> ao conjunto de rótulos dos usuários na classe <literal>insecure</literal>. Todos os processos gerados por usuários na classe <literal>insecure</literal> permanecerão no rótulo <literal>partition/13</literal>.</para>

      <screen><prompt>#</prompt> <userinput>setpmac partition/13 top</userinput></screen>

      <para>Este comando exibe o rótulo da partição e a lista de processos:</para>

      <screen><prompt>#</prompt> <userinput>ps Zax</userinput></screen>

      <para>Esse comando exibe o rótulo da partição de processo de outro usuário e os processos atualmente em execução desse usuário:</para>

      <screen><prompt>#</prompt> <userinput>ps -ZU trhodes</userinput></screen>

      <note>
	<para>Os usuários podem ver processos no rótulo <systemitem class="username">root</systemitem>, a menos que a política <citerefentry><refentrytitle>mac_seeotheruids</refentrytitle><manvolnum>4</manvolnum></citerefentry> esteja carregada.</para>
      </note>
    </sect2>

    <sect2 xml:id="mac-mls">
      <title>O módulo de segurança multinível MAC</title>

      <indexterm><primary>MAC Multi-Level Security Policy</primary></indexterm>
      <para>Nome do módulo: <filename>mac_mls.ko</filename></para>

      <para>Linha de configuração do kernel: <literal>options MAC_MLS</literal></para>

      <para>Opção de inicialização: <literal>mac_mls_load="YES"</literal></para>

      <para>A política <citerefentry><refentrytitle>mac_mls</refentrytitle><manvolnum>4</manvolnum></citerefentry> controla o acesso entre sujeitos e objetos no sistema, aplicando uma diretiva de fluxo de informações restrita.</para>

      <para>Em ambientes <acronym>MLS</acronym>, um nível de <quote>clearance</quote> é definido no rótulo de cada sujeito ou objeto, juntamente com os compartimentos. Como esses níveis de liberação podem atingir números maiores que vários milhares, seria uma tarefa difícil configurar completamente cada sujeito ou objeto. Para facilitar essa sobrecarga administrativa, três rótulos são incluídos nesta política: <literal>mls/low</literal>, <literal>mls/equal</literal> e <literal>mls/high</literal>, onde:</para>

      <itemizedlist>
	<listitem>
	  <para>Qualquer coisa rotulada com <literal>mls/low</literal> terá um nível de folga baixo e não será permitido acessar informações de um nível superior. Esse rótulo também evita que objetos de nível de liberação mais alto gravem ou transmitam informações para um nível inferior.</para>
	</listitem>

	<listitem>
	  <para><literal>mls/equal</literal> deve ser colocado em objetos que devem ser isentos da política.</para>
	</listitem>

	<listitem>
	  <para><literal>mls/high</literal> é o nível mais alto de permissão possível. Objetos atribuídos a esse rótulo terão domínio sobre todos os outros objetos no sistema; no entanto, eles não permitirão o vazamento de informações para objetos de classe baixa.</para>
	</listitem>
      </itemizedlist>

      <para>O <acronym>MLS</acronym> fornece:</para>

      <itemizedlist>
	<listitem>
	  <para>Um nível de segurança hierárquico com um conjunto de categorias não hierárquicas.</para>
	</listitem>

	<listitem>
	  <para>Regras fixas de <literal>no read up, no write down</literal>. Isso significa que um sujeito pode ter acesso de leitura a objetos em seu próprio nível ou abaixo, mas não acima. Da mesma forma, um sujeito pode ter acesso de gravação a objetos em seu próprio nível ou acima, mas não abaixo dele.</para>
	</listitem>

	<listitem>
	  <para>Sigilo, ou a prevenção de divulgação inadequada de dados.</para>
	</listitem>

	<listitem>
	  <para>Uma base para o projeto de sistemas que lidam simultaneamente com dados em múltiplos níveis de sensibilidade sem vazar informações entre secretas e confidenciais.</para>
	</listitem>
      </itemizedlist>

      <para>Os seguintes ajustes <command>sysctl</command> estão disponíveis:</para>

      <itemizedlist>
	<listitem>
	  <para><varname>security.mac.mls.enabled</varname> é usado para habilitar ou desabilitar a política <acronym>MLS</acronym>.</para>
	</listitem>

	<listitem>
	  <para><varname>security.mac.mls.ptys_equal</varname> todos os dispositivos <citerefentry><refentrytitle>pty</refentrytitle><manvolnum>4</manvolnum></citerefentry> como <literal>mls/equal</literal> durante a criação.</para>
	</listitem>

	<listitem>
	  <para><varname>security.mac.mls.revocation_enabled</varname> revoga o acesso a objetos depois que seu rótulo é alterado para um rótulo de nível inferior.</para>
	</listitem>

	<listitem>
	  <para><varname>security.mac.mls.max_compartments </varname> define o número máximo de níveis de compartimentos permitidos em um sistema.</para>
	</listitem>
      </itemizedlist>

      <para>Para manipular os rótulos <acronym>MLS</acronym>, use <citerefentry><refentrytitle>setfmac</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Para atribuir um rótulo a um objeto:</para>

      <screen><prompt>#</prompt> <userinput>setfmac mls/5 test</userinput></screen>

      <para>Para obter o rótulo <acronym>MLS</acronym> para o arquivo <filename>test</filename>:</para>

      <screen><prompt>#</prompt> <userinput>getfmac test</userinput></screen>

      <para>Outra abordagem é criar um arquivo de política mestre em <filename>/etc/</filename>, que especifica as informações de política de <acronym>MLS</acronym> e alimentar o <command>setfmac</command> com esse arquivo.</para>

      <para>Ao usar o módulo de política do <acronym>MLS</acronym>, um administrador planeja controlar o fluxo de informações confidenciais. O padrão <literal>block read up block write down</literal> define tudo para um estado baixo. Tudo é acessível e um administrador aumenta lentamente a confidencialidade das informações.</para>

      <para>Além das três opções básicas de rótulo, um administrador pode agrupar usuários e grupos conforme necessário para bloquear o fluxo de informações entre eles. Pode ser mais fácil olhar as informações em níveis de clearance usando palavras descritivas, como classificações de <literal>Confidential</literal>, <literal>Secret</literal> e <literal>Top Secret</literal>. Alguns administradores criam grupos diferentes com base nos níveis do projeto. Independentemente do método de classificação, um plano bem pensado deve existir antes de implementar uma política restritiva.</para>

      <para>Alguns exemplos de situações para o módulo de política <acronym>MLS</acronym> incluem um servidor Web de e-commerce, um servidor de arquivos com informações críticas sobre a empresa e ambientes de instituições financeiras.</para>
    </sect2>

    <sect2 xml:id="mac-biba">
      <title>O Módulo MAC Biba</title>

      <indexterm><primary>MAC Biba Integrity Policy</primary></indexterm>
      <para>Nome do módulo: <filename>mac_biba.ko</filename></para>

      <para>Linha de configuração do kernel: <literal>options MAC_BIBA</literal></para>

      <para>Opção de inicialização: <literal>mac_biba_load="YES"</literal></para>

      <para>O módulo <citerefentry><refentrytitle>mac_biba</refentrytitle><manvolnum>4</manvolnum></citerefentry> carrega a política <acronym>MAC</acronym> Biba. Essa política é semelhante à política <acronym>MLS</acronym>, com a exceção de que as regras para o fluxo de informações são levemente revertidas. Isso evita o fluxo descendente de informações confidenciais, enquanto a política <acronym>MLS</acronym> impede o fluxo ascendente de informações confidenciais.</para>

      <para>Nos ambientes do Biba, um rótulo <quote>integrity</quote> é definido em cada sujeito ou objeto. Esses rótulos são compostos de classes hierárquicas e componentes não hierárquicos. Como um grau ascende, o mesmo acontece com a sua integridade.</para>

      <para>Rótulos suportados são <literal>biba/low</literal>, <literal>biba/equal</literal> e <literal>biba/high</literal>, onde:</para>

      <itemizedlist>
	<listitem>
	  <para><literal>biba/low</literal> é considerado a integridade mais baixa que um sujeito ou objeto pode ter. Definir isso em sujeitos ou objetos bloqueia o acesso de gravação a objetos ou sujeitos marcados como <literal>biba/high</literal>, mas não impede o acesso de leitura.</para>
	</listitem>

	<listitem>
	  <para><literal>biba/equal</literal> só deve ser colocado em objetos considerados como isentos da política.</para>
	</listitem>

	<listitem>
	  <para><literal>biba/high</literal> permite gravar objetos em um rótulo inferior, mas não permite a leitura desse objeto. Recomenda-se que esse rótulo seja colocado em objetos que afetam a integridade de todo o sistema.</para>
	</listitem>
      </itemizedlist>

      <para>O Biba fornece:</para>

      <itemizedlist>
	<listitem>
	  <para>Níveis de integridade hierárquica com um conjunto de categorias de integridade não hierárquicas.</para>
	</listitem>

	<listitem>
	  <para>As regras fixas são <literal>no write up, no read down</literal>, o oposto do  <acronym>MLS</acronym>. Um sujeito pode ter acesso de gravação a objetos em seu próprio nível ou abaixo, mas não acima. Da mesma forma, um sujeito pode ter acesso de leitura a objetos em seu próprio nível ou acima, mas não abaixo.</para>
	</listitem>

	<listitem>
	  <para>Integridade, impedindo a modificação inadequada de dados.</para>
	</listitem>

	<listitem>
	  <para>Níveis de integridade em vez dos níveis de sensibilidade do <acronym>MLS</acronym>.</para>
	</listitem>
      </itemizedlist>

      <para>Os seguintes ajustes podem ser usados para manipular a política Biba:</para>

      <itemizedlist>
	<listitem>
	  <para><varname>security.mac.biba.enabled</varname> é usado para ativar ou desativar a imposição da política Biba na máquina de destino.</para>
	</listitem>

	<listitem>
	  <para>O <varname>security.mac.biba.ptys_equal</varname> é usado para desabilitar a política Biba em dispositivos <citerefentry><refentrytitle>pty</refentrytitle><manvolnum>4</manvolnum></citerefentry>.</para>
	</listitem>

	<listitem>
	  <para><varname>security.mac.biba.revocation_enabled</varname> força a revogação do acesso a objetos se o rótulo for alterado para dominar o sujeito.</para>
	</listitem>
      </itemizedlist>

      <para>Para acessar a configuração de política Biba em objetos do sistema, use <command>setfmac</command> e <command>getfmac</command>:</para>

      <screen><prompt>#</prompt> <userinput>setfmac biba/low test</userinput>
<prompt>#</prompt> <userinput>getfmac test</userinput>
test: biba/low</screen>

      <para>Integridade, que é diferente de sensibilidade, é usada para garantir que a informação não seja manipulada por partes não confiáveis. Isso inclui informações passadas entre sujeitos e objetos. Ele garante que os usuários só poderão modificar ou acessar as informações para as quais receberam acesso explícito. O módulo de política de segurança <citerefentry><refentrytitle>mac_biba</refentrytitle><manvolnum>4</manvolnum></citerefentry> permite que um administrador configure quais arquivos e programas um usuário pode ver e invocar enquanto assegura que os programas e arquivos sejam confiáveis pelo sistema para esse usuário.</para>

      <para>Durante a fase de planejamento inicial, um administrador deve estar preparado para particionar os usuários em graus, níveis e áreas. O sistema terá como padrão um rótulo alto assim que esse módulo de política for ativado e cabe ao administrador configurar as diferentes classificações e níveis para os usuários. Em vez de usar níveis de liberação, um bom método de planejamento pode incluir tópicos. Por exemplo, permita apenas que os desenvolvedores modifiquem o acesso ao repositório do código-fonte, ao compilador do código-fonte e a outros utilitários de desenvolvimento. Outros usuários seriam agrupados em outras categorias, como testadores, designers ou usuários finais, e somente o acesso de leitura seria permitido.</para>

      <para>Um sujeito de integridade inferior é incapaz de escrever para um sujeito de integridade superior e um sujeito de integridade superior não pode listar ou ler um objeto de integridade inferior. Definir um rótulo com o grau mais baixo possível pode torná-lo inacessível aos sujeitos. Alguns ambientes em potencial para esse módulo de política de segurança incluiriam um servidor Web restrito, uma máquina de desenvolvimento e teste e um repositório de código-fonte. Uma implementação menos útil seria uma estação de trabalho pessoal, uma máquina usada como roteador ou um firewall de rede.</para>
    </sect2>

    <sect2 xml:id="mac-lomac">
      <title>O módulo MAC de marca d'água baixa</title>

      <indexterm><primary>MAC LOMAC</primary></indexterm>
      <para>Nome do módulo: <filename>mac_lomac.ko</filename></para>

      <para>Linha de configuração do kernel: <literal>options MAC_LOMAC</literal></para>

      <para>Opção de inicialização: <literal>mac_lomac_load="YES"</literal></para>

      <para>Diferentemente da política do <acronym>MAC</acronym> Biba, a política <citerefentry><refentrytitle>mac_lomac</refentrytitle><manvolnum>4</manvolnum></citerefentry> permite acesso a objetos de baixa integridade somente após diminuir o nível de integridade para não interromper nenhuma regra de integridade.</para>

      <para>A política de integridade de marca d'água baixa funciona de forma quase idêntica ao Biba, com a exceção do uso de rótulos flutuantes para suportar o rebaixamento do sujeito por meio de um compartimento auxiliar de classificação. Este compartimento secundário assume o formato <literal>[auxgrade]</literal>. Ao atribuir uma política com um grau auxiliar, use a sintaxe <literal>lomac/10[2]</literal>, onde <literal>2</literal> é o grau auxiliar.</para>

      <para>Essa política se baseia na rotulagem onipresente de todos os objetos do sistema com rótulos de integridade, permitindo que os sujeitos leiam objetos de baixa integridade e fazendo o downgrade do rótulo no sujeito para evitar gravações futuras em objetos de alta integridade usando <literal>[auxgrade]</literal> . A política pode fornecer maior compatibilidade e exigir menos configuração inicial do que o Biba.</para>

      <para>Como as políticas Biba e <acronym>MLS</acronym>, <command>setfmac</command> e <command>setpmac</command> são usadas para colocar rótulos nos objetos do sistema:</para>

      <screen><prompt>#</prompt> <userinput>setfmac /usr/home/trhodes lomac/high[low]</userinput>
<prompt>#</prompt> <userinput>getfmac /usr/home/trhodes lomac/high[low]</userinput></screen>

      <para>Um grau auxiliar <literal>low</literal> é uma funcionalidade fornecida apenas pela política <acronym>MAC</acronym> <acronym>LOMAC</acronym>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="mac-userlocked">
    <title>Bloqueio do Usuário</title>

    <para>Este exemplo considera um sistema de armazenamento relativamente pequeno com menos de cinquenta usuários. Os usuários terão recursos de login e terão permissão para armazenar dados e acessar recursos.</para>

    <para>Para este cenário, os módulos de política <citerefentry><refentrytitle>mac_bsdextended</refentrytitle><manvolnum>4</manvolnum></citerefentry> e <citerefentry><refentrytitle>mac_seeotheruids</refentrytitle><manvolnum>4</manvolnum></citerefentry> podem coexistir e bloquear o acesso a objetos do sistema enquanto ocultam processos do usuário.</para>

    <para>Comece adicionando a seguinte linha ao <filename>/boot/loader.conf</filename>:</para>

    <programlisting>mac_seeotheruids_load="YES"</programlisting>

    <para>O módulo de política de segurança <citerefentry><refentrytitle>mac_bsdextended</refentrytitle><manvolnum>4</manvolnum></citerefentry> pode ser ativado adicionando esta linha ao arquivo <filename>/etc/rc.conf</filename>:</para>

    <programlisting>ugidfw_enable="YES"</programlisting>

    <para>As regras padrões armazenadas em <filename>/etc/rc.bsdextended</filename> serão carregadas na inicialização do sistema. No entanto, as entradas padrões podem precisar de modificação. Como esta máquina é destinada apenas para servir os usuários, tudo pode ser deixado comentado, exceto as duas últimas linhas, a fim de forçar o carregamento de objetos do sistema de propriedade do usuário por padrão.</para>

    <para>Adicione os usuários necessários a esta máquina e reinicie. Para fins de teste, tente efetuar login como um usuário diferente em dois consoles. Execute <command>ps aux</command> para ver se os processos de outros usuários estão visíveis. Verifique se a execução do <citerefentry><refentrytitle>ls</refentrytitle><manvolnum>1</manvolnum></citerefentry> no diretório inicial de outro usuário falha.</para>

    <para>Não tente testar com o usuário <systemitem class="username">root</systemitem>, a menos que o <command>sysctl</command> específico tenha sido modificado para bloquear o acesso do superusuário.</para>

    <note>
      <para>Quando um novo usuário é adicionado, sua regra <citerefentry><refentrytitle>mac_bsdextended</refentrytitle><manvolnum>4</manvolnum></citerefentry> não estará na lista de conjuntos de regras. Para atualizar o conjunto de regras rapidamente, descarregue o módulo de política de segurança e recarregue-o novamente usando <citerefentry><refentrytitle>kldunload</refentrytitle><manvolnum>8</manvolnum></citerefentry> e <citerefentry><refentrytitle>kldload</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
    </note>
  </sect1>

  <sect1 xml:id="mac-implementing">
    <title>Nagios em Jail MAC</title>

    <indexterm><primary>Nagios in a MAC Jail</primary></indexterm>

    <para>Esta seção demonstra as etapas necessárias para implementar o sistema de monitoramento de rede <application>Nagios</application> em um ambiente <acronym>MAC</acronym>. Isso é um exemplo que ainda exige que o administrador teste se a política implementada atende aos requisitos de segurança da rede antes de usar em um ambiente de produção.</para>

    <para>Este exemplo requer que o <option>multilabel</option> seja definido em cada sistema de arquivos. Ele também assume que o <package>net-mgmt/nagios-plugins</package>, <package>net-mgmt/nagios</package> e <package>www/apache22</package> estão todos instalados, configurados e funcionando corretamente antes de tentar a integração na estrutura <acronym>MAC</acronym>.</para>

    <sect2>
      <title>Criar uma Classe de Usuário Insegura</title>

      <para>Comece o procedimento adicionando a seguinte classe de usuário ao <filename>/etc/login.conf</filename>:</para>

      <programlisting>insecure:\
:copyright=/etc/COPYRIGHT:\
:welcome=/etc/motd:\
:setenv=MAIL=/var/mail/$,BLOCKSIZE=K:\
:path=~/bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin
:manpath=/usr/share/man /usr/local/man:\
:nologin=/usr/sbin/nologin:\
:cputime=1h30m:\
:datasize=8M:\
:vmemoryuse=100M:\
:stacksize=2M:\
:memorylocked=4M:\
:memoryuse=8M:\
:filesize=8M:\
:coredumpsize=8M:\
:openfiles=24:\
:maxproc=32:\
:priority=0:\
:requirehome:\
:passwordtime=91d:\
:umask=022:\
:ignoretime@:\
:label=biba/10(10-10):</programlisting>

      <para>Em seguida, adicione a seguinte linha a seção de classe de usuário padrão:</para>

      <programlisting>:label=biba/high:</programlisting>

      <para>Salve as edições e rode o seguinte comando para reconstruir o banco de dados:</para>

      <screen><prompt>#</prompt> <userinput>cap_mkdb /etc/login.conf</userinput></screen>
    </sect2>

    <sect2>
      <title>Configurar usuários</title>

      <para>Configure o usuário <systemitem class="username">root</systemitem> para a classe padrão usando:</para>

      <screen><prompt>#</prompt> <userinput>pw usermod root -L default</userinput></screen>

      <para>Todas as contas de usuário que não são <systemitem class="username">root</systemitem> agora exigirão uma classe de login. A classe de login é necessária, caso contrário, os usuários terão acesso recusado aos comandos comuns. O seguinte script <command>sh</command> deve resolver:</para>

      <screen><prompt>#</prompt> <userinput>for x in `awk -F: '($3 &gt;= 1001) &amp;&amp; ($3 != 65534) { print $1 }' \</userinput>
	<userinput>/etc/passwd`; do pw usermod $x -L default; done;</userinput></screen>

      <para>Em seguida, altere as contas <systemitem class="username">nagios</systemitem> e <systemitem class="username">www</systemitem> para a classe insegura:</para>

      <screen><prompt>#</prompt> <userinput>pw usermod nagios -L insecure</userinput>
<prompt>#</prompt> <userinput>pw usermod www -L insecure</userinput></screen>
      </sect2>

      <sect2>
	<title>Crie o arquivo de contextos</title>

	<para>Um arquivo de contexto deve agora ser criado como <filename>/etc/policy.contexts</filename>:</para>

	<programlisting># This is the default BIBA policy for this system.

# System:
/var/run(/.*)?			biba/equal

/dev/(/.*)?			biba/equal

/var				biba/equal
/var/spool(/.*)?		biba/equal

/var/log(/.*)?			biba/equal

/tmp(/.*)?			biba/equal
/var/tmp(/.*)?			biba/equal

/var/spool/mqueue		biba/equal
/var/spool/clientmqueue		biba/equal

# For Nagios:
/usr/local/etc/nagios(/.*)?	biba/10

/var/spool/nagios(/.*)?		biba/10

# For apache
/usr/local/etc/apache(/.*)?	biba/10</programlisting>

      <para>Essa política impõe segurança ao definir restrições no fluxo de informações. Nesta configuração específica, os usuários, incluindo O <systemitem class="username">root</systemitem>, nunca devem ter permissão para acessar o <application>Nagios</application>. Arquivos de configuração e processos que fazem parte do <application>Nagios</application> serão completamente auto-contidos ou presos.</para>

      <para>Este arquivo será lido depois da execução do <command>setfsmac</command> em cada sistema de arquivos. Este exemplo define a política no sistema de arquivos raiz:</para>

      <screen><prompt>#</prompt> <userinput>setfsmac -ef /etc/policy.contexts /</userinput></screen>

      <para>Em seguida, adicione estas edições a seção principal do <filename>/etc/mac.conf</filename>:</para>

      <programlisting>default_labels file ?biba
default_labels ifnet ?biba
default_labels process ?biba
default_labels socket ?biba</programlisting>
    </sect2>

    <sect2>
      <title>Configuração do Inicializador</title>

      <para>Para finalizar a configuração, adicione as seguintes linhas ao <filename>/boot/loader.conf</filename>:</para>

      <programlisting>mac_biba_load="YES"
mac_seeotheruids_load="YES"
security.mac.biba.trust_all_interfaces=1</programlisting>

      <para>E a seguinte linha para a configuração da placa de rede armazenada em <filename>/etc/rc.conf</filename>. Se a configuração de rede principal for feita via <acronym>DHCP</acronym>, talvez seja necessário configurá-la manualmente após cada inicialização do sistema:</para>

      <programlisting>maclabel biba/equal</programlisting>
    </sect2>

    <sect2>
      <title>Testando a Configuração</title>

      <indexterm><primary>MAC Configuration Testing</primary></indexterm>

      <para>Primeiro, certifique-se de que o servidor Web e o <application>Nagios</application> não iniciarão na inicialização e reinicialização do sistema. Assegure-se de que o <systemitem class="username">root</systemitem> não possa acessar nenhum dos arquivos no diretório de configuração do <application>Nagios</application>. Se o <systemitem class="username">root</systemitem> puder listar o conteúdo de <filename>/var/spool/nagios</filename>, algo está errado. Em vez disso, um erro <quote>permission denied</quote> deve ser retornado.</para>

      <para>Se tudo parecer bem, o <application>Nagios</application>, o <application>Apache</application> e o <application>Sendmail</application> agora poderão ser iniciados:</para>

      <screen><prompt>#</prompt> <userinput>cd /etc/mail &amp;&amp; make stop &amp;&amp; \
setpmac biba/equal make start &amp;&amp; setpmac biba/10\(10-10\) apachectl start &amp;&amp; \
setpmac biba/10\(10-10\) /usr/local/etc/rc.d/nagios.sh forcestart</userinput></screen>

      <para>Verifique novamente para garantir que tudo esteja funcionando corretamente. Caso contrário, verifique os arquivos de log em busca de mensagens de erro. Se necessário, use o <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> para desativar o módulo de política de segurança <citerefentry><refentrytitle>mac_biba</refentrytitle><manvolnum>4</manvolnum></citerefentry> e tente iniciar tudo novamente.</para>

      <note>
	<para>O usuário <systemitem class="username">root</systemitem> ainda pode alterar a aplicação de segurança e editar seus arquivos de configuração. O comando a seguir permitirá a degradação da política de segurança para um nível inferior para um shell recém executado:</para>

	<screen><prompt>#</prompt> <userinput>setpmac biba/10 csh</userinput></screen>

	<para>Para impedir que isso aconteça, force o usuário a um intervalo usando <citerefentry><refentrytitle>login.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>. Se o <citerefentry><refentrytitle>setpmac</refentrytitle><manvolnum>8</manvolnum></citerefentry> tentar executar um comando fora do intervalo do compartimento, um erro será retornado e o comando não será executado. Nesse caso, defina root como <literal>biba/high(high-high)</literal>.</para>
      </note>
    </sect2>
  </sect1>

  <sect1 xml:id="mac-troubleshoot">
    <title>Solução de problemas do framework MAC</title>

    <indexterm><primary>MAC Troubleshooting</primary></indexterm>

    <para>Esta seção discute erros de configuração comuns e como resolvê-los.</para>

    <variablelist>
      <varlistentry>
	<term>O sinalizador <option>multilabel</option> não fica habilitado na partição raiz (<filename>/</filename>):</term>

	<listitem>
	  <para>As etapas a seguir podem resolver este erro transitório:</para>

	  <procedure>
	    <step>
	      <para>Edite <filename>/etc/fstab</filename> e defina a partição raiz como somente leitura <option>ro</option>.</para>
	    </step>

	    <step>
	      <para>Reinicie no modo single user.</para>
	    </step>

	    <step>
	      <para>Execute <command>tunefs</command> <option> -l enable</option> no <filename>/</filename>.</para>
	    </step>

	    <step>
	      <para>Reinicie o sistema.</para>
	    </step>

	    <step>
	      <para>Execute <command>mount</command> <option>-urw</option> <filename>/</filename> e mude a opção <option>ro</option> de volta para <option>rw</option> no <filename>/etc/fstab</filename> e reinicie o sistema novamente.</para>
	    </step>

	    <step>
	      <para>Verifique novamente a saída do <command>mount</command> para garantir que o <option>multilabel</option> tenha sido configurado corretamente no sistema de arquivos raiz.</para>
	    </step>
	  </procedure>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Depois de estabelecer um ambiente seguro com o <acronym>MAC</acronym>, o <application>Xorg</application> não inicia mais:</term>
	<listitem>
	  <para>Isso pode ser causado pela política <acronym>MAC</acronym> <literal>partition</literal> ou por uma rotulagem incorreta em uma das políticas de rotulagem do <acronym>MAC</acronym>. Para depurar, tente o seguinte:</para>

	  <procedure>
	    <step>
	      <para>Verifique a mensagem de erro. Se o usuário estiver na classe <literal>insecure</literal>, a política <literal>partition</literal> pode ser a culpada. Tente definir a classe do usuário de volta para a classe <literal>default</literal> e reconstrua o banco de dados com o <command>cap_mkdb</command>. Se isso não mitigar o problema, vá para a etapa dois.</para>
	    </step>

	    <step>
	      <para>Verifique duas vezes se as políticas de rótulo estão definidas corretamente para o usuário, para o <application>Xorg</application> e para as entradas no <filename>/dev</filename>.</para>
	    </step>

	    <step>
	      <para>Se nenhum destes resolver o problema, envie a mensagem de erro e uma descrição do ambiente para a lista de discussão <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions">de perguntas gerais sobre o FreeBSD</link>.</para>
	    </step>
	  </procedure>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>O erro <errorname>_secure_path: unable to stat .login_conf</errorname> aparece:</term>
	<listitem>
	  <para>Esse erro pode aparecer quando um usuário tenta alternar do usuário <systemitem class="username">root</systemitem> para outro usuário no sistema. Essa mensagem geralmente ocorre quando o usuário possui uma qualificação mais alta do que a do usuário que ele está tentando se tornar. Por exemplo, se <systemitem class="username">joe</systemitem> tiver uma classificação padrão de <option>biba/low</option> e o <systemitem class="username">root</systemitem> tiver uma classificação de <option>biba/high</option>, o <systemitem class="username">root</systemitem> não poderá visualizar o diretório inicial de <systemitem class="username">joe</systemitem>. Isso acontecerá independente se o <systemitem class="username">root</systemitem> usou ou não o <command>su</command> para se tornar o <systemitem class="username">joe</systemitem>, pois o modelo de integridade do Biba não permitirá que o <systemitem class="username">root</systemitem> exiba objetos definidos em um nível de integridade mais baixo.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>O sistema não reconhece mais o <systemitem class="username">root</systemitem>:</term>
	<listitem>
	  <para>Quando isso ocorre, o <command>whoami</command> retorna <literal>0</literal> e <command>su</command> retorna <errorname>who are you?</errorname>.</para>

	  <para>Isso pode acontecer se uma política de rotulagem foi desativada por <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> ou o módulo de política foi descarregado. Se a política estiver desativada, o banco de dados de recursos de login precisará ser reconfigurado. Verifique duas vezes o <filename>/etc/login.conf</filename> para garantir que todas as opções de <option>label</option> tenham sido removidas e reconstrua o banco de dados com <command>cap_mkdb</command>.</para>

	  <para>Isso também pode acontecer se uma política restringir o acesso ao <filename>master.passwd</filename>. Isso geralmente é causado por um administrador que altera o arquivo sob um rótulo que entra em conflito com a política geral que está sendo usada pelo sistema. Nesses casos, as informações do usuário seriam lidas pelo sistema e o acesso seria bloqueado, pois o arquivo herdaria o novo rótulo. Desative a política usando o <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> e tudo deve retornar ao normal.</para>
	</listitem>
      </varlistentry>
    </variablelist>
  </sect1>
</chapter>

    
<!--
     The FreeBSD Documentation Project
     $FreeBSD$
-->
<!-- Need more documentation on praudit, auditreduce, etc.  Plus more info
on the triggers from the kernel (log rotation, out of space, etc).
And the /dev/audit special file if we choose to support that.  Could use
some coverage of integrating MAC with Event auditing and perhaps discussion
on how some companies or organizations handle auditing and auditing
requirements. -->

<chapter version="5.0" xml:id="audit">

  <info>
    <title>Auditoria de Evento de Segurança</title>

    <authorgroup>
      <author><personname><firstname>Tom</firstname> <surname>Rhodes</surname></personname><contrib>Escrito por</contrib></author>

      <author><personname> <firstname>Robert</firstname> <surname>Watson</surname> </personname></author>
    </authorgroup>
  </info>

  <sect1 xml:id="audit-synopsis">
    <title>Sinopse</title>

    <indexterm><primary>AUDIT</primary></indexterm>
    <indexterm><primary>Security Event Auditing</primary> <see>MAC</see></indexterm>

    <para>O sistema operacional FreeBSD inclui suporte para auditoria de eventos de segurança. A auditoria de eventos oferece suporte a registros confiáveis, detalhados e configuráveis de diversos eventos do sistema relevantes para a segurança, incluindo logins, alterações de configuração e acesso a arquivos e rede. Esses registros de log podem ser inestimáveis para monitoramento de sistema em tempo real, detecção de intrusão e análise "post mortem". O FreeBSD implementa a Application Programming Interface (<acronym>API</acronym>) Basic Security Module (<acronym>BSM</acronym>) publicada pela <trademark>Sun</trademark> e o formato de arquivo, e é interoperável com as implementações de auditoria do <trademark>Solaris</trademark> e do <trademark class="registered">Mac OS</trademark> X.</para>

    <para>Este capítulo se concentra na instalação e configuração da auditoria de eventos. Ele explica as políticas de auditoria e fornece um exemplo de configuração de auditoria.</para>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>O que é auditoria de eventos e como funciona.</para>
      </listitem>

      <listitem>
	<para>Como configurar a auditoria de eventos no FreeBSD para usuários e processos.</para>
      </listitem>

      <listitem>
	<para>Como revisar o caminho da auditoria usando as ferramentas de auditoria para redução e revisão.</para>
      </listitem>
    </itemizedlist>

    <para>Antes de ler este capítulo, você deve:</para>

    <itemizedlist>
      <listitem>
	<para>Entender os fundamentos do <trademark class="registered">UNIX</trademark> e do FreeBSD (<xref linkend="basics"/>).</para>
      </listitem>

      <listitem>
	<para>Familiarize-se com os conceitos básicos de configuração/compilação do kernel (<xref linkend="kernelconfig"/>).</para>
      </listitem>

      <listitem>
	<para>Ter alguma familiaridade com segurança e como ela está presente no FreeBSD (<xref linkend="security"/>).</para>
      </listitem>
    </itemizedlist>

    <warning>
      <para>O recurso de auditoria possui algumas limitações conhecidas. Nem todos os eventos do sistema que são relevantes para a segurança são auditáveis, e também alguns mecanismos de login, como gerenciadores de exibição baseados em <application>Xorg</application> e daemons de terceiros, não configuram adequadamente a auditoria para sessões de login do usuário.</para>

      <para>O recurso de auditoria de eventos de segurança é capaz de gerar logs muito detalhados da atividade do sistema. Em um sistema muito utilizado, os dados do arquivo de rastreamento podem ser muito grandes quando configurados para grandes detalhes, excedendo gigabytes por semana em algumas configurações. Os administradores devem levar em consideração os requisitos de espaço em disco associados a configurações de auditoria de alto volume. Por exemplo, pode ser desejável dedicar um sistema de arquivos ao <filename>/var/audit</filename> para que outros sistemas de arquivos não sejam afetados se o sistema de arquivos de auditoria ficar cheio.</para>
    </warning>
  </sect1>

  <sect1 xml:id="audit-inline-glossary">
    <title>Termos chave</title>

    <para>Os termos a seguir estão relacionados a auditoria de eventos de segurança:</para>

    <itemizedlist>
      <listitem>
	<para><emphasis>event</emphasis>: um evento auditável é qualquer evento que pode ser registrado usando o subsistema de auditoria. Exemplos de eventos relevantes para a segurança incluem a criação de um arquivo, a construção de uma conexão de rede ou o logon de um usuário. Os eventos são <quote>atribuíveis</quote>, o que significa que podem ser rastreados para um usuário autenticado, ou <quote>não atribuível</quote>. Exemplos de eventos não atribuíveis são eventos que ocorrem antes da autenticação no processo de login, como tentativas de senha incorreta.</para>
      </listitem>

      <listitem>
	<para><emphasis>class</emphasis>: um conjunto nomeado de eventos relacionados que são usados em expressões de seleção. As classes de eventos comumente usadas incluem <quote>file creation</quote> (fc), <quote>exec</quote> (ex), e <quote>login_logout</quote> (lo).</para>
      </listitem>

      <listitem>
	<para><emphasis>record</emphasis>: uma entrada de log de auditoria que descreve um evento de segurança. Os registros contêm um tipo de evento de registro, informações sobre o assunto (usuário) executando a ação, informações de data e hora, informações sobre quaisquer objetos ou argumentos e uma condição de sucesso ou falha.</para>
      </listitem>

      <listitem>
	<para><emphasis>trail</emphasis>: um arquivo de log que consiste em uma série de registros de auditoria que descrevem eventos de segurança. As trilhas estão em ordem cronológica aproximada com relação aos eventos concluídos. Apenas processos autorizados podem enviar registros para a trilha de auditoria.</para>
      </listitem>

      <listitem>
	<para><emphasis>selection expression</emphasis>: uma string contendo uma lista de prefixos e nomes de classes de eventos de auditoria usados para combinar eventos.</para>
      </listitem>

      <listitem>
	<para><emphasis>preselection</emphasis>: o processo pelo qual o sistema identifica quais eventos são de interesse do administrador. A configuração de pré-seleção usa uma série de expressões de seleção para identificar quais classes de eventos auditar quais usuários, bem como configurações globais que se aplicam a processos autenticados e não autenticados.</para>
      </listitem>

      <listitem>
	<para><emphasis>reduction</emphasis>: o processo pelo qual os registros das trilhas de auditoria existentes são selecionados para preservação, impressão ou análise. Da mesma forma, o processo pelo qual os registros de auditoria indesejados são removidos da trilha de auditoria. Usando a redução, os administradores podem implementar políticas para a preservação de dados de auditoria. Por exemplo, trilhas de auditoria detalhadas podem ser mantidas por um mês, mas depois disso, as trilhas podem ser reduzidas para preservar apenas as informações de login para fins de arquivamento.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="audit-config">
    <title>Configuração de Auditoria</title>

    <para>O suporte para auditoria de eventos no espaço do usuário é instalado como parte do sistema operacional básico do FreeBSD. O suporte a kernel está disponível no kernel <filename>GENERIC</filename> por padrão, e <citerefentry><refentrytitle>auditd</refentrytitle><manvolnum>8</manvolnum></citerefentry> pode ser ativado adicionando a seguinte linha no <filename>/etc/rc.conf</filename>:</para>

    <programlisting>auditd_enable="YES"</programlisting>

    <para>Em seguida, inicie o daemon de auditoria:</para>

    <screen><prompt>#</prompt> <userinput>service auditd start</userinput></screen>

    <para>Usuários que preferem compilar um kernel personalizado devem incluir a seguinte linha em seu arquivo de configuração de kernel personalizado:</para>

    <programlisting>options	AUDIT</programlisting>

    <sect2>
      <title>Expressões de Seleção de Eventos</title>

      <para>Expressões de seleção são usadas em vários lugares na configuração de auditoria para determinar quais eventos devem ser auditados. Expressões contêm uma lista de classes de eventos para correspondência. As expressões de seleção são avaliadas da esquerda para a direita e duas expressões são combinadas, acrescentando uma à outra.</para>

      <para><xref linkend="event-selection"/> resume as classes de eventos de auditoria padrão:</para>

      <table xml:id="event-selection" frame="none" pgwide="1">
	<title>Classes de Eventos de Auditoria Padrão</title>

	<tgroup cols="3">
	  <thead>
	    <row>
	      <entry>Nome da classe</entry>
	      <entry>Descrição</entry>
	      <entry>Ação</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry>all</entry>
	      <entry>all</entry>
	      <entry>Corresponde todas as classes de eventos.</entry>
	    </row>

	    <row>
	      <entry>aa</entry>
	      <entry>autenticação e autorização</entry>
	      <entry/>
	    </row>

	    <row>
	      <entry>ad</entry>
	      <entry>administrativo</entry>
	      <entry>Ações administrativas executadas no sistema como um todo.</entry>
	    </row>

	    <row>
	      <entry>ap</entry>
	      <entry>aplicação</entry>
	      <entry>Ação definida pela aplicação.</entry>
	    </row>

	    <row>
	      <entry>cl</entry>
	      <entry>file close</entry>
	      <entry>Auditar chamadas para a chamada de sistema <function>close</function>.</entry>
	    </row>

	    <row>
	      <entry>ex</entry>
	      <entry>exec</entry>
	      <entry>Execução do programa de auditoria. Auditoria de argumentos de linha de comando e variáveis de ambiente são controladas via <citerefentry><refentrytitle>audit_control</refentrytitle><manvolnum>5</manvolnum></citerefentry> usando os parâmetros <literal>argv</literal> e <literal>envv</literal> para a configuração da <literal>política</literal>.</entry>
	    </row>

	    <row>
	      <entry>fa</entry>
	      <entry>acesso ao atributo de arquivo</entry>
	      <entry>Audite o acesso de atributos de objetos como <citerefentry><refentrytitle>stat</refentrytitle><manvolnum>1</manvolnum></citerefentry> e <citerefentry><refentrytitle>pathconf</refentrytitle><manvolnum>2</manvolnum></citerefentry>.</entry>
	    </row>

	    <row>
	      <entry>fc</entry>
	      <entry>file create</entry>
	      <entry>Eventos de auditoria em que um arquivo é criado.</entry>
	    </row>

	    <row>
	      <entry>fd</entry>
	      <entry>file delete</entry>
	      <entry>Eventos de auditoria onde ocorre a exclusão de arquivos.</entry>
	    </row>

	    <row>
	      <entry>fm</entry>
	      <entry>file attribute modify</entry>
	      <entry>Eventos de auditoria onde ocorre a modificação do atributo do arquivo, como <citerefentry><refentrytitle>chown</refentrytitle><manvolnum>8</manvolnum></citerefentry>, <citerefentry><refentrytitle>chflags</refentrytitle><manvolnum>1</manvolnum></citerefentry>, e <citerefentry><refentrytitle>flock</refentrytitle><manvolnum>2</manvolnum></citerefentry>.</entry>
	    </row>

	    <row>
	      <entry>fr</entry>
	      <entry>file read</entry>
	      <entry>Eventos de auditoria nos quais dados são lidos ou arquivos são abertos para leitura.</entry>
	    </row>

	    <row>
	      <entry>fw</entry>
	      <entry>file write</entry>
	      <entry>Eventos de auditoria nos quais os dados são gravados ou os arquivos são gravados ou modificados.</entry>
	    </row>

	    <row>
	      <entry>io</entry>
	      <entry>ioctl</entry>
	      <entry>Auditar o uso da chamada de sistema <function>ioctl</function>.</entry>
	    </row>

	    <row>
	      <entry>ip</entry>
	      <entry>ipc</entry>
	      <entry>Auditar várias formas de comunicação entre processos, incluindo pipes POSIX e operações <acronym>IPC</acronym> do System V.</entry>
	    </row>

	    <row>
	      <entry>lo</entry>
	      <entry>login_logout</entry>
	      <entry>Audite os eventos <citerefentry><refentrytitle>login</refentrytitle><manvolnum>1</manvolnum></citerefentry> e <citerefentry><refentrytitle>logout</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</entry>
	    </row>

	    <row>
	      <entry>na</entry>
	      <entry>não atribuível</entry>
	      <entry>Auditar eventos não atribuíveis.</entry>
	    </row>

	    <row>
	      <entry>no</entry>
	      <entry>classe inválida</entry>
	      <entry>Não coincidir com eventos de auditoria.</entry>
	    </row>

	    <row>
	      <entry>nt</entry>
	      <entry>rede (network)</entry>
	      <entry>Eventos de auditoria relacionados a ações de rede, como <citerefentry><refentrytitle>connect</refentrytitle><manvolnum>2</manvolnum></citerefentry> e <citerefentry><refentrytitle>accept</refentrytitle><manvolnum>2</manvolnum></citerefentry>.</entry>
	    </row>

	    <row>
	      <entry>ot</entry>
	      <entry>outros</entry>
	      <entry>Auditoria de eventos diversos.</entry>
	    </row>

	    <row>
	      <entry>pc</entry>
	      <entry>processo</entry>
	      <entry>Auditar operações de processos, como <citerefentry><refentrytitle>exec</refentrytitle><manvolnum>3</manvolnum></citerefentry> e <citerefentry><refentrytitle>exit</refentrytitle><manvolnum>3</manvolnum></citerefentry>.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Essas classes de eventos de auditoria podem ser personalizadas modificando os arquivos de configuração <filename>audit_class</filename> e <filename>audit_event</filename>.</para>

      <para>Cada classe de eventos de auditoria pode ser combinada com um prefixo indicando se as operações com êxito/falha são correspondidas e se a entrada está adicionando ou removendo a correspondência para a classe e o tipo. <xref linkend="event-prefixes"/> resume os prefixos disponíveis:</para>

      <table xml:id="event-prefixes" frame="none" pgwide="1">
	<title>Prefixos para Classes de Eventos de Auditoria</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Prefixo</entry>
	      <entry>Ação</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry>+</entry>
	      <entry>Auditoria de eventos bem sucedidos nesta classe.</entry>
	    </row>

	    <row>
	      <entry>-</entry>
	      <entry>Auditoria de eventos com falha nesta classe.</entry>
	    </row>

	    <row>
	      <entry>^</entry>
	      <entry>Auditoria de eventos nem com sucesso e nem com falha nesta classe.</entry>
	    </row>

	    <row>
	      <entry>^+</entry>
	      <entry>Não faça auditoria de eventos bem-sucedidos nesta classe.</entry>
	    </row>

	    <row>
	      <entry>^-</entry>
	      <entry>Não audite eventos com falha nesta classe.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Se nenhum prefixo estiver presente, as instâncias com êxito e com falha do evento serão auditadas.</para>

      <para>O seguinte exemplo de sequência de seleção seleciona eventos de login/logout bem-sucedidos e com falha, mas apenas eventos de execução bem-sucedidos:</para>

      <programlisting>lo,+ex</programlisting>
    </sect2>

    <sect2>
      <title>Arquivos de Configuração</title>

      <para>Os seguintes arquivos de configuração para auditoria de eventos de segurança são encontrados em <filename>/etc/security</filename>:</para>

      <itemizedlist>
	<listitem>
	  <para><filename>audit_class</filename>: contém as definições das classes de auditoria.</para>
	</listitem>

	<listitem>
	  <para><filename>audit_control</filename>: controla os aspectos do subsistema de auditoria, como as classes de auditoria padrão, o espaço em disco mínimo a ser deixado no volume do log de auditoria e o tamanho máximo da trilha de auditoria.</para>
	</listitem>

	<listitem>
	  <para><filename>audit_event</filename>: nomes e descrições textuais de eventos de auditoria do sistema e uma lista de quais classes cada evento está.</para>
	</listitem>

	<listitem>
	  <para><filename>audit_user</filename>: requisitos de auditoria específicos do usuário a serem combinados com os padrões globais no login.</para>
	</listitem>

	<listitem>
	  <para><filename>audit_warn</filename>: um script de shell personalizável usado pelo <citerefentry><refentrytitle>auditd</refentrytitle><manvolnum>8</manvolnum></citerefentry> para gerar mensagens de aviso em situações excepcionais, como quando o espaço para registros de auditoria está baixo ou quando o arquivo de trilha de auditoria foi rotacionado.</para>
	</listitem>
      </itemizedlist>

      <warning>
	<para>Os arquivos de configuração de auditoria devem ser editados e mantidos com cuidado, pois erros na configuração podem resultar no registro inadequado de eventos.</para>
      </warning>

      <para>Na maioria dos casos, os administradores precisarão modificar apenas <filename>audit_control</filename> e <filename>audit_user</filename>. O primeiro arquivo controla as políticas e as propriedades de auditoria de todo o sistema, e o segundo arquivo pode ser usado para ajustar a auditoria pelo usuário.</para>

      <sect3 xml:id="audit-auditcontrol">
	<title>O arquivo <filename>audit_control</filename></title>

	<para>Vários padrões para o subsistema de auditoria são especificados em <filename>audit_control</filename>:</para>

	<programlisting>dir:/var/audit
dist:off
flags:lo,aa
minfree:5
naflags:lo,aa
policy:cnt,argv
filesz:2M
expire-after:10M</programlisting>

	<para>A entrada <option>dir</option> é usada para definir um ou mais diretórios onde os logs de auditoria serão armazenados. Se mais de uma entrada de diretório aparecer, elas serão usadas em ordem à medida que forem preenchidas. É comum configurar a auditoria para que os logs de auditoria sejam armazenados em um sistema de arquivos dedicado, para evitar a interferência entre o subsistema de auditoria e outros subsistemas, se o sistema de arquivos encher.</para>

	<para>Se o campo <option>dist</option> estiver definido como <literal>on</literal> ou <literal>yes</literal>, os links físicos serão criados para todos os arquivos de rastreio em <filename>/var/audit/dist</filename>.</para>

	<para>O campo <option>flags</option> define a máscara de pré-seleção padrão para todo o sistema para eventos atribuíveis. No exemplo acima, eventos de login/logout bem-sucedidos e com falha, bem como autenticação e autorização, são auditados para todos os usuários.</para>

	<para>A entrada <option>minfree</option> define a porcentagem mínima de espaço livre para o sistema de arquivos no qual a trilha de auditoria está armazenada.</para>

	<para>A entrada <option>naflags</option> especifica as classes de auditoria a serem auditadas para eventos não atribuídos, como o processo de login/logout e autenticação e autorização.</para>

	<para>A entrada <option>policy</option> especifica uma lista separada por vírgula de sinalizadores de política que controla vários aspectos do comportamento de auditoria. O <literal>cnt</literal> indica que o sistema deve continuar em execução apesar de uma falha de auditoria (este sinalizador é altamente recomendado). O outro sinalizador, <literal>argv</literal>, faz com que os argumentos da linha de comando para a chamada de sistema <citerefentry><refentrytitle>execve</refentrytitle><manvolnum>2</manvolnum></citerefentry> sejam auditados como parte de execução de comando.</para>

	<para>A entrada <option>filesz</option> especifica o tamanho máximo para uma trilha de auditoria antes de finalizar e rotacionar automaticamente o arquivo de trilha. Um valor de <literal>0</literal> desabilita a rotação automática de log. Se o tamanho do arquivo solicitado estiver abaixo do mínimo de 512k, ele será ignorado e uma mensagem de log será gerada.</para>

	<para>O campo <option>expire-after</option> especifica quando os arquivos de log de auditoria expirarão e serão removidos.</para>
      </sect3>

      <sect3 xml:id="audit-audituser">
	<title>O Arquivo <filename>audit_user</filename></title>

	<para>O administrador pode especificar requisitos adicionais de auditoria para usuários específicos em <filename>audit_user</filename>. Cada linha configura a auditoria para um usuário através de dois campos: o campo <literal>alwaysaudit</literal> especifica um conjunto de eventos que devem sempre ser auditados para o usuário, e o campo <literal>neveraudit</literal> especifica um conjunto de eventos que nunca devem ser auditados para o usuário.</para>

	<para>As entradas de exemplo a seguir auditam os eventos de login/logout e a execução bem-sucedida do comando para <systemitem class="username">root</systemitem> e criação de arquivos e execução de comando bem-sucedida para <systemitem class="username">www</systemitem>. Se usado com o <filename>audit_control</filename>, a entrada <literal>lo</literal> para <systemitem class="username">root</systemitem> é redundante, e os eventos login/logout também serão auditados para <systemitem class="username">www</systemitem>.</para>

	<programlisting>root:lo,+ex:no
www:fc,+ex:no</programlisting>
      </sect3>
    </sect2>
  </sect1>

  <sect1 xml:id="audit-administration">
    <title>Trabalhando com Trilhas de Auditoria</title>

    <para>Como as trilhas de auditoria são armazenadas no formato binário <acronym>BSM</acronym>, várias ferramentas internas estão disponíveis para modificar ou converter essas trilhas em texto. Para converter arquivos de trilha em um formato de texto simples, use o <command>praudit</command>. Para reduzir o arquivo de trilha de auditoria para fins de análise, arquivamento ou impressão, use o <command>auditreduce</command>. Esse utilitário suporta vários parâmetros de seleção, incluindo tipo de evento, classe de evento, usuário, data ou hora do evento e o caminho ou objeto do arquivo em questão.</para>

    <para>Por exemplo, para baixar todo o conteúdo de um log de auditoria especificado em texto simples:</para>

    <screen><prompt>#</prompt> <userinput>praudit /var/audit/<replaceable>AUDITFILE</replaceable></userinput></screen>

    <para>Onde <replaceable>AUDITFILE</replaceable> é o log de auditoria a ser descarregado.</para>

    <para>As trilhas de auditoria consistem em uma série de registros de auditoria compostos por tokens, em que o <command>praudit</command> imprime sequencialmente, um por linha. Cada token é de um tipo específico, como <literal>header</literal> (um cabeçalho de registro de auditoria) ou <literal>path</literal> (um caminho de arquivo de uma pesquisa de nome). O seguinte é um exemplo de um evento <literal>execve</literal>:</para>

    <programlisting>header,133,10,execve(2),0,Mon Sep 25 15:58:03 2006, + 384 msec
exec arg,finger,doug
path,/usr/bin/finger
attribute,555,root,wheel,90,24918,104944
subject,robert,root,wheel,root,wheel,38439,38032,42086,128.232.9.100
return,success,0
trailer,133</programlisting>

    <para>Esta auditoria representa uma chamada <literal>execve</literal> bem-sucedida, na qual o comando <literal>finger doug</literal> foi executado. O token <literal>exec arg</literal> contém a linha de comando processada apresentada pelo shell ao kernel. O token <literal>path</literal> contém o caminho para o executável conforme procurado pelo kernel. O token <literal>attribute</literal> descreve o binário e inclui o modo de arquivo. O token <literal>subject</literal> armazena o ID do usuário de auditoria, ID do usuário e ID do grupo, ID do usuário real e ID do grupo, ID do processo, ID da sessão, ID da porta e endereço de login. Observe que o ID do usuário de auditoria e o ID do usuário real são diferentes quando o usuário <systemitem class="username">robert</systemitem> mudou para a conta <systemitem class="username">root</systemitem> antes de executar este comando, mas é auditado usando o usuário original autenticado. O token <literal>return</literal> indica a execução bem-sucedida e o <literal>trailer</literal> conclui o registro.</para>

    <para>O formato de saída <acronym>XML</acronym> também é suportado e pode ser selecionado incluindo <option>-x</option>.</para>

    <para>Como os logs de auditoria podem ser muito grandes, um subconjunto de registros pode ser selecionado usando <command>auditreduce</command>. Este exemplo seleciona todos os registros de auditoria produzidos para o usuário <systemitem class="username">trhodes</systemitem> armazenados em <filename>AUDITFILE</filename>:</para>

    <screen><prompt>#</prompt> <userinput>auditreduce -u <replaceable>trhodes</replaceable> /var/audit/<replaceable>AUDITFILE</replaceable> | praudit</userinput></screen>

    <para>Os membros do grupo <systemitem class="groupname">audit</systemitem> têm permissão para ler trilhas de auditoria em <filename>/var/audit</filename>. Por padrão, esse grupo está vazio, portanto, apenas o usuário <systemitem class="username">root</systemitem> pode ler trilhas de auditoria. Os usuários podem ser adicionados ao grupo <systemitem class="groupname">auditoria</systemitem> para delegar direitos de revisão de auditoria. Como a capacidade de rastrear o conteúdo do log de auditoria fornece informações significativas sobre o comportamento dos usuários e processos, recomenda-se que a delegação dos direitos de revisão de auditoria seja executada com cautela.</para>

    <sect2>
      <title>Monitoramento em Tempo Real Usando Pipes de Auditoria</title>

      <para>Pipes de auditoria são pseudo-dispositivos clones que permitem que os aplicativos acessem o fluxo de registro de auditoria em tempo real. Isto é principalmente de interesse para os autores de aplicações de detecção de intrusão e monitoramento de sistemas. No entanto, o dispositivo de canal de auditoria é uma maneira conveniente para o administrador permitir o monitoramento ao vivo sem incorrer em problemas com a propriedade do arquivo de trilha de auditoria ou a rotação de log interrompendo o fluxo de eventos. Para acompanhar o fluxo de eventos de auditoria em tempo real:</para>

      <screen><prompt>#</prompt> <userinput>praudit /dev/auditpipe</userinput></screen>

      <para>Por padrão, os nós de dispositivo dos pipes de auditoria são acessíveis apenas para o usuário <systemitem class="username">root</systemitem>. Para torná-los acessíveis aos membros do grupo <systemitem class="groupname">audit</systemitem>, adicione uma regra <literal>devfs</literal> para <filename>/etc/devfs.rules</filename>:</para>

      <programlisting>add path 'auditpipe*' mode 0440 group audit</programlisting>

      <para>Veja <citerefentry><refentrytitle>devfs.rules</refentrytitle><manvolnum>5</manvolnum></citerefentry> para mais informações sobre como configurar o sistema de arquivos devfs.</para>

      <warning>
	<para>É fácil produzir ciclos de feedback de evento de auditoria, nos quais a visualização de cada evento de auditoria resulta na geração de mais eventos de auditoria. Por exemplo, se toda a rede <acronym>I/O</acronym> for auditada e <command>praudit</command> for executada a partir de uma sessão <acronym>SSH</acronym>, um fluxo contínuo de eventos de auditoria será gerada em uma taxa alta, pois cada evento sendo impresso gerará outro evento. Por esse motivo, é aconselhável executar <command>praudit</command> em um dispositivo de pipe de auditoria a partir de sessões sem auditoria de <acronym>I/O</acronym> de baixa granularidade.</para>
      </warning>
    </sect2>

    <sect2>
      <title>Rotação e Compactação de Arquivos de Trilha de Auditoria</title>

      <para>As trilhas de auditoria são gravadas pelo kernel e gerenciadas pelo daemon de auditoria, <citerefentry><refentrytitle>auditd</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Os administradores não devem tentar usar o <citerefentry><refentrytitle>newsyslog.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry> ou outras ferramentas para rotacionar diretamente os logs de auditoria. Em vez disso, o <command>audit</command> deve ser usado para encerrar a auditoria, reconfigurar o sistema de auditoria e executar a rotação de log. O comando a seguir faz com que o daemon de auditoria crie um novo log de auditoria e sinalize ao kernel para alternar para o novo log. O log antigo será finalizado e renomeado, podendo então ser manipulado pelo administrador:</para>

      <screen><prompt>#</prompt> <userinput>audit -n</userinput></screen>

      <para>Se <citerefentry><refentrytitle>auditd</refentrytitle><manvolnum>8</manvolnum></citerefentry> não estiver em execução no momento, este comando falhará e uma mensagem de erro será apresentada.</para>

      <para>Adicionar a seguinte linha ao <filename>/etc/crontab</filename> agendará essa rotação a cada doze horas:</para>

      <programlisting>0     */12       *       *       *       root    /usr/sbin/audit -n</programlisting>

      <para>A alteração terá efeito quando o <filename>/etc/crontab</filename> for salvo.</para>

      <para>A rotação automática do arquivo de trilha de auditoria com base no tamanho do arquivo é possível usando <option>filesz</option> em <filename>audit_control</filename>, conforme descrito em <xref linkend="audit-auditcontrol"/>.</para>

      <para>Como os arquivos de trilha de auditoria podem se tornar muito grandes, geralmente é desejável compactar ou arquivar rastros depois que eles forem fechados pelo daemon de auditoria. O script <filename>audit_warn</filename> pode ser usado para executar operações personalizadas para uma variedade de eventos relacionados à auditoria, incluindo a terminação limpa de trilhas de auditoria quando elas são rotacionadas. Por exemplo, o seguinte pode ser adicionado ao <filename>/etc/security/audit_warn</filename> para compactar as trilhas de auditoria ao serem fechados:</para>

      <programlisting>#
# Compress audit trail files on close.
#
if [ "$1" = closefile ]; then
        gzip -9 $2
fi</programlisting>

      <para>Outras atividades de arquivamento podem incluir a cópia de arquivos de trilha para um servidor centralizado, a exclusão de arquivos de trilha antigos ou a redução da trilha de auditoria para remover registros desnecessários. Este script será executado somente quando os arquivos da trilha de auditoria forem finalizados de forma limpa, portanto, não serão executados em trilhas deixadas sem serem eliminadas após um desligamento incorreto.</para>
    </sect2>
  </sect1>
</chapter>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->

<chapter version="5.0" xml:id="disks">

  <title>Armazenamento</title>

  <sect1 xml:id="disks-synopsis">
    <title>Sinopse</title>

    <para>Este capítulo aborda o uso de discos e mídia de armazenamento no FreeBSD. Isso inclui discos <acronym>SCSI</acronym> e <acronym>IDE</acronym>, mídias de <acronym>CD</acronym> e <acronym>DVD</acronym>, discos com suporte de memória e dispositivos de armazenamento <acronym>USB</acronym>.</para>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>Como adicionar discos rígidos adicionais a um sistema FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como aumentar o tamanho da partição de um disco no FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como configurar o FreeBSD para usar dispositivos de armazenamento <acronym>USB</acronym>.</para>
      </listitem>

      <listitem>
	<para>Como usar mídias de <acronym>CD</acronym> e <acronym>DVD</acronym> em um sistema FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como usar os programas de backup disponíveis no FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como configurar discos de memória.</para>
      </listitem>

      <listitem>
	<para>O que são snapshots de sistema de arquivos e como usá-los com eficiência.</para>
      </listitem>

      <listitem>
	<para>Como usar cotas para limitar o uso de espaço em disco.</para>
      </listitem>

      <listitem>
	<para>Como criptografar discos e swap para protegê-los contra invasores.</para>
      </listitem>

      <listitem>
	<para>Como configurar uma rede de armazenamento altamente disponível.</para>
      </listitem>
    </itemizedlist>

    <para>Antes de ler este capítulo, você deve:</para>

    <itemizedlist>
      <listitem>
	<para>Saiba como <link linkend="kernelconfig">configurar e instalar um novo kernel do FreeBSD</link>.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="disks-adding">
    <info>
      <title>Adicionando Discos</title>

      <authorgroup>
	<author><personname> <firstname>David</firstname> <surname>O'Brien</surname> </personname> <contrib>Originalmente contribuído por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>disks</primary> <secondary>adding</secondary></indexterm>

    <para>Esta seção descreve como adicionar um novo disco <acronym>SATA</acronym> a uma máquina que atualmente possui apenas uma única unidade. Primeiro, desligue o computador e instale a unidade no computador seguindo as instruções do fabricante do computador, controladora e unidade. Reinicialize o sistema e torne-se <systemitem class="username">root</systemitem>.</para>

    <para>Inspecione o arquivo <filename>/var/run/dmesg.boot</filename> para garantir que o novo disco foi encontrado. Neste exemplo, a unidade <acronym>SATA</acronym> recém-adicionada aparecerá como <filename>ada1</filename>.</para>

    <indexterm><primary>partitions</primary></indexterm>
    <indexterm><primary><command>gpart</command></primary></indexterm>

    <para>Para este exemplo, uma única partição grande será criada no novo disco. O esquema de particionamento <link xlink:href="http://en.wikipedia.org/wiki/GUID_Partition_Table"><acronym>GPT</acronym></link> será usado ao invés do esquema <acronym>MBR</acronym>, mais antigo e menos versátil.</para>

    <note>
      <para>Se o disco a ser adicionado não estiver em branco, as informações antigas da partição podem ser removidas com <command>gpart delete</command>. Veja <citerefentry><refentrytitle>gpart</refentrytitle><manvolnum>8</manvolnum></citerefentry> para detalhes.</para>
    </note>

    <para>O esquema de partição é criado e, em seguida, uma única partição é adicionada. Para melhorar o desempenho em discos mais recentes com tamanhos maiores de blocos de hardware, a partição está alinhada a divisões de um megabyte:</para>

    <screen><prompt>#</prompt> <userinput>gpart create -s GPT ada1</userinput>
<prompt>#</prompt> <userinput>gpart add -t freebsd-ufs -a 1M ada1</userinput></screen>

    <para>Dependendo do uso, várias partições menores podem ser desejadas. Veja <citerefentry><refentrytitle>gpart</refentrytitle><manvolnum>8</manvolnum></citerefentry> para opções para criar partições menores que um disco inteiro.</para>

    <para>As informações da partição de disco podem ser visualizadas com <command>gpart show</command>:</para>

    <screen><prompt>%</prompt> <userinput>gpart show ada1</userinput>
=&gt;        34  1465146988  ada1  GPT  (699G)
          34        2014        - free -  (1.0M)
        2048  1465143296     1  freebsd-ufs  (699G)
  1465145344        1678        - free -  (839K)</screen>

    <para>Um sistema de arquivos é criado em uma nova partição no novo disco:</para>

    <screen><prompt>#</prompt> <userinput>newfs -U /dev/ada1p1</userinput></screen>

    <para>Um diretório vazio é criado como um <emphasis>ponto de montagem</emphasis>, um local para montar o novo disco no sistema de arquivos do disco original:</para>

    <screen><prompt>#</prompt> <userinput>mkdir /newdisk</userinput></screen>

    <para>Finalmente, uma entrada é adicionada ao arquivo <filename>/etc/fstab</filename> para que o novo disco seja montado automaticamente na inicialização:</para>

    <programlisting>/dev/ada1p1	/newdisk	ufs	rw	2	2</programlisting>

    <para>O novo disco pode ser montado manualmente, sem reiniciar o sistema:</para>

    <screen><prompt>#</prompt> <userinput>mount /newdisk</userinput></screen>
  </sect1>

  <sect1 xml:id="disks-growing">
    <info>
      <title>Redimensionando e Ampliando Discos</title>

      <authorgroup>
	<author><personname> <firstname>Allan</firstname> <surname>Jude</surname> </personname> <contrib>Originalmente contribuído por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>disks</primary> <secondary>resizing</secondary></indexterm>

    <para>A capacidade de um disco pode aumentar sem alterações nos dados já presentes. Isso acontece normalmente com máquinas virtuais, quando o disco virtual torna-se muito pequeno e é ampliado. Às vezes, uma imagem de disco é gravada em um cartão de memória <acronym>USB</acronym>, mas não usa toda a capacidade. Aqui nós descrevemos como redimensionar ou <emphasis>ampliar</emphasis> o conteúdo do disco para aproveitar a capacidade aumentada.</para>

    <para>Determine o nome do dispositivo do disco a ser redimensionado inspecionando o arquivo <filename>/var/run/dmesg.boot</filename>. Neste exemplo, há apenas um disco <acronym>SATA</acronym> no sistema, portanto a unidade aparecerá como <filename>ada0</filename>.</para>

    <indexterm><primary>partitions</primary></indexterm>
    <indexterm><primary><command>gpart</command></primary></indexterm>

    <para>Liste as partições no disco para ver a configuração atual:</para>

    <screen><prompt>#</prompt> <userinput>gpart show <replaceable>ada0</replaceable></userinput>
=&gt;      34  83886013  ada0  GPT  (48G) [CORRUPT]
        34       128     1  freebsd-boot  (64k)
       162  79691648     2  freebsd-ufs  (38G)
  79691810   4194236     3  freebsd-swap  (2G)
  83886046         1        - free -  (512B)</screen>

    <note>
      <para>Se o disco foi formatado com o esquema de particionamento <link xlink:href="http://en.wikipedia.org/wiki/GUID_Partition_Table"><acronym>GPT</acronym></link>, ele pode ser exibido como <quote>corrompido</quote> porque a tabela de partições de backup <acronym>GPT</acronym> não está mais no final da unidade. Corrija a tabela de partições de backup com o <command>gpart</command>:</para>

      <screen><prompt>#</prompt> <userinput>gpart recover <replaceable>ada0</replaceable></userinput>
ada0 recovered</screen>
    </note>

    <para>Agora, o espaço adicional no disco está disponível para uso por uma nova partição ou uma partição existente pode ser expandida:</para>

    <screen><prompt>#</prompt> <userinput>gpart show <replaceable>ada0</replaceable></userinput>
=&gt;       34  102399933  ada0  GPT  (48G)
         34        128     1  freebsd-boot  (64k)
        162   79691648     2  freebsd-ufs  (38G)
   79691810    4194236     3  freebsd-swap  (2G)
   83886046   18513921        - free -  (8.8G)</screen>

    <para>As partições só podem ser redimensionadas para um espaço livre contíguo. Aqui, a última partição no disco é a partição swap, mas a segunda partição é aquela que precisa ser redimensionada. As partições de Swap contêm apenas dados temporários, portanto, podem ser desmontadas, excluídas e, em seguida, recriadas a terceira partição após redimensionar a segunda partição.</para>

    <para>Desative a partição de swap:</para>

    <screen><prompt>#</prompt> <userinput>swapoff <replaceable>/dev/ada0p3</replaceable></userinput></screen>

    <para>Exclua a terceira partição, especificada pela flag <option>-i</option>, do disco <replaceable>ada0</replaceable>.</para>

    <screen>
<prompt>#</prompt> <userinput>gpart delete -i <replaceable>3</replaceable> <replaceable>ada0</replaceable></userinput>
ada0p3 deleted
<prompt>#</prompt> <userinput>gpart show <replaceable>ada0</replaceable></userinput>
=&gt;       34  102399933  ada0  GPT  (48G)
         34        128     1  freebsd-boot  (64k)
        162   79691648     2  freebsd-ufs  (38G)
   79691810   22708157        - free -  (10G)</screen>

    <warning>
      <para>Existe o risco de perda de dados ao modificar a tabela de partições de um sistema de arquivos montado. É melhor executar as etapas a seguir em um sistema de arquivos desmontado durante a execução de um dispositivo <acronym>CD-ROM</acronym> ou <acronym>USB</acronym> live. No entanto, se for absolutamente necessário, um sistema de arquivos montado pode ser redimensionado depois de desativar os recursos de segurança do GEOM:</para>

      <screen><prompt>#</prompt> <userinput>sysctl kern.geom.debugflags=16</userinput></screen>
    </warning>

    <para>Redimensione a partição, deixando espaço para recriar uma partição swap do tamanho desejado. A partição a ser redimensionada é especificada com <option>-i</option> e o novo tamanho desejado com <option>-s</option>. Opcionalmente, o alinhamento da partição é controlado com <option>-a</option>. Isso só modifica o tamanho da partição. O sistema de arquivos na partição será expandido em uma etapa separada.</para>

    <screen><prompt>#</prompt> <userinput>gpart resize -i <replaceable>2</replaceable> -s <replaceable>47G</replaceable> -a 4k <replaceable>ada0</replaceable></userinput>
ada0p2 resized
<prompt>#</prompt> <userinput>gpart show <replaceable>ada0</replaceable></userinput>
=&gt;       34  102399933  ada0  GPT  (48G)
         34        128     1  freebsd-boot  (64k)
        162   98566144     2  freebsd-ufs  (47G)
   98566306    3833661        - free -  (1.8G)</screen>

    <para>Recrie a partição swap e ative-a. Se nenhum tamanho for especificado com <option>-s</option>, todo o espaço restante será usado:</para>

    <screen><prompt>#</prompt> <userinput>gpart add -t freebsd-swap -a 4k <replaceable>ada0</replaceable></userinput>
ada0p3 added
<prompt>#</prompt> <userinput>gpart show <replaceable>ada0</replaceable></userinput>
=&gt;       34  102399933  ada0  GPT  (48G)
         34        128     1  freebsd-boot  (64k)
        162   98566144     2  freebsd-ufs  (47G)
   98566306    3833661     3  freebsd-swap  (1.8G)
<prompt>#</prompt> <userinput>swapon <replaceable>/dev/ada0p3</replaceable></userinput></screen>

    <para>Aumente o sistema de arquivos <acronym>UFS</acronym> para usar a nova capacidade da partição redimensionada:</para>

    <screen><prompt>#</prompt> <userinput>growfs <replaceable>/dev/ada0p2</replaceable></userinput>
Device is mounted read-write; resizing will result in temporary write suspension for /.
It's strongly recommended to make a backup before growing the file system.
OK to grow file system on /dev/ada0p2, mounted on /, from 38GB to 47GB? [Yes/No] <userinput>Yes</userinput>
super-block backups (for fsck -b #) at:
 80781312, 82063552, 83345792, 84628032, 85910272, 87192512, 88474752,
 89756992, 91039232, 92321472, 93603712, 94885952, 96168192, 97450432</screen>

    <para>Se o sistema de arquivos for <acronym>ZFS</acronym>, o redimensionamento será acionado pela execução do subcomando <option>online</option> com <option>-e</option>:</para>

    <screen><prompt>#</prompt> <userinput>zpool online -e <replaceable>zroot</replaceable> <replaceable>/dev/ada0p2</replaceable></userinput></screen>

    <para>Tanto a partição quanto o sistema de arquivos foram redimensionados para usar o espaço em disco recém-disponível.</para>
  </sect1>

  <sect1 xml:id="usb-disks">
    <info>
      <title>Dispositivos de Armazenamento <acronym>USB</acronym></title>

      <authorgroup>
	<author><personname><firstname>Marc</firstname> <surname>Fonvieille</surname></personname> <contrib>Contribuído por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>USB</primary> <secondary>disks</secondary></indexterm>

    <para>Muitas soluções de armazenamento externo, como discos rígidos, thumbdrives <acronym>USB</acronym> e gravadores de <acronym>CD</acronym> e <acronym>DVD</acronym>, usam o Universal Serial Bus (<acronym> USB </acronym>). O FreeBSD fornece suporte para dispositivos <acronym>USB</acronym> 1.x, 2.0 e 3.0.</para>

    <note>
      <para>O suporte a <acronym>USB</acronym> 3.0 não é compatível com alguns hardwares, incluindo os chipsets Haswell (Lynx Point). Se o FreeBSD inicializar com uma mensagem <errorname>falhou com erro 19</errorname>, desative xHCI/USB3 na <acronym>BIOS</acronym>.</para>
    </note>

    <para>O suporte para dispositivos de armazenamento <acronym>USB</acronym> é embutido no kernel <filename>GENERIC</filename>. Para um kernel personalizado, certifique-se de que as seguintes linhas estejam presentes no arquivo de configuração do kernel:</para>

    <programlisting>device scbus	# SCSI bus (required for ATA/SCSI)
device da	# Direct Access (disks)
device pass	# Passthrough device (direct ATA/SCSI access)
device uhci	# provides USB 1.x support
device ohci	# provides USB 1.x support
device ehci	# provides USB 2.0 support
device xhci	# provides USB 3.0 support
device usb	# USB Bus (required)
device umass	# Disks/Mass storage - Requires scbus and da
device cd	# needed for CD and DVD burners</programlisting>

    <para>O FreeBSD usa o driver <citerefentry><refentrytitle>umass</refentrytitle><manvolnum>4</manvolnum></citerefentry> que usa o subsistema <acronym>SCSI</acronym> para acessar o armazenamento de dispositivos <acronym>USB</acronym>. Como qualquer dispositivo <acronym>USB</acronym> será visto como um dispositivo <acronym>SCSI</acronym> pelo sistema, se o dispositivo <acronym>USB</acronym> for um gravador de <acronym>CD</acronym> ou <acronym>DVD</acronym>, <emphasis>não</emphasis> inclua <option>device atapicam</option> em um arquivo de configuração do kernel personalizado.</para>

    <para>O restante desta seção demonstra como verificar se um dispositivo de armazenamento <acronym>USB</acronym> é reconhecido pelo FreeBSD e como configurar o dispositivo para que ele possa ser usado.</para>

    <sect2>
      <title>Configuração de Dispositivo</title>

      <para>Para testar a configuração <acronym>USB</acronym>, conecte o dispositivo <acronym>USB</acronym>. Use <command>dmesg</command> para confirmar que a unidade aparece no buffer de mensagens do sistema. Deve parecer algo como isto:</para>

      <screen>umass0: &lt;STECH Simple Drive, class 0/0, rev 2.00/1.04, addr 3&gt; on usbus0
umass0:  SCSI over Bulk-Only; quirks = 0x0100
umass0:4:0:-1: Attached to scbus4
da0 at umass-sim0 bus 0 scbus4 target 0 lun 0
da0: &lt;STECH Simple Drive 1.04&gt; Fixed Direct Access SCSI-4 device
da0: Serial Number WD-WXE508CAN263
da0: 40.000MB/s transfers
da0: 152627MB (312581808 512 byte sectors: 255H 63S/T 19457C)
da0: quirks=0x2&lt;NO_6_BYTE&gt;</screen>

      <para>A marca, o nó de dispositivo (<filename>da0</filename>), a velocidade e o tamanho serão diferentes de acordo com o dispositivo.</para>

      <para>Como o dispositivo <acronym>USB</acronym> é visto como um <acronym>SCSI</acronym>, o <command>camcontrol</command> pode ser usado para listar os dispositivos de armazenamento <acronym>USB</acronym> conectados ao sistema:</para>

      <screen><prompt>#</prompt> <userinput>camcontrol devlist</userinput>
&lt;STECH Simple Drive 1.04&gt;          at scbus4 target 0 lun 0 (pass3,da0)</screen>

      <para>Alternativamente, o <command>usbconfig</command> pode ser usado para listar o dispositivo. Consulte o <citerefentry vendor="current"><refentrytitle>usbconfig</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter mais informações sobre este comando.</para>

      <screen><prompt>#</prompt> <userinput>usbconfig</userinput>
ugen0.3: &lt;Simple Drive STECH&gt; at usbus0, cfg=0 md=HOST spd=HIGH (480Mbps) pwr=ON (2mA)</screen>

      <para>Se o dispositivo não tiver sido formatado, consulte <xref linkend="disks-adding"/> para obter instruções sobre como formatar e criar partições na unidade <acronym>USB</acronym>. Se a unidade vier com um sistema de arquivos, ela pode ser montada pelo <systemitem class="username">root</systemitem> usando as instruções em <xref linkend="mount-unmount"/>.</para>

      <warning>
	<para>Permitir que usuários não confiáveis montem mídia arbitrária, ativando <varname>vfs.usermount</varname> como descrito abaixo, não deve ser considerado seguro do ponto de vista da segurança. A maioria dos sistemas de arquivos não foi criada para proteger contra dispositivos maliciosos.</para>
      </warning>

      <para>Para tornar o dispositivo montável como um usuário normal, uma solução é tornar todos os usuários do dispositivo membros do grupo <systemitem class="groupname">operator</systemitem> usando <citerefentry><refentrytitle>pw</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Em seguida, certifique-se de que <systemitem class="groupname">operator</systemitem> possa ler e gravar o dispositivo adicionando estas linhas ao <filename>/etc/devfs.rules</filename>:</para>

      <programlisting>[localrules=5]
add path 'da*' mode 0660 group operator</programlisting>

      <note>
	<para>Se discos internos <acronym>SCSI</acronym> também estiverem instalados no sistema, altere a segunda linha da seguinte maneira:</para>

	<programlisting>add path 'da[<replaceable>3</replaceable>-9]*' mode 0660 group operator</programlisting>

	<para>Isso excluirá os três primeiros discos <acronym>SCSI</acronym> (<filename>da0</filename> para <filename>da2</filename>) pertencentes ao grupo <systemitem class="groupname">operator</systemitem>. Substitua <replaceable>3</replaceable> pelo número de discos <acronym>SCSI</acronym> internos. Consulte <citerefentry><refentrytitle>devfs.rules</refentrytitle><manvolnum>5</manvolnum></citerefentry> para obter mais informações sobre esse arquivo.</para>
      </note>

      <para>Em seguida, ative o conjunto de regras no arquivo <filename>/etc/rc.conf</filename>:</para>

      <programlisting>devfs_system_ruleset="localrules"</programlisting>

      <para>Em seguida, instrua o sistema para permitir que usuários comuns montem sistemas de arquivos incluindo a seguinte linha no arquivo <filename>/etc/sysctl.conf</filename>:</para>

      <programlisting>vfs.usermount=1</programlisting>

      <para>Como isso só entra em vigor após a próxima reinicialização, use <command>sysctl</command> para definir essa variável agora:</para>

      <screen><prompt>#</prompt> <userinput>sysctl vfs.usermount=1</userinput>
vfs.usermount: 0 -&gt; 1</screen>

      <para>A etapa final é criar um diretório no qual o sistema de arquivos deve ser montado. Esse diretório precisa pertencer ao usuário que deve montar o sistema de arquivos. Uma maneira de fazer isso é para o <systemitem class="username">root</systemitem> criar um subdiretório de propriedade daquele usuário como <filename>/mnt/<replaceable>username</replaceable></filename>. No exemplo a seguir, substitua <replaceable>username</replaceable> pelo nome de login do usuário e <replaceable>usergroup</replaceable> pelo grupo principal do usuário:</para>

      <screen><prompt>#</prompt> <userinput>mkdir /mnt/<replaceable>username</replaceable></userinput>
<prompt>#</prompt> <userinput>chown <replaceable>username</replaceable>:<replaceable>usergroup</replaceable> /mnt/<replaceable>username</replaceable></userinput></screen>

      <para>Suponha que um thumbdrive <acronym>USB</acronym> esteja conectado e um dispositivo <filename>/dev/da0s1</filename> apareça. Se o dispositivo estiver formatado com um sistema de arquivos <acronym>FAT</acronym>, o usuário poderá montá-lo usando:</para>

      <screen><prompt>%</prompt> <userinput>mount -t msdosfs -o -m=644,-M=755 /dev/da0s1 /mnt/<replaceable>username</replaceable></userinput></screen>

      <para>Antes que o dispositivo possa ser desconectado, ele <emphasis>deve</emphasis> ser desmontado primeiro:</para>

      <screen><prompt>%</prompt> <userinput>umount /mnt/<replaceable>username</replaceable></userinput></screen>

      <para>Após a remoção do dispositivo, o buffer de mensagens do sistema mostrará mensagens semelhantes às seguintes:</para>

      <screen>umass0: at uhub3, port 2, addr 3 (disconnected)
da0 at umass-sim0 bus 0 scbus4 target 0 lun 0
da0: &lt;STECH Simple Drive 1.04&gt; s/n WD-WXE508CAN263          detached
(da0:umass-sim0:0:0:0): Periph destroyed</screen>
    </sect2>

    <sect2>
      <title>Montando Automaticamente Uma Mídia Removível</title>

      <para>Dispositivos <acronym>USB</acronym> podem ser montados automaticamente removendo o comentário desta linha no arquivo <filename>/etc/auto_master</filename>:</para>

      <screen>/media		-media		-nosuid</screen>

      <para>Então adicione estas linhas ao arquivo <filename>/etc/devd.conf</filename>:</para>

      <screen>notify 100 {
	match "system" "GEOM";
	match "subsystem" "DEV";
	action "/usr/sbin/automount -c";
};</screen>

      <para>Recarregue a configuração se <citerefentry><refentrytitle>autofs</refentrytitle><manvolnum>5</manvolnum></citerefentry> e <citerefentry><refentrytitle>devd</refentrytitle><manvolnum>8</manvolnum></citerefentry> já estiverem em execução:</para>

      <screen><prompt>#</prompt> <userinput>service automount restart</userinput>
<prompt>#</prompt> <userinput>service devd restart</userinput></screen>

      <para><citerefentry><refentrytitle>autofs</refentrytitle><manvolnum>5</manvolnum></citerefentry> pode ser configurado para iniciar no boot, adicionando esta linha ao arquivo <filename>/etc/rc.conf</filename>:</para>

      <programlisting>autofs_enable="YES"</programlisting>

      <para><citerefentry><refentrytitle>autofs</refentrytitle><manvolnum>5</manvolnum></citerefentry> requer que o <citerefentry><refentrytitle>devd</refentrytitle><manvolnum>8</manvolnum></citerefentry> esteja ativado, como é por padrão.</para>

      <para>Inicie os serviços imediatamente com:</para>

      <screen><prompt>#</prompt> <userinput>service automount start</userinput>
<prompt>#</prompt> <userinput>service automountd start</userinput>
<prompt>#</prompt> <userinput>service autounmountd start</userinput>
<prompt>#</prompt> <userinput>service devd start</userinput></screen>

      <para>Cada sistema de arquivos que pode ser montado automaticamente aparece como um diretório em <filename>/media/</filename>. O diretório é nomeado após o rótulo do sistema de arquivos. Se o rótulo estiver ausente, o diretório será nomeado após o nó do dispositivo.</para>

      <para>O sistema de arquivos é montado de forma transparente no primeiro acesso e desmontado após um período de inatividade. Unidades montadas automaticamente também podem ser desmontadas manualmente:</para>

      <screen><prompt>#</prompt> <userinput>automount -fu</userinput></screen>

      <para>Este mecanismo é normalmente usado para cartões de memória e cartões de memória <acronym>USB</acronym>. Pode ser usado com qualquer dispositivo de bloco, incluindo unidades ópticas ou <acronym>iSCSI</acronym> <acronym>LUN</acronym>s.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="creating-cds">
    <info>
      <title>Criando e Usando Mídia em <acronym>CD</acronym></title>

      <authorgroup>
	<author><personname> <firstname>Mike</firstname> <surname>Meyer</surname> </personname> <contrib>Contribuído por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary><acronym>CD-ROM</acronym>s</primary> <secondary>creating</secondary></indexterm>

    <para>A mídia em disco compacto (<acronym>CD</acronym>) fornece vários recursos que os diferenciam dos discos convencionais. Eles são projetados para que possam ser lidos continuamente sem atrasos para mover a cabeça entre as trilhas. Embora a mídia <acronym>CD</acronym> tenha faixas, elas se referem a uma seção de dados a ser lida continuamente e não a uma propriedade física do disco. O sistema de arquivos <acronym>ISO</acronym> 9660 foi projetado para lidar com essas diferenças.</para>

    <indexterm><primary><acronym>ISO</acronym> 9660</primary></indexterm>
    <indexterm><primary>file systems</primary> <secondary>ISO 9660</secondary></indexterm>

    <indexterm><primary><acronym>CD</acronym> burner</primary> <secondary><acronym>ATAPI</acronym></secondary></indexterm>

    <para>A Coleção de Ports do FreeBSD fornece vários utilitários para gravar e duplicar áudio e dados de <acronym>CD</acronym>s. Este capítulo demonstra o uso de vários utilitários de linha de comando. Para o software de gravação de <acronym>CD</acronym> com um utilitário gráfico, considere instalar os pacotes ou ports <package>sysutils/xcdroast</package> ou <package>sysutils/k3b</package>.</para>

    <sect2 xml:id="atapicam">
      <info>
	<title>Dispositivos Suportados</title>

	<authorgroup>
	  <author><personname><firstname>Marc</firstname> <surname>Fonvieille</surname></personname> <contrib>Contribuído por </contrib></author>
	</authorgroup>
      </info>

      <indexterm><primary><acronym>CD</acronym> burner</primary> <secondary>ATAPI/CAM driver</secondary></indexterm>

      <para>O kernel <filename>GENERIC</filename> fornece suporte para <acronym>SCSI</acronym>, <acronym>USB</acronym>, e leitores e gravadores de <acronym>CD</acronym> <acronym>ATAPI</acronym>. Se um kernel personalizado for usado, as opções que precisam estar presentes no arquivo de configuração do kernel variam de acordo com o tipo de dispositivo.</para>

      <para>Para um gravador <acronym>SCSI</acronym>, verifique se essas opções estão presentes:</para>

      <programlisting>device scbus	# SCSI bus (required for ATA/SCSI)
device da	# Direct Access (disks)
device pass	# Passthrough device (direct ATA/SCSI access)
device cd	# needed for CD and DVD burners</programlisting>

      <para>Para um gravador de <acronym>USB</acronym>, verifique se essas opções estão presentes:</para>

      <programlisting>device scbus	# SCSI bus (required for ATA/SCSI)
device da	# Direct Access (disks)
device pass	# Passthrough device (direct ATA/SCSI access)
device cd	# needed for CD and DVD burners
device uhci	# provides USB 1.x support
device ohci	# provides USB 1.x support
device ehci	# provides USB 2.0 support
device xhci	# provides USB 3.0 support
device usb	# USB Bus (required)
device umass	# Disks/Mass storage - Requires scbus and da</programlisting>

      <para>Para um gravador <acronym>ATAPI</acronym>, verifique se essas opções estão presentes:</para>

      <programlisting>device ata	# Legacy ATA/SATA controllers
device scbus	# SCSI bus (required for ATA/SCSI)
device pass	# Passthrough device (direct ATA/SCSI access)
device cd	# needed for CD and DVD burners</programlisting>

      <note>
	<para>Nas versões do FreeBSD anteriores a 10.x, esta linha também é necessária no arquivo de configuração do kernel se o gravador for um dispositivo <acronym>ATAPI</acronym>:</para>

	<programlisting>device atapicam</programlisting>

	<para>Como alternativa, esse driver pode ser carregado no momento da inicialização adicionando a seguinte linha ao arquivo <filename>/boot/loader.conf</filename>:</para>

	<programlisting>atapicam_load="YES"</programlisting>

	<para>Isso exigirá uma reinicialização do sistema, pois esse driver só pode ser carregado no momento da inicialização.</para>
      </note>

      <para>Para verificar se o FreeBSD reconhece o dispositivo, execute o <command>dmesg</command> e procure por uma entrada para o dispositivo. Nos sistemas anteriores a 10.x, o nome do dispositivo na primeira linha da saída será <filename>acd0</filename> em vez de <filename>cd0</filename>.</para>

      <screen><prompt>%</prompt> <userinput>dmesg | grep cd</userinput>
cd0 at ahcich1 bus 0 scbus1 target 0 lun 0
cd0: &lt;HL-DT-ST DVDRAM GU70N LT20&gt; Removable CD-ROM SCSI-0 device
cd0: Serial Number M3OD3S34152
cd0: 150.000MB/s transfers (SATA 1.x, UDMA6, ATAPI 12bytes, PIO 8192bytes)
cd0: Attempt to query device size failed: NOT READY, Medium not present - tray closed</screen>
    </sect2>

    <sect2 xml:id="cdrecord">
      <title>Gravando um <acronym>CD</acronym></title>

      <para>No FreeBSD, <command>cdrecord</command> pode ser usado para gravar <acronym>CD</acronym>s. Este comando é instalado com o pacote ou port <package>sysutils/cdrtools</package>.</para>

      <para>Enquanto o <command>cdrecord</command> tem muitas opções, o uso básico é simples. Especifique o nome do arquivo <acronym>ISO</acronym> para gravar e, se o sistema tiver vários dispositivos de gravação, especifique o nome do dispositivo a ser usado:</para>

      <screen><prompt>#</prompt> <userinput>cdrecord <replaceable>dev=device</replaceable> <replaceable>imagefile.iso</replaceable></userinput></screen>

      <para>Para determinar o nome do dispositivo do gravador, use <option>-scanbus</option>, que pode produzir resultados como este:</para>

      <indexterm><primary><acronym>CD-ROM</acronym>s</primary> <secondary>burning</secondary></indexterm>
      <screen><prompt>#</prompt> <userinput>cdrecord -scanbus</userinput>
ProDVD-ProBD-Clone 3.00 (amd64-unknown-freebsd10.0) Copyright (C) 1995-2010 Jörg Schilling
Using libscg version 'schily-0.9'
scsibus0:
        0,0,0     0) 'SEAGATE ' 'ST39236LW       ' '0004' Disk
        0,1,0     1) 'SEAGATE ' 'ST39173W        ' '5958' Disk
        0,2,0     2) *
        0,3,0     3) 'iomega  ' 'jaz 1GB         ' 'J.86' Removable Disk
        0,4,0     4) 'NEC     ' 'CD-ROM DRIVE:466' '1.26' Removable CD-ROM
        0,5,0     5) *
        0,6,0     6) *
        0,7,0     7) *
scsibus1:
        1,0,0   100) *
        1,1,0   101) *
        1,2,0   102) *
        1,3,0   103) *
        1,4,0   104) *
        1,5,0   105) 'YAMAHA  ' 'CRW4260         ' '1.0q' Removable CD-ROM
        1,6,0   106) 'ARTEC   ' 'AM12S           ' '1.06' Scanner
        1,7,0   107) *</screen>

      <para>Localize a entrada para o gravador de <acronym>CD</acronym> e use os três números separados por vírgulas como o valor para <option>dev</option>. Nesse caso, o dispositivo gravador Yamaha é <literal>1,5,0</literal>, portanto, a entrada apropriada para especificar esse dispositivo é <option>dev=1,5,0</option>. Consulte a página de manual do <command>cdrecord</command> para outras formas de especificar este valor e informações sobre como gravar faixas de áudio e controlar a velocidade de gravação.</para>

      <para>Como alternativa, execute o seguinte comando para obter o endereço do dispositivo do gravador:</para>

      <screen><prompt>#</prompt> <userinput>camcontrol devlist</userinput>
&lt;MATSHITA CDRW/DVD UJDA740 1.00&gt;   at scbus1 target 0 lun 0 (cd0,pass0)</screen>

      <para>Use os valores numéricos para <literal>scbus</literal>, <literal>target</literal> e <literal>lun</literal>. Para este exemplo, <literal>1,0,0</literal> é o nome do dispositivo a ser usado.</para>
    </sect2>

    <sect2 xml:id="mkisofs">
      <title>Escrevendo Dados em um Sistema de Arquivos <acronym>ISO</acronym></title>

      <para>Para produzir um <acronym>CD</acronym> de dados, os arquivos de dados que compõem as faixas no <acronym>CD</acronym> devem ser preparados antes que possam ser gravados no <acronym>CD</acronym>. No FreeBSD, <package>sysutils/cdrtools</package> instala o <command>mkisofs</command>, que pode ser usado para produzir um sistema de arquivos <acronym>ISO</acronym> 9660 que é uma imagem de uma árvore de diretórios dentro um sistema de arquivos <trademark class="registered">UNIX</trademark>. O uso mais simples é especificar o nome do arquivo <acronym>ISO</acronym> para criar e o caminho para os arquivos a serem colocados no sistema de arquivos <acronym>ISO</acronym> 9660:</para>

      <screen><prompt>#</prompt> <userinput>mkisofs -o <replaceable>imagefile.iso</replaceable> <replaceable>/path/to/tree</replaceable></userinput></screen>

      <indexterm><primary>file systems</primary> <secondary>ISO 9660</secondary></indexterm>

      <para>Este comando mapeia os nomes dos arquivos no caminho especificado para os nomes que se ajustam às limitações do sistema de arquivos padrão <acronym>ISO</acronym> 9660 e excluirá arquivos que não atendem ao padrão para o sistemas de arquivos <acronym>ISO</acronym>.</para>

      <indexterm><primary>file systems</primary> <secondary>Joliet</secondary></indexterm>

      <para>Várias opções estão disponíveis para superar as restrições impostas pelo padrão. Em particular, <option>-R</option> permite que as extensões Rock Ridge comuns aos sistemas <trademark class="registered">UNIX</trademark> e <option>-J</option> ativem as extensões Joliet usadas por sistemas <trademark class="registered">Microsoft</trademark>.</para>

      <para>Para <acronym>CD</acronym>s que serão usados apenas em sistemas FreeBSD, <option>-U</option> pode ser usado para desabilitar todas as restrições de nome de arquivo. Quando usado com <option>-R</option>, ele produz uma imagem do sistema de arquivos que é idêntica à árvore FreeBSD especificada, mesmo se violar o padrão <acronym>ISO</acronym> 9660.</para>

      <indexterm><primary><acronym>CD-ROM</acronym>s</primary> <secondary>creating bootable</secondary></indexterm>

      <para>A última opção de uso geral é <option>-b</option>. Isso é usado para especificar a localização de uma imagem de inicialização para uso na produção de um <acronym>CD</acronym> inicializável <quote>El Torito</quote>. Essa opção usa um argumento que é o caminho para uma imagem de inicialização a partir do topo da árvore que está sendo gravada no <acronym>CD</acronym>. Por padrão, o <command>mkisofs</command> cria uma imagem <acronym>ISO</acronym> no modo de <quote>emulação de disquete</quote> e, portanto, espera que a imagem de inicialização tenha exatamente 1200, 1440 ou 2880 KB de tamanho. Alguns gerenciadores de inicialização, como o usado pela mídia de distribuição do FreeBSD, não utilizam o modo de emulação. Nesse caso, <option>-no-emul-boot</option> deve ser usado. Então, se <filename>/tmp/myboot</filename> possuir um sistema FreeBSD inicializável com a imagem de inicialização em <filename>/tmp/myboot/boot/cdboot</filename>, este comando produziria <filename>/tmp/bootable.iso</filename>:</para>

      <screen><prompt>#</prompt> <userinput>mkisofs -R -no-emul-boot -b boot/cdboot -o /tmp/bootable.iso /tmp/myboot</userinput></screen>

      <para>A imagem <acronym>ISO</acronym> resultante pode ser montada como um disco de memória com:</para>

      <screen><prompt>#</prompt> <userinput>mdconfig -a -t vnode -f /tmp/bootable.iso -u 0</userinput>
<prompt>#</prompt> <userinput>mount -t cd9660 /dev/md0 /mnt</userinput></screen>

      <para>Pode-se então verificar se <filename>/mnt</filename> e <filename>/tmp/myboot</filename> são idênticos.</para>

      <para>Existem muitas outras opções disponíveis para <command>mkisofs</command> para ajustar seu comportamento. Consulte <citerefentry vendor="ports"> <refentrytitle>mkisofs</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter detalhes.</para>

      <note>
	<para>É possível copiar um <acronym>CD</acronym> de dados para um arquivo de imagem que seja funcionalmente equivalente ao arquivo de imagem criado com <command>mkisofs</command>. Para fazer isso, use <filename>dd</filename> com o nome do dispositivo como o arquivo de entrada e o nome do <acronym>ISO</acronym> para criar como o arquivo de saída:</para>

	<screen><prompt>#</prompt> <userinput>dd if=/dev/<replaceable>cd0</replaceable> of=<replaceable>file.iso</replaceable> bs=2048</userinput></screen>

	<para>O arquivo de imagem resultante pode ser gravado em <acronym>CD</acronym>, conforme descrito em <xref linkend="cdrecord"/>.</para>
      </note>
    </sect2>

    <sect2 xml:id="mounting-cd">
      <title>Usando <acronym>CD</acronym>s de Dados</title>

      <para>Uma vez que uma <acronym>ISO</acronym> tenha sido gravada em um <acronym>CD</acronym>, ela pode ser montada especificando o tipo de sistema de arquivos, o nome do dispositivo que contém o <acronym>CD</acronym> e um ponto de montagem existente:</para>

      <screen><prompt>#</prompt> <userinput>mount -t cd9660 <replaceable>/dev/cd0</replaceable> <replaceable>/mnt</replaceable></userinput></screen>

      <para>Como <command>mount</command> assume que um sistema de arquivos é do tipo <literal>ufs</literal>, um erro <errorname>Incorrect super block</errorname> ocorrerá se <literal>-t cd9660</literal> não está incluído ao montar um arquivo de dados <acronym>CD</acronym>.</para>

      <para>Embora qualquer <acronym>CD</acronym> de dados possa ser montado dessa forma, discos com determinadas extensões <acronym>ISO</acronym> 9660 podem se comportar de maneira estranha. Por exemplo, os discos Joliet armazenam todos os nomes de arquivos em caracteres Unicode de dois bytes. Se alguns caracteres não ingleses aparecerem como pontos de interrogação, especifique o conjunto de caracteres local com <option>-C</option>. Para mais informações, consulte <citerefentry><refentrytitle>mount_cd9660</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>

      <note>
	<para>Para fazer esta conversão de caracteres com a ajuda de <option>-C</option>, o kernel requer que o módulo <filename>cd9660_iconv.ko</filename> seja carregado. Isto pode ser feito adicionando esta linha ao arquivo <filename>loader.conf</filename>:</para>

	<programlisting>cd9660_iconv_load="YES"</programlisting>

	<para>e reinicializando a máquina, ou carregando diretamente o módulo com <command>kldload </command>.</para>
      </note>

      <para>Ocasionalmente, <errorname>Device not configured</errorname> será exibido ao tentar montar um <acronym>CD</acronym> de dados. Isso geralmente significa que a unidade de <acronym>CD</acronym> não detectou um disco na bandeja ou que a unidade não está visível no barramento. Pode levar alguns segundos para que uma unidade de <acronym>CD</acronym> detecte a mídia, por isso, seja paciente.</para>

      <para>Às vezes, uma unidade de <acronym>CD</acronym> <acronym>SCSI</acronym> pode ser perdida porque não teve tempo suficiente para responder à reinicialização do barramento. Para resolver isso, um kernel personalizado pode ser criado, o que aumenta o delay <acronym>SCSI</acronym> padrão. Adicione a seguinte opção ao arquivo de configuração do kernel personalizado e reconstrua o kernel usando as instruções em <xref linkend="kernelconfig-building"/>:</para>

      <programlisting>options SCSI_DELAY=15000</programlisting>

      <para>Isso faz com que o barramento <acronym>SCSI</acronym> faça uma pausa de 15 segundos durante a inicialização, para dar à unidade de <acronym>CD</acronym> todas as chances possíveis de responder à reinicialização do barramento.</para>

      <note>
	<para>É possível gravar um arquivo diretamente no <acronym>CD</acronym>, sem criar um sistema de arquivos <acronym>ISO</acronym> 9660. Isso é conhecido como gravação de dados brutos em <acronym>CD</acronym> e algumas pessoas fazem isso para fins de backup.</para>

	<para>Este tipo de disco não pode ser montado como um <acronym>CD</acronym> de dados normal. Para recuperar os dados gravados em um <acronym>CD</acronym>, os dados devem ser lidos no nó do dispositivo bruto. Por exemplo, este comando irá extrair um arquivo tar compactado localizado no segundo dispositivo de <acronym>CD</acronym> para o diretório de trabalho atual:</para>

	<screen><prompt>#</prompt> <userinput>tar xzvf /dev/<replaceable>cd1</replaceable></userinput></screen>

	<para>Para montar um <acronym>CD</acronym> de dados, os dados devem ser escritos usando <command>mkisofs</command>.</para>
      </note>
    </sect2>

    <sect2 xml:id="duplicating-audiocds">
      <title>Duplicando <acronym>CD</acronym>s de Áudio</title>

      <para>Para duplicar um <acronym>CD</acronym> de áudio, extraia os dados de áudio do <acronym>CD</acronym> para uma série de arquivos e, em seguida, grave esses arquivos em um <acronym>CD</acronym> em branco.</para>

      <para><xref linkend="using-cdrecord"/> descreve como duplicar e gravar um <acronym>CD</acronym> de áudio. Se a versão do FreeBSD for menor que 10.0 e o dispositivo for <acronym>ATAPI</acronym>, o módulo <option>atapicam</option> deve ser carregado primeiro usando as instruções em <xref linkend="atapicam"/>.</para>

      <procedure xml:id="using-cdrecord">
	<title>Duplicando um <acronym>CD</acronym> de Áudio</title>

	<step>
	  <para>O pacote ou port <package>sysutils/cdrtools</package> instala o <command>cdda2wav</command>. Este comando pode ser usado para extrair todas as faixas de áudio, com cada faixa gravada em um arquivo <acronym>WAV</acronym> separado no diretório de trabalho atual:</para>

	  <screen><prompt>%</prompt> <userinput>cdda2wav -vall -B -Owav</userinput></screen>

	  <para>Um nome de dispositivo não precisa ser especificado se houver apenas um dispositivo de <acronym>CD</acronym> no sistema. Consulte a página de manual <command>cdda2wav</command> para obter instruções sobre como especificar um dispositivo e aprender mais sobre as outras opções disponíveis para este comando.</para>
	</step>

	<step>
	  <para>Use o <command>cdrecord</command> para escrever os arquivos <filename>.wav</filename>:</para>

	  <screen><prompt>%</prompt> <userinput>cdrecord -v dev=<replaceable>2,0</replaceable> -dao -useinfo  *.wav</userinput></screen>

	  <para>Certifique-se de que <replaceable>2,0</replaceable> esteja configurado adequadamente, conforme descrito em <xref linkend="cdrecord"/>.</para>
	</step>
      </procedure>
    </sect2>
  </sect1>

  <sect1 xml:id="creating-dvds">
    <info>
      <title>Criando e Usando Mídia de <acronym>DVD</acronym></title>

      <authorgroup>
	<author><personname><firstname>Marc</firstname> <surname>Fonvieille</surname></personname> <contrib>Contribuído por </contrib></author>
      </authorgroup>
      <authorgroup>
	<author><personname> <firstname>Andy</firstname> <surname>Polyakov</surname> </personname> <contrib>Com entradas de </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary><acronym>DVD</acronym></primary> <secondary>burning</secondary></indexterm>

    <para>Comparado ao <acronym>CD</acronym>, o <acronym>DVD</acronym> é a próxima geração de tecnologia de armazenamento de mídia ótica. O <acronym>DVD</acronym> pode conter mais dados do que qualquer <acronym>CD</acronym> e é o padrão para publicação de vídeos.</para>

    <para>Cinco formatos graváveis físicos podem ser definidos para um <acronym>DVD</acronym> gravável:</para>

    <itemizedlist>
      <listitem>
	<para>DVD-R: Este foi o primeiro formato gravável disponível em <acronym>DVD</acronym>. O padrão DVD-R é definido pelo <link xlink:href="http://www.dvdforum.org/forum.shtml"><acronym>DVD</acronym> Forum</link>. Este formato é escrito uma vez.</para>
      </listitem>

      <listitem>
	<para><acronym>DVD-RW</acronym>: Esta é a versão regravável do padrão DVD-R. Um <acronym>DVD-RW</acronym> pode ser reescrito cerca de 1000 vezes.</para>
      </listitem>

      <listitem>
	<para><acronym>DVD-RAM</acronym>: Este é um formato regravável que pode ser visto como um disco rígido removível. No entanto, esta mídia não é compatível com a maioria das unidades e reprodutores de DVD-Video <acronym>DVD-ROM</acronym>, pois apenas alguns gravadores de <acronym>DVD</acronym> suportam o formato <acronym>DVD-RAM</acronym>. Consulte <xref linkend="creating-dvd-ram"/> para mais informações sobre o uso de <acronym>DVD-RAM</acronym>.</para>
      </listitem>

      <listitem>
	<para><acronym>DVD+RW</acronym>: Este é um formato regravável definido pelo <link xlink:href="https://en.wikipedia.org/wiki/DVD%2BRW_Alliance"> <acronym>DVD+RW </acronym> Alliance</link>. Um <acronym>DVD+RW</acronym> pode ser reescrito cerca de 1000 vezes.</para>
      </listitem>

      <listitem>
	<para>DVD+R: Este formato é a variação de gravação do formato <acronym>DVD+RW</acronym>.</para>
      </listitem>
    </itemizedlist>

    <para>Um <acronym>DVD</acronym> gravável de camada única pode armazenar até 4,700,000,000 bytes, o que é, na verdade, 4.38 GB ou 4485 MB, pois 1 kilobyte é 1024 bytes.</para>

    <note>
      <para>Uma distinção deve ser feita entre a mídia física e a aplicação. Por exemplo, um DVD-Vídeo é um layout de arquivo específico que pode ser gravado em qualquer mídia física <acronym>DVD</acronym> gravável, como DVD-R, DVD+R ou <acronym>DVD-RW</acronym>. Antes de escolher o tipo de mídia, verifique se o gravador e o reprodutor de DVD-Video são compatíveis com a mídia em questão.</para>
    </note>

    <sect2>
      <title>Configuração</title>

      <para>Para executar a gravação de um <acronym>DVD</acronym>, use <citerefentry vendor="ports"><refentrytitle>growisofs</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Este comando é parte dos utilitários <package>sysutils/dvd+rw-tools</package> que suportam todos os tipos de mídia <acronym>DVD</acronym>.</para>

      <para>Estas ferramentas usam o subsistema <acronym>SCSI</acronym> para acessar os dispositivos, portanto <link linkend="atapicam">suporte a ATAPI/CAM</link> deve ser carregado ou estaticamente compilado no kernel. Este suporte não é necessário se o gravador usar a interface <acronym>USB</acronym>. Consulte <xref linkend="usb-disks"/> para mais detalhes sobre a configuração do dispositivo <acronym>USB</acronym>.</para>

      <para>O acesso DMA também deve estar ativado para dispositivos <acronym>ATAPI</acronym>, adicionando a seguinte linha ao arquivo <filename>/boot/loader.conf</filename>:</para>

      <programlisting>hw.ata.atapi_dma="1"</programlisting>

      <para>Antes de tentar usar <application>dvd+rw-tools</application>, consulte o <link xlink:href="http://fy.chalmers.se/~appro/linux/DVD+RW/hcn.html">Notas de compatibilidade de hardware</link>.</para>

      <note>
	<para>Para uma interface gráfica de usuário, considere o uso de <package>sysutils/k3b</package> que fornece uma interface amigável para <citerefentry vendor="ports"><refentrytitle>growisofs</refentrytitle><manvolnum>1</manvolnum></citerefentry> e muitas outras ferramentas de gravação.</para>
      </note>
    </sect2>

    <sect2>
      <title>Gravando <acronym>DVD</acronym>s de Dados</title>

      <para>Já que <citerefentry vendor="ports"><refentrytitle>growisofs</refentrytitle><manvolnum>1</manvolnum></citerefentry> é um front-end para <link linkend="mkisofs">mkisofs</link>, ele invocará <citerefentry vendor="ports"><refentrytitle>mkisofs</refentrytitle><manvolnum>8</manvolnum></citerefentry> para criar o layout do sistema de arquivos e executar a gravação no <acronym>DVD</acronym> . Isso significa que uma imagem dos dados não precisa ser criada antes do processo de gravação.</para>

      <para>Para gravar em um DVD+R ou DVD-R os dados em <filename>/path/to/data</filename>, use o seguinte comando:</para>

      <screen><prompt>#</prompt> <userinput>growisofs -dvd-compat -Z <replaceable>/dev/cd0</replaceable> -J -R <replaceable>/path/to/data</replaceable></userinput></screen>

      <para>Neste exemplo, <option>-J -R</option> é passado para <citerefentry vendor="ports"><refentrytitle>mkisofs</refentrytitle><manvolnum>8</manvolnum></citerefentry> para criar um sistemas de arquivos ISO 9660 com extensões Joliet e Rock Ridge. Consulte o <citerefentry vendor="ports"><refentrytitle>mkisofs</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter mais detalhes.</para>

      <para>Para a gravação inicial da sessão, <option>-Z</option> é usado para sessões únicas e múltiplas. Substitua <replaceable>/dev/cd0</replaceable>, com o nome do dispositivo de <acronym>DVD</acronym>. O uso de <option>-dvd-compat</option> indica que o disco será fechado e que a gravação será inaplicável. Isso também deve fornecer melhor compatibilidade de mídia com unidades <acronym>DVD-ROM</acronym>.</para>

      <para>Para gravar uma imagem pré-masterizada, como <replaceable>imagefile.iso</replaceable>, use:</para>

      <screen><prompt>#</prompt> <userinput>growisofs -dvd-compat -Z <replaceable>/dev/cd0</replaceable>=<replaceable>imagefile.iso</replaceable></userinput></screen>

      <para>A velocidade de gravação deve ser detectada e configurada automaticamente de acordo com a mídia e a unidade que está sendo usada. Para forçar a velocidade de gravação, use <option>-speed=</option>. Consulte o <citerefentry vendor="ports"><refentrytitle>growisofs</refentrytitle><manvolnum>1</manvolnum></citerefentry> para exemplos de uso.</para>

      <note>
	<para>Para suportar arquivos de trabalho maiores que 4.38GB, um sistema de arquivos híbrido UDF/ISO-9660 deve ser criado passando <option>-udf -iso-level 3</option> para <citerefentry vendor="ports"><refentrytitle>mkisofs</refentrytitle><manvolnum>8</manvolnum></citerefentry> e todos os programas relacionados, como <citerefentry vendor="ports"><refentrytitle>growisofs</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Isso é necessário apenas ao criar um arquivo de imagem ISO ou ao gravar arquivos diretamente em um disco. Como um disco criado dessa maneira deve ser montado como um sistema de arquivos UDF com <citerefentry><refentrytitle>mount_udf</refentrytitle><manvolnum>8</manvolnum></citerefentry>, ele será utilizável apenas em um sistema operacional com suporte a UDF. Caso contrário, parecerá que contém arquivos corrompidos.</para>

	<para>Para criar este tipo de arquivo ISO:</para>

	<screen><prompt>%</prompt> <userinput>mkisofs -R -J -udf -iso-level 3 -o <replaceable>imagefile.iso</replaceable> <replaceable>/path/to/data</replaceable></userinput></screen>

	<para>Para gravar arquivos diretamente em um disco:</para>

	<screen><prompt>#</prompt> <userinput>growisofs -dvd-compat -udf -iso-level 3 -Z <replaceable>/dev/cd0</replaceable> -J -R <replaceable>/path/to/data</replaceable></userinput></screen>

	<para>Quando uma imagem ISO já contém arquivos grandes, nenhuma opção adicional é necessária para o <citerefentry vendor="ports"><refentrytitle>growisofs</refentrytitle><manvolnum>1</manvolnum></citerefentry> gravar a imagem em um disco.</para>

	<para>Certifique-se de usar uma versão atualizada do port <package>sysutils/cdrtools</package>, que contenha o <citerefentry vendor="ports"><refentrytitle>mkisofs</refentrytitle><manvolnum>8</manvolnum></citerefentry>, como uma versão mais antiga pode não conter suporte a arquivos grandes. Se a versão mais recente não funcionar, instale o <package>sysutils/cdrtools-devel</package> e leia o <citerefentry vendor="ports"><refentrytitle>mkisofs</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
      </note>
    </sect2>

    <sect2>
      <title>Gravando um <acronym> DVD </acronym>-Video</title>

      <indexterm><primary><acronym>DVD</acronym></primary> <secondary>DVD-Video</secondary></indexterm>

      <para>Um DVD-Video é um layout de arquivo específico baseado nas especificações ISO 9660 e micro-UDF (M-UDF). Como o DVD-Video apresenta uma hierarquia de estrutura de dados específica, um programa específico como <package>multimedia/dvdauthor</package> é necessário para criar o <acronym>DVD</acronym>.</para>

      <para>Se uma imagem do sistema de arquivos DVD-Video já existir, ela poderá ser gravada da mesma maneira que qualquer outra imagem. Se o <command>dvdauthor</command> foi usado para criar o <acronym>DVD</acronym> e o resultado está em <filename>/path/to/video</filename>, o seguinte comando deve ser usado para gravar o DVD-Vídeo:</para>

      <screen><prompt>#</prompt> <userinput>growisofs -Z <replaceable>/dev/cd0</replaceable> -dvd-video <replaceable>/path/to/video</replaceable></userinput></screen>

      <para><option>-dvd-video</option> é passado para o <citerefentry vendor="ports"><refentrytitle>mkisofs</refentrytitle><manvolnum>8</manvolnum></citerefentry> para instruí-lo a criar um sistemas de arquivos com layout DVD-Video. Esta opção implica na opção <option>-dvd-compat</option> do <citerefentry vendor="ports"><refentrytitle>growisofs</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</para>
    </sect2>

    <sect2>
      <title>Usando um <acronym>DVD+RW</acronym></title>

      <indexterm><primary><acronym>DVD</acronym></primary> <secondary><acronym>DVD+RW</acronym></secondary></indexterm>

      <para>Ao contrário do CD-RW, um <acronym>DVD+RW</acronym> virgem precisa ser formatado antes do primeiro uso. É <emphasis>recomendado</emphasis> para permitir que <citerefentry vendor="ports"><refentrytitle>growisofs</refentrytitle><manvolnum>1</manvolnum></citerefentry> cuide disso automaticamente sempre que apropriado. No entanto, é possível usar <command>dvd+rw-format</command> para formatar o <acronym>DVD+RW</acronym>:</para>

      <screen><prompt>#</prompt> <userinput>dvd+rw-format <replaceable>/dev/cd0</replaceable></userinput></screen>

      <para>Somente execute esta operação uma vez e tenha em mente que apenas mídias <acronym>DVD+RW</acronym> virgens precisam ser formatadas. Uma vez formatado, o <acronym>DVD+RW</acronym> pode ser gravado como de costume.</para>

      <para>Para gravar um sistema de arquivos totalmente novo e não apenas acrescentar alguns dados em um <acronym>DVD+RW</acronym>, a mídia não precisa ser apagada primeiro. Em vez disso, escreva sobre a gravação anterior assim:</para>

      <screen><prompt>#</prompt> <userinput>growisofs -Z <replaceable>/dev/cd0</replaceable> -J -R <replaceable>/path/to/newdata</replaceable></userinput></screen>

      <para>O formato <acronym>DVD+RW</acronym> suporta anexar dados a uma gravação anterior. Essa operação consiste em mesclar uma nova sessão à existente, pois ela não é considerada como gravação de várias sessões. <citerefentry vendor="ports"><refentrytitle>growisofs</refentrytitle><manvolnum>1</manvolnum></citerefentry> vai <emphasis>ampliar</emphasis> o sistema de arquivos ISO 9660 presente na mídia.</para>

      <para>Por exemplo, para anexar dados a um <acronym>DVD+RW</acronym>, use o seguinte:</para>

      <screen><prompt>#</prompt> <userinput>growisofs -M <replaceable>/dev/cd0</replaceable> -J -R <replaceable>/path/to/nextdata</replaceable></userinput></screen>

      <para>As mesmas opções do <citerefentry vendor="ports"><refentrytitle>mkisofs</refentrytitle><manvolnum>8</manvolnum></citerefentry> usadas para gravar a sessão inicial devem ser usadas durante as próximas gravações.</para>

      <note>
	<para>Use <option>-dvd-compat</option> para melhor compatibilidade de mídia com as unidades de <acronym>DVD-ROM</acronym>. Ao usar <acronym>DVD+RW</acronym>, essa opção não impedirá a adição de dados.</para>
      </note>

      <para>Para apagar a mídia, use:</para>

      <screen><prompt>#</prompt> <userinput>growisofs -Z <replaceable>/dev/cd0</replaceable>=<replaceable>/dev/zero</replaceable></userinput></screen>
    </sect2>

    <sect2>
      <title>Usando um <acronym>DVD-RW</acronym></title>

      <indexterm><primary><acronym>DVD</acronym></primary> <secondary><acronym>DVD-RW</acronym></secondary></indexterm>

      <para>Um <acronym>DVD-RW</acronym> aceita dois formatos de disco: sequencial incremental e substituição restrita. Por padrão, os discos <acronym>DVD-RW</acronym> estão em formato sequencial.</para>

      <para>Um <acronym>DVD-RW</acronym> virgem pode ser escrito diretamente sem ser formatado. No entanto, um <acronym>DVD-RW</acronym> não-virgem em formato sequencial precisa ser apagado antes de escrever uma nova sessão inicial.</para>

      <para>Para apagar um <acronym>DVD-RW</acronym> em modo sequencial:</para>

      <screen><prompt>#</prompt> <userinput>dvd+rw-format -blank=full <replaceable>/dev/cd0</replaceable></userinput></screen>

      <note>
	<para>Um preenchimento completo usando <option>-blank=full</option> levará cerca de uma hora em uma mídia 1x. Um limpeza rápida pode ser executada usando <option>-blank</option>, se o <acronym>DVD-RW</acronym> for gravado no modo Disk-At-Once (DAO). Para gravar o <acronym>DVD-RW</acronym> no modo DAO, use o comando:</para>

	<screen><prompt>#</prompt> <userinput>growisofs -use-the-force-luke=dao -Z <replaceable>/dev/cd0</replaceable>=<replaceable>imagefile.iso</replaceable></userinput></screen>

	<para>Como o <citerefentry vendor="ports"><refentrytitle>growisofs</refentrytitle><manvolnum>1</manvolnum></citerefentry> tenta automaticamente detectar a mídia rapidamente em branco e ativar a gravação do DAO, <option>-use-the-force -luke=dao</option> não deve ser requerido.</para>

	<para>Em vez disso, deve-se usar o modo de sobrescrita restrita com qualquer <acronym>DVD-RW</acronym>, pois esse formato é mais flexível do que o padrão de sequencial incremental.</para>
      </note>

      <para>Para escrever dados em um <acronym>DVD-RW</acronym> seqüencial, use as mesmas instruções que para os outros formatos de <acronym>DVD</acronym>:</para>

      <screen><prompt>#</prompt> <userinput>growisofs -Z <replaceable>/dev/cd0</replaceable> -J -R <replaceable>/path/to/data</replaceable></userinput></screen>

      <para>Para acrescentar alguns dados a uma gravação anterior, use <option>-M</option> com 
o <citerefentry vendor="ports"><refentrytitle>growisofs</refentrytitle><manvolnum>1</manvolnum></citerefentry>. No entanto, se os dados forem anexados em um <acronym>DVD-RW</acronym> no modo sequencial incremental, uma nova sessão será criada no disco e o resultado será um disco multi-sessão.</para>

      <para>Um <acronym>DVD-RW</acronym> no formato de sobrescrita restrita não precisa ser em apagado antes de uma nova sessão inicial. Em vez disso, sobrescreva o disco com <option>-Z</option>. Também é possível aumentar um sistema de arquivos ISO 9660 existente escrito no disco com <option>-M</option>. O resultado será um <acronym>DVD</acronym> de uma sessão.</para>

      <para>Para colocar um <acronym>DVD-RW</acronym> no formato de sobrescrita restrita, o seguinte comando deve ser usado:</para>

      <screen><prompt>#</prompt> <userinput>dvd+rw-format <replaceable>/dev/cd0</replaceable></userinput></screen>

      <para>Para voltar ao formato sequencial, use:</para>

      <screen><prompt>#</prompt> <userinput>dvd+rw-format -blank=full <replaceable>/dev/cd0</replaceable></userinput></screen>
    </sect2>

    <sect2>
      <title>Multi-Sessão</title>

      <para>Poucas unidades de <acronym>DVD-ROM</acronym> suportam DVDs multi-sessão e na maioria das vezes apenas lêem a primeira sessão. DVD+R, DVD-R e <acronym>DVD-RW</acronym> em formato sequencial podem aceitar várias sessões. A noção de várias sessões não existe para os formatos de sobrescrita restrita <acronym>DVD+RW</acronym> e <acronym>DVD-RW</acronym>.</para>

      <para>Usando o seguinte comando após uma sessão inicial não fechada em um DVD+R, DVD-R ou <acronym>DVD-RW</acronym> em formato sequencial, será adicionada uma nova sessão ao disco:</para>

      <screen><prompt>#</prompt> <userinput>growisofs -M <replaceable>/dev/cd0</replaceable> -J -R <replaceable>/path/to/nextdata</replaceable></userinput></screen>

      <para>Usando este comando com um <acronym>DVD+RW</acronym> ou um <acronym>DVD-RW</acronym> no modo de sobrescrita restrita adicionará dados ao mesclar a nova sessão à existente. O resultado será um disco de sessão única. Use este método para adicionar dados após uma gravação inicial nesses tipos de mídia.</para>

      <note>
	<para>Como algum espaço na mídia é usado entre cada sessão para marcar o final e o início das sessões, deve-se adicionar sessões com uma grande quantidade de dados para otimizar o espaço da mídia. O número de sessões é limitado a 154 para um DVD+R, cerca de 2000 para um DVD-R e 127 para um DVD+R Double Layer.</para>
      </note>
    </sect2>

    <sect2>
      <title>Para Maiores Informações</title>

      <para>Para obter mais informações sobre um <acronym>DVD</acronym>, use o <command>dvd+rw-mediainfo <replaceable>/dev/cd0</replaceable></command> enquanto o disco estiver na unidade especificada.</para>

      <para>Mais informações sobre <application>dvd+rw-tools</application> podem ser encontradas em <citerefentry vendor="ports"><refentrytitle>growisofs</refentrytitle><manvolnum>1</manvolnum></citerefentry>, no <link xlink:href="http://fy.chalmers.se/~appro/linux/DVD+RW/">site de dvd+rw-tools</link>, e nos arquivos do <link xlink:href="http://lists.debian.org/cdwrite/">cdwrite mailing list</link>.</para>

      <note>
	<para>Ao criar um relatório de problemas relacionado ao uso de <application>dvd+rw-tools</application>, inclua sempre a saída de <command>dvd+rw-mediainfo</command>.</para>
      </note>
    </sect2>

    <sect2 xml:id="creating-dvd-ram">
      <title>Usando um <acronym>DVD-RAM</acronym></title>

      <indexterm><primary><acronym>DVD</acronym></primary> <secondary><acronym>DVD-RAM</acronym></secondary></indexterm>

      <para>Os gravadores de <acronym>DVD-RAM</acronym> podem usar uma interface <acronym>SCSI</acronym> ou <acronym>ATAPI</acronym>. Para dispositivos <acronym>ATAPI</acronym>, o acesso DMA deve ser ativado adicionando a seguinte linha ao arquivo <filename>/boot/loader.conf</filename>:</para>

      <programlisting>hw.ata.atapi_dma="1"</programlisting>

      <para>Um <acronym>DVD-RAM</acronym> pode ser visto como um disco rígido removível. Como qualquer outro disco rígido, o <acronym>DVD-RAM</acronym> deve ser formatado antes de poder ser usado. Neste exemplo, todo o espaço em disco será formatado com um sistema de arquivos UFS2 padrão:</para>

      <screen><prompt>#</prompt> <userinput>dd if=/dev/zero of=<replaceable>/dev/acd0</replaceable> bs=2k count=1</userinput>
<prompt>#</prompt> <userinput>bsdlabel -Bw <replaceable>acd0</replaceable></userinput>
<prompt>#</prompt> <userinput>newfs <replaceable>/dev/acd0</replaceable></userinput></screen>

      <para>O dispositivo <acronym>DVD</acronym>, <filename>acd0</filename>, deve ser alterado de acordo com a configuração.</para>

      <para>Uma vez que o <acronym>DVD-RAM</acronym> tenha sido formatado, ele pode ser montado como um disco rígido normal:</para>

      <screen><prompt>#</prompt> <userinput>mount <replaceable>/dev/acd0</replaceable> <replaceable>/mnt</replaceable></userinput></screen>

      <para>Uma vez montado, o <acronym>DVD-RAM</acronym> será legível e gravável.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="floppies">
    <title>Criando e Usando Disquetes</title>

<!--
      <authorgroup>
	<author>
	  <personname>
	    <firstname>Julio</firstname>
	    <surname>Merino</surname>
	  </personname>
	  <contrib>Original work by </contrib>
	</author>
      </authorgroup>

      <authorgroup>
	<author>
	  <personname>
	    <firstname>Martin</firstname>
	    <surname>Karlsson</surname>
	  </personname>
	  <contrib>Rewritten by </contrib>
	</author>
      </authorgroup>
      -->

    <para>Esta seção explica como formatar um disquete de 3.5 polegadas no FreeBSD.</para>

    <procedure>
      <title>Etapas para Formatar um Disquete</title>

      <para>Um disquete precisa ser formatado em baixo nível antes de poder ser usado. Isso geralmente é feito pelo fornecedor, mas a formatação é uma boa maneira de verificar a integridade da mídia. Para o formato de baixo nível do disquete no FreeBSD, use <citerefentry><refentrytitle>fdformat</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Ao usar esse utilitário, anote todas as mensagens de erro, pois elas podem ajudar a determinar se o disco está bom ou ruim.</para>

      <step>
	<para>Para formatar o disquete, insira um novo disquete de 3.5 polegadas na primeira unidade de disquete e digite:</para>

	  <screen><prompt>#</prompt> <userinput>/usr/sbin/fdformat -f 1440 /dev/fd0</userinput></screen>
      </step>

      <step>
	<para>Após a formatação de baixo nível do disco, crie um rótulo de disco conforme requerido pelo sistema para determinar o tamanho do disco e sua geometria. Os valores de geometria suportados estão listados no arquivo <filename>/etc/disktab</filename>.</para>

	<para>Para escrever o rótulo do disco, use <citerefentry><refentrytitle>bsdlabel</refentrytitle><manvolnum>8</manvolnum></citerefentry>:</para>

	<screen><prompt>#</prompt> <userinput>/sbin/bsdlabel -B -w /dev/fd0 fd1440</userinput></screen>
      </step>

      <step>
	<para>O disquete agora está pronto para ser formatado em alto nível com um sistema de arquivos. O sistema de arquivos do disquete pode ser UFS ou FAT, onde o FAT geralmente é uma opção melhor para disquetes.</para>

	<para>Para formatar o disquete com o FAT, digite:</para>

	<screen><prompt>#</prompt> <userinput>/sbin/newfs_msdos /dev/fd0</userinput></screen>
      </step>
    </procedure>

    <para>O disco está agora pronto para uso. Para usar o disquete, monte-o com <citerefentry><refentrytitle>mount_msdosfs</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Também é possível instalar e usar <package>emulators/mtools</package> da coleção de ports.</para>
  </sect1>

  <sect1 xml:id="backup-basics">
    <title>Noções Básicas de Backup</title>

<!--
    <authorgroup>
	<author>
	  <personname>
	    <firstname>Lowell</firstname>
	    <surname>Gilbert</surname>
	  </personname>
	  <contrib>Original work by </contrib>
	</author>
      </authorgroup>
      -->

    <para>A implementação de um plano de backup é essencial para que seja possível recuperar de uma falha de disco, exclusão acidental de arquivos, corrupção aleatória de arquivos ou destruição completa da máquina, incluindo a destruição de backups no local.</para>

    <para>O tipo e a programação do backup variam, dependendo da importância dos dados, da granularidade necessária para as restaurações de arquivos e da quantidade de tempo de inatividade aceitável. Algumas técnicas de backup possíveis incluem:</para>

    <itemizedlist>
      <listitem>
	<para>Arquivos de todo o sistema, protegidos por meio de backups em mídias permanentes, armazenados off-site. Isso fornece proteção contra todos os problemas listados acima, mas é lento e inconveniente para restaurar, especialmente para usuários sem privilégios.</para>
      </listitem>

      <listitem>
	<para>Snapshots do sistema de arquivos, que são úteis para restaurar arquivos excluídos ou versões anteriores de arquivos.</para>
      </listitem>

      <listitem>
	<para>Cópias de sistemas de arquivos inteiros ou discos que são sincronizados com outro sistema na rede usando um <package>net/rsync</package> agendado.</para>
      </listitem>

      <listitem>
	<para><acronym>RAID</acronym> por hardware ou software, que minimiza ou evita paralisações quando um disco falha.</para>
      </listitem>
    </itemizedlist>

    <para>Normalmente, uma mistura de técnicas de backup é usada. Por exemplo, pode-se criar um agendamento semanal para automatizar um backup completo do sistema e armazená-lo off-site e para suplementá-lo, snapshots do ZFS tirados a cada hora. Além disso, é possível fazer um backup manual de diretórios ou arquivos individuais antes de fazer edições ou exclusões de arquivos.</para>

    <para>Esta seção descreve alguns dos utilitários que podem ser usados para criar e gerenciar backups em um sistema FreeBSD.</para>

    <sect2>
      <title>Backups do Sistema de Arquivos</title>

      <indexterm><primary>backup software</primary> <secondary>dump / restore</secondary></indexterm>
      <indexterm><primary><command>dump</command></primary></indexterm>
      <indexterm><primary><command>restore</command></primary></indexterm>

      <para>Os programas tradicionais <trademark class="registered">UNIX</trademark> para fazer backup de um sistema de arquivos são <citerefentry><refentrytitle>dump</refentrytitle><manvolnum>8</manvolnum></citerefentry>, que cria o backup, e <citerefentry><refentrytitle>restore</refentrytitle><manvolnum>8</manvolnum></citerefentry>, que restaura o backup. Esses utilitários funcionam no nível do bloco do disco, abaixo das abstrações dos arquivos, links e diretórios criados pelos sistemas de arquivos. Ao contrário de outros softwares de backup, <command>dump</command> faz backup de todo um sistema de arquivos e não é capaz de fazer backup de apenas parte de um sistema de arquivos ou de uma árvore de diretórios que abrange vários sistemas de arquivos. Em vez de gravar arquivos e diretórios, <command>dump</command> grava os blocos de dados brutos que compreendem arquivos e diretórios.</para>

      <note>
	<para>Se o <command>dump</command> for usado no diretório raiz, ele não fará o backup de <filename>/home</filename>, <filename>/usr</filename> ou de muitos outros diretórios, pois eles são tipicamente pontos de montagem para outros sistemas de arquivos ou links simbólicos nesses sistemas de arquivos.</para>
      </note>

      <para>Quando usado para restaurar dados, <command>restore</command> armazena arquivos temporários em <filename>/tmp/</filename> por padrão. Ao usar um disco de recuperação com um pequeno <filename>/tmp</filename>, configure <envar>TMPDIR</envar> para um diretório com mais espaço livre para que a restauração seja bem-sucedida.</para>

      <para>Ao usar <command>dump</command>, esteja ciente de que algumas peculiaridades permanecem desde seus primeiros dias na versão 6 do AT&amp;T <trademark class="registered">UNIX</trademark>, por volta de 1975. Os parâmetros padrão assumem um backup para uma fita de 9 faixas, em vez de para outro tipo de mídia ou para as fitas de alta densidade disponíveis atualmente. Esses padrões devem ser substituídos na linha de comando.</para>

      <indexterm><primary><filename>.rhosts</filename></primary></indexterm>
      <para>É possível fazer backup de um sistema de arquivos pela rede para outro sistema ou para uma unidade de fita conectada a outro computador. Enquanto os utilitários <citerefentry><refentrytitle>rdump</refentrytitle><manvolnum>8</manvolnum></citerefentry> e <citerefentry><refentrytitle>rrestore</refentrytitle><manvolnum>8</manvolnum></citerefentry> possam ser usado para este propósito, eles não são considerados seguros.</para>

      <para>Em vez disso, pode-se usar <command>dump</command> e <command>restore</command> de uma maneira mais segura em uma conexão <acronym>SSH</acronym>. Este exemplo cria um backup completo e compactado de <filename>/usr</filename> e envia o arquivo de backup para o host especificado em uma conexão <acronym>SSH</acronym>.</para>

      <example>
	<title>Usando <command>dump</command> sobre <application>ssh</application></title>

	<screen><prompt>#</prompt> <userinput>/sbin/dump -0uan -f - /usr | gzip -2 | ssh -c blowfish \
          targetuser@targetmachine.example.com dd of=/mybigfiles/dump-usr-l0.gz</userinput></screen>
      </example>

      <para>Este exemplo configura <envar>RSH</envar> para gravar o backup em uma unidade de fita em um sistema remoto através de uma conexão <acronym>SSH</acronym>:</para>

      <example>
	<title>Usando o <command>dump</command> sobre <application>ssh</application> com o <envar>RSH</envar> configurado</title>

	<screen><prompt>#</prompt> <userinput>env RSH=/usr/bin/ssh /sbin/dump -0uan -f targetuser@targetmachine.example.com:/dev/sa0 /usr</userinput></screen>
      </example>
    </sect2>

    <sect2>
      <title>Backups de Diretório</title>

      <indexterm><primary>backup software</primary> <secondary><command>tar</command></secondary></indexterm>

      <para>Vários utilitários integrados estão disponíveis para backup e restauração de arquivos e diretórios especificados, conforme necessário.</para>

      <para>Uma boa alternativa para fazer backup de todos os arquivos em um diretório é o <citerefentry><refentrytitle>tar</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Este utilitário remonta à versão 6 do AT&amp;T <trademark class="registered">UNIX</trademark> e, por padrão, assume um backup recursivo para um dispositivo de fita local. Redirecionadores podem ser utilizados para especificar o nome de um arquivo de backup.</para>

      <indexterm><primary><command>tar</command></primary></indexterm>

      <para>Este exemplo cria um backup compactado do diretório atual e o salva no arquivo <filename>/tmp/mybackup.tgz</filename>. Ao criar um arquivo de backup, verifique se o backup não está salvo no mesmo diretório em que está sendo feito backup.</para>

      <example>
	<title>Fazendo Backup do Diretório Atual com o <command>tar</command></title>

      <screen><prompt>#</prompt> <userinput>tar czvf <replaceable>/tmp/mybackup.tgz</replaceable> . </userinput></screen>
      </example>

      <para>Para restaurar o backup inteiro, <command>cd</command> no diretório para restaurar e especificar o nome do backup. Observe que isso sobrescreverá qualquer versão mais nova de arquivos no diretório de restauração. Em caso de dúvida, restaure para um diretório temporário ou especifique o nome do arquivo dentro do backup a ser restaurado.</para>

      <example>
	<title>Restaurando o Diretório Atual com o <command>tar</command></title>

      <screen><prompt>#</prompt> <userinput>tar xzvf <replaceable>/tmp/mybackup.tgz</replaceable></userinput></screen>
      </example>

      <para>Existem dezenas de opções disponíveis, descritas em <citerefentry><refentrytitle>tar</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Esse utilitário também suporta o uso de padrões de exclusão para especificar quais arquivos não devem ser incluídos ao fazer backup do diretório especificado ou restaurar arquivos de um backup.</para>

      <indexterm><primary>backup software</primary> <secondary><command>cpio</command></secondary></indexterm>

      <para>Para criar um backup usando uma lista especificada de arquivos e diretórios, <citerefentry><refentrytitle>cpio</refentrytitle><manvolnum>1</manvolnum></citerefentry> é uma boa escolha. Ao contrário do <command>tar</command>, o <command>cpio</command> não sabe como percorrer a árvore de diretórios e deve fornecer a lista de arquivos para backup.</para>

      <para>Por exemplo, uma lista de arquivos pode ser criada usando <command>ls</command> ou <command>find</command>. Este exemplo cria uma listagem recursiva do diretório atual que é então canalizado para o <command>cpio</command> para criar um arquivo de backup de saída chamado <filename>/tmp/mybackup.cpio</filename>.</para>

      <example>
	<title>Usando <command>ls</command> e <command>cpio</command> para Criar um Backup Recursivo do Diretório Atual</title>

      <screen><prompt>#</prompt> <userinput>ls -R | cpio -ovF <replaceable>/tmp/mybackup.cpio</replaceable></userinput></screen>
      </example>

      <indexterm><primary>backup software</primary> <secondary><command>pax</command></secondary></indexterm>
      <indexterm><primary><command>pax</command></primary></indexterm>
      <indexterm><primary>POSIX</primary></indexterm>
      <indexterm><primary>IEEE</primary></indexterm>

      <para>Um utilitário de backup que tenta conectar os recursos fornecidos pelo <command>tar</command> e <command>cpio</command> é <citerefentry><refentrytitle>pax</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Ao longo dos anos, as várias versões do <command>tar</command> e do <command>cpio</command> tornaram-se ligeiramente incompatíveis. <trademark class="registered">POSIX</trademark> criou <command>pax</command> que tenta ler e escrever muitos dos vários formatos <command>cpio</command> e <command>tar</command>, além de novos formatos próprios.</para>

      <para>O <command>pax</command> equivalente aos exemplos anteriores seria:</para>

      <example>
	<title>Fazendo Backup do Diretório Atual com <command>pax</command></title>

      <screen><prompt>#</prompt> <userinput>pax -wf <replaceable>/tmp/mybackup.pax</replaceable> .</userinput></screen>
      </example>
    </sect2>

    <sect2 xml:id="backups-tapebackups">
      <title>Usando Fitas de Dados para Backups</title>

      <indexterm><primary>tape media</primary></indexterm>

      <para>Embora a tecnologia de fitas tenha continuado a evoluir, os sistemas de backup modernos tendem a combinar backups externos com mídias removíveis locais. O FreeBSD suporta qualquer unidade de fita que use <acronym>SCSI</acronym>, como <acronym>LTO</acronym> ou <acronym>DAT</acronym>. Há suporte limitado para as unidades de fita <acronym>SATA</acronym> e <acronym>USB</acronym>.</para>

      <para>Para dispositivos de fita <acronym>SCSI</acronym>, o FreeBSD usa o driver <citerefentry><refentrytitle>sa</refentrytitle><manvolnum>4</manvolnum></citerefentry> e os dispositivos <filename>/dev/sa0</filename>, <filename>/dev/nsa0</filename> e <filename>/dev/esa0</filename>. O nome do dispositivo físico é <filename>/dev/sa0</filename>. Quando <filename>/dev/nsa0</filename> é usado, o aplicativo de backup não rebobina a fita depois de gravar um arquivo, o que permite gravar mais de um arquivo em uma fita. O uso de <filename>/dev/esa0 </filename> ejeta a fita após o dispositivo ser fechado.</para>

      <para>No FreeBSD, o <command>mt</command> é usado para controlar as operações da unidade de fita, como procurar arquivos em uma fita ou gravar marcas de controle na fita. Por exemplo, os três primeiros arquivos em uma fita podem ser preservados, ignorando-os antes de gravar um novo arquivo:</para>

      <screen><prompt>#</prompt> <userinput>mt -f /dev/nsa0 fsf 3</userinput></screen>

      <para>Este utilitário suporta muitas operações. Consulte <citerefentry><refentrytitle>mt</refentrytitle><manvolnum>1</manvolnum></citerefentry> para detalhes.</para>

      <para>Para gravar um único arquivo em fita usando <command>tar</command>, especifique o nome do dispositivo de fita e o arquivo para backup:</para>

      <screen><prompt>#</prompt> <userinput>tar cvf /dev/sa0 <replaceable>file</replaceable></userinput></screen>

      <para>Para recuperar arquivos de um arquivo <command>tar</command> em fita no diretório atual:</para>

      <screen><prompt>#</prompt> <userinput>tar xvf /dev/sa0</userinput></screen>

      <para>Para fazer backup de um sistema de arquivos <acronym>UFS</acronym>, use <command>dump</command>. Este exemplo faz o backup de <filename>/usr</filename> sem rebobinar a fita quando terminar:</para>

      <screen><prompt>#</prompt> <userinput>dump -0aL -b64 -f /dev/nsa0 /usr</userinput></screen>

      <para>Para restaurar arquivos interativamente de um arquivo <command>dump</command> em fita no diretório atual:</para>

      <screen><prompt>#</prompt> <userinput>restore -i -f /dev/nsa0</userinput></screen>
    </sect2>

    <sect2 xml:id="backups-programs-amanda">
      <title>Utilitários de Backup de Terceiros</title>

      <indexterm><primary>backup software</primary></indexterm>

      <para>A Coleção de Ports do FreeBSD fornece muitos utilitários de terceiros que podem ser usados para agendar a criação de backups, simplificar o backup em fita e tornar os backups mais fáceis e convenientes. Muitos desses aplicativos são baseados em cliente/servidor e podem ser usados para automatizar os backups de um único sistema ou de todos os computadores em uma rede.</para>

      <para>Os utilitários populares incluem <application>Amanda</application>, <application>Bacula</application>, <application>rsync</application> e <application>duplicity</application>.</para>
    </sect2>

    <sect2>
      <title>Recuperação de Emergência</title>

      <para>Além dos backups regulares, é recomendável executar as etapas a seguir como parte de um plano de preparação para emergências.</para>

      <indexterm><primary><command>bsdlabel</command></primary></indexterm>

      <para>Crie uma cópia impressa da saída dos seguintes comandos:</para>

      <itemizedlist>
	<listitem>
	  <para><command>gpart show</command></para>
	</listitem>

	<listitem>
	  <para><command>more /etc/fstab</command></para>
	</listitem>

	<listitem>
	  <para><command>dmesg</command></para>
	</listitem>
      </itemizedlist>

      <indexterm><primary>livefs <acronym>CD</acronym></primary></indexterm>

      <para>Armazene esta saída e uma cópia da mídia de instalação em um local seguro. Se uma restauração de emergência for necessária, inicialize na mídia de instalação e selecione <literal>Live CD</literal> para acessar um shell de recuperação. Esse modo de recuperação pode ser usado para exibir o estado atual do sistema e, se necessário, reformatar discos e restaurar dados de backups.</para>

      <note>
	<para>A mídia de instalação do FreeBSD/i386 11.2-RELEASE não inclui um shell de recuperação. Para esta versão, baixe e grave uma imagem do Livefs <acronym>CD</acronym> de <uri xlink:href="ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/ISO-IMAGES/11.2/FreeBSD-11.2-RELEASE-i386-livefs.iso">ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/ISO-IMAGES/11.2/FreeBSD-11.2-RELEASE-i386-livefs.iso</uri>.</para>
      </note>

      <para>Em seguida, teste o shell de recuperação e os backups. Faça anotações do procedimento. Armazene estas notas com a mídia, as impressões e os backups. Estas notas podem impedir a destruição inadvertida dos backups, enquanto sob o estresse de realizar uma recuperação de emergência.</para>

      <para>Para uma medida adicional de segurança, armazene o backup mais recente em um local remoto, fisicamente separado dos computadores e das unidades de disco por uma distância significativa.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="disks-virtual">
    <info>
      <title>Discos de Memória</title>

      <authorgroup>
	<author><personname> <firstname>Marc</firstname> <surname>Fonvieille</surname> </personname> <contrib>Reorganizado e aprimorado por </contrib></author>
      </authorgroup>
    </info>

    <para>Além de discos físicos, o FreeBSD também suporta a criação e uso de discos de memória. Um uso possível para um disco de memória é acessar o conteúdo de um sistema de arquivos <acronym>ISO</acronym> sem a sobrecarga de primeiro gravá-lo em um <acronym>CD</acronym> ou <acronym>DVD</acronym> e, em seguida, montar a mídia <acronym>CD/DVD </acronym>.</para>

    <para>No FreeBSD, o driver <citerefentry><refentrytitle>md</refentrytitle><manvolnum>4</manvolnum></citerefentry> é usado para fornecer suporte para discos de memória. O kernel <filename>GENERIC</filename> inclui este driver. Ao usar um arquivo de configuração de kernel personalizado, certifique-se de incluir esta linha:</para>

    <programlisting>device md</programlisting>

    <sect2 xml:id="disks-mdconfig">
      <title>Anexando e Desanexando Imagens Existentes</title>

      <indexterm><primary>disks</primary> <secondary>memory</secondary></indexterm>

      <para>Para montar uma imagem do sistema de arquivos existente, use o <command>mdconfig</command> para especificar o nome do arquivo <acronym>ISO</acronym> e um número de unidade livre. Em seguida, consulte esse número de unidade para montá-lo em um ponto de montagem existente. Uma vez montado, os arquivos na imagem <acronym>ISO</acronym> aparecerão no ponto de montagem. Este exemplo anexa o arquivo <replaceable>diskimage.iso</replaceable> ao dispositivo de memória <filename>/dev/md0</filename> e monta o dispositivo de memória em <filename>/mnt</filename>:</para>

      <screen><prompt>#</prompt> <userinput>mdconfig -f <replaceable>diskimage.iso</replaceable> -u <replaceable>0</replaceable></userinput>
<prompt>#</prompt> <userinput>mount -t cd9660 /dev/md<replaceable>0</replaceable> <replaceable>/mnt</replaceable></userinput></screen>

      <para>Note que <option>-t cd9660</option> foi usado para montar uma imagem ISO. Se um número de unidade não for especificado com <option>-u</option>, o <command>mdconfig</command> alocará automaticamente um dispositivo de memória não utilizado e exibirá o nome da unidade alocada, como <filename>md4</filename>. Consulte <citerefentry><refentrytitle>mdconfig</refentrytitle><manvolnum>8</manvolnum></citerefentry> para mais detalhes sobre este comando e suas opções.</para>

      <indexterm><primary>disks</primary> <secondary>detaching a memory disk</secondary></indexterm>

      <para>Quando um disco de memória não está mais em uso, seus recursos devem ser liberados de volta ao sistema. Primeiro, desmonte o sistema de arquivos e use o <command>mdconfig</command> para desanexar o disco do sistema e liberar seus recursos. Para continuar este exemplo:</para>

      <screen><prompt>#</prompt> <userinput>umount /mnt</userinput>
<prompt>#</prompt> <userinput>mdconfig -d -u <replaceable>0</replaceable></userinput></screen>

      <para>Para determinar se algum disco de memória ainda está conectado ao sistema, digite <command>mdconfig -l</command>.</para>
    </sect2>

    <sect2 xml:id="disks-md-freebsd5">
      <title>Criando um Disco Virtual Baseado em Arquivo ou Memória</title>

      <indexterm><primary>disks</primary> <secondary>memory file system</secondary></indexterm>
      <para>O FreeBSD também suporta discos virtuais onde o armazenamento a ser utilizado é alocado a partir de um disco rígido ou de uma área de memória. O primeiro método é comumente referido como um disco virtual baseado em arquivo e o segundo como um disco virtual baseado em memória. Ambos os tipos podem ser criados usando o <command>mdconfig</command>.</para>

      <para>Para criar um novo disco virtual baseado em memória, especifique um tipo de <literal>swap</literal> e o tamanho do disco de memória a ser criado. Em seguida, formate o disco de memória com um sistema de arquivos e monte como de costume. Este exemplo cria um disco de memória de 5M na unidade <literal>1</literal>. Esse disco de memória é formatado com o sistema de arquivos <acronym>UFS</acronym> antes de ser montado:</para>

      <screen><prompt>#</prompt> <userinput>mdconfig -a -t swap -s <replaceable>5</replaceable>m -u <replaceable>1</replaceable></userinput>
<prompt>#</prompt> <userinput>newfs -U md<replaceable>1</replaceable></userinput>
/dev/md1: 5.0MB (10240 sectors) block size 16384, fragment size 2048
        using 4 cylinder groups of 1.27MB, 81 blks, 192 inodes.
        with soft updates
super-block backups (for fsck -b #) at:
 160, 2752, 5344, 7936
<prompt>#</prompt> <userinput>mount /dev/md<replaceable>1</replaceable> <replaceable>/mnt</replaceable></userinput>
<prompt>#</prompt> <userinput>df <replaceable>/mnt</replaceable></userinput>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md1        4718    4  4338     0%    /mnt</screen>

      <para>Para criar um novo disco virtual baseado em arquivo, primeiro aloque a área que será usada para o disco. Esse exemplo cria um arquivo vázio de 5MB chamado <filename>newimage</filename>:</para>

      <screen><prompt>#</prompt> <userinput>dd if=/dev/zero of=<replaceable>newimage</replaceable> bs=1k count=<replaceable>5</replaceable>k</userinput>
5120+0 records in
5120+0 records out</screen>

      <para>Em seguida, anexe esse arquivo a um disco de memória, rotule o disco de memória e formate-o com o sistema de arquivos <acronym>UFS</acronym>, monte o disco de memória e verifique o tamanho do disco com backup de arquivo:</para>

      <screen><prompt>#</prompt> <userinput>mdconfig -f <replaceable>newimage</replaceable> -u <replaceable>0</replaceable></userinput>
<prompt>#</prompt> <userinput>bsdlabel -w md<replaceable>0</replaceable> auto</userinput>
<prompt>#</prompt> <userinput>newfs -U md<replaceable>0</replaceable>a</userinput>
/dev/md0a: 5.0MB (10224 sectors) block size 16384, fragment size 2048
        using 4 cylinder groups of 1.25MB, 80 blks, 192 inodes.
super-block backups (for fsck -b #) at:
 160, 2720, 5280, 7840
<prompt>#</prompt> <userinput>mount /dev/md<replaceable>0</replaceable>a <replaceable>/mnt</replaceable></userinput>
<prompt>#</prompt> <userinput>df <replaceable>/mnt</replaceable></userinput>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md0a       4710    4  4330     0%    /mnt</screen>

      <para>São necessários vários comandos para criar um disco virtual baseado em arquivo ou memória usando <command>mdconfig</command>. O FreeBSD também vem com o <command>mdmfs</command> que configura automaticamente um disco de memória, formata-o com o sistema de arquivos <acronym>UFS</acronym> e o monta. Por exemplo, depois de criar <replaceable>newimage</replaceable> com <command>dd</command>, esse comando é equivalente a executar os comandos <command>bsdlabel</command>, <command>newfs</command> e <command>mount</command> mostrados acima:</para>

      <screen><prompt>#</prompt> <userinput>mdmfs -F <replaceable>newimage</replaceable> -s <replaceable>5</replaceable>m md<replaceable>0</replaceable> <replaceable>/mnt</replaceable></userinput></screen>

      <para>Para criar um novo disco virtual baseado em memória com o <command>mdmfs</command>, use este comando:</para>

      <screen><prompt>#</prompt> <userinput>mdmfs -s <replaceable>5</replaceable>m md<replaceable>1</replaceable> <replaceable>/mnt</replaceable></userinput></screen>

      <para>Se o número da unidade não for especificado, o <command>mdmfs</command> selecionará automaticamente um dispositivo de memória não utilizado. Para mais detalhes sobre <command>mdmfs</command>, consulte <citerefentry><refentrytitle>mdmfs</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="snapshots">
    <info>
      <title>Snapshots de Sistemas de Arquivos</title>

      <authorgroup>
	<author><personname> <firstname>Tom</firstname> <surname>Rhodes</surname> </personname> <contrib>Contribuído por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>file systems</primary> <secondary>snapshots</secondary></indexterm>

    <para>O FreeBSD oferece um recurso em conjunto com <link linkend="soft-updates">Atualizações Soft</link>: snapshots do sistema de arquivos.</para>

    <para>Os Snapshots de UFS permitem que um usuário crie imagens de sistemas de arquivos especificados e as trate como um arquivo. Os arquivos de snapshot devem ser criados no sistema de arquivos no qual a ação é executada e um usuário pode criar no máximo 20 snapshots por sistema de arquivos. Os snapshots ativos são registradas no superbloco, de modo que são persistentes nas operações de desmontagem e remontagem, juntamente com reinicializações do sistema. Quando um snapshot não é mais necessário, ele pode ser removido usando <citerefentry><refentrytitle>rm</refentrytitle><manvolnum> 1</manvolnum></citerefentry>. Embora os snapshots possam ser removidos em qualquer ordem, todo o espaço usado pode não ser adquirido porque outro snapshot possivelmente reivindicará alguns dos blocos liberados.</para>

    <para>A flag de arquivo <option>snapshot</option> não alterável é definida por <citerefentry> <refentrytitle>mksnap_ffs</refentrytitle><manvolnum>8</manvolnum></citerefentry> após a criação inicial de um arquivo de snapshot. O <citerefentry> <refentrytitle>unlink</refentrytitle><manvolnum>1</manvolnum></citerefentry> cria uma exceção para arquivos de snapshots, pois permite que sejam removidos.</para>

    <para>Os snapshots são criados usando <citerefentry><refentrytitle>mount</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Para colocar um snapshot de <filename>/var</filename> no arquivo <filename>/var/snapshot/snap</filename>, use o seguinte comando:</para>

    <screen><prompt>#</prompt> <userinput>mount -u -o snapshot /var/snapshot/snap /var</userinput></screen>

    <para>Como alternativa, use <citerefentry><refentrytitle>mksnap_ffs</refentrytitle><manvolnum>8</manvolnum></citerefentry> para criar o snapshot:</para>

    <screen><prompt>#</prompt> <userinput>mksnap_ffs /var /var/snapshot/snap</userinput></screen>

    <para>É possível encontrar arquivos de snapshots em um sistema de arquivos, como <filename>/var</filename>, usando <citerefentry><refentrytitle>find</refentrytitle><manvolnum>1</manvolnum></citerefentry>:</para>

    <screen><prompt>#</prompt> <userinput>find /var -flags snapshot</userinput></screen>

    <para>Depois que um snapshot foi criado, ele tem vários usos:</para>

    <itemizedlist>
      <listitem>
	<para>Alguns administradores usarão um arquivo de snapshot para fins de backup, porque o snapshot pode ser transferido para um <acronym>CD</acronym>s ou fita.</para>
      </listitem>

      <listitem>
	<para>O verificador de integridade do sistema de arquivos, <citerefentry><refentrytitle>fsck</refentrytitle><manvolnum>8</manvolnum></citerefentry>, pode ser executado em um snapshot. Supondo que o sistema de arquivos estava limpo quando foi montado, isso deve sempre fornecer um resultado limpo e imutável.</para>
      </listitem>

      <listitem>
	<para>Executando <citerefentry><refentrytitle>dump</refentrytitle><manvolnum>8</manvolnum> </citerefentry> em um snapshot produzirá um arquivo de dump que seja consistente com o sistema de arquivos e o registro de data e hora do snapshot. <citerefentry><refentrytitle>dump</refentrytitle><manvolnum>8</manvolnum></citerefentry> também pode criar um snapshot, criar uma imagem de dump e remover o snapshot em um comando usando <option>-L</option>.</para>
      </listitem>

      <listitem>
	<para>O snapshot pode ser montado como uma imagem congelada do sistema de arquivos. Para montar o snapshot use <citerefentry><refentrytitle>mount</refentrytitle><manvolnum>8</manvolnum></citerefentry> passando o nome do snapshot <filename>/var/snapshot/snap</filename>:</para>

	<screen><prompt>#</prompt> <userinput>mdconfig -a -t vnode -o readonly -f /var/snapshot/snap -u 4</userinput>
<prompt>#</prompt> <userinput>mount -r /dev/md4 /mnt</userinput></screen>
      </listitem>
    </itemizedlist>

    <para>O <filename>/var</filename> congelado agora está disponível através de <filename>/mnt</filename>. Tudo estará inicialmente no mesmo estado que estava quando o snapshot foi criado. A única exceção é que os snapshots anteriores aparecerão como arquivos com comprimento zero. Para desmontar o snapshot, use:</para>

    <screen><prompt>#</prompt> <userinput>umount /mnt</userinput>
<prompt>#</prompt> <userinput>mdconfig -d -u 4</userinput></screen>

    <para>Para obter mais informações sobre <option>softupdates</option> e snapshots do sistema de arquivos, incluindo documentos técnicos, visite o site do Marshall Kirk McKusick em <uri xlink:href="http://www.mckusick.com/">http://www.mckusick.com/</uri>.</para>
  </sect1>

  <sect1 xml:id="quotas">
    <title>Cotas de Disco</title>

    <indexterm><primary>accounting</primary> <secondary>disk space</secondary></indexterm>
    <indexterm><primary>disk quotas</primary></indexterm>

    <para>As cotas de disco podem ser usadas para limitar a quantidade de espaço em disco ou o número de arquivos que um usuário ou membros de um grupo podem alocar em uma base por sistema de arquivos. Isso impede que um usuário ou grupo de usuários consuma todo o espaço em disco disponível.</para>

    <para>Esta seção descreve como configurar cotas de disco para o sistema de arquivos <acronym>UFS</acronym>. Para configurar cotas no sistema de arquivos <acronym>ZFS</acronym>, consulte <xref linkend="zfs-zfs-quota"/></para>

    <sect2>
      <title>Habilitando Cotas de Disco</title>

      <para>Para determinar se o kernel do FreeBSD fornece suporte para cotas de disco:</para>

      <screen><prompt>%</prompt> <userinput>sysctl kern.features.ufs_quota</userinput>
kern.features.ufs_quota: 1</screen>

      <para>Neste exemplo, o <literal>1</literal> indica suporte à cota. Se o valor for <literal>0</literal>, adicione a seguinte linha a um arquivo de configuração de kernel personalizado e reconstrua o kernel usando as instruções em <xref linkend="kernelconfig"/>:</para>

      <programlisting>options QUOTA</programlisting>

      <para>Em seguida, habilite as cotas de disco no arquivo <filename>/etc/rc.conf</filename>:</para>

      <programlisting>quota_enable="YES"</programlisting>

      <indexterm><primary>disk quotas</primary> <secondary>checking</secondary></indexterm>
      <para>Normalmente, na inicialização, a integridade da cota de cada sistema de arquivos é verificada por <citerefentry><refentrytitle>quotacheck</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Esse programa garante que os dados no banco de dados de cotas reflitam adequadamente os dados no sistema de arquivos. Este é um processo demorado que afetará significativamente o tempo que o sistema leva para inicializar. Para pular este passo, adicione esta variável ao arquivo <filename>/etc/rc.conf</filename>:</para>

      <programlisting>check_quotas="NO"</programlisting>

      <para>Por fim, edite o arquivo <filename>/etc/fstab</filename> para habilitar as cotas de disco por sistema de arquivos. Para habilitar cotas por usuário em um sistema de arquivos, adicione <option>userquota</option> ao campo de opções na entrada <filename>/etc/fstab</filename> para o sistema de arquivos ativar as cotas. Por exemplo:</para>

      <programlisting>/dev/da1s2g   /home    ufs rw,userquota 1 2</programlisting>

      <para>Para ativar cotas de grupo, use <option>groupquota</option>. Para ativar cotas de usuários e grupos, separe as opções com uma vírgula:</para>

      <programlisting>/dev/da1s2g    /home    ufs rw,userquota,groupquota 1 2</programlisting>

      <para>Por padrão, os arquivos de cota são armazenados no diretório raiz do sistema de arquivos como <filename>quota.user</filename> e <filename>quota.group</filename>. Consulte <citerefentry><refentrytitle>fstab</refentrytitle><manvolnum>5</manvolnum></citerefentry> para obter mais informações. Especificar um local alternativo para os arquivos de cotas não é recomendado.</para>

      <para>Quando a configuração estiver concluída, reinicialize o sistema e o <filename>/etc/rc</filename> executará automaticamente os comandos apropriados para criar os arquivos de cotas iniciais para todas as cotas ativadas em <filename>/etc/fstab</filename>.</para>

      <para>No curso normal das operações, não deve haver necessidade de executar manualmente o <citerefentry><refentrytitle>quotacheck</refentrytitle><manvolnum>8</manvolnum></citerefentry>, <citerefentry><refentrytitle>quotaon</refentrytitle><manvolnum>8</manvolnum></citerefentry>, ou <citerefentry> <refentrytitle>quotaoff</refentrytitle><manvolnum>8</manvolnum></citerefentry>. No entanto, deve-se ler estas páginas de manual para se familiarizar com sua operação.</para>
    </sect2>

    <sect2>
      <title>Definindo Limites de Cota</title>

      <indexterm><primary>disk quotas</primary> <secondary>limits</secondary></indexterm>

      <para>Para verificar se as cotas estão ativadas, execute:</para>

      <screen><prompt>#</prompt> <userinput>quota -v</userinput></screen>

      <para>Deve haver um resumo de uma linha sobre o uso de disco e limites de cota atuais para cada sistema de arquivos em que as cotas estão ativadas.</para>

      <para>O sistema agora está pronto para receber limites de cota com <command>edquota</command>.</para>

      <para>Várias opções estão disponíveis para impor limites à quantidade de espaço em disco que um usuário ou grupo pode alocar e quantos arquivos eles podem criar. As alocações podem ser limitadas com base no espaço em disco (cotas de bloco), no número de arquivos (cotas de inode) ou em uma combinação de ambos. Cada limite é subdividido em duas categorias: limites rígidos e flexíveis.</para>

      <indexterm><primary>hard limit</primary></indexterm>
      <para>Um limite rígido não pode ser excedido. Quando um usuário atinge um limite rígido, nenhuma outra alocação pode ser feita nesse sistema de arquivos por esse usuário. Por exemplo, se o usuário tiver um limite rígido de 500 kbytes em um sistema de arquivos e estiver usando atualmente 490 kbytes, o usuário poderá alocar apenas 10 kbytes adicionais. A tentativa de alocar 11 kbytes adicionais falhará.</para>

      <indexterm><primary>soft limit</primary></indexterm>
      <para>Os limites flexíveis podem ser excedidos por um período de tempo limitado, conhecido como período de tolerância, que é uma semana por padrão. Se um usuário permanecer acima do limite por mais tempo do que o período de carência, o limite flexível se tornará um limite rígido e nenhuma outra alocação será permitida. Quando o usuário cai abaixo do limite flexível, o período de carência é zerado.</para>

      <para>No exemplo a seguir, a cota da conta <systemitem class="username">test</systemitem> está sendo editada. Quando <command>edquota</command> é invocado, o editor especificado por <envar>EDITOR</envar> é aberto para editar os limites de cota. O editor padrão é configurado para <application>vi</application>.</para>

      <screen><prompt>#</prompt> <userinput>edquota -u test</userinput>
Quotas for user test:
/usr: kbytes in use: 65, limits (soft = 50, hard = 75)
        inodes in use: 7, limits (soft = 50, hard = 60)
/usr/var: kbytes in use: 0, limits (soft = 50, hard = 75)
        inodes in use: 0, limits (soft = 50, hard = 60)</screen>

      <para>Normalmente, há duas linhas para cada sistema de arquivos com cotas ativadas. Uma linha representa os limites do bloco e a outra representa os limites do inode. Altere o valor para modificar o limite de cota. Por exemplo, para aumentar o limite de blocos em <filename>/usr</filename> para um limite flexível de <literal>500</literal> e um limite rígido de <literal>600</literal>, altere os valores nesse campo. linha da seguinte forma:</para>

      <programlisting>/usr: kbytes in use: 65, limits (soft = 500, hard = 600)</programlisting>

      <para>Os novos limites de cotas entram em vigor ao sair do editor.</para>

      <para>Às vezes, é desejável definir limites de cota em vários usuários. Isso pode ser feito primeiro atribuindo o limite de cota desejado a um usuário. Em seguida, use <option>-p</option> para duplicar essa cota para um intervalo especificado de IDs de usuário (<acronym>UID</acronym>s). O comando a seguir duplicará esses limites de cota para <acronym>UID</acronym>s de <literal>10.000</literal> até <literal>19.999</literal>:</para>

      <screen><prompt>#</prompt> <userinput>edquota -p test 10000-19999</userinput></screen>

      <para>Para mais informações, consulte <citerefentry><refentrytitle>edquota</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
    </sect2>

    <sect2>
      <title>Verificando Limites de Cota e Uso de Disco</title>

      <indexterm><primary>disk quotas</primary> <secondary>checking</secondary></indexterm>

      <para>Para verificar cotas individuais de usuários ou de grupos e uso de disco, use <citerefentry><refentrytitle>quota</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Um usuário só pode examinar sua própria cota e a cota de um grupo do qual é membro. Somente o superusuário pode visualizar todas as cotas de usuários e grupos. Para obter um resumo de todas as cotas e uso de disco para sistemas de arquivos com cotas ativadas, use <citerefentry><refentrytitle>repquota</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>

      <para>Normalmente, os sistemas de arquivos nos quais o usuário não está usando nenhum espaço em disco não serão exibidos na saída de <command>quota</command>, mesmo que o usuário tenha um limite de cota atribuído a esse sistema de arquivos. Use <option>-v</option> para exibir esses sistemas de arquivos. A seguir está a saída de amostra de <command>quota -v</command> para um usuário que possui limites de cota em dois sistemas de arquivos.</para>

      <programlisting>Disk quotas for user test (uid 1002):
     Filesystem  usage    quota   limit   grace   files   quota   limit   grace
           /usr      65*     50      75   5days       7      50      60
       /usr/var       0      50      75               0      50      60</programlisting>

      <indexterm><primary>grace period</primary></indexterm>

      <para>Neste exemplo, o usuário está atualmente 15 kbytes sobre o limite flexível de 50 kbytes em <filename>/usr</filename> e tem 5 dias de período de carência restante. O asterisco <literal>*</literal> indica que o usuário está atualmente acima do limite de cota.</para>
    </sect2>

    <sect2>
      <title>Quotas sobre o NFS</title>

      <indexterm><primary>NFS</primary></indexterm>

      <para>As cotas são impostas pelo subsistema de cotas no servidor <acronym>NFS</acronym>. O daemon <citerefentry><refentrytitle>rpc.rquotad</refentrytitle><manvolnum>8</manvolnum></citerefentry> disponibiliza informações de quota para <command>quota</command> em clientes <acronym>NFS</acronym>, permitindo que os usuários nessas máquinas visualizem suas estatísticas de cota.</para>

      <para>No servidor <acronym>NFS</acronym>, ative o <command>rpc.rquotad</command> removendo o <literal>#</literal> desta linha em <filename>/etc/inetd.conf</filename>:</para>

      <programlisting>rquotad/1      dgram rpc/udp wait root /usr/libexec/rpc.rquotad rpc.rquotad</programlisting>

      <para>Em seguida, reinicie o <command>inetd</command>:</para>

      <screen><prompt>#</prompt> <userinput>service inetd restart</userinput></screen>
    </sect2>
  </sect1>

  <sect1 xml:id="disks-encrypting">
    <info>
      <title>Criptografando Partições de Disco</title>

      <authorgroup>
	<author><personname> <firstname>Lucky</firstname> <surname>Green</surname> </personname> <contrib>Contribuido por </contrib> <affiliation> <address>
	      <email>shamrock@cypherpunks.to</email>
	    </address> </affiliation></author>
      </authorgroup>
    </info>

    <indexterm><primary>disks</primary> <secondary>encrypting</secondary></indexterm>

    <para>O FreeBSD oferece excelentes proteções on-line contra acesso não autorizado a dados. As permissões de arquivo e o <link linkend="mac">Mandatory Access Control</link> (MAC)  ajudam a impedir que usuários não autorizados acessem dados enquanto o sistema operacional está ativo e o computador está ligado. No entanto, as permissões impostas pelo sistema operacional são irrelevantes se um invasor tiver acesso físico a um computador e puder mover o disco rígido do computador para outro sistema para copiar e analisar os dados.</para>

    <para>Independentemente de como um invasor pode ter acesso a um disco rígido ou um computador desligado, os subsistemas criptográficos baseados em <acronym>GEOM</acronym> incorporados ao FreeBSD são capazes de proteger os dados nos sistemas de arquivos do computador contra atacantes super motivados com recursos significativos. Ao contrário dos métodos de criptografia que criptografam arquivos individuais, os utilitários incorporados <command>gbde</command> e <command>geli</command> podem ser usados para criptografar de forma transparente sistemas de arquivos inteiros. Nenhum dado aberto sequer toca na bandeja do disco rígido.</para>

    <para>Este capítulo demonstra como criar um sistema de arquivos criptografado no FreeBSD. Primeiro ele demonstra o processo usando o <command>gbde</command> e depois demonstra o mesmo exemplo usando <command>geli</command>.</para>

    <sect2>
      <title>Criptografia de Disco com <application>gbde</application></title>

      <para>O objetivo do utilitário <citerefentry><refentrytitle>gbde</refentrytitle><manvolnum>4</manvolnum></citerefentry> é fornecer um desafio formidável para que um invasor que tenha acesso ao conteúdo de um dispositivo de armazenamento <emphasis>frio</emphasis>. No entanto, se o computador for comprometido enquanto estiver em funcionamento e o dispositivo de armazenamento estiver ativamente conectado, ou se o invasor tiver acesso a uma frase secreta válida, ele não oferecerá proteção ao conteúdo do dispositivo de armazenamento. Portanto, é importante fornecer segurança física enquanto o sistema está em execução e proteger a frase secreta usada pelo mecanismo de criptografia.</para>

      <para>Este recurso oferece várias barreiras para proteger os dados armazenados em cada setor de disco. Ele criptografa o conteúdo de um setor de disco usando o <acronym>AES</acronym> de 128 bits no modo <acronym>CBC</acronym>. Cada setor no disco é criptografado com uma chave <acronym>AES</acronym> diferente. Para obter mais informações sobre o design criptográfico, incluindo como as chaves do setor são derivadas da frase secreta fornecida pelo usuário, consulte <citerefentry><refentrytitle>gbde</refentrytitle><manvolnum>4</manvolnum></citerefentry>.</para>

      <para>O FreeBSD fornece um módulo do kernel para <application>gbde</application>, que pode ser carregado com este comando:</para>

      <screen><prompt>#</prompt> <userinput>kldload geom_bde</userinput></screen>

      <para>Se estiver usando um arquivo de configuração de kernel personalizado, certifique-se de que ele contenha esta linha:</para>

      <para><literal>options GEOM_BDE</literal></para>

      <para>O exemplo a seguir demonstra a adição de um novo disco rígido a um sistema que conterá uma única partição criptografada que será montada como <filename>/private</filename>.</para>

      <procedure>
	<title>Criptografando uma Partição com <application>gbde</application></title>

	<step>
	  <title>Adicione o Novo Disco Rígido</title>

	  <para>Instale a nova unidade no sistema, conforme explicado em <xref linkend="disks-adding"/>. Para propósitos deste exemplo, uma nova partição de disco rígido foi adicionada como <filename>/dev/ad4s1c</filename> e <filename>/dev/ad0s1<replaceable>*</replaceable></filename> representa o existente partições padrão do FreeBSD.</para>

	  <screen><prompt>#</prompt> <userinput>ls /dev/ad*</userinput>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4</screen>
	</step>

	<step>
	  <title>Criar um diretório para conter os arquivos de lock do <command>gbde</command></title>

	  <screen><prompt>#</prompt> <userinput>mkdir /etc/gbde</userinput></screen>

	  <para>O arquivo de lock <application>gbde</application> contém informações que o <application>gbde</application> requer para acessar partições criptografadas. Sem acesso ao arquivo de lock, o <application>gbde</application> não poderá descriptografar os dados contidos na partição criptografada sem intervenção manual significativa que não seja suportada pelo software. Cada partição criptografada usa um arquivo de lock separado.</para>
	</step>

	<step>
	  <title>Inicialize a Partição <command>gbde</command></title>

	  <para>Uma partição <application>gbde</application> deve ser inicializada antes de poder ser usada. Essa inicialização precisa ser executada apenas uma vez. Esse comando abrirá o editor padrão, para definir várias opções de configuração em um modelo. Para uso com o sistema de arquivos <acronym>UFS</acronym>, defina o sector_size como 2048:</para>

	  <screen><prompt>#</prompt> <userinput>gbde init /dev/ad4s1c -i -L /etc/gbde/ad4s1c.lock</userinput>
# <phrase its:translate="no">$FreeBSD: src/sbin/gbde/template.txt,v 1.1.36.1 2009/08/03 08:13:06 kensmith Exp $</phrase>
#
# Sector size is the smallest unit of data which can be read or written.
# Making it too small decreases performance and decreases available space.
# Making it too large may prevent filesystems from working.  512 is the
# minimum and always safe.  For UFS, use the fragment size
#
sector_size	=	2048
[...]</screen>

	  <para>Depois que a edição for salva, o usuário será solicitado a digitar duas vezes a frase secreta usada para proteger os dados. A frase secreta deve ser a mesma em ambas as vezes. A capacidade de <application>gbde</application> de proteger os dados depende inteiramente da qualidade da frase secreta. Para obter dicas sobre como selecionar uma frase secreta que seja fácil de lembrar, consulte <link xlink:href="http://world.std.com/~reinhold/diceware.html">http://world.std.com/~reinhold/diceware.htm</link>.</para>

	  <para>Essa inicialização cria um arquivo de lock para a partição do <application>gbde</application>. Neste exemplo, ele é armazenado como <filename>/etc/gbde/ad4s1c.lock</filename>. Os arquivos de lock devem terminar em <quote>.lock</quote> para serem corretamente detectados pelo script de inicialização do <filename>/etc/rc.d/gbde</filename>.</para>

	  <caution>
	    <para>Arquivos de lock <emphasis>devem</emphasis> ter backups junto com o conteúdo de qualquer partição criptografada. Sem o arquivo de lock, o proprietário legítimo não poderá acessar os dados na partição criptografada.</para>
	  </caution>
	</step>

	<step>
	  <title>Anexando a Partição Criptografada ao Kernel</title>

	  <screen><prompt>#</prompt> <userinput>gbde attach /dev/ad4s1c -l /etc/gbde/ad4s1c.lock</userinput></screen>

	  <para>Este comando solicitará a entrada da senha que foi selecionada durante a inicialização da partição criptografada. O novo dispositivo criptografado aparecerá em <filename>/dev</filename> como <filename>/dev/device_name.bde</filename>:</para>

	  <screen><prompt>#</prompt> <userinput>ls /dev/ad*</userinput>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4        /dev/ad4s1c.bde</screen>
	</step>

	<step>
	  <title>Criando um Sistema de Arquivos no Dispositivo Criptografado</title>

	  <para>Uma vez que o dispositivo criptografado tenha sido anexado ao kernel, um sistema de arquivos pode ser criado no dispositivo. Este exemplo cria um sistema de arquivos <acronym>UFS</acronym> com atualizações soft ativadas. Certifique-se de especificar a partição que possui uma extensão <filename><replaceable>*</replaceable>.bde</filename>:</para>

	  <screen><prompt>#</prompt> <userinput>newfs -U /dev/ad4s1c.bde</userinput></screen>
	</step>

	<step>
	  <title>Montando a Partição Criptografada</title>

	  <para>Crie um ponto de montagem e monte o sistema de arquivos criptografados:</para>

	  <screen><prompt>#</prompt> <userinput>mkdir /private</userinput>
<prompt>#</prompt> <userinput>mount /dev/ad4s1c.bde /private</userinput></screen>
	</step>

	<step>
	  <title>Verificar se o sistema de arquivos criptografados está disponível</title>

	  <para>O sistema de arquivos criptografados agora deve estar visível e disponível para uso:</para>

	  <screen><prompt>%</prompt> <userinput>df -H</userinput>
Filesystem        Size   Used  Avail Capacity  Mounted on
/dev/ad0s1a      1037M    72M   883M     8%    /
/devfs            1.0K   1.0K     0B   100%    /dev
/dev/ad0s1f       8.1G    55K   7.5G     0%    /home
/dev/ad0s1e      1037M   1.1M   953M     0%    /tmp
/dev/ad0s1d       6.1G   1.9G   3.7G    35%    /usr
/dev/ad4s1c.bde   150G   4.1K   138G     0%    /private</screen>
	</step>
      </procedure>

      <para>Após cada inicialização, todos os sistemas de arquivos criptografados devem ser reconectados manualmente ao kernel, verificados quanto a erros e montados antes que os sistemas de arquivos possam ser usados. Para configurar estas etapas, adicione as seguintes linhas ao arquivo <filename>/etc/rc.conf</filename>:</para>

      <programlisting>gbde_autoattach_all="YES"
gbde_devices="<replaceable>ad4s1c</replaceable>"
gbde_lockdir="/etc/gbde"</programlisting>

      <para>Isso requer que a frase secreta seja inserida no console no momento da inicialização. Depois de digitar a senha correta, a partição criptografada será montada automaticamente. Opções adicionais de inicialização do <application>gbde</application> estão disponíveis e listadas em <citerefentry><refentrytitle>rc.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>

<!--
What about bsdinstall?
-->
      <note>
	<para>O <application>sysinstall</application> é incompatível com os dispositivos criptografados com <application>gbde</application>. Todos os dispositivos <filename>*.bde</filename> devem ser desanexado do kernel antes de iniciar o <application>sysinstall</application> ou ele irá travar durante a análise inicial dos dispositivos. Para desanexar o dispositivo criptografado usado no exemplo, use o seguinte comando:</para>

	<screen><prompt>#</prompt> <userinput>gbde detach /dev/<replaceable>ad4s1c</replaceable></userinput></screen>
      </note>
    </sect2>

    <sect2 xml:id="disks-encrypting-geli">
      <info>
	<title>Criptografia de Disco com <command>geli</command></title>

	<authorgroup>
	  <author><personname> <firstname>Daniel</firstname> <surname>Gerzo</surname> </personname> <contrib>Contribuido por </contrib></author>
	</authorgroup>
      </info>

      <para>Uma classe criptográfica alternativa <acronym>GEOM</acronym> está disponível usando <command>geli</command>. Este utilitário de controle adiciona alguns recursos e usa um esquema diferente para fazer trabalho criptográfico. Ele fornece os seguintes recursos:</para>

      <itemizedlist>
	<listitem>
	  <para>Utiliza o framework <citerefentry><refentrytitle>crypto</refentrytitle><manvolnum>9</manvolnum></citerefentry> e usa automaticamente o hardware criptográfico quando ele está disponível.</para>
	</listitem>

	<listitem>
	  <para>Suporta vários algoritmos criptográficos, como <acronym>AES</acronym>, Blowfish e <acronym>3DES</acronym>.</para>
	</listitem>

	<listitem>
	  <para>Permite que a partição raiz seja criptografada. A frase secreta usada para acessar a partição root criptografada será solicitada durante a inicialização do sistema.</para>
	</listitem>

	<listitem>
	  <para>Permite o uso de duas chaves independentes.</para>
	</listitem>

	<listitem>
	  <para>É rápido, pois executa criptografia simples de setor a setor.</para>
	</listitem>

	<listitem>
	  <para>Permite backup e restauração de chaves mestras. Se um usuário destruir suas chaves, ainda é possível obter acesso aos dados restaurando as chaves do backup.</para>
	</listitem>

	<listitem>
	  <para>Permite que um disco seja anexado com uma chave única aleatória que é útil para partições swap e sistemas de arquivos temporários.</para>
	</listitem>
      </itemizedlist>

      <para>Mais recursos e exemplos de uso podem ser encontrados em <citerefentry> <refentrytitle>geli</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>

      <para>O exemplo a seguir descreve como gerar um arquivo de chave que será usado como parte da chave mestra para o provedor criptografado montado em <filename>/private</filename>. O arquivo chave fornecerá alguns dados aleatórios usados para criptografar a chave mestra. A chave mestra também será protegida por uma frase secreta. O tamanho do setor do provedor será de 4kB. O exemplo descreve como se conectar ao provedor <command>geli</command>, criar um sistema de arquivos, montá-lo, trabalhar com ele e, finalmente, como desanexá-lo.</para>

      <procedure>
	<title>Criptografando uma Partição com <command>geli</command></title>

	<step>
	  <title>Carregando o suporte ao <command>geli</command></title>

	  <para>O suporte para <command>geli</command> está disponível como um módulo de kernel carregável. Para configurar o sistema para carregar automaticamente o módulo no momento da inicialização, adicione a seguinte linha ao arquivo <filename>/boot/loader.conf</filename>:</para>

	  <programlisting>geom_eli_load="YES"</programlisting>

	  <para>Para carregar o módulo do kernel agora:</para>

	  <screen><prompt>#</prompt> <userinput>kldload geom_eli</userinput></screen>

	  <para>Para um kernel customizado, assegure-se de que o arquivo de configuração do kernel contenha estas linhas:</para>

	  <programlisting>options GEOM_ELI
device crypto</programlisting>
	</step>

	<step>
	  <title>Gerando a Chave Mestra</title>

	  <para>Os comandos a seguir geram uma chave mestra com a qual todos os dados serão criptografados. Esta chave nunca pode ser alterada. Em vez de usá-lo diretamente, ele é criptografado com uma ou mais chaves de usuário. As chaves do usuário são compostas por uma combinação opcional de bytes aleatórios de um arquivo, <filename>/root/da2.key</filename> e/ou uma senha. Neste caso, a fonte de dados do arquivo de chave é <filename>/dev/random</filename>. Este comando também configura o tamanho do setor do provedor (<filename>/dev/da2.eli</filename>) como 4kB, para melhor desempenho:</para>

	  <screen><prompt>#</prompt> <userinput>dd if=/dev/random of=/root/da2.key bs=64 count=1</userinput>
<prompt>#</prompt> <userinput>geli init -K /root/da2.key -s 4096 /dev/da2</userinput>
Enter new passphrase:
Reenter new passphrase:</screen>

	  <para>Não é obrigatório o uso de uma frase secreta e de um arquivo de chave, pois cada método de proteger a chave mestra pode ser usado isoladamente.</para>

	  <para>Se o arquivo de chave é dado como <quote>-</quote>, a entrada padrão será usada. Por exemplo, este comando gera três arquivos principais:</para>

	  <screen><prompt>#</prompt> <userinput>cat keyfile1 keyfile2 keyfile3 | geli init -K - /dev/da2</userinput></screen>
	</step>

	<step>
	  <title>Anexando o Provedor com a Chave Gerada</title>

	  <para>Para anexar o provedor, especifique o arquivo de chave, o nome do disco e a frase secreta:</para>

	  <screen><prompt>#</prompt> <userinput>geli attach -k /root/da2.key /dev/da2</userinput>
Enter passphrase:</screen>

	  <para>Isso cria um novo dispositivo com uma extensão <filename>.eli</filename>:</para>

	  <screen><prompt>#</prompt> <userinput>ls /dev/da2*</userinput>
/dev/da2  /dev/da2.eli</screen>
	</step>

	<step>
	  <title>Criando o Novo Sistema de Arquivos</title>

	  <para>Em seguida, formate o dispositivo com o sistema de arquivos <acronym>UFS</acronym> e monte-o em um ponto de montagem existente:</para>

	  <screen><prompt>#</prompt> <userinput>dd if=/dev/random of=/dev/da2.eli bs=1m</userinput>
<prompt>#</prompt> <userinput>newfs /dev/da2.eli</userinput>
<prompt>#</prompt> <userinput>mount /dev/da2.eli <replaceable>/private</replaceable></userinput></screen>

	  <para>O sistema de arquivos criptografado agora deve estar disponível para uso:</para>

	  <screen><prompt>#</prompt> <userinput>df -H</userinput>
Filesystem     Size   Used  Avail Capacity  Mounted on
/dev/ad0s1a    248M    89M   139M    38%    /
/devfs         1.0K   1.0K     0B   100%    /dev
/dev/ad0s1f    7.7G   2.3G   4.9G    32%    /usr
/dev/ad0s1d    989M   1.5M   909M     0%    /tmp
/dev/ad0s1e    3.9G   1.3G   2.3G    35%    /var
/dev/da2.eli   150G   4.1K   138G     0%    /private</screen>
	</step>
      </procedure>

      <para>Uma vez que o trabalho na partição criptografada é feito, e a partição <filename>/private</filename> não é mais necessária, é prudente colocar o dispositivo no armazenamento frio desmontando e desanexando a partição <command>geli</command> criptografada do kernel:</para>

      <screen><prompt>#</prompt> <userinput>umount /private</userinput>
<prompt>#</prompt> <userinput>geli detach da2.eli</userinput></screen>

      <para>Um script <filename>rc.d</filename> é fornecido para simplificar a montagem de dispositivos criptografados <command>geli</command> no momento da inicialização. Para este exemplo, adicione estas linhas ao arquivo <filename>/etc/rc.conf</filename>:</para>

      <programlisting>geli_devices="<replaceable>da2</replaceable>"
geli_da2_flags="-k /root/<replaceable>da2.key</replaceable>"</programlisting>

      <para>Isto configura o <filename>/dev/da2</filename> como um provedor <command>geli</command> com uma chave mestra de <filename>/root/da2.key</filename>. O sistema irá desanexando automaticamente o provedor do kernel antes que o sistema seja desligado. Durante o processo de inicialização, o script solicitará a frase secreta antes de conectar o provedor. Outras mensagens do kernel podem ser mostradas antes e depois do prompt da frase secreta. Se o processo de inicialização parecer travar, procure cuidadosamente o prompt de senha entre as outras mensagens. Depois que a frase secreta correta é inserida, o provedor é anexado. O sistema de arquivos é então montado, normalmente por uma entrada em <filename>/etc/fstab</filename>. Consulte <xref linkend="mount-unmount"/> para obter instruções sobre como configurar um sistema de arquivos para montar no momento da inicialização.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="swap-encrypting">
    <info>
      <title>Criptografando Swap</title>

      <authorgroup>
	<author><personname> <firstname>Christian</firstname> <surname>Brueffer</surname> </personname> <contrib>Escrito por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>swap</primary> <secondary>encrypting</secondary></indexterm>

    <para>Como a criptografia de partições de disco, a criptografia do espaço swap é usada para proteger informações confidenciais. Considere um aplicativo que lida com senhas. Contanto que essas senhas permaneçam na memória física, elas não serão gravadas no disco e serão apagadas após a reinicialização. No entanto, se o FreeBSD iniciar a troca de páginas de memória para liberar espaço, as senhas podem ser gravadas no disco não criptografadas. O espaço de troca de criptografia pode ser uma solução para esse cenário.</para>

    <para>Esta seção demonstra como configurar uma partição swap criptografada usando criptografia <citerefentry><refentrytitle>gbde</refentrytitle><manvolnum>8</manvolnum></citerefentry> ou <citerefentry><refentrytitle>geli</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Ele assume que <filename>/dev/ada0s1b</filename> é a partição swap.</para>

    <sect2>
      <title>Configurando Swap Criptografada</title>

      <para>As partições de swap não são criptografadas por padrão e devem ser limpas de quaisquer dados confidenciais antes de continuar. Para sobrescrever a partição swap atual com lixo aleatório, execute o seguinte comando:</para>

      <screen><prompt>#</prompt> <userinput>dd if=/dev/random of=/dev/<replaceable>ada0s1b</replaceable> bs=1m</userinput></screen>

      <para>Para criptografar a partição swap usando <citerefentry><refentrytitle>gbde</refentrytitle><manvolnum>8</manvolnum></citerefentry>, adicione o sufixo <literal>.bde</literal> à linha de swap no <filename>/etc/fstab</filename>:</para>

      <programlisting># Device		Mountpoint	FStype	Options		Dump	Pass#
/dev/ada0s1b.bde	none		swap	sw		0	0</programlisting>

      <para>Para criptografar a partição swap usando <citerefentry><refentrytitle>geli</refentrytitle><manvolnum> 8</manvolnum></citerefentry>, use o sufixo <literal>.eli</literal>:</para>

      <programlisting># Device		Mountpoint	FStype	Options		Dump	Pass#
/dev/ada0s1b.eli	none		swap	sw		0	0</programlisting>

      <para>Por padrão, <citerefentry><refentrytitle>geli</refentrytitle><manvolnum>8</manvolnum></citerefentry> usa o algoritmo <acronym>AES</acronym> com um comprimento de chave de 128 bits. Normalmente, as configurações padrão serão suficientes. Se desejado, estes padrões podem ser alterados no campo de opções no arquivo <filename>/etc/fstab</filename>. As possíveis flags são:</para>

      <variablelist>
	<varlistentry>
	  <term>aalgo</term>
	  <listitem>
	    <para>Algoritmo de verificação de integridade de dados usado para garantir que os dados criptografados não tenham sido adulterados. Veja <citerefentry><refentrytitle>geli</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter uma lista dos algoritmos suportados.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>ealgo</term>
	  <listitem>
	    <para>Algoritmo de criptografia usado para proteger os dados. Veja <citerefentry><refentrytitle>geli</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter uma lista dos algoritmos suportados.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>keylen</term>
	  <listitem>
	    <para>O comprimento da chave usada para o algoritmo de criptografia. Veja <citerefentry><refentrytitle>geli</refentrytitle><manvolnum>8</manvolnum></citerefentry> para os comprimentos de chave que são suportados por cada algoritmo de criptografia.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>sectorsize</term>
	  <listitem>
	    <para>O tamanho em que o blocos de dados é dividido antes de ser criptografado. Tamanhos de setor maiores aumentam o desempenho ao custo de maior sobrecarga de armazenamento. O tamanho recomendado é de 4096 bytes.</para>
	  </listitem>
	</varlistentry>
      </variablelist>

      <para>Este exemplo configura uma partição swap criptografada usando o algoritmo Blowfish com um comprimento de chave de 128 bits e um setor de tamanho de 4 kilobytes:</para>

      <programlisting># Device		Mountpoint	FStype	Options				Dump	Pass#
/dev/ada0s1b.eli	none		swap	sw,ealgo=blowfish,keylen=128,sectorsize=4096	0	0</programlisting>

    </sect2>

    <sect2>
      <title>Verificação de Swap Criptografada</title>

      <para>Depois que o sistema for reinicializado, a operação adequada da swap criptografada poderá ser verificada usando <command>swapinfo</command>.</para>

      <para>Se <citerefentry><refentrytitle>gbde</refentrytitle><manvolnum>8</manvolnum></citerefentry> estiver sendo usado:</para>

      <screen><prompt>%</prompt> <userinput>swapinfo</userinput>
Device          1K-blocks     Used    Avail Capacity
/dev/ada0s1b.bde   542720        0   542720     0%</screen>

      <para>Se <citerefentry><refentrytitle>geli</refentrytitle><manvolnum>8</manvolnum></citerefentry> estiver sendo usado:</para>

      <screen><prompt>%</prompt> <userinput>swapinfo</userinput>
Device          1K-blocks     Used    Avail Capacity
/dev/ada0s1b.eli   542720        0   542720     0%</screen>
    </sect2>
  </sect1>

  <sect1 xml:id="disks-hast">
    <info>
      <title>Alta Disponibilidade de Armazenamento (<acronym>HAST</acronym>)</title>

      <authorgroup>
	<author><personname> <firstname>Daniel</firstname> <surname>Gerzo</surname> </personname> <contrib>Contribuido por </contrib></author>
      </authorgroup>

      <authorgroup>
	<author><personname> <firstname>Freddie</firstname> <surname>Cash</surname> </personname> <contrib>Com contribuições de </contrib></author>

	<author><personname> <firstname>Pawel Jakub</firstname> <surname>Dawidek</surname> </personname></author>

	<author><personname> <firstname>Michael W.</firstname> <surname>Lucas</surname> </personname></author>

	<author><personname> <firstname>Viktor</firstname> <surname>Petersson</surname> </personname></author>
      </authorgroup>
    </info>

    <indexterm><primary>HAST</primary> <secondary>high availability</secondary></indexterm>

    <para>A alta disponibilidade é um dos principais requisitos em aplicativos de negócios sérios e o armazenamento altamente disponível é um componente-chave nesses ambientes. No FreeBSD, o framework Alta Disponiblidade de Armazenamento (<acronym>HAST</acronym>) permite o armazenamento transparente dos mesmos dados em várias máquinas fisicamente separadas conectadas por uma rede <acronym>TCP/IP</acronym>. <acronym>HAST</acronym> pode ser entendido como um RAID1 (mirror) baseado em rede, e é similar ao sistema de armazenamento DRBD® usado na plataforma GNU/<trademark class="registered">Linux</trademark>. Em combinação com outros recursos de alta disponibilidade do FreeBSD, como o <acronym>CARP</acronym>, o <acronym>HAST</acronym> possibilita a criação de um cluster de armazenamento altamente disponível, resistente a falhas de hardware.</para>

    <para>A seguir estão as principais características do <acronym>HAST</acronym>:</para>

    <itemizedlist>
      <listitem>
	<para>Pode ser usado para mascarar erros de <acronym>I/O</acronym> em discos rígidos locais.</para>
      </listitem>

      <listitem>
	<para>Agnóstico a sistema de arquivos, pois funciona com qualquer sistema de arquivos suportado pelo FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Ressincronização eficiente e rápida, pois somente os blocos que foram modificados durante o tempo de inatividade de um nó são sincronizados.</para>
      </listitem>

      <!--
      <listitem>
	<para>Has several synchronization modes to allow for fast
	  failover.</para>
      </listitem>
      -->

      <listitem>
	<para>Pode ser usado em um ambiente já implantado para adicionar redundância adicional.</para>
      </listitem>

      <listitem>
	<para>Juntamente com o <acronym>CARP</acronym>, <application>Heartbeat</application>, ou outras ferramentas, ele pode ser usado para construir um sistema de armazenamento robusto e durável.</para>
      </listitem>
    </itemizedlist>

    <para>Depois de ler esta seção, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>O que é <acronym>HAST</acronym>, como ele funciona e quais recursos ele fornece.</para>
      </listitem>

      <listitem>
	<para>Como configurar e usar o <acronym>HAST</acronym> no FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como integrar <acronym>CARP</acronym> e <citerefentry><refentrytitle>devd</refentrytitle><manvolnum>8</manvolnum></citerefentry> para criar um sistema de armazenamento robusto.</para>
      </listitem>
    </itemizedlist>

    <para>Antes de ler esta seção, você deve:</para>

    <itemizedlist>
      <listitem>
	<para>Entender os fundamentos do <trademark class="registered">UNIX</trademark> e do FreeBSD (<xref linkend="basics"/>).</para>
      </listitem>

      <listitem>
	<para>Saber como configurar interfaces de rede e outros subsistemas principais do FreeBSD (<xref linkend="config-tuning"/>).</para>
      </listitem>

      <listitem>
	<para>Ter uma boa compreensão da rede do FreeBSD (<xref linkend="network-communication"/>).</para>
      </listitem>
    </itemizedlist>

    <para>O projeto <acronym>HAST</acronym> foi patrocinado pela Fundação FreeBSD com o apoio de <link xlink:href="http://www.omc.net/">http://www.omc.net/</link> e <link xlink:href="http://www.transip.nl/">http://www.transip.nl/</link>.</para>

    <sect2>
      <title>Operação HAST</title>

      <para>O <acronym>HAST</acronym> fornece replicação síncrona em nível de bloco entre duas máquinas físicas: o <emphasis>primário</emphasis>, também conhecido como o nó <emphasis>master</emphasis>, e o <emphasis>secundário</emphasis>, ou nó <emphasis>slave</emphasis>. Essas duas máquinas juntas são chamadas de cluster.</para>

      <para>Como o <acronym>HAST</acronym> funciona em uma configuração primária-secundária, ele permite que apenas um dos nós do cluster esteja ativo a qualquer momento. O nó primário, também chamado de <emphasis>active</emphasis>, é aquele que irá lidar com todas as solicitações de <acronym>I/O</acronym> para dispositivos gerenciados por <acronym>HAST</acronym>. O nó secundário é automaticamente sincronizado a partir do nó primário.</para>

      <para>Os componentes físicos do sistema <acronym>HAST</acronym> são o disco local no nó primário e o disco no nó secundário remoto.</para>

      <para>O <acronym>HAST</acronym> opera de forma síncrona em um nível de bloco, tornando-o transparente para sistemas de arquivos e aplicativos. O <acronym>HAST</acronym> fornece provedores GEOM regulares em <filename>/dev/hast/</filename> para uso por outras ferramentas ou aplicativos. Não há diferença entre o uso de dispositivos <acronym>HAST</acronym> e discos ou partições brutas.</para>

      <para>Cada operação de gravação, exclusão ou liberação é enviada para o disco local e para o disco remoto sobre <acronym>TCP/IP </acronym>. Cada operação de leitura é fornecida a partir do disco local, a menos que o disco local não esteja atualizado ou ocorra um erro de <acronym>I/O</acronym>. Nesses casos, a operação de leitura é enviada para o nó secundário.</para>

      <para><acronym>HAST</acronym> tenta fornecer recuperação rápida de falhas. Por esse motivo, é importante reduzir o tempo de sincronização após a interrupção de um nó. Para fornecer sincronização rápida, o <acronym>HAST</acronym> gerencia um bitmap no disco de extensões sujas e sincroniza apenas aquelas durante uma sincronização regular, com exceção da sincronização inicial.</para>

      <para>Existem muitas maneiras de lidar com a sincronização. O <acronym>HAST</acronym> implementa vários modos de replicação para lidar com diferentes métodos de sincronização:</para>

      <itemizedlist>
	<listitem>
	  <para><emphasis>memsync</emphasis>: Este modo reporta uma operação de gravação como concluída quando a operação de gravação local é finalizada e quando o nó remoto reconhece a chegada dos dados, mas antes de realmente armazenar os dados. Os dados no nó remoto serão armazenados diretamente após o envio da confirmação. Este modo destina-se a reduzir a latência, mas ainda fornece boa confiabilidade. Este modo é o padrão.</para>
	</listitem>

	<listitem>
	  <para><emphasis>fullsync</emphasis>: Este modo relata uma operação de gravação como concluída quando a gravação local e a gravação remota são concluídas. Este é o modo de replicação mais seguro e mais lento.</para>
	</listitem>

	<listitem>
	  <para><emphasis>async</emphasis>: Este modo relata uma operação de gravação como concluída quando a gravação local é concluída. Este é o modo de replicação mais rápido e mais perigoso. Ele deve ser usado somente ao replicar para um nó distante, onde a latência é muito alta para outros modos.</para>
	</listitem>
      </itemizedlist>
    </sect2>

    <sect2>
      <title>Configuração do HAST</title>

      <para>O framework <acronym>HAST</acronym> consiste em vários componentes:</para>

      <itemizedlist>
	<listitem>
	  <para>O daemon <citerefentry><refentrytitle>hastd</refentrytitle><manvolnum>8</manvolnum></citerefentry> que fornece sincronização de dados. Quando este daemon é iniciado, ele carregará automaticamente <varname>geom_gate.ko</varname>.</para>
	</listitem>

	<listitem>
	  <para>O utilitário de gerenciamento de usuário, <citerefentry><refentrytitle>hastctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
	</listitem>

	<listitem>
	  <para>O arquivo de configuração <citerefentry><refentrytitle>hast.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>. Este arquivo deve existir antes de iniciar o <application>hastd</application>.</para>
	</listitem>
      </itemizedlist>

      <para>Usuários que preferem construir estaticamente o suporte a <literal>GEOM_GATE</literal> no kernel devem adicionar esta linha ao arquivo de configuração do kernel personalizado e reconstruir o kernel usando as instruções em <xref linkend="kernelconfig"/>:</para>

      <programlisting>options	GEOM_GATE</programlisting>

      <para>O exemplo a seguir descreve como configurar dois nós na operação mestre-escravo/primário-secundário usando <acronym>HAST</acronym> para replicar os dados entre os dois. Os nós serão chamados <literal>hasta</literal>, com um endereço <acronym>IP</acronym> <literal>172.16.0.1</literal>, e <literal>hastb</literal>, com um endereço <acronym>IP</acronym> <literal>172.16.0.2</literal>. Ambos os nós terão um disco rígido dedicado <filename>/dev/ad6</filename> do mesmo tamanho para a operação <acronym>HAST</acronym>. O conjunto <acronym>HAST</acronym>, por vezes referido como um recurso ou o provedor <acronym>GEOM</acronym> em <filename>/dev/hast/</filename>, será chamado <literal>test</literal>.</para>

      <para>A configuração do <acronym>HAST</acronym> é feita usando o arquivo <filename>/etc/hast.conf</filename>. Este arquivo deve ser idêntico nos dois nós. A configuração mais simples é:</para>

      <programlisting>resource <replaceable>test</replaceable> {
	on <replaceable>hasta</replaceable> {
		local <replaceable>/dev/ad6</replaceable>
		remote <replaceable>172.16.0.2</replaceable>
	}
	on <replaceable>hastb</replaceable> {
		local <replaceable>/dev/ad6</replaceable>
		remote <replaceable>172.16.0.1</replaceable>
	}
}</programlisting>

      <para>Para uma configuração mais avançada, consulte <citerefentry> <refentrytitle>hast.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>

      <tip>
	<para>Também é possível usar nomes de host nas instruções <literal>remote</literal> se os hosts forem resolvidos e definidos no arquivo <filename>/etc/hosts</filename> ou no <acronym>DNS</acronym> local.</para>
      </tip>

      <para>Uma vez que a configuração exista em ambos os nós, o conjunto <acronym>HAST</acronym> pode ser criado. Execute esses comandos nos dois nós para colocar os metadados iniciais no disco local e para iniciar <citerefentry><refentrytitle>hastd</refentrytitle><manvolnum>8</manvolnum></citerefentry>:</para>

      <screen><prompt>#</prompt> <userinput>hastctl create <replaceable>test</replaceable></userinput>
<prompt>#</prompt> <userinput>service hastd onestart</userinput></screen>

      <note>
	<para><emphasis>Não</emphasis> é possível  usar os provedores <acronym>GEOM</acronym> com um sistema de arquivos existente ou converter um armazenamento existente em um pool gerenciado por <acronym>HAST</acronym>. Esse procedimento precisa armazenar alguns metadados no provedor e não haverá espaço suficiente disponível em um provedor existente.</para>
      </note>

      <para>Um nó HAST <literal>primário</literal> ou <literal>secundário</literal> é selecionado por um administrador, ou software como <application>Heartbeat</application>, usando <citerefentry><refentrytitle>hastctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>. No nó primário, <literal>hasta</literal>, execute este comando:</para>

      <screen><prompt>#</prompt> <userinput>hastctl role primary <replaceable>test</replaceable></userinput></screen>

      <para>Execute este comando no nó secundário, <literal>hastb</literal>:</para>

      <screen><prompt>#</prompt> <userinput>hastctl role secondary <replaceable>test</replaceable></userinput></screen>

      <para>Verifique o resultado executando <command>hastctl</command> em cada nó:</para>

      <screen><prompt>#</prompt> <userinput>hastctl status <replaceable>test</replaceable></userinput></screen>

      <para>Verifique a linha <literal>status</literal> na saída. Se disser <literal>degraded</literal>, algo está errado com o arquivo de configuração. Ele deve dizer <literal>complete</literal> em cada nó, o que significa que a sincronização entre os nós foi iniciada. A sincronização é concluída quando <command>hastctl status</command> relata 0 bytes de extensões <literal>sujas</literal>.</para>

      <para>O próximo passo é criar um sistema de arquivos no provedor <acronym>GEOM</acronym> e montá-lo. Isso deve ser feito no nó <literal>primário</literal>. A criação do sistema de arquivos pode levar alguns minutos, dependendo do tamanho do disco rígido. Este exemplo cria um sistema de arquivos <acronym>UFS</acronym> em <filename>/dev/hast/test </filename>:</para>

      <screen><prompt>#</prompt> <userinput>newfs -U /dev/hast/<replaceable>test</replaceable></userinput>
<prompt>#</prompt> <userinput>mkdir /hast/<replaceable>test</replaceable></userinput>
<prompt>#</prompt> <userinput>mount /dev/hast/<replaceable>test</replaceable> <replaceable>/hast/test</replaceable></userinput></screen>

      <para>Uma vez que o framework <acronym>HAST</acronym> esteja configurado corretamente, o passo final é garantir que o <acronym>HAST</acronym> seja iniciado automaticamente durante a inicialização do sistema. Adicione esta linha ao <filename>/etc/rc.conf</filename>:</para>

      <programlisting>hastd_enable="YES"</programlisting>

      <sect3>
	<title>Configuração de Failover</title>

	<para>O objetivo deste exemplo é construir um sistema de armazenamento robusto que seja resistente à falha de qualquer nó. Se o nó primário falhar, o nó secundário estará lá para assumir o controle, verificar e montar o sistema de arquivos e continuar a trabalhar sem perder um único bit de dados.</para>

	<para>Para realizar essa tarefa, o Protocolo de Redundância de Endereços Comuns (<acronym>CARP</acronym>) é usado para fornecer failover automático na camada <acronym>IP</acronym>. O <acronym>CARP</acronym> permite que vários hosts no mesmo segmento de rede compartilhem um endereço <acronym>IP</acronym>. Configure o <acronym>CARP</acronym> em ambos os nós do cluster de acordo com a documentação disponível em <xref linkend="carp"/>. Neste exemplo, cada nó terá seu próprio endereço de gerenciamento <acronym>IP</acronym> e um endereço <acronym>IP</acronym> compartilhado de <replaceable>172.16.0.254</replaceable>. O nó principal <acronym>HAST</acronym> do cluster deve ser o nó mestre <acronym>CARP</acronym>.</para>

	<para>O pool <acronym>HAST</acronym> criado na seção anterior está agora pronto para ser exportado para os outros hosts da rede. Isso pode ser feito exportando-o através do <acronym>NFS</acronym> ou <application>Samba</application>, usando o endereço <acronym>IP</acronym> <replaceable>172.16.0.254</replaceable> compartilhado. O único problema que permanece não resolvido é um failover automático caso o nó primário falhe.</para>

	<para>Caso as interfaces do <acronym>CARP</acronym> subam ou desçam, o sistema operacional FreeBSD gera um evento <citerefentry><refentrytitle>devd</refentrytitle><manvolnum>8</manvolnum></citerefentry>, tornando possível observar mudanças de estado nas interfaces do <acronym>CARP</acronym>. Uma alteração de estado na interface <acronym>CARP</acronym> é uma indicação de que um dos nós falhou ou voltou a ficar online. Esses eventos de mudança de estado tornam possível executar um script que manipulará automaticamente o failover HAST.</para>

	<para>Para capturar mudanças de estado nas interfaces do <acronym>CARP</acronym>, adicione esta configuração ao <filename>/etc/devd.conf</filename> em cada nó:</para>

	<programlisting>notify 30 {
	match "system" "IFNET";
	match "subsystem" "carp0";
	match "type" "LINK_UP";
	action "/usr/local/sbin/carp-hast-switch master";
};

notify 30 {
	match "system" "IFNET";
	match "subsystem" "carp0";
	match "type" "LINK_DOWN";
	action "/usr/local/sbin/carp-hast-switch slave";
};</programlisting>

	<note>
	  <para>Se os sistemas estiverem executando o FreeBSD 10 ou superior, substitua <filename>carp0</filename> pelo nome da interface configurada <acronym>CARP</acronym>.</para>
	</note>

	<para>Reinicie o <citerefentry><refentrytitle>devd</refentrytitle><manvolnum>8</manvolnum></citerefentry> em ambos os nós para colocar a nova configuração em vigor:</para>

	<screen><prompt>#</prompt> <userinput>service devd restart</userinput></screen>

	<para>Quando o estado da interface especificada é alterado subindo ou descendo, o sistema gera uma notificação, permitindo que o subsistema <citerefentry><refentrytitle>devd</refentrytitle><manvolnum>8</manvolnum></citerefentry> execute o script de failover automático especificado, <filename>/usr/local/sbin/carp-hast-switch </filename>. Para maiores esclarecimentos sobre esta configuração, consulte <citerefentry><refentrytitle>devd.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>

	<para>Aqui está um exemplo de um script de failover automatizado:</para>

	<programlisting>#!/bin/sh

# Original script by Freddie Cash &lt;fjwcash@gmail.com&gt;
# Modified by Michael W. Lucas &lt;mwlucas@BlackHelicopters.org&gt;
# and Viktor Petersson &lt;vpetersson@wireload.net&gt;

# The names of the HAST resources, as listed in /etc/hast.conf
resources="<replaceable>test</replaceable>"

# delay in mounting HAST resource after becoming master
# make your best guess
delay=3

# logging
log="local0.debug"
name="carp-hast"

# end of user configurable stuff

case "$1" in
	master)
		logger -p $log -t $name "Switching to primary provider for ${resources}."
		sleep ${delay}

		# Wait for any "hastd secondary" processes to stop
		for disk in ${resources}; do
			while $( pgrep -lf "hastd: ${disk} \(secondary\)" &gt; /dev/null 2&gt;&amp;1 ); do
				sleep 1
			done

			# Switch role for each disk
			hastctl role primary ${disk}
			if [ $? -ne 0 ]; then
				logger -p $log -t $name "Unable to change role to primary for resource ${disk}."
				exit 1
			fi
		done

		# Wait for the /dev/hast/* devices to appear
		for disk in ${resources}; do
			for I in $( jot 60 ); do
				[ -c "/dev/hast/${disk}" ] &amp;&amp; break
				sleep 0.5
			done

			if [ ! -c "/dev/hast/${disk}" ]; then
				logger -p $log -t $name "GEOM provider /dev/hast/${disk} did not appear."
				exit 1
			fi
		done

		logger -p $log -t $name "Role for HAST resources ${resources} switched to primary."


		logger -p $log -t $name "Mounting disks."
		for disk in ${resources}; do
			mkdir -p /hast/${disk}
			fsck -p -y -t ufs /dev/hast/${disk}
			mount /dev/hast/${disk} /hast/${disk}
		done

	;;

	slave)
		logger -p $log -t $name "Switching to secondary provider for ${resources}."

		# Switch roles for the HAST resources
		for disk in ${resources}; do
			if ! mount | grep -q "^/dev/hast/${disk} on "
			then
			else
				umount -f /hast/${disk}
			fi
			sleep $delay
			hastctl role secondary ${disk} 2&gt;&amp;1
			if [ $? -ne 0 ]; then
				logger -p $log -t $name "Unable to switch role to secondary for resource ${disk}."
				exit 1
			fi
			logger -p $log -t $name "Role switched to secondary for resource ${disk}."
		done
	;;
esac</programlisting>

	<para>Em poucas palavras, o script executa essas ações quando um nó se torna mestre:</para>

	<itemizedlist>
	  <listitem>
	    <para>Promove o pool de <acronym>HAST</acronym> para primário no outro nó.</para>
	  </listitem>

	  <listitem>
	    <para>Verifica o sistema de arquivos no pool <acronym>HAST</acronym>.</para>
	  </listitem>

	  <listitem>
	    <para>Monta o pool.</para>
	  </listitem>
	</itemizedlist>

	<para>Quando um nó se torna secundário:</para>

	<itemizedlist>
	  <listitem>
	    <para>Desmonta o conjunto <acronym>HAST</acronym>.</para>
	  </listitem>

	  <listitem>
	    <para>Degrada o pool <acronym>HAST</acronym> para secundário.</para>
	  </listitem>
	</itemizedlist>

	<caution>
	  <para>Este é apenas um script de exemplo que serve como prova de conceito. Ele não manipula todos os cenários possíveis e pode ser estendido ou alterado de qualquer forma, por exemplo, para iniciar ou interromper os serviços necessários.</para>
	</caution>

	<tip>
	  <para>Para este exemplo, foi utilizado um sistema de arquivos padrão <acronym>UFS</acronym>. Para reduzir o tempo necessário para a recuperação, é possível usar um sistema de arquivos <acronym>UFS</acronym> ou <acronym>ZFS</acronym> com journal ativado.</para>
	</tip>

	<para>Informações mais detalhadas com exemplos adicionais podem ser encontradas em <link xlink:href="http://wiki.FreeBSD.org/HAST">http://wiki.FreeBSD.org/HAST</link>.</para>
      </sect3>
    </sect2>

    <sect2>
      <title>Solução de problemas</title>

      <para>O <acronym>HAST</acronym> geralmente deve funcionar sem problemas. No entanto, como acontece com qualquer outro produto de software, pode haver momentos em que ele não funciona como deveria. As origens dos problemas podem ser diferentes, mas a regra geral é garantir que o horário esteja sincronizado entre os nós do cluster.</para>

      <para>Quando estiver fazendo troubleshooting no <acronym>HAST</acronym>, o nível de depuração de <citerefentry><refentrytitle>hastd</refentrytitle><manvolnum>8</manvolnum></citerefentry> deve ser aumentado iniciando <command>hastd</command> com <literal>-d</literal>. Esse argumento pode ser especificado várias vezes para aumentar ainda mais o nível de depuração. Considere também usar <literal>-F</literal>, que inicia o <command>hastd</command> em primeiro plano.</para>

      <sect3 xml:id="disks-hast-sb">
	<title>Recuperando-se da Condição de Split-brain</title>

	<para><firstterm>Split-brain</firstterm> ocorre quando os nós do cluster não conseguem se comunicar entre si e ambos são configurados como primários. Esta é uma condição perigosa porque permite que ambos os nós façam alterações incompatíveis nos dados. Esse problema deve ser corrigido manualmente pelo administrador do sistema.</para>

	<para>O administrador deve decidir qual nó tem alterações mais importantes ou executar a mesclagem manualmente. Então, deixe o <acronym>HAST</acronym> executar a sincronização completa do nó que possui os dados quebrados. Para fazer isso, emita esses comandos no nó que precisa ser ressincronizado:</para>

	<screen><prompt>#</prompt> <userinput>hastctl role init <replaceable>test</replaceable></userinput>
<prompt>#</prompt> <userinput>hastctl create <replaceable>test</replaceable></userinput>
<prompt>#</prompt> <userinput>hastctl role secondary <replaceable>test</replaceable></userinput></screen>
      </sect3>
    </sect2>
  </sect1>
</chapter>

    
<!--
     The FreeBSD Documentation Project
     $FreeBSD$

-->
<chapter version="5.0" xml:id="geom">

  <info>
    <title>GEOM: Framework de Transformação de Disco Modular</title>

    <authorgroup>
      <author><personname><firstname>Tom</firstname> <surname>Rhodes</surname></personname><contrib>Escrito por</contrib></author>
    </authorgroup>
  </info>

  <sect1 xml:id="geom-synopsis">
    <title>Sinopse</title>

    <indexterm><primary><acronym>GEOM</acronym></primary></indexterm>
    <indexterm><primary><acronym>GEOM</acronym> Disk Framework</primary> <see><acronym>GEOM</acronym></see></indexterm>

    <para>No FreeBSD, o framework <acronym>GEOM</acronym> permite acesso e controle à classes, tais como Master Boot Records e labels <acronym>BSD</acronym>, através do uso de provedores, ou dos dispositivos de disco em <filename>/dev</filename>. Ao suportar várias configurações de <acronym>RAID</acronym> via software, o <acronym>GEOM</acronym> fornece, de forma transparente, acesso ao sistema operacional e aos utilitários do sistema operacional.</para>

    <para>Este capítulo aborda o uso de discos sob o framework do <acronym>GEOM</acronym> no FreeBSD. Isso inclui os principais utilitários de controle <acronym>RAID</acronym> os quais usam o framework para configuração. Este capítulo não é um guia definitivo para as configurações de <acronym>RAID</acronym> e somente as classificações de <acronym>RAID</acronym> suportadas pelo <acronym>GEOM</acronym> são discutidas.</para>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>Que tipo de suporte a <acronym>RAID</acronym> está disponível através do <acronym>GEOM</acronym>.</para>
      </listitem>

      <listitem>
	<para>Como usar os utilitários da base para configurar, manter e manipular os vários níveis de <acronym>RAID</acronym>.</para>
      </listitem>

      <listitem>
	<para>Como espelhar, distribuir, criptografar e conectar remotamente dispositivos de disco por meio do <acronym>GEOM</acronym>.</para>
      </listitem>

      <listitem>
	<para>Como solucionar problemas de discos conectados ao framework do <acronym>GEOM</acronym>.</para>
      </listitem>
    </itemizedlist>

    <para>Antes de ler este capítulo, você deve:</para>

    <itemizedlist>
      <listitem>
	<para>Entender como o FreeBSD trata os dispositivos de disco (<xref linkend="disks"/>).</para>
      </listitem>

      <listitem>
	<para>Saber como configurar e instalar um novo kernel (<xref linkend="kernelconfig"/>).</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="geom-striping">
    <info>
      <title>RAID0 - Striping</title>

      <authorgroup>
	<author><personname><firstname>Tom</firstname> <surname>Rhodes</surname></personname><contrib>Escrito por</contrib></author>

	<author><personname> <firstname>Murray</firstname> <surname>Stokely</surname> </personname></author>
      </authorgroup>
    </info>

    <indexterm><primary><acronym>GEOM</acronym></primary></indexterm>
    <indexterm><primary>Striping</primary></indexterm>

    <para>O striping combina várias unidades de disco em um único volume. O striping pode ser realizado através do uso de hardwares controladores de <acronym>RAID</acronym>. O subsistema de disco <acronym>GEOM</acronym> fornece suporte de software para striping de disco, também conhecido como <acronym>RAID0</acronym>, sem a necessidade de um controlador <acronym>RAID</acronym> de disco.</para>

    <para>No <acronym>RAID0</acronym>, os dados são divididos em blocos que são gravados em todas as unidades do array. Como pode ser visto na ilustração a seguir, em vez de esperar no sistema para gravar 256k em um disco, o <acronym>RAID0</acronym> pode gravar 64k simultaneamente em cada um dos quatro discos do array, oferecendo um desempenho de <acronym>I/O</acronym> superior. Esse desempenho pode ser aprimorado ainda mais usando vários controladores de disco.</para>

    <mediaobject><imageobject> <imagedata fileref="geom/striping" align="center"/> </imageobject> <textobject> <phrase>Disk Striping Illustration</phrase> </textobject></mediaobject>

    <para>Cada disco em um stripe <acronym>RAID0</acronym> deve ser do mesmo tamanho, pois as solicitações de <acronym>I/O</acronym> são intercaladas para ler ou gravar em vários discos em paralelo.</para>

    <note>
      <para>O <acronym>RAID0</acronym> <emphasis>não</emphasis> fornece qualquer redundância. Isso significa que, se um disco no array falhar, todos os dados nos discos serão perdidos. Se os dados forem importantes, implemente uma estratégia de backup que salva regularmente os backups em um sistema ou dispositivo remoto.</para>
    </note>

    <para>O processo para criar um <acronym>RAID0</acronym> por software, baseado no <acronym>GEOM</acronym>, em um sistema FreeBSD usando discos comuns é o seguinte. Uma vez que o stripe tiver sido criado, consulte <citerefentry><refentrytitle>gstripe</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter maioress informações sobre como controlar uma stripe existente.</para>

    <procedure>
      <title>Criando um Stripe de Discos <acronym>ATA</acronym> Não Formatados</title>

      <step>
	<para>Carregue o módulo <filename>geom_stripe.ko</filename>:</para>

	<screen><prompt>#</prompt> <userinput>kldload geom_stripe</userinput></screen>
      </step>

      <step>
	<para>Assegure-se de que exista um ponto de montagem adequado. Se esse volume se tornar uma partição root, use temporariamente outro ponto de montagem, como <filename>/mnt</filename>.</para>
      </step>

      <step>
	<para>Determine os nomes dos dispositivos para os discos que serão striped e crie o novo dispositivo de stripe. Por exemplo, para distribuir dois discos <acronym>ATA</acronym> não utilizados e não particionados com nomes de dispositivos <filename>/dev/ad2</filename> e <filename>/dev/ad3</filename>:</para>

	<screen><prompt>#</prompt> <userinput>gstripe label -v st0 /dev/ad2 /dev/ad3</userinput>
Metadata value stored on /dev/ad2.
Metadata value stored on /dev/ad3.
Done.</screen>
      </step>

      <step>
	<para>Escreva um label padrão, também conhecido como tabela de partição, no novo volume e instale o código do bootstrap padrão:</para>

	<screen><prompt>#</prompt> <userinput>bsdlabel -wB /dev/stripe/st0</userinput></screen>
      </step>

      <step>
	<para>Este processo deve criar dois outros dispositivos em <filename>/dev/stripe</filename> além de <filename>st0</filename>. Esses incluem o <filename>st0a</filename> e o <filename>st0c</filename>. Neste ponto, um sistema de arquivos <acronym>UFS</acronym> pode ser criado no <filename>st0a</filename> usando o <command>newfs</command>:</para>

	<screen><prompt>#</prompt> <userinput>newfs -U /dev/stripe/st0a</userinput></screen>

	<para>Muitos números irão deslizar pela tela e, após alguns segundos, o processo será concluído. O volume foi criado e está pronto para ser montado.</para>
      </step>

      <step>
	<para>Para montar manualmente o stripe de disco criado:</para>

	<screen><prompt>#</prompt> <userinput>mount /dev/stripe/st0a /mnt</userinput></screen>
      </step>

      <step>
	<para>Para montar este sistema de arquivos distribuído automaticamente durante o processo de inicialização, coloque as informações do volume no arquivo <filename>/etc/fstab</filename>. Neste exemplo, um ponto de montagem permanente, chamado <filename>stripe</filename>, é criado:</para>

	<screen><prompt>#</prompt> <userinput>mkdir /stripe</userinput>
<prompt>#</prompt> <userinput>echo "/dev/stripe/st0a /stripe ufs rw 2 2" \</userinput>
<userinput>&gt;&gt; /etc/fstab</userinput></screen>
      </step>

      <step>
	<para>O módulo <filename>geom_stripe.ko</filename> também deve ser carregado automaticamente durante a inicialização do sistema, adicionando uma linha ao arquivo <filename>/boot/loader.conf</filename>:</para>

	<screen><prompt>#</prompt> <userinput>echo 'geom_stripe_load="YES"' &gt;&gt; /boot/loader.conf</userinput></screen>
      </step>
    </procedure>
  </sect1>

  <sect1 xml:id="geom-mirror">
    <title>RAID1 - Espelhamento</title>

    <indexterm><primary><acronym>GEOM</acronym></primary></indexterm>
    <indexterm><primary>Disk Mirroring</primary></indexterm>
    <indexterm><primary>RAID1</primary></indexterm>

    <para>O <acronym>RAID1</acronym>, ou <emphasis>espelhamento</emphasis>, é a técnica de gravar os mesmos dados em mais de uma unidade de disco. Os espelhos são geralmente usados para proteger contra perda de dados devido a falhas na unidade. Cada unidade espelhada contém uma cópia idêntica dos dados. Quando uma unidade individual falha, o espelhamento continua a funcionar, fornecendo dados a partir das unidades que ainda estão funcionando. O computador continua funcionando e o administrador tem tempo para substituir a unidade com falha sem impactar o usuário.</para>

    <para>Duas situações comuns são ilustradas nesses exemplos. O primeiro cria um espelhamento de dois novos discos e usa-o como um substituto para um único disco existente. O segundo exemplo cria um espelho em um único disco novo, copia os dados do disco antigo para ele e insere o disco antigo no espelho. Embora esse procedimento seja um pouco mais complicado, ele requer apenas um novo disco.</para>

    <para>Tradicionalmente, os dois discos em um espelhamento são idênticos em modelo e capacidade, mas o <citerefentry><refentrytitle>gmirror</refentrytitle><manvolnum>8</manvolnum></citerefentry> não requer isso. Os espelhamentos criados com discos diferentes terão uma capacidade igual à da menor unidade no espelhamento. O espaço extra em discos maiores não será usado. Os discos  inseridos posteriormente no espelhamento devem ter pelo menos a mesma capacidade que o menor disco já existente no espelhamento.</para>

    <warning>
      <para>Os procedimentos de espelhamento mostrados aqui são não-destrutivos, mas como em qualquer grande operação de disco, faça um backup completo primeiro.</para>
    </warning>

    <warning>
      <para>Embora o <citerefentry><refentrytitle>dump</refentrytitle><manvolnum>8</manvolnum></citerefentry> seja usado nesses procedimentos para copiar sistemas de arquivos, ele não funciona em sistemas de arquivos com Soft Updates Journaling. Consulte o <citerefentry><refentrytitle>tunefs</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter informações sobre como detectar e desativar o Soft Updates Journaling.</para>
    </warning>

    <sect2 xml:id="geom-mirror-metadata">
      <title>Problemas de Metadados</title>

      <para>Muitos sistemas de disco armazenam metadados no final de cada disco. Metadados antigos devem ser apagados antes de reutilizar o disco em um espelhamento. A maioria dos problemas é causada por dois tipos particulares de metadados residuais: tabelas de partição <acronym>GPT</acronym> e metadados antigos de um espelhamento anterior.</para>

      <para>Os metadados <acronym>GPT</acronym> podem ser apagados com <citerefentry><refentrytitle>gpart</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Este exemplo apaga as tabelas de partições primárias e de backup do <acronym>GPT</acronym> do disco <filename>ada8</filename>:</para>

      <screen><prompt>#</prompt> <userinput>gpart destroy -F ada8</userinput></screen>

      <para>Um disco pode ser removido de um espelhamento ativo e os metadados apagados em uma etapa usando <citerefentry><refentrytitle>gmirror</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Aqui, o disco de exemplo <filename>ada8</filename> é removido do espelhamento ativo <filename>gm4</filename>:</para>

      <screen><prompt>#</prompt> <userinput>gmirror remove gm4 ada8</userinput></screen>

      <para>Se o espelhamento não estiver em execução, mas os metadados do espelhamento antigo ainda estiverem no disco, use o comando <command>gmirror clear</command> para removê-lo:</para>

      <screen><prompt>#</prompt> <userinput>gmirror clear ada8</userinput></screen>

      <para>O <citerefentry><refentrytitle>gmirror</refentrytitle><manvolnum>8</manvolnum></citerefentry> armazena um bloco de metadados no final do disco. Como os esquemas de partição <acronym>GPT</acronym> também armazenam metadados no final do disco, espelhar discos <acronym>GPT</acronym> inteiros com <citerefentry><refentrytitle>gmirror</refentrytitle><manvolnum>8</manvolnum></citerefentry> não é recomendado. O particionamento <acronym>MBR</acronym> é usado aqui porque armazena apenas uma tabela de partição no início do disco e não entra em conflito com os metadados espelhados.</para>
    </sect2>

    <sect2 xml:id="geom-mirror-two-new-disks">
      <title>Criando um Espelhamento com Dois Discos Novos</title>

      <para>Neste exemplo, o FreeBSD já foi instalado em um único disco, <filename>ada0</filename>. Dois novos discos, <filename>ada1</filename> e <filename>ada2</filename>, foram conectados ao sistema. Um novo espelhamento será criado nesses dois discos e usado para substituir o antigo disco único.</para>

      <para>O módulo do kernel <filename>geom_mirror.ko</filename> deve ser compilado no kernel ou carregado no boot ou em tempo de execução. Carregue manualmente o módulo do kernel agora:</para>

      <screen><prompt>#</prompt> <userinput>gmirror load</userinput></screen>

      <para>Crie o espelho com as duas novas unidades:</para>

      <screen><prompt>#</prompt> <userinput>gmirror label -v gm0 /dev/ada1 /dev/ada2</userinput></screen>

      <para>O <filename>gm0</filename> é um nome de dispositivo escolhido pelo usuário atribuído ao novo espelhamento. Depois que o espelhamento for iniciado, o nome desse dispositivo aparecerá em <filename>/dev/mirror/</filename>.</para>

      <para>As tabelas de partição <acronym>MBR</acronym> e <application>bsdlabel</application> agora podem ser criadas no mirror com o <citerefentry><refentrytitle>gpart</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Este exemplo usa um layout de sistema de arquivos tradicional, com partições para <filename>/</filename>, swap, <filename>/var</filename>, <filename>/tmp</filename> e <filename>/usr</filename>. Um único <filename>/</filename> e uma partição swap também funcionarão.</para>

      <para>As partições no espelho não precisam ser do mesmo tamanho que as do disco existente, mas devem ser grandes o suficiente para conter todos os dados já presentes no disco <filename>ada0</filename>.</para>

      <screen><prompt>#</prompt> <userinput>gpart create -s MBR mirror/gm0</userinput>
<prompt>#</prompt> <userinput>gpart add -t freebsd -a 4k mirror/gm0</userinput>
<prompt>#</prompt> <userinput>gpart show mirror/gm0</userinput>
=&gt;       63  156301423  mirror/gm0  MBR  (74G)
         63         63                    - free -  (31k)
        126  156301299                 1  freebsd  (74G)
  156301425         61                    - free -  (30k)</screen>

      <screen><prompt>#</prompt> <userinput>gpart create -s BSD mirror/gm0s1</userinput>
<prompt>#</prompt> <userinput>gpart add -t freebsd-ufs  -a 4k -s 2g mirror/gm0s1</userinput>
<prompt>#</prompt> <userinput>gpart add -t freebsd-swap -a 4k -s 4g mirror/gm0s1</userinput>
<prompt>#</prompt> <userinput>gpart add -t freebsd-ufs  -a 4k -s 2g mirror/gm0s1</userinput>
<prompt>#</prompt> <userinput>gpart add -t freebsd-ufs  -a 4k -s 1g mirror/gm0s1</userinput>
<prompt>#</prompt> <userinput>gpart add -t freebsd-ufs  -a 4k       mirror/gm0s1</userinput>
<prompt>#</prompt> <userinput>gpart show mirror/gm0s1</userinput>
=&gt;        0  156301299  mirror/gm0s1  BSD  (74G)
          0          2                      - free -  (1.0k)
          2    4194304                   1  freebsd-ufs  (2.0G)
    4194306    8388608                   2  freebsd-swap  (4.0G)
   12582914    4194304                   4  freebsd-ufs  (2.0G)
   16777218    2097152                   5  freebsd-ufs  (1.0G)
   18874370  137426928                   6  freebsd-ufs  (65G)
  156301298          1                      - free -  (512B)</screen>

      <para>Torne o espelhamento inicializável instalando o bootcode no <acronym>MBR</acronym> e no bsdlabel e definindo a slice ativa:</para>

      <screen><prompt>#</prompt> <userinput>gpart bootcode -b /boot/mbr mirror/gm0</userinput>
<prompt>#</prompt> <userinput>gpart set -a active -i 1 mirror/gm0</userinput>
<prompt>#</prompt> <userinput>gpart bootcode -b /boot/boot mirror/gm0s1</userinput></screen>

      <para>Formate os sistemas de arquivos no novo espelhamento, habilitando as atualizações simples.</para>

      <screen><prompt>#</prompt> <userinput>newfs -U /dev/mirror/gm0s1a</userinput>
<prompt>#</prompt> <userinput>newfs -U /dev/mirror/gm0s1d</userinput>
<prompt>#</prompt> <userinput>newfs -U /dev/mirror/gm0s1e</userinput>
<prompt>#</prompt> <userinput>newfs -U /dev/mirror/gm0s1f</userinput></screen>

      <para>Os sistemas de arquivos do disco original <filename>ada0</filename> agora podem ser copiados para o espelho com o <citerefentry><refentrytitle>dump</refentrytitle><manvolnum>8</manvolnum></citerefentry> e o <citerefentry><refentrytitle>restore</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>

      <screen><prompt>#</prompt> <userinput>mount /dev/mirror/gm0s1a /mnt</userinput>
<prompt>#</prompt> <userinput>dump -C16 -b64 -0aL -f - / | (cd /mnt &amp;&amp; restore -rf -)</userinput>
<prompt>#</prompt> <userinput>mount /dev/mirror/gm0s1d /mnt/var</userinput>
<prompt>#</prompt> <userinput>mount /dev/mirror/gm0s1e /mnt/tmp</userinput>
<prompt>#</prompt> <userinput>mount /dev/mirror/gm0s1f /mnt/usr</userinput>
<prompt>#</prompt> <userinput>dump -C16 -b64 -0aL -f - /var | (cd /mnt/var &amp;&amp; restore -rf -)</userinput>
<prompt>#</prompt> <userinput>dump -C16 -b64 -0aL -f - /tmp | (cd /mnt/tmp &amp;&amp; restore -rf -)</userinput>
<prompt>#</prompt> <userinput>dump -C16 -b64 -0aL -f - /usr | (cd /mnt/usr &amp;&amp; restore -rf -)</userinput></screen>

      <para>Edite o arquivo <filename>/mnt/etc/fstab</filename> para apontar para os novos sistemas de arquivos espelhados:</para>

      <programlisting># Device		Mountpoint	FStype	Options	Dump	Pass#
/dev/mirror/gm0s1a	/		ufs	rw	1	1
/dev/mirror/gm0s1b	none		swap	sw	0	0
/dev/mirror/gm0s1d	/var		ufs	rw	2	2
/dev/mirror/gm0s1e	/tmp		ufs	rw	2	2
/dev/mirror/gm0s1f	/usr		ufs	rw	2	2</programlisting>

      <para>Se o módulo do kernel <filename>geom_mirror.ko</filename> não foi compilado no kernel, o <filename>/mnt/boot/loader.conf</filename> é editado para carregar o módulo na inicialização:</para>

      <programlisting>geom_mirror_load="YES"</programlisting>

      <para>Reinicialize o sistema para testar o novo espelhamento e verifique se todos os dados foram copiados. A <acronym>BIOS</acronym> verá o espelhamento como duas unidades individuais em vez de um espelhamento. Como as unidades são idênticas, não importa qual seja selecionado para inicializar.</para>

      <para>Veja <xref linkend="gmirror-troubleshooting"/> se houver problemas ao inicializar. Desligar e desconectar o disco original <filename>ada0</filename> permitirá que ele seja mantido como um backup offline.</para>

      <para>Em uso, o espelhamento se comportará exatamente como a unidade original.</para>
    </sect2>

    <sect2 xml:id="geom-mirror-existing-drive">
      <title>Criando um Espelhamento com Uma Unidade Existente</title>

      <para>Neste exemplo, o FreeBSD já foi instalado em um único disco, <filename>ada0</filename>. Um novo disco, <filename>ada1</filename>, foi conectado ao sistema. Um espelhamento de um disco será criado no novo disco, o sistema existente será copiado para ele e, em seguida, o disco antigo será inserido no espelho. Esse procedimento um pouco complexo é necessário porque o <command>gmirror</command> precisa colocar um bloco de metadados de 512 bytes no final de cada disco, e o <filename>ada0</filename> geralmente possui todo o seu espaço já alocado.</para>

      <para>Carregue o módulo do kernel <filename>geom_mirror.ko</filename>:</para>

      <screen><prompt>#</prompt> <userinput>gmirror load</userinput></screen>

      <para>Verifique o tamanho da mídia do disco original com <command>diskinfo</command>:</para>

      <screen><prompt>#</prompt> <userinput>diskinfo -v ada0 | head -n3</userinput>
/dev/ada0
	512             # sectorsize
	1000204821504   # mediasize in bytes (931G)</screen>

      <para>Crie um espelhamento no novo disco. Para garantir que a capacidade do espelhamento não seja maior do que a unidade <filename>ada0</filename> original, <citerefentry><refentrytitle>gnop</refentrytitle><manvolnum>8</manvolnum></citerefentry> é usado para criar uma unidade falsa exatamente do mesmo tamanho. Esta unidade não armazena dados, mas é usada apenas para limitar o tamanho do espelhamento. Quando o <citerefentry><refentrytitle>gmirror</refentrytitle><manvolnum>8</manvolnum></citerefentry> cria o espelhamento, ele irá restringir a capacidade ao tamanho de <filename>gzero.nop </filename>, mesmo se a nova unidade <filename>ada1</filename> tiver mais espaço. Note que o <replaceable>1000204821504</replaceable> na segunda linha é igual ao tamanho de mídia do <filename>ada0</filename> como mostrado pelo comando <command>diskinfo</command> acima.</para>

      <screen><prompt>#</prompt> <userinput>geom zero load</userinput>
<prompt>#</prompt> <userinput>gnop create -s 1000204821504 gzero</userinput>
<prompt>#</prompt> <userinput>gmirror label -v gm0 gzero.nop ada1</userinput>
<prompt>#</prompt> <userinput>gmirror forget gm0</userinput></screen>

      <para>Como o <filename>gzero.nop</filename> não armazena nenhum dado, o espelhamento não o vê como conectado. É dito para o espelhamento <quote>esquecer</quote> os componentes desconectados, removendo referências para <filename>gzero.nop</filename>. O resultado é um dispositivo espelhado contendo apenas um único disco, <filename>ada1</filename>.</para>

      <para>Depois de criar o <filename>gm0</filename>, veja a tabela de partições em <filename>ada0</filename>. Esta saída é de uma unidade de 1 TB. Se houver algum espaço não alocado no final da unidade, o conteúdo pode ser copiado diretamente de <filename>ada0</filename> para o novo espelho.</para>

      <para>No entanto, se a saída mostrar que todo o espaço no disco está alocado, como na listagem a seguir, não há espaço disponível para os 512-bytes de metadados de espelhamento no final do disco.</para>

      <screen><prompt>#</prompt> <userinput>gpart show ada0</userinput>
=&gt;        63  1953525105        ada0  MBR  (931G)
          63  1953525105           1  freebsd  [active]  (931G)</screen>

      <para>Neste caso, a tabela de partição deve ser editada para reduzir a capacidade de um setor em <filename>mirror/gm0</filename>. O procedimento será explicado mais tarde.</para>

      <para>Em qualquer um dos casos, as tabelas de partição no disco principal devem ser primeiro copiadas usando <command>gpart backup</command> e <command>gpart restore</command>.</para>

      <screen><prompt>#</prompt> <userinput>gpart backup ada0 &gt; table.ada0</userinput>
<prompt>#</prompt> <userinput>gpart backup ada0s1 &gt; table.ada0s1</userinput></screen>

      <para>Esses comandos criam dois arquivos, <filename>table.ada0</filename> e <filename>table.ada0s1</filename>. Este exemplo é de uma unidade de 1 TB:</para>

      <screen><prompt>#</prompt> <userinput>cat table.ada0</userinput>
MBR 4
1 freebsd         63 1953525105   [active]</screen>

      <screen><prompt>#</prompt> <userinput>cat table.ada0s1</userinput>
BSD 8
1  freebsd-ufs          0    4194304
2 freebsd-swap    4194304   33554432
4  freebsd-ufs   37748736   50331648
5  freebsd-ufs   88080384   41943040
6  freebsd-ufs  130023424  838860800
7  freebsd-ufs  968884224  984640881</screen>

      <para>Se nenhum espaço livre for exibido no final do disco, o tamanho da slice e da última partição deve ser reduzido por um setor. Edite os dois arquivos, reduzindo o tamanho da fatia e da última partição em um. Estes são os últimos números em cada listagem.</para>

      <screen><prompt>#</prompt> <userinput>cat table.ada0</userinput>
MBR 4
1 freebsd         63 <emphasis>1953525104</emphasis>   [active]</screen>

      <screen><prompt>#</prompt> <userinput>cat table.ada0s1</userinput>
BSD 8
1  freebsd-ufs          0    4194304
2 freebsd-swap    4194304   33554432
4  freebsd-ufs   37748736   50331648
5  freebsd-ufs   88080384   41943040
6  freebsd-ufs  130023424  838860800
7  freebsd-ufs  968884224  <emphasis>984640880</emphasis></screen>

      <para>Se pelo menos um setor não foi alocado no final do disco, esses dois arquivos podem ser usados sem modificação.</para>

      <para>Agora restaure a tabela de partições em <filename>mirror/gm0</filename>:</para>

      <screen><prompt>#</prompt> <userinput>gpart restore mirror/gm0 &lt; table.ada0</userinput>
<prompt>#</prompt> <userinput>gpart restore mirror/gm0s1 &lt; table.ada0s1</userinput></screen>

      <para>Verifique a tabela de partições com o comando <command>gpart show</command>. Este exemplo tem <filename>gm0s1a</filename> para <filename>/</filename>, <filename>gm0s1d</filename> para <filename>/var</filename>, <filename>gm0s1e</filename> para <filename>/usr</filename>, <filename>gm0s1f</filename> para <filename>/data1</filename> e <filename>gm0s1g</filename> para <filename>/data2</filename>.</para>

      <screen><prompt>#</prompt> <userinput>gpart show mirror/gm0</userinput>
=&gt;        63  1953525104  mirror/gm0  MBR  (931G)
          63  1953525042           1  freebsd  [active]  (931G)
  1953525105          62              - free -  (31k)

<prompt>#</prompt> <userinput>gpart show mirror/gm0s1</userinput>
=&gt;         0  1953525042  mirror/gm0s1  BSD  (931G)
           0     2097152             1  freebsd-ufs  (1.0G)
     2097152    16777216             2  freebsd-swap  (8.0G)
    18874368    41943040             4  freebsd-ufs  (20G)
    60817408    20971520             5  freebsd-ufs  (10G)
    81788928   629145600             6  freebsd-ufs  (300G)
   710934528  1242590514             7  freebsd-ufs  (592G)
  1953525042          63                - free -  (31k)</screen>

      <para>Tanto a fatia quanto a última partição devem ter pelo menos um bloco livre no final do disco.</para>

      <para>Crie sistemas de arquivos nessas novas partições. O número de partições varia de acordo com o disco original, <filename>ada0</filename>.</para>

      <screen><prompt>#</prompt> <userinput>newfs -U /dev/mirror/gm0s1a</userinput>
<prompt>#</prompt> <userinput>newfs -U /dev/mirror/gm0s1d</userinput>
<prompt>#</prompt> <userinput>newfs -U /dev/mirror/gm0s1e</userinput>
<prompt>#</prompt> <userinput>newfs -U /dev/mirror/gm0s1f</userinput>
<prompt>#</prompt> <userinput>newfs -U /dev/mirror/gm0s1g</userinput></screen>

      <para>Torne o espelhamento inicializável instalando o bootcode no <acronym>MBR</acronym> e no bsdlabel e definindo a slice ativa:</para>

      <screen><prompt>#</prompt> <userinput>gpart bootcode -b /boot/mbr mirror/gm0</userinput>
<prompt>#</prompt> <userinput>gpart set -a active -i 1 mirror/gm0</userinput>
<prompt>#</prompt> <userinput>gpart bootcode -b /boot/boot mirror/gm0s1</userinput></screen>

      <para>Ajuste o arquivo <filename>/etc/fstab</filename> para usar as novas partições no espelhamento.Primeiro faça o backup deste arquivo copiando ele para <filename>/etc/fstab.orig</filename>.</para>

      <screen><prompt>#</prompt> <userinput>cp /etc/fstab /etc/fstab.orig</userinput></screen>

      <para>Edite o arquivo <filename>/etc/fstab</filename>, substituindo <filename>/dev/ada0</filename> por <filename>mirror/gm0</filename>.</para>

      <programlisting># Device		Mountpoint	FStype	Options	Dump	Pass#
/dev/mirror/gm0s1a	/		ufs	rw	1	1
/dev/mirror/gm0s1b	none		swap	sw	0	0
/dev/mirror/gm0s1d	/var		ufs	rw	2	2
/dev/mirror/gm0s1e	/usr		ufs	rw	2	2
/dev/mirror/gm0s1f	/data1		ufs	rw	2	2
/dev/mirror/gm0s1g	/data2		ufs	rw	2	2</programlisting>

      <para>Se o módulo do kernel <filename>geom_mirror.ko</filename> não foi carregado no kernel, edite o arquivo <filename>/boot/loader.conf</filename> para carregá-lo no boot:</para>

      <programlisting>geom_mirror_load="YES"</programlisting>

      <para>Os sistemas de arquivos do disco original agora podem ser copiados para o espelhamento com o <citerefentry><refentrytitle>dump</refentrytitle><manvolnum>8</manvolnum></citerefentry> e o <citerefentry><refentrytitle>restore</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Cada sistema de arquivos copiados com o <command>dump -L</command> irá primeiro criar um snapshot, o que pode levar algum tempo.</para>

      <screen><prompt>#</prompt> <userinput>mount /dev/mirror/gm0s1a /mnt</userinput>
<prompt>#</prompt> <userinput>dump -C16 -b64 -0aL -f - /    | (cd /mnt &amp;&amp; restore -rf -)</userinput>
<prompt>#</prompt> <userinput>mount /dev/mirror/gm0s1d /mnt/var</userinput>
<prompt>#</prompt> <userinput>mount /dev/mirror/gm0s1e /mnt/usr</userinput>
<prompt>#</prompt> <userinput>mount /dev/mirror/gm0s1f /mnt/data1</userinput>
<prompt>#</prompt> <userinput>mount /dev/mirror/gm0s1g /mnt/data2</userinput>
<prompt>#</prompt> <userinput>dump -C16 -b64 -0aL -f - /usr | (cd /mnt/usr &amp;&amp; restore -rf -)</userinput>
<prompt>#</prompt> <userinput>dump -C16 -b64 -0aL -f - /var | (cd /mnt/var &amp;&amp; restore -rf -)</userinput>
<prompt>#</prompt> <userinput>dump -C16 -b64 -0aL -f - /data1 | (cd /mnt/data1 &amp;&amp; restore -rf -)</userinput>
<prompt>#</prompt> <userinput>dump -C16 -b64 -0aL -f - /data2 | (cd /mnt/data2 &amp;&amp; restore -rf -)</userinput></screen>

      <para>Reinicie o sistema, inicializando a partir do <filename>ada1</filename>. Se tudo estiver funcionando, o sistema irá inicializar a partir de <filename>mirror/gm0</filename>, que agora contém os mesmos dados que o <filename>ada0</filename> tinha anteriormente. Veja <xref linkend="gmirror-troubleshooting"/> se houver problemas ao inicializar.</para>

      <para>Neste ponto, o espelhamento ainda consiste apenas no único disco <filename>ada1</filename>.</para>

      <para>Após inicializar a partir de <filename>mirror/gm0</filename> com sucesso, a etapa final é inserir <filename>ada0</filename> no espelhamento.</para>

      <important>
	<para>Quando o <filename>ada0</filename> for inserido no espelhamento, seu conteúdo anterior será substituído pelos dados do espelhamento. Certifique-se de que <filename>mirror/gm0</filename> tenha o mesmo conteúdo do <filename>ada0</filename> antes de adicionar o <filename>ada0</filename> ao espelhamento. Se o conteúdo anteriormente copiado pelo <citerefentry><refentrytitle>dump</refentrytitle><manvolnum>8</manvolnum></citerefentry> e <citerefentry><refentrytitle>restore</refentrytitle><manvolnum>8</manvolnum></citerefentry> não forem idênticos ao que estava em <filename>ada0</filename>, reverta o arquivo <filename>/etc/fstab</filename> para montar os sistemas de arquivos em <filename>ada0</filename>, e reinicie todo o procedimento novamente.</para>
      </important>

      <screen><prompt>#</prompt> <userinput>gmirror insert gm0 ada0</userinput>
GEOM_MIRROR: Device gm0: rebuilding provider ada0</screen>

      <para>A sincronização entre os dois discos será iniciada imediatamente. Use <command>gmirror status</command> para visualizar o progresso.</para>

      <screen><prompt>#</prompt> <userinput>gmirror status</userinput>
      Name    Status  Components
mirror/gm0  DEGRADED  ada1 (ACTIVE)
                      ada0 (SYNCHRONIZING, 64%)</screen>

      <para>Depois de um tempo, a sincronização será concluída.</para>

      <screen>GEOM_MIRROR: Device gm0: rebuilding provider ada0 finished.
<prompt>#</prompt> <userinput>gmirror status</userinput>
      Name    Status  Components
mirror/gm0  COMPLETE  ada1 (ACTIVE)
                      ada0 (ACTIVE)</screen>

      <para>O <filename>mirror/gm0</filename> agora consiste de dois discos <filename>ada0</filename> e <filename>ada1</filename>, e o conteúdo é automaticamente sincronizado entre eles. Em uso, o <filename>mirror/gm0</filename> irá se comportar como a única unidade original.</para>
    </sect2>

    <sect2 xml:id="gmirror-troubleshooting">
      <title>Solução de problemas</title>

      <para>Se o sistema não inicializar mais, as configurações da <acronym>BIOS</acronym> podem ter que ser alteradas para inicializar a partir de uma das novas unidades espelhadas. Qualquer uma das unidades espelhadas pode ser usada para inicializar, pois elas contêm dados idênticos.</para>

      <para>Se a inicialização parar com esta mensagem, algo está errado com o dispositivo espelhado:</para>

      <screen>Mounting from ufs:/dev/mirror/gm0s1a failed with error 19.

Loader variables:
  vfs.root.mountfrom=ufs:/dev/mirror/gm0s1a
  vfs.root.mountfrom.options=rw

Manual root filesystem specification:
  &lt;fstype&gt;:&lt;device&gt; [options]
      Mount &lt;device&gt; using filesystem &lt;fstype&gt;
      and with the specified (optional) option list.

    eg. ufs:/dev/da0s1a
        zfs:tank
        cd9660:/dev/acd0 ro
          (which is equivalent to: mount -t cd9660 -o ro /dev/acd0 /)

  ?               List valid disk boot devices
  .               Yield 1 second (for background tasks)
  &lt;empty line&gt;    Abort manual input

mountroot&gt;</screen>

      <para>Esquecer de carregar o módulo <filename>geom_mirror.ko</filename> no arquivo <filename>/boot/loader.conf</filename> pode causar este problema. Para consertá-lo, inicialize a partir de uma mídia de instalação do FreeBSD e escolha <literal>Shell</literal> no primeiro prompt. Em seguida, carregue o módulo de espelhamento e monte o dispositivo espelhado:</para>

      <screen><prompt>#</prompt> <userinput>gmirror load</userinput>
<prompt>#</prompt> <userinput>mount /dev/mirror/gm0s1a /mnt</userinput></screen>

      <para>Edite o arquivo <filename>/mnt/boot/loader.conf</filename>, adicionando uma linha para carregar o módulo de espelhamento:</para>

      <programlisting>geom_mirror_load="YES"</programlisting>

      <para>Salve o arquivo e reinicie.</para>

      <para>Outros problemas que causam o <errorname>error 19</errorname> requerem mais esforço para serem corrigidos. Embora o sistema deva inicializar a partir de <filename>ada0</filename>, outro prompt para selecionar um shell aparecerá se o arquivo <filename>/etc/fstab</filename> estiver incorreto. Digite <literal>ufs:/dev/ada0s1a</literal> no prompt do carregador de boot e pressione <keycap>Enter</keycap>. Desfaça as edições no arquivo <filename>/etc/fstab</filename> e monte os sistemas de arquivos a partir do disco original (<filename>ada0</filename>) em vez do espelhado. Reinicialize o sistema e tente o procedimento novamente.</para>

      <screen>Enter full pathname of shell or RETURN for /bin/sh:
<prompt>#</prompt> <userinput>cp /etc/fstab.orig /etc/fstab</userinput>
<prompt>#</prompt> <userinput>reboot</userinput></screen>
    </sect2>

    <sect2>
      <title>Recuperando de Uma Falha de Disco</title>

      <para>O benefício do espelhamento de disco é que um disco individual pode falhar sem fazer com que o espelho perca qualquer dado. No exemplo acima, se <filename>ada0</filename> falhar, o espelho continuará funcionando, fornecendo dados a partir do disco que continua operacional, <filename>ada1</filename>.</para>

      <para>Para substituir a unidade com falha, desligue o sistema e substitua fisicamente a unidade com falha por uma nova unidade com capacidade igual ou maior. Os fabricantes usam valores um tanto arbitrários ao classificar drives em gigabytes, e a única maneira de realmente ter certeza é comparar a contagem total de setores mostrados por <command>diskinfo -v</command>. Uma unidade com maior capacidade que o espelho funcionará, embora o espaço extra na nova unidade não seja usado.</para>

      <para>Depois que o computador for ligado novamente, o espelho será executado em um modo <quote>degradado</quote> com apenas uma unidade. O espelho é avisado para esquecer as unidades que não estão conectadas no momento:</para>

      <screen><prompt>#</prompt> <userinput>gmirror forget gm0</userinput></screen>

      <para>Quaisquer metadados antigos devem ser apagados do disco de substituição usando as instruções em <xref linkend="geom-mirror-metadata"/>. Em seguida, o disco de substituição, <filename>ada4</filename> para este exemplo, é inserido no espelho:</para>

      <screen><prompt>#</prompt> <userinput>gmirror insert gm0 /dev/ada4</userinput></screen>

      <para>A ressincronização começa quando a nova unidade é inserida no espelho. Esse processo de copiar dados espelhados para uma nova unidade pode demorar um pouco. O desempenho do espelho será bastante reduzido durante a cópia, portanto, a inserção de novos discos é deve ser executada quando houver pouca demanda no computador.</para>

      <para>O progresso pode ser monitorado com o comando <command>gmirror status </command>, que mostra as unidades que estão sendo sincronizadas e a porcentagem de conclusão. Durante a ressincronização, o status será <computeroutput>DEGRADED</computeroutput>, mudando para <computeroutput>COMPLETE</computeroutput> quando o processo for concluído.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="geom-raid3">
    <info>

      <title><acronym>RAID</acronym>3 - Distribuição em Nível de Byte com Paridade Dedicada</title>

      <authorgroup>
	<author><personname> <firstname>Mark</firstname> <surname>Gladman</surname> </personname> <contrib>Written by </contrib></author>

	<author><personname> <firstname>Daniel</firstname> <surname>Gerzo</surname> </personname></author>
      </authorgroup>

      <authorgroup>
	<author><personname> <firstname>Tom</firstname> <surname>Rhodes</surname> </personname> <contrib>Based on documentation by </contrib></author>

	<author><personname> <firstname>Murray</firstname> <surname>Stokely</surname> </personname></author>
      </authorgroup>
    </info>

    <indexterm><primary><acronym>GEOM</acronym></primary></indexterm>
    <indexterm><primary>RAID3</primary></indexterm>

    <para>O <acronym>RAID</acronym>3 é um método usado para combinar várias unidades de disco em um único volume com um disco de paridade dedicado. Em um sistema <acronym>RAID</acronym>3, os dados são divididos em vários bytes que são escritos em todas as unidades da matriz, exceto por um disco que atua como um disco de paridade dedicado. Isso significa que as leituras de disco de uma implementação de <acronym>RAID</acronym>3 acessam todos os discos na matriz. O desempenho pode ser aprimorado usando vários controladores de disco. O array <acronym>RAID</acronym>3 fornece uma tolerância a falhas de 1 unidade, enquanto fornece uma capacidade de 1 - 1/n vezes a capacidade total de todas as unidades no array, onde n é o número de unidades de disco rígido no  array. Essa configuração é adequada principalmente para armazenar dados de tamanhos maiores, como arquivos multimídia.</para>

    <para>Pelo menos 3 discos rígidos físicos são necessários para criar um array  <acronym>RAID</acronym>3. Cada disco deve ter o mesmo tamanho, pois as solicitações de <acronym>I/O</acronym> são intercaladas para ler ou gravar em vários discos em paralelo. Além disso, devido à natureza do  <acronym>RAID</acronym>3, o número de unidades deve ser igual a 3, 5, 9, 17 e assim por diante, ou 2^n + 1.</para>

    <para>Esta seção demonstra como criar um <acronym>RAID</acronym>3 via software em um sistema FreeBSD.</para>

    <note>
      <para>Embora seja teoricamente possível inicializar a partir de um array  <acronym>RAID</acronym>3 no FreeBSD, essa configuração é incomum e não é recomendada.</para>
    </note>

    <sect2>
      <title>Criando uma Matriz <acronym>RAID</acronym>3 Dedicada</title>

      <para>No FreeBSD, o suporte para <acronym>RAID</acronym>3 é implementado pela   classe <acronym>GEOM</acronym> <citerefentry><refentrytitle>graid3</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Criar um array dedicado de <acronym>RAID</acronym>3 no FreeBSD requer os seguintes passos.</para>

      <procedure>
	<step>
	  <para>Primeiro, carregue o módulo do kernel <filename>geom_raid3.ko</filename> emitindo um dos seguintes comandos:</para>

	  <screen><prompt>#</prompt> <userinput>graid3 load</userinput></screen>

	  <para>ou:</para>

	  <screen><prompt>#</prompt> <userinput>kldload geom_raid3</userinput></screen>
	</step>

	<step>
	  <para>Assegure-se de que exista um ponto de montagem adequado. Este comando cria um novo diretório para usar como ponto de montagem:</para>

	  <screen><prompt>#</prompt> <userinput>mkdir <replaceable>/multimedia</replaceable></userinput></screen>
	</step>

	<step>
	  <para>Determine os nomes dos dispositivos para os discos que serão adicionados à matriz e crie o novo dispositivo <acronym>RAID</acronym>3. O dispositivo final listado atuará como o disco de paridade dedicado. Este exemplo usa três unidades <acronym>ATA</acronym> não-particionadas: <filename><replaceable>ada1</replaceable></filename> e <filename><replaceable>ada2</replaceable></filename> para dados e <filename><replaceable>ada3</replaceable></filename> para paridade.</para>

	  <screen><prompt>#</prompt> <userinput>graid3 label -v gr0 /dev/ada1 /dev/ada2 /dev/ada3</userinput>
Metadata value stored on /dev/ada1.
Metadata value stored on /dev/ada2.
Metadata value stored on /dev/ada3.
Done.</screen>
	</step>

	<step>
	  <para>Particione o dispositivo <filename>gr0</filename> recém-criado e coloque um sistema de arquivos <acronym>UFS</acronym>:</para>

	  <screen><prompt>#</prompt> <userinput>gpart create -s GPT /dev/raid3/gr0</userinput>
<prompt>#</prompt> <userinput>gpart add -t freebsd-ufs /dev/raid3/gr0</userinput>
<prompt>#</prompt> <userinput>newfs -j /dev/raid3/gr0p1</userinput></screen>

	  <para>Muitos números irão ser exibios na tela e, após algum tempo, o processo será concluído. O volume foi criado e está pronto para ser montado:</para>

	  <screen><prompt>#</prompt> <userinput>mount /dev/raid3/gr0p1 /multimedia/</userinput></screen>

	  <para>A matriz <acronym>RAID</acronym>3 está agora pronta para uso.</para>
	</step>
      </procedure>

      <para>Uma configuração adicional é necessária para manter essa configuração nas reinicializações do sistema.</para>

      <procedure>
	<step>
	  <para>O módulo <filename>geom_raid3.ko</filename> deve ser carregado antes que o  array possa ser montado. Para carregar automaticamente o módulo do kernel durante a inicialização do sistema, adicione a seguinte linha ao arquivo <filename>/boot/loader.conf</filename>:</para>

	  <programlisting>geom_raid3_load="YES"</programlisting>
	</step>

	<step>
	  <para>As seguintes informações de volume devem ser adicionadas ao arquivo <filename>/etc/fstab</filename> para montar automaticamente o sistema de arquivos do array durante o processo de inicialização do sistema:</para>

	  <programlisting>/dev/raid3/gr0p1	/multimedia	ufs	rw	2	2</programlisting>
	</step>
      </procedure>
    </sect2>
  </sect1>

  <sect1 xml:id="geom-graid">
    <info>
      <title>Dispositivos <acronym>RAID</acronym> por Software</title>

      <authorgroup>
	<author><personname> <firstname>Warren</firstname> <surname>Block</surname> </personname> <contrib>Originalmente contribuído por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary><acronym>GEOM</acronym></primary></indexterm>
    <indexterm><primary>Software RAID Devices</primary> <secondary>Hardware-assisted RAID</secondary></indexterm>

    <para>Algumas placas-mãe e placas de expansão adicionam um hardware simples, geralmente apenas uma <acronym>ROM</acronym>, que permite que o computador inicialize a partir de um array <acronym>RAID</acronym>. Após a inicialização, o acesso ao array <acronym>RAID</acronym> é feito pelo software em execução no processador principal do computador. Este <quote><acronym>RAID</acronym> via software assistido por hardware</quote> fornece arrays <acronym>RAID</acronym> que não dependem de nenhum sistema operacional em particular, e que são funcionais antes mesmo de um sistema operacional ser carregado.</para>

    <para>Vários níveis de <acronym>RAID</acronym> são suportados, dependendo do hardware em uso. Veja <citerefentry><refentrytitle>graid</refentrytitle><manvolnum>8</manvolnum></citerefentry> para uma lista completa.</para>

    <para>O <citerefentry><refentrytitle>graid</refentrytitle><manvolnum>8</manvolnum></citerefentry> requer o módulo do kernel <filename>geom_raid.ko</filename>, que está incluído no kernel <filename>GENERIC</filename> a partir do FreeBSD 9.1. Se necessário, ele pode ser carregado manualmente com o comando <command>graid load</command>.</para>

    <sect2 xml:id="geom-graid-creating">
      <title>Criando um Array</title>

      <para>Os dispositivos de <acronym>RAID</acronym> via software geralmente têm um menu que pode ser acessado pressionando teclas especiais quando o computador está inicializando. O menu pode ser usado para criar e excluir arrays <acronym>RAID</acronym>. O <citerefentry><refentrytitle>graid</refentrytitle><manvolnum>8</manvolnum></citerefentry> também pode criar arrays diretamente a partir da linha de comando.</para>

      <para>O <command>graid label</command> é usado para criar um novo array. A placa-mãe usada neste exemplo tem um chipset <acronym>RAID</acronym> da Intel, portanto, o formato de metadados da Intel é especificado. A nova matriz recebe um rótulo de <filename>gm0</filename>, é um espelhamento (<acronym>RAID1</acronym>) e usa as unidades <filename>ada0</filename> e <filename>ada1</filename>.</para>

      <caution>
	<para>Algum espaço nas unidades será sobrescrito quando elas forem transformadas em um novo array. Faça o backup dos dados existentes primeiro!</para>
      </caution>

      <screen><prompt>#</prompt> <userinput>graid label Intel gm0 RAID1 ada0 ada1</userinput>
GEOM_RAID: Intel-a29ea104: Array Intel-a29ea104 created.
GEOM_RAID: Intel-a29ea104: Disk ada0 state changed from NONE to ACTIVE.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:0-ada0 state changed from NONE to ACTIVE.
GEOM_RAID: Intel-a29ea104: Disk ada1 state changed from NONE to ACTIVE.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:1-ada1 state changed from NONE to ACTIVE.
GEOM_RAID: Intel-a29ea104: Array started.
GEOM_RAID: Intel-a29ea104: Volume gm0 state changed from STARTING to OPTIMAL.
Intel-a29ea104 created
GEOM_RAID: Intel-a29ea104: Provider raid/r0 for volume gm0 created.</screen>

      <para>Uma verificação de status mostra que o novo espelhamento está pronto para uso:</para>

      <screen><prompt>#</prompt> <userinput>graid status</userinput>
   Name   Status  Components
raid/r0  OPTIMAL  ada0 (ACTIVE (ACTIVE))
                  ada1 (ACTIVE (ACTIVE))</screen>

      <para>O dispositivo de array aparece em <filename>/dev/raid/</filename>. O primeiro array é chamado de <filename>r0</filename>. Arrays adicionais, se presentes, serão <filename>r1</filename>, <filename>r2</filename> e assim por diante.</para>

      <para>O menu da <acronym>BIOS</acronym> em alguns desses dispositivos pode criar arrays com caracteres especiais em seus nomes. Para evitar problemas com esses caracteres especiais, os arrays recebem nomes numerados simples como <filename>r0</filename>. Para mostrar os rótulos reais, como <filename>gm0</filename> no exemplo acima, use o <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>:</para>

      <screen><prompt>#</prompt> <userinput>sysctl kern.geom.raid.name_format=1</userinput></screen>
    </sect2>

    <sect2 xml:id="geom-graid-volumes">
      <title>Múltiplos Volumes</title>

      <para>Alguns dispositivos de <acronym>RAID</acronym> via software suportam mais de um <emphasis>volume</emphasis> em um array. Os volumes funcionam como partições, permitindo que o espaço nas unidades físicas seja dividido e usado de diferentes maneiras. Por exemplo, os dispositivos <acronym>RAID</acronym> via software Intel suportam dois volumes. Este exemplo cria um espelho de 40 G para armazenar com segurança o sistema operacional, seguido por um volume de 20 G <acronym>RAID0</acronym> (stripe) para armazenamento temporário rápido:</para>

      <screen><prompt>#</prompt> <userinput>graid label -S 40G Intel gm0 RAID1 ada0 ada1</userinput>
<prompt>#</prompt> <userinput>graid add -S 20G gm0 RAID0</userinput></screen>

      <para>Os volumes aparecem como entradas adicionais <filename>r<replaceable>X</replaceable></filename> em <filename>/dev/raid/</filename>. Um array com dois volumes mostrará <filename>r0</filename> e <filename>r1</filename>.</para>

      <para>Veja <citerefentry><refentrytitle>graid</refentrytitle><manvolnum>8</manvolnum></citerefentry> para o número de volumes suportados por diferentes dispositivos <acronym>RAID</acronym> via software.</para>
    </sect2>

    <sect2 xml:id="geom-graid-converting">
      <title>Convertendo uma Única Unidade em um Espelho</title>

      <para>Sob certas condições específicas, é possível converter uma única unidade existente em um array <citerefentry><refentrytitle>graid</refentrytitle><manvolnum>8</manvolnum></citerefentry> sem reformatar. Para evitar a perda de dados durante a conversão, a unidade existente deve atender a esses requisitos mínimos:</para>

      <itemizedlist>
	<listitem>
	  <para>A unidade deve ser particionada com o esquema de particionamento <acronym>MBR</acronym>. O <acronym>GPT</acronym> ou outros esquemas de particionamento com metadados no final da unidade serão sobrescritos e corrompidos pelos metadados do <citerefentry><refentrytitle>graid</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
	</listitem>

	<listitem>
	  <para>Deve haver espaço não particionado e não utilizado o suficiente no final da unidade para conter os metadados do <citerefentry><refentrytitle>graid</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Esses metadados variam em tamanho, mas o maior ocupa 64 M, então pelo menos este espaço livre é recomendado.</para>
	</listitem>
      </itemizedlist>

      <para>Se a unidade atender a esses requisitos, comece fazendo um backup completo. Em seguida, crie um espelhamento de unidade única com essa unidade:</para>

      <screen><prompt>#</prompt> <userinput>graid label Intel gm0 RAID1 ada0 NONE</userinput></screen>

      <para>Os metadados do <citerefentry><refentrytitle>graid</refentrytitle><manvolnum>8</manvolnum></citerefentry> foram gravados no final da unidade no espaço não utilizado. Uma segunda unidade pode agora ser inserida no espelhamento:</para>

      <screen><prompt>#</prompt> <userinput>graid insert raid/r0 ada1</userinput></screen>

      <para>Os dados da unidade original começarão imediatamente a ser copiados para a segunda unidade. O espelhamento operará em status degradado até que a cópia seja concluída.</para>
    </sect2>

    <sect2 xml:id="geom-graid-inserting">
      <title>Inserindo Novos Discos no Array</title>

      <para>As unidades podem ser inseridas em uma matriz como substitutos de unidades que falharam ou estão faltando. Se não houver unidades com falha ou ausentes, a nova unidade se tornará uma reserva. Por exemplo, inserir uma nova unidade em um espelhamento de duas unidades de trabalho resulta em um espelhamento de duas unidades com uma unidade sobressalente, não em um espelhamento de três unidades.</para>

      <para>No array de espelho do exemplo, os dados começam a ser copiados imediatamente para a unidade recém-inserida. Qualquer informação existente na nova unidade será substituída.</para>

      <screen><prompt>#</prompt> <userinput>graid insert raid/r0 ada1</userinput>
GEOM_RAID: Intel-a29ea104: Disk ada1 state changed from NONE to ACTIVE.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:1-ada1 state changed from NONE to NEW.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:1-ada1 state changed from NEW to REBUILD.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:1-ada1 rebuild start at 0.</screen>
    </sect2>

    <sect2 xml:id="geom-graid-removing">
      <title>Removendo Discos do Array</title>

      <para>Discos individuais podem ser permanentemente removidos de um array e seus metadados apagados:</para>

      <screen><prompt>#</prompt> <userinput>graid remove raid/r0 ada1</userinput>
GEOM_RAID: Intel-a29ea104: Disk ada1 state changed from ACTIVE to OFFLINE.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:1-[unknown] state changed from ACTIVE to NONE.
GEOM_RAID: Intel-a29ea104: Volume gm0 state changed from OPTIMAL to DEGRADED.</screen>
    </sect2>

    <sect2 xml:id="geom-graid-stopping">
      <title>Parando o Array</title>

      <para>Um array pode ser interrompido sem remover os metadados das unidades. O array será reiniciado quando o sistema for inicializado.</para>

      <screen><prompt>#</prompt> <userinput>graid stop raid/r0</userinput></screen>
    </sect2>

    <sect2 xml:id="geom-graid-status">
      <title>Verificando o Status do Array</title>

      <para>O status do array pode ser verificado a qualquer momento. Depois que um  disco foi adicionado ao espelho no exemplo acima, os dados estarão sendo copiados do  disco original para o novo disco:</para>

      <screen><prompt>#</prompt> <userinput>graid status</userinput>
   Name    Status  Components
raid/r0  DEGRADED  ada0 (ACTIVE (ACTIVE))
                   ada1 (ACTIVE (REBUILD 28%))</screen>

      <para>Alguns tipos de arrays, como <literal>RAID0</literal> ou <literal>CONCAT</literal>, podem não ser mostrados no relatório de status se os discos falharem. Para ver esses arrays com falhas parciais, adicione <option>-ga</option>:</para>

      <screen><prompt>#</prompt> <userinput>graid status -ga</userinput>
          Name  Status  Components
Intel-e2d07d9a  BROKEN  ada6 (ACTIVE (ACTIVE))</screen>
    </sect2>

    <sect2 xml:id="geom-graid-deleting">
      <title>Excluindo Arrays</title>

      <para>Arrays são destruídos, excluindo todos os volumes deles. Quando o último volume presente é excluído, o array é interrompido e os metadados são removidos dos discos:</para>

      <screen><prompt>#</prompt> <userinput>graid delete raid/r0</userinput></screen>
    </sect2>

    <sect2 xml:id="geom-graid-unexpected">
      <title>Excluindo Arrays Inesperados</title>

      <para>Os discos podem conter metadados <citerefentry><refentrytitle>graid</refentrytitle><manvolnum>8</manvolnum></citerefentry> inesperados, originados no seu uso anterior ou em testes do fabricante. O  <citerefentry><refentrytitle>graid</refentrytitle><manvolnum>8</manvolnum></citerefentry> detectará estes discos e criará um array, interferindo no acesso ao  disco individual. Para remover os metadados indesejados:</para>

      <procedure>
	<step>
	  <para>Inicialize o sistema. No menu de inicialização, selecione <literal>2</literal> para o prompt do utilitário de boot. Entre:</para>

	  <screen>OK <userinput>set kern.geom.raid.enable=0</userinput>
OK <userinput>boot</userinput></screen>

	  <para>O sistema inicializará com o <citerefentry><refentrytitle>graid</refentrytitle><manvolnum>8</manvolnum></citerefentry> desativado.</para>
	</step>

	<step>
	  <para>Fazer backup de todos os dados na unidade afetada.</para>
	</step>

	<step>
	  <para>Como solução alternativa, a detecção de arrays <citerefentry><refentrytitle>graid</refentrytitle><manvolnum>8</manvolnum></citerefentry> pode ser desativada incluindo se a variável</para>

	  <programlisting>kern.geom.raid.enable=0</programlisting>

	  <para>no arquivo <filename>/boot/loader.conf</filename>.</para>

	  <para>Para remover permanentemente os metadados <citerefentry><refentrytitle>graid</refentrytitle><manvolnum>8</manvolnum></citerefentry> do  disco afetado, inicialize uma instalação do FreeBSD usando um <acronym>CD-ROM</acronym> ou um memory stick e selecione a opção <literal>Shell</literal>. Use o comando <command>status</command> para encontrar o nome do array, normalmente <literal>raid/r0</literal>:</para>

	  <screen><prompt>#</prompt> <userinput>graid status</userinput>
   Name   Status  Components
raid/r0  OPTIMAL  ada0 (ACTIVE (ACTIVE))
                  ada1 (ACTIVE (ACTIVE))</screen>

	  <para>Exclua o volume pelo nome:</para>

	  <screen><prompt>#</prompt> <userinput>graid delete raid/r0</userinput></screen>

	  <para>Se houver mais de um volume exibido, repita o processo para cada volume. Após o último array ter sido excluído, o volume será destruído.</para>

	  <para>Reinicialize e verifique os dados, restaurando a partir do backup, se necessário. Depois que os metadados forem removidos, a entrada <literal>kern.geom.raid.enable=0</literal> no arquivo <filename>/boot/loader.conf</filename> também pode ser removida.</para>
	</step>
      </procedure>
    </sect2>
  </sect1>

  <sect1 xml:id="geom-ggate">
    <title><acronym>GEOM</acronym> Network Gate</title>

    <para>O <acronym>GEOM</acronym> fornece um mecanismo simples para fornecer acesso remoto a dispositivos como discos, <acronym>CD</acronym>s e sistemas de arquivos através do uso do daemon <acronym>GEOM</acronym> Network Gate, <application>ggated</application>. O sistema com o dispositivo executa o daemon do servidor que manipula solicitações feitas por clientes usando o <application>ggatec</application>. Os dispositivos não devem conter dados confidenciais, pois a conexão entre o cliente e o servidor não é criptografada.</para>

    <para>Semelhante ao <acronym>NFS</acronym>, que é discutido em <xref linkend="network-nfs"/>, o <application>ggated</application> é configurado usando um arquivo de exportação. Este arquivo especifica quais sistemas têm permissão para acessar os recursos exportados e em qual nível de acesso eles são oferecidos. Por exemplo, para fornecer ao cliente <systemitem class="ipaddress">192.168.1.5</systemitem> acesso de leitura e gravação à quarta slice do primeiro disco <acronym>SCSI</acronym>, crie o arquivo  <filename>/etc/gg.exports</filename> com esta linha:</para>

    <programlisting>192.168.1.5 RW /dev/da0s4d</programlisting>

    <para>Antes de exportar o dispositivo, verifique se ele não está montado no momento. Em seguida, inicie o <application>ggated</application>:</para>

    <screen><prompt>#</prompt> <userinput>ggated</userinput></screen>

    <para>Várias opções estão disponíveis para especificar uma porta de escuta alternativa ou para alterar o local padrão do arquivo de exportação. Consulte <citerefentry><refentrytitle>ggated</refentrytitle><manvolnum>8</manvolnum></citerefentry> para maiores detalhes.</para>

    <para>Para acessar o dispositivo exportado na máquina cliente, primeiro use o comando <command>ggatec</command> para especificar o endereço <acronym>IP</acronym> do servidor e o nome do dispositivo exportado. Se bem sucedido, este comando irá exibir um nome de dispositivo <literal>ggate</literal> para montar. Monte esse nome de dispositivo especificado em um ponto de montagem livre. Este exemplo conecta-se à partição <filename>/dev/da0s4d</filename> no <literal>192.168.1.1</literal>, em seguida, monta o <filename>/dev/ggate0</filename> em <filename>/mnt</filename>:</para>

    <screen><prompt>#</prompt> <userinput>ggatec create -o rw 192.168.1.1 /dev/da0s4d</userinput>
ggate0
<prompt>#</prompt> <userinput>mount /dev/ggate0 /mnt</userinput></screen>

    <para>O dispositivo no servidor pode agora ser acessado por meio do  <filename>/mnt</filename> no cliente. Para maiores detalhes sobre o  <command>ggatec</command> e alguns exemplos de uso, consulte <citerefentry><refentrytitle>ggatec</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>

    <note>
      <para>A montagem falhará se o dispositivo estiver atualmente montado no servidor ou em qualquer outro cliente na rede. Se for necessário acesso simultâneo aos recursos de rede, use o <acronym>NFS</acronym>.</para>
    </note>

    <para>Quando o dispositivo não for mais necessário, desmonte-o com o <command>umount</command> para que o recurso fique disponível para outros clientes.</para>
  </sect1>

  <sect1 xml:id="geom-glabel">
    <title>Rotulando Dispositivos de Disco</title>

    <indexterm><primary><acronym>GEOM</acronym></primary></indexterm>
    <indexterm><primary>Disk Labels</primary></indexterm>

    <para>Durante a inicialização do sistema, o kernel do FreeBSD cria nós de dispositivos conforme os dispositivos são encontrados. Esse método de detectar dispositivos gera alguns problemas. Por exemplo, e se um novo dispositivo de disco for adicionado via <acronym>USB</acronym>? É provável que um dispositivo flash receba o nome do dispositivo <filename>da0</filename> e o <filename>da0</filename> original alterado para <filename>da1</filename>. Isso causará problemas ao montar sistemas de arquivos se eles estiverem listados no <filename>/etc/fstab</filename>, o que também pode impedir que o sistema seja inicializado.</para>

    <para>Uma solução é encadear os dispositivos <acronym>SCSI</acronym> para que um novo dispositivo adicionado à placa <acronym>SCSI</acronym> receba números de dispositivo não utilizados. Mas e os dispositivos <acronym>USB</acronym> que podem substituir o disco principal <acronym>SCSI</acronym>? Isso acontece porque os dispositivos <acronym>USB</acronym> geralmente são examinados antes da placa <acronym>SCSI</acronym>. Uma solução é inserir esses dispositivos apenas após o sistema ter sido inicializado. Outro método é usar apenas uma única unidade <acronym>ATA</acronym> e nunca listar os dispositivos <acronym>SCSI</acronym> no arquivo <filename>/etc/fstab</filename>.</para>

    <para>Uma solução melhor é usar o <command>glabel</command> para rotular os dispositivos de disco e usar os rótulos no arquivo <filename>/etc/fstab</filename>. Como o <command>glabel</command> armazena o rótulo no último setor de um determinado provedor, o rótulo permanecerá persistente nas reinicializações. Ao usar esse rótulo como um dispositivo, o sistema de arquivos pode sempre ser montado independentemente do nó do dispositivo pelo qual ele é acessado.</para>

    <note>
      <para>O <command>glabel</command> pode criar rótulos transitórios e permanentes. Somente rótulos permanentes são consistentes nas reinicializações. Consulte <citerefentry><refentrytitle>glabel</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter mais informações sobre as diferenças entre os rótulos.</para>
    </note>

    <sect2>
      <title>Tipos de Rótulos e Exemplos</title>

      <para>Os rótulos permanentes podem ser um rótulo genérico ou de um sistema de arquivos. Rótulos de sistema de arquivos permanentes podem ser criados com <citerefentry><refentrytitle>tunefs</refentrytitle><manvolnum>8</manvolnum></citerefentry> ou <citerefentry><refentrytitle>newfs</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Esses tipos de rótulos são criados em um subdiretório <filename>/dev</filename> e serão nomeados de acordo com o tipo de sistema de arquivos. Por exemplo, os rótulos do sistema de arquivos <acronym>UFS</acronym>2 serão criados em <filename>/dev/ufs</filename>. Rótulos permanentes genéricos podem ser criados com o <command>glabel label</command>. Estes não são específicos do sistema de arquivos e serão criados em <filename>/dev/label</filename>.</para>

      <para>Os rótulos temporários são destruídos na próxima reinicialização. Esses rótulos são criados em <filename>/dev/label</filename> e são adequados para experimentação. Um rótulo temporário pode ser criado usando <command>glabel create</command>.</para>

<!-- XXXTR: How do you create a file system label without running newfs
	    or when there is no newfs (e.g.: cd9660)? -->

      <para>Para criar um rótulo permanente para um sistema de arquivos <acronym>UFS</acronym>2 sem destruir nenhum dado, emita o seguinte comando:</para>

      <screen><prompt>#</prompt> <userinput>tunefs -L <replaceable>home</replaceable> <replaceable>/dev/da3</replaceable></userinput></screen>

      <para>Um rótulo deve agora existir em <filename>/dev/ufs</filename> que pode ser adicionado ao arquivo <filename>/etc/fstab</filename>:</para>

      <programlisting>/dev/ufs/home		/home            ufs     rw              2      2</programlisting>

      <note>
	<para>O sistema de arquivos não deve ser montado durante a tentativa de executar o <command>tunefs</command>.</para>
      </note>

      <para>Agora o sistema de arquivos pode ser montado:</para>

      <screen><prompt>#</prompt> <userinput>mount /home</userinput></screen>

      <para>A partir deste ponto, desde que o módulo do kernel <filename>geom_label.ko</filename> seja carregado na inicialização com o <filename>/boot/loader.conf</filename> ou com a opção do kernel <literal>GEOM_LABEL</literal> estando presente, o nó do dispositivo pode mudar sem qualquer efeito negativo no sistema.</para>

      <para>Os sistemas de arquivos também podem ser criados com um rótulo padrão usando a flag <option>-L</option> com o comando <command>newfs</command>. Consulte <citerefentry><refentrytitle>newfs</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter maiores informações.</para>

      <para>O seguinte comando pode ser usado para destruir o rótulo:</para>

      <screen><prompt>#</prompt> <userinput>glabel destroy home</userinput></screen>

      <para>O exemplo a seguir mostra como rotular as partições de um disco de inicialização.</para>

      <example>
	<title>Rotulando Partições no Disco de Inicialização</title>

	<para>Ao marcar permanentemente as partições no disco de inicialização, o sistema deve poder continuar a inicializar normalmente, mesmo se o disco for movido para outro controlador ou transferido para um sistema diferente. Para este exemplo, presume-se que um único disco <acronym>ATA</acronym> é usado, que é atualmente reconhecido pelo sistema como <filename>ad0</filename>. Também é assumido que o esquema de partição padrão do FreeBSD é usado, com <filename>/</filename>, <filename>/var </filename>, <filename>/usr</filename> e <filename>/tmp</filename>, bem como uma partição de swap.</para>

	<para>Reinicialize o sistema e, no prompt do <citerefentry><refentrytitle>loader</refentrytitle><manvolnum>8</manvolnum></citerefentry>, pressione <keycap>4</keycap> para inicializar no modo de usuário único. Em seguida, insira os seguintes comandos:</para>

	<screen><prompt>#</prompt> <userinput>glabel label rootfs /dev/ad0s1a</userinput>
GEOM_LABEL: Label for provider /dev/ad0s1a is label/rootfs
<prompt>#</prompt> <userinput>glabel label var /dev/ad0s1d</userinput>
GEOM_LABEL: Label for provider /dev/ad0s1d is label/var
<prompt>#</prompt> <userinput>glabel label usr /dev/ad0s1f</userinput>
GEOM_LABEL: Label for provider /dev/ad0s1f is label/usr
<prompt>#</prompt> <userinput>glabel label tmp /dev/ad0s1e</userinput>
GEOM_LABEL: Label for provider /dev/ad0s1e is label/tmp
<prompt>#</prompt> <userinput>glabel label swap /dev/ad0s1b</userinput>
GEOM_LABEL: Label for provider /dev/ad0s1b is label/swap
<prompt>#</prompt> <userinput>exit</userinput></screen>

	<para>O sistema continuará com a inicialização multiusuário. Depois que a inicialização terminar, edite o arquivo <filename>/etc/fstab</filename> e substitua os nomes de dispositivos convencionais por seus respectivos rótulos. No final o <filename>/etc/fstab</filename> ficará assim:</para>

	<programlisting># Device                Mountpoint      FStype  Options         Dump    Pass#
/dev/label/swap         none            swap    sw              0       0
/dev/label/rootfs       /               ufs     rw              1       1
/dev/label/tmp          /tmp            ufs     rw              2       2
/dev/label/usr          /usr            ufs     rw              2       2
/dev/label/var          /var            ufs     rw              2       2</programlisting>

	<para>O sistema agora pode ser reinicializado. Se tudo correr bem, ele aparecerá normalmente e o comando <command>mount</command> mostrará:</para>

	<screen><prompt>#</prompt> <userinput>mount</userinput>
/dev/label/rootfs on / (ufs, local)
devfs on /dev (devfs, local)
/dev/label/tmp on /tmp (ufs, local, soft-updates)
/dev/label/usr on /usr (ufs, local, soft-updates)
/dev/label/var on /var (ufs, local, soft-updates)</screen>
      </example>

      <para>A classe <citerefentry><refentrytitle>glabel</refentrytitle><manvolnum>8</manvolnum></citerefentry> suporta um tipo de rótulo para sistemas de arquivos <acronym>UFS</acronym>, com base no ID do sistema de arquivos exclusivo <literal>ufsid</literal>. Esses rótulos podem ser encontrados em <filename>/dev/ufsid</filename> e são criados automaticamente durante a inicialização do sistema. É possível usar rótulos <literal>ufsid</literal> para montar partições usando o <filename>/etc/fstab</filename>. Use o <command>glabel status</command> para receber uma lista de sistemas de arquivos e seus rótulos <literal>ufsid</literal> correspondentes:</para>

      <screen><prompt>%</prompt> <userinput>glabel status</userinput>
                  Name  Status  Components
ufsid/486b6fc38d330916     N/A  ad4s1d
ufsid/486b6fc16926168e     N/A  ad4s1f</screen>

      <para>No exemplo acima, <filename>ad4s1d</filename> representa <filename>/var</filename>, enquanto <filename>ad4s1f</filename> representa <filename>/usr</filename>. Usando os valores <literal>ufsid</literal> mostrados, essas partições podem agora ser montadas com as seguintes entradas em <filename>/etc/fstab</filename>:</para>

      <programlisting>/dev/ufsid/486b6fc38d330916        /var        ufs        rw        2      2
/dev/ufsid/486b6fc16926168e        /usr        ufs        rw        2      2</programlisting>

      <para>Quaisquer partições com rótulos <literal>ufsid</literal> podem ser montadas dessa forma, eliminando a necessidade de criar manualmente rótulos permanentes, enquanto ainda desfruta dos benefícios da montagem independente do nome do dispositivo.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="geom-gjournal">
    <title>Journaling UFS através do <acronym> GEOM </acronym></title>

    <indexterm><primary><acronym>GEOM</acronym></primary></indexterm>
    <indexterm><primary>Journaling</primary></indexterm>

    <para>Suporte para journaling em sistemas de arquivos <acronym>UFS</acronym> está disponível no FreeBSD. A implementação é fornecida através do subsistema <acronym>GEOM</acronym> e é configurada usando o comando <command>gjournal</command>. Ao contrário de outras implementações de journaling de sistemas de arquivos, o método <command>gjournal</command> é baseado em blocos e não é implementado como parte do sistema de arquivos. É uma extensão do <acronym>GEOM</acronym>.</para>

    <para>O jornaling armazena um log de transações do sistema de arquivos, como alterações que compõem uma operação de gravação em disco completa, antes que os metadados e as gravações de arquivos sejam confirmados no disco. Esse log de transação pode ser repetido posteriormente para refazer as transações do sistema de arquivos, evitando inconsistências no sistema de arquivos.</para>

    <para>Esse método fornece outro mecanismo para proteger contra perda de dados e inconsistências do sistema de arquivos. Ao contrário das Soft Updates, que rastreiam e impõem atualizações de metadados e snapshots, que criam uma imagem do sistema de arquivos, um log é armazenado no espaço em disco especificamente para essa tarefa. Para melhor desempenho, o journal pode ser armazenado em outro disco. Nessa configuração, o provedor do journal ou o dispositivo de armazenamento deve ser listado após o dispositivo para ativar o journaling.</para>

    <para>O kernel <filename>GENERIC</filename> fornece suporte para o <command>gjournal</command>. Para carregar automaticamente o módulo do kernel <filename>geom_journal.ko</filename> no momento da inicialização, adicione a seguinte linha ao arquivo <filename>/boot/loader.conf</filename>:</para>

    <programlisting>geom_journal_load="YES"</programlisting>

    <para>Se um kernel personalizado for usado, certifique-se de que a linha a seguir esteja no arquivo de configuração do kernel:</para>

    <programlisting>options	GEOM_JOURNAL</programlisting>

    <para>Depois que o módulo é carregado, um journal pode ser criado em um novo sistema de arquivos usando as etapas a seguir. Neste exemplo, <filename>da4</filename> é um novo disco <acronym>SCSI</acronym>:</para>

    <screen><prompt>#</prompt> <userinput>gjournal load</userinput>
<prompt>#</prompt> <userinput>gjournal label /dev/<replaceable>da4</replaceable></userinput></screen>

    <para>Isto irá carregar o módulo e criar um nó de dispositivo <filename>/dev/da4.journal</filename> em <filename>/dev/da4</filename>.</para>

    <para>Um sistema de arquivos <acronym>UFS</acronym> pode agora ser criado no dispositivo journaled e depois montado em um ponto de montagem existente:</para>

    <screen><prompt>#</prompt> <userinput>newfs -O 2 -J /dev/<replaceable>da4</replaceable>.journal</userinput>
<prompt>#</prompt> <userinput>mount /dev/<replaceable>da4</replaceable>.journal <replaceable>/mnt</replaceable></userinput></screen>

    <note>
      <para>No caso de várias slices, será criado um journal para cada slice individual. Por exemplo, se <filename>ad4s1</filename> e <filename>ad4s2</filename> forem slices, o <command>gjournal</command> criará <filename>ad4s1.journal</filename> e <filename>ad4s2.journal</filename>.</para>
    </note>

    <para>O journaling também pode ser ativado nos sistemas de arquivos atuais usando o  <command>tunefs</command>. No entanto, <emphasis>sempre</emphasis> faça um backup antes de tentar alterar um sistema de arquivos existente. Na maioria dos casos, o <command>gjournal</command> falhará se não for possível criar o registro de log, mas isso não protege contra a perda de dados incorrida como resultado do uso indevido do <command>tunefs</command>. Consulte <citerefentry><refentrytitle>gjournal</refentrytitle><manvolnum>8</manvolnum></citerefentry> e <citerefentry><refentrytitle>tunefs</refentrytitle><manvolnum>8</manvolnum></citerefentry> para maiores informações sobre esses comandos.</para>

    <para>É possível fazer o journaling do disco de inicialização de um sistema FreeBSD. Consulte o artigo <link xlink:href="@@URL_RELPREFIX@@/doc/en_US.ISO8859-1/articles/gjournal-desktop">Implementando o journaling do UFS em um PC de mesa</link> para obter instruções detalhadas.</para>
  </sect1>
</chapter>

    
<!--
     The FreeBSD Documentation Project
     $FreeBSD$
-->

<chapter version="5.0" xml:id="zfs">

  <info>
    <title>O sistema de arquivos Z (<acronym>ZFS</acronym>)</title>

    <authorgroup>
      <author><personname><firstname>Tom</firstname> <surname>Rhodes</surname></personname><contrib>Escrito por</contrib></author>
      <author><personname> <firstname> Allan </firstname> <surname> Jude </surname> </personname> <contrib> Escrito por </contrib></author>
      <author><personname> <firstname> Benedict </firstname> <surname> Reuschling </surname> </personname> <contrib> Escrito por </contrib></author>
      <author><personname> <firstname> Warren </firstname> <surname> Block </surname> </personname> <contrib> Escrito por </contrib></author>
    </authorgroup>
  </info>

  <para>O <emphasis>Sistema de Arquivos Z</emphasis>, ou <acronym>ZFS</acronym>, é um sistema de arquivos avançado projetado para superar muitos dos principais problemas encontrados em projetos anteriores.</para>

  <para>Originalmente desenvolvido pela <trademark>Sun</trademark>, o desenvolvimento contínuo do <acronym>ZFS</acronym> em código aberto foi movido para o <link xlink:href="http://open-zfs.org">Projeto OpenZFS</link>.</para>

  <para>O <acronym>ZFS</acronym> tem três metas principais de design:</para>

  <itemizedlist>
    <listitem>
      <para>Integridade de dados: Todos os dados incluem um <link linkend="zfs-term-checksum">checksum</link> dos dados. Quando os dados são gravados, o checksum é calculado e gravado junto com eles. Quando esses dados são lidos posteriormente, o checksum é calculado novamente. Se os checksum's não corresponderem, um erro de dados foi detectado. O <acronym>ZFS</acronym> tentará corrigir automaticamente os erros quando houver redundância de dados disponível.</para>
    </listitem>

    <listitem>
      <para>Armazenamento em pool: os dispositivos de armazenamento físico são adicionados em um pool e o espaço de armazenamento é alocado a partir desse pool compartilhado. O espaço está disponível para todos os sistemas de arquivos e pode ser aumentado pela adição de novos dispositivos de armazenamento ao pool.</para>
    </listitem>

    <listitem>
      <para>Performance: vários mecanismos de cache fornecem uma maior performance. O <link linkend="zfs-term-arc">ARC</link> é um avançado cache de leitura baseado em memória. Um segundo nível de cache de leitura baseado em disco pode ser adicionado com o <link linkend="zfs-term-l2arc">L2ARC</link>, e o cache síncrono de escrita baseado em disco está disponível com <link linkend="zfs-term-zil">ZIL</link>.</para>
    </listitem>
  </itemizedlist>

  <para>Uma lista completa de features e terminologias é mostrada em <xref linkend="zfs-term"/>.</para>

  <sect1 xml:id="zfs-differences">
    <title>O que torna o <acronym>ZFS</acronym> diferente</title>

    <para>O <acronym>ZFS</acronym> é significativamente diferente de qualquer outro sistema de arquivos existente, porque ele é mais do que apenas um simples sistema de arquivos. A combinação das funções tradicionalmente separadas de gerenciamento de volume e de sistema de arquivos, fornece ao <acronym>ZFS</acronym> vantagens exclusivas. O sistema de arquivos agora conhece a estrutura abaixo dos discos. Os sistemas de arquivos tradicionais só podem ser criados em um único disco por vez. Se houvesse dois discos, dois sistemas de arquivos separados teriam que ser criados. Em uma configuração de hardware tradicional <acronym>RAID</acronym>, esse problema foi contornado apresentando ao sistema operacional um único disco lógico composto pelo espaço fornecido por vários discos físicos, sobre o qual o sistema operacional colocava um sistema de arquivos. Mesmo no caso de soluções de software <acronym>RAID</acronym> como as fornecidas pelo <acronym>GEOM</acronym>, o sistema de arquivos <acronym>UFS</acronym>, que está no topo da transformação <acronym>RAID</acronym>, acreditava que estava lidando com um único dispositivo físico. A combinação feita pelo <acronym>ZFS</acronym> do gerenciador de volumes e do sistema de arquivos resolve isso e permite a criação de vários sistemas de arquivos, todos compartilhando um pool de armazenamento disponível. Uma das maiores vantagens do reconhecimento do layout físico dos discos pelo <acronym>ZFS</acronym> é que os sistemas de arquivos existentes podem ser expandidos automaticamente quando novos discos são adicionados ao pool. Esse novo espaço é disponibilizado para todos os sistemas de arquivos. O <acronym>ZFS</acronym> também possui várias propriedades diferentes que podem ser aplicadas a cada sistema de arquivos, oferecendo muitas vantagens para a criação de vários sistemas de arquivos e datasets diferentes, em vez de um único sistema de arquivos monolítico.</para>
  </sect1>

  <sect1 xml:id="zfs-quickstart">
    <title>Guia de Início Rápido</title>

    <para>Existe um mecanismo de inicialização que permite ao FreeBSD montar pools do <acronym>ZFS</acronym> durante a inicialização do sistema. Para habilitá-lo, adicione esta linha ao <filename>/etc/rc.conf</filename>:</para>

    <programlisting>zfs_enable="YES"</programlisting>

    <para>Então inicie o serviço:</para>

    <screen><prompt>#</prompt> <userinput>service zfs start</userinput></screen>

    <para>Os exemplos nesta seção assumem três discos <acronym>SCSI</acronym> com os seguintes nomes de dispositivo <filename><replaceable>da0</replaceable></filename>, <filename><replaceable>da1</replaceable></filename> e <filename><replaceable>da2</replaceable></filename>. Usuários de hardware do tipo <acronym>SATA</acronym> devem usar nomes de dispositivo <filename><replaceable>ada</replaceable></filename>.</para>

    <sect2 xml:id="zfs-quickstart-single-disk-pool">
      <title>Pool de Disco Único</title>

      <para>Para criar um pool simples e não-redundante usando um único disco:</para>

      <screen><prompt>#</prompt> <userinput>zpool create <replaceable>example</replaceable> <replaceable>/dev/da0</replaceable></userinput></screen>

      <para>Para visualizar o novo pool, verifique a saída do comando <command>df</command>:</para>

      <screen><prompt>#</prompt> <userinput>df</userinput>
Filesystem  1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a   2026030  235230  1628718    13%    /
devfs               1       1        0   100%    /dev
/dev/ad0s1d  54098308 1032846 48737598     2%    /usr
example      17547136       0 17547136     0%    /example</screen>

      <para>Esta saída mostra que o pool <literal>example</literal> foi criado e montado e agora está acessível como um sistema de arquivos. Arquivos podem ser criados nele e os usuários podem navegar nele:</para>

      <screen><prompt>#</prompt> <userinput>cd /example</userinput>
<prompt>#</prompt> <userinput>ls</userinput>
<prompt>#</prompt> <userinput>touch testfile</userinput>
<prompt>#</prompt> <userinput>ls -al</userinput>
total 4
drwxr-xr-x   2 root  wheel    3 Aug 29 23:15 .
drwxr-xr-x  21 root  wheel  512 Aug 29 23:12 ..
-rw-r--r--   1 root  wheel    0 Aug 29 23:15 testfile</screen>

      <para>No entanto, esse pool não está aproveitando nenhuma feature do <acronym>ZFS</acronym>. Para criar um dataset neste pool com a compressão ativada:</para>

      <screen><prompt>#</prompt> <userinput>zfs create example/compressed</userinput>
<prompt>#</prompt> <userinput>zfs set compression=gzip example/compressed</userinput></screen>

      <para>O dataset <literal>example/compressed</literal> é agora um sistema de arquivos <acronym>ZFS</acronym> compactado. Tente copiar alguns arquivos grandes para <filename>/example/compressed</filename>.</para>

      <para>A compactação pode ser desativada com:</para>

      <screen><prompt>#</prompt> <userinput>zfs set compression=off example/compressed</userinput></screen>

      <para>Para desmontar um sistema de arquivos, use <command>zfs umount </command> e, em seguida, verifique com <command>df</command>:</para>

      <screen><prompt>#</prompt> <userinput>zfs umount example/compressed</userinput>
<prompt>#</prompt> <userinput>df</userinput>
Filesystem  1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a   2026030  235232  1628716    13%    /
devfs               1       1        0   100%    /dev
/dev/ad0s1d  54098308 1032864 48737580     2%    /usr
example      17547008       0 17547008     0%    /example</screen>

      <para>Para remontar o sistema de arquivos para torná-lo acessível novamente, use <command>zfs mount</command> e verifique com o <command>df</command>:</para>

      <screen><prompt>#</prompt> <userinput>zfs mount example/compressed</userinput>
<prompt>#</prompt> <userinput>df</userinput>
Filesystem         1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a          2026030  235234  1628714    13%    /
devfs                      1       1        0   100%    /dev
/dev/ad0s1d         54098308 1032864 48737580     2%    /usr
example             17547008       0 17547008     0%    /example
example/compressed  17547008       0 17547008     0%    /example/compressed</screen>

      <para>O pool e o sistema de arquivos também podem ser observados visualizando a saída do comando <command>mount</command>:</para>

      <screen><prompt>#</prompt> <userinput>mount</userinput>
/dev/ad0s1a on / (ufs, local)
devfs on /dev (devfs, local)
/dev/ad0s1d on /usr (ufs, local, soft-updates)
example on /example (zfs, local)
example/compressed on /example/compressed (zfs, local)</screen>

      <para>Após a criação, os datasets do <acronym>ZFS</acronym> podem ser usados como qualquer sistema de arquivos. No entanto, muitos outros recursos estão disponíveis, e podem ser definidos por conjunto de dados. No exemplo abaixo, um novo sistema de arquivos chamado <literal>data</literal> é criado. Arquivos importantes serão armazenados nele, portanto, ele é configurado para manter duas cópias de cada bloco de dados:</para>

      <screen><prompt>#</prompt> <userinput>zfs create example/data</userinput>
<prompt>#</prompt> <userinput>zfs set copies=2 example/data</userinput></screen>

      <para>Agora é possível ver o sistema de arquivos <literal>data</literal> e o espaço utilizado através do comando <command>df</command>:</para>

      <screen><prompt>#</prompt> <userinput>df</userinput>
Filesystem         1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a          2026030  235234  1628714    13%    /
devfs                      1       1        0   100%    /dev
/dev/ad0s1d         54098308 1032864 48737580     2%    /usr
example             17547008       0 17547008     0%    /example
example/compressed  17547008       0 17547008     0%    /example/compressed
example/data        17547008       0 17547008     0%    /example/data</screen>

      <para>Observe que cada sistema de arquivos no pool tem a mesma quantidade de espaço disponível. Esta é a razão para usar o <command>df</command> nestes exemplos, para mostrar que os sistemas de arquivos usam apenas a quantidade de espaço de que precisam e todos utilizam o mesmo pool. O <acronym>ZFS</acronym> elimina conceitos como volumes e partições e permite que vários sistemas de arquivos ocupem o mesmo pool.</para>

      <para>Para destruir os sistemas de arquivos e, em seguida, destruir o pool, se ele não for mais necessário:</para>

      <screen><prompt>#</prompt> <userinput>zfs destroy example/compressed</userinput>
<prompt>#</prompt> <userinput>zfs destroy example/data</userinput>
<prompt>#</prompt> <userinput>zpool destroy example</userinput></screen>
    </sect2>

    <sect2 xml:id="zfs-quickstart-raid-z">
      <title>RAID-Z</title>

      <para>Discos falham. Um método para evitar perda de dados devido a falhas no disco é implementar <acronym>RAID</acronym>. O <acronym>ZFS</acronym> suporta esse recurso em seu design de pool. Os pools <acronym>RAID-Z</acronym> exigem três ou mais discos, mas fornecem mais espaço utilizável do que os pools espelhados.</para>

      <para>Este exemplo cria um pool <acronym>RAID-Z</acronym>, especificando os discos a serem adicionados ao pool:</para>

      <screen><prompt>#</prompt> <userinput>zpool create storage raidz da0 da1 da2</userinput></screen>

      <note>
	<para>A <trademark>Sun</trademark> recomenda que o número de dispositivos usados em uma configuração <acronym>RAID</acronym>-Z seja entre três e nove. Para ambientes que exigem um único conjunto de 10 discos ou mais, considere dividi-lo em grupos menores de <acronym>RAID-Z</acronym>. Se apenas dois discos estiverem disponíveis e a redundância for um requisito, considere usar o <acronym>ZFS</acronym> mirror. Consulte <citerefentry><refentrytitle>zpool</refentrytitle><manvolnum>8 </manvolnum> </citerefentry> para obter maiores detalhes.</para>
      </note>

      <para>O exemplo anterior criou o zpool <literal>storage</literal>. Este exemplo cria um novo sistema de arquivos chamado <literal>home</literal> neste pool:</para>

      <screen><prompt>#</prompt> <userinput>zfs create storage/home</userinput></screen>

      <para>A compressão e a criação de cópias extras de diretórios e arquivos podem ser ativadas:</para>

      <screen><prompt>#</prompt> <userinput>zfs set copies=2 storage/home</userinput>
<prompt>#</prompt> <userinput>zfs set compression=gzip storage/home</userinput></screen>

      <para>Para tornar este o novo diretório home para usuários, copie os dados de usuários para este diretório e crie os links simbólicos apropriados:</para>

      <screen><prompt>#</prompt> <userinput>cp -rp /home/* /storage/home</userinput>
<prompt>#</prompt> <userinput>rm -rf /home /usr/home</userinput>
<prompt>#</prompt> <userinput>ln -s /storage/home /home</userinput>
<prompt>#</prompt> <userinput>ln -s /storage/home /usr/home</userinput></screen>

      <para>Os dados dos usuários agora são armazenados no recém-criado diretório <filename>/storage/home</filename>. Teste adicionando um novo usuário e efetuando login como este usuário.</para>

      <para>Tente criar um snapshot do sistema de arquivos que possa ser revertido posteriormente:</para>

      <screen><prompt>#</prompt> <userinput>zfs snapshot storage/home@08-30-08</userinput></screen>

      <para>Os snapshots só podem ser realizados de um sistema de arquivos completo, não de um único diretório ou arquivo.</para>

      <para>O caractere <literal>@</literal> é um delimitador entre o nome do sistema de arquivos ou o nome do volume. Se um diretório importante tiver sido excluído acidentalmente, o backup do sistema de arquivos poderá ser feito e, em seguida, revertido para um snapshot anterior, quando o diretório ainda existia:</para>

      <screen><prompt>#</prompt> <userinput>zfs rollback storage/home@08-30-08</userinput></screen>

      <para>Para listar todos os snapshots disponíveis, execute <command>ls</command> no diretório <filename>.zfs/snapshot </filename> no sistema de arquivos. Por exemplo, para ver o snapshot obtido anteriormente:</para>

      <screen><prompt>#</prompt> <userinput>ls /storage/home/.zfs/snapshot</userinput></screen>

      <para>É possível escrever um script para criar snapshots frequentes dos dados do usuário. No entanto, com o tempo, os snapshots podem consumir muito espaço em disco. O snapshot anterior pode ser removido usando o comando:</para>

      <screen><prompt>#</prompt> <userinput>zfs destroy storage/home@08-30-08</userinput></screen>

      <para>Após o teste, <filename>/storage/home</filename> pode ser o verdadeiro <filename>/home</filename> usando este comando:</para>

      <screen><prompt>#</prompt> <userinput>zfs set mountpoint=/home storage/home</userinput></screen>

      <para>Execute o <command>df</command> e o <command>mount</command> para confirmar que o sistema agora trata o sistema de arquivos como o real <filename>/home</filename>:</para>

      <screen><prompt>#</prompt> <userinput>mount</userinput>
/dev/ad0s1a on / (ufs, local)
devfs on /dev (devfs, local)
/dev/ad0s1d on /usr (ufs, local, soft-updates)
storage on /storage (zfs, local)
storage/home on /home (zfs, local)
<prompt>#</prompt> <userinput>df</userinput>
Filesystem   1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a    2026030  235240  1628708    13%    /
devfs                1       1        0   100%    /dev
/dev/ad0s1d   54098308 1032826 48737618     2%    /usr
storage       26320512       0 26320512     0%    /storage
storage/home  26320512       0 26320512     0%    /home</screen>

      <para>Isso conclui a configuração do <acronym>RAID-Z</acronym>. Atualizações de status diárias sobre os sistemas de arquivos criados podem ser geradas como parte das execuções noturnas do<citerefentry><refentrytitle>periodic</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Adicione esta linha ao <filename> /etc/periodic.conf </filename>:</para>

      <programlisting>daily_status_zfs_enable="YES"</programlisting>
    </sect2>

    <sect2 xml:id="zfs-quickstart-recovering-raid-z">
      <title>Recuperando o <acronym>RAID-Z</acronym></title>

      <para>Todo software <acronym> RAID </acronym> tem um método de monitorar seu <literal> status </literal>. O status dos dispositivos <acronym> RAID-Z </acronym> pode ser visualizado com este comando:</para>

      <screen><prompt>#</prompt> <userinput>zpool status -x</userinput></screen>

      <para>Se todos os pools estiverem <link linkend="zfs-term-online">Online</link> e tudo estiver normal, a mensagem mostrará:</para>

      <screen>all pools are healthy</screen>

      <para>Se houver um problema, talvez um disco que esteja no estado <link linkend="zfs-term-offline">Offline</link>, o status do pool será semelhante a:</para>

      <screen>  pool: storage
 state: DEGRADED
status: One or more devices has been taken offline by the administrator.
	Sufficient replicas exist for the pool to continue functioning in a
	degraded state.
action: Online the device using 'zpool online' or replace the device with
	'zpool replace'.
 scrub: none requested
config:

	NAME        STATE     READ WRITE CKSUM
	storage     DEGRADED     0     0     0
	  raidz1    DEGRADED     0     0     0
	    da0     ONLINE       0     0     0
	    da1     OFFLINE      0     0     0
	    da2     ONLINE       0     0     0

errors: No known data errors</screen>

      <para>Isso indica que o dispositivo foi colocado off-line anteriormente pelo administrador com este comando:</para>

      <screen><prompt>#</prompt> <userinput>zpool offline storage da1</userinput></screen>

      <para>Agora o sistema pode ser desligado para substituir o <filename>da1</filename>. Quando o sistema estiver novamente online, o disco com falha poderá ser substituído no pool:</para>

      <screen><prompt>#</prompt> <userinput>zpool replace storage da1</userinput></screen>

      <para>Agora, o status pode ser verificado novamente, desta vez sem <option>-x</option>, para que todos os pools sejam mostrados:</para>

      <screen><prompt>#</prompt> <userinput>zpool status storage</userinput>
 pool: storage
 state: ONLINE
 scrub: resilver completed with 0 errors on Sat Aug 30 19:44:11 2008
config:

	NAME        STATE     READ WRITE CKSUM
	storage     ONLINE       0     0     0
	  raidz1    ONLINE       0     0     0
	    da0     ONLINE       0     0     0
	    da1     ONLINE       0     0     0
	    da2     ONLINE       0     0     0

errors: No known data errors</screen>

      <para>Neste exemplo, tudo está normal.</para>
    </sect2>

    <sect2 xml:id="zfs-quickstart-data-verification">
      <title>Verificação de dados</title>

      <para>O <acronym>ZFS</acronym> utiliza checksums para verificar a integridade dos dados armazenados. Estes são ativados automaticamente na criação dos sistemas de arquivos.</para>

      <warning>
	<para>Os checksums podem ser desabilitados, mas isto <emphasis>não</emphasis> é recomendado! Os checksums ocupam muito pouco espaço de armazenamento e fornecem integridade dos dados. Muitos recursos do <acronym>ZFS</acronym> não funcionarão adequadamente com os checksums desabilitados. Não há nenhum ganho perceptível de desempenho ao desativar os checksums.</para>
      </warning>

      <para>A verificação de checksum é conhecida como <emphasis>scrubbing</emphasis>. Verifique a integridade dos dados do pool <literal>storage</literal> com este comando:</para>

      <screen><prompt>#</prompt> <userinput>zpool scrub storage</userinput></screen>

      <para>A duração de um scrub depende da quantidade de dados armazenados. Quantidades maiores de dados levarão proporcionalmente mais tempo para serem verificadas. Scrubs utilizam muito <acronym>I/O</acronym>, e apenas um scrub tem permissão para ser executado por vez. Após a conclusão do scrub, o status pode ser visualizado com <command>status</command>:</para>

      <screen><prompt>#</prompt> <userinput>zpool status storage</userinput>
 pool: storage
 state: ONLINE
 scrub: scrub completed with 0 errors on Sat Jan 26 19:57:37 2013
config:

	NAME        STATE     READ WRITE CKSUM
	storage     ONLINE       0     0     0
	  raidz1    ONLINE       0     0     0
	    da0     ONLINE       0     0     0
	    da1     ONLINE       0     0     0
	    da2     ONLINE       0     0     0

errors: No known data errors</screen>

      <para>A data de conclusão da última operação de scrub é exibida para ajudar a rastrear quando outro scrub é necessário. Uma rotina recorrente de scrubs ajuda a proteger os dados contra corrupção silenciosa e garante a integridade do pool.</para>

      <para>Consulte <citerefentry><refentrytitle>zfs</refentrytitle><manvolnum>8</manvolnum></citerefentry> e <citerefentry><refentrytitle>zpool</refentrytitle><manvolnum>8</manvolnum></citerefentry>  para outras opções do <acronym>ZFS</acronym>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="zfs-zpool">
    <title>Administração <command>zpool</command></title>

    <para>A administração do <acronym>ZFS</acronym> é dividida entre dois utilitários principais. O utilitário <command>zpool</command> controla a operação do pool e trata da adição, remoção, substituição e gerenciamento de discos. O utilitário <link linkend="zfs-zfs"><command>zfs</command></link> lida com a criação, destruição e gerenciamento de datasets, tanto para <link linkend="zfs-term-filesystem">sistemas de arquivos</link> quanto para  <link linkend="zfs-term-volume">volumes</link>.</para>

    <sect2 xml:id="zfs-zpool-create">
      <title>Criando e destruindo pools de armazenamento</title>

      <para>A criação de um pool de armazenamento do <acronym>ZFS</acronym> (<emphasis>zpool</emphasis>) envolve a tomada de várias decisões que são relativamente permanentes porque a estrutura do pool não pode ser alterada depois que o pool é criado. A decisão mais importante é quais tipos de vdevs usar para agrupar os discos físicos. Consulte a lista de <link linkend="zfs-term-vdev">tipos vdev</link> para obter detalhes sobre as opções possíveis. Após o pool ter sido criado, a maioria dos tipos de vdev não permite que discos adicionais sejam adicionados ao vdev. As exceções são os mirrors, que permitem que discos adicionais sejam adicionados ao vdev, e stripes, que podem ser atualizados para mirrors ao anexar um disco adicional ao vdev. Embora vdevs adicionais possam ser adicionados para expandir um pool, o layout do pool não pode ser alterado após a criação do pool. Em vez disso, os dados devem ser salvos em um backup e o pool destruído e recriado.</para>

      <para>Crie um pool do tipo mirror simples:</para>

      <screen><prompt>#</prompt> <userinput>zpool create <replaceable>mypool</replaceable> mirror <replaceable>/dev/ada1</replaceable> <replaceable>/dev/ada2</replaceable></userinput>
<prompt>#</prompt> <userinput>zpool status</userinput>
  pool: mypool
 state: ONLINE
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada1    ONLINE       0     0     0
            ada2    ONLINE       0     0     0

errors: No known data errors</screen>

      <para>Vários vdevs podem ser criados de uma só vez. Especifique vários grupos de discos separados pela palavra-chave do tipo vdev, <literal>mirror</literal> neste exemplo:</para>

      <screen><prompt>#</prompt> <userinput>zpool create <replaceable>mypool</replaceable> mirror <replaceable>/dev/ada1</replaceable> <replaceable>/dev/ada2</replaceable> mirror <replaceable>/dev/ada3</replaceable> <replaceable>/dev/ada4</replaceable></userinput>
<prompt>#</prompt> <userinput>zpool status</userinput>
  pool: mypool
 state: ONLINE
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada1    ONLINE       0     0     0
            ada2    ONLINE       0     0     0
          mirror-1  ONLINE       0     0     0
            ada3    ONLINE       0     0     0
            ada4    ONLINE       0     0     0

errors: No known data errors</screen>

      <para>Os pools também podem ser construídos usando partições em vez de discos inteiros. Colocar o <acronym>ZFS</acronym> em uma partição separada permite que o mesmo disco tenha outras partições para outras finalidades. Em particular, partições com bootcode e sistemas de arquivos necessários para a inicialização podem ser adicionadas. Isso permite inicializar a partir de discos que também são membros de um pool. Não há penalidade de desempenho no FreeBSD ao usar uma partição em vez de um disco inteiro. O uso de partições também permite ao administrador <emphasis>sub-provisionar</emphasis> os discos, usando menos que a capacidade total. Se um disco de substituição futuro com o mesmo tamanho nominal do original tiver uma capacidade ligeiramente menor, a partição menor ainda se ajustará e o disco de substituição ainda poderá ser usado.</para>

      <para>Crie um pool <link linkend="zfs-term-vdev-raidz">RAID-Z2</link> usando partições:</para>

      <screen><prompt>#</prompt> <userinput>zpool create <replaceable>mypool</replaceable> raidz2 <replaceable>/dev/ada0p3</replaceable> <replaceable>/dev/ada1p3</replaceable> <replaceable>/dev/ada2p3</replaceable> <replaceable>/dev/ada3p3</replaceable> <replaceable>/dev/ada4p3</replaceable> <replaceable>/dev/ada5p3</replaceable></userinput>
<prompt>#</prompt> <userinput>zpool status</userinput>
  pool: mypool
 state: ONLINE
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          raidz2-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0
            ada3p3  ONLINE       0     0     0
            ada4p3  ONLINE       0     0     0
            ada5p3  ONLINE       0     0     0

errors: No known data errors</screen>

      <para>Um pool que não é mais necessário pode ser destruído para que os discos possam ser reutilizados. Destruir um pool envolve primeiro desmontar todos os datasets nesse pool. Se os datasets estiverem em uso, a operação de desmontagem falhará e o pool não será destruído. A destruição do pool pode ser forçada com <option>-f</option>, mas isso pode causar um comportamento indefinido em aplicações que tiverem arquivos abertos nesses datasets.</para>
    </sect2>

    <sect2 xml:id="zfs-zpool-attach">
      <title>Adicionando e Removendo Dispositivos</title>

      <para>Existem dois casos para adicionar discos a um zpool: anexar um disco a um vdev existente com <command> zpool attach </command> ou incluir vdevs ao pool com <command> zpool add </command>. Apenas alguns <link linkend="zfs-term-vdev">vdev types</link> permitem que discos sejam adicionados ao vdev após a criação.</para>

      <para>Um pool criado com um único disco não tem redundância. Dados corrompidos podem ser detectados, mas não reparados, porque não há outra cópia dos dados. A propriedade <link linkend="zfs-term-copies">copies</link> pode ser capaz de se recuperar de uma pequena falha, como um setor defeituoso, mas não fornece o mesmo nível de proteção que o mirror ou o <acronym>RAID-Z</acronym>. Começando com um pool de um único disco vdev, o <command>zpool attach</command> pode ser usado para adicionar um disco adicional ao vdev, criando um mirror. O <command> zpool attach </command> também pode ser usado para adicionar discos adicionais a um mirror group, aumentando a redundância e o desempenho de leitura. Se os discos usados para o pool forem particionados, replicar o layout do primeiro disco para o segundo, <command> gpart backup </command> e <command> gpart restore </command> pode ser usado para facilitar esse processo .</para>

      <para>Atualize o disco único (stripe) vdev <replaceable>ada0p3</replaceable> para um mirror anexando <replaceable>ada1p3</replaceable>:</para>

      <screen><prompt>#</prompt> <userinput>zpool status</userinput>
  pool: mypool
 state: ONLINE
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          ada0p3    ONLINE       0     0     0

errors: No known data errors
<prompt>#</prompt> <userinput>zpool attach <replaceable>mypool</replaceable> <replaceable>ada0p3</replaceable> <replaceable>ada1p3</replaceable></userinput>
Make sure to wait until resilver is done before rebooting.

If you boot from pool 'mypool', you may need to update
boot code on newly attached disk 'ada1p3'.

Assuming you use GPT partitioning and 'da0' is your new boot disk
you may use the following command:

        gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 da0
<prompt>#</prompt> <userinput>gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 <replaceable>ada1</replaceable></userinput>
bootcode written to ada1
<prompt>#</prompt> <userinput>zpool status</userinput>
  pool: mypool
 state: ONLINE
status: One or more devices is currently being resilvered.  The pool will
        continue to function, possibly in a degraded state.
action: Wait for the resilver to complete.
  scan: resilver in progress since Fri May 30 08:19:19 2014
        527M scanned out of 781M at 47.9M/s, 0h0m to go
        527M resilvered, 67.53% done
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0  (resilvering)

errors: No known data errors
<prompt>#</prompt> <userinput>zpool status</userinput>
  pool: mypool
 state: ONLINE
  scan: resilvered 781M in 0h0m with 0 errors on Fri May 30 08:15:58 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0

errors: No known data errors</screen>

      <para>Quando adicionar discos ao vdev existente não é uma opção, como para <acronym>RAID-Z</acronym>, um método alternativo é adicionar outro vdev ao pool. Vdevs adicionais fornecem desempenho mais alto, distribuindo as operações de escrita nos vdevs. Cada vdev é responsável por fornecer a sua própria redundância. É possível, mas desencorajado, misturar tipos de vdev, como <literal>mirror</literal> e <literal>RAID-Z</literal>. Adicionar um vdev não-redundante a um pool que contenha um vdev mirror ou o <acronym>RAID-Z</acronym> arrisca os dados em todo o pool. As gravações são distribuídas, portanto, a falha do disco não-redundante resultará na perda de uma fração de cada bloco que foi gravado no pool.</para>

      <para>Os dados são distribuídos em cada um dos vdevs. Por exemplo, com dois vdevs mirror, esse é efetivamente um <acronym>RAID</acronym> 10 que escreve em dois conjuntos de mirrors. O espaço é alocado de forma que cada vdev chegue a 100% de uso ao mesmo tempo. Há uma penalidade de desempenho se os vdevs tiverem quantidades diferentes de espaço livre, pois uma quantidade desproporcional dos dados é gravada no vdev menos cheio.</para>

      <para>Ao anexar dispositivos adicionais a um pool de inicialização, lembre-se de atualizar o bootcode.</para>

      <para>Anexe um segundo grupo de mirror's (<filename>ada2p3</filename> and <filename>ada3p3</filename>) ao mirror existente:</para>

      <screen><prompt>#</prompt> <userinput>zpool status</userinput>
  pool: mypool
 state: ONLINE
  scan: resilvered 781M in 0h0m with 0 errors on Fri May 30 08:19:35 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0

errors: No known data errors
<prompt>#</prompt> <userinput>zpool add <replaceable>mypool</replaceable> mirror <replaceable>ada2p3</replaceable> <replaceable>ada3p3</replaceable></userinput>
<prompt>#</prompt> <userinput>gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 <replaceable>ada2</replaceable></userinput>
bootcode written to ada2
<prompt>#</prompt> <userinput>gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 <replaceable>ada3</replaceable></userinput>
bootcode written to ada3
<prompt>#</prompt> <userinput>zpool status</userinput>
  pool: mypool
 state: ONLINE
  scan: scrub repaired 0 in 0h0m with 0 errors on Fri May 30 08:29:51 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0
          mirror-1  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0
            ada3p3  ONLINE       0     0     0

errors: No known data errors</screen>

      <para>Atualmente, os vdevs não podem ser removidos de um pool e os discos só podem ser removidos de um mirror se houver redundância restante suficiente. Se apenas um disco em um grupo de mirror's permanecer, ele deixará de ser um mirror e voltará a ser um srtipe, arriscando todo o pool se o disco restante falhar.</para>

      <para>Remova um disco de um grupo de mirror's triplo:</para>

      <screen><prompt>#</prompt> <userinput>zpool status</userinput>
  pool: mypool
 state: ONLINE
  scan: scrub repaired 0 in 0h0m with 0 errors on Fri May 30 08:29:51 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0

errors: No known data errors
<prompt>#</prompt> <userinput>zpool detach <replaceable>mypool</replaceable> <replaceable>ada2p3</replaceable></userinput>
<prompt>#</prompt> <userinput>zpool status</userinput>
  pool: mypool
 state: ONLINE
  scan: scrub repaired 0 in 0h0m with 0 errors on Fri May 30 08:29:51 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0

errors: No known data errors</screen>
    </sect2>

    <sect2 xml:id="zfs-zpool-status">
      <title>Verificando o status de um pool</title>

      <para>O status do pool é importante. Se uma unidade ficar off-line ou for detectado um erro de leitura, gravação ou de checksum, a contagem de erros correspondente aumentará. A saída <command> status </command> mostra a configuração e o status de cada dispositivo no pool e o status de todo o pool. Ações que precisam ser tomadas e detalhes sobre o último <link linkend="zfs-zpool-scrub"><command>scrub</command></link> também são mostrados.</para>

      <screen><prompt>#</prompt> <userinput>zpool status</userinput>
  pool: mypool
 state: ONLINE
  scan: scrub repaired 0 in 2h25m with 0 errors on Sat Sep 14 04:25:50 2013
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          raidz2-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0
            ada3p3  ONLINE       0     0     0
            ada4p3  ONLINE       0     0     0
            ada5p3  ONLINE       0     0     0

errors: No known data errors</screen>
    </sect2>

    <sect2 xml:id="zfs-zpool-clear">
      <title>Limpando Erros</title>

      <para>Quando um erro é detectado, os contadores de leitura, escrita ou checksum são incrementados. A mensagem de erro pode ser apagada e os contadores resetados com <command>zpool clear <replaceable>mypool</replaceable></command>. Limpar o estado de erro pode ser importante para scripts automatizados que alertam o administrador quando o pool encontra um erro. Erros adicionais podem não ser relatados se os erros antigos não forem apagados.</para>
    </sect2>

    <sect2 xml:id="zfs-zpool-replace">
      <title>Substituindo um dispositivo em funcionamento</title>

      <para>Há várias situações em que pode ser desejável substituir um disco por um disco diferente. Ao substituir um disco em funcionamento, o processo mantém o disco antigo online durante a substituição. O pool nunca entra no estado <link linkend="zfs-term-degraded"> degradado </link>, reduzindo o risco de perda de dados. <command> zpool replace </command> copia todos os dados do disco antigo para o novo. Após a conclusão da operação, o disco antigo é desconectado do vdev. Se o novo disco for maior que o disco antigo, pode ser possível aumentar o zpool usando o novo espaço. Veja <link linkend="zfs-zpool-online"> Aumentando um Pool </link>.</para>

      <para>Substitua um dispositivo em funcionamento no pool:</para>

      <screen><prompt>#</prompt> <userinput>zpool status</userinput>
  pool: mypool
 state: ONLINE
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0

errors: No known data errors
<prompt>#</prompt> <userinput>zpool replace <replaceable>mypool</replaceable> <replaceable>ada1p3</replaceable> <replaceable>ada2p3</replaceable></userinput>
Make sure to wait until resilver is done before rebooting.

If you boot from pool 'zroot', you may need to update
boot code on newly attached disk 'ada2p3'.

Assuming you use GPT partitioning and 'da0' is your new boot disk
you may use the following command:

        gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 da0
<prompt>#</prompt> <userinput>gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 <replaceable>ada2</replaceable></userinput>
<prompt>#</prompt> <userinput>zpool status</userinput>
  pool: mypool
 state: ONLINE
status: One or more devices is currently being resilvered.  The pool will
        continue to function, possibly in a degraded state.
action: Wait for the resilver to complete.
  scan: resilver in progress since Mon Jun  2 14:21:35 2014
        604M scanned out of 781M at 46.5M/s, 0h0m to go
        604M resilvered, 77.39% done
config:

        NAME             STATE     READ WRITE CKSUM
        mypool           ONLINE       0     0     0
          mirror-0       ONLINE       0     0     0
            ada0p3       ONLINE       0     0     0
            replacing-1  ONLINE       0     0     0
              ada1p3     ONLINE       0     0     0
              ada2p3     ONLINE       0     0     0  (resilvering)

errors: No known data errors
<prompt>#</prompt> <userinput>zpool status</userinput>
  pool: mypool
 state: ONLINE
  scan: resilvered 781M in 0h0m with 0 errors on Mon Jun  2 14:21:52 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0

errors: No known data errors</screen>
    </sect2>

    <sect2 xml:id="zfs-zpool-resilver">
      <title>Lidando com dispositivos com falha</title>

      <para>Quando um disco em um pool falha, o vdev ao qual o disco pertence entra no estado <link linkend="zfs-term-degraded">degradado</link>. Todos os dados ainda estão disponíveis, mas o desempenho pode ser reduzido porque os dados ausentes devem ser calculados a partir da redundância disponível. Para restaurar o vdev para um estado totalmente funcional, o dispositivo físico com falha deve ser substituído. O <acronym>ZFS</acronym> é então instruído a iniciar a operação <link linkend="zfs-term-resilver">resilver</link>. Os dados que estavam no dispositivo com falha são recalculados da redundância disponível e gravados no dispositivo de substituição. Após a conclusão, o vdev retorna ao status <link linkend="zfs-term-online">online</link>.</para>

      <para>Se o vdev não tiver redundância, ou se vários dispositivos falharem e não houver redundância suficiente para compensar, o pool entrará no estado <link linkend="zfs-term-faulted">failed</link>. Se um número suficiente de dispositivos não puder ser reconectado ao pool, o pool se tornará inoperante e os dados deverão ser restaurados dos backups.</para>

      <para>Ao substituir um disco com falha, o nome do disco com falha é substituído pelo <acronym>GUID</acronym> do dispositivo. Um novo parâmetro de nome de dispositivo para o <command>zpool replace</command> não é necessário se o dispositivo de substituição tiver o mesmo nome de dispositivo.</para>

      <para>Substitua um disco com falha usando o <command>zpool replace</command>:</para>

      <screen><prompt>#</prompt> <userinput>zpool status</userinput>
  pool: mypool
 state: DEGRADED
status: One or more devices could not be opened.  Sufficient replicas exist for
        the pool to continue functioning in a degraded state.
action: Attach the missing device and online it using 'zpool online'.
   see: http://illumos.org/msg/ZFS-8000-2Q
  scan: none requested
config:

        NAME                    STATE     READ WRITE CKSUM
        mypool                  DEGRADED     0     0     0
          mirror-0              DEGRADED     0     0     0
            ada0p3              ONLINE       0     0     0
            316502962686821739  UNAVAIL      0     0     0  was /dev/ada1p3

errors: No known data errors
<prompt>#</prompt> <userinput>zpool replace <replaceable>mypool</replaceable> <replaceable>316502962686821739</replaceable> <replaceable>ada2p3</replaceable></userinput>
<prompt>#</prompt> <userinput>zpool status</userinput>
  pool: mypool
 state: DEGRADED
status: One or more devices is currently being resilvered.  The pool will
        continue to function, possibly in a degraded state.
action: Wait for the resilver to complete.
  scan: resilver in progress since Mon Jun  2 14:52:21 2014
        641M scanned out of 781M at 49.3M/s, 0h0m to go
        640M resilvered, 82.04% done
config:

        NAME                        STATE     READ WRITE CKSUM
        mypool                      DEGRADED     0     0     0
          mirror-0                  DEGRADED     0     0     0
            ada0p3                  ONLINE       0     0     0
            replacing-1             UNAVAIL      0     0     0
              15732067398082357289  UNAVAIL      0     0     0  was /dev/ada1p3/old
              ada2p3                ONLINE       0     0     0  (resilvering)

errors: No known data errors
<prompt>#</prompt> <userinput>zpool status</userinput>
  pool: mypool
 state: ONLINE
  scan: resilvered 781M in 0h0m with 0 errors on Mon Jun  2 14:52:38 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0

errors: No known data errors</screen>
    </sect2>

    <sect2 xml:id="zfs-zpool-scrub">
      <title>Limpeza do Pool</title>

      <para>Recomenda-se que os pools sejam regularmente <link linkend="zfs-term-scrub">scrubbed</link>, idealmente pelo menos uma vez por mês. A operação <command>scrub</command> requer muito disco e reduzirá o desempenho durante a execução. Evite períodos de alta demanda ao agendar o <command>scrub</command> ou use <link linkend="zfs-advanced-tuning-scrub_delay"><varname>vfs.zfs.scrub_delay</varname></link> para ajustar a  prioridade relativa do <command>scrub</command> para evitar que ele interfira com outras cargas de trabalho.</para>

      <screen><prompt>#</prompt> <userinput>zpool scrub <replaceable>mypool</replaceable></userinput>
<prompt>#</prompt> <userinput>zpool status</userinput>
  pool: mypool
 state: ONLINE
  scan: scrub in progress since Wed Feb 19 20:52:54 2014
        116G scanned out of 8.60T at 649M/s, 3h48m to go
        0 repaired, 1.32% done
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          raidz2-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0
            ada3p3  ONLINE       0     0     0
            ada4p3  ONLINE       0     0     0
            ada5p3  ONLINE       0     0     0

errors: No known data errors</screen>

      <para>No caso de uma operação de limpeza precisar ser cancelada, emita <command>zpool scrub -s <replaceable>mypool</replaceable></command>.</para>
    </sect2>

    <sect2 xml:id="zfs-zpool-selfheal">
      <title>Auto Cura (Self-Healing)</title>

      <para>Os checksums armazenados com os blocos de dados habilitam o sistema de arquivos a se <emphasis>autocorrigirem</emphasis>. Esse recurso reparará automaticamente os dados cujo checksum não corresponde à registrada em outro dispositivo que faz parte do pool de armazenamento. Por exemplo, um espelho com dois discos em que uma unidade está começando a funcionar incorretamente e não pode armazenar os dados adequadamente. Isso é ainda pior quando os dados não são acessados há muito tempo, como no armazenamento de arquivos de longo prazo. Os sistemas de arquivos tradicionais precisam executar algoritmos que verificam e reparam os dados como o <citerefentry><refentrytitle>fsck</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Esses comandos levam tempo e, em casos graves, um administrador precisa decidir manualmente qual operação de reparo deve ser executada. Quando o <acronym>ZFS</acronym> detecta um bloco de dados com um checksum que não corresponde, ele tenta ler os dados do disco de espelhamento. Se esse disco puder fornecer os dados corretos, ele não apenas fornecerá esses dados ao aplicativo que os está solicitando, mas também corrigirá os dados errados no disco que continha o checksum incorreto. Isso acontece sem qualquer interação de um administrador do sistema durante a operação normal do pool.</para>

      <para>O próximo exemplo demonstra esse comportamento de autocura. Um conjunto espelhado de discos <filename>/dev/ada0</filename> e <filename>/dev/ada1</filename> é criado.</para>

      <screen><prompt>#</prompt> <userinput>zpool create <replaceable>healer</replaceable> mirror <replaceable>/dev/ada0</replaceable> <replaceable>/dev/ada1</replaceable></userinput>
<prompt>#</prompt> <userinput>zpool status <replaceable>healer</replaceable></userinput>
  pool: healer
 state: ONLINE
  scan: none requested
config:

    NAME        STATE     READ WRITE CKSUM
    healer      ONLINE       0     0     0
      mirror-0  ONLINE       0     0     0
       ada0     ONLINE       0     0     0
       ada1     ONLINE       0     0     0

errors: No known data errors
<prompt>#</prompt> <userinput>zpool list</userinput>
NAME     SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG   CAP  DEDUP  HEALTH  ALTROOT
healer   960M  92.5K   960M         -         -     0%    0%  1.00x  ONLINE  -</screen>

      <para>Alguns dados importantes que devem ser protegidos de erros de dados usando o recurso de correção automática são copiados para o pool. É criado um checksum do pool para comparação posterior.</para>

      <screen><prompt>#</prompt> <userinput>cp /some/important/data /healer</userinput>
<prompt>#</prompt> <userinput>zfs list</userinput>
NAME     SIZE  ALLOC   FREE    CAP  DEDUP  HEALTH  ALTROOT
healer   960M  67.7M   892M     7%  1.00x  ONLINE  -
<prompt>#</prompt> <userinput>sha1 /healer &gt; checksum.txt</userinput>
<prompt>#</prompt> <userinput>cat checksum.txt</userinput>
SHA1 (/healer) = 2753eff56d77d9a536ece6694bf0a82740344d1f</screen>

      <para>A corrupção de dados é simulada escrevendo dados aleatórios no início de um dos discos no espelho. Para evitar que o <acronym>ZFS</acronym> cure os dados assim que forem detectados, o pool é exportado antes da corrupção e importado novamente depois.</para>

      <warning>
	<para>Esta é uma operação perigosa que pode destruir dados vitais. Ele é mostrado aqui apenas para fins demonstrativos e não deve ser tentado durante a operação normal de um pool de armazenamento. Nem este exemplo de corrupção intencional deve ser executado em qualquer disco com um sistema de arquivos diferente. Não use outros nomes de dispositivos de disco diferentes daqueles que fazem parte do pool. Certifique-se de que os backups apropriados do pool sejam criados antes de executar o comando!</para>
      </warning>

      <screen><prompt>#</prompt> <userinput>zpool export <replaceable>healer</replaceable></userinput>
<prompt>#</prompt> <userinput>dd if=/dev/random of=/dev/ada1 bs=1m count=200</userinput>
200+0 records in
200+0 records out
209715200 bytes transferred in 62.992162 secs (3329227 bytes/sec)
<prompt>#</prompt> <userinput>zpool import healer</userinput></screen>

      <para>O status do pool mostra que um dispositivo teve um erro. Observe que os aplicativos que leem dados do pool não receberam dados incorretos. O <acronym>ZFS</acronym> forneceu dados do dispositivo <filename>ada0</filename> com os checksums corretos. O dispositivo com o checksum incorreto pode ser encontrado facilmente, pois a coluna <literal>CKSUM</literal> contém um valor diferente de zero.</para>

      <screen><prompt>#</prompt> <userinput>zpool status <replaceable>healer</replaceable></userinput>
    pool: healer
   state: ONLINE
  status: One or more devices has experienced an unrecoverable error.  An
          attempt was made to correct the error.  Applications are unaffected.
  action: Determine if the device needs to be replaced, and clear the errors
          using 'zpool clear' or replace the device with 'zpool replace'.
     see: http://illumos.org/msg/ZFS-8000-4J
    scan: none requested
  config:

      NAME        STATE     READ WRITE CKSUM
      healer      ONLINE       0     0     0
        mirror-0  ONLINE       0     0     0
         ada0     ONLINE       0     0     0
         ada1     ONLINE       0     0     1

errors: No known data errors</screen>

      <para>O erro foi detectado e tratado usando a redundância presente no disco de espelhamento <filename>ada0</filename> não afetado. Uma comparação de checksum com o original irá revelar se o pool está consistente novamente.</para>

      <screen><prompt>#</prompt> <userinput>sha1 /healer &gt;&gt; checksum.txt</userinput>
<prompt>#</prompt> <userinput>cat checksum.txt</userinput>
SHA1 (/healer) = 2753eff56d77d9a536ece6694bf0a82740344d1f
SHA1 (/healer) = 2753eff56d77d9a536ece6694bf0a82740344d1f</screen>

      <para>Os dois checksums que foram gerados antes e depois da adulteração intencional dos dados do conjunto ainda correspondem. Isso mostra como o <acronym>ZFS</acronym> é capaz de detectar e corrigir erros automaticamente quando os checksums são diferentes. Observe que isso só é possível quando há redundância suficiente presente no pool. Um pool que consiste em um único dispositivo não possui recursos de autocorreção. Essa também é a razão pela qual os cheksuma são tão importantes no <acronym>ZFS</acronym> e não devem ser desabilitados por nenhum motivo. Nenhum <citerefentry><refentrytitle>fsck</refentrytitle><manvolnum>8</manvolnum></citerefentry> ou programa semelhante de verificação de consistência do sistema de arquivos é necessário para detectar e corrigir isso e o pool ainda estava disponível durante o problema. Uma operação de scrub agora é necessária para sobrescrever os dados corrompidos em <filename>ada1</filename>.</para>

      <screen><prompt>#</prompt> <userinput>zpool scrub <replaceable>healer</replaceable></userinput>
<prompt>#</prompt> <userinput>zpool status <replaceable>healer</replaceable></userinput>
  pool: healer
 state: ONLINE
status: One or more devices has experienced an unrecoverable error.  An
            attempt was made to correct the error.  Applications are unaffected.
action: Determine if the device needs to be replaced, and clear the errors
            using 'zpool clear' or replace the device with 'zpool replace'.
   see: http://illumos.org/msg/ZFS-8000-4J
  scan: scrub in progress since Mon Dec 10 12:23:30 2012
        10.4M scanned out of 67.0M at 267K/s, 0h3m to go
        9.63M repaired, 15.56% done
config:

    NAME        STATE     READ WRITE CKSUM
    healer      ONLINE       0     0     0
      mirror-0  ONLINE       0     0     0
       ada0     ONLINE       0     0     0
       ada1     ONLINE       0     0   627  (repairing)

errors: No known data errors</screen>

      <para>A operação scrub lê os dados do <filename>ada0</filename> e reescreve todos os dados com um checksum incorreto no <filename>ada1</filename>. Isso é indicado pela saída <literal>(repairing)</literal> do <command>zpool status</command>. Após a conclusão da operação, o status do conjunto é alterado para:</para>

      <screen><prompt>#</prompt> <userinput>zpool status <replaceable>healer</replaceable></userinput>
  pool: healer
 state: ONLINE
status: One or more devices has experienced an unrecoverable error.  An
        attempt was made to correct the error.  Applications are unaffected.
action: Determine if the device needs to be replaced, and clear the errors
             using 'zpool clear' or replace the device with 'zpool replace'.
   see: http://illumos.org/msg/ZFS-8000-4J
  scan: scrub repaired 66.5M in 0h2m with 0 errors on Mon Dec 10 12:26:25 2012
config:

    NAME        STATE     READ WRITE CKSUM
    healer      ONLINE       0     0     0
      mirror-0  ONLINE       0     0     0
       ada0     ONLINE       0     0     0
       ada1     ONLINE       0     0 2.72K

errors: No known data errors</screen>

      <para>Após a conclusão da operação scrub e todos os dados terem sido sincronizados de <filename>ada0</filename> para <filename>ada1</filename>, as mensagens de erro podem ser <link linkend="zfs-zpool-clear"/> do status do pool executando <command>zpool clear</command>.</para>

      <screen><prompt>#</prompt> <userinput>zpool clear <replaceable>healer</replaceable></userinput>
<prompt>#</prompt> <userinput>zpool status <replaceable>healer</replaceable></userinput>
  pool: healer
 state: ONLINE
  scan: scrub repaired 66.5M in 0h2m with 0 errors on Mon Dec 10 12:26:25 2012
config:

    NAME        STATE     READ WRITE CKSUM
    healer      ONLINE       0     0     0
      mirror-0  ONLINE       0     0     0
       ada0     ONLINE       0     0     0
       ada1     ONLINE       0     0     0

errors: No known data errors</screen>

      <para>O pool está agora de volta a um estado totalmente funcional e todos os erros foram apagados.</para>
    </sect2>

    <sect2 xml:id="zfs-zpool-online">
      <title>Crescendo um Pool</title>

      <para>O tamanho utilizável de um pool redundante é limitado pela capacidade do menor dispositivo em cada vdev. O menor dispositivo pode ser substituído por um dispositivo maior. Depois de concluir uma operação <link linkend="zfs-zpool-replace">replace</link> ou <link linkend="zfs-term-resilver">resilver</link>, o pool pode crescer para usar a capacidade do Novo dispositivo. Por exemplo, considere um espelho de uma unidade de 1 TB e uma unidade de 2 TB. O espaço utilizável é de 1 TB. Quando a unidade de 1 TB é substituída por outra unidade de 2 TB, o processo de resilverização copia os dados existentes para a nova unidade. Como os dois dispositivos agora têm capacidade para 2 TB, o espaço disponível do espelho pode ser aumentado para 2 TB.</para>

      <para>A expansão é acionada usando o <command>zpool online -e</command> em cada dispositivo. Após a expansão de todos os dispositivos, o espaço adicional fica disponível para o pool.</para>
    </sect2>

    <sect2 xml:id="zfs-zpool-import">
      <title>Importando e exportando pools</title>

      <para>Os pools são <emphasis>exportados</emphasis> antes de serem movidos para outro sistema. Todos os conjuntos de dados são desmontados e cada dispositivo é marcado como exportado, mas ainda estarão bloqueados, para que não possam ser usados por outros subsistemas de disco. Isso permite que pools sejam <emphasis>importados</emphasis> em outras máquinas, outros sistemas operacionais que suportem <acronym> ZFS </acronym>, e até mesmo arquiteturas de hardware diferentes (com algumas advertências, veja <citerefentry><refentrytitle>zpool</refentrytitle><manvolnum>8</manvolnum></citerefentry>). Quando um conjunto de dados tem arquivos abertos, o <command>zpool export -f</command> pode ser usado para forçar a exportação de um pool. Use isso com cautela. Os conjuntos de dados são forçosamente desmontados, resultando potencialmente em um comportamento inesperado dos aplicativos que tinham arquivos abertos nesses conjuntos de dados.</para>

      <para>Exportar um pool que não está em uso:</para>

      <screen><prompt>#</prompt> <userinput>zpool export mypool</userinput></screen>

      <para>Importar um pool automaticamente monta os conjuntos de dados. Este pode não ser o comportamento desejado e pode ser evitado com <command>zpool import -N</command>. O <command>zpool import -o</command> define propriedades temporárias apenas para esta importação. O <command> zpool import altroot=</command> permite importar um pool com um ponto base de montagem em vez da raiz do sistema de arquivos. Se o pool foi usado pela última vez em um sistema diferente e não foi exportado corretamente, uma importação pode ter que ser forçada com <command>zpool import -f</command>. O <command>zpool import -a</command> importa todos os pools que não parecem estar em uso por outro sistema.</para>

      <para>Listar todos os pools disponíveis para importação:</para>

      <screen><prompt>#</prompt> <userinput>zpool import</userinput>
   pool: mypool
     id: 9930174748043525076
  state: ONLINE
 action: The pool can be imported using its name or numeric identifier.
 config:

        mypool      ONLINE
          ada2p3    ONLINE</screen>

      <para>Importe o pool com um diretório raiz alternativo:</para>

      <screen><prompt>#</prompt> <userinput>zpool import -o altroot=<replaceable>/mnt</replaceable> <replaceable>mypool</replaceable></userinput>
<prompt>#</prompt> <userinput>zfs list</userinput>
zfs list
NAME                 USED  AVAIL  REFER  MOUNTPOINT
mypool               110K  47.0G    31K  /mnt/mypool</screen>
    </sect2>

    <sect2 xml:id="zfs-zpool-upgrade">
      <title>Atualizando um pool de armazenamento</title>

      <para>Após a atualização do FreeBSD, ou se um pool foi importado de um sistema usando uma versão mais antiga do <acronym>ZFS</acronym>, o pool pode ser atualizado manualmente para a versão mais recente do <acronym>ZFS</acronym> para suportar as funcionalidades mais recentes. Considere se o pool pode precisar ser importado em um sistema antigo antes de atualizar. A atualização é um processo unidirecional. Os pools mais antigos podem ser atualizados, mas os pools com funcionalidades mais recentes não podem ser desatualizados.</para>

      <para>Atualize um pool v28 para suportar <literal>Feature Flags</literal>:</para>

      <screen><prompt>#</prompt> <userinput>zpool status</userinput>
  pool: mypool
 state: ONLINE
status: The pool is formatted using a legacy on-disk format.  The pool can
        still be used, but some features are unavailable.
action: Upgrade the pool using 'zpool upgrade'.  Once this is done, the
        pool will no longer be accessible on software that does not support feat
        flags.
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
	    ada0    ONLINE       0     0     0
	    ada1    ONLINE       0     0     0

errors: No known data errors
<prompt>#</prompt> <userinput>zpool upgrade</userinput>
This system supports ZFS pool feature flags.

The following pools are formatted with legacy version numbers and can
be upgraded to use feature flags.  After being upgraded, these pools
will no longer be accessible by software that does not support feature
flags.

VER  POOL
---  ------------
28   mypool

Use 'zpool upgrade -v' for a list of available legacy versions.
Every feature flags pool has all supported features enabled.
<prompt>#</prompt> <userinput>zpool upgrade mypool</userinput>
This system supports ZFS pool feature flags.

Successfully upgraded 'mypool' from version 28 to feature flags.
Enabled the following features on 'mypool':
  async_destroy
  empty_bpobj
  lz4_compress
  multi_vdev_crash_dump</screen>

      <para>Os recursos mais recentes do <acronym>ZFS</acronym> não estarão disponíveis até que o <command>zpool upgrade</command> seja concluído. O <command>zpool upgrade -v</command> pode ser usado para ver quais os novos recursos que serão fornecidos pela atualização, bem como quais recursos já são suportados.</para>

      <para>Atualize um pool para suportar feature flags adicionais:</para>

      <screen><prompt>#</prompt> <userinput>zpool status</userinput>
  pool: mypool
 state: ONLINE
status: Some supported features are not enabled on the pool. The pool can
        still be used, but some features are unavailable.
action: Enable all features using 'zpool upgrade'. Once this is done,
        the pool may no longer be accessible by software that does not support
        the features. See zpool-features(7) for details.
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
	    ada0    ONLINE       0     0     0
	    ada1    ONLINE       0     0     0

errors: No known data errors
<prompt>#</prompt> <userinput>zpool upgrade</userinput>
This system supports ZFS pool feature flags.

All pools are formatted using feature flags.


Some supported features are not enabled on the following pools. Once a
feature is enabled the pool may become incompatible with software
that does not support the feature. See zpool-features(7) for details.

POOL  FEATURE
---------------
zstore
      multi_vdev_crash_dump
      spacemap_histogram
      enabled_txg
      hole_birth
      extensible_dataset
      bookmarks
      filesystem_limits
<prompt>#</prompt> <userinput>zpool upgrade mypool</userinput>
This system supports ZFS pool feature flags.

Enabled the following features on 'mypool':
  spacemap_histogram
  enabled_txg
  hole_birth
  extensible_dataset
  bookmarks
  filesystem_limits</screen>

      <warning>
	<para>O boot code em sistemas que inicializam a partir de um pool deve ser atualizado para suportar a nova versão do pool. Use <command>gpart bootcode</command> na partição que contém o boot code. Existem dois tipos de bootcode disponíveis, dependendo da forma como o sistema inicializa: <acronym>GPT</acronym> (a opção mais comum) e <acronym>EFI</acronym> (para sistemas mais modernos).</para>

	<para>Para inicialização legada usando o GPT, use o seguinte comando:</para>

	<screen><prompt>#</prompt> <userinput>gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i <replaceable>1</replaceable> <replaceable>ada1</replaceable></userinput></screen>

	<para>Para sistemas que usam o EFI para inicializar, execute o seguinte comando:</para>

	<screen><prompt>#</prompt> <userinput>gpart bootcode -p /boot/boot1.efifat -i <replaceable>1</replaceable> <replaceable>ada1</replaceable></userinput></screen>

	<para>Aplique o bootcode a todos os discos inicializáveis no pool. Veja <citerefentry><refentrytitle>gpart</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter maiores informações.</para>
      </warning>
    </sect2>

    <sect2 xml:id="zfs-zpool-history">
      <title>Exibindo o histórico gravado do pool</title>

      <para>Comandos que modificam o pool são registrados. As ações registradas incluem a criação de conjuntos de dados, a alteração de propriedades ou a substituição de um disco. Esse histórico é útil para revisar como um pool foi criado e qual usuário executou uma ação específica e quando. O histórico não é mantido em um arquivo de log, mas faz parte do próprio pool. O comando para revisar este histórico é apropriadamente chamado de <command>zpool history</command>:</para>

      <screen><prompt>#</prompt> <userinput>zpool history</userinput>
History for 'tank':
2013-02-26.23:02:35 zpool create tank mirror /dev/ada0 /dev/ada1
2013-02-27.18:50:58 zfs set atime=off tank
2013-02-27.18:51:09 zfs set checksum=fletcher4 tank
2013-02-27.18:51:18 zfs create tank/backup</screen>

      <para>A saída mostra os comandos <command>zpool</command> e <command>zfs</command> que foram executados no pool juntamente com um registro de data e hora. Somente comandos que alteram o pool de alguma forma são registrados. Comandos como <command>zfs list</command> não estão incluídos. Quando nenhum nome de pool é especificado, é exibido o histórico de todos os pools.</para>

      <para>O <command>zpool history</command> pode mostrar ainda mais informações quando as opções <option>-i</option> ou <option>-l</option> são fornecidas. A opção <option>-i</option> exibe eventos iniciados pelo usuário, bem como eventos do <acronym>ZFS</acronym> registrados internamente.</para>

      <screen><prompt>#</prompt> <userinput>zpool history -i</userinput>
History for 'tank':
2013-02-26.23:02:35 [internal pool create txg:5] pool spa 28; zfs spa 28; zpl 5;uts  9.1-RELEASE 901000 amd64
2013-02-27.18:50:53 [internal property set txg:50] atime=0 dataset = 21
2013-02-27.18:50:58 zfs set atime=off tank
2013-02-27.18:51:04 [internal property set txg:53] checksum=7 dataset = 21
2013-02-27.18:51:09 zfs set checksum=fletcher4 tank
2013-02-27.18:51:13 [internal create txg:55] dataset = 39
2013-02-27.18:51:18 zfs create tank/backup</screen>

      <para>Mais detalhes podem ser mostrados adicionando a opção <option>-l</option>. Os registros de histórico são mostrados em um formato longo, incluindo informações como o nome do usuário que emitiu o comando e o nome do host no qual a alteração foi feita.</para>

      <screen><prompt>#</prompt> <userinput>zpool history -l</userinput>
History for 'tank':
2013-02-26.23:02:35 zpool create tank mirror /dev/ada0 /dev/ada1 [user 0 (root) on :global]
2013-02-27.18:50:58 zfs set atime=off tank [user 0 (root) on myzfsbox:global]
2013-02-27.18:51:09 zfs set checksum=fletcher4 tank [user 0 (root) on myzfsbox:global]
2013-02-27.18:51:18 zfs create tank/backup [user 0 (root) on myzfsbox:global]</screen>

      <para>A saída mostra que o usuário <systemitem class="username">root</systemitem> criou o pool espelhado com os discos <filename>/dev/ada0</filename> e <filename>/dev/ada1</filename>. O nome do host <systemitem class="systemname">myzfsbox</systemitem> também é mostrado nos comandos após a criação do pool. A exibição do nome do host se torna importante quando o pool é exportado de um sistema e importado para outro. Os comandos que são emitidos no outro sistema podem claramente ser distinguidos pelo nome do host que é registrado para cada comando.</para>

      <para>Ambas as opções para o <command>zpool history</command> podem ser combinadas para fornecer as informações mais detalhadas possíveis para qualquer pool. O histórico do pool fornece informações valiosas ao rastrear as ações que foram executadas ou quando é necessária uma saída mais detalhada para a depuração.</para>
    </sect2>

    <sect2 xml:id="zfs-zpool-iostat">
      <title>Monitoramento de Desempenho</title>

      <para>Um sistema de monitoramento integrado pode exibir estatísticas de <acronym>I/O</acronym> do pool em tempo real. Ele mostra a quantidade de espaço livre e usado no pool, quantas operações de leitura e gravação estão sendo executadas por segundo e quanto de largura de banda de <acronym>I/O</acronym> está sendo utilizada no momento. Por padrão, todos os pools no sistema são monitorados e exibidos. Um nome de pool pode ser fornecido para limitar o monitoramento apenas a esse pool. Um exemplo básico:</para>

      <screen><prompt>#</prompt> <userinput>zpool iostat</userinput>
               capacity     operations    bandwidth
pool        alloc   free   read  write   read  write
----------  -----  -----  -----  -----  -----  -----
data         288G  1.53T      2     11  11.3K  57.1K</screen>

      <para>Para monitorar continuamente a atividade de <acronym>I/O</acronym>, um número pode ser especificado como o último parâmetro, indicando um intervalo em segundos para aguardar entre as atualizações. A próxima linha de estatística é impressa após cada intervalo. Pressione<keycombo action="simul"> <keycap>Ctrl</keycap> <keycap>C</keycap> </keycombo> para interromper este monitoramento contínuo. Como alternativa, forneça um segundo número na linha de comando após o intervalo para especificar o número total de estatísticas a serem exibidas.</para>

      <para>Estatísticas mais detalhadas de <acronym>I/O</acronym> podem ser exibidas com a opção <option>-v</option>. Cada dispositivo no pool é mostrado com uma linha de estatísticas. Isso é útil para ver quantas operações de leitura e gravação estão sendo executadas em cada dispositivo e pode ajudar a determinar se algum dispositivo individual está reduzindo a velocidade do pool. Este exemplo mostra um pool espelhado com dois dispositivos:</para>

      <screen><prompt>#</prompt> <userinput>zpool iostat -v </userinput>
                            capacity     operations    bandwidth
pool                     alloc   free   read  write   read  write
-----------------------  -----  -----  -----  -----  -----  -----
data                      288G  1.53T      2     12  9.23K  61.5K
  mirror                  288G  1.53T      2     12  9.23K  61.5K
    ada1                     -      -      0      4  5.61K  61.7K
    ada2                     -      -      1      4  5.04K  61.7K
-----------------------  -----  -----  -----  -----  -----  -----</screen>
    </sect2>

    <sect2 xml:id="zfs-zpool-split">
      <title>Dividindo um pool de armazenamento</title>

      <para>Um pool que consiste em um ou mais vdevs espelhados pode ser dividido em dois conjuntos. A menos que seja especificado de outra forma, o último membro de cada espelho é desanexado e usado para criar um novo pool contendo os mesmos dados. A operação deve primeiro ser tentada com <option>-n</option>. Os detalhes da operação proposta são exibidos sem que sejam realmente executados. Isso ajuda a confirmar que a operação fará o que o usuário pretende.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="zfs-zfs">
    <title>Administração do <command>zfs</command></title>

    <para>O utilitário <command>zfs</command> é responsável por criar, destruir e gerenciar todos os conjuntos de dados <acronym> ZFS </acronym> existentes em um pool. O pool é gerenciado usando o <link linkend="zfs-zpool"> <command>zpool</command></link>.</para>

    <sect2 xml:id="zfs-zfs-create">
      <title>Criando e destruindo conjuntos de dados</title>

      <para>Ao contrário dos discos tradicionais e gerenciadores de volume, o espaço no <acronym>ZFS</acronym>  <emphasis>não</emphasis> é pré-alocado. Nos sistemas de arquivos tradicionais, depois que todo o espaço é particionado e atribuído, não há como adicionar um sistema de arquivos adicional sem adicionar um novo disco. Com o <acronym>ZFS</acronym>, novos sistemas de arquivos podem ser criados a qualquer momento. Cada <link linkend="zfs-term-dataset"><emphasis>conjunto de dados</emphasis></link> tem propriedades incluindo recursos como compactação, deduplicação, armazenamento em cache e cotas, bem como outras propriedades úteis como somente leitura, diferenciação de maiúsculas e minúsculas , compartilhamento de arquivos de rede e um ponto de montagem. Os conjuntos de dados podem ser aninhados uns dentro dos outros e os conjuntos de dados filhos herdarão propriedades de seus pais. Cada conjunto de dados pode ser administrado, <link linkend="zfs-zfs-allow">delegado</link>, <link linkend="zfs-zfs-send">replicado</link>, preservado por um <link linkend="zfs-zfs-snapshot">snapshot</link>, <link linkend="zfs-zfs-jail">preso</link>, e destruído como uma unidade. Há muitas vantagens em criar um conjunto de dados separado para cada tipo ou conjunto de arquivos diferente. A única desvantagem de ter um número extremamente grande de conjuntos de dados é que alguns comandos como <command>zfs list</command> serão mais lentos, e a montagem de centenas ou mesmo milhares de conjuntos de dados pode retardar o processo de inicialização do FreeBSD.</para>

      <para>Crie um novo conjunto de dados e ative a <link linkend="zfs-term-compression-lz4">compactação LZ4</link> nele:</para>

      <screen><prompt>#</prompt> <userinput>zfs list</userinput>
NAME                  USED  AVAIL  REFER  MOUNTPOINT
mypool                781M  93.2G   144K  none
mypool/ROOT           777M  93.2G   144K  none
mypool/ROOT/default   777M  93.2G   777M  /
mypool/tmp            176K  93.2G   176K  /tmp
mypool/usr            616K  93.2G   144K  /usr
mypool/usr/home       184K  93.2G   184K  /usr/home
mypool/usr/ports      144K  93.2G   144K  /usr/ports
mypool/usr/src        144K  93.2G   144K  /usr/src
mypool/var           1.20M  93.2G   608K  /var
mypool/var/crash      148K  93.2G   148K  /var/crash
mypool/var/log        178K  93.2G   178K  /var/log
mypool/var/mail       144K  93.2G   144K  /var/mail
mypool/var/tmp        152K  93.2G   152K  /var/tmp
<prompt>#</prompt> <userinput>zfs create -o compress=lz4 <replaceable>mypool/usr/mydataset</replaceable></userinput>
<prompt>#</prompt> <userinput>zfs list</userinput>
NAME                   USED  AVAIL  REFER  MOUNTPOINT
mypool                 781M  93.2G   144K  none
mypool/ROOT            777M  93.2G   144K  none
mypool/ROOT/default    777M  93.2G   777M  /
mypool/tmp             176K  93.2G   176K  /tmp
mypool/usr             704K  93.2G   144K  /usr
mypool/usr/home        184K  93.2G   184K  /usr/home
mypool/usr/mydataset  87.5K  93.2G  87.5K  /usr/mydataset
mypool/usr/ports       144K  93.2G   144K  /usr/ports
mypool/usr/src         144K  93.2G   144K  /usr/src
mypool/var            1.20M  93.2G   610K  /var
mypool/var/crash       148K  93.2G   148K  /var/crash
mypool/var/log         178K  93.2G   178K  /var/log
mypool/var/mail        144K  93.2G   144K  /var/mail
mypool/var/tmp         152K  93.2G   152K  /var/tmp</screen>

      <para>A destruição de um conjunto de dados é muito mais rápida que a exclusão de todos os arquivos que residem no conjunto de dados, pois não envolve a verificação de todos os arquivos e a atualização de todos os metadados correspondentes.</para>

      <para>Destrua o conjunto de dados criado anteriormente:</para>

      <screen><prompt>#</prompt> <userinput>zfs list</userinput>
NAME                   USED  AVAIL  REFER  MOUNTPOINT
mypool                 880M  93.1G   144K  none
mypool/ROOT            777M  93.1G   144K  none
mypool/ROOT/default    777M  93.1G   777M  /
mypool/tmp             176K  93.1G   176K  /tmp
mypool/usr             101M  93.1G   144K  /usr
mypool/usr/home        184K  93.1G   184K  /usr/home
mypool/usr/mydataset   100M  93.1G   100M  /usr/mydataset
mypool/usr/ports       144K  93.1G   144K  /usr/ports
mypool/usr/src         144K  93.1G   144K  /usr/src
mypool/var            1.20M  93.1G   610K  /var
mypool/var/crash       148K  93.1G   148K  /var/crash
mypool/var/log         178K  93.1G   178K  /var/log
mypool/var/mail        144K  93.1G   144K  /var/mail
mypool/var/tmp         152K  93.1G   152K  /var/tmp
<prompt>#</prompt> <userinput>zfs destroy <replaceable>mypool/usr/mydataset</replaceable></userinput>
<prompt>#</prompt> <userinput>zfs list</userinput>
NAME                  USED  AVAIL  REFER  MOUNTPOINT
mypool                781M  93.2G   144K  none
mypool/ROOT           777M  93.2G   144K  none
mypool/ROOT/default   777M  93.2G   777M  /
mypool/tmp            176K  93.2G   176K  /tmp
mypool/usr            616K  93.2G   144K  /usr
mypool/usr/home       184K  93.2G   184K  /usr/home
mypool/usr/ports      144K  93.2G   144K  /usr/ports
mypool/usr/src        144K  93.2G   144K  /usr/src
mypool/var           1.21M  93.2G   612K  /var
mypool/var/crash      148K  93.2G   148K  /var/crash
mypool/var/log        178K  93.2G   178K  /var/log
mypool/var/mail       144K  93.2G   144K  /var/mail
mypool/var/tmp        152K  93.2G   152K  /var/tmp</screen>

      <para>Nas versões modernas do <acronym>ZFS</acronym>, o <command>zfs destroy</command> é assíncrono, e o espaço livre pode levar vários minutos para aparecer no pool. Use o <command>zpool get freeing <replaceable>poolname</replaceable></command> para ver a propriedade <literal>freeing</literal>, indicando quantos conjuntos de dados estão tendo seus blocos liberados em segundo plano. Se houver conjuntos de dados filhos, como <link linkend="zfs-term-snapshot">snapshots</link> ou outros conjuntos de dados, o pai não poderá ser destruído. Para destruir um conjunto de dados e todos os seus filhos, use <option>-r</option> para destruir recursivamente o conjunto de dados e todos os seus filhos. Use <option>-n</option> <option>-v</option> para listar os conjuntos de dados e snapshots que seriam destruídos por esta operação, mas na verdade não destruirão nada. O espaço que seria recuperado pela destruição dos snapshots também é mostrado.</para>
    </sect2>

    <sect2 xml:id="zfs-zfs-volume">
      <title>Criando e Destruindo Volumes</title>

      <para>Um volume é um tipo especial de conjunto de dados. Em vez de ser montado como um sistema de arquivos, ele é exposto como um dispositivo de bloco em <filename>/dev/zvol/<replaceable>poolname</replaceable>/<replaceable>dataset</replaceable></filename>. Isso permite que o volume seja usado para outros sistemas de arquivos, para fazer backup dos discos de uma máquina virtual ou para ser exportado usando protocolos como <acronym>iSCSI</acronym> ou <acronym>HAST</acronym>.</para>

      <para>Um volume pode ser formatado com qualquer sistema de arquivos ou usado sem um sistema de arquivos para armazenar dados brutos. Para o usuário, um volume parece ser um disco normal. Colocar sistemas de arquivos comuns nesses <emphasis>zvols</emphasis> fornece recursos que os discos comuns ou sistemas de arquivos normalmente não possuem. Por exemplo, o uso da propriedade de compactação em um volume de 250 MB permite a criação de um sistema de arquivos <acronym>FAT</acronym> compactado.</para>

      <screen><prompt>#</prompt> <userinput>zfs create -V 250m -o compression=on tank/fat32</userinput>
<prompt>#</prompt> <userinput>zfs list tank</userinput>
NAME USED AVAIL REFER MOUNTPOINT
tank 258M  670M   31K /tank
<prompt>#</prompt> <userinput>newfs_msdos -F32 /dev/zvol/tank/fat32</userinput>
<prompt>#</prompt> <userinput>mount -t msdosfs /dev/zvol/tank/fat32 /mnt</userinput>
<prompt>#</prompt> <userinput>df -h /mnt | grep fat32</userinput>
Filesystem           Size Used Avail Capacity Mounted on
/dev/zvol/tank/fat32 249M  24k  249M     0%   /mnt
<prompt>#</prompt> <userinput>mount | grep fat32</userinput>
/dev/zvol/tank/fat32 on /mnt (msdosfs, local)</screen>

      <para>Destruir um volume é o mesmo que destruir um conjunto de dados regular do sistema de arquivos. A operação é quase instantânea, mas pode levar vários minutos para que o espaço livre seja recuperado em segundo plano.</para>
    </sect2>

    <sect2 xml:id="zfs-zfs-rename">
      <title>Renomeando um Conjunto de Dados</title>

      <para>O nome de um conjunto de dados pode ser alterado com <command>zfs rename</command>. O pai de um conjunto de dados também pode ser alterado com esse comando. A renomeação de um conjunto de dados para um conjunto de dados pai diferente alterará o valor das propriedades herdadas do conjunto de dados pai. Quando um conjunto de dados é renomeado, ele é desmontado e, em seguida, remontado no novo local (que é herdado do novo conjunto de dados pai). Esse comportamento pode ser evitado com <option>-u</option>.</para>

      <para>Renomeie um conjunto de dados e mova-o para um conjunto de dados pai diferente:</para>

      <screen><prompt>#</prompt> <userinput>zfs list</userinput>
NAME                   USED  AVAIL  REFER  MOUNTPOINT
mypool                 780M  93.2G   144K  none
mypool/ROOT            777M  93.2G   144K  none
mypool/ROOT/default    777M  93.2G   777M  /
mypool/tmp             176K  93.2G   176K  /tmp
mypool/usr             704K  93.2G   144K  /usr
mypool/usr/home        184K  93.2G   184K  /usr/home
mypool/usr/mydataset  87.5K  93.2G  87.5K  /usr/mydataset
mypool/usr/ports       144K  93.2G   144K  /usr/ports
mypool/usr/src         144K  93.2G   144K  /usr/src
mypool/var            1.21M  93.2G   614K  /var
mypool/var/crash       148K  93.2G   148K  /var/crash
mypool/var/log         178K  93.2G   178K  /var/log
mypool/var/mail        144K  93.2G   144K  /var/mail
mypool/var/tmp         152K  93.2G   152K  /var/tmp
<prompt>#</prompt> <userinput>zfs rename <replaceable>mypool/usr/mydataset</replaceable> <replaceable>mypool/var/newname</replaceable></userinput>
<prompt>#</prompt> <userinput>zfs list</userinput>
NAME                  USED  AVAIL  REFER  MOUNTPOINT
mypool                780M  93.2G   144K  none
mypool/ROOT           777M  93.2G   144K  none
mypool/ROOT/default   777M  93.2G   777M  /
mypool/tmp            176K  93.2G   176K  /tmp
mypool/usr            616K  93.2G   144K  /usr
mypool/usr/home       184K  93.2G   184K  /usr/home
mypool/usr/ports      144K  93.2G   144K  /usr/ports
mypool/usr/src        144K  93.2G   144K  /usr/src
mypool/var           1.29M  93.2G   614K  /var
mypool/var/crash      148K  93.2G   148K  /var/crash
mypool/var/log        178K  93.2G   178K  /var/log
mypool/var/mail       144K  93.2G   144K  /var/mail
mypool/var/newname   87.5K  93.2G  87.5K  /var/newname
mypool/var/tmp        152K  93.2G   152K  /var/tmp</screen>

      <para>Os snapshots também podem ser renomeados dessa maneira. Devido à natureza dos snapshots, eles não podem ser renomeados para um conjunto de dados pai diferente. Para renomear um snapshot recursivo, especifique <option>-r</option> e todos os snapshots com o mesmo nome nos conjuntos de dados filho também serão renomeados.</para>

      <screen><prompt>#</prompt> <userinput>zfs list -t snapshot</userinput>
NAME                                USED  AVAIL  REFER  MOUNTPOINT
mypool/var/newname@first_snapshot      0      -  87.5K  -
<prompt>#</prompt> <userinput>zfs rename <replaceable>mypool/var/newname@first_snapshot</replaceable> <replaceable>new_snapshot_name</replaceable></userinput>
<prompt>#</prompt> <userinput>zfs list -t snapshot</userinput>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/newname@new_snapshot_name      0      -  87.5K  -</screen>
    </sect2>

    <sect2 xml:id="zfs-zfs-set">
      <title>Configurando Propriedades do Conjunto de Dados</title>

      <para>Cada conjunto de dados do <acronym>ZFS</acronym> possui várias propriedades que controlam seu comportamento. A maioria das propriedades é herdada automaticamente do conjunto de dados pai, mas pode ser substituída localmente. Defina uma propriedade em um conjunto de dados com <command>zfs set <replaceable>property</replaceable>=<replaceable>value</replaceable> <replaceable>dataset</replaceable></command>. A maioria das propriedades tem um conjunto limitado de valores válidos, o <command>zfs get</command> exibirá cada propriedade e valor válido possível. A maioria das propriedades pode ser revertida para seus valores herdados usando <command>zfs inherit</command>.</para>

      <para>Propriedades definidas pelo usuário também podem ser definidas. Eles se tornam parte da configuração do conjunto de dados e podem ser usados para fornecer informações adicionais sobre o conjunto de dados ou seu conteúdo. Para distinguir essas propriedades personalizadas daquelas fornecidas como parte do <acronym>ZFS</acronym>, dois pontos (<literal>:</literal>) são usados para criar um namespace personalizado para a propriedade.</para>

      <screen><prompt>#</prompt> <userinput>zfs set <replaceable>custom</replaceable>:<replaceable>costcenter</replaceable>=<replaceable>1234</replaceable> <replaceable>tank</replaceable></userinput>
<prompt>#</prompt> <userinput>zfs get <replaceable>custom</replaceable>:<replaceable>costcenter</replaceable> <replaceable>tank</replaceable></userinput>
NAME PROPERTY           VALUE SOURCE
tank custom:costcenter  1234  local</screen>

      <para>Para remover uma propriedade customizada, use o <command>zfs inherit</command> com <option>-r</option>. Se a propriedade personalizada não estiver definida em nenhum dos conjuntos de dados pai, ela será removida completamente (embora as alterações ainda sejam registradas no histórico do pool).</para>

      <screen><prompt> # </prompt> <userinput> zfs inherit -r <replaceable> customizado </replaceable>: <replaceable> costcenter </replaceable> <replaceable> tanque </replaceable> </userinput>
<prompt> # </prompt> <userinput> zfs <replaceable> customizado </replaceable>: <replaceable> costcenter </replaceable> <replaceable> tank </replaceable> </userinput>
NAME PROPERTY VALUE SOURCE
tanque personalizado: costcenter - -
<prompt> # </prompt> <userinput> zfs obtém todos <replaceable> tank </replaceable> | grep <replaceable> personalizado </replaceable>: <replaceable> costcenter </replaceable> </userinput>
<prompt> # </prompt></screen>

    <sect3 xml:id="zfs-zfs-set-share">
      <title>Obtendo e definindo propriedades de compartilhamento</title>

      <para>Duas propriedades de conjunto de dados comumente usadas e úteis são as opções de compartilhamento <acronym>NFS</acronym> e <acronym>SMB</acronym>. Configurar estas define se e como os conjuntos de dados do <acronym>ZFS</acronym> podem ser compartilhados na rede. Atualmente, apenas o compartilhamento de configurações via <acronym>NFS</acronym> é suportado no FreeBSD. Para obter o status atual de um compartilhamento, insira:</para>

      <screen><prompt>#</prompt> <userinput>zfs get sharenfs <replaceable>mypool/usr/home</replaceable></userinput>
NAME             PROPERTY  VALUE    SOURCE
mypool/usr/home  sharenfs  on       local
<prompt>#</prompt> <userinput>zfs get sharesmb <replaceable>mypool/usr/home</replaceable></userinput>
NAME             PROPERTY  VALUE    SOURCE
mypool/usr/home  sharesmb  off      local</screen>

      <para>Para ativar o compartilhamento de um conjunto de dados, insira:</para>

      <screen><prompt>#</prompt> <userinput> zfs set sharenfs=on <replaceable>mypool/usr/home</replaceable></userinput></screen>

      <para>Também é possível definir opções adicionais para compartilhar conjuntos de dados por meio do <acronym>NFS</acronym>, como <option>-alldirs</option>, <option>-maproot</option> e <option>-network</option>. Para definir opções adicionais para um conjunto de dados compartilhado por meio do NFS, insira:</para>

      <screen><prompt>#</prompt> <userinput> zfs set sharenfs="-alldirs,-maproot=<replaceable>root</replaceable>,-network=<replaceable>192.168.1.0/24</replaceable>" <replaceable>mypool/usr/home</replaceable></userinput></screen>
      </sect3>
    </sect2>

    <sect2 xml:id="zfs-zfs-snapshot">
      <title>Gerenciando Snapshots</title>

      <para>Os <link linkend="zfs-term-snapshot">snapshots</link> são um dos recursos mais poderosos do <acronym>ZFS</acronym>. Um snapshot fornece uma cópia point-in-time somente leitura do conjunto de dados. Com Copy-On-Write (<acronym>COW</acronym>), os snapshots podem ser criados rapidamente, preservando a versão mais antiga dos dados no disco. Se não houver snapshots, o espaço será recuperado para uso futuro quando os dados forem reconfigurados ou excluídos. Os snapshots preservam o espaço em disco gravando apenas as diferenças entre o conjunto de dados atual e uma versão anterior. Os snapshots são permitidos apenas em conjuntos de dados completos, não em arquivos ou diretórios individuais. Quando um snapshot é criado a partir de um conjunto de dados, tudo contido nele é duplicado. Isso inclui as propriedades do sistema de arquivos, arquivos, diretórios, permissões e assim por diante. Os snapshots não usam espaço adicional quando são criados pela primeira vez, consumindo espaço apenas quando os blocos de referência são alterados. Snapshots recursivos obtidos com <option>-r</option> criam um instantâneo com o mesmo nome no conjunto de dados e em todos os seus filhos, fornecendo um snapshot moment-in-time de todos os sistemas de arquivos no momento. Isso pode ser importante quando um aplicativo possui arquivos em vários conjuntos de dados relacionados ou dependentes um do outro. Sem snapshots, um backup teria cópias dos arquivos de diferentes pontos no tempo.</para>

      <para>Os snapshots no <acronym>ZFS</acronym> fornecem uma variedade de recursos que até mesmo outros sistemas de arquivos com a funcionalidade de snapshots não têm. Um exemplo típico de uso de snapshots é ter uma maneira rápida de fazer backup do estado atual do sistema de arquivos quando uma ação arriscada, como uma instalação de software ou uma atualização do sistema, é executada. Se a ação falhar, o snapshot poderá ser revertido e o sistema terá o mesmo estado de quando o snapshot foi criado. Se a atualização foi bem sucedida, o instantâneo pode ser excluído para liberar espaço. Sem snapshots, uma atualização com falha geralmente requer uma restauração de  backup, o que é tedioso, consome tempo e pode exigir tempo de inatividade durante o qual o sistema não pode ser usado. Os snapshots podem ser revertidos rapidamente, mesmo enquanto o sistema está sendo executado em operação normal, com pouco ou nenhum tempo de inatividade. A economia de tempo é enorme com sistemas de armazenamento de vários terabytes e o tempo necessário para copiar os dados a partir do backup. Os snapshots não substituem um backup completo de um pool, mas podem ser usados de maneira rápida e fácil para armazenar uma cópia do conjunto de dados em um momento específico.</para>

      <sect3 xml:id="zfs-zfs-snapshot-creation">
	<title>Criando Snapshots</title>

	<para>Os snapshots  são criados com <command>zfs snapshot <replaceable>dataset</replaceable>@<replaceable>snapshotname</replaceable></command>. Adicionar a opção <option>-r</option> cria um snapshot recursivamente, com o mesmo nome em todos os conjuntos de dados filho.</para>

	<para>Crie um Snapshot recursivo de todo o pool:</para>

	<screen><prompt>#</prompt> <userinput>zfs list -t all</userinput>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool                                 780M  93.2G   144K  none
mypool/ROOT                            777M  93.2G   144K  none
mypool/ROOT/default                    777M  93.2G   777M  /
mypool/tmp                             176K  93.2G   176K  /tmp
mypool/usr                             616K  93.2G   144K  /usr
mypool/usr/home                        184K  93.2G   184K  /usr/home
mypool/usr/ports                       144K  93.2G   144K  /usr/ports
mypool/usr/src                         144K  93.2G   144K  /usr/src
mypool/var                            1.29M  93.2G   616K  /var
mypool/var/crash                       148K  93.2G   148K  /var/crash
mypool/var/log                         178K  93.2G   178K  /var/log
mypool/var/mail                        144K  93.2G   144K  /var/mail
mypool/var/newname                    87.5K  93.2G  87.5K  /var/newname
mypool/var/newname@new_snapshot_name      0      -  87.5K  -
mypool/var/tmp                         152K  93.2G   152K  /var/tmp
<prompt>#</prompt> <userinput>zfs snapshot -r <replaceable>mypool@my_recursive_snapshot</replaceable></userinput>
<prompt>#</prompt> <userinput>zfs list -t snapshot</userinput>
NAME                                        USED  AVAIL  REFER  MOUNTPOINT
mypool@my_recursive_snapshot                   0      -   144K  -
mypool/ROOT@my_recursive_snapshot              0      -   144K  -
mypool/ROOT/default@my_recursive_snapshot      0      -   777M  -
mypool/tmp@my_recursive_snapshot               0      -   176K  -
mypool/usr@my_recursive_snapshot               0      -   144K  -
mypool/usr/home@my_recursive_snapshot          0      -   184K  -
mypool/usr/ports@my_recursive_snapshot         0      -   144K  -
mypool/usr/src@my_recursive_snapshot           0      -   144K  -
mypool/var@my_recursive_snapshot               0      -   616K  -
mypool/var/crash@my_recursive_snapshot         0      -   148K  -
mypool/var/log@my_recursive_snapshot           0      -   178K  -
mypool/var/mail@my_recursive_snapshot          0      -   144K  -
mypool/var/newname@new_snapshot_name           0      -  87.5K  -
mypool/var/newname@my_recursive_snapshot       0      -  87.5K  -
mypool/var/tmp@my_recursive_snapshot           0      -   152K  -</screen>

	<para>Os snapshots não são mostrados por uma operação normal do <command>zfs list</command>. Para listar snapshots , a opção <option>-t snapshot</option> é anexado ao <command>zfs list</command>. A opção <option>-t all</option> exibe os sistemas de arquivos e snapshots.</para>

	<para>Os snapshots não são montados diretamente, portanto, nenhum caminho é mostrado na coluna <literal>MOUNTPOINT</literal>. Não há menção ao espaço disponível em disco na coluna <literal>AVAIL</literal>, já que os snapshots não podem ser gravados após serem criados. Compare o snapshot com o conjunto de dados original a partir do qual foi criado:</para>

	<screen><prompt>#</prompt> <userinput>zfs list -rt all <replaceable>mypool/usr/home</replaceable></userinput>
NAME                                    USED  AVAIL  REFER  MOUNTPOINT
mypool/usr/home                         184K  93.2G   184K  /usr/home
mypool/usr/home@my_recursive_snapshot      0      -   184K  -</screen>

	<para>A exibição do conjunto de dados e dos snapshots juntos revela como os snapshots funcionam no modo <link linkend="zfs-term-cow">COW</link>. Eles salvam apenas as alterações (<emphasis>deltas</emphasis>) que foram feitas e não o conteúdo completo do sistema de arquivos novamente. Isso significa que os snapshots ocupam pouco espaço quando poucas alterações são feitas. O uso do espaço pode se tornar ainda mais aparente copiando um arquivo para o conjunto de dados e fazendo um segundo snapshots:</para>

	<screen><prompt>#</prompt> <userinput>cp <replaceable>/etc/passwd</replaceable> <replaceable>/var/tmp</replaceable></userinput>
<prompt>#</prompt> <userinput>zfs snapshot <replaceable>mypool/var/tmp</replaceable>@<replaceable>after_cp</replaceable></userinput>
<prompt>#</prompt> <userinput>zfs list -rt all <replaceable>mypool/var/tmp</replaceable></userinput>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/tmp                         206K  93.2G   118K  /var/tmp
mypool/var/tmp@my_recursive_snapshot    88K      -   152K  -
mypool/var/tmp@after_cp                   0      -   118K  -</screen>

	<para>O segundo snapshot contém apenas as alterações feitas no conjunto de dados após a operação de cópia. Isso resulta numa enorme economia de espaço. Observe que o tamanho do snapshot <replaceable>mypool/var/tmp@my_recursive_snapshot</replaceable> também foi alterado na coluna <literal>USED</literal> para indicar as alterações entre ela mesma e o snapshot obtido posteriormente.</para>
      </sect3>

      <sect3 xml:id="zfs-zfs-snapshot-diff">
	<title>Comparando Snapshots</title>

	<para>O ZFS fornece um comando interno para comparar as diferenças de conteúdo entre dois snapshots. Isso é útil quando muitos snapshots foram gerados com o passar do tempo e o usuário deseja ver como o sistema de arquivos mudou ao longo do tempo. Por exemplo, o <command>zfs diff</command> permite que um usuário localize o ultimo snapshot que ainda contém um arquivo que foi acidentalmente excluído. Fazer isso para os dois snapshots criados na seção anterior produz essa saída:</para>

	<screen><prompt>#</prompt> <userinput>zfs list -rt all <replaceable>mypool/var/tmp</replaceable></userinput>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/tmp                         206K  93.2G   118K  /var/tmp
mypool/var/tmp@my_recursive_snapshot    88K      -   152K  -
mypool/var/tmp@after_cp                   0      -   118K  -
<prompt>#</prompt> <userinput>zfs diff <replaceable>mypool/var/tmp@my_recursive_snapshot</replaceable></userinput>
M       /var/tmp/
+       /var/tmp/passwd</screen>

	<para>O comando lista as alterações entre o snapshot especificado (neste caso <literal><replaceable>mypool/var/tmp@my_recursive_snapshot</replaceable></literal>) e o sistema de arquivos ativo. A primeira coluna mostra o tipo de mudança:</para>

	<informaltable pgwide="1">
	  <tgroup cols="2">
	    <tbody valign="top">
	      <row>
		<entry>+</entry>
		<entry>O caminho ou arquivo foi adicionado.</entry>
	      </row>

	      <row>
		<entry>-</entry>
		<entry>O caminho ou arquivo foi excluído.</entry>
	      </row>

	      <row>
		<entry>M</entry>
		<entry>O caminho ou arquivo foi modificado.</entry>
	      </row>

	      <row>
		<entry>R</entry>
		<entry>O caminho ou arquivo foi renomeado.</entry>
	      </row>
	    </tbody>
	  </tgroup>
	</informaltable>

	<para>Comparando a saída com a tabela, fica claro que o <filename><replaceable>passwd</replaceable></filename> foi adicionado após o snapshot <literal><replaceable>mypool/var/tmp@my_recursive_snapshot</replaceable></literal> ter sido criado. Isso também resultou em uma modificação no diretório pai montado em <literal><replaceable>/var/tmp</replaceable></literal>.</para>

	<para>A comparação de dois snapshots é útil ao usar o recurso de replicação do <acronym>ZFS</acronym> para transferir um conjunto de dados para um host diferente para fins de backup.</para>

	<para>Compare dois snapshots fornecendo o nome completo do conjunto de dados e o nome do snapshot de ambos os conjuntos de dados:</para>

	<screen><prompt>#</prompt> <userinput>cp /var/tmp/passwd /var/tmp/passwd.copy</userinput>
<prompt>#</prompt> <userinput>zfs snapshot <replaceable>mypool/var/tmp@diff_snapshot</replaceable></userinput>
<prompt>#</prompt> <userinput>zfs diff <replaceable>mypool/var/tmp@my_recursive_snapshot</replaceable> <replaceable>mypool/var/tmp@diff_snapshot</replaceable></userinput>
M       /var/tmp/
+       /var/tmp/passwd
+       /var/tmp/passwd.copy
<prompt>#</prompt> <userinput>zfs diff <replaceable>mypool/var/tmp@my_recursive_snapshot</replaceable> <replaceable>mypool/var/tmp@after_cp</replaceable></userinput>
M       /var/tmp/
+       /var/tmp/passwd</screen>

	<para>Um administrador de backup pode comparar dois snapshots recebidos do host de envio e determinar as alterações reais no conjunto de dados. Consulte a seção <link linkend="zfs-zfs-send">Replicação</link> para obter maiores informações.</para>
      </sect3>

      <sect3 xml:id="zfs-zfs-snapshot-rollback">
	<title>Reversão de um Snapshot</title>

	<para>Quando pelo menos um snapshot estiver disponível, ele poderá ser revertido a qualquer momento. Na maioria das vezes, esse é o caso quando o estado atual do conjunto de dados não é mais necessário e uma versão mais antiga é preferida. Cenários em que testes de desenvolvimento local deram errado, atualizações de sistemas com falhas que dificultam o funcionamento geral do sistema ou a necessidade de restaurar arquivos ou diretórios excluídos acidentalmente são ocorrências muito comuns. Felizmente, reverter um snapshot é tão fácil quanto digitar <command>zfs rollback <replaceable>snapshotname</replaceable></command>. Dependendo de quantas alterações estão envolvidas, a operação será concluída em um determinado período de tempo. Durante esse período, o conjunto de dados permanece sempre em um estado consistente, da mesma forma que um banco de dados em conformidade com os princípios do ACID ao realizar uma reversão. Isso está acontecendo enquanto o conjunto de dados está ativo e acessível, sem exigir um tempo de inatividade. Depois que o snapshot for revertido, o conjunto de dados terá o mesmo estado de quando o snapshot foi originalmente criado. Todos os outros dados nesse conjunto de dados que não faziam parte do snapshot são descartados. Criar um snapshot do estado atual do conjunto de dados antes de reverter para um anterior é uma boa ideia quando alguns dos dados são necessários mais tarde. Desta forma, o usuário pode alternar entre os snapshots sem perder dados que ainda são valiosos.</para>

	<para>No primeiro exemplo, um snapshot é revertido por causa de uma operação descuidada com o comando <command>rm</command> que removeu muito mais dados do que o pretendido.</para>

	<screen><prompt>#</prompt> <userinput>zfs list -rt all <replaceable>mypool/var/tmp</replaceable></userinput>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/tmp                         262K  93.2G   120K  /var/tmp
mypool/var/tmp@my_recursive_snapshot    88K      -   152K  -
mypool/var/tmp@after_cp               53.5K      -   118K  -
mypool/var/tmp@diff_snapshot              0      -   120K  -
<prompt>#</prompt> <userinput>ls /var/tmp</userinput>
passwd          passwd.copy     vi.recover
<prompt>#</prompt> <userinput>rm /var/tmp/passwd*</userinput>
<prompt>#</prompt> <userinput>ls /var/tmp</userinput>
vi.recover</screen>

	<para>Neste ponto, o usuário percebeu que muitos arquivos foram excluídos e os quer de volta. O <acronym>ZFS</acronym> fornece uma maneira fácil de recuperá-los usando reversões, mas somente quando os snapshots de dados importantes são executados regularmente. Para recuperar os arquivos e recomeçar a partir do último snapshot, emita o comando:</para>

	<screen><prompt>#</prompt> <userinput>zfs rollback <replaceable>mypool/var/tmp@diff_snapshot</replaceable></userinput>
<prompt>#</prompt> <userinput>ls /var/tmp</userinput>
passwd          passwd.copy     vi.recover</screen>

	<para>A operação de reversão restaurou o conjunto de dados para o estado do último snapshot. Também é possível reverter para um snapshot que foi gerado muito antes e que possui outros snapshots criados após ele. Ao tentar fazer isso, o <acronym>ZFS</acronym> irá emitir este aviso:</para>

	<screen><prompt>#</prompt> <userinput>zfs list -rt snapshot <replaceable>mypool/var/tmp</replaceable></userinput>
AME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/tmp@my_recursive_snapshot    88K      -   152K  -
mypool/var/tmp@after_cp               53.5K      -   118K  -
mypool/var/tmp@diff_snapshot              0      -   120K  -
<prompt>#</prompt> <userinput>zfs rollback <replaceable>mypool/var/tmp@my_recursive_snapshot</replaceable></userinput>
cannot rollback to 'mypool/var/tmp@my_recursive_snapshot': more recent snapshots exist
use '-r' to force deletion of the following snapshots:
mypool/var/tmp@after_cp
mypool/var/tmp@diff_snapshot</screen>

	<para>Esse aviso significa que existem snapshots entre o estado atual do conjunto de dados e o snapshot para o qual o usuário deseja retroceder. Para concluir a reversão, esses snapshots devem ser excluídos. O <acronym>ZFS</acronym> não pode rastrear todas as alterações entre estados diferentes do conjunto de dados, porque os snapshots são somente de leitura. O <acronym>ZFS</acronym> não excluirá os snapshots afetados, a menos que o usuário especifique a opção <option>-r</option> para indicar que essa é a ação desejada. Se essa for a intenção e as consequências da perda de todos os snapshots intermediários forem compreendidas, o comando poderá ser emitido:</para>

	<screen><prompt>#</prompt> <userinput>zfs rollback -r <replaceable>mypool/var/tmp@my_recursive_snapshot</replaceable></userinput>
<prompt>#</prompt> <userinput>zfs list -rt snapshot <replaceable>mypool/var/tmp</replaceable></userinput>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/tmp@my_recursive_snapshot     8K      -   152K  -
<prompt>#</prompt> <userinput>ls /var/tmp</userinput>
vi.recover</screen>

	<para>A saída de <command>zfs list -t snapshot</command> confirma que os snapshots intermediários foram removidos como resultado do <command>zfs rollback -r</command>.</para>
      </sect3>

      <sect3 xml:id="zfs-zfs-snapshot-snapdir">
	<title>Restaurando arquivos individuais a partir de Snapshots</title>

	<para>Os snapshots são montados em um diretório oculto no conjunto de dados pai: <filename>.zfs/snapshots/<replaceable>snapshotname</replaceable></filename>. Por padrão, esses diretórios não serão exibidos mesmo quando um <command>ls -a</command> padrão for executado. Embora o diretório não seja exibido, ele está lá e pode ser acessado como qualquer diretório normal. A propriedade denominada <literal>snapdir</literal> controla se esses diretórios ocultos aparecem em uma listagem de diretórios. Definir a propriedade como <literal>visible</literal> permite que eles apareçam na saída do <command>ls</command> e de outros comandos que lidam com o conteúdo do diretório.</para>

	<screen><prompt>#</prompt> <userinput>zfs get snapdir <replaceable>mypool/var/tmp</replaceable></userinput>
NAME            PROPERTY  VALUE    SOURCE
mypool/var/tmp  snapdir   hidden   default
<prompt>#</prompt> <userinput>ls -a /var/tmp</userinput>
.               ..              passwd          vi.recover
<prompt>#</prompt> <userinput>zfs set snapdir=visible <replaceable>mypool/var/tmp</replaceable></userinput>
<prompt>#</prompt> <userinput>ls -a /var/tmp</userinput>
.               ..              .zfs            passwd          vi.recover</screen>

	<para>Arquivos individuais podem ser facilmente restaurados para um estado anterior, copiando-os do snapshot de volta para o conjunto de dados pai. A estrutura de diretórios abaixo de <filename>.zfs/snapshot</filename> tem um diretório nomeado exatamente como os instantâneos criados anteriormente para facilitar sua identificação. No próximo exemplo, presume-se que um arquivo deve ser restaurado a partir do diretório <filename>.zfs</filename> oculto, copiando-o do snapshot que continha a versão mais recente do arquivo:</para>

	<screen><prompt>#</prompt> <userinput>rm /var/tmp/passwd</userinput>
<prompt>#</prompt> <userinput>ls -a /var/tmp</userinput>
.               ..              .zfs            vi.recover
<prompt>#</prompt> <userinput>ls /var/tmp/.zfs/snapshot</userinput>
after_cp                my_recursive_snapshot
<prompt>#</prompt> <userinput>ls /var/tmp/.zfs/snapshot/<replaceable>after_cp</replaceable></userinput>
passwd          vi.recover
<prompt>#</prompt> <userinput>cp /var/tmp/.zfs/snapshot/<replaceable>after_cp/passwd</replaceable> <replaceable>/var/tmp</replaceable></userinput></screen>

	<para>Quando o comando <command>ls .zfs/snapshot</command> foi emitido, a propriedade <literal>snapdir</literal> pode ter sido definida como oculta, mas ainda seria possível listar o conteúdo desse diretório. Cabe ao administrador decidir se esses diretórios serão exibidos. É possível exibi-los para determinados conjuntos de dados e impedi-los para outros. Copiar arquivos ou diretórios deste diretório <filename>.zfs/snapshot</filename> oculto é bastante simples. Tentar o contrário, resulta neste erro:</para>

	<screen><prompt>#</prompt> <userinput>cp <replaceable>/etc/rc.conf</replaceable> /var/tmp/.zfs/snapshot/<replaceable>after_cp/</replaceable></userinput>
cp: /var/tmp/.zfs/snapshot/after_cp/rc.conf: Read-only file system</screen>

	<para>O erro lembra ao usuário que os snapshots são somente de leitura e não podem ser alterados após a criação. Os arquivos não podem ser copiados para ou removidos dos diretórios de snapshot porque isso alteraria o estado do conjunto de dados que eles representam.</para>

	<para>Os snapshots consomem espaço com base em quanto o sistema de arquivos pai foi alterado desde o momento da criação do snapshot. A propriedade <literal>written</literal> de um snapshot rastreia quanto espaço está sendo usado pelo snapshot.</para>

	<para>Snapshots são destruídos e o espaço recuperado com o <command>zfs destroy <replaceable>dataset</replaceable>@<replaceable>snapshot</replaceable></command>. Adicionar <option>-r</option> remove recursivamente todos os snapshots com o mesmo nome sob o conjunto de dados pai. Adicionar <option>-n -v</option> ao comando exibe uma lista dos snapshots que seriam excluídos e uma estimativa de quanto espaço seria recuperado sem executar a operação de destruição real.</para>
      </sect3>
    </sect2>

    <sect2 xml:id="zfs-zfs-clones">
      <title>Gerenciando Clones</title>

      <para>Um clone é uma cópia de um snapshot que é tratado mais como um conjunto de dados regular. Ao contrário de um snapshot, um clone não é somente de leitura, ele pode ser montado e pode ter suas próprias propriedades. Uma vez que um clone tenha sido criado usando <command>zfs clone</command>, o snapshot do qual ele foi criado não pode ser destruído. O relacionamento filho/pai entre o clone e o snapshot pode ser revertido usando <command>zfs promote</command>. Depois que um clone é promovido, o snapshot se torna um filho do clone, em vez de filho do conjunto de dados pai original. Isso mudará a maneira como o espaço é contabilizado, mas não mudará a quantidade de espaço consumida. O clone pode ser montado em qualquer ponto dentro da hierarquia do sistema de arquivos <acronym>ZFS</acronym>, não apenas abaixo do local original do snapshot.</para>

      <para>Para demonstrar o recurso de clonagem, este conjunto de dados de exemplo é usado:</para>

      <screen><prompt>#</prompt> <userinput>zfs list -rt all <replaceable>camino/home/joe</replaceable></userinput>
NAME                    USED  AVAIL  REFER  MOUNTPOINT
camino/home/joe         108K   1.3G    87K  /usr/home/joe
camino/home/joe@plans    21K      -  85.5K  -
camino/home/joe@backup    0K      -    87K  -</screen>

      <para>Um uso típico de clones é experimentar um conjunto de dados específico, mantendo o snapshot em volta, para o caso de algo dar errado. Como os snapshots não podem ser alterados, um clone de leitura/gravação de um snapshot é criado. Depois que o resultado desejado é alcançado no clone, o clone pode ser promovido para se tornar um conjunto de dados e o sistema de arquivos antigo é removido. Isso não é estritamente necessário, pois o clone e o conjunto de dados podem coexistir sem problemas.</para>

      <screen><prompt>#</prompt> <userinput>zfs clone <replaceable>camino/home/joe</replaceable>@<replaceable>backup</replaceable> <replaceable>camino/home/joenew</replaceable></userinput>
<prompt>#</prompt> <userinput>ls /usr/home/joe*</userinput>
/usr/home/joe:
backup.txz     plans.txt

/usr/home/joenew:
backup.txz     plans.txt
<prompt>#</prompt> <userinput>df -h /usr/home</userinput>
Filesystem          Size    Used   Avail Capacity  Mounted on
usr/home/joe        1.3G     31k    1.3G     0%    /usr/home/joe
usr/home/joenew     1.3G     31k    1.3G     0%    /usr/home/joenew</screen>

      <para>Depois que um clone é criado, ele é uma cópia exata do estado em que o conjunto de dados estava quando o snapshot foi criado. O clone agora pode ser alterado independentemente de seu conjunto de dados de origem. A única conexão entre os dois é o snapshot. O <acronym>ZFS</acronym> registra essa conexão na propriedade <literal>origin</literal>. Uma vez que a dependência entre o snapshot e o clone foi removida promovendo-se o clone usando <command>zfs promote</command>, a <literal>origem</literal> do clone é removida, pois agora ele é um conjunto de dados independente. Este exemplo demonstra isso:</para>

      <screen><prompt>#</prompt> <userinput>zfs get origin <replaceable>camino/home/joenew</replaceable></userinput>
NAME                  PROPERTY  VALUE                     SOURCE
camino/home/joenew    origin    camino/home/joe@backup    -
<prompt>#</prompt> <userinput>zfs promote <replaceable>camino/home/joenew</replaceable></userinput>
<prompt>#</prompt> <userinput>zfs get origin <replaceable>camino/home/joenew</replaceable></userinput>
NAME                  PROPERTY  VALUE   SOURCE
camino/home/joenew    origin    -       -</screen>

      <para>Depois de fazer algumas alterações, como copiar o <filename>loader.conf</filename> para o clone promovido, por exemplo, o diretório antigo torna-se obsoleto nesse caso. Em vez disso, o clone promovido pode substituí-lo. Isso pode ser conseguido por dois comandos consecutivos: <command>zfs destroy</command> no dataset antigo e <command>zfs rename</command> no clone para nomeá-lo como o conjunto de dados antigo (ele também poderia ter um nome totalmente diferente).</para>

      <screen><prompt>#</prompt> <userinput>cp <replaceable>/boot/defaults/loader.conf</replaceable> <replaceable>/usr/home/joenew</replaceable></userinput>
<prompt>#</prompt> <userinput>zfs destroy -f <replaceable>camino/home/joe</replaceable></userinput>
<prompt>#</prompt> <userinput>zfs rename <replaceable>camino/home/joenew</replaceable> <replaceable>camino/home/joe</replaceable></userinput>
<prompt>#</prompt> <userinput>ls /usr/home/joe</userinput>
backup.txz     loader.conf     plans.txt
<prompt>#</prompt> <userinput>df -h <replaceable>/usr/home</replaceable></userinput>
Filesystem          Size    Used   Avail Capacity  Mounted on
usr/home/joe        1.3G    128k    1.3G     0%    /usr/home/joe</screen>

      <para>O snapshot clonado agora é tratado como um conjunto de dados comum. Ele contém todos os dados do snapshot original mais os arquivos que foram adicionados a ele como o <filename>loader.conf</filename>. Os clones podem ser usados em diferentes cenários para fornecer recursos úteis aos usuários do ZFS. Por exemplo, as jails podem ser disponibilizados como snapshots contendo diferentes conjuntos de aplicativos instalados. Os usuários podem clonar esses snapshots e adicionar seus próprios aplicativos como acharem melhor. Uma vez satisfeitos com as alterações, os clones podem ser promovidos a conjuntos de dados completos e fornecidos aos usuários finais para que trabalhem como se estivessem com um conjunto de dados real. Fornecer estes jails economiza tempo e sobrecarga administrativa.</para>
    </sect2>

    <sect2 xml:id="zfs-zfs-send">
      <title>Replicação</title>

      <para>Manter os dados em um único pool e em um único local o expõe a riscos como roubo e desastres naturais ou humanos. Fazer backups regulares de todo o pool é vital. O <acronym>ZFS</acronym> fornece um recurso de serialização integrado que pode enviar uma representação de fluxo dos dados para a saída padrão. Usando essa técnica, é possível não apenas armazenar os dados em outro pool conectado ao sistema local, mas também enviá-los por uma rede para outro sistema. Os snapshots são a base para essa replicação (consulte a seção sobre <link linkend="zfs-zfs-snapshot"> snapshots <acronym>ZFS</acronym></link>). Os comandos usados para replicar dados são <command>zfs send</command> e <command>zfs receive</command>.</para>

      <para>Estes exemplos demonstram a replicação do <acronym>ZFS</acronym> com estes dois pools:</para>

      <screen><prompt>#</prompt> <userinput>zpool list</userinput>
NAME    SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG   CAP  DEDUP  HEALTH  ALTROOT
backup  960M    77K   896M         -         -     0%    0%  1.00x  ONLINE  -
mypool  984M  43.7M   940M         -         -     0%    4%  1.00x  ONLINE  -</screen>

      <para>O pool chamado <replaceable>mypool</replaceable> é o pool principal no qual os dados são gravados e lidos regularmente. Um segundo pool, <replaceable>backup</replaceable> é usado como standby, caso o pool principal fique indisponível. Observe que esse failover não é feito automaticamente pelo <acronym>ZFS</acronym>, mas deve ser feito manualmente por um administrador do sistema, quando necessário. Um snapshot é usado para fornecer uma versão consistente do sistema de arquivos a ser replicado. Depois que um snapshot de <replaceable>mypool</replaceable> tiver sido criado, ele poderá ser copiado para o pool <replaceable>backup</replaceable>. Apenas snapshots podem ser replicados. As alterações feitas desde o snapshot mais recente não serão incluídas.</para>

      <screen><prompt>#</prompt> <userinput>zfs snapshot <replaceable>mypool</replaceable>@<replaceable>backup1</replaceable></userinput>
<prompt>#</prompt> <userinput>zfs list -t snapshot</userinput>
NAME                    USED  AVAIL  REFER  MOUNTPOINT
mypool@backup1             0      -  43.6M  -</screen>

      <para>Agora que existe um snapshot, o <command>zfs send</command> pode ser usado para criar um fluxo representando o conteúdo do snapshot. Esse fluxo pode ser armazenado como um arquivo ou recebido por outro pool. O fluxo é gravado na saída padrão, mas deve ser redirecionado para um arquivo ou canal ou um erro será produzido:</para>

      <screen><prompt>#</prompt> <userinput>zfs send <replaceable>mypool</replaceable>@<replaceable>backup1</replaceable></userinput>
Error: Stream can not be written to a terminal.
You must redirect standard output.</screen>

      <para>Para fazer backup de um conjunto de dados com o <command>zfs send</command>, redirecione para um arquivo localizado no pool de backup montado. Assegure-se de que o pool tenha espaço livre suficiente para acomodar o tamanho do snapshot que está sendo enviado, o que significa todos os dados contidos no snapshot, não apenas as mudanças do snapshot anterior.</para>

      <screen><prompt>#</prompt> <userinput>zfs send <replaceable>mypool</replaceable>@<replaceable>backup1</replaceable> &gt; <replaceable>/backup/backup1</replaceable></userinput>
<prompt>#</prompt> <userinput>zpool list</userinput>
NAME    SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP  HEALTH  ALTROOT
backup  960M  63.7M   896M         -         -     0%     6%  1.00x  ONLINE  -
mypool  984M  43.7M   940M         -         -     0%     4%  1.00x  ONLINE  -</screen>

      <para>O <command>zfs send</command> transferiu todos os dados do snapshot chamado <replaceable>backup1</replaceable> para o pool chamado <replaceable>backup</replaceable>. Criar e enviar esses snapshots pode ser feito automaticamente com uma tarefa agendada do <citerefentry><refentrytitle>cron</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>

      <para>Em vez de armazenar os backups como arquivos compactados, o <acronym>ZFS</acronym> pode recebê-los como um sistema de arquivos ativo, permitindo que os dados de backup sejam acessados diretamente. Para obter os dados reais contidos nesses fluxos, o <command>zfs receive</command> é usado para transformar os fluxos novamente em arquivos e diretórios. O exemplo a seguir combina o <command>zfs send</command> e o <command>zfs receive</command> usando um canal para copiar os dados de um pool para outro. Os dados podem ser usados diretamente no pool de recebimento após a conclusão da transferência. Um conjunto de dados só pode ser replicado para um conjunto de dados vazio.</para>

      <screen><prompt>#</prompt> <userinput>zfs snapshot <replaceable>mypool</replaceable>@<replaceable>replica1</replaceable></userinput>
<prompt>#</prompt> <userinput>zfs send -v <replaceable>mypool</replaceable>@<replaceable>replica1</replaceable> | zfs receive <replaceable>backup/mypool</replaceable></userinput>
send from @ to mypool@replica1 estimated size is 50.1M
total estimated size is 50.1M
TIME        SENT   SNAPSHOT

<prompt>#</prompt> <userinput>zpool list</userinput>
NAME    SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP  HEALTH  ALTROOT
backup  960M  63.7M   896M         -         -     0%     6%  1.00x  ONLINE  -
mypool  984M  43.7M   940M         -         -     0%     4%  1.00x  ONLINE  -</screen>

      <sect3 xml:id="zfs-send-incremental">
	<title>Backups Incrementais</title>

	<para>O <command>zfs send</command> também pode determinar a diferença entre dois snapshots e enviar apenas as diferenças entre os dois. Isso economiza espaço em disco e tempo de transferência. Por exemplo:</para>

	<screen><prompt>#</prompt> <userinput>zfs snapshot <replaceable>mypool</replaceable>@<replaceable>replica2</replaceable></userinput>
<prompt>#</prompt> <userinput>zfs list -t snapshot</userinput>
NAME                    USED  AVAIL  REFER  MOUNTPOINT
mypool@replica1         5.72M      -  43.6M  -
mypool@replica2             0      -  44.1M  -
<prompt>#</prompt> <userinput>zpool list</userinput>
NAME    SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG   CAP  DEDUP  HEALTH  ALTROOT
backup  960M  61.7M   898M         -         -     0%    6%  1.00x  ONLINE  -
mypool  960M  50.2M   910M         -         -     0%    5%  1.00x  ONLINE  -</screen>

	<para>Um segundo snapshot chamado <replaceable>replica2</replaceable> foi criado. Este segundo snapshot contém apenas as alterações feitas no sistema de arquivos entre o snapshot atual e o anterior, <replaceable>replica1</replaceable>. O uso do <command>zfs send -i</command> e a indicação do par de snapshots gera um fluxo de réplica incremental contendo apenas os dados que foram alterados. Isso só será bem-sucedido se o snapshot inicial já existir no lado do recebimento.</para>

	<screen><prompt>#</prompt> <userinput>zfs send -v -i <replaceable>mypool</replaceable>@<replaceable>replica1</replaceable> <replaceable>mypool</replaceable>@<replaceable>replica2</replaceable> | zfs receive <replaceable>/backup/mypool</replaceable></userinput>
send from @replica1 to mypool@replica2 estimated size is 5.02M
total estimated size is 5.02M
TIME        SENT   SNAPSHOT

<prompt>#</prompt> <userinput>zpool list</userinput>
NAME    SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG  CAP  DEDUP  HEALTH  ALTROOT
backup  960M  80.8M   879M         -         -     0%   8%  1.00x  ONLINE  -
mypool  960M  50.2M   910M         -         -     0%   5%  1.00x  ONLINE  -

<prompt>#</prompt> <userinput>zfs list</userinput>
NAME                         USED  AVAIL  REFER  MOUNTPOINT
backup                      55.4M   240G   152K  /backup
backup/mypool               55.3M   240G  55.2M  /backup/mypool
mypool                      55.6M  11.6G  55.0M  /mypool

<prompt>#</prompt> <userinput>zfs list -t snapshot</userinput>
NAME                                         USED  AVAIL  REFER  MOUNTPOINT
backup/mypool@replica1                       104K      -  50.2M  -
backup/mypool@replica2                          0      -  55.2M  -
mypool@replica1                             29.9K      -  50.0M  -
mypool@replica2                                 0      -  55.0M  -</screen>

	<para>O fluxo incremental foi transferido com sucesso. Apenas os dados que foram alterados foram replicados, em vez da totalidade da <replaceable>replica1</replaceable>. Somente as diferenças foram enviadas, o que levou muito menos tempo para transferir e economizou espaço em disco por não copiar o pool completo novamente. Isso é útil quando se precisa confiar em redes lentas ou quando os custos por byte transferido devem ser considerados.</para>

	<para>Um novo sistema de arquivos, <replaceable>backup/mypool</replaceable>, está disponível com todos os arquivos e dados do pool <replaceable>mypool</replaceable>. Se <option>-P</option> for especificado, as propriedades do dataset serão copiadas, incluindo configurações de compactação, cotas e pontos de montagem. Quando <option>-R</option> é especificado, todos os conjuntos de dados filho do dataset indicado serão copiados, juntamente com todas as suas propriedades. O envio e o recebimento podem ser automatizados para que backups regulares sejam criados no segundo pool.</para>
      </sect3>

      <sect3 xml:id="zfs-send-ssh">
	<title>Envio de backups criptografados pelo <application>SSH</application></title>

	<para>O envio de fluxos pela rede é uma boa maneira de manter um backup remoto, mas apresenta uma desvantagem. Os dados enviados pelo link de rede não são criptografados, permitindo que qualquer pessoa intercepte e transforme os fluxos de volta em dados sem o conhecimento do usuário remetente. Isso é indesejável, especialmente ao enviar os fluxos pela Internet para um host remoto. O <application>SSH</application> pode ser usado para criptografar com segurança os dados enviados por uma conexão de rede. Como o <acronym>ZFS</acronym> requer apenas que o fluxo seja redirecionado da saída padrão, é relativamente fácil transmiti-lo através do <application>SSH</application>. Para manter o conteúdo do sistema de arquivos criptografado em trânsito e no sistema remoto, considere o uso do <link xlink:href="https://wiki.freebsd.org/PEFS">PEFS</link>.</para>

	<para>Algumas configurações e precauções de segurança devem ser concluídas primeiro. Apenas as etapas necessárias para a operação do <command>zfs send</command> são mostradas aqui. Para mais informações sobre o <application>SSH</application>, consulte <xref linkend="openssh"/>.</para>

	<para>Essa configuração é necessária:</para>

	<itemizedlist>
	  <listitem>
	    <para>Acesso <application>SSH</application> sem senha entre o host de envio e recebimento usando chaves <application>SSH</application></para>
	  </listitem>

	  <listitem>
	    <para>Normalmente, os privilégios do usuário <systemitem class="username">root</systemitem> são necessários para enviar e receber fluxos. Isso requer o login no sistema de recebimento como <systemitem class="username">root</systemitem>. No entanto, o login como <systemitem class="username">root</systemitem> vem desabilitado por padrão por motivos de segurança. O sistema <link linkend="zfs-zfs-allow">ZFS Delegation</link> pode ser usado para permitir que um usuário não <systemitem class="username">root</systemitem> em cada sistema execute as respectivas operações de envio e recebimento.</para>
	  </listitem>

	  <listitem>
	    <para>No sistema de envio:</para>

	    <screen><prompt>#</prompt> <userinput>zfs allow -u someuser send,snapshot <replaceable>mypool</replaceable></userinput></screen>
	  </listitem>

	  <listitem>
	    <para>Para montar o pool, o usuário não privilegiado deve ser o dono do diretório e os usuários regulares devem poder montar sistemas de arquivos. No sistema de recebimento:</para>

	    <screen><prompt>#</prompt> <userinput>sysctl vfs.usermount=1</userinput>
vfs.usermount: 0 -&gt; 1
<prompt>#</prompt> <userinput>echo vfs.usermount=1 &gt;&gt; /etc/sysctl.conf</userinput>
<prompt>#</prompt> <userinput>zfs create <replaceable>recvpool/backup</replaceable></userinput>
<prompt>#</prompt> <userinput>zfs allow -u <replaceable>someuser</replaceable> create,mount,receive <replaceable>recvpool/backup</replaceable></userinput>
<prompt>#</prompt> <userinput>chown <replaceable>someuser</replaceable> <replaceable>/recvpool/backup</replaceable></userinput></screen>
	  </listitem>
	</itemizedlist>

	<para>O usuário sem privilégios agora tem a capacidade de receber e montar conjuntos de dados, e o conjunto de dados <replaceable>home</replaceable> pode ser replicado para o sistema remoto:</para>

	<screen><prompt>%</prompt> <userinput>zfs snapshot -r <replaceable>mypool/home</replaceable>@<replaceable>monday</replaceable></userinput>
<prompt>%</prompt> <userinput>zfs send -R <replaceable>mypool/home</replaceable>@<replaceable>monday</replaceable> | ssh <replaceable>someuser@backuphost</replaceable> zfs recv -dvu <replaceable>recvpool/backup</replaceable></userinput></screen>

	<para>Um snapshot recursivo chamado <replaceable>monday</replaceable> é composto do conjunto de dados do sistema de arquivos <replaceable>home</replaceable> que reside no pool <replaceable>mypool</replaceable>. Em seguida, ele é enviado com o <command>zfs send -R</command> para incluir o conjunto de dados, todos os conjuntos de dados filho, snapshots, clones e configurações no fluxo. A saída é canalizada para o <command>zfs receive</command> em espera no host remoto <replaceable>backuphost</replaceable> através do <application>SSH</application>. Recomenda-se a utilização de um nome de domínio totalmente qualificado ou do endereço IP. A máquina receptora grava os dados no conjunto de dados <replaceable>backup</replaceable> no pool <replaceable>recvpool</replaceable>. Adicionar <option>-d</option> ao <command>zfs recv</command> sobrescreve o nome do pool no lado de recebimento com o nome do snapshot. A opção <option> -u </option> faz com que os sistemas de arquivos não sejam montados no lado do recebimento. Quando <option> -v </option> é incluído, mais detalhes sobre a transferência são mostrados, incluindo o tempo decorrido e a quantidade de dados transferidos.</para>
      </sect3>
    </sect2>

    <sect2 xml:id="zfs-zfs-quota">
      <title>Cotas para Datasets, Usuários e Grupos</title>

      <para><link linkend="zfs-term-quota">As cotas para dataset</link> são usadas para restringir a quantidade de espaço que pode ser consumida por um determinado conjunto de dados. As <link linkend="zfs-term-refquota">cotas de referência</link> funcionam basicamente da mesma maneira, mas contam apenas o espaço usado pelo próprio conjunto de dados, excluindo snapshots e conjuntos de dados filho. Da mesma forma, as cotas para <link linkend="zfs-term-userquota">usuário</link> e para <link linkend="zfs-term-groupquota">grupo</link> podem ser usadas para impedir que usuários ou grupos usem todo o espaço do pool ou do conjunto de dados.</para>

      <para>Os exemplos a seguir pressupõem que os usuários já existam no sistema. Antes de adicionar um usuário ao sistema, certifique-se de criar seu dataset antes e defina o seu <option>mountpoint</option> para <literal>/home/<replaceable>bob</replaceable></literal>. Em seguida, crie o usuário e faça com que o diretório inicial aponte para a localização do <option>mountpoint</option> do dataset. Isso definirá corretamente as permissões de proprietário e grupo sem obscurecer nenhum caminho de diretório inicial pré-existente que possa existir.</para>

      <para>Para impor uma cota de dataser de 10 GB para o <filename>storage/home/bob</filename>:</para>

      <screen><prompt>#</prompt> <userinput>zfs set quota=10G storage/home/bob</userinput></screen>

      <para>Para impor uma cota de referência de 10 GB para <filename>storage/home/bob</filename>:</para>

      <screen><prompt>#</prompt> <userinput>zfs set refquota=10G storage/home/bob</userinput></screen>

      <para>Para remover uma cota de 10 GB do <filename>storage/home/bob</filename>:</para>

      <screen><prompt>#</prompt> <userinput>zfs set quota=none storage/home/bob</userinput></screen>

      <para>O formato geral é <literal>userquota@<replaceable>user</replaceable>=<replaceable>size</replaceable></literal> e o nome do usuário deve estar em um destes formatos:</para>

      <itemizedlist>
	<listitem>
	  <para>nome compatível com o <acronym>POSIX</acronym>, como <replaceable>joe</replaceable>.</para>
	</listitem>

	<listitem>
	  <para>ID numérico <acronym>POSIX</acronym>, como <replaceable>789</replaceable>.</para>
	</listitem>

	<listitem>
	  <para>nome <acronym>SID</acronym>, como <replaceable>joe.bloggs@example.com</replaceable>.</para>
	</listitem>

	<listitem>
	  <para>ID numérico <acronym>SID</acronym> , como <replaceable>S-1-123-456-789</replaceable>.</para>
	</listitem>
      </itemizedlist>

      <para>Por exemplo, para impor uma cota de usuário de 50 GB para o usuário chamado <replaceable>joe</replaceable>:</para>

      <screen><prompt>#</prompt> <userinput>zfs set userquota@joe=50G</userinput></screen>

      <para>Para remover qualquer cota:</para>

      <screen><prompt>#</prompt> <userinput>zfs set userquota@joe=none</userinput></screen>

      <note>
	<para>As propriedades da cota do usuário não são exibidas pelo <command>zfs get all</command>. Os usuários que não são o <systemitem class="username">root</systemitem> só podem ver suas próprias cotas, a menos que tenham recebido o privilégio <literal>userquota</literal>. Os usuários com esse privilégio podem visualizar e definir a cota de todos.</para>
      </note>

      <para>O formato geral para definir uma cota de grupo é: <literal>groupquota@<replaceable>group</replaceable>=<replaceable>size</replaceable></literal>.</para>

      <para>Para definir a cota do grupo <replaceable>firstgroup</replaceable> para 50 GB, use:</para>

      <screen><prompt>#</prompt> <userinput>zfs set groupquota@firstgroup=50G</userinput></screen>

      <para>Para remover a cota do grupo <replaceable>firstgroup</replaceable> ou para certificar-se de que uma não está definida, use:</para>

      <screen><prompt>#</prompt> <userinput>zfs set groupquota@firstgroup=none</userinput></screen>

      <para>Assim como a propriedade de cota do usuário, os usuários que não são <systemitem class="username">root</systemitem> só podem ver as cotas associadas aos grupos aos quais eles pertencem. No entanto, o <systemitem class="username">root</systemitem> ou um usuário com o privilégio <literal>groupquota</literal> pode visualizar e definir todas as cotas para todos os grupos.</para>

      <para>Para exibir a quantidade de espaço utilizada por cada usuário em um sistema de arquivos ou snapshot junto com quaisquer cotas, use <command>zfs userspace</command>. Para informações de grupo, use <command>zfs groupspace</command>. Para obter maiores informações sobre opções suportadas ou sobre como exibir apenas opções específicas, consulte <citerefentry><refentrytitle>zfs</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</para>

      <para>Usuários com privilégios suficientes, e o <systemitem class="username">root</systemitem>, podem listar a cota para <filename>storage/home/bob</filename> usando:</para>

      <screen><prompt>#</prompt> <userinput>zfs get quota storage/home/bob</userinput></screen>
    </sect2>

    <sect2 xml:id="zfs-zfs-reservation">
      <title>Reservas</title>

      <para>As <link linkend="zfs-term-reservation">reservas</link> garantem uma quantidade mínima de espaço sempre disponível em um conjunto de dados. O espaço reservado não estará disponível para nenhum outro conjunto de dados. Esse recurso pode ser especialmente útil para garantir que haja espaço livre disponível para um conjunto de dados ou arquivos de log importantes.</para>

      <para>O formato geral da propriedade <literal>reservation</literal> é <literal>reservation=<replaceable>size</replaceable></literal>, portanto, para definir uma reserva de 10 GB em <filename>storage/home/bob</filename>, use:</para>

      <screen><prompt>#</prompt> <userinput>zfs set reservation=10G storage/home/bob</userinput></screen>

      <para>Para cancelar qualquer reserva:</para>

      <screen><prompt>#</prompt> <userinput>zfs set reservation=none storage/home/bob</userinput></screen>

      <para>O mesmo princípio pode ser aplicado à propriedade <literal>refreservation</literal> para definir uma <link linkend="zfs-term-refreservation">Reserva de Referência</link>, com o formato geral <literal>refreservation=<replaceable>size</replaceable></literal>.</para>

      <para>Este comando mostra todas as reservas ou atualizações existentes no<filename>storage/home/bob</filename>:</para>

      <screen><prompt>#</prompt> <userinput>zfs get reservation storage/home/bob</userinput>
<prompt>#</prompt> <userinput>zfs get refreservation storage/home/bob</userinput></screen>
    </sect2>

    <sect2 xml:id="zfs-zfs-compression">
      <title>Compressão</title>

      <para>O <acronym>ZFS</acronym> fornece compactação transparente. A compactação de dados no nível do bloco a medida que ele é escrito, não apenas economiza espaço, mas também pode aumentar a performance do disco. Se os dados forem compactados em 25%, mas os dados compactados forem gravados no disco na mesma taxa da versão descompactada, resulta em uma velocidade efetiva de gravação de 125%. A compactação também pode ser uma ótima alternativa para <link linkend="zfs-zfs-deduplication">Deduplicação</link> porque não requer memória adicional.</para>

      <para>O <acronym>ZFS</acronym> oferece vários algoritmos de compactação diferentes, cada um com diferentes compensações. Com a introdução da compactação <acronym>LZ4</acronym> no <acronym>ZFS</acronym> v5000, é possível ativar a compactação para todo o pool sem o trade-off de desempenho de outros algoritmos. A maior vantagem do <acronym>LZ4</acronym> é o recurso <emphasis>early abort</emphasis>. Se o <acronym>LZ4</acronym> não atingir pelo menos 12,5% de compactação na primeira parte dos dados, o bloco será gravado descompactado para evitar o desperdício de ciclos da CPU que tentam compactar dados já compactados ou não compactáveis. Para obter detalhes sobre os diferentes algoritmos de compactação disponíveis no <acronym>ZFS</acronym>, consulte a entrada <link linkend="zfs-term-compression">Compactação</link> na seção de terminologia.</para>

      <para>O administrador pode monitorar a eficácia da compactação usando várias propriedades do conjunto de dados.</para>

      <screen><prompt>#</prompt> <userinput>zfs get used,compressratio,compression,logicalused <replaceable>mypool/compressed_dataset</replaceable></userinput>
NAME        PROPERTY          VALUE     SOURCE
mypool/compressed_dataset  used              449G      -
mypool/compressed_dataset  compressratio     1.11x     -
mypool/compressed_dataset  compression       lz4       local
mypool/compressed_dataset  logicalused       496G      -</screen>

      <para>O conjunto de dados está usando atualmente 449 GB de espaço (a propriedade used). Sem compressão, seriam necessários 496 GB de espaço (a propriedade <literal>logicalused</literal>). Isso resulta na taxa de compactação de 1,11: 1.</para>

      <para>A compactação pode ter um efeito colateral inesperado quando combinada com <link linkend="zfs-term-userquota">cotas de usuário</link>. As cotas de usuários restringem a quantidade de espaço que um usuário pode consumir em um conjunto de dados, mas as medidas são baseadas em quanto espaço é usado <emphasis>após a compactação</emphasis>. Portanto, se um usuário tiver uma cota de 10 GB e gravar 10 GB de dados compactáveis, eles ainda poderão armazenar dados adicionais. Se, posteriormente, atualizarem um arquivo, digamos um banco de dados, com dados mais ou menos compactáveis, a quantidade de espaço disponível para eles será alterada. Isso pode resultar na situação ímpar em que um usuário não aumentou a quantidade real de dados (a propriedade <literal>logicalused</literal>), mas a alteração na compactação fez com que eles atingissem seu limite de cota.</para>

      <para>A compactação pode ter uma interação inesperada semelhante com backups. Muitas vezes, as cotas são usadas para limitar a quantidade de dados que podem ser armazenados para garantir que haja espaço de backup suficiente disponível. No entanto, uma vez que as cotas não consideram a compactação, mais dados podem ser gravados do que caberia com os backups descompactados.</para>
    </sect2>

    <sect2 xml:id="zfs-zfs-deduplication">
      <title>Desduplicação</title>

      <para>Quando ativado, a <link linkend="zfs-term-deduplication">deduplicação</link> usa o checksum de cada bloco para detectar blocos duplicados. Quando um novo bloco é uma duplicata de um bloco existente, o <acronym>ZFS</acronym> grava uma referência adicional aos dados existentes, em vez de todo o bloco duplicado. Uma enorme economia de espaço é possível se os dados contiverem muitos arquivos duplicados ou informações repetidas. Esteja avisado: a desduplicação requer uma quantidade extremamente grande de memória, e a maior parte da economia de espaço pode ser obtida sem o custo extra, permitindo a compactação.</para>

      <para>Para ativar a deduplicação, defina a propriedade <literal>dedup</literal> no pool de destino:</para>

      <screen><prompt>#</prompt> <userinput>zfs set dedup=on <replaceable>pool</replaceable></userinput></screen>

      <para>Somente novos dados sendo gravados no pool serão desduplicados. Os dados que já foram gravados no pool não serão desduplicados simplesmente ativando essa opção. Um pool com uma propriedade de desduplicação ativada recentemente será semelhante a este exemplo:</para>

      <screen><prompt>#</prompt> <userinput>zpool list</userinput>
NAME  SIZE ALLOC  FREE   CKPOINT  EXPANDSZ   FRAG   CAP   DEDUP   HEALTH   ALTROOT
pool 2.84G 2.19M 2.83G         -         -     0%    0%   1.00x   ONLINE   -</screen>

      <para>A coluna <literal>DEDUP</literal> mostra a taxa real de deduplicação para o pool. Um valor de <literal>1.00x</literal> mostra que os dados ainda não foram desduplicados. No próximo exemplo, a árvore de ports é copiada três vezes em diretórios diferentes no pool desduplicado criado acima.</para>

      <screen><prompt>#</prompt> <userinput>for d in dir1 dir2 dir3; do</userinput>
&gt; <userinput>mkdir $d &amp;&amp; cp -R /usr/ports $d &amp;</userinput>
&gt; <userinput>done</userinput></screen>

      <para>Dados redundantes são detectados e desduplicados:</para>

      <screen><prompt>#</prompt> <userinput>zpool list</userinput>
NAME SIZE  ALLOC  FREE   CKPOINT  EXPANDSZ   FRAG  CAP   DEDUP   HEALTH   ALTROOT
pool 2.84G 20.9M 2.82G         -         -     0%   0%   3.00x   ONLINE   -</screen>

      <para>A coluna <literal>DEDUP</literal> mostra um fator de <literal>3.00x</literal>. Várias cópias dos dados da árvore de ports foram detectadas e desduplicadas, usando apenas um terço do espaço. O potencial de economia de espaço pode ser enorme, mas com o custo de ter memória suficiente para rastrear os blocos desduplicados.</para>

      <para>A desduplicação nem sempre é benéfica, especialmente quando os dados em um pool não são redundantes. O <acronym>ZFS</acronym> pode mostrar uma possível economia de espaço ao simular a desduplicação em um pool existente:</para>

      <screen><prompt>#</prompt> <userinput>zdb -S <replaceable>pool</replaceable></userinput>
Simulated DDT histogram:

bucket              allocated                       referenced
______   ______________________________   ______________________________
refcnt   blocks   LSIZE   PSIZE   DSIZE   blocks   LSIZE   PSIZE   DSIZE
------   ------   -----   -----   -----   ------   -----   -----   -----
     1    2.58M    289G    264G    264G    2.58M    289G    264G    264G
     2     206K   12.6G   10.4G   10.4G     430K   26.4G   21.6G   21.6G
     4    37.6K    692M    276M    276M     170K   3.04G   1.26G   1.26G
     8    2.18K   45.2M   19.4M   19.4M    20.0K    425M    176M    176M
    16      174   2.83M   1.20M   1.20M    3.33K   48.4M   20.4M   20.4M
    32       40   2.17M    222K    222K    1.70K   97.2M   9.91M   9.91M
    64        9     56K   10.5K   10.5K      865   4.96M    948K    948K
   128        2   9.50K      2K      2K      419   2.11M    438K    438K
   256        5   61.5K     12K     12K    1.90K   23.0M   4.47M   4.47M
    1K        2      1K      1K      1K    2.98K   1.49M   1.49M   1.49M
 Total    2.82M    303G    275G    275G    3.20M    319G    287G    287G

dedup = 1.05, compress = 1.11, copies = 1.00, dedup * compress / copies = 1.16</screen>

      <para>Depois que o <command>zdb -S</command> termina de analisar o pool, ele mostra a taxa de redução de espaço que seria obtida ativando a deduplicação. Nesse caso, <literal>1.16</literal> é uma taxa de economia de espaço muito baixa e que poderia ser obtida apenas com a compactação. A ativação da deduplicação neste pool não salvaria uma quantidade significativa de espaço e não vale a quantidade de memória necessária para ativar a deduplicação. Usando a fórmula <emphasis>ratio = dedup * compress / copies</emphasis>, os administradores do sistema podem planejar a alocação de armazenamento, decidindo se a carga de trabalho conterá blocos duplicados suficientes para justificar os requisitos de memória. Se os dados forem razoavelmente compactáveis, a economia de espaço poderá ser muito boa. Recomenda-se ativar a compactação primeiro pois ela também pode aumentar significativamente a performance do sistema. Ative a deduplicação somente nos casos em que a economia adicional será considerável e se houver memória suficiente para o <link linkend="zfs-term-deduplication"><acronym>DDT</acronym></link>.</para>
    </sect2>

    <sect2 xml:id="zfs-zfs-jail">
      <title><acronym>ZFS</acronym> e Jails</title>

      <para>O <command>zfs jail</command> e a propriedade <literal>jailed</literal> correspondente são usadas para delegar um conjunto de dados <acronym>ZFS</acronym> para uma <link linkend="jails">Jail</link>. O <command>zfs jail <replaceable>jailid</replaceable></command> anexa um dataset à jail especificada, e o <command>zfs unjail</command> o desanexa. Para que o conjunto de dados seja controlado de dentro de uma jail, a propriedade <literal>jailed</literal> deve ser configurada. Depois que um conjunto de dados é anexado a uma jail, ele não pode mais ser montado no host porque ele poderá ter pontos de montagem que comprometam a segurança do host.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="zfs-zfs-allow">
    <title>Administração Delegada</title>

    <para>Um sistema abrangente de delegação de permissão permite que usuários sem privilégios realizem funções de administração do <acronym>ZFS</acronym>. Por exemplo, se o diretório pessoal de cada usuário for um conjunto de dados, os usuários poderão receber permissão para criar e destruir snapshots de seus diretórios pessoais. Um usuário de backup pode receber permissão para usar recursos de replicação. Um script de estatísticas de uso pode ter permissão para ser executado com acesso apenas aos dados de utilização de espaço para todos os usuários. É ainda possível delegar a capacidade de delegar permissões. A delegação de permissão é possível para cada subcomando e para a maioria das propriedades.</para>

    <sect2 xml:id="zfs-zfs-allow-create">
      <title>Delegando a criação de conjunto de dados</title>

      <para>O <command>zfs allow <replaceable>someuser</replaceable> create <replaceable>mydataset</replaceable></command> concede ao usuário especificado permissão para criar conjuntos de dados filho sob o conjunto de dados pai selecionado. Há uma ressalva: criar um novo conjunto de dados envolve montá-lo. Isso requer configurar o <literal>vfs.usermount</literal> <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> do FreeBSD para <literal>1</literal> para permitir que usuários não-root montem um sistema de arquivos. Existe outra restrição que visa impedir o abuso: os usuários que não são <systemitem class="username">root</systemitem> devem ser donos do ponto de montagem onde o sistema de arquivos deve ser montado.</para>
    </sect2>

    <sect2 xml:id="zfs-zfs-allow-allow">
      <title>Delegando a delegação de permissão</title>

      <para>O <command>zfs allow <replaceable>someuser</replaceable> allow <replaceable>mydataset</replaceable></command> permite ao usuário especificado atribuir qualquer permissão que tenha no conjunto de dados de destino, ou nos seus filhos, para outros usuários . Se um usuário tiver a permissão <literal>snapshot</literal> e a permissão <literal>allow</literal>, esse usuário poderá conceder a permissão <literal>snapshot</literal> para outros usuários.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="zfs-advanced">
    <title>Tópicos Avançados</title>

    <sect2 xml:id="zfs-advanced-tuning">
      <title>Otimizações</title>

      <para>Existem vários parametros que podem ser ajustados para tornar o <acronym>ZFS</acronym> melhor para diferentes cargas de trabalho.</para>

      <itemizedlist>
	<listitem>
	  <para xml:id="zfs-advanced-tuning-arc_max"><emphasis><varname>vfs.zfs.arc_max</varname></emphasis> - Tamanho máximo do <link linkend="zfs-term-arc"> <acronym>ARC</acronym></link>. O padrão é toda a memória <acronym>RAM</acronym> menos 1 GB, ou metade da <acronym>RAM</acronym>, o que for maior. No entanto, um valor menor deve ser usado se o sistema estiver executando quaisquer outros daemons ou processos que possam requerer memória. Este valor pode ser ajustado em tempo de execução com <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>  e pode ser configurado no <filename>/boot/loader.conf</filename> ou <filename>/etc/sysctl.conf</filename>.</para>
	</listitem>

	<listitem>
	  <para xml:id="zfs-advanced-tuning-arc_meta_limit"><emphasis> <varname> vfs.zfs.arc_meta_limit </varname> </emphasis> - Limita a parte do <link linkend="zfs-term-arc"><acronym>ARC</acronym></link> que pode ser usado para armazenar metadados. O padrão é um quarto de <varname>vfs.zfs.arc_max</varname>. Aumentar esse valor melhorará o desempenho se a carga de trabalho envolver operações em um grande número de arquivos e diretórios ou operações de metadados frequentes, ao custo de caber menos dados de arquivo no <link linkend="zfs-term-arc"><acronym>ARC</acronym></link>. Este valor pode ser ajustado em tempo de execução com <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> e pode ser configurado em <filename>/boot/loader.conf</filename> ou <filename>/etc/sysctl.conf</filename>.</para>
	</listitem>

	<listitem>
	  <para xml:id="zfs-advanced-tuning-arc_min"><emphasis> <varname> vfs.zfs.arc_min </varname></emphasis> - Tamanho mínimo do <link linkend="zfs-term-arc"> <acronym>ARC</acronym></link>. O padrão é metade de <varname>vfs.zfs.arc_meta_limit</varname>. Ajuste esse valor para evitar que outros aplicativos pressionem o <link linkend="zfs-term-arc"><acronym>ARC</acronym></link> inteiro. Este valor pode ser ajustado em tempo de execução com <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> e pode ser configurado em <filename>/boot/loader.conf</filename> ou <filename>/etc/sysctl.conf</filename>.</para>
	</listitem>

	<listitem>
	  <para xml:id="zfs-advanced-tuning-vdev-cache-size"><emphasis> <varname> vfs.zfs.vdev.cache.size </varname> </emphasis> - Uma quantidade pré-alocada de memória reservada como um cache para cada dispositivo no pool. A quantidade total de memória usada será esse valor multiplicado pelo número de dispositivos. Este valor só pode ser ajustado no momento da inicialização e é definido em <filename>/boot/loader.conf</filename>.</para>
	</listitem>

	<listitem>
	  <para xml:id="zfs-advanced-tuning-min-auto-ashift"><emphasis> <varname> vfs.zfs.min_auto_ashift </varname> </emphasis> - Mínimo <varname>ashift</varname> (tamanho do setor) que será usado automaticamente no momento da criação do pool. O valor é uma potência de dois. O valor padrão de <literal>9</literal> representa <literal>2^9 = 512</literal>, um tamanho de setor de 512 bytes. Para evitar <emphasis>amplificação de escrita</emphasis> e para obter o melhor desempenho, defina esse valor para o maior tamanho de setor usado por um dispositivo no pool.</para>

	  <para>Muitas unidades possuem setores de 4 KB. Usar o <varname>ashift</varname> padrão <literal>9</literal> com esses drives resulta em amplificação de gravação nesses dispositivos. Os dados que podem estar contidos em uma única gravação de 4 KB devem, em vez disso, ser gravados em oito gravações de 512 bytes. O <acronym>ZFS</acronym> tenta ler o tamanho do setor nativo de todos os dispositivos ao criar um pool, mas muitas unidades com setores de 4 KB relatam que seus setores têm 512 bytes para compatibilidade. Configure o <varname>vfs.zfs.min_auto_ashift</varname> para <literal>12</literal> (<literal>2^12=4096</literal>) antes de criar um pool irá forçar o <acronym>ZFS</acronym> a usar blocos de 4 KB para melhor desempenho nessas unidades.</para>

	  <para>Forçar blocos de 4 KB também é útil em pools em que as atualizações de disco são planejadas. Os discos futuros provavelmente usarão setores de 4 KB, e os valores de <varname>ashift</varname> não poderão ser alterados depois que um pool for criado.</para>

	  <para>Em alguns casos específicos, o menor tamanho de bloco de 512 bytes pode ser preferível. Quando usado com discos de 512 bytes para bancos de dados, ou como armazenamento para máquinas virtuais, menos dados são transferidos durante pequenas leituras aleatórias. Isso pode fornecer melhor desempenho, especialmente ao usar um tamanho de registro <acronym>ZFS</acronym> menor.</para>
	</listitem>

	<listitem>
	  <para xml:id="zfs-advanced-tuning-prefetch_disable"><emphasis> <varname> vfs.zfs.prefetch_disable </varname> </emphasis> - Desabilita a pré-busca. Um valor de <literal>0</literal> está ativado e <literal>1</literal> está desativado. O padrão é <literal>0</literal>, a menos que o sistema tenha menos de 4 GB de <acronym>RAM</acronym>. A pré-busca funciona lendo blocos maiores do que os que foram solicitados no <link linkend="zfs-term-arc"><acronym>ARC</acronym></link> na esperança de que os dados sejam necessários em breve. Se a carga de trabalho tiver um grande número de leituras aleatórias, a desativação da pré-busca poderá melhorar o desempenho reduzindo leituras desnecessárias. Este valor pode ser ajustado a qualquer momento com <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
	</listitem>

	<listitem>
	  <para xml:id="zfs-advanced-tuning-vdev-trim_on_init"><emphasis> <varname> vfs.zfs.vdev.trim_on_init </varname> </emphasis> - Controla se os novos dispositivos adicionados ao pool têm o comando <literal>TRIM</literal> executado neles. Isso garante o melhor desempenho e a longevidade dos <acronym>SSD</acronym>s, mas leva um tempo extra. Se o dispositivo já tiver sido apagado de forma segura, a desativação dessa configuração tornará o acréscimo do novo dispositivo mais rápido. Este valor pode ser ajustado a qualquer momento com <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
	</listitem>

	<listitem>
	  <para xml:id="zfs-advanced-tuning-vdev-max_pending"><emphasis> <varname> vfs.zfs.vdev.max_pending </varname> </emphasis> - Limita o número de solicitações de I/O pendentes por dispositivo. Um valor mais alto manterá a fila de comandos do dispositivo cheia e poderá resultar em maior rendimento. Um valor menor reduzirá a latência. Este valor pode ser ajustado a qualquer momento com o <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
	</listitem>

	<listitem>
	  <para xml:id="zfs-advanced-tuning-top_maxinflight"><emphasis> <varname> vfs.zfs.top_maxinflight </varname> </emphasis> - Número máximo de I/Os pendentes por <link linkend="zfs-term-vdev">vdev</link> de nível superior. Limita a profundidade da fila de comandos para evitar alta latência. O limite é por vdev de nível superior, o que significa que o limite se aplica a cada <link linkend="zfs-term-vdev-mirror">Mirror</link>, <link linkend="zfs-term-vdev-raidz">RAID-Z</link>, ou outro vdev independentemente. Este valor pode ser ajustado a qualquer momento com <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
	</listitem>

	<listitem>
	  <para xml:id="zfs-advanced-tuning-l2arc_write_max"><emphasis> <varname> vfs.zfs.l2arc_write_max </varname> </emphasis> - Limita a quantidade de dados gravados no <link linkend="zfs-term-l2arc"><acronym>L2ARC</acronym></link> por segundo. Este ajuste foi projetado para estender a longevidade de <acronym>SSD</acronym>s limitando a quantidade de dados gravados no dispositivo. Este valor pode ser ajustado a qualquer momento com <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
	</listitem>

	<listitem>
	  <para xml:id="zfs-advanced-tuning-l2arc_write_boost"><emphasis> <varname> vfs.zfs.l2arc_write_boost </varname> </emphasis> - O valor deste ajuste é adicionado ao <link linkend="zfs-advanced-tuning-l2arc_write_max"><varname> vfs.zfs.l2arc_write_max </varname> </link> e aumenta a velocidade de gravação para o <acronym>SSD</acronym> até que o primeiro bloco seja removido do <link linkend="zfs-term-l2arc"><acronym>L2ARC</acronym></link>. Esta <quote>Turbo Warmup Phase</quote> é projetada para reduzir a perda de desempenho de um <link linkend="zfs-term-l2arc"><acronym>L2ARC</acronym> </link> vazio após uma reinicialização. Este valor pode ser ajustado a qualquer momento com <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
	</listitem>

	<listitem>
	  <para xml:id="zfs-advanced-tuning-scrub_delay"><emphasis><varname>vfs.zfs.scrub_delay</varname></emphasis> - Número de ticks a serem atrasados entre cada operação de I/O durante um <link linkend="zfs-term-scrub"><command>scrub</command></link>. Para garantir que um <command>scrub</command> não interfira com a operação normal do pool, se qualquer outra <acronym>I/O</acronym> estiver acontecendo, o <command>scrub</command> será atrasado entre cada comando. Esse valor controla o limite no total de <acronym>IOPS</acronym> (I/Os por segundo) gerados pelo <command>scrub</command>. A granularidade da configuração é determinada pelo valor de <varname>kern.hz</varname>, cujo padrão é de 1.000 ticks por segundo. Essa configuração pode ser alterada, resultando em um limite efetivo de <acronym>IOPS</acronym> diferente. O valor padrão é <literal>4</literal>, resultando em um limite de: 1000 ticks/seg/4 = 250 <acronym>IOPS</acronym>. Usar um valor de <replaceable>20</replaceable> daria um limite de: 1000 ticks/seg/20 = 50 <acronym>IOPS</acronym>. A velocidade de <command>scrub</command> é limitada apenas quando houver atividade recente no pool, conforme determinado por <link linkend="zfs-advanced-tuning-scan_idle"><varname>vfs.zfs.scan_idle</varname></link>. Esse valor pode ser ajustado a qualquer momento com <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
	</listitem>

	<listitem>
	  <para xml:id="zfs-advanced-tuning-resilver_delay"><emphasis> <varname> vfs.zfs.resilver_delay </varname> </emphasis> - Número de milissegundos de atraso inserido entre cada I/O durante um <link linkend="zfs-term-resilver">resilver</link> . Para garantir que um resilver não interfira com a operação normal do pool, se qualquer outro I/O estiver acontecendo, o resilver irá atrasar entre cada comando. Esse valor controla o limite de total de <acronym>IOPS</acronym> (I/Os por segundo) gerados pelo resilver. A granularidade da configuração é determinada pelo valor de <varname>kern.hz</varname>, cujo padrão é de 1.000 marcações por segundo. Essa configuração pode ser alterada, resultando em um limite efetivo de <acronym>IOPS</acronym> diferente. O valor padrão é 2, resultando em um limite de: 1000 ticks / seg / 2 = 500 <acronym>IOPS</acronym>. Retornar o pool a um estado <link linkend="zfs-term-online">Online</link> pode ser mais importante se a falha outro dispositivo levar o pool ao estado de <link linkend="zfs-term-faulted">Fault</link>, causando perda de dados. Um valor de 0 dará à operação de resilver a mesma prioridade que outras operações, acelerando o processo de recuperação. A velocidade do resilver é limitada apenas quando houver outra atividade recente no pool, conforme determinado por <link linkend="zfs-advanced-tuning-scan_idle"> <varname>vfs.zfs.scan_idle</varname></link>. Este valor pode ser ajustado a qualquer momento com <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
	</listitem>

	<listitem>
	  <para xml:id="zfs-advanced-tuning-scan_idle"><emphasis> <varname> vfs.zfs.scan_idle </varname> </emphasis> - Número de milissegundos desde a última operação antes do pool ser considerado ocioso. Quando o pool estiver ocioso, a taxa limite para <link linkend="zfs-term-scrub"><command>scrub</command></link> e <link linkend="zfs-term-resilver">resilver</link> fica desativada. Este valor pode ser ajustado a qualquer momento com <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
	</listitem>

	<listitem>
	  <para xml:id="zfs-advanced-tuning-txg-timeout"><emphasis> <varname> vfs.zfs.txg.timeout </varname> </emphasis> - Número máximo de segundos entre os <link linkend="zfs-term-txg">grupos de transações</link>. O grupo de transações atual será gravado no pool e um novo grupo de transações será iniciado se esse período de tempo tiver decorrido desde o grupo de transações anterior. Um grupo de transações pode ser acionado antes se dados suficientes forem gravados. O valor padrão é de 5 segundos. Um valor maior pode melhorar o desempenho de leitura atrasando gravações assíncronas, mas isso pode causar um desempenho irregular quando o grupo de transações é gravado. Este valor pode ser ajustado a qualquer momento com <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
	</listitem>
      </itemizedlist>
    </sect2>

<!-- These sections will be added in the future
    <sect2 xml:id="zfs-advanced-booting">
      <title>Booting Root on <acronym>ZFS</acronym></title>

      <para></para>
    </sect2>

    <sect2 xml:id="zfs-advanced-beadm">
      <title><acronym>ZFS</acronym> Boot Environments</title>

      <para></para>
    </sect2>

    <sect2 xml:id="zfs-advanced-troubleshoot">
      <title>Troubleshooting</title>

      <para></para>
    </sect2>
-->

    <sect2 xml:id="zfs-advanced-i386">
      <title><acronym>ZFS</acronym> em i386</title>

      <para>Alguns dos recursos fornecidos pelo <acronym>ZFS</acronym> consomem muita memória, e podem exigir ajuste para máxima eficiência em sistemas com <acronym>RAM</acronym> limitada.</para>

      <sect3>
	<title>Memória</title>

	<para>Como mínimo, a memória total do sistema deve ter pelo menos um gigabyte. A quantidade de RAM <acronym>recomendada</acronym> depende do tamanho do pool e dos recursos do <acronym>ZFS</acronym> usados. Uma regra geral é 1 GB de RAM para cada 1 TB de armazenamento. Se o recurso de deduplicação for usado, uma regra geral é 5 GB de RAM por TB de armazenamento para ser desduplicado. Enquanto alguns usuários usam com sucesso o <acronym>ZFS</acronym> com menos <acronym>RAM</acronym>, os sistemas sob carga pesada podem entrar em panic devido ao esgotamento da memória. Outros ajustes podem ser necessários para sistemas com uma quantia de memória RAM inferior ao recomendado.</para>
      </sect3>

      <sect3>
	<title>Configuração do Kernel</title>

	<para>Devido às limitações de espaço de endereço da plataforma <trademark>i386</trademark>, os usuários do <acronym>ZFS</acronym> na arquitetura <trademark>i386</trademark> devem adicionar essa opção a um arquivo de configuração de kernel personalizado, reconstruir o kernel e reiniciar:</para>

	<programlisting>options        KVA_PAGES=512</programlisting>

	<para>Isso expande o espaço de endereço do kernel, permitindo que o parametro <varname> vm.kvm_size </varname> seja ajustado além do limite imposto atualmente de 1 GB ou o limite de 2 GB para <acronym>PAE</acronym>. Para encontrar o valor mais adequado para essa opção, divida o espaço de endereço desejado em megabytes por quatro. Neste exemplo, é <literal>512</literal> para 2 GB.</para>
      </sect3>

      <sect3>
	<title>Ajustes do Carregador</title>

	<para>O espaço de endereçamento <filename>kmem</filename> pode ser aumentado em todas as arquiteturas do FreeBSD. Em um sistema de teste com 1 GB de memória física, o sucesso foi alcançado com essas opções abaixo adicionadas ao <filename>/boot/loader.conf</filename>, e o sistema reiniciado:</para>

	<programlisting>vm.kmem_size="330M"
vm.kmem_size_max="330M"
vfs.zfs.arc_max="40M"
vfs.zfs.vdev.cache.size="5M"</programlisting>

	<para>Para obter uma lista mais detalhada de recomendações para otimizações relacionadas ao <acronym>ZFS</acronym>, consulte <link xlink:href="https://wiki.freebsd.org/ZFSTuningGuide"/>.</para>
      </sect3>
    </sect2>
  </sect1>

  <sect1 xml:id="zfs-links">
    <title>Recursos adicionais</title>

    <itemizedlist>
      <listitem>
	<para><link xlink:href="http://open-zfs.org">OpenZFS</link></para>
      </listitem>

      <listitem>
	<para><link xlink:href="https://wiki.freebsd.org/ZFSTuningGuide">FreeBSD Wiki - <acronym>ZFS</acronym> Tuning</link></para>
      </listitem>

      <listitem>
	<para><link xlink:href="http://docs.oracle.com/cd/E19253-01/819-5461/index.html">Oracle Solaris <acronym>ZFS</acronym> Administration Guide</link></para>
      </listitem>

      <listitem>
	<para><link xlink:href="https://calomel.org/zfs_raid_speed_capacity.html">Calomel Blog - <acronym>ZFS</acronym> Raidz Performance, Capacity and Integrity</link></para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="zfs-term">
    <title>Recursos e terminologia do <acronym> ZFS </acronym></title>

    <para>O <acronym>ZFS</acronym> é um sistema de arquivos fundamentalmente diferente, porque é mais do que apenas um sistema de arquivos. O <acronym>ZFS</acronym> combina as funções do sistema de arquivos e do gerenciador de volume, permitindo que dispositivos de armazenamento adicionais sejam adicionados a um sistema ativo e torne o novo espaço disponível em todos os sistemas de arquivos existentes nesse pool imediatamente. Combinando os papéis tradicionalmente separados, o <acronym>ZFS</acronym> é capaz de superar limitações anteriores que impediam o crescimento de grupos <acronym>RAID</acronym>. Cada dispositivo de nível superior em um pool é chamado de <emphasis>vdev</emphasis>, que pode ser um disco simples ou uma transformação <acronym>RAID</acronym> como um espelho ou array <acronym>RAID-Z</acronym>. Os sistemas de arquivos <acronym>ZFS</acronym> (chamados <emphasis>datasets</emphasis>) têm acesso ao espaço livre combinado de todo o pool. À medida que os blocos são alocados do pool, o espaço disponível para cada sistema de arquivos diminui. Essa abordagem evita a armadilha comum com o particionamento extensivo onde o espaço livre se torna fragmentado nas partições.</para>

    <informaltable pgwide="1">
      <tgroup cols="2">
	<tbody valign="top">
	  <row>
	    <entry xml:id="zfs-term-pool">pool</entry>

	    <entry>Um <emphasis>pool</emphasis> de armazenamento é o bloco de construção mais básico do <acronym>ZFS</acronym>. Um pool é composto de um ou mais vdevs, os dispositivos subjacentes que armazenam os dados. Um pool é então usado para criar um ou mais sistemas de arquivos (datasets) ou dispositivos de bloco (volumes). Esses conjuntos de dados e volumes compartilham o espaço livre restante do pool. Cada pool é identificado exclusivamente por um nome e um <acronym>GUID</acronym>. Os recursos disponíveis são determinados pelo número da versão do <acronym>ZFS</acronym> no pool.</entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-vdev">vdev Types</entry>

	    <entry>Um pool é composto de um ou mais vdevs, que podem ser um único disco ou um grupo de discos, no caso de uma transformação <acronym>RAID</acronym>. Quando vários vdevs são usados, o <acronym>ZFS</acronym> propaga dados entre os vdevs para aumentar o desempenho e maximizar o espaço utilizável. <itemizedlist>
		<listitem>
		  <para xml:id="zfs-term-vdev-disk"><emphasis>Disk</emphasis> - O tipo mais básico de vdev é um dispositivo de bloco padrão. Isso pode ser um disco inteiro (como <filename><replaceable>/dev/ada0</replaceable></filename> ou <filename><replaceable>/dev/da0</replaceable></filename>) ou uma partição (<filename><replaceable>/dev/ada0p3</replaceable></filename>). No FreeBSD, não há penalidade de desempenho por usar uma partição em vez de todo o disco. Isso difere das recomendações feitas pela documentação do Solaris.</para>

		  <caution>
		    <para>Usar um disco inteiro como parte de um pool inicializável é altamente desencorajado, pois isso pode tornar o pool não inicializável. Da mesma forma, você não deve usar um disco inteiro como parte de um mirror ou um <acronym>RAID-Z</acronym> vdev. Isso ocorre porque é impossível determinar com segurança o tamanho de um disco não particionado no momento da inicialização e porque não há lugar para inserir código de inicialização.</para>
                  </caution>
		</listitem>

		<listitem>
		  <para xml:id="zfs-term-vdev-file"><emphasis>File</emphasis> - Além dos discos, os pools do <acronym>ZFS</acronym> podem ser suportados por arquivos regulares, o que é especialmente útil para testes e experimentação. Use o caminho completo para o arquivo como o caminho do dispositivo no <command>zpool create</command>. Todos os vdevs devem ter pelo menos 128 MB de tamanho.</para>
		</listitem>

		<listitem>
		  <para xml:id="zfs-term-vdev-mirror"><emphasis>Mirror</emphasis> - Ao criar um espelho, especifique a palavra-chave <literal>mirror</literal> seguida pela lista de dispositivos membros para o espelho. Um espelho consiste em dois ou mais dispositivos, todos os dados serão gravados em todos os dispositivos membros. Um espelho vdev só armazenará tantos dados quanto seu menor membro. Um espelho vdev pode suportar a falha de todos, exceto um de seus membros, sem perder nenhum dado.</para>

		  <note>
		    <para>Um vdev de disco único regular pode ser atualizado para um vdev de espelho a qualquer momento com <command>zpool <link linkend="zfs-zpool-attach">attach</link></command>.</para>
		  </note>
		</listitem>

		<listitem>
		  <para xml:id="zfs-term-vdev-raidz"><emphasis><acronym>RAID-Z</acronym></emphasis> - O <acronym>ZFS</acronym> implementa o <acronym>RAID-Z</acronym>, uma variação do padrão <acronym>RAID-5</acronym> que oferece uma melhor distribuição de paridade e elimina o furo de escrita do <quote><acronym>RAID-5</acronym></quote> no qual os dados e informações de paridade tornam-se inconsistentes após um reinício inesperado. O <acronym>ZFS</acronym> suporta três níveis de <acronym>RAID-Z</acronym>, que fornecem vários níveis de redundância em troca de níveis decrescentes de armazenamento utilizável. Os tipos são nomeados de <acronym>RAID-Z1</acronym> até <acronym>RAID-Z3</acronym> com base no número de dispositivos de paridade na matriz e no número de discos que podem falhar enquanto o pool permanece operacional.</para>

		  <para>Em uma configuração de <acronym>RAID-Z1</acronym> com quatro discos, cada um com 1 TB, resultará em um volume com armazenamento utilizável de 3 TB e o pool ainda poderá operar em modo degradado com um disco com falha. Se um disco adicional ficar off-line antes que o disco com falha seja substituído e que o resilver tenha sido executado, todos os dados no pool poderão ser perdidos.</para>

		  <para>Em uma configuração de <acronym>RAID-Z3</acronym> com oito discos de 1 TB, o volume fornecerá 5 TB de espaço utilizável e ainda poderá operar com três discos com falha. A <trademark>Sun</trademark> recomenda no máximo nove discos em um único vdev. Se a configuração tiver mais discos, é recomendável dividi-los em vdevs separados e os dados do conjunto serão divididos entre eles.</para>

		  <para>Uma configuração de dois vdevs <acronym>RAID-Z2</acronym> consistindo de 8 discos cada criaria algo similar a um array <acronym>RAID-60</acronym>. A capacidade de armazenamento do grupo <acronym>RAID-Z</acronym> é aproximadamente o tamanho do menor disco multiplicado pelo número de discos sem paridade. Quatro discos de 1 TB em <acronym>RAID-Z1</acronym> têm um tamanho efetivo de aproximadamente 3 TB, e uma matriz de oito discos de 1 TB em <acronym>RAID-Z3</acronym> produzirá 5 TB de espaço utilizável .</para>
		</listitem>

		<listitem>
		  <para xml:id="zfs-term-vdev-spare"><emphasis>Spare</emphasis> - O <acronym>ZFS</acronym> tem um tipo especial de pseudo-vdev para controlar os discos hot spares disponíveis. Observe que as peças de reposição instaladas não são implantadas automaticamente; eles devem ser configurados manualmente para substituir o dispositivo com falha usando o comando <command>zfs replace</command>.</para>
		</listitem>

		<listitem>
		  <para xml:id="zfs-term-vdev-log"><emphasis>Log</emphasis> - <acronym> ZFS </acronym> Dispositivos de log, também conhecidos como <acronym>ZFS</acronym> Intent Log (<link linkend="zfs-term-zil"><acronym>ZIL</acronym></link>) move o log de intenção dos dispositivos comuns do pool para um dispositivo dedicado, normalmente um <acronym>SSD</acronym>. Ter um dispositivo de log dedicado pode melhorar significativamente o desempenho de aplicativos com um alto volume de gravações síncronas, especialmente bancos de dados. Os dispositivos de log podem ser espelhados, mas o <acronym>RAID-Z</acronym> não é suportado. Se vários dispositivos de log forem usados, as gravações serão balanceadas entre eles.</para>
		</listitem>

		<listitem>
		  <para xml:id="zfs-term-vdev-cache"><emphasis>Cache</emphasis> - Adicionar um cache vdev a um pool adicionará o armazenamento do cache ao <link linkend="zfs-term-l2arc"><acronym>L2ARC</acronym></link>. Dispositivos de cache não podem ser espelhados. Como um dispositivo de cache armazena apenas cópias adicionais de dados existentes, não há risco de perda de dados.</para>
		</listitem>
	      </itemizedlist></entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-txg">Transaction Group (<acronym>TXG</acronym>)</entry>

	    <entry>Grupos de transações são a forma como os blocos alterados são agrupados e eventualmente gravados no pool. Grupos de transação são a unidade atômica que o <acronym>ZFS</acronym> usa para garantir a consistência. Cada grupo de transações recebe um identificador consecutivo exclusivo de 64 bits. Pode haver até três grupos de transações ativos por vez, um em cada um desses três estados: <itemizedlist>
		<listitem>
		  <para><emphasis>Open</emphasis> - Quando um novo grupo de transações é criado, ele está no estado aberto e aceita novas gravações. Há sempre um grupo de transações no estado aberto, no entanto, o grupo de transações pode recusar novas gravações se tiver atingido um limite. Quando o grupo de transações abertas tiver atingido um limite ou o <link linkend="zfs-advanced-tuning-txg-timeout"> <varname> vfs.zfs.txg.timeout </varname> </link> tiver sido alcançado, o grupo de transações avança para o próximo estado.</para>
		</listitem>

		<listitem>
		  <para><emphasis>Quiescing</emphasis> - Um estado curto que permite que qualquer operação pendente termine sem bloquear a criação de um novo grupo de transações abertas. Depois que todas as transações no grupo forem concluídas, o grupo de transações avançará para o estado final.</para>
		</listitem>

		<listitem>
		  <para><emphasis>Syncing</emphasis> - Todos os dados no grupo de transações são gravados no armazenamento estável. Esse processo, por sua vez, modificará outros dados, como metadados e mapas de espaço, que também precisarão ser gravados no armazenamento estável. O processo de sincronização envolve vários passos. O primeiro é o maior, e trata de todos os blocos de dados alterados, seguido pelos metadados, que podem levar vários passos para serem concluídos. Como a alocação de espaço para os blocos de dados gera novos metadados, o estado de sincronização não pode ser concluído até que um passo seja concluído e não aloque espaço adicional. O estado de sincronização também é onde as <emphasis>synctasks</emphasis> são concluídas. As operações de sincronização são operações administrativas, como criar ou destruir snapshots e datasets, que modificam o uberblock. Quando o estado de sincronização estiver concluído, o grupo de transações no estado de quiesce é avançado para o estado de sincronização.</para>
		</listitem>
	      </itemizedlist> Todas as funções administrativas, tal como <link linkend="zfs-term-snapshot"><command>snapshot</command></link> são gravados como parte do grupo de transações. Quando uma tarefa de sincronização é criada, ela é adicionada ao grupo de transações atualmente aberto e esse grupo é avançado o mais rápido possível para o estado de sincronização para reduzir a latência de comandos administrativos.</entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-arc">Adaptive Replacement Cache (<acronym>ARC</acronym>)</entry>

	    <entry>O <acronym>ZFS</acronym> usa um Cache Adaptativo de Substituição (<acronym>ARC</acronym>), em vez de um mais tradicional como o Least Recently Used (<acronym>LRU</acronym>). Um cache <acronym>LRU</acronym> é uma lista simples de itens no cache, classificados por quando cada objeto foi usado mais recentemente. Novos itens são adicionados ao topo da lista. Quando o cache está cheio, os itens da parte inferior da lista são despejados para liberar espaço para mais objetos ativos. Um <acronym>ARC</acronym> consiste em quatro listas; os objetos Mais Recentes Utilizados (<acronym>MRU</acronym>) e Mais Frequentemente Usados (<acronym>MFU</acronym>), além de uma lista fantasma para cada um. Essas listas fantasmas rastreiam objetos recentemente despejados para evitar que sejam adicionados de volta ao cache. Isso aumenta a taxa de acertos do cache evitando objetos que têm um histórico de serem usados apenas ocasionalmente. Outra vantagem de usar um <acronym>MRU</acronym> e um <acronym>MFU</acronym> é que a verificação de um sistema de arquivos inteiro normalmente despejaria todos os dados de um <acronym>MRU</acronym> ou <acronym>LRU</acronym> do cache em favor deste conteúdo recém-acessado. Com o <acronym>ZFS</acronym>, há também um <acronym>MFU</acronym> que rastreia apenas os objetos usados com mais freqüência, e o cache dos blocos acessados com mais frequência permanece.</entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-l2arc"><acronym>L2ARC</acronym></entry>

	    <entry>O <acronym>L2ARC</acronym> é o segundo nível do sistema de armazenamento em cache do <acronym>ZFS</acronym>. O <acronym>ARC</acronym> principal é armazenado em <acronym>RAM</acronym>. Como a quantidade de <acronym>RAM</acronym> disponível é limitada, o <acronym>ZFS</acronym> também pode usar <link linkend="zfs-term-vdev-cache">cache vdevs</link>. Discos de estado sólido (<acronym>SSD</acronym>s) geralmente são usados como esses dispositivos de cache devido à sua maior velocidade e menor latência em comparação aos discos mecânicos tradicionais. O <acronym>L2ARC</acronym> é totalmente opcional, mas um deles aumentará significativamente a velocidade de leitura dos arquivos armazenados em cache no <acronym>SSD</acronym> em vez de precisar ser lido nos discos normais. O <acronym>L2ARC</acronym> também pode acelerar a <link linkend="zfs-term-deduplication">desduplicação</link> porque um <acronym>DDT</acronym> que não cabe na <acronym>RAM</acronym> mas cabe no <acronym>L2ARC</acronym> será muito mais rápido que um <acronym>DDT</acronym> que deve ser lido do disco. A taxa na qual os dados são adicionados aos dispositivos de cache é limitada para evitar o desgaste prematuro dos  <acronym>SSD</acronym>s com muitas gravações. Até que o cache esteja cheio (o primeiro bloco foi removido para liberar espaço), a gravação no <acronym>L2ARC</acronym> é limitada à soma do limite de gravação e do limite de aumento e depois limitada ao limite de gravação. Um par de valores <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> controla esses limites de taxa. A <link linkend="zfs-advanced-tuning-l2arc_write_max"><varname>vfs.zfs.l2arc_write_max</varname></link> controla quantos bytes são gravados no cache por segundo, enquanto <link linkend="zfs-advanced-tuning-l2arc_write_boost"><varname>vfs.zfs.l2arc_write_boost</varname></link> adiciona a este limite durante a <quote>Turbo Warmup Phase </quote> (aumento de gravação).</entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-zil"><acronym>ZIL</acronym></entry>

	    <entry>O <acronym>ZIL</acronym> acelera as transações síncronas usando dispositivos de armazenamento como <acronym>SSD</acronym>s mais rápidos do que os usados no pool de armazenamento principal. Quando um aplicativo solicita uma gravação síncrona (uma garantia de que os dados foram armazenados com segurança no disco, em vez de simplesmente serem gravados posteriormente), os dados são gravados no armazenamento mais rápido de <acronym>ZIL</acronym> e, depois, liberados aos discos regulares. Isso reduz enormemente a latência e melhora o desempenho. Apenas cargas de trabalho síncronas, como bancos de dados, serão beneficiadas com um <acronym>ZIL</acronym>. Gravações assíncronas regulares, como copiar arquivos, não usarão o <acronym>ZIL</acronym>.</entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-cow">Copy-On-Write</entry>

	    <entry>Ao contrário de um sistema de arquivos tradicional, quando os dados são sobrescritos no <acronym>ZFS</acronym>, os novos dados são gravados em um bloco diferente, em vez de sobrescrever os dados antigos no lugar. Somente quando essa gravação for concluída, os metadados serão atualizados para apontar para o novo local. No caso de uma gravação simplificada (uma falha do sistema ou perda de energia no meio da gravação de um arquivo), todo o conteúdo original do arquivo ainda estará disponível e a gravação incompleta será descartada. Isso também significa que o <acronym>ZFS</acronym> não requer um <citerefentry><refentrytitle>fsck</refentrytitle><manvolnum>8</manvolnum></citerefentry> após um desligamento inesperado.</entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-dataset">Dataset</entry>

	    <entry><emphasis>Dataset</emphasis> é o termo genérico para um sistema de arquivos <acronym>ZFS</acronym>, volume, snapshot ou clone. Cada dataset tem um nome exclusivo no formato <replaceable>poolname/path@snapshot</replaceable>. A raiz do pool é tecnicamente um dataset também. Dataset  filhos são nomeados hierarquicamente como diretórios. Por exemplo, <replaceable>mypool/home</replaceable>, o dataset inicial, é um filho de <replaceable>mypool</replaceable> e herda propriedades dele. Isso pode ser expandido ainda mais criando o <replaceable>mypool/home/user</replaceable>. Este dataset neto herdará propriedades do pai e do avô. As propriedades de um filho podem ser definidas para substituir os padrões herdados dos pais e avós. A administração de datasets e seus filhos pode ser <link linkend="zfs-zfs-allow">delegada</link>.</entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-filesystem">File system</entry>

	    <entry>Um dataset <acronym>ZFS</acronym> é mais frequentemente usado como um sistema de arquivos. Como a maioria dos outros sistemas de arquivos, um sistema de arquivos <acronym>ZFS</acronym> é montado em algum lugar na hierarquia de diretórios do sistema e contém arquivos e diretórios próprios com permissões, sinalizadores e outros metadados.</entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-volume">Volume</entry>

	    <entry>Além dos datasets regulares do sistema de arquivos, o <acronym>ZFS</acronym> também pode criar volumes, que são dispositivos de bloco. Os volumes têm muitos dos mesmos recursos, incluindo copy-on-write, snapshots, clones e checksum. Os volumes podem ser úteis para executar outros formatos de sistema de arquivos sobre o <acronym>ZFS</acronym>, tal como a virtualização do <acronym>UFS</acronym> ou a exportação de extensões <acronym>iSCSI</acronym>.</entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-snapshot">Snapshot</entry>

	    <entry>O design <link linkend="zfs-term-cow">copy-on-write</link> (<acronym>COW</acronym>) do <acronym>ZFS</acronym> permite snapshots quase instantâneos e consistentes com nomes arbitrários. Depois de obter um snapshot de um dataset ou um snapshot recursivo de um dataset pai que incluirá todos os datasets filho, novos dados serão gravados em novos blocos, mas os blocos antigos não serão recuperados como espaço livre. O snapshot contém a versão original do sistema de arquivos e o sistema de arquivos em tempo real contém as alterações feitas desde que o snapshot foi feito. Nenhum espaço adicional é usado. Conforme novos dados são gravados no sistema de arquivos ao vivo, novos blocos são alocados para armazenar esses dados. O tamanho aparente do snapshot aumentará à medida que os blocos não forem mais usados no sistema de arquivos ativo, mas apenas no snapshot. Estes snapshots podem ser montados somente como leitura para permitir a recuperação de versões anteriores de arquivos. Também é possível <link linkend="zfs-zfs-snapshot">reverter</link> um sistema de arquivos ativo para um snapshot específico, desfazendo quaisquer alterações que ocorreram depois que o snapshot foi tirado. Cada bloco no pool tem um contador de referência que registra quantos snapshots, clones, datasets ou volumes fazem uso desse bloco. À medida que arquivos e snapshots são excluídos, a contagem de referência é diminuída. Quando um bloco não é mais referenciado, ele é recuperado como espaço livre. Os snapshots também podem ser marcados com um <link linkend="zfs-zfs-snapshot">hold</link>. Quando um snapshot é mantido, qualquer tentativa de destruí-lo retornará um erro <literal>EBUSY</literal>. Cada snapshot pode ter várias retenções, cada uma com um nome exclusivo. O comando <link linkend="zfs-zfs-snapshot">release</link> remove a retenção para que o snapshot possa ser excluído. Snapshots podem ser obtidos de volumes, mas eles só podem ser clonados ou revertidos, não montados independentemente.</entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-clone">Clone</entry>

	    <entry>Os snapshots também podem ser clonados. Um clone é uma versão gravável de um snapshot, permitindo que o sistema de arquivos seja bifurcado como um novo dataset. Como com um snapshot, um clone inicialmente não consome espaço adicional. Conforme novos dados são gravados em um clone e novos blocos são alocados, o tamanho aparente do clone aumenta. Quando os blocos são sobrescritos no sistema de arquivos ou no volume clonado, a contagem de referência no bloco anterior é diminuída. O snapshot no qual um clone é baseado não pode ser excluído porque o clone depende dele. O snapshot é o pai e o clone é o filho. Os clones podem ser <emphasis>promovidos</emphasis>, invertendo essa dependência e tornando o clone o pai e o pai anterior, o filho. Esta operação não requer espaço adicional. Como a quantidade de espaço usada pelo pai e pelo filho é revertida, as cotas e reservas existentes podem ser afetadas.</entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-checksum">Checksum</entry>

	    <entry>Cada bloco alocado também é verificado. O algoritmo de checksum usado é uma propriedade por dataset, consulte <link linkend="zfs-zfs-set"><command>set</command></link>. O checksum de cada bloco é validado de forma transparente à medida que é lido, permitindo que o <acronym>ZFS</acronym> detecte a corrupção silenciosa. Se os dados lidos não corresponderem à checksum esperada, o <acronym>ZFS</acronym> tentará recuperar os dados de qualquer redundância disponível, como espelhos ou <acronym>RAID-Z</acronym>). A validação de todos os checksums pode ser acionada com o <link linkend="zfs-term-scrub"><command>scrub</command></link>. Os algoritmos de checksum incluem: <itemizedlist>
		<listitem>
		  <para><literal>fletcher2</literal></para>
		</listitem>

		<listitem>
		  <para><literal>fletcher4</literal></para>
		</listitem>

		<listitem>
		  <para><literal>sha256</literal></para>
		</listitem>
	      </itemizedlist> Os algoritmos <literal>fletcher</literal> são mais rápidos, mas o <literal>sha256</literal> é um hash criptográfico forte e tem uma chance muito menor de colisões ao custo de algum desempenho. Checksums podem ser desativados, mas isso não é recomendado.</entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-compression">Compressão</entry>

	    <entry>Cada dataset tem uma propriedade de compactação, cujo padrão é off. Essa propriedade pode ser definida como um dos vários algoritmos de compactação. Isso fará com que todos os novos dados gravados no dataset sejam compactados. Além de uma redução no espaço usado, a taxa de leitura e gravação geralmente aumenta porque menos blocos são lidos ou gravados. <itemizedlist>
		<listitem xml:id="zfs-term-compression-lz4">
		  <para><emphasis><acronym>LZ4</acronym></emphasis> - Adicionado na versão 5000 do pool do <acronym>ZFS</acronym> (feature flags), o <acronym>LZ4</acronym> é agora o algoritmo de compressão recomendado. O <acronym>LZ4</acronym> compacta aproximadamente 50% mais rápido do que o <acronym>LZJB</acronym> ao operar em dados compactáveis e é três vezes mais rápido ao operar em dados não compactáveis. O <acronym>LZ4</acronym> também descompacta aproximadamente 80% mais rápido que o <acronym>LZJB</acronym>. Nas <acronym>CPU</acronym>s modernas, o <acronym>LZ4</acronym> pode frequentemente comprimir a mais de 500 MB/s e descompactar a mais de 1,5 GB/s (por núcleo de CPU).</para>
		</listitem>

		<listitem xml:id="zfs-term-compression-lzjb">
		  <para><emphasis><acronym>LZJB</acronym></emphasis> - O algoritmo de compressão padrão. Criado por Jeff Bonwick (um dos criadores originais do <acronym>ZFS</acronym>). O <acronym>LZJB</acronym> oferece boa compactação com menos sobrecarga de <acronym>CPU</acronym> em comparação com o <acronym>GZIP</acronym>. No futuro, o algoritmo de compactação padrão provavelmente será alterado para <acronym>LZ4</acronym>.</para>
		</listitem>

		<listitem xml:id="zfs-term-compression-gzip">
		  <para><emphasis><acronym>GZIP</acronym></emphasis> - Um algoritmo popular de compressão de fluxo disponível no <acronym>ZFS</acronym>. Uma das principais vantagens de usar o <acronym>GZIP</acronym> é seu nível configurável de compactação. Ao definir a propriedade <literal>compress</literal>, o administrador pode escolher o nível de compactação, desde <literal>gzip1</literal>, o nível mais baixo de compactação, até <literal>gzip9</literal>, o maior nível de compressão. Isso dá ao administrador o controle sobre quanto tempo <acronym>CPU</acronym> será dedicado para economizar espaço em disco.</para>
		</listitem>

		<listitem xml:id="zfs-term-compression-zle">
		  <para><emphasis><acronym>ZLE</acronym></emphasis> - A codificação de comprimento zero é um algoritmo de compressão especial que apenas comprime sequencias contínuas de zeros. Esse algoritmo de compactação é útil apenas quando o dataset contém grandes blocos de zeros.</para>
		</listitem>
	      </itemizedlist></entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-copies">Copies</entry>

	    <entry>Quando configurada para um valor maior que 1, a propriedade <literal>copies</literal> instrui o <acronym>ZFS</acronym> a manter várias cópias de cada bloco no <link linkend="zfs-term-filesystem">sistema de arquivos </link> ou <link linkend="zfs-term-volume">volume</link>. Definir essa propriedade em datasets importantes fornece redundância adicional a partir da qual recuperar um bloco que não corresponde ao seu checksum. Em pools sem redundância, o recurso de cópias é a única forma de redundância. O recurso de cópias pode se recuperar de um único setor defeituoso ou de outras formas de corrupção menor, mas não protege o pool da perda de um disco inteiro.</entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-deduplication">Desduplicação</entry>

	    <entry>Os checksums permitem detectar blocos duplicados de dados à medida que são escritos. Com a deduplicação, a contagem de referência de um bloco existente e idêntico é aumentada, economizando espaço de armazenamento. Para detectar blocos duplicados, uma tabela de deduplicação (<acronym>DDT</acronym>) é mantida na memória. A tabela contém uma lista de checksums exclusivas, a localização desses blocos e uma contagem de referência. Quando novos dados são gravados, o checksum é calculado e comparado à lista. Se uma correspondência for encontrada, o bloco existente será usado. O algoritmo de checksum <acronym>SHA256</acronym> é usado com deduplicação para fornecer um hash criptográfico seguro. A desduplicação é configurável. Se <literal>dedup</literal> for <literal>on</literal>, um checksum correspondente será considerado como significando que os dados são idênticos. Se <literal>dedup</literal> for definido como <literal>verify</literal>, os dados nos dois blocos serão verificados byte por byte para garantir que sejam realmente idênticos. Se os dados não forem idênticos, a colisão de hash será anotada e os dois blocos serão armazenados separadamente. Como o <acronym>DDT</acronym> deve armazenar o hash de cada bloco único, ele consome uma quantidade muito grande de memória. Uma regra geral é 5-6 GB de RAM por 1 TB de dados desduplicados). Em situações em que não é prático ter <acronym>RAM</acronym>  suficiente para manter todo o <acronym>DDT</acronym> na memória, o desempenho sofrerá muito, pois o <acronym>DDT</acronym> deve ser lido do disco antes que cada novo bloco seja gravado. A desduplicação pode usar o <acronym>L2ARC</acronym> para armazenar o <acronym>DDT</acronym>, fornecendo um meio termo entre a memória rápida do sistema e os discos mais lentos. Considere a possibilidade de usar a compactação, que geralmente oferece quase a mesma economia de espaço sem o requisito de memória adicional.</entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-scrub">Scrub</entry>

	    <entry>Em vez de uma verificação de consistência como o <citerefentry><refentrytitle>fsck</refentrytitle><manvolnum>8</manvolnum></citerefentry>, o <acronym>ZFS</acronym> tem o <command>scrub</command>. O <command>scrub</command> lê todos os blocos de dados armazenados no pool e verifica seus checksums em relação checksums bons conhecidos armazenados nos metadados. Uma verificação periódica de todos os dados armazenados no pool garante a recuperação de quaisquer blocos corrompidos antes que eles sejam necessários. Um scrub não é necessário após um desligamento inadequado do sistema, mas é recomendado pelo menos uma vez a cada três meses. O checksum de cada bloco é verificado à medida que os blocos são lidos durante o uso normal, mas um scrub garante que mesmo os blocos usados com pouca freqüência sejam verificados quanto a sua corrupção silenciosa. A segurança dos dados é aprimorada, especialmente em situações de armazenamento de arquivos. A prioridade relativa do <command>scrub</command> pode ser ajustada por meio da variável <link linkend="zfs-advanced-tuning-scrub_delay"><varname>vfs.zfs.scrub_delay</varname></link> para evitar que o scrub degrade o desempenho de outras cargas de trabalho no pool.</entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-quota">Dataset Quota</entry>

	    <entry>O <acronym>ZFS</acronym> fornece datasets rápidos e precisos, contabilidade de espaço de usuários e grupos, além de cotas e reservas de espaço. Isso dá ao administrador um controle refinado sobre como o espaço é alocado e permite que o espaço seja reservado para sistemas de arquivos críticos. <para><acronym>ZFS</acronym> supports different types of
		quotas: the dataset quota, the <link linkend="zfs-term-refquota">reference
		  quota (<acronym>refquota</acronym>)</link>, the
		<link linkend="zfs-term-userquota">user
		  quota</link>, and the
		<link linkend="zfs-term-groupquota">group
		  quota</link>.</para> <para>As cotas limitam a quantidade de espaço que um dataset e todos os seus descendentes, incluindo snapshots do dataset, datasets filhos e snapshots desses datasets, podem consumir.</para> <note>
		<para>Cotas não podem ser definidas em volumes, pois a propriedade <literal>volsize</literal> atua como uma cota implícita.</para>
	      </note></entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-refquota">Reference Quota</entry>

	    <entry>Uma cota de referência limita a quantidade de espaço que um dataset pode consumir impondo um limite rígido. No entanto, esse limite rígido inclui apenas o espaço ao qual o dataset faz referência e não inclui o espaço usado pelos descendentes, como sistemas de arquivos ou snapshots.</entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-userquota">User Quota</entry>

	    <entry>Cotas de usuários são úteis para limitar a quantidade de espaço que pode ser usada pelo usuário especificado.</entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-groupquota">Group Quota</entry>

	    <entry>A cota de grupo limita a quantidade de espaço que um grupo especificado pode consumir.</entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-reservation">Dataset Reservation</entry>

	    <entry>A propriedade <literal>reservation</literal> torna possível garantir uma quantidade mínima de espaço para um dataset específico e seus descendentes. Se uma reserva de 10 GB estiver definida em <filename>storage/home/bob</filename>, e outro dataset tentar usar todo o espaço livre, pelo menos 10 GB de espaço serão reservados para este dataset. Se um snapshot for criado de <filename>storage/home/bob</filename>, o espaço usado por esse snapshot será contabilizado contra a reserva. A propriedade <link linkend="zfs-term-refreservation"><literal>refreservation</literal></link> funciona de maneira semelhante, mas <emphasis>exclui</emphasis> os descendentes como os snapshots. <para>Reservas de qualquer tipo são úteis em muitas situações, como planejar e testar a adequação da alocação de espaço em disco em um novo sistema ou garantindo espaço suficiente nos sistemas de arquivos para logs de áudio ou procedimentos e arquivos de recuperação do sistema.</para></entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-refreservation">Reference Reservation</entry>

	    <entry>A propriedade <literal>refreservation</literal> torna possível garantir uma quantidade mínima de espaço para o uso de dataset específico <emphasis>excluindo</emphasis> seus descendentes. Isso significa que, se uma reserva de 10 GB estiver definida em <filename>storage/home/bob</filename>, e outro dataset tentar usar todo o espaço livre, pelo menos 10 GB de espaço serão reservados para este dataset. Em contraste com uma <link linkend="zfs-term-reservation">reserva</link> regular, o espaço usado por snapshots e datasets descendentes não é contado contra a reserva. Por exemplo, se um snapshot for criado do <filename>storage/home/bob</filename>, deve haver espaço em disco suficiente fora da quantia de <literal>refreservation</literal> para que a operação seja bem-sucedida. Descendentes do dataset principal não são contados na quantia de <literal>refreservation</literal> e, portanto, não invadem o espaço definido.</entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-resilver">Resilver</entry>

	    <entry>Quando um disco falha e é substituído, o novo disco deve ser preenchido com os dados perdidos. O processo de usar as informações de paridade distribuídas entre as unidades restantes para calcular e gravar os dados ausentes na nova unidade é chamado de <emphasis>resilvering</emphasis>.</entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-online">Online</entry>

	    <entry>Um pool ou vdev no estado <literal>Online</literal> tem todos os seus dispositivos membros conectados e totalmente operacionais. Dispositivos individuais no estado <literal>Online</literal> estão funcionando normalmente.</entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-offline">Offline</entry>

	    <entry>Dispositivos individuais podem ser colocados em um estado <literal>Offline</literal> pelo administrador se houver redundância suficiente para evitar colocar o pool ou vdev em um estado <link linkend="zfs-term-faulted">Faulted</link>. Um administrador pode optar por colocar um disco off-line como preparação para substituí-lo ou para facilitar sua identificação.</entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-degraded">Degraded</entry>

	    <entry>Um pool ou vdev no estado <literal>Degraded</literal> possui um ou mais discos que foram desconectados ou falharam. O pool ainda é utilizável, mas se dispositivos adicionais falharem, o pool poderá se tornar irrecuperável. Reconectar os dispositivos ausentes ou substituir os discos com falha retornará o pool a um estado <link linkend="zfs-term-online">Online</link> depois que o dispositivo reconectado ou novo tiver concluído o processo de <link linkend="zfs-term-resilver">Resilver</link>.</entry>
	  </row>

	  <row>
	    <entry xml:id="zfs-term-faulted">Faulted</entry>

	    <entry>Um pool ou vdev no estado <literal>Faulted</literal> não está mais operacional. Os dados nele não podem mais ser acessados. Um pool ou vdev entra no estado <literal>Faulted</literal> quando o número de dispositivos ausentes ou com falha excede o nível de redundância no vdev. Se os dispositivos ausentes puderem ser reconectados, o pool retornará ao estado <link linkend="zfs-term-online">Online</link>. Se houver redundância insuficiente para compensar o número de discos com falha, o conteúdo do pool será perdido e deverá ser restaurado a partir de um backup.</entry>
	  </row>
	</tbody>
      </tgroup>
    </informaltable>
  </sect1>
</chapter>

    
<!--
     The FreeBSD Documentation Project
     $FreeBSD$
-->
<chapter version="5.0" xml:id="filesystems">
  <info>
    <title>Outros Sistemas de Arquivos</title>

    <authorgroup>
      <author><personname><firstname>Tom</firstname><surname>Rhodes</surname></personname><contrib>Escrito por </contrib></author>
    </authorgroup>
  </info>

  <sect1 xml:id="filesystems-synopsis">
    <title>Sinopse</title>

    <indexterm><primary>File Systems</primary></indexterm>
    <indexterm><primary>File Systems Support</primary> <see>File Systems</see></indexterm>

    <para>Os sistemas de arquivos são parte integrante de qualquer sistema operacional. Eles permitem que os usuários carreguem e armazenem arquivos, forneçem acesso a dados e tornam os discos rígidos úteis. Diferentes sistemas operacionais diferem em seu sistema de arquivos nativo. Tradicionalmente, o sistema de arquivo nativo do FreeBSD tem sido o Sistema de Arquivos Unix (Unix File System) <acronym>UFS</acronym> o qual foi modernizado como <acronym>UFS2</acronym>. Desde o FreeBSD 7.0, o Sistema de Arquivos Z (<acronym>ZFS</acronym>) também está disponível como um sistema de arquivos nativo. Veja <xref linkend="zfs"/> para maiores informações.</para>

    <para>Além dos seus sistemas de arquivos nativos, o FreeBSD suporta uma infinidade de outros sistemas de arquivos para que dados de outros sistemas operacionais possam ser acessados localmente, tais como dados armazenados em dispositivos de armazenamento <acronym> USB </acronym> conectados localmente, drives flash e discos rígidos. Isto inclui suporte para o sistema de arquivos estendidos do <trademark class="registered">Linux</trademark> (<acronym>EXT</acronym>).</para>

    <para>Existem diferentes níveis de suporte do FreeBSD para os vários sistemas de arquivos. Alguns exigem que um módulo do kernel seja carregado e outros podem requerer que um conjunto de ferramentas seja instalado. O suporte a alguns dos sistemas de arquivos não nativos é completo, suportando leitura/gravação, enquanto o suporte a outros é somente de leitura.</para>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>A diferença entre sistemas de arquivos nativos e suportados.</para>
      </listitem>

      <listitem>
	<para>Quais sistemas de arquivos são suportados pelo FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como ativar, configurar, acessar e usar sistemas de arquivos não nativos.</para>
      </listitem>
    </itemizedlist>

    <para>Antes de ler este capítulo, você deve:</para>

    <itemizedlist>
      <listitem>
	<para>Compreender o <trademark class="registered">UNIX</trademark> e ter <link linkend="basics"> noções básicas de FreeBSD</link>.</para>
      </listitem>

      <listitem>
	<para>Estar familiarizado com o básico da <link linkend="kernelconfig">configuração e compilação do kernel</link>.</para>
      </listitem>

      <listitem>
	<para>Sinta-se confortável <link linkend="ports">instalando software</link> no FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Tenha alguma familiaridade com <link linkend="disks">discos</link>, armazenamento e nomes de dispositivos no FreeBSD.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="filesystems-linux">
    <title>Sistemas de arquivos do  <trademark class="registered">Linux</trademark></title>

    <para>O FreeBSD fornece suporte built-in para vários sistemas de arquivos do <trademark class="registered">Linux</trademark>. Esta seção demonstra como carregar o suporte e como montar os sistemas de arquivos suportados do <trademark class="registered">Linux</trademark>.</para>

    <sect2>
      <title><acronym>ext2</acronym></title>

      <para>O suporte no kernel para sistemas de arquivos ext2 está disponível desde o FreeBSD 2.2. No FreeBSD 8.x e anterior, o código está licenciado sob a <acronym>GPL</acronym>. Desde o FreeBSD 9.0, o código foi reescrito e agora é licenciado sob a licença <acronym>BSD</acronym>.</para>

      <para>O driver <citerefentry><refentrytitle>ext2fs</refentrytitle><manvolnum>5</manvolnum></citerefentry> permite que o kernel do FreeBSD leia e grave em sistemas de arquivos ext2.</para>

      <note>
	<para>Esse driver também pode ser usado para acessar os sistemas de arquivos ext3 e ext4. O sistema de arquivos <citerefentry><refentrytitle>ext2fs</refentrytitle><manvolnum>5</manvolnum> </citerefentry> possui suporte completo para leitura e gravação para o ext4 a partir do FreeBSD 12.0-RELEASE. Além disso, os atributos estendidos e as ACLs também são suportados, enquanto o journalling e a criptografia não são. Começando com o FreeBSD 12.1-RELEASE, um provedor do DTrace também estará disponível. Versões anteriores do FreeBSD podem acessar o ext4 no modo de leitura e gravação usando <package>sysutils/fusefs-ext2</package>.</para>
      </note>

      <para>Para acessar um sistema de arquivos ext, primeiro carregue o módulo correspondente do kernel:</para>

      <screen><prompt>#</prompt> <userinput>kldload ext2fs</userinput></screen>

      <para>Em seguida, monte o volume ext especificando seu nome de partição no FreeBSD e um ponto de montagem existente. Este exemplo monta <filename>/dev/ad1s1</filename> em <filename>/mnt</filename>:</para>

      <screen><prompt>#</prompt> <userinput>mount -t ext2fs <replaceable>/dev/ad1s1</replaceable> <replaceable>/mnt</replaceable></userinput></screen>
    </sect2>
  </sect1>

  <!--
  <sect1>
    <title>Device File System</title>
  </sect1>

  <sect1>
    <title>DOS and NTFS File Systems</title>
    <para>This is a good section for those who transfer files, using
      USB devices, from Windows to FreeBSD and vice-versa.  My camera,
      and many other cameras I have seen default to using FAT16.  There
      is (was?) a kde utility, I think called kamera, that could be used
      to access camera devices.  A section on this would be useful.</para>

    <para>XXXTR: Though!  The disks chapter, covers a bit of this and
      devfs under it's USB devices.  It leaves a lot to be desired though,
      see:
https://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/usb-disks.html
      It may be better to flesh out that section a bit more.  Add the
      word "camera" to it so that others can easily notice.</para>
  </sect1>

  <sect1>
    <title>Linux EXT File System</title>

    <para>Probably NOT as useful as the other two, but it requires
      knowledge of the existence of the tools.  Which are hidden in
      the ports collection.  Most Linux guys would probably only use
      Linux, BSD guys would be smarter and use NFS.</para>
  </sect1>

  <sect1>
    <title>HFS</title>

    <para>I think this is the file system used on Apple OSX.  There are
      tools in the ports collection, and with Apple being a big
      FreeBSD supporter and user of our technologies, surely there
      is enough cross over to cover this?</para>
  </sect1>
  -->

</chapter>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<chapter version="5.0" xml:id="virtualization">

  <info>
    <title>Virtualização</title>

    <authorgroup>
      <author><personname> <firstname>Murray</firstname> <surname>Stokely</surname> </personname> <contrib>Contribuido por </contrib></author>
    </authorgroup>

    <authorgroup>
      <author><personname> <firstname>Allan</firstname> <surname>Jude</surname> </personname> <contrib>seção bhyve por </contrib></author>
    </authorgroup>

    <authorgroup>
      <author><personname> <firstname>Benedict</firstname> <surname>Reuschling</surname> </personname> <contrib>Seção Xen por </contrib></author>
    </authorgroup>
  </info>

  <sect1 xml:id="virtualization-synopsis">
    <title>Sinopse</title>

    <para>O software de virtualização permite que vários sistemas operacionais sejam executados simultaneamente no mesmo computador. Tais sistemas de software para <acronym>PC</acronym>s geralmente envolvem um sistema operacional host que executa o software de virtualização e suporta qualquer número de sistemas operacionais convidados.</para>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>A diferença entre um sistema operacional host e um sistema operacional convidado.</para>
      </listitem>

      <listitem>
	<para>Como instalar o FreeBSD em um computador baseado em um <trademark class="registered">Intel</trademark> <trademark class="registered">Apple</trademark> <trademark class="registered">Mac</trademark>.</para>
      </listitem>

      <listitem>
	<para>Como instalar o FreeBSD no <trademark class="registered">Microsoft</trademark> <trademark class="registered">Windows</trademark> com <application>Virtual PC</application>.</para>
      </listitem>

      <listitem>
	<para>Como instalar o FreeBSD como um host convidado no <application>bhyve</application>.</para>
      </listitem>

      <listitem>
	<para>Como ajustar um sistema FreeBSD para melhor desempenho sob virtualização.</para>
      </listitem>

    </itemizedlist>

    <para>Antes de ler este capítulo, você deve:</para>

    <itemizedlist>
      <listitem>
	<para>Entender o <link linkend="basics">básico sobre sistemas <trademark class="registered">UNIX</trademark> e sobre o FreeBSD</link>.</para>
      </listitem>

      <listitem>
	<para>Saber como <link linkend="bsdinstall">instalar o FreeBSD</link>.</para>
      </listitem>

      <listitem>
	<para>Saber como <link linkend="advanced-networking">configurar uma conexão de rede</link>.</para>
      </listitem>

      <listitem>
	<para>Saber como <link linkend="ports">instalar software adicional de terceiros</link>.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="virtualization-guest-parallels">
    <title>FreeBSD como Sistema Operacional Convidado no <application>Parallels</application> para <trademark class="registered">Mac OS</trademark> X</title>

    <para>O <application>Parallels Desktop</application> para <trademark class="registered">Mac</trademark> é um produto de software comercial disponível para computadores baseados em <trademark class="registered">Intel</trademark> <trademark class="registered">Apple</trademark> <trademark class="registered">Mac</trademark> rodando <trademark class="registered">Mac OS</trademark> 10.4.6 ou superior. O FreeBSD é um sistema operacional convidado completamente suportado. Uma vez que o <application>Parallels</application> tiver sido instalado no <trademark class="registered">Mac OS</trademark> X, o usuário deve configurar uma maquina virtual e então instalar o sistema operacional convidado desejado.</para>

    <sect2 xml:id="virtualization-guest-parallels-install">
      <title>Instalando o FreeBSD no Parallels/<trademark class="registered">Mac OS</trademark> X</title>

      <para>O primeiro passo para instalar o FreeBSD no <application>Parallels</application> é criar uma nova máquina virtual para instalar o FreeBSD. Selecione <guimenuitem>FreeBSD</guimenuitem> como o <guimenu>Guest OS Type</guimenu> quando solicitado:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd1"/>
	</imageobject>
      </mediaobject>

      <para>Escolha uma quantidade razoável de disco e memória, dependendo dos planos para esta instância virtual do FreeBSD. 4GB de espaço em disco e 512MB de RAM funcionam bem para a maioria dos usos do FreeBSD executando sob o <application>Parallels</application>:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd2"/>
	</imageobject>
      </mediaobject>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd3"/>
	</imageobject>
      </mediaobject>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd4"/>
	</imageobject>
      </mediaobject>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd5"/>
	</imageobject>
      </mediaobject>

      <para>Selecione o tipo de rede e uma interface de rede:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd6"/>
	</imageobject>
      </mediaobject>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd7"/>
	</imageobject>
      </mediaobject>

      <para>Salve e finalize a configuração:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd8"/>
	</imageobject>
      </mediaobject>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd9"/>
	</imageobject>
      </mediaobject>

      <para>Após a criação da máquina virtual do FreeBSD, o FreeBSD pode ser instalado nela. Isto é feito melhor com um <acronym>CD</acronym>/<acronym>DVD</acronym> oficial do FreeBSD ou com uma imagem <acronym>ISO</acronym> baixada de um site <acronym>FTP</acronym> oficial. Copie a imagem <acronym>ISO</acronym> apropriada para o sistema de arquivos local do <trademark class="registered">Mac</trademark> ou insira um <acronym>CD</acronym>/<acronym>DVD</acronym> na unidade de <acronym>CD-ROM</acronym> do <trademark class="registered">Mac</trademark>. Clique no ícone do disco no canto inferior direito da janela do FreeBSD no <application>Parallels</application>. Isso abrirá uma janela a qual pode ser usada para associar a unidade de <acronym>CD-ROM</acronym> na máquina virtual com o arquivo <acronym>ISO</acronym> no disco ou com drive <acronym>CD</acronym>.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd11"/>
	</imageobject>
      </mediaobject>

      <para>Uma vez que esta associação com a fonte do <acronym>CD-ROM</acronym> estiver feita, reinicialize a máquina virtual do FreeBSD clicando no ícone de reinicialização. O <application>Parallels</application> irá reiniciar com um <acronym>BIOS</acronym> especial o qual primeiro irá verificar se existe um <acronym>CD-ROM</acronym>.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd10"/>
	</imageobject>
      </mediaobject>

      <para>Neste caso, ele encontrará a mídia de instalação do FreeBSD e iniciará uma instalação normal do FreeBSD. Execute a instalação, mas não tente configurar o <application>Xorg</application> neste momento.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd12"/>
	</imageobject>
      </mediaobject>

      <para>Quando a instalação estiver concluída, reinicie a máquina virtual FreeBSD recém-instalada.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd13"/>
	</imageobject>
      </mediaobject>
    </sect2>

    <sect2 xml:id="virtualization-guest-parallels-configure">
      <title>Configurando o FreeBSD no <application>Parallels</application></title>

      <para>Depois que o FreeBSD foi instalado com sucesso no <trademark class="registered">Mac OS</trademark> X com o <application> Parallels </application>, existem várias etapas de configuração que podem ser executadas para otimizar o sistema para operar virtualizado.</para>

      <procedure>
	<step>
	  <title>Definir variáveis do Boot Loader</title>

	  <para>O passo mais importante é reduzir o <option>kern.hz</option> ajustável para reduzir a utilização de CPU no FreeBSD sob ambiente <application>Parallels</application>. Isso é feito adicionando a seguinte linha ao <filename>/boot/loader.conf</filename>:</para>

	  <programlisting>kern.hz=100</programlisting>

	  <para>Sem essa configuração, um sistema convidado inativo do FreeBSD no <application>Parallels</application> usará aproximadamente 15% da CPU de um único processador <trademark class="registered">iMac</trademark>. Após essa alteração, o uso ficará mais próximo de 5%.</para>
	</step>

	<step>
	  <title>Criar um novo arquivo de configuração do kernel</title>

	  <para>Todos os drivers de dispositivos SCSI, FireWire e USB podem ser removidos de um arquivo de configuração de kernel personalizado. O <application>Parallels</application> fornece um adaptador de rede virtual usado pelo driver <citerefentry><refentrytitle>ed</refentrytitle><manvolnum>4</manvolnum></citerefentry>, portanto, todos os dispositivos de rede, exceto o <citerefentry><refentrytitle>ed</refentrytitle><manvolnum>4</manvolnum></citerefentry> e o <citerefentry><refentrytitle>miibus</refentrytitle><manvolnum>4</manvolnum></citerefentry>  podem ser removidos do kernel .</para>
	</step>

	<step>
	  <title>Configure a rede</title>

	  <para>A configuração de rede mais básica usa o DHCP para conectar a máquina virtual à mesma rede local que o host <trademark class="registered">Mac</trademark>. Isso pode ser feito adicionando <literal>ifconfig_ed0="DHCP"</literal> ao <filename> /etc/rc.conf </filename>. Configurações de rede mais avançadas são descritas em <xref linkend="advanced-networking"/>.</para>
	</step>
      </procedure>
    </sect2>
  </sect1>

  <sect1 xml:id="virtualization-guest-virtualpc">
    <title>FreeBSD como sistema convidado no <application>Virtual PC</application> para <trademark class="registered">Windows</trademark></title>

    <para>O <application>Virtual PC</application> para <trademark class="registered">Windows</trademark> é um software da <trademark class="registered">Microsoft</trademark> disponível para download gratuito. Consulte este site para os <link xlink:href="http://www.microsoft.com/windows/downloads/virtualpc/sysreq.mspx">requisitos do sistema</link>. Depois que o <application>Virtual PC</application> tiver sido instalado no <trademark class="registered">Microsoft</trademark> <trademark class="registered">Windows</trademark>, o usuário poderá configurar uma máquina virtual e depois instalar o sistema operacional convidado desejado.</para>

    <sect2 xml:id="virtualization-guest-virtualpc-install">
      <title>Instalando o FreeBSD no <application>Virtual PC</application></title>

      <para>O primeiro passo para instalar o FreeBSD no <application>Virtual PC</application> é criar uma nova máquina virtual para instalar o FreeBSD. Selecione <guimenuitem>Criar uma máquina virtual</guimenuitem> quando solicitado:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd1"/>
	</imageobject>
      </mediaobject>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd2"/>
	</imageobject>
      </mediaobject>

      <para>Selecione a opção <guimenuitem>Outro</guimenuitem> para o <guimenuitem>Sistema operacional</guimenuitem> quando solicitado:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd3"/>
	</imageobject>
      </mediaobject>

      <para>Em seguida, escolha uma quantidade razoável de disco e de memória, dependendo dos planos para esta instância virtual do FreeBSD. 4GB de espaço em disco e 512MB de RAM funcionam bem para a maioria dos usos do FreeBSD sob o <application>Virtual PC</application>:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd4"/>
	</imageobject>
      </mediaobject>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd5"/>
	</imageobject>
      </mediaobject>

      <para>Salve e finalize a configuração:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd6"/>
	</imageobject>
      </mediaobject>

      <para>Selecione a máquina virtual do FreeBSD e clique em <guimenu>Configurações</guimenu>, em seguida, defina o tipo de rede e uma interface de rede:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd7"/>
	</imageobject>
      </mediaobject>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd8"/>
	</imageobject>
      </mediaobject>

      <para>Após a criação da máquina virtual do FreeBSD, o FreeBSD pode ser instalado nela. Isso é feito da melhor maneira com um <acronym>CD</acronym>/<acronym>DVD</acronym> oficial ou com uma imagem <acronym>ISO</acronym> baixada de um site <acronym>FTP</acronym> oficial. Copie a imagem <acronym>ISO</acronym> apropriada para o sistema de arquivos local do <trademark class="registered">Windows</trademark> ou insira um <acronym>CD</acronym>/<acronym>DVD</acronym> na unidade de <acronym>CD-ROM</acronym>, então clique duas vezes na máquina virtual FreeBSD para inicializar. Em seguida, clique em <guimenu>CD</guimenu> e escolha <guimenu>Capturar imagem ISO...</guimenu> na janela do <application>Virtual PC</application>. Isso abrirá uma janela na qual a unidade de <acronym>CD-ROM</acronym> na máquina virtual poderá  ser associada a um arquivo <acronym>ISO</acronym> no disco ou com o drive de <acronym>CD-ROM</acronym> real.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd9"/>
	</imageobject>
      </mediaobject>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd10"/>
	</imageobject>
      </mediaobject>

      <para>Uma vez que a associação com a fonte do <acronym>CD-ROM</acronym> estiver feita, reinicie a máquina virtual do FreeBSD clicando em <guimenu>Action</guimenu> e depois em <guimenu>Reset</guimenu>. O <application>Virtual PC</application> será reiniciado com um <acronym>BIOS</acronym> especial que irá procurar por um <acronym>CD-ROM</acronym> para inicializar.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd11"/>
	</imageobject>
      </mediaobject>

      <para>Neste caso, ele encontrará a mídia de instalação do FreeBSD e iniciará uma instalação normal do FreeBSD. Continue com a instalação, mas não tente configurar o <application>Xorg</application> neste momento.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd12"/>
	</imageobject>
      </mediaobject>

      <para>Quando a instalação estiver concluída, lembre-se de ejetar o <acronym>CD</acronym>/<acronym>DVD</acronym> ou de liberar a imagem <acronym>ISO</acronym>. Finalmente, reinicie a máquina virtual FreeBSD recém-instalada.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd13"/>
	</imageobject>
      </mediaobject>
    </sect2>

    <sect2 xml:id="virtualization-guest-virtualpc-configure">
      <title>Configuring FreeBSD on <application>Virtual PC</application></title>

      <para>Depois que o FreeBSD tiver sido instalado com sucesso no <trademark class="registered">Microsoft</trademark> <trademark class="registered">Windows</trademark> com o <application>Virtual PC</application>, existem várias etapas de configurações que podem ser executadas para otimizar o sistema para operação virtualizada.</para>

      <procedure>
	<step>
	  <title>Definir variáveis do Boot Loader</title>

	  <para>O passo mais importante é reduzir o valor do parâmetro <option>kern.hz</option> para reduzir a utilização da CPU do FreeBSD sob o ambiente do <application>Virtual PC</application>. Isso é feito adicionando a seguinte linha ao <filename>/boot/loader.conf</filename>:</para>

	  <programlisting>kern.hz=100</programlisting>

	  <para>Sem esta configuração, uma VM idle do FreeBSD rodando sob o <application>Virtual PC</application> utilizará aproximadamente 40% da CPU de um computador com um único processador. Após essa mudança, o uso ficará mais próximo de 3%.</para>
	</step>

	<step>
	  <title>Criar um novo arquivo de configuração do kernel</title>

	  <para>Todos os drivers de dispositivos SCSI, FireWire e USB podem ser removidos do arquivo de configuração do kernel personalizado. O <application>Virtual PC</application> fornece um adaptador de rede virtual usado pelo driver <citerefentry><refentrytitle>de</refentrytitle><manvolnum>4</manvolnum></citerefentry>, portanto, todos os dispositivos de rede, exceto o <citerefentry><refentrytitle>de</refentrytitle><manvolnum>4</manvolnum></citerefentry> e o <citerefentry><refentrytitle>miibus</refentrytitle><manvolnum>4</manvolnum></citerefentry> podem ser removidos do kernel.</para>
	</step>

	<step>
	  <title>Configure a rede</title>

	  <para>A configuração de rede mais básica usa o DHCP para conectar a máquina virtual à mesma rede local que o host <trademark class="registered">Microsoft</trademark> <trademark class="registered">Windows</trademark>. Isso pode ser feito adicionando <literal>ifconfig_de0="DHCP"</literal> ao <filename>/etc/rc.conf</filename>. Configurações de rede mais avançadas são descritas em <xref linkend="advanced-networking"/>.</para>
	</step>
      </procedure>
    </sect2>
  </sect1>

  <sect1 xml:id="virtualization-guest-vmware">
    <title>FreeBSD como Sistema Operacional Convidado no <application>VMware Fusion</application> para <trademark class="registered">Mac OS</trademark></title>

    <para>O <application>VMware Fusion</application> para <trademark class="registered">Mac</trademark> é um software comercial disponível para computadores <trademark class="registered">Apple</trademark> <trademark class="registered">Mac</trademark> baseados em processadores <trademark class="registered">Intel</trademark> e que rodam o <trademark class="registered">Mac OS</trademark> 10.4.9 ou superior. O FreeBSD é um sistema operacional convidado totalmente suportado. Depois que o <application>VMware Fusion</application> for instalado no <trademark class="registered"> Mac OS</trademark> X, o usuário poderá configurar uma máquina virtual e, em seguida, instalar o sistema operacional convidado desejado.</para>

    <sect2 xml:id="virtualization-guest-vmware-install">
      <title>Instalando o FreeBSD no <application>VMware Fusion</application></title>

      <para>A primeira etapa é iniciar o <application>VMware Fusion</application>, que irá carregar a biblioteca de máquinas virtuais. Clique em <guimenuitem>Novo</guimenuitem> para criar a máquina virtual:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd01"/>
	</imageobject>
      </mediaobject>

      <para>Isto irá carregar o Assistente de Nova Máquina Virtual. Clique em <guimenuitem>Continuar</guimenuitem> para prosseguir:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd02"/>
	</imageobject>
      </mediaobject>

      <para>Selecione <guimenuitem>Outro</guimenuitem> como o <guimenuitem>Sistema Operacional</guimenuitem> e <guimenuitem>FreeBSD</guimenuitem> ou <guimenuitem>FreeBSD 64-bit</guimenuitem>, como <guimenu>Versão</guimenu> quando solicitado:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd03"/>
	</imageobject>
      </mediaobject>

      <para>Escolha o nome da máquina virtual e o diretório onde ela deve ser salva:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd04"/>
	</imageobject>
      </mediaobject>

      <para>Escolha o tamanho do disco rígido virtual para a máquina virtual:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd05"/>
	</imageobject>
      </mediaobject>

      <para>Escolha o método para instalar a máquina virtual, a partir de uma imagem <acronym>ISO</acronym> ou de um <acronym>CD</acronym>/<acronym>DVD</acronym>:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd06"/>
	</imageobject>
      </mediaobject>

      <para>Clique em <guimenuitem>Concluir</guimenuitem> e a máquina virtual inicializará:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd07"/>
	</imageobject>
      </mediaobject>

      <para>Instale o FreeBSD como de costume:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd08"/>
	</imageobject>
      </mediaobject>

      <para>Quando a instalação estiver concluída, as configurações da máquina virtual poderão ser modificadas, como o uso de memória:</para>

      <note>
	<para>As configurações de hardware do sistema da máquina virtual não podem ser modificadas enquanto a máquina virtual estiver em execução.</para>
      </note>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd09"/>
	</imageobject>
      </mediaobject>

      <para>O número de CPUs a que a máquina virtual terá acesso:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd10"/>
	</imageobject>
      </mediaobject>

      <para>O status do dispositivo <acronym>CD-ROM</acronym>. Normalmente, o <acronym>CD</acronym>/<acronym>DVD</acronym>/<acronym>ISO</acronym> é desconectado da máquina virtual quando não é mais necessário.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd11"/>
	</imageobject>
      </mediaobject>

      <para>A última coisa a mudar é como a máquina virtual se conectará à rede. Para permitir conexões à máquina virtual de outras máquinas além do host, escolha <guimenuitem>Conectar diretamente à rede física (Bridged)</guimenuitem>. Caso contrário, <guimenuitem>Compartilhar a conexão de internet do host (NAT)</guimenuitem> é preferível para que a máquina virtual possa ter acesso à Internet, porém sem que as demais maquinas da rede possam acessá-la.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd12"/>
	</imageobject>
      </mediaobject>

      <para>Depois de modificar as configurações, inicialize a máquina virtual FreeBSD recém-instalada.</para>
    </sect2>

    <sect2 xml:id="virtualization-guest-vmware-configure">
      <title>Configurando o FreeBSD no <application>VMware Fusion</application></title>

      <para>Depois que o FreeBSD for instalado com sucesso no <trademark class="registered">Mac OS</trademark> X rodando o <application>VMware Fusion</application>, existem várias etapas de configuração que podem ser executadas para otimizar o sistema para operar virtualizado.</para>

      <procedure>
	<step>
	  <title>Definir variáveis do Boot Loader</title>

	  <para>O passo mais importante é reduzir o valor do parâmetro <option>kern.hz</option> para reduzir a utilização da CPU do FreeBSD sob o ambiente do <application>VMware Fusion</application>. Isso é feito adicionando a seguinte linha ao <filename>/boot/loader.conf</filename>:</para>

	  <programlisting>kern.hz=100</programlisting>

	  <para>Sem esta configuração, uma VM idle do FreeBSD rodando sob o  <application>VMware Fusion</application> usará aproximadamente 15% da CPU de um único processador <trademark class="registered">iMac</trademark>. Após esta mudança, o uso ficará próximo de 5%.</para>
	</step>

	<step>
	  <title>Criar um novo arquivo de configuração do kernel</title>

	  <para>Todos os drivers de dispositivos FireWire e USB podem ser removidos do arquivo de configuração do kernel personalizado. O <application>VMware Fusion</application> fornece um adaptador de rede virtual usado pelo driver <citerefentry><refentrytitle>em</refentrytitle><manvolnum>4</manvolnum></citerefentry>, portanto, todos os dispositivos de rede, exceto o <citerefentry><refentrytitle>em</refentrytitle><manvolnum>4</manvolnum></citerefentry> podem ser removidos do kernel.</para>
	</step>

	<step>
	  <title>Configure a rede</title>

	  <para>A configuração de rede mais básica usa o DHCP para conectar a máquina virtual à mesma rede local que o host <trademark class="registered">Mac</trademark>. Isso pode ser feito adicionando <literal>ifconfig_em0="DHCP"</literal> ao <filename>/etc/rc.conf</filename>. Configurações de rede mais avançadas estão descritas em <xref linkend="advanced-networking"/>.</para>
	</step>
      </procedure>
    </sect2>
  </sect1>

  <sect1 xml:id="virtualization-guest-virtualbox">
    <title>FreeBSD como Sistema Operacional Convidado no <trademark>VirtualBox</trademark></title>

    <para>O FreeBSD funciona bem como um sistema operacional convidado no <application><trademark>VirtualBox</trademark></application>. O software de virtualização está disponível para a maioria dos sistemas operacionais comuns, incluindo o próprio FreeBSD.</para>

    <para>Os complementos de sistema operacional convidado do <application><trademark>VirtualBox</trademark></application> fornecem suporte para:</para>

    <itemizedlist>
      <listitem>
	<para>Compartilhamento de área de transferência.</para>
      </listitem>

      <listitem>
	<para>Integração do ponteiro do mouse.</para>
      </listitem>

      <listitem>
	<para>Sincronização de hora com o host.</para>
      </listitem>

      <listitem>
	<para>Redimensionamento de janela.</para>
      </listitem>

      <listitem>
	<para>Modo Seamless.</para>
      </listitem>
    </itemizedlist>

    <note>
      <para>Estes comandos são executados na instancia virtualizada do FreeBSD.</para>
    </note>

    <para>Primeiro, instale o pacote ou o port <package>emulators/virtualbox-ose-additions</package> na instancia virtualizada do FreeBSD. Isso irá instalar o port:</para>

    <screen><prompt>#</prompt> <userinput>cd /usr/ports/emulators/virtualbox-ose-additions &amp;&amp; make install clean</userinput></screen>

    <para>Adicione estas linhas ao <filename>/etc/rc.conf</filename>:</para>

    <programlisting>vboxguest_enable="YES"
vboxservice_enable="YES"</programlisting>

    <para>Se o <citerefentry><refentrytitle>ntpd</refentrytitle><manvolnum>8</manvolnum></citerefentry> ou o <citerefentry><refentrytitle>ntpdate</refentrytitle><manvolnum>8</manvolnum></citerefentry> estiver sendo utilizado, desabilite a sincronização de horário com o host:</para>

    <programlisting>vboxservice_flags="--disable-timesync"</programlisting>

    <para>O <application>Xorg</application> reconhecerá automaticamente o driver <literal>vboxvideo</literal>. Ele também pode ser inserido manualmente no <filename>/etc/X11/xorg.conf</filename>:</para>

    <programlisting>Section "Device"
	Identifier "Card0"
	Driver "vboxvideo"
	VendorName "InnoTek Systemberatung GmbH"
	BoardName "VirtualBox Graphics Adapter"
EndSection</programlisting>

    <para>Para usar o driver <literal>vboxmouse</literal>, ajuste a seção do mouse no <filename>/etc/X11/xorg.conf</filename>:</para>

    <programlisting>Section "InputDevice"
	Identifier "Mouse0"
	Driver "vboxmouse"
EndSection</programlisting>

    <para>Usuários do <acronym>HAL</acronym> devem criar o arquivo <filename>/usr/local/etc/hal/fdi/policy/90-vboxguest.fdi</filename> com o conteúdo abaixo ou copiá-lo de <filename>/usr/local/share/hal/fdi/policy/10osvendor/90-vboxguest.fdi</filename>:</para>

    <programlisting>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;!--
# Sun VirtualBox
# Hal driver description for the vboxmouse driver
# $Id: chapter.xml,v 1.33 2012-03-17 04:53:52 eadler Exp $

	Copyright (C) 2008-2009 Sun Microsystems, Inc.

	This file is part of VirtualBox Open Source Edition (OSE, as
	available from http://www.virtualbox.org. This file is free software;
	you can redistribute it and/or modify it under the terms of the GNU
	General Public License (GPL) as published by the Free Software
	Foundation, in version 2 as it comes in the "COPYING" file of the
	VirtualBox OSE distribution. VirtualBox OSE is distributed in the
	hope that it will be useful, but WITHOUT ANY WARRANTY of any kind.

	Please contact Sun Microsystems, Inc., 4150 Network Circle, Santa
	Clara, CA 95054 USA or visit http://www.sun.com if you need
	additional information or have any questions.
--&gt;
&lt;deviceinfo version="0.2"&gt;
  &lt;device&gt;
    &lt;match key="info.subsystem" string="pci"&gt;
      &lt;match key="info.product" string="VirtualBox guest Service"&gt;
        &lt;append key="info.capabilities" type="strlist"&gt;input&lt;/append&gt;
	&lt;append key="info.capabilities" type="strlist"&gt;input.mouse&lt;/append&gt;
        &lt;merge key="input.x11_driver" type="string"&gt;vboxmouse&lt;/merge&gt;
	&lt;merge key="input.device" type="string"&gt;/dev/vboxguest&lt;/merge&gt;
      &lt;/match&gt;
    &lt;/match&gt;
  &lt;/device&gt;
&lt;/deviceinfo&gt;</programlisting>

    <para>Pastas compartilhadas para transferências de arquivos entre o host e a VM são acessíveis montando-as usando <literal>mount_vboxvfs</literal>. Uma pasta compartilhada pode ser criada no host usando a GUI do VirtualBox ou via <command>vboxmanage</command>. Por exemplo, para criar uma pasta compartilhada chamada <replaceable>myshare</replaceable> em <filename><replaceable>/mnt/bsdboxshare </replaceable></filename> para a VM denominada <replaceable>BSDBox</replaceable>, execute :</para>

    <screen><prompt>#</prompt> <userinput>vboxmanage sharedfolder add '<replaceable>BSDBox</replaceable>' --name <replaceable>myshare</replaceable> --hostpath <replaceable>/mnt/bsdboxshare</replaceable></userinput></screen>

    <para>Observe que o nome da pasta compartilhada não deve conter espaços. Monte a pasta compartilhada de dentro do sistema convidado desta forma:</para>

    <screen><prompt>#</prompt> <userinput>mount_vboxvfs -w <replaceable>myshare</replaceable> <replaceable>/mnt</replaceable></userinput></screen>
  </sect1>

  <sect1 xml:id="virtualization-host-virtualbox">
    <title>FreeBSD como Host com <trademark>VirtualBox</trademark></title>

    <para>O <application><trademark>VirtualBox</trademark></application> é um pacote de virtualização completo e ativamente desenvolvido, disponível para a maioria dos sistemas operacionais, incluindo <trademark class="registered">Windows</trademark>, <trademark class="registered">Mac OS</trademark>, <trademark class="registered">Linux</trademark> e FreeBSD. Ele é igualmente capaz de executar sistemas operacionais convidados como o <trademark class="registered">Windows</trademark> ou <trademark class="registered">UNIX</trademark>-like. Ele é distribuído como um software de código aberto, mas com componentes de código fechado disponíveis em um pacote de extensão separado. Esses componentes incluem suporte para dispositivos USB 2.0. Maiores informações podem ser encontradas na página wiki sobre <link xlink:href="http://www.virtualbox.org/wiki/Downloads"><quote>Downloads</quote> do <application><trademark>VirtualBox</trademark></application></link>. Atualmente, essas extensões não estão disponíveis para o FreeBSD.</para>

    <sect2 xml:id="virtualization-virtualbox-install">
      <title>Instalando o <trademark>VirtualBox</trademark></title>

      <para>O <application><trademark>VirtualBox</trademark></application> está disponível como um pacote ou port do FreeBSD em <package>emulators/virtualbox-ose</package>. O port pode ser instalado usando estes comandos:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/emulators/virtualbox-ose</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>

      <para>Uma opção útil no menu de configuração do port é o conjunto de programas <literal>GuestAdditions</literal>. Eles fornecem vários recursos úteis em sistemas operacionais convidados, como integração de ponteiro de mouse (permitindo que o mouse seja compartilhado entre host e o sistema convidado sem a necessidade de pressionar um atalho de teclado especial para alternar) e renderização de vídeo mais rápida, especialmente em sistemas convidados <trademark class="registered">Windows</trademark>. Os complementos para os sistemas convidados estão disponíveis no menu <guimenu>Dispositivos</guimenu>, após a conclusão da instalação do sistema convidado.</para>

      <para>Algumas alterações de configuração são necessárias antes do <application><trademark>VirtualBox</trademark></application> ser iniciado pela primeira vez. O port instala um módulo de kernel em <filename>/boot/modules</filename> o qual deve ser carregado no kernel em execução:</para>

      <screen><prompt>#</prompt> <userinput>kldload vboxdrv</userinput></screen>

      <para>Para garantir que o módulo seja sempre carregado após uma reinicialização, adicione esta linha ao <filename>/boot/loader.conf</filename>:</para>

      <programlisting>vboxdrv_load="YES"</programlisting>

      <para>Para usar os módulos do kernel que permitem conexões de rede bridged ou host-only, adicione esta linha ao <filename>/etc/rc.conf</filename> e reinicie o computador:</para>

      <programlisting>vboxnet_enable="YES"</programlisting>

      <para>O grupo <systemitem class="groupname">vboxusers</systemitem> é criado durante a instalação do <application><trademark>VirtualBox</trademark></application>. Todos os usuários que precisam acessar o <application><trademark>VirtualBox</trademark></application> deverão ser adicionados como membros desse grupo. O comando <command>pw</command> pode ser usado para adicionar novos membros:</para>

      <screen><prompt>#</prompt> <userinput>pw groupmod vboxusers -m <replaceable>yourusername</replaceable></userinput></screen>

      <para>As permissões padrão para o <filename>/dev/vboxnetctl</filename> são restritivas e precisam ser alteradas para redes em modo Bridged:</para>

      <screen><prompt>#</prompt> <userinput>chown root:vboxusers /dev/vboxnetctl</userinput>
<prompt>#</prompt> <userinput>chmod 0660 /dev/vboxnetctl</userinput></screen>

      <para>Para tornar esta permissão permanente, adicione estas linhas ao <filename>/etc/devfs.conf</filename>:</para>

      <programlisting>own     vboxnetctl root:vboxusers
perm    vboxnetctl 0660</programlisting>

      <para>Para iniciar o <application><trademark>VirtualBox</trademark></application>, digite a partir de uma sessão <application>Xorg</application>:</para>

      <screen><prompt>%</prompt> <userinput>VirtualBox</userinput></screen>

      <para>Para mais informações sobre como configurar e usar o <application><trademark>VirtualBox</trademark></application>, consulte o <link xlink:href="http://www.virtualbox.org">site oficial</link>. Para obter informações específicas sobre o FreeBSD e instruções para a solução de problemas, consulte a <link xlink:href="http://wiki.FreeBSD.org/VirtualBox">página relevante no wiki do FreeBSD</link>.</para>
    </sect2>

    <sect2 xml:id="virtualization-virtualbox-usb-support">
      <title>Suporte USB no <trademark>VirtualBox</trademark></title>

      <para>O <application><trademark>VirtualBox</trademark></application> pode ser configurado para passar dispositivos <acronym>USB</acronym> para o sistema operacional convidado. O controlador host da versão do OSE está limitado a emular dispositivos <acronym>USB</acronym> 1.1 até que o pacote de extensão que suporta dispositivos <acronym>USB</acronym> 2.0 e 3.0 esteja disponível no FreeBSD.</para>

      <para>Para que o <application><trademark>VirtualBox</trademark></application> esteja ciente dos dispositivos <acronym>USB</acronym> conectados à máquina, o usuário precisa ser um membro do grupo <systemitem class="groupname">operator</systemitem>.</para>

      <screen><prompt>#</prompt> <userinput>pw groupmod operator -m <replaceable>yourusername</replaceable></userinput></screen>

      <para>Em seguida, adicione as seguintes linhas ao <filename>/etc/rc.conf</filename>:</para>

      <programlisting>[system=10]
add path 'usb/*' mode 0660 group operator</programlisting>

      <para>Em seguida, adicione as seguintes linhas ao <filename>/etc/rc.conf</filename>:</para>

      <programlisting>devfs_system_ruleset="system"</programlisting>

      <para>Então reinicie o devfs:</para>

      <screen><prompt>#</prompt> <userinput>service devfs restart</userinput></screen>

      <para>Reinicie a sessão de login e o <application><trademark>VirtualBox</trademark></application> para que essas alterações entrem em vigor e crie os filtros <acronym>USB</acronym> conforme necessário.</para>
    </sect2>

    <sect2 xml:id="virtualization-virtualbox-host-dvd-cd-access">
      <title>Acesso ao drive de <acronym>DVD</acronym>/<acronym>CD</acronym> no Host <trademark>VirtualBox</trademark></title>

      <para>O acesso às unidades de <acronym>DVD</acronym>/<acronym>CD</acronym> do Host a partir dos convidados é obtido através do compartilhamento das unidades físicas. Dentro do <trademark>VirtualBox</trademark>, isso é configurado a partir da janela Armazenamento nas Configurações da máquina virtual. Se necessário, crie primeiro um dispositivo vazio <acronym>IDE</acronym> <acronym>CD</acronym>/<acronym>DVD</acronym>. Em seguida, escolha a unidade do host no menu pop-up para a seleção de unidade virtual de <acronym>CD</acronym>/<acronym>DVD</acronym>. Uma caixa de seleção rotulada como <literal>Passthrough</literal> será exibida. Isso permitirá que a máquina virtual use o hardware diretamente. Por exemplo, <acronym>CD</acronym>s de áudio ou o gravador só funcionará se esta opção estiver selecionada.</para>

      <para>O <acronym>HAL</acronym> precisa ser executado para que as funções de <acronym>DVD</acronym>/<acronym>CD</acronym> do <application><trademark>VirtualBox</trademark></application> funcionem, então habilite-o no <filename>/etc/rc.conf</filename> e inicie-o se ele ainda não estiver em execução:</para>

      <programlisting>hald_enable="YES"</programlisting>

      <screen><prompt>#</prompt> <userinput>service hald start</userinput></screen>

      <para>Para que os usuários possam usar as funções de <acronym>DVD</acronym>/<acronym>CD</acronym> do  <application><trademark>VirtualBox</trademark></application>, eles precisam acessar  <filename>/dev/xpt0</filename>, <filename>/dev/cd<replaceable>N</replaceable></filename>, e <filename>/dev/pass<replaceable>N</replaceable></filename>. Isso geralmente é obtido tornando o usuário um membro do grupo <systemitem class="groupname">operator</systemitem>. As permissões para esses dispositivos devem ser corrigidas adicionando estas linhas ao <filename> /etc/devfs.conf </filename>:</para>

      <programlisting>perm cd* 0660
perm xpt0 0660
perm pass* 0660</programlisting>

      <screen><prompt>#</prompt> <userinput>service devfs restart</userinput></screen>
    </sect2>
  </sect1>

  <sect1 xml:id="virtualization-host-bhyve">
    <title>FreeBSD como um Host <application>bhyve</application></title>

    <para>O hypervisor <application>bhyve</application> <acronym>BSD</acronym>-licensed tornou-se parte do sistema base com o FreeBSD 10.0-RELEASE. Este hypervisor suporta uma grande variedade de sistemas operacionais  convidados, incluindo FreeBSD, OpenBSD e muitas distribuições <trademark class="registered">Linux</trademark>. Por padrão, o <application>bhyve</application> fornece acesso ao console serial e não emula um console gráfico. Os recursos de offload de virtualização das <acronym>CPU</acronym>s mais recentes são usados para evitar os métodos legados de tradução de instruções e de gerenciamento manual de mapeamentos de memória.</para>

    <para>O design do <application>bhyve</application> requer um processador que suporte tabelas de páginas estendidas da <trademark class="registered">Intel</trademark> (<acronym>EPT</acronym>) ou a Indexação Rápida de Virtualização da <trademark class="registered">AMD</trademark> (<acronym>RVI</acronym>) ou Tabelas de Páginas Aninhadas (<acronym>NPT</acronym>). Hospedar sistemas operacionais convidados <trademark class="registered">Linux</trademark> ou convidados FreeBSD com mais de uma <acronym>vCPU</acronym> requer suporte a modo irrestrito de <acronym>VMX</acronym> (<acronym>UG</acronym>). A maioria dos processadores mais recentes, especificamente o <trademark class="registered">Intel</trademark> <trademark>Core</trademark> i3/i5/i7 e o <trademark class="registered">Intel</trademark> <trademark>Xeon</trademark> E3/E5/E7, suportam esses recursos. O suporte <acronym>UG</acronym> foi introduzido com a microarquitetura Westmere da Intel. Para obter uma lista completa dos processadores <trademark class="registered">Intel</trademark> que suportam <acronym>EPT</acronym>, consulte <link xlink:href="https://ark.intel.com/content/www/us/en/ark/search/featurefilter.html?productType=873&amp;0_ExtendedPageTables=True"/>. O <acronym>RVI</acronym> é encontrado na terceira geração e depois nos processadores <trademark>AMD Opteron</trademark> (Barcelona). A maneira mais fácil de saber se um processador suporta o <application>bhyve</application> é executar o <command>dmesg</command> ou procurar no <filename>/var/run/dmesg.boot</filename> pelo o Sinalizador de recurso do processador <literal>POPCNT</literal> na linha <literal>Features2</literal> para processadores <trademark class="registered">AMD</trademark> ou <literal>EPT</literal> e <literal>UG</literal> na linha <literal>VT-x </literal> para os processadores <trademark class="registered">Intel</trademark>.</para>

    <sect2 xml:id="virtualization-bhyve-prep">
      <title>Preparando o host</title>

      <para>O primeiro passo para criar uma máquina virtual no <application>bhyve</application> é configurar o sistema host. Primeiro, carregue o módulo do kernel <application>bhyve</application>:</para>

      <screen><prompt>#</prompt> <userinput>kldload vmm</userinput></screen>

      <para>Em seguida, crie uma interface <filename>tap</filename> para o dispositivo de rede na máquina virtual para anexar. Para que o dispositivo de rede participe da rede, crie também uma interface de bridge contendo a interface <filename>tap</filename> e a interface física como membros. Neste exemplo, a interface física é <replaceable>igb0</replaceable>:</para>

      <screen><prompt>#</prompt> <userinput>ifconfig <replaceable>tap0</replaceable> create</userinput>
<prompt>#</prompt> <userinput>sysctl net.link.tap.up_on_open=1</userinput>
net.link.tap.up_on_open: 0 -&gt; 1
<prompt>#</prompt> <userinput>ifconfig <replaceable>bridge0</replaceable> create</userinput>
<prompt>#</prompt> <userinput>ifconfig <replaceable>bridge0</replaceable> addm <replaceable>igb0</replaceable> addm <replaceable>tap0</replaceable></userinput>
<prompt>#</prompt> <userinput>ifconfig <replaceable>bridge0</replaceable> up</userinput></screen>
    </sect2>

    <sect2 xml:id="virtualization-bhyve-freebsd">
      <title>Criando um Sistema Operacional Convidado do FreeBSD</title>

      <para>Crie um arquivo para usar como o disco virtual da máquina convidada. Especifique o tamanho e o nome do disco virtual:</para>

      <screen><prompt>#</prompt> <userinput>truncate -s <replaceable>16G</replaceable> <replaceable>guest.img</replaceable></userinput></screen>

      <para>Baixe uma imagem de instalação do FreeBSD para instalar:</para>

      <screen><prompt>#</prompt> <userinput>fetch <replaceable>ftp://ftp.freebsd.org/pub/FreeBSD/releases/ISO-IMAGES/10.3/FreeBSD-10.3-RELEASE-amd64-bootonly.iso</replaceable></userinput>
FreeBSD-10.3-RELEASE-amd64-bootonly.iso       100% of  230 MB  570 kBps 06m17s</screen>

      <para>O FreeBSD vem com um script de exemplo para executar uma máquina virtual com o <application>bhyve</application>. O script iniciará a máquina virtual e a executará em um loop, para que ela seja reiniciada automaticamente se houver falha. O script usa várias opções para controlar a configuração da máquina: <option>-c</option> controla o número de CPUs virtuais, <option>-m</option> limita a quantidade de memória disponível para o sistema operacional convidado, <option>-t</option> define qual dispositivo <filename>tap</filename> usar, <option>-d</option> indica qual imagem de disco usar, <option> -i </option> indica ao <application>bhyve</application> para inicializar a partir da imagem <acronym>CD</acronym> em vez do disco, e <option>-I</option> define qual imagem de <acronym>CD</acronym> deve ser usada. O último parâmetro é o nome da máquina virtual, usada para rastrear as máquinas em execução. Este exemplo inicia a máquina virtual no modo de instalação:</para>

      <screen><prompt>#</prompt> <userinput>sh /usr/share/examples/bhyve/vmrun.sh -c <replaceable>1</replaceable> -m <replaceable>1024M</replaceable> -t <replaceable>tap0</replaceable> -d <replaceable>guest.img</replaceable> -i -I <replaceable>FreeBSD-10.3-RELEASE-amd64-bootonly.iso</replaceable> <replaceable>guestname</replaceable></userinput></screen>

      <para>A máquina virtual inicializará e iniciará o instalador. Depois de instalar um sistema na máquina virtual, quando o sistema perguntar sobre a inserção em um shell no final da instalação, escolha <guibutton>Yes</guibutton>.</para>

      <para>Reinicialize a máquina virtual. Enquanto a reinicialização da máquina virtual fará o <application>bhyve</application> finalizar, o script <filename>vmrun.sh</filename> executa o <command>bhyve</command> em um loop e o reiniciará automaticamente. Quando isso acontecer, escolha a opção de reinicialização no menu do carregador de inicialização para escapar do loop. Agora o convidado pode ser iniciado a partir do disco virtual:</para>

      <screen><prompt>#</prompt> <userinput>sh /usr/share/examples/bhyve/vmrun.sh -c <replaceable>4</replaceable> -m <replaceable>1024M</replaceable> -t <replaceable>tap0</replaceable> -d <replaceable>guest.img</replaceable> <replaceable>guestname</replaceable></userinput></screen>
    </sect2>

    <sect2 xml:id="virtualization-bhyve-linux">
      <title>Criando um Sistema Operacional convidado <trademark class="registered">Linux</trademark></title>

      <para>Para inicializar sistemas operacionais diferentes do FreeBSD, o port <package>sysutils/grub2-bhyve</package> deve ser instalada primeiro.</para>

      <para>Em seguida, crie um arquivo para usar como o disco virtual da máquina convidada:</para>

      <screen><prompt>#</prompt> <userinput>truncate -s <replaceable>16G</replaceable> <replaceable>linux.img</replaceable></userinput></screen>

      <para>Iniciar uma máquina virtual com o <application>bhyve</application> é um processo de duas etapas. Primeiro um kernel deve ser carregado, então o sistema operacional convidado pode ser iniciado. O kernel <trademark class="registered">Linux</trademark> é carregado com o <package>sysutils/grub2-bhyve</package>. Crie um <filename>device.map</filename> que o <application>grub</application> usará para mapear os dispositivos virtuais para os arquivos no sistema host:</para>

      <programlisting>(hd0) ./linux.img
(cd0) ./somelinux.iso</programlisting>

      <para>Use o <package>sysutils/grub2-bhyve</package> para carregar o kernel <trademark class="registered">Linux</trademark> de uma imagem <acronym>ISO</acronym>:</para>

      <screen><prompt>#</prompt> <userinput>grub-bhyve -m device.map -r cd0 -M <replaceable>1024M</replaceable> <replaceable>linuxguest</replaceable></userinput></screen>

      <para>Isto irá iniciar o grub. Se o <acronym>CD</acronym> de instalação contiver um <filename>grub.cfg</filename>, um menu será exibido. Caso contrário, os arquivos <literal>vmlinuz</literal> e <literal>initrd</literal> devem ser localizados e carregados manualmente:</para>

      <screen>grub&gt; <userinput>ls</userinput>
(hd0) (cd0) (cd0,msdos1) (host)
grub&gt; <userinput>ls (cd0)/isolinux</userinput>
boot.cat boot.msg grub.conf initrd.img isolinux.bin isolinux.cfg memtest
splash.jpg TRANS.TBL vesamenu.c32 vmlinuz
grub&gt; <userinput>linux (cd0)/isolinux/vmlinuz</userinput>
grub&gt; <userinput>initrd (cd0)/isolinux/initrd.img</userinput>
grub&gt; <userinput>boot</userinput></screen>

      <para>Agora que o kernel <trademark class="registered">Linux</trademark> está carregado, o sistema convidado pode ser iniciado:</para>

      <screen><prompt>#</prompt> <userinput>bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,<replaceable>tap0</replaceable> -s 3:0,virtio-blk,<replaceable>./linux.img</replaceable> \
    -s 4:0,ahci-cd,<replaceable>./somelinux.iso</replaceable> -l com1,stdio -c <replaceable>4</replaceable> -m <replaceable>1024M</replaceable> <replaceable>linuxguest</replaceable></userinput></screen>

      <para>O sistema inicializará e iniciará o instalador. Depois de instalar um sistema na máquina virtual, reinicialize a máquina virtual. Isso fará com que o <application>bhyve</application> seja encerrado. A instância da máquina virtual precisa ser destruída antes de poder ser iniciada novamente:</para>

      <screen><prompt>#</prompt> <userinput>bhyvectl --destroy --vm=<replaceable>linuxguest</replaceable></userinput></screen>

      <para>Agora, o sistema convidado pode ser iniciado diretamente do disco virtual. Carregue o kernel:</para>

      <screen><prompt>#</prompt> <userinput>grub-bhyve -m device.map -r hd0,msdos1 -M <replaceable>1024M</replaceable> <replaceable>linuxguest</replaceable></userinput>
grub&gt; <userinput>ls</userinput>
(hd0) (hd0,msdos2) (hd0,msdos1) (cd0) (cd0,msdos1) (host)
(lvm/VolGroup-lv_swap) (lvm/VolGroup-lv_root)
grub&gt; <userinput>ls (hd0,msdos1)/</userinput>
lost+found/ grub/ efi/ System.map-2.6.32-431.el6.x86_64 config-2.6.32-431.el6.x
86_64 symvers-2.6.32-431.el6.x86_64.gz vmlinuz-2.6.32-431.el6.x86_64
initramfs-2.6.32-431.el6.x86_64.img
grub&gt; <userinput>linux (hd0,msdos1)/vmlinuz-2.6.32-431.el6.x86_64 root=/dev/mapper/VolGroup-lv_root</userinput>
grub&gt; <userinput>initrd (hd0,msdos1)/initramfs-2.6.32-431.el6.x86_64.img</userinput>
grub&gt; <userinput>boot</userinput></screen>

      <para>Inicialize a máquina virtual:</para>

      <screen><prompt>#</prompt> <userinput>bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,<replaceable>tap0</replaceable> \
    -s 3:0,virtio-blk,<replaceable>./linux.img</replaceable> -l com1,stdio -c <replaceable>4</replaceable> -m <replaceable>1024M</replaceable> <replaceable>linuxguest</replaceable></userinput></screen>

      <para>O <trademark class="registered">Linux</trademark> iniciará agora na máquina virtual e, eventualmente, apresentará o prompt de login. Faça o login e use a máquina virtual. Quando terminar, reinicialize a máquina virtual para sair do <application>bhyve</application>. Destrua a instância da máquina virtual:</para>

      <screen><prompt>#</prompt> <userinput>bhyvectl --destroy --vm=<replaceable>linuxguest</replaceable></userinput></screen>
    </sect2>

    <sect2 xml:id="virtualization-bhyve-uefi">
      <title>Inicializando máquinas virtuais <application>bhyve</application> com Firmware <acronym>UEFI</acronym></title>

      <para>Além do <application>bhyveload</application> e do <application>grub-bhyve</application>, o hypervisor <application>bhyve</application> também pode inicializar máquinas virtuais usando o firmware do espaço de usuário <acronym>UEFI</acronym> . Esta opção pode suportar sistemas operacionais convidados que não são suportados pelos outros carregadores.</para>

      <para>Para utilizar o suporte ao <acronym>UEFI</acronym> no <application>bhyve</application>, primeiro obtenha as imagens de firmware <acronym>UEFI</acronym>. Isto pode ser feito instalando o port ou pacote <package>sysutils/bhyve-firmware </package>.</para>

      <para>Com o firmware no lugar, adicione os sinalizadores <option>-l bootrom,<replaceable>/path/to/firmware</replaceable></option> à linha de comando do <application>bhyve</application>. A sintaxe real do <application>bhyve</application> pode se parecer com a seguinte:</para>

      <screen><prompt>#</prompt> <userinput>bhyve -AHP -s 0:0,hostbridge -s 1:0,lpc \
-s 2:0,virtio-net,<replaceable>tap1</replaceable> -s 3:0,virtio-blk,<replaceable>./disk.img</replaceable> \
-s 4:0,ahci-cd,<replaceable>./install.iso</replaceable> -c <replaceable>4</replaceable> -m <replaceable>1024M</replaceable> \
-l bootrom,<replaceable>/usr/local/share/uefi-firmware/BHYVE_UEFI.fd</replaceable> \
<replaceable>guest</replaceable></userinput></screen>

      <para>O <package>sysutils/bhyve-firmware</package> também contém um firmware habilitado para <acronym>CSM</acronym>, para inicializar sistemas operacionais hóspedes sem suporte à <acronym>UEFI</acronym> no modo de <acronym>BIOS</acronym> legado:</para>

      <screen><prompt>#</prompt> <userinput>bhyve -AHP -s 0:0,hostbridge -s 1:0,lpc \
-s 2:0,virtio-net,<replaceable>tap1</replaceable> -s 3:0,virtio-blk,<replaceable>./disk.img</replaceable> \
-s 4:0,ahci-cd,<replaceable>./install.iso</replaceable> -c <replaceable>4</replaceable> -m <replaceable>1024M</replaceable> \
-l bootrom,<replaceable>/usr/local/share/uefi-firmware/BHYVE_UEFI_CSM.fd</replaceable> \
<replaceable>guest</replaceable></userinput></screen>
    </sect2>

    <sect2 xml:id="virtualization-bhyve-framebuffer">
      <title>Framebuffer <acronym>UEFI</acronym> Gráfico para <application>bhyve</application></title>

      <para>O suporte ao firmware <acronym>UEFI</acronym> é particularmente útil em sistemas operacionais convidados predominantemente gráficos, como o Microsoft <trademark class="registered">Windows</trademark>.</para>

      <para>O suporte para o framebuffer UEFI-GOP também pode ser ativado com os sinalizadores <option>-s 29,fbuf,tcp=<replaceable>0.0.0.0:5900</replaceable></option>. A resolução do framebuffer pode ser configurada com <option>w=<replaceable>800</replaceable></option> e <option>h=<replaceable>600</replaceable></option> e o <application>bhyve</application> pode ser instruído para aguardar uma conexão <acronym>VNC</acronym> antes de inicializar o sistema operacional convidado adicionando <option>wait</option>. O framebuffer pode ser acessado pelo host ou pela rede através do protocolo <acronym>VNC</acronym>. Além disso, <option>-s 30,xhci,tablet</option> pode ser adicionado para obter a sincronização precisa do cursor do mouse com o host.</para>

      <para>O comando <application>bhyve</application> resultante ficaria assim:</para>

      <screen><prompt>#</prompt> <userinput>bhyve -AHP -s 0:0,hostbridge -s 31:0,lpc \
-s 2:0,virtio-net,<replaceable>tap1</replaceable> -s 3:0,virtio-blk,<replaceable>./disk.img</replaceable> \
-s 4:0,ahci-cd,<replaceable>./install.iso</replaceable> -c <replaceable>4</replaceable> -m <replaceable>1024M</replaceable> \
-s 29,fbuf,tcp=<replaceable>0.0.0.0:5900</replaceable>,w=<replaceable>800</replaceable>,h=<replaceable>600</replaceable>,wait \
-s 30,xhci,tablet \
-l bootrom,<replaceable>/usr/local/share/uefi-firmware/BHYVE_UEFI.fd</replaceable> \
<replaceable>guest</replaceable></userinput></screen>

      <para>Observe que, no modo de emulação do BIOS, o framebuffer deixará de receber atualizações quando o controle for passado do firmware para o sistema operacional convidado.</para>
    </sect2>

    <sect2 xml:id="virtualization-bhyve-zfs">
      <title>Usando o <acronym>ZFS</acronym> com os sistemas operacionais convidados no <application>bhyve</application></title>

      <para>Se o <acronym>ZFS</acronym> estiver disponível na máquina host, o uso de volumes <acronym>ZFS</acronym> em vez de arquivos de imagem de disco pode fornecer benefícios significativos de desempenho para as <acronym>VMs</acronym> convidadas. Um volume <acronym>ZFS</acronym> pode ser criado por:</para>

      <screen><prompt>#</prompt> <userinput>zfs create -V<replaceable>16G</replaceable> -o volmode=dev <replaceable>zroot/linuxdisk0</replaceable></userinput></screen>

      <para>Ao iniciar a <acronym>VM</acronym>, especifique o volume <acronym>ZFS</acronym> como a unidade de disco:</para>

      <screen><prompt>#</prompt> <userinput>bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,<replaceable>tap0</replaceable> -s3:0,virtio-blk,<replaceable>/dev/zvol/zroot/linuxdisk0</replaceable> \
    -l com1,<replaceable>stdio</replaceable> -c <replaceable>4</replaceable> -m <replaceable>1024M</replaceable> <replaceable>linuxguest</replaceable></userinput></screen>
    </sect2>

    <sect2 xml:id="virtualization-bhyve-nmdm">
      <title>Consoles de máquinas virtuais</title>

      <para>É vantajoso executar o console do <application>bhyve</application> em uma ferramenta de gerenciamento de sessão, como o <package>sysutils/tmux</package> ou <package>sysutils/screen</package>, para que possa desanexar e reanexar o console. Também é possível ter o console do <application>bhyve</application> como um dispositivo de modem nulo o qual pode ser acessado com o comando <command>cu</command>. Para fazer isso, carregue o módulo do kernel <filename>nmdm</filename> e substitua <option>-l com1,stdio</option> with <option>-l com1,/dev/nmdm0A</option>. Os dispositivos <filename>/dev/nmdm</filename> são criados automaticamente conforme necessário, onde cada um é um par, correspondente às duas extremidades do cabo de modem nulo (<filename>/dev/nmdm0A</filename> e <filename>/dev/nmdm0B</filename>). Veja <citerefentry><refentrytitle>nmdm</refentrytitle><manvolnum>4</manvolnum></citerefentry> para maiores informações.</para>

      <screen><prompt>#</prompt> <userinput>kldload nmdm</userinput>
<prompt>#</prompt> <userinput>bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,<replaceable>tap0</replaceable> -s 3:0,virtio-blk,<replaceable>./linux.img</replaceable> \
    -l com1,<replaceable>/dev/nmdm0A</replaceable> -c <replaceable>4</replaceable> -m <replaceable>1024M</replaceable> <replaceable>linuxguest</replaceable></userinput>
<prompt>#</prompt> <userinput>cu -l <replaceable>/dev/nmdm0B</replaceable></userinput>
Connected

Ubuntu 13.10 handbook ttyS0

handbook login:</screen>
    </sect2>

    <sect2 xml:id="virtualization-bhyve-managing">
      <title>Gerenciando Máquinas Virtuais</title>

      <para>Um nó de dispositivo é criado em <filename role="directory">/dev/vmm</filename> para cada máquina virtual. Isso permite que o administrador veja facilmente uma lista das máquinas virtuais em execução:</para>

      <screen><prompt>#</prompt> <userinput>ls -al /dev/vmm</userinput>
total 1
dr-xr-xr-x   2 root  wheel    512 Mar 17 12:19 ./
dr-xr-xr-x  14 root  wheel    512 Mar 17 06:38 ../
crw-------   1 root  wheel  0x1a2 Mar 17 12:20 guestname
crw-------   1 root  wheel  0x19f Mar 17 12:19 linuxguest
crw-------   1 root  wheel  0x1a1 Mar 17 12:19 otherguest</screen>

      <para>Uma máquina virtual especificada pode ser destruída usando <command>bhyvectl</command>:</para>

      <screen><prompt>#</prompt> <userinput>bhyvectl --destroy --vm=<replaceable>guestname</replaceable></userinput></screen>
    </sect2>

    <sect2 xml:id="virtualization-bhyve-onboot">
      <title>Configuração Persistente</title>

      <para>Para configurar o sistema para iniciar os sistemas operacionais convidados do <application>bhyve</application> no momento da inicialização, as seguintes configurações devem ser feitas nos arquivos especificados:</para>

      <procedure>
	<step>
	  <title><filename>/etc/sysctl.conf</filename></title>

	  <programlisting>net.link.tap.up_on_open=1</programlisting>
	</step>

	<step>
	  <title><filename>/etc/rc.conf</filename></title>

	  <programlisting>cloned_interfaces="<replaceable>bridge0</replaceable> <replaceable>tap0</replaceable>"
ifconfig_bridge0="addm <replaceable>igb0</replaceable> addm <replaceable>tap0</replaceable>"
kld_list="nmdm vmm"</programlisting>
	</step>
      </procedure>
    </sect2>
  </sect1>

  <sect1 xml:id="virtualization-host-xen">
    <title>FreeBSD como Host <trademark>Xen</trademark></title>

    <para>O <application>Xen</application> é um <link xlink:href="https://en.wikipedia.org/wiki/Hypervisor#Classification">hypervisor tipo 1</link> licenciado sob a GPLv2 para arquiteturas <trademark class="registered">Intel</trademark> e <trademark class="registered">ARM</trademark>. O FreeBSD suporta domínios não privilegiados (máquina virtual) nas plataformas <trademark>i386</trademark> e <trademark class="registered">AMD</trademark> 64-Bit <link xlink:href="https://wiki.xenproject.org/wiki/DomU">DomU</link> e <link xlink:href="https://en.wikipedia.org/wiki/Amazon_Elastic_Compute_Cloud">Amazon EC2</link> desde o FreeBSD 8.0 e incluiu o suporte ao domínio de controle Dom0 (host) no FreeBSD 11.0. O suporte para domínios para-virtualizados (PV) foi removido do FreeBSD 11 em favor de domínios virtualizados de hardware (HVM), o que proporciona melhor desempenho.</para>

    <para>O <trademark>Xen</trademark> é um hypervisor bare-metal, o que significa que é o primeiro programa carregado após o BIOS. Um convidado especial privilegiado chamado Domain-0 (<literal>Dom0</literal> para abreviar) é então iniciado. O Dom0 usa seus privilégios especiais para acessar diretamente o hardware físico subjacente, tornando-o uma solução de alto desempenho. Ele é capaz de acessar os controladores de disco e adaptadores de rede diretamente. As ferramentas de gerenciamento do <trademark>Xen</trademark> para gerenciar e controlar o hypervisor <trademark>Xen</trademark> também são usadas pelo Dom0 para criar, listar e destruir VMs. Dom0 fornece discos virtuais e recursos de rede para domínios sem privilégios, geralmente chamados de <literal>DomU</literal>. O <trademark>Xen</trademark> Dom0 pode ser comparado ao console de serviço de outras soluções de hypervisor , enquanto o DomU é onde as VMs convidadas são executadas.</para>

<!-- Hidden until the mode in which FreeBSD uses Xen is supported.
    <para>Features of &xen; include GPU passthrough from the host
      running the Dom0 into a DomU guest machine.  This requires a
      CPU, chipset, and BIOS with VT-D support and might require extra
      patches or not work with all graphics cards.  A list of adapters
      can be found in the <link
	xlink:href="https://wiki.xenproject.org/wiki/Xen_VGA_Passthrough_Tested_Adapters">Xen
	Wiki</link>.  Note that not all GPUs listed there are
      supported on &os;.  The  &xen; hypervisor also supports PCI
      passthrough to give a DomU guest full, direct access to a PCI
      device like NIC, disk controller, or soundcard.</para>
-->
    <para>O <trademark>Xen</trademark> pode migrar VMs entre diferentes servidores <trademark>Xen</trademark>. Quando os dois hosts xen compartilham o mesmo armazenamento subjacente, a migração pode ser feita sem a necessidade de primeiro desligar a VM. Em vez disso, a migração é executada ao vivo enquanto o DomU está em execução e não há necessidade de reiniciá-lo ou planejar um tempo de inatividade. Isso é útil em cenários de manutenção ou em janelas de atualização para garantir que os serviços fornecidos pelo DomU continuem disponiveis. Muitos outros recursos do <trademark>Xen</trademark> estão listados na <link xlink:href="https://wiki.xenproject.org/wiki/Category:Overview">página wiki com a visão global sobre o Xen</link>. Note que ainda nem todos os recursos são suportados no FreeBSD.</para>

    <sect2 xml:id="virtualization-host-xen-requirements">
      <title>Requisitos de hardware para o <trademark>Xen</trademark> Dom0</title>

      <para>Para executar o hypervisor <trademark>Xen</trademark> em um host, são necessárias certas funcionalidades de hardware. Os domínios virtualizados de hardware requerem o suporte à Tabela de Páginas Estendidas (<link xlink:href="http://en.wikipedia.org/wiki/Extended_Page_Table">EPT</link>) e à Unidade de Gerenciamento de Memória de Entrada / Saída (<link xlink:href="http://en.wikipedia.org/wiki/List_of_IOMMU-supporting_hardware">IOMMU</link>) no processador do host.</para>

      <note>
	<para>Para executar um <trademark>Xen</trademark> Dom0 no FreeBSD, a maquina deve ser inicializada usando o boot legado (BIOS).</para>
      </note>

    </sect2>

    <sect2 xml:id="virtualization-host-xen-dom0-setup">
      <title>Configuração  do <trademark>Xen</trademark> Dom0 Domínio de Controle</title>

      <para>Os usuários do FreeBSD 11 devem instalar os pacotes <package>emulators/xen-kernel47</package> e <package>sysutils/xen-tools47</package> que são baseados no Xen versão 4.7. Sistemas rodando o FreeBSD-12.0 ou mais novo podem usar o Xen 4.11 fornecido por <package>emulators/xen-kernel411</package> e <package>sysutils/xen-tools411</package>, respectivamente.</para>

      <para>Os arquivos de configuração devem ser editados para preparar o host para a integração do Dom0 após a instalação dos pacotes do Xen. Uma entrada para <filename>/etc/sysctl.conf</filename> desabilita o limite de quantas páginas de memória podem ser conectadas. Caso contrário, as VMs do DomU com requisitos de memória mais altos não serão executadas.</para>

      <screen><prompt>#</prompt> <userinput>echo 'vm.max_wired=-1' &gt;&gt; /etc/sysctl.conf</userinput></screen>

      <para>Outra configuração relacionada à memória envolve a alteração do <filename>/etc/login.conf</filename>, configurando a opção <literal>memorylocked</literal> para <literal>unlimited</literal>. Caso contrário, a criação de domínios DomU poderá falhar com erros <errorname>Cannot allocate memory</errorname>. Depois de fazer a mudança no <filename>/etc/login.conf</filename>, execute o comando <command>cap_mkdb</command> para atualizar o banco de dados de recursos. Veja <xref linkend="security-resourcelimits"/> para detalhes.</para>

      <screen><prompt>#</prompt> <userinput>sed -i '' -e 's/memorylocked=64K/memorylocked=unlimited/' /etc/login.conf</userinput>
<prompt>#</prompt> <userinput>cap_mkdb /etc/login.conf</userinput></screen>

      <para>Adicione uma entrada para o console do <trademark>Xen</trademark> ao <filename>/etc/ttys</filename>:</para>

      <screen><prompt>#</prompt> <userinput>echo 'xc0     "/usr/libexec/getty Pc"         xterm   onifconsole  secure' &gt;&gt; /etc/ttys</userinput></screen>

      <para>A seleção de um kernel <trademark>Xen</trademark> no <filename>/boot/loader.conf</filename> ativa o Dom0. O <trademark>Xen</trademark> também requer recursos como CPU e memória da máquina host para ele mesmo e para outros domínios DomU. Quanto de CPU e memória depende dos requisitos individuais e das capacidades de hardware. Neste exemplo, 8 GB de memória e 4 CPUs virtuais são disponibilizados para o Dom0. O console serial também é ativado e as opções de log são definidas.</para>

      <para>O seguinte comando é usado para pacotes Xen 4.7:</para>

      <screen><prompt>#</prompt> <userinput>sysrc -f /boot/loader.conf hw.pci.mcfg=0</userinput>
<prompt>#</prompt> <userinput>sysrc -f /boot/loader.conf if_tap_load="YES"</userinput>
<prompt>#</prompt> <userinput>sysrc -f /boot/loader.conf xen_kernel="/boot/xen"</userinput>
<prompt>#</prompt> <userinput>sysrc -f /boot/loader.conf xen_cmdline="dom0_mem=<replaceable>8192M</replaceable> dom0_max_vcpus=<replaceable>4</replaceable> dom0pvh=1 console=com1,vga com1=115200,8n1 guest_loglvl=all loglvl=all"</userinput></screen>

      <para>Para as versões Xen 4.11 e superiores, o seguinte comando deve ser usado:</para>

      <screen><prompt>#</prompt> <userinput>sysrc -f /boot/loader.conf if_tap_load="YES"</userinput>
<prompt>#</prompt> <userinput>sysrc -f /boot/loader.conf xen_kernel="/boot/xen"</userinput>
<prompt>#</prompt> <userinput>sysrc -f /boot/loader.conf xen_cmdline="dom0_mem=<replaceable>8192M</replaceable> dom0_max_vcpus=<replaceable>4</replaceable> dom0=pvh console=com1,vga com1=115200,8n1 guest_loglvl=all loglvl=all"</userinput></screen>

	<tip>
	  <para>Os arquivos de log criados pelo <trademark>Xen</trademark> para as VMs do DomU são armazenados em <filename>/var/log/xen</filename>. Por favor, certifique-se de verificar o conteúdo do diretório em caso de problemas.</para>
	</tip>

	<para>Ative o serviço xencommons durante a inicialização do sistema:</para>

	<screen><prompt>#</prompt> <userinput>sysrc xencommons_enable=yes</userinput></screen>

	<para>Essas configurações são suficientes para iniciar um sistema habilitado para Dom0. No entanto, falta a funcionalidade de rede para as máquinas DomU. Para corrigir isso, defina uma interface em bridge com a NIC principal do sistema que as VMs DomU poderão usar para se conectar à rede. Substitua <replaceable>em0</replaceable> pelo nome da interface de rede do host.</para>

	<screen><prompt>#</prompt> <userinput>sysrc cloned_interfaces="bridge0"</userinput>
<prompt>#</prompt> <userinput>sysrc ifconfig_bridge0="addm <replaceable>em0</replaceable> SYNCDHCP"</userinput>
<prompt>#</prompt> <userinput>sysrc ifconfig_<replaceable>em0</replaceable>="up"</userinput></screen>

	<para>Reinicie o host para carregar o kernel <trademark>Xen</trademark> e inicie o Dom0.</para>

	<screen><prompt>#</prompt> <userinput>reboot</userinput></screen>

	<para>Após inicializar com sucesso o kernel <trademark>Xen</trademark> e efetuar login no sistema novamente, a ferramenta de gerenciamento do <trademark>Xen</trademark>,  <command>xl</command> é usada para mostrar informações sobre os domínios.</para>

	<screen><prompt>#</prompt> <userinput>xl list</userinput>
Name                                        ID   Mem VCPUs      State   Time(s)
Domain-0                                     0  8192     4     r-----     962.0</screen>

	<para>A saída confirma que o Dom0 (chamado <literal>Domain-0</literal>) tem o ID <literal>0</literal> e está em execução. Ele também possui a memória e as CPUs virtuais que foram definidas anteriormente no <filename>/boot/loader.conf</filename>. Mais informações podem ser encontradas na <link xlink:href="https://www.xenproject.org/help/documentation.html">Documentação do <trademark>Xen</trademark></link>. Agora as VMs convidadas do DomU podem ser criadas.</para>
      </sect2>

      <sect2 xml:id="virtualization-host-xen-domu-setup">
	<title>Configuração da VM Convidada <trademark>Xen</trademark> DomU</title>

	<para>Domínios desprivilegiados consistem em um arquivo de configuração e discos rígidos virtuais ou físicos. Os discos virtuais para armazenamento do DomU podem ser arquivos criados pelo <citerefentry><refentrytitle>truncate</refentrytitle><manvolnum>1</manvolnum></citerefentry> ou volumes ZFS, conforme descrito em <xref linkend="zfs-zfs-volume"/>. Neste exemplo, um volume de 20 GB é usado. Uma VM é criada com o volume ZFS, uma imagem ISO do FreeBSD, 1 GB de RAM e duas CPUs virtuais. O arquivo ISO de instalação é obtido com o <citerefentry><refentrytitle>fetch</refentrytitle><manvolnum>1</manvolnum></citerefentry> e salvo localmente em um arquivo chamado <filename>freebsd.iso</filename>.</para>

	<screen><prompt>#</prompt> <userinput>fetch <replaceable>ftp://ftp.freebsd.org/pub/FreeBSD/releases/ISO-IMAGES/<replaceable>12.0</replaceable>/FreeBSD-<replaceable>12.0</replaceable>-RELEASE-amd64-bootonly.iso</replaceable> -o <replaceable>freebsd.iso</replaceable></userinput></screen>

      <para>Um volume de 20 GB do ZFS chamado <filename>xendisk0</filename> é criado para servir como espaço em disco para a VM.</para>

      <screen><prompt>#</prompt> <userinput>zfs create -V20G -o volmode=dev zroot/xendisk0</userinput></screen>

      <para>A nova VM DomU convidada é definida em um arquivo. Algumas definições específicas, como nome, mapa de teclado e detalhes da conexão VNC, também são definidas. O seguinte <filename>freebsd.cfg</filename> contém uma configuração mínima de DomU para este exemplo:</para>

      <screen><prompt>#</prompt> <userinput>cat freebsd.cfg</userinput>
builder = "hvm" <co xml:id="co-xen-builder"/>
name = "freebsd" <co xml:id="co-xen-name"/>
memory = 1024 <co xml:id="co-xen-memory"/>
vcpus = 2 <co xml:id="co-xen-vcpus"/>
vif = [ 'mac=00:16:3E:74:34:32,bridge=bridge0' ] <co xml:id="co-xen-vif"/>
disk = [
'/dev/zvol/tank/xendisk0,raw,hda,rw', <co xml:id="co-xen-disk"/>
'/root/freebsd.iso,raw,hdc:cdrom,r' <co xml:id="co-xen-cdrom"/>
  ]
vnc = 1 <co xml:id="co-xen-vnc"/>
vnclisten = "0.0.0.0"
serial = "pty"
usbdevice = "tablet"</screen>

      <para>Estas linhas são explicadas com mais detalhes:</para>

      <calloutlist>
	<callout arearefs="co-xen-builder">
	  <para>Isso define que tipo de virtualização usar.  <literal>hvm</literal> refere-se à virtualização assistida por hardware ou à máquina virtual de hardware. Os sistemas operacionais convidados podem ser executados sem modificação em CPUs com extensões de virtualização, fornecendo quase o mesmo desempenho que a execução em hardware físico. <literal>generic</literal> é o valor padrão e cria um domínio PV.</para>
	</callout>

	<callout arearefs="co-xen-name">
	  <para>Nome desta máquina virtual para distingui-la de outras executadas no mesmo Dom0. Requerido.</para>
	</callout>

	<callout arearefs="co-xen-memory">
	  <para>Quantidade de RAM em megabytes para disponibilizar para a VM. Esse valor é subtraído da memória total disponível do hypervisor, não da memória do Dom0.</para>
	</callout>

	<callout arearefs="co-xen-vcpus">
	  <para>Número de CPUs virtuais disponíveis para a VM convidada. Para um melhor desempenho, não crie convidados com mais CPUs virtuais do que o número de CPUs físicas no host.</para>
	</callout>

	<callout arearefs="co-xen-vif">
	  <para>Adaptador de rede virtual. Esta é a bridge conectada à interface de rede do host. O parâmetro <literal>mac</literal> é o endereço MAC definido na interface de rede virtual. Este parâmetro é opcional, se nenhum MAC for fornecido, o <trademark>Xen</trademark> irá gerar um aleatório.</para>
	</callout>

	<callout arearefs="co-xen-disk">
	  <para>Caminho completo para o disco, arquivo ou volume ZFS do armazenamento em disco para essa VM. As opções e as várias definições de disco são separadas por vírgulas.</para>
	</callout>

	<callout arearefs="co-xen-cdrom">
	  <para>Define o meio de inicialização a partir do qual o sistema operacional inicial é instalado. Neste exemplo, é a imagem ISO baixada anteriormente. Consulte a documentação do <trademark>Xen</trademark> para outros tipos de dispositivos e outras opções para configurar.</para>
	</callout>

	<callout arearefs="co-xen-vnc">
	  <para>Opções que controlam a conectividade do VNC para o console serial do DomU. Em ordem, estes são: ativa suporte ao VNC, define o endereço IP no qual escutar, device node para o console serial e o método de entrada para posicionamento preciso do mouse e outros métodos de entrada. <literal>keymap</literal> define qual mapa de teclas usar, sendo  <literal>english</literal> por padrão.</para>
	</callout>
      </calloutlist>

      <para>Após o arquivo ter sido criado com todas as opções necessárias, o DomU é criado passando-o como um parâmetro para o comando <command>xl create</command>.</para>

      <screen><prompt>#</prompt> <userinput>xl create freebsd.cfg</userinput></screen>

      <note>
	<para>Cada vez que o Dom0 é reiniciado, o arquivo de configuração deve ser passado para <command>xl create</command> novamente para recriar o DomU. Por padrão, somente o Dom0 é criado após uma reinicialização, não as VMs individuais. As VMs podem continuar de onde pararam, pois armazenaram o sistema operacional no disco virtual. A configuração da máquina virtual pode mudar com o tempo (por exemplo, ao adicionar mais memória). Os arquivos de configuração da máquina virtual devem ter um backup e manter-se disponíveis para poder recriar a VM convidada quando necessário.</para>
      </note>

      <para>A saída de <command>xl list</command> confirma que o DomU foi criado.</para>

      <screen><prompt>#</prompt> <userinput>xl list</userinput>
Name                                        ID   Mem VCPUs      State   Time(s)
Domain-0                                     0  8192     4     r-----  1653.4
freebsd                                      1  1024     1     -b----   663.9</screen>

      <para>Para iniciar a instalação do sistema operacional base, inicie o cliente VNC, direcionando-o para o endereço de rede principal do host ou para o endereço IP definido na linha <literal>vnclisten</literal> do <filename>freebsd.cfg</filename>. Depois que o sistema operacional tiver sido instalado, desligue o DomU e desconecte o visualizador VNC. Edite o <filename>freebsd.cfg</filename>, removendo a linha com a definição <literal>cdrom</literal> ou comentando-a inserindo um caractere <literal>#</literal> no início da linha. Para carregar esta nova configuração, é necessário remover o DomU antigo com <command>xl destroy</command>, passando o nome ou o id como parâmetro. Depois, recrie-o usando o <filename>freebsd.cfg</filename> modificado.</para>

      <screen><prompt>#</prompt> <userinput>xl destroy freebsd</userinput>
<prompt>#</prompt> <userinput>xl create freebsd.cfg</userinput></screen>

      <para>A máquina pode então ser acessada novamente usando o visualizador VNC. Desta vez, ele será inicializado a partir do disco virtual em que o sistema operacional foi instalado e pode ser usado como uma máquina virtual.</para>
    </sect2>

    <sect2 xml:id="virtualization-host-xen-troubleshooting">
      <title>Solução de problemas</title>

      <para>Esta seção contém informações básicas para ajudar a solucionar problemas encontrados ao usar o FreeBSD como host ou convidado do <trademark>Xen</trademark>.</para>

      <sect3 xml:id="virtualization-host-xen-troubleshooting-host">
	<title>Solução de problemas de inicialização do host</title>

	<para>Observe que as dicas de solução de problemas a seguir são destinadas ao <trademark>Xen</trademark> 4.11 ou mais recente. Se você ainda estiver usando o <trademark>Xen</trademark> 4.7 e tendo problemas, considere migrar para uma versão mais recente do <trademark>Xen</trademark>.</para>

	<para>Para solucionar problemas de inicialização do host, você provavelmente precisará de um cabo serial ou de um cabo USB de depuração. Uma saída de boot verbosa do <trademark>Xen</trademark> pode ser obtida adicionando-se parametros à opção <literal>xen_cmdline</literal> encontrada no <filename>loader.conf</filename>. Alguns parametros de depuração relevantes são:</para>

	<itemizedlist>
	  <listitem>
	    <para><literal>iommu=debug</literal>: pode ser usado para imprimir informações de diagnóstico adicionais sobre o iommu.</para>
	  </listitem>
	  <listitem>
	    <para><literal>dom0=verbose</literal>: pode ser usado para imprimir informações de diagnóstico adicionais sobre o processo de compilação dom0.</para>
	  </listitem>
	  <listitem>
	    <para><literal>sync_console</literal>: flag para forçar a saída síncrona do console. Útil para depuração para evitar a perda de mensagens devido à limitação de taxa. Nunca use essa opção em ambientes de produção, pois ela pode permitir que convidados mal-intencionados realizem ataques DoS contra o <trademark>Xen</trademark> usando o console.</para>
	  </listitem>
	</itemizedlist>

	<para>O FreeBSD também deve ser inicializado no modo verbose para identificar quaisquer problemas. Para ativar a inicialização detalhada, execute este comando:</para>

	<screen><prompt>#</prompt> <userinput>sysrc -f /boot/loader.conf boot_verbose="YES"</userinput></screen>

	<para>Se nenhuma dessas opções ajudar a resolver o problema, envie o registro de inicialização serial para <email>freebsd-xen@FreeBSD.org</email> e <email> xen-devel@lists.xenproject.org</email> para uma análise mais aprofundada.</para>
      </sect3>

      <sect3 xml:id="virtualization-host-xen-troubleshooting-guest">
	<title>Solução de problemas na criação de VMs convidadas</title>

	<para>Problemas também podem surgir ao criar convidados, as informações a seguir tentam  fornecer alguma ajuda para aqueles que precisarem diagnosticar problemas de criação de convidados.</para>

	<para>A causa mais comum de falhas na criação de convidados é o comando <literal>xl</literal> cuspindo algum erro e saindo com um código de retorno diferente de 0. Se o erro fornecido não for suficiente para ajudar a identificar o problema, uma saída mais detalhada pode ser obtida do comando <literal>xl</literal> usando-se a opção <literal>v</literal> repetidamente.</para>

	<screen><prompt>#</prompt> <userinput>xl -vvv create freebsd.cfg</userinput>
Parsing config from freebsd.cfg
libxl: debug: libxl_create.c:1693:do_domain_create: Domain 0:ao 0x800d750a0: create: how=0x0 callback=0x0 poller=0x800d6f0f0
libxl: debug: libxl_device.c:397:libxl__device_disk_set_backend: Disk vdev=xvda spec.backend=unknown
libxl: debug: libxl_device.c:432:libxl__device_disk_set_backend: Disk vdev=xvda, using backend phy
libxl: debug: libxl_create.c:1018:initiate_domain_create: Domain 1:running bootloader
libxl: debug: libxl_bootloader.c:328:libxl__bootloader_run: Domain 1:not a PV/PVH domain, skipping bootloader
libxl: debug: libxl_event.c:689:libxl__ev_xswatch_deregister: watch w=0x800d96b98: deregister unregistered
domainbuilder: detail: xc_dom_allocate: cmdline="", features=""
domainbuilder: detail: xc_dom_kernel_file: filename="/usr/local/lib/xen/boot/hvmloader"
domainbuilder: detail: xc_dom_malloc_filemap    : 326 kB
libxl: debug: libxl_dom.c:988:libxl__load_hvm_firmware_module: Loading BIOS: /usr/local/share/seabios/bios.bin
...</screen>

	<para>Se a saída detalhada não ajudar a diagnosticar o problema, verifique também os logs do toolstack QEMU e do <trademark>Xen</trademark> em <filename>/var/log/xen</filename>. Observe que o nome do domínio é anexado ao nome do registro, portanto, se o domínio tiver o nome <literal>freebsd</literal>, você deverá encontrar um <filename>/var/log/xen/xl-freebsd.log</filename> e provavelmente um <filename>/var/log/xen/qemu-dm-freebsd.log </filename>. Ambos os arquivos de log podem conter informações úteis para a depuração. Se nada disso ajudar a resolver o problema, envie a descrição do problema que você está enfrentando e o máximo de informações possíveis para <email>freebsd-xen@FreeBSD.org</email> e <email>xen-devel@lists.xenproject.org</email> para obter ajuda.</para>
      </sect3>
    </sect2>
  </sect1>
</chapter>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<chapter version="5.0" xml:id="l10n">
  <info>
    <title>Localização - Uso e Configuração do <acronym>i18n</acronym>/<acronym>L10n</acronym></title>

    <authorgroup>
      <author><personname><firstname>Andrey</firstname><surname>Chernov</surname></personname><contrib>Contributed by </contrib></author>
    </authorgroup>
    <authorgroup>
      <author><personname><firstname>Michael C.</firstname><surname>Wu</surname></personname><contrib>Rewritten by </contrib></author>
      <!-- 30 Nv 2000 -->
    </authorgroup>
  </info>

  <sect1 xml:id="l10n-synopsis">
    <title>Sinopse</title>

    <para>O FreeBSD é um projeto distribuído com usuários e colaboradores localizados em todo o mundo. Como tal, o FreeBSD suporta a localização em muitos idiomas, permitindo aos usuários visualizar, inserir ou processar dados em idiomas diferentes do inglês. Pode-se escolher entre a maioria dos principais idiomas, incluindo, mas não se limitando a: Chinês, Alemão, Japonês, Coreano, Francês, Russo e Vietnamita.</para>

    <indexterm><primary>internationalization</primary> <see>localization</see></indexterm>
    <indexterm><primary>localization</primary></indexterm>

    <para>O termo internacionalização foi encurtado para <acronym>i18n</acronym>, que representa o número de letras entre a primeira e a última letra da <literal>internacionalização</literal>. <acronym>L10n</acronym> usa o mesmo esquema de nomes, mas a partir da <literal>localização</literal>. Os métodos, protocolos e aplicativos <acronym>i18n</acronym>/<acronym>L10n</acronym> permitem que os usuários usem os idiomas de sua escolha.</para>

    <para>Este capítulo discute os recursos de internacionalização e localização do FreeBSD. Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>Como os nomes de localidade são construídos.</para>
      </listitem>

      <listitem>
	<para>Como definir a localidade para um login shell.</para>
      </listitem>

      <listitem>
	<para>Como configurar o console para idiomas diferentes do inglês.</para>
      </listitem>

      <listitem>
	<para>Como configurar o <application>Xorg</application> para diferentes idiomas.</para>
      </listitem>

      <listitem>
	<para>Como encontrar aplicativos compatíveis com <acronym>i18n</acronym>.</para>
      </listitem>

      <listitem>
	<para>Onde encontrar mais informações para configurar idiomas específicos.</para>
      </listitem>
    </itemizedlist>

    <para>Antes de ler este capítulo, você deve:</para>

    <itemizedlist>
      <listitem><para>Saber como <link linkend="ports"> instalar aplicativos adicionais de terceiros </link>.</para></listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="using-localization">
    <title>Usando Localização</title>

    <indexterm><primary>locale</primary></indexterm>

    <para>As configurações de localização são baseadas em três componentes: o código do idioma, o código do país e a codificação. Nomes de localidade são construídos a partir dessas partes da seguinte maneira:</para>

    <programlisting><replaceable>LanguageCode</replaceable>_<replaceable>CountryCode</replaceable>.<replaceable>Encoding</replaceable></programlisting>

      <indexterm><primary>language codes</primary></indexterm>
      <indexterm><primary>country codes</primary></indexterm>

      <para>O <replaceable>LanguageCode</replaceable> e o <replaceable>CountryCode</replaceable> são usados para determinar o país e a variação de linguagem específica. A <xref linkend="locale-lang-country"/> apresenta alguns exemplos de <replaceable>LanguageCode</replaceable>_<replaceable>CountryCode</replaceable>:</para>

      <table xml:id="locale-lang-country" frame="none" pgwide="1">
	<title>Idiomas Comum e Códigos de País</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>LanguageCode_Country Code</entry>
	      <entry>Descrição</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry>en_US</entry>
	      <entry>Inglês, Estados Unidos</entry>
	    </row>

	    <row>
	      <entry>ru_RU</entry>
	      <entry>Russo, Rússia</entry>
	    </row>

	    <row>
	      <entry>zh_TW</entry>
	      <entry>Chinês Tradicional, Taiwan</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Uma lista completa de localidades disponíveis pode ser encontrada digitando:</para>

      <screen><prompt>%</prompt> <userinput>locale -a | more</userinput></screen>

      <para>Para determinar a configuração atual de localidade:</para>

      <screen><prompt>%</prompt> <userinput>locale</userinput></screen>

      <indexterm><primary>encodings</primary></indexterm>
      <indexterm><primary>ASCII</primary></indexterm>

      <para>Conjuntos de caracteres específicos de idioma, como ISO8859-1, ISO8859-15, KOI8-R e CP437, são descritos em <citerefentry><refentrytitle>multibyte</refentrytitle><manvolnum>3</manvolnum></citerefentry>. A lista ativa de conjuntos de caracteres pode ser encontrada no <link xlink:href="http://www.iana.org/assignments/character-sets">IANA Registry</link>.</para>

      <para>Alguns idiomas, como Chinês ou Japonês, não podem ser representados usando caracteres <acronym>ASCII</acronym> e requerem uma codificação de idioma estendida usando caracteres wide ou multibyte. Exemplos de codificações de wide ou multibyte incluem EUC e Big5. Aplicativos mais antigos podem confundir essas codificações com caracteres de controle, enquanto aplicativos mais novos geralmente reconhecem esses caracteres. Dependendo da implementação, os usuários podem ser obrigados a compilar um aplicativo com suporte a caracteres wide ou multibyte, ou configurá-lo corretamente.</para>

      <note>
	<para>O FreeBSD usa codificações de locale compatíveis com o Xorg.</para>
      </note>

      <para>O restante desta seção descreve os vários métodos para configurar a localidade em um sistema FreeBSD. A próxima seção discutirá as considerações para encontrar e compilar aplicativos com suporte a <acronym>i18n</acronym>.</para>

    <sect2 xml:id="setting-locale">
      <title>Definindo a Localidade para o Login Shell</title>

      <para>As configurações de localidade são configuradas no <filename>~/.login_conf</filename> do usuário ou no arquivo de inicialização do shell do usuário: <filename>~/.profile</filename>, <filename>~/.bashrc</filename>, or <filename>~/.cshrc</filename>.</para>

      <para>Duas variáveis de ambiente devem ser definidas:</para>

      <itemizedlist>
	<listitem>
	  <para><envar>LANG</envar>, que define o idioma <indexterm>
	    <primary>POSIX</primary></indexterm></para>
	</listitem>

	<listitem>
	  <indexterm><primary>MIME</primary></indexterm>

	  <para><envar>MM_CHARSET</envar>, que define o conjunto de caracteres <acronym>MIME</acronym> usado pelos aplicativos</para>
	</listitem>
      </itemizedlist>

      <para>Além da configuração do shell do usuário, essas variáveis também devem ser definidas para configurações específicas de aplicativos e configurações do <application>Xorg</application>.</para>

      <indexterm><primary>locale</primary></indexterm>
      <indexterm><primary>login class</primary></indexterm>

      <para>Dois métodos estão disponíveis para fazer as atribuições de variáveis necessárias: o método <link linkend="login-class">classes de login</link>, que é o método recomendado, e o método <link linkend="startup-file">arquivo de inicialização</link>. As próximas duas seções demonstram como usar os dois métodos.</para>

      <sect3 xml:id="login-class">
	<title>Método de Classes de Login</title>

	<para>Este primeiro método é o método recomendado, pois atribui as variáveis de ambiente necessárias para o nome da localidade e os conjuntos de caracteres <acronym>MIME</acronym> para todos os shell possíveis. Essa configuração pode ser executada para cada usuário ou pode ser configurada para todos os usuários pelo superusuário.</para>

	<para>Esse exemplo mínimo define as duas variáveis para a codificação Latin-1 no <filename>.login_conf</filename> do diretório inicial de um usuário individual:</para>

	<programlisting>me:\
	:charset=ISO-8859-1:\
	:lang=de_DE.ISO8859-1:</programlisting>

	<indexterm><primary>Traditional Chinese</primary> <secondary>BIG-5 encoding</secondary></indexterm>

	<para>Aqui está um exemplo de <filename>~/.login_conf</filename> de um usuário que define as variáveis para o Chinês Tradicional na codificação BIG-5. Mais variáveis são necessárias porque alguns aplicativos não respeitam corretamente variáveis de idioma para o Chinês, Japonês e Coreano:</para>

	<programlisting>#Users who do not wish to use monetary units or time formats
#of Taiwan can manually change each variable
me:\
	:lang=zh_TW.Big5:\
	:setenv=LC_ALL=zh_TW.Big5,LC_COLLATE=zh_TW.Big5,LC_CTYPE=zh_TW.Big5,LC_MESSAGES=zh_TW.Big5,LC_MONETARY=zh_TW.Big5,LC_NUMERIC=zh_TW.Big5,LC_TIME=zh_TW.Big5:\
	:charset=big5:\
	:xmodifiers="@im=gcin": #Set gcin as the XIM Input Server</programlisting>

	<para>Como alternativa, o superusuário pode configurar a localização para todos os usuários do sistema. As seguintes variáveis no <filename>/etc/login.conf</filename> são usadas para definir a localidade e o conjunto de caracteres <acronym>MIME</acronym>:</para>

	<programlisting><replaceable>language_name</replaceable>|<replaceable>Account Type Description</replaceable>:\
	:charset=<replaceable>MIME_charset</replaceable>:\
	:lang=<replaceable>locale_name</replaceable>:\
	:tc=default:</programlisting>

	<para>Então, o exemplo anterior do Latin-1 ficaria assim:</para>

	<programlisting>german|German Users Accounts:\
	:charset=ISO-8859-1:\
	:lang=de_DE.ISO8859-1:\
	:tc=default:</programlisting>

	<para>Veja o <citerefentry><refentrytitle>login.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry> para mais detalhes sobre estas variáveis. Observe que ele já contém a classe <replaceable>russian</replaceable> predefinida.</para>

	<para>Sempre que <filename>/etc/login.conf</filename> for editado, lembre-se de executar o seguinte comando para atualizar o banco de dados de recursos:</para>

	<screen><prompt>#</prompt> <userinput>cap_mkdb /etc/login.conf</userinput></screen>

	<note>
	  <para>Para um usuário final, o comando <command>cap_mkdb</command> vai precisar rodar no seu <filename>~/.login_conf</filename> para que qualquer mudança tenha efeito.</para>
	</note>

	<sect4>
	  <title>Utilitários que Alteram as Classes de Login</title>

	  <indexterm><primary><command>vipw</command></primary></indexterm>

	  <para>Além de editar manualmente o <filename>/etc/login.conf</filename>, vários utilitários estão disponíveis para definir a localidade de usuários recém-criados.</para>

	  <para>Ao usar o <command>vipw</command> para adicionar novos usuários, especifique o <replaceable>idioma</replaceable> para definir a localidade:</para>

	  <programlisting>user:password:1111:11:<replaceable>language</replaceable>:0:0:User Name:/home/user:/bin/sh</programlisting>

	  <indexterm><primary><command>adduser</command></primary></indexterm>
	  <indexterm><primary>login class</primary></indexterm>

	  <para>Ao usar o <command>adduser</command> para adicionar novos usuários, o idioma padrão pode ser pré-configurado para todos os novos usuários ou especificado para um usuário individual.</para>

	  <para>Se todos os novos usuários usarem o mesmo idioma, configure <literal>defaultclass=<replaceable>language</replaceable></literal> em <filename>/etc/adduser.conf</filename>.</para>

	  <para>Para substituir essa configuração ao criar um usuário, insira a localidade necessária neste prompt:</para>

	  <screen><prompt>Enter login class: default []:</prompt></screen>

	  <para>ou especifique a localidade ao executar o <command>adduser</command>:</para>

	  <screen><prompt>#</prompt> <userinput>adduser -class <replaceable>language</replaceable></userinput></screen>

	  <indexterm><primary><command>pw</command></primary></indexterm>

	  <para>Se o <command>pw</command> for usado para adicionar novos usuários, especifique a localidade da seguinte forma:</para>

	  <screen><prompt>#</prompt> <userinput>pw useradd <replaceable>user_name</replaceable> -L <replaceable>language</replaceable></userinput></screen>

	  <para>Para alterar a classe de login de um usuário existente, <command>chpass</command> pode ser usado. Execute-o como superusuário e forneça o nome do usuário para edição como argumento.</para>

	  <screen><prompt>#</prompt> <userinput>chpass <replaceable>user_name</replaceable></userinput></screen>
	  </sect4>
	</sect3>

	<sect3 xml:id="startup-file">
	  <title>Método de Arquivo de Inicialização do Shell</title>

	  <para>Esse segundo método não é recomendado, pois cada shell usado requer configuração manual, e cada shell tem um arquivo de configuração diferente e uma sintaxe diferente. Como exemplo, para definir o idioma Alemão para o shell <command>sh</command>, essas linhas podem ser adicionadas ao <filename>~/.profile</filename> para definir o shell apenas para esse usuário. Essas linhas também podem ser adicionadas ao <filename>/etc/profile</filename> ou <filename>/usr/share/skel/dot.profile</filename> para definir esse shell para todos os usuários:</para>

	  <programlisting><envar>LANG</envar>=de_DE.ISO8859-1; export <envar>LANG</envar>
<envar>MM_CHARSET</envar>=ISO-8859-1; export <envar>MM_CHARSET</envar></programlisting>

	  <para>No entanto, o nome do arquivo de configuração e a sintaxe usada são diferentes para o shell <command>csh</command>. Estas são as configurações equivalentes para o <filename>~/.csh.login</filename>, <filename>/etc/csh.login</filename>, ou <filename>/usr/share/skel/dot.login</filename>:</para>

	  <programlisting>setenv <envar>LANG</envar> de_DE.ISO8859-1
setenv <envar>MM_CHARSET</envar> ISO-8859-1</programlisting>

	  <para>Para complicar, a sintaxe necessária para configurar o <application>Xorg</application> no <filename>~/.xinitrc</filename> também depende do shell. O primeiro exemplo é para o shell <command>sh</command> e o segundo é para o shell <command>csh</command>:</para>

	  <programlisting><envar>LANG</envar>=de_DE.ISO8859-1; export <envar>LANG</envar></programlisting>

	  <programlisting>setenv <envar>LANG</envar> de_DE.ISO8859-1</programlisting>
      </sect3>
    </sect2>

    <sect2 xml:id="setting-console">
      <title>Configuração do Console</title>

      <para>Várias fontes de localização estão disponíveis para o console. Para ver uma lista de fontes disponíveis, digite <command>ls /usr/share/syscons/fonts</command>. Para configurar a fonte do console, especifique o <replaceable>font_name</replaceable>, sem o sufixo <filename>.fnt</filename>, em <filename>/etc/rc.conf</filename>:</para>

      <programlisting>font8x16=<replaceable>font_name</replaceable>
font8x14=<replaceable>font_name</replaceable>
font8x8=<replaceable>font_name</replaceable></programlisting>

      <indexterm><primary>keymap</primary></indexterm>
      <indexterm><primary>screenmap</primary></indexterm>
      <para>O keymap e o screenmap podem ser definidos adicionando o seguinte ao <filename>/etc/rc.conf</filename>:</para>

      <programlisting>scrnmap=<replaceable>screenmap_name</replaceable>
keymap=<replaceable>keymap_name</replaceable>
keychange="<replaceable>fkey_number sequence</replaceable>"</programlisting>

      <para>Para ver a lista de screenmaps disponíveis, digite <command>ls /usr/share/syscons/scrnmaps</command>. Não inclua o sufixo <filename>.scm</filename> ao especificar <replaceable>screenmap_name</replaceable>. Um screenmap com uma fonte mapeada correspondente geralmente é necessário como uma solução alternativa para expandir o bit 8 para o 9 na matriz de caracteres de fonte de um adaptador VGA para que as letras sejam movidas para fora da área de pseudo-grafia se a fonte da tela usar uma coluna de 8 bits.</para>

      <para>Para ver a lista de mapas de teclado disponíveis, digite <command>ls /usr/share/syscons/keymaps</command>. Ao especificar o <replaceable>keymap_name</replaceable>, não inclua o sufixo <filename>.kbd</filename>. Para testar os mapas de teclado sem reinicializar o sistema, use <citerefentry><refentrytitle>kbdmap</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</para>

      <para>A entrada <literal>keychange</literal> geralmente é necessária para programar as teclas de função para corresponder ao tipo de terminal selecionado, porque as sequências de teclas de função não podem ser definidas no mapa de teclas.</para>

      <para>Em seguida, defina o tipo de terminal do console correto em <filename>/etc/ttys</filename> para todas as entradas do terminal virtual. <xref linkend="locale-charset"/> resume os tipos de terminais disponíveis:</para>

      <table xml:id="locale-charset" frame="none" pgwide="1">
	<title>Tipos de Terminal Definidos para Conjuntos de Caracteres</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Conjunto de Caracteres</entry>
	      <entry>Tipo de Terminal</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry>ISO8859-1 ou ISO8859-15</entry>
	      <entry><literal>cons25l1</literal></entry>
	    </row>

	    <row>
	      <entry>ISO8859-2</entry>
	      <entry><literal>cons25l2</literal></entry>
	    </row>

	    <row>
	      <entry>ISO8859-7</entry>
	      <entry><literal>cons25l7</literal></entry>
	    </row>

	    <row>
	      <entry>KOI8-R</entry>
	      <entry><literal>cons25r</literal></entry>
	    </row>

	    <row>
	      <entry>KOI8-U</entry>
	      <entry><literal>cons25u</literal></entry>
	    </row>

	    <row>
	      <entry>CP437 (VGA padrão)</entry>
	      <entry><literal>cons25</literal></entry>
	    </row>

	    <row>
	      <entry>US-ASCII</entry>
	      <entry><literal>cons25w</literal></entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <indexterm><primary><application>moused</application></primary></indexterm>

      <para>Para idiomas com caracteres wide ou multibyte, instale um console para esse idioma a partir da Coleção de Ports do FreeBSD. Os ports disponíveis estão resumidos em <xref linkend="locale-console"/>. Uma vez instalado, consulte o <filename>pkg-message</filename> dos ports ou as páginas de manual para instruções de configuração e uso.</para>

      <table xml:id="locale-console" frame="none" pgwide="1">
	<title>Consoles Disponíveis pela Coleção de Ports</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Idioma</entry>
	      <entry>Localização do Port</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry>Chinês Tradicional (BIG-5)</entry>
	      <entry><package>chinese/big5con</package></entry>
	    </row>

	    <row>
	      <entry>Chinês/Japonês/Coreano</entry>
	      <entry><package>chinese/cce</package></entry>
	    </row>

	    <row>
	      <entry>Chinês/Japonês/Coreano</entry>
	      <entry><package>chinese/zhcon</package></entry>
	    </row>

	    <row>
	      <entry>Japonês</entry>
	      <entry><package>chinese/kon2</package></entry>
	    </row>

	    <row>
	      <entry>Japonês</entry>
	      <entry><package>japanese/kon2-14dot</package></entry>
	    </row>

	    <row>
	      <entry>Japonês</entry>
	      <entry><package>japanese/kon2-16dot</package></entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Se o <application>moused</application> estiver ativado no <filename>/etc/rc.conf</filename>, uma configuração adicional pode ser necessária. Por padrão, o cursor do mouse do driver <citerefentry><refentrytitle>syscons</refentrytitle><manvolnum>4</manvolnum></citerefentry> ocupa o intervalo <literal>0xd0</literal>-<literal>0xd3</literal> no conjunto de caracteres. Se o idioma usar esse intervalo, mova o intervalo do cursor adicionando a seguinte linha ao <filename>/etc/rc.conf</filename>:</para>

      <programlisting>mousechar_start=3</programlisting>
    </sect2>

    <sect2>
      <title>Configuração do Xorg</title>

      <para>O <xref linkend="x11"/> descreve como instalar e configurar o <application>Xorg</application>. Ao configurar localizações no <application>Xorg</application>, fontes adicionais e métodos de entrada estão disponíveis na Coleção de Ports do FreeBSD. Configurações específicas de <acronym>i18n</acronym> para aplicações como fontes e menus podem ser tunadas em <filename>~/.Xresources</filename> e devem permitir que os usuários visualizem o idioma selecionado nos menus das aplicações gráficas.</para>

      <indexterm><primary>X Input Method (XIM)</primary></indexterm>

      <para>O protocolo X Input Method (<acronym>XIM</acronym>) é um padrão <application>Xorg</application> para inserir caracteres não Ingleses. <xref linkend="locale-xim"/> resume os métodos de entrada de aplicações que estão disponíveis na Coleção de Ports do FreeBSD. Aplicativos adicionais Fcitx e Uim também estão disponíveis.</para>

      <table xml:id="locale-xim" frame="none" pgwide="1">
	<title>Métodos de Entrada Disponíveis</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Idioma</entry>
	      <entry>Método de Entrada</entry>
	    </row>
	  </thead>

	  <tbody>

	    <row>
	      <entry>Chinês</entry>
	      <entry><package>chinese/gcin</package></entry>
	    </row>

	    <row>
	      <entry>Chinês</entry>
	      <entry><package>chinese/ibus-chewing</package></entry>
	    </row>

	    <row>
	      <entry>Chinês</entry>
	      <entry><package>chinese/ibus-pinyin</package></entry>
	    </row>

	    <row>
	      <entry>Chinês</entry>
	      <entry><package>chinese/oxim</package></entry>
	    </row>

	    <row>
	      <entry>Chinês</entry>
	      <entry><package>chinese/scim-fcitx</package></entry>
	    </row>

	    <row>
	      <entry>Chinês</entry>
	      <entry><package>chinese/scim-pinyin</package></entry>
	    </row>

	    <row>
	      <entry>Chinês</entry>
	      <entry><package>chinese/scim-tables</package></entry>
	    </row>

	    <row>
	      <entry>Japonês</entry>
	      <entry><package>japanese/ibus-anthy</package></entry>
	    </row>

	    <row>
	      <entry>Japonês</entry>
	      <entry><package>japanese/ibus-mozc</package></entry>
	    </row>

	    <row>
	      <entry>Japonês</entry>
	      <entry><package>japanese/ibus-skk</package></entry>
	    </row>

	    <row>
	      <entry>Japonês</entry>
	      <entry><package>japanese/im-ja</package></entry>
	    </row>

	    <row>
	      <entry>Japonês</entry>
	      <entry><package>japanese/kinput2</package></entry>
	    </row>

	    <row>
	      <entry>Japonês</entry>
	      <entry><package>japanese/scim-anthy</package></entry>
	    </row>

	    <row>
	      <entry>Japonês</entry>
	      <entry><package>japanese/scim-canna</package></entry>
	    </row>

	    <row>
	      <entry>Japonês</entry>
	      <entry><package>japanese/scim-honoka</package></entry>
	    </row>

	    <row>
	      <entry>Japonês</entry>
	      <entry><package>japanese/scim-honoka-plugin-romkan</package></entry>
	    </row>

	    <row>
	      <entry>Japonês</entry>
	      <entry><package>japanese/scim-honoka-plugin-wnn</package></entry>
	    </row>

	    <row>
	      <entry>Japonês</entry>
	      <entry><package>japanese/scim-prime</package></entry>
	    </row>

	    <row>
	      <entry>Japonês</entry>
	      <entry><package>japanese/scim-skk</package></entry>
	    </row>

	    <row>
	      <entry>Japonês</entry>
	      <entry><package>japanese/scim-tables</package></entry>
	    </row>

	    <row>
	      <entry>Japonês</entry>
	      <entry><package>japanese/scim-tomoe</package></entry>
	    </row>

	    <row>
	      <entry>Japonês</entry>
	      <entry><package>japanese/scim-uim</package></entry>
	    </row>

	    <row>
	      <entry>Japonês</entry>
	      <entry><package>japanese/skkinput</package></entry>
	    </row>

	    <row>
	      <entry>Japonês</entry>
	      <entry><package>japanese/skkinput3</package></entry>
	    </row>

	    <row>
	      <entry>Japonês</entry>
	      <entry><package>japanese/uim-anthy</package></entry>
	    </row>

	    <row>
	      <entry>Coreano</entry>
	      <entry><package>korean/ibus-hangul</package></entry>
	    </row>

	    <row>
	      <entry>Coreano</entry>
	      <entry><package>korean/imhangul</package></entry>
	    </row>

	    <row>
	      <entry>Coreano</entry>
	      <entry><package>korean/nabi</package></entry>
	    </row>

	    <row>
	      <entry>Coreano</entry>
	      <entry><package>korean/scim-hangul</package></entry>
	    </row>

	    <row>
	      <entry>Coreano</entry>
	      <entry><package>korean/scim-tables</package></entry>
	    </row>

	    <row>
	      <entry>Vietnamita</entry>
	      <entry><package>vietnamese/xvnkb</package></entry>
	    </row>

	    <row>
	      <entry>Vietnamita</entry>
	      <entry><package>vietnamese/x-unikey</package></entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>
    </sect2>
<!--
Comment out for now. If needed, can be added as note in new Printing chapter.
    <sect2>
      <title>Printer Setup</title>

      <para>Some single C chars character sets are hardware coded
	into printers.  Wide or multibyte character sets require
	special setup using a utility such as
	<application>apsfilter</application>.  Documents can be
	converted to &postscript; or PDF formats using language
	specific converters.</para>
    </sect2>
Not sure where to put this section, perhaps as a note in the File system chapter?
    <sect2>
      <title>Kernel and File Systems</title>

      <para>The &os; fast filesystem (<acronym>FFS</acronym>) is 8-bit
	clean, so it can be used with any single C chars character
	set.  However, character set names are not stored in the
	filesystem as it is raw 8-bit and does not understand encoding
	order.  Officially, <acronym>FFS</acronym> does not support
	any form of wide or multibyte character sets.  However, some
	wide or multibyte character sets have independent patches for
	enabling support on <acronym>FFS</acronym>.  Refer to the
	respective languages' web sites for more information and the
	patch files.</para>

      <indexterm><primary>DOS</primary></indexterm>
      <indexterm><primary>Unicode</primary></indexterm>
      <para>&os;'s support for the &ms-dos; filesystem has the
	configurable ability to convert between &ms-dos;, Unicode
	character sets, and chosen &os; filesystem character sets.
	Refer to &man.mount.msdosfs.8; for details.</para>
    </sect2>
        -->
  </sect1>

  <sect1 xml:id="l10n-compiling">
    <title>Encontrando Aplicações <acronym>i18n</acronym></title>

    <para>Aplicações <acronym>i18n</acronym> são programadas usando kits <acronym>i18n</acronym> em bibliotecas. Isso permite que os desenvolvedores escrevam um arquivo simples e traduzam menus e textos exibidos para cada idioma.</para>

    <para>A <link xlink:href="@@URL_RELPREFIX@@/ports/index.html">Coleção de Ports do FreeBSD</link> contém muitos aplicativos com suporte embutido para caracteres wide ou multibyte para vários idiomas. Tais aplicativos incluem <literal>i18n</literal> em seus nomes para fácil identificação. No entanto, eles nem sempre suportam o idioma necessário.</para>

    <para>Alguns aplicativos podem ser compilados com o conjunto de caracteres específico. Isso geralmente é feito no <filename>Makefile</filename> do port ou passando um parâmetro para o <application>configure</application>. Consulte a documentação <acronym>i18n</acronym> no código fonte do respectivo port do FreeBSD para obter mais informações sobre como determinar o parâmetro do <application>configure</application> necessário ou o <filename>Makefile</filename> do port para determinar quais opções de compilação para usar ao compilar o port.</para>
  </sect1>

  <sect1 xml:id="lang-setup">
    <title>Configuração de Localização para Idiomas Específicos</title>

    <para>Esta seção fornece exemplos de configuração para definir a localização de um sistema FreeBSD para o idioma Russo. Em seguida, ele fornece alguns recursos adicionais para definir a localização com outros idiomas.</para>

    <sect2 xml:id="ru-localize">
      <info>
	<title>Idioma Russo (Codificação KOI8-R)</title>

	<authorgroup>
	  <author><personname><firstname>Andrey</firstname><surname>Chernov</surname></personname><contrib>Originally contributed by </contrib></author>
	</authorgroup>
      </info>

      <indexterm><primary>localization</primary> <secondary>Russian</secondary></indexterm>

      <para>Esta seção mostra as configurações específicas necessárias para definir a localização de um sistema FreeBSD para o idioma Russo. Consulte <link linkend="using-localization">Usando Localização</link> para obter uma descrição mais completa de cada tipo de configuração.</para>

      <para>Para definir esta localidade para o login shell, adicione as seguintes linhas ao <filename>~/.login_conf</filename> de cada usuário:</para>

      <programlisting>me:My Account:\
	:charset=KOI8-R:\
	:lang=ru_RU.KOI8-R:</programlisting>

      <para>Para configurar o console, adicione as seguintes linhas ao <filename>/etc/rc.conf</filename>:</para>

      <programlisting>keymap="ru.koi8-r"
scrnmap="koi8-r2cp866"
font8x16="cp866b-8x16"
font8x14="cp866-8x14"
font8x8="cp866-8x8"
mousechar_start=3</programlisting>

      <para>Para cada entrada <literal>ttyv</literal> em <filename>/etc/ttys</filename>, use <literal>cons25r</literal> como o tipo de terminal.</para>

      <indexterm><primary>printers</primary></indexterm>
      <para>Para configurar a impressão, é necessário um filtro de saída especial para converter de KOI8-R para CP866, pois a maioria das impressoras com caracteres Russos vem com a página de código de hardware CP866. O FreeBSD inclui um filtro padrão para este propósito, <filename>/usr/libexec/lpr/ru/koi2alt</filename>. Para usar este filtro, adicione esta entrada ao <filename>/etc/printcap</filename>:</para>

      <programlisting>lp|Russian local line printer:\
	:sh:of=/usr/libexec/lpr/ru/koi2alt:\
	:lp=/dev/lpt0:sd=/var/spool/output/lpd:lf=/var/log/lpd-errs:</programlisting>

      <para>Consulte <citerefentry><refentrytitle>printcap</refentrytitle><manvolnum>5</manvolnum></citerefentry> para obter uma explicação mais detalhada.</para>

      <para>Para configurar o suporte a nomes de arquivos Russos em sistemas de arquivos montados do <trademark class="registered">MS-DOS</trademark>, inclua <option>-L</option> e o nome da localidade ao adicionar uma entrada ao <filename>/etc/fstab</filename>:</para>

     <programlisting>/dev/ad0s2      /dos/c  msdos   rw,-Lru_RU.KOI8-R 0 0</programlisting>

      <para>Consulte <citerefentry><refentrytitle>mount_msdosfs</refentrytitle><manvolnum>8</manvolnum></citerefentry> para mais detalhes.</para>

      <para>Para configurar fontes Russas no <application>Xorg</application>, instale o pacote <package>x11-fonts/xorg-fonts-cyrillic</package>. Em seguida, verifique a seção <literal>"Files"</literal> em <filename>/etc/X11/xorg.conf</filename>. A seguinte linha deve ser adicionada <emphasis>antes</emphasis> de qualquer outra entrada <literal>FontPath</literal>:</para>

      <programlisting>FontPath   "/usr/local/lib/X11/fonts/cyrillic"</programlisting>

      <para>Fontes Cirílicos adicionais estão disponíveis na Coleção de Ports.</para>

      <para>Para ativar um teclado Russo, adicione o seguinte à seção <literal>"Keyboard"</literal> do <filename>/etc/xorg.conf</filename>:</para>

      <programlisting>Option "XkbLayout"   "us,ru"
Option "XkbOptions"  "grp:toggle"</programlisting>

      <para>Certifique-se de que <literal>XkbDisable</literal> esteja comentado nesse arquivo.</para>

      <para>Para <literal>grp:toggle</literal> use <keycap>Right Alt</keycap>, para <literal>grp:ctrl_shift_toggle</literal> use <keycombo action="simul"><keycap>Ctrl</keycap><keycap>Shift</keycap></keycombo>. Para <literal>grp:caps_toggle</literal> use <keycap>CapsLock</keycap>. A antiga função <keycap>CapsLock</keycap> ainda está disponível no modo LAT apenas usando <keycombo action="simul"><keycap>Shift</keycap><keycap>CapsLock</keycap></keycombo>. <literal>grp:caps_toggle</literal> não funciona no <application>Xorg</application> por alguma razão desconhecida.</para>

      <para>Se o teclado tiver as teclas <quote><trademark class="registered">Windows</trademark></quote> e algumas teclas não alfabéticas mapeadas incorretamente, adicione a seguinte linha ao <filename>/etc/xorg.conf</filename>:</para>

      <programlisting>Option "XkbVariant" ",winkeys"</programlisting>

      <note>
	<para>O teclado Russo XKB pode não funcionar com aplicativos não localizados. Aplicativos minimamente localizados devem chamar uma função <function>XtSetLanguageProc (NULL, NULL, NULL);</function> no início do programa.</para>
      </note>

      <para>Veja <uri xlink:href="http://koi8.pp.ru/xwin.html">http://koi8.pp.ru/xwin.html</uri> para mais instruções sobre como definir a localização em aplicações <application>Xorg</application>. Para mais informações gerais sobre a codificação KOI8-R, consulte <uri xlink:href="http://koi8.pp.ru/">http://koi8.pp.ru/</uri>.</para>
    </sect2>

    <sect2>
      <title>Recursos Específicos de Idioma Adicionais</title>

      <para>Esta seção lista alguns recursos adicionais para a configuração de outras localidades.</para>

      <indexterm><primary>localization</primary> <secondary>Traditional Chinese</secondary></indexterm>
      <indexterm><primary>localization</primary> <secondary>German</secondary></indexterm>
      <indexterm><primary>localization</primary> <secondary>Greek</secondary></indexterm>
      <indexterm><primary>localization</primary> <secondary>Japanese</secondary></indexterm>
      <indexterm><primary>localization</primary> <secondary>Korean</secondary></indexterm>

      <variablelist>
	<varlistentry>
	  <term>Chinês Tradicional para Taiwan</term>

	  <listitem>
	    <para>O projeto FreeBSD-Taiwan tem um HOWTO em Chinês para o FreeBSD em <uri xlink:href="http://netlab.cse.yzu.edu.tw/~statue/freebsd/zh-tut/">http://netlab.cse.yzu.edu.tw/~statue/freebsd/zh-tut/</uri>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>Localização do Idioma Grego</term>

	  <listitem>
	    <para>Um artigo completo sobre o suporte Grego no FreeBSD está disponível <link xlink:href="@@URL_RELPREFIX@@/doc/el_GR.ISO8859-7/articles/greek-language-support/index.html">aqui</link>, somente em Grego, como parte da documentação oficial do FreeBSD em Grego.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>Localização do Idioma Japonês e Coreano</term>

	  <listitem>
	    <para>Para Japonês, consulte <uri xlink:href="http://www.jp.FreeBSD.org/">http://www.jp.FreeBSD.org/</uri> e, para Coreano, consulte <uri xlink:href="http://www.kr.FreeBSD.org/">http://www.kr.FreeBSD.org/</uri>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>Documentação do FreeBSD em Outros Idiomas</term>

	  <listitem>
	    <para>Alguns colaboradores do FreeBSD traduziram partes da documentação do FreeBSD para outros idiomas. Elas estão disponíveis através de links no <link xlink:href="@@URL_RELPREFIX@@/index.html">site do FreeBSD</link> ou em <filename>/usr/share/doc</filename>.</para>
	  </listitem>
	</varlistentry>
      </variablelist>
    </sect2>
  </sect1>
</chapter>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<chapter version="5.0" xml:id="updating-upgrading">

  <info>
    <title>Atualização e Upgrade do FreeBSD</title>

    <authorgroup>
      <author><personname> <firstname>Jim</firstname> <surname>Mock</surname> </personname> <contrib>Reestruturado, reorganizado e partes atualizadas por </contrib></author>
      <!-- Mar 2000 -->
    </authorgroup>

    <authorgroup>
      <author><personname> <firstname> Jordan </firstname> <surname> Hubbard </surname> </personname> <contrib> Trabalho original de </contrib></author>

      <author><personname> <firstname>Poul-Henning</firstname> <surname>Kamp</surname> </personname></author>

      <author><personname> <firstname>John</firstname> <surname>Polstra</surname> </personname></author>

      <author><personname> <firstname>Nik</firstname> <surname>Clayton</surname> </personname></author>
    </authorgroup>
  </info>

  <sect1 xml:id="updating-upgrading-synopsis">
    <title>Sinopse</title>

    <para>O FreeBSD está em constante desenvolvimento entre os releases. Algumas pessoas preferem usar as versões lançadas oficialmente, enquanto outras preferem se manter em sincronia com os últimos desenvolvimentos. No entanto, até mesmo versões oficiais são atualizadas com patches de segurança e outras correções críticas. Independentemente da versão usada, o FreeBSD fornece todas as ferramentas necessárias para manter o sistema atualizado e permite atualizações fáceis entre as versões. Este capítulo descreve como acompanhar o sistema de desenvolvimento  e o uso das ferramentas básicas para manter um sistema FreeBSD atualizado.</para>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>Como manter um sistema FreeBSD atualizado com o <application>freebsd-update</application> ou com o <application>Subversion</application>.</para>
      </listitem>

      <listitem>
	<para>Como comparar o estado de um sistema instalado com uma cópia original.</para>
      </listitem>

      <listitem>
	<para>Como manter a documentação instalada atualizada com o <application>Subversion</application> ou com o port da documentação.</para>
      </listitem>

      <listitem>
	<para>A diferença entre os dois ramos de desenvolvimento: FreeBSD-STABLE e FreeBSD-CURRENT.</para>
      </listitem>

      <listitem>
	<para>Como recompilar e reinstalar todo o sistema básico.</para>
      </listitem>
    </itemizedlist>

    <para>Antes de ler este capítulo, você deve:</para>

    <itemizedlist>
      <listitem>
	<para>Configurar corretamente a conexão de rede (<xref linkend="advanced-networking"/>).</para>
      </listitem>

      <listitem>
	<para>Saber como instalar software adicional de terceiros (<xref linkend="ports"/>).</para>
      </listitem>
    </itemizedlist>

    <note>
      <para>Ao longo deste capítulo, o <command>svnlite</command> é usado para obter e atualizar o código fonte do FreeBSD. Opcionalmente, o port ou pacote <package>devel/subversion</package> pode ser usado.</para>
    </note>
  </sect1>

  <sect1 xml:id="updating-upgrading-freebsdupdate">
    <info>
      <title>Atualização do FreeBSD</title>

      <authorgroup>
	<author><personname><firstname>Tom</firstname> <surname>Rhodes</surname></personname><contrib>Escrito por</contrib></author>
      </authorgroup>

      <authorgroup>
	<author><personname> <firstname>Colin</firstname> <surname>Percival</surname> </personname> <contrib>Com base nas notas fornecidas por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>Updating and Upgrading</primary></indexterm>
    <indexterm><primary>freebsd-update</primary> <see>updating-upgrading</see></indexterm>

    <para>A aplicação de patches de segurança em tempo hábil e a atualização para uma versão mais recente de um sistema operacional são aspectos importantes da administração contínua do sistema. O FreeBSD inclui um utilitário chamado <command>freebsd-update</command> o qual pode ser usado para executar ambas as tarefas.</para>

    <para>Este utilitário suporta atualizações binárias de segurança e de erratas para o FreeBSD, sem a necessidade de compilar e instalar manualmente o patch ou um novo kernel. Atualizações binárias estão disponíveis para todas as arquiteturas e versões atualmente suportadas pela equipe de segurança. A lista de versões suportadas e suas datas estimadas de fim de vida estão listadas em <uri xlink:href="https://www.FreeBSD.org/security/">https://www.FreeBSD.org/security/</uri>.</para>

    <para>Este utilitário também suporta upgrades do sistema operacional para releases menores (ponto x), bem como atualizações para outro ramo de release. Antes de atualizar para uma nova versão, revise o seu anúncio de lançamento, pois ele contém informações importantes pertinentes ao release. Os anúncios de lançamento estão disponíveis em <uri xlink:href="https://www.FreeBSD.org/releases/">https://www.FreeBSD.org/releases/</uri>.</para>

    <note>
      <para>Se um <command>crontab</command> utilizando os recursos do <citerefentry><refentrytitle>freebsd-update</refentrytitle><manvolnum>8</manvolnum></citerefentry> existir, ele deve ser desativado antes de atualizar o sistema operacional .</para>
    </note>

    <para>Esta seção descreve o arquivo de configuração usado pelo <command>freebsd-update</command>, demonstra como aplicar um patch de segurança e como atualizar para um release menor ou principal do sistema operacional e discute algumas das considerações ao atualizar o sistema operacional .</para>

    <sect2 xml:id="freebsdupdate-config-file">
      <title>O Arquivo de Configuração</title>

      <para>O arquivo de configuração padrão do <command>freebsd-update</command> funciona como está. Alguns usuários podem querer ajustar a configuração padrão no <filename>/etc/freebsd-update.conf</filename>, permitindo um melhor controle do processo. Os comentários neste arquivo explicam as opções disponíveis, mas os seguintes podem exigir um pouco mais de explicação:</para>

      <programlisting># Componentes do sistema base que devem ser mantidos atualizados.
Components world kernel</programlisting>

      <para>Este parâmetro controla quais partes do FreeBSD serão mantidas atualizadas. O padrão é atualizar todo o sistema básico e o kernel. Componentes individuais podem ser especificados, como <literal>src/base</literal> ou <literal>src/sys</literal>. No entanto, a melhor opção é deixar isso no padrão, pois alterá-lo para incluir itens específicos requer que todos os itens necessários sejam listados. Com o tempo, isso pode ter consequências desastrosas, pois o código-fonte e os binários podem ficar fora de sincronia.</para>

      <programlisting># Caminhos que começam com qualquer coisa que corresponda a uma entrada em uma 
# declaração IgnorePaths será ignorada.
IgnorePaths /boot/kernel/linker.hints</programlisting>

      <para>Para deixar diretórios especificados, como <filename>/bin</filename> ou <filename>/sbin</filename>, intocados durante o processo de atualização, adicione seus caminhos a esta instrução. Esta opção pode ser usada para evitar que o <command>freebsd-update</command> substitua as modificações locais.</para>

      <programlisting># Caminhos que começam com qualquer coisa que corresponda a uma entrada em uma declaração  
# UpdateIfUnmodified só será atualizada se o conteúdo do arquivo não tiver sido
# modificado pelo usuário (a menos que as alterações sejam mescladas; veja abaixo).
UpdateIfUnmodified /etc/ /var/ /root/ /.cshrc /.profile</programlisting>

      <para>Esta opção atualizará apenas os arquivos de configuração não modificados nos diretórios especificados. Quaisquer alterações feitas pelo usuário impedirão a atualização automática desses arquivos. Existe outra opção, <literal>KeepModifiedMetadata</literal>, que instruirá o <command>freebsd-update</command> para salvar as alterações durante a mesclagem.</para>

      <programlisting># Ao fazer o upgrade para uma nova versão do FreeBSD, os arquivos que forem especificados no MergeChanges
# terão quaisquer alterações locais mescladas na versão da nova release.
MergeChanges /etc/ /var/named/etc/ /boot/device.hints</programlisting>

      <para>Lista de diretórios com arquivos de configuração que o <command>freebsd-update</command> deve tentar mesclar. O processo de mesclagem de arquivos é uma série de patches <citerefentry><refentrytitle>diff</refentrytitle><manvolnum>1</manvolnum></citerefentry> semelhantes a <citerefentry><refentrytitle>mergemaster</refentrytitle><manvolnum>8</manvolnum></citerefentry>, mas com menos opções. As mesclagens são aceitas, abrem um editor ou fazem com que o <command>freebsd-update</command> aborte. Em caso de dúvida, faça backup do <filename>/etc</filename> e apenas aceite as mesclagens. Veja <citerefentry><refentrytitle>mergemaster</refentrytitle><manvolnum>8</manvolnum></citerefentry> para maiores informações sobre o <command>mergemaster</command>.</para>

      <programlisting># Diretório no qual armazenar atualizações baixadas e arquivos 
# temporários usados pelo FreeBSD Update.
# WorkDir /var/db/freebsd-update</programlisting>

      <para>Este diretório é onde todos os patches e arquivos temporários são colocados. Nos casos em que o usuário estiver fazendo uma atualização de versão, esse local deverá ter pelo menos um gigabyte de espaço em disco disponível.</para>

      <programlisting># Ao atualizar entre releases, a lista de Componentes deve ser lida de forma estrita (StrictComponents yes)
# ou meramente como uma lista de componentes que *podem* ser instalados de quais atualizações do 
# FreeBSD devem ser instaladas e atualizadas (StrictComponents no)?
# StrictComponents no</programlisting>

      <para>Quando esta opção estiver definida como <literal>yes</literal>, o <command>freebsd-update</command> assumirá que a lista <literal>Componentes</literal> está completa e não tentará fazer alterações fora da lista. Efetivamente, o <command>freebsd-update</command> tentará atualizar todos os arquivos que pertencem à lista <literal>Componentes</literal>.</para>
    </sect2>

    <sect2 xml:id="freebsdupdate-security-patches">
      <title>Aplicando Patches de Segurança</title>

      <para>O processo de aplicação de patches de segurança do FreeBSD foi simplificado, permitindo que um administrador mantenha um sistema totalmente corrigido usando o <command>freebsd-update</command>. Maiores informações sobre os avisos de segurança do FreeBSD podem ser encontradas em <xref linkend="security-advisories"/>.</para>

      <para>Patches de segurança do FreeBSD podem ser baixados e instalados usando os seguintes comandos. O primeiro comando determinará se algum patch pendente está disponível e, em caso afirmativo, listará os arquivos que serão modificados se os patches forem aplicados. O segundo comando aplicará os patches.</para>

      <screen><prompt>#</prompt> <userinput>freebsd-update fetch</userinput>
<prompt>#</prompt> <userinput>freebsd-update install</userinput></screen>

      <para>Se a atualização aplicar alguma correção de kernel, o sistema precisará de uma reinicialização para inicializar no kernel corrigido. Se o patch for aplicado a qualquer binário em execução, os aplicativos afetados devem ser reiniciados para que a versão corrigida do binário seja usada.</para>

      <note>
	<para>Normalmente, o usuário precisa estar preparado para reiniciar o sistema. Para saber se uma reinicialização é necessária por uma atualização do kernel, execute os comandos <command>freebsd-version -k</command> e <command>uname -r</command> e se eles forem diferentes, é necessário reiniciar.</para>
      </note>

      <para>O sistema pode ser configurado para verificar automaticamente as atualizações uma vez por dia, adicionando esta entrada ao <filename>/etc/crontab</filename>:</para>

      <programlisting>@daily                                  root    freebsd-update cron</programlisting>

      <para>Se houver patches, eles serão automaticamente baixados, mas não serão aplicados. O usuário <systemitem class="username">root</systemitem> receberá um email para que os patches possam ser revisados e instalados manualmente com o <command>freebsd-update install</command>.</para>

      <para>Se algo der errado, o <command>freebsd-update</command> terá a capacidade de reverter o último conjunto de alterações com o seguinte comando:</para>

      <screen><prompt>#</prompt> <userinput>freebsd-update rollback</userinput>
Uninstalling updates... done.</screen>

      <para>Novamente, o sistema deve ser reiniciado se o kernel ou qualquer módulo do kernel for modificado e quaisquer binários afetados devem ser reiniciados.</para>

      <para>Apenas o kernel <filename>GENERIC</filename> pode ser atualizado automaticamente pelo <command>freebsd-update</command>. Se um kernel personalizado estiver instalado, ele terá que ser recompilado e reinstalado depois que o <command>freebsd-update</command> terminar de instalar as atualizações. No entanto, o <command>freebsd-update</command> detectará e atualizará o kernel <emphasis>GENERIC</emphasis> se <filename>/boot/GENERIC</filename> existir, mesmo que não seja o kernel atual em execução no sistema. Para verificar detalhes desta instalação utilize o comando  <citerefentry><refentrytitle>uname</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</para>

      <note>
	<para>Sempre mantenha uma cópia do kernel <filename>GENERIC</filename> em <filename>/boot/GENERIC</filename>. Será útil no diagnóstico de vários problemas e na execução de atualizações de versão. Consulte <xref linkend="freebsd-update-custom-kernel-9x"/> para obter instruções sobre como obter uma cópia do kernel <filename>GENERIC</filename>.</para>
      </note>

      <para>A menos que a configuração padrão em <filename>/etc/freebsd-update.conf</filename> tenha sido alterada, o <command>freebsd-update</command> instalará o código fonte atualizado do kernel juntamente com o restante das atualizações. O processo de recompilação e reinstalação de um novo kernel personalizado poderá ser executado da maneira usual.</para>

      <para>As atualizações distribuídas pelo <command>freebsd-update</command> nem sempre envolvem o kernel. Não é necessário recompilar um kernel personalizado se o código fonte do kernel não tiverem sido modificado pelo <command>freebsd-update install</command>. No entanto, o <command>freebsd-update</command> sempre atualizará o <filename>/usr/src/sys/conf/newvers.sh</filename>. O nível de patch atual, conforme indicado pelo número <literal>-p</literal> relatado pelo <command>uname -r</command>, é obtido desse arquivo. Recompilar um kernel personalizado, mesmo que nada mais tenha sido alterado, permite que o <command>uname</command> relate com precisão o nível de patch atual do sistema. Isso é particularmente útil ao manter vários sistemas, pois permite uma avaliação rápida das atualizações instaladas em cada um deles.</para>
    </sect2>

    <sect2 xml:id="freebsdupdate-upgrade">
      <title>Realizando Upgrades de Versão Principais e Menores</title>

      <para>Atualizações de uma versão menor do FreeBSD para outra, como do FreeBSD 9.0 para o FreeBSD 9.1, são chamadas de upgrades de <firstterm>versão menor</firstterm>. Atualizações de <firstterm>versões principais</firstterm> ocorrem quando o FreeBSD é atualizado de uma versão principal para outra, como do FreeBSD 9.X para o FreeBSD 10.X. Ambos os tipos de atualizações podem ser executados fornecendo um target de versão de release para o <command> freebsd-update </command>.</para>

      <note>
	<para>Se o sistema estiver executando um kernel personalizado, certifique-se de que uma cópia do kernel <filename>GENERIC</filename> exista em <filename>/boot/GENERIC</filename> antes de iniciar o upgrade. Consulte <xref linkend="freebsd-update-custom-kernel-9x"/> para obter instruções sobre como obter uma cópia do kernel <filename>GENERIC</filename>.</para>
      </note>

      <para>O seguinte comando, quando executado em um sistema FreeBSD 9.0, irá atualizá-lo para o FreeBSD 9.1:</para>

       <screen><prompt>#</prompt> <userinput>freebsd-update -r 9.1-RELEASE upgrade</userinput></screen>

      <para>Depois que o comando for recebido, o <command>freebsd-update</command> avaliará o arquivo de configuração e o sistema atual na tentativa de reunir as informações necessárias para executar a atualização. Uma listagem de tela exibirá quais componentes foram e quais não foram detectados. Por exemplo:</para>

      <screen>Looking up update.FreeBSD.org mirrors... 1 mirrors found.
Fetching metadata signature for 9.0-RELEASE from update1.FreeBSD.org... done.
Fetching metadata index... done.
Inspecting system... done.

The following components of FreeBSD seem to be installed:
kernel/smp src/base src/bin src/contrib src/crypto src/etc src/games
src/gnu src/include src/krb5 src/lib src/libexec src/release src/rescue
src/sbin src/secure src/share src/sys src/tools src/ubin src/usbin
world/base world/info world/lib32 world/manpages

The following components of FreeBSD do not seem to be installed:
kernel/generic world/catpages world/dict world/doc world/games
world/proflibs

Does this look reasonable (y/n)? <userinput>y</userinput></screen>

      <para>Neste ponto, o <command>freebsd-update</command> tentará baixar todos os arquivos necessários para a atualização. Em alguns casos, o usuário pode ser questionado sobre o que instalar ou como proceder.</para>

      <para>Ao usar um kernel personalizado, a etapa acima produzirá um aviso semelhante ao seguinte:</para>

      <screen>WARNING: This system is running a "<replaceable>MYKERNEL</replaceable>" kernel, which is not a
kernel configuration distributed as part of FreeBSD 9.0-RELEASE.
This kernel will not be updated: you MUST update the kernel manually
before running "/usr/sbin/freebsd-update install"</screen>

      <para>Este aviso pode ser ignorado com segurança neste momento. O kernel <filename>GENERIC</filename> atualizado será usado como uma etapa intermediária no processo de atualização.</para>

      <para>Depois que todos os patches tiverem sido baixados para o sistema local, eles serão aplicados. Esse processo pode demorar um pouco, dependendo da velocidade e da carga de trabalho da máquina. Os arquivos de configuração serão então mesclados. O processo de mesclagem requer alguma intervenção do usuário, pois um arquivo pode ser mesclado ou um editor pode aparecer na tela para uma mesclagem manual. Os resultados de cada mesclagem bem-sucedida serão mostrados para o usuário enquanto o processo continua. Um merge falho ou ignorado fará com que o processo seja abortado. Os usuários podem desejar fazer um backup de <filename>/etc</filename> e mesclar manualmente os arquivos importantes, como o <filename>master.passwd</filename> ou o <filename>group</filename> posteriormente.</para>

      <note>
	<para>O sistema não está sendo alterado, já que todos os patches e merges estão acontecendo em outro diretório. Uma vez que todas as correções tenham sido aplicadas com sucesso, e todos os arquivos de configuração foram mesclados e tudo indicar que o processo ocorrerá sem problemas, as alterações poderão ser confirmadas pelo usuário usando o seguinte comando:</para>

	<screen><prompt>#</prompt> <userinput>freebsd-update install</userinput></screen>
      </note>

      <para>O kernel e os módulos do kernel serão atualizados primeiro. Se o sistema estiver sendo executado com um kernel personalizado, use o <citerefentry><refentrytitle>nextboot</refentrytitle><manvolnum>8</manvolnum></citerefentry> para definir que o kernel para a próxima inicialização será o <filename>/boot/GENERIC</filename>:</para>

      <screen><prompt>#</prompt> <userinput>nextboot -k GENERIC</userinput></screen>

      <warning>
	<para>Antes de reinicializar com o kernel <filename>GENERIC</filename>, verifique se ele contém todos os drivers necessários para o sistema inicializar corretamente e se conectar à rede, se a máquina que está sendo atualizada for acessada remotamente. Em particular, se o kernel customizado em execução contiver funcionalidades internas normalmente fornecidas pelos módulos do kernel, certifique-se de carregar temporariamente estes módulos no kernel <filename>GENERIC</filename> usando o <filename>/boot/loader.conf</filename>. Recomenda-se desabilitar os serviços não essenciais, bem como todas as montagens de disco e de rede, até que o processo de atualização seja concluído.</para>
      </warning>

      <para>A máquina agora deve ser reiniciada com o kernel atualizado:</para>

      <screen><prompt>#</prompt> <userinput>shutdown -r now</userinput></screen>

      <para>Quando o sistema estiver on-line, reinicie o <command>freebsd-update</command> usando o comando a seguir. Como o estado do processo foi salvo, o <command>freebsd-update</command> não será iniciado desde o início, mas passará para a próxima fase e removerá todas as bibliotecas compartilhadas e os arquivos de objetos antigos.</para>

      <screen><prompt>#</prompt> <userinput>freebsd-update install</userinput></screen>

      <note>
	<para>Dependendo se os números de versão de uma biblioteca foram incrementados ou não, pode haver apenas duas fases de instalação em vez de três.</para>
      </note>

      <para>A atualização está completa agora. Se esta for uma atualização de versão principal, reinstale todas os ports e pacotes conforme descrito em <xref linkend="freebsdupdate-portsrebuild"/>.</para>

      <sect3 xml:id="freebsd-update-custom-kernel-9x">
	<title>Kernels personalizados com o FreeBSD 9.X e posteriores</title>

	<para>Antes de usar o <command>freebsd-update</command>, assegure-se de que uma cópia do kernel <filename>GENERIC</filename> exista em <filename>/boot/GENERIC</filename>. Se um kernel personalizado foi compilado apenas uma vez, o kernel em <filename>/boot/kernel.old</filename> é o kernel <literal>GENERIC</literal>. Simplesmente renomeie este diretório para <filename>/boot/GENERIC</filename>.</para>

	<para>Se um kernel personalizado foi compilado mais de uma vez ou se é desconhecido quantas vezes o kernel personalizado foi compilado, obtenha uma cópia do kernel <literal>GENERIC</literal> que corresponda à versão atual do sistema operacional. Se o acesso físico ao sistema estiver disponível, uma cópia do kernel <literal>GENERIC</literal> pode ser instalada a partir da mídia de instalação:</para>

	<screen><prompt>#</prompt> <userinput>mount /cdrom</userinput>
<prompt>#</prompt> <userinput>cd /cdrom/usr/freebsd-dist</userinput>
<prompt>#</prompt> <userinput>tar -C/ -xvf kernel.txz boot/kernel/kernel</userinput></screen>

	<para>Como alternativa, o kernel <literal>GENERIC</literal> pode ser recriado e instalado a partir da do código fonte:</para>

	<screen><prompt>#</prompt> <userinput>cd /usr/src</userinput>
<prompt>#</prompt> <userinput>make kernel __MAKE_CONF=/dev/null SRCCONF=/dev/null</userinput></screen>

	<para>Para que este kernel seja identificado como o kernel <literal>GENERIC</literal> pelo <command>freebsd-update</command>, o arquivo de configuração <filename>GENERIC</filename> não deve ter sido modificado de forma alguma. Também é sugerido que o kernel seja compilado sem outras opções especiais.</para>

	<para>A reinicialização no kernel <filename>GENERIC</filename> não é necessária, pois o <command>freebsd-update</command> só precisa que o <filename>/boot/GENERIC</filename> exista.</para>
      </sect3>

      <sect3 xml:id="freebsdupdate-portsrebuild">
	<title>Atualizando pacotes após atualizar para uma versão principal (Major Release)</title>

	<para>Geralmente, os aplicativos instalados continuarão funcionando sem problemas após atualizações de versões menores. As versões principais usam diferentes interfaces binárias de aplicativos (<acronym>ABI</acronym>s), que quebram a maioria dos aplicativos de terceiros. Após uma atualização de versão principal, todos os pacotes e ports instalados precisam ser atualizados. Pacotes podem ser atualizados usando <command>pkg upgrade</command>. Para atualizar os ports instalados, use um utilitário como o <package>ports-mgmt/portmaster</package>.</para>

	<para>Uma atualização forçada de todos os pacotes instalados substituirá os pacotes por novas versões a partir do repositório, mesmo que o número da versão não tenha aumentado. Isso é necessário por causa da alteração da versão do ABI que ocorre ao atualizar entre versões principais do FreeBSD. A atualização forçada pode ser realizada executando:</para>

	<screen><prompt>#</prompt> <userinput>pkg-static upgrade -f</userinput></screen>

	<para>Uma recompilação de todos os aplicativos instalados pode ser realizada com este comando:</para>

	<screen><prompt>#</prompt> <userinput>portmaster -af</userinput></screen>

	<para>Este comando exibirá as telas de configuração de cada aplicativo que possui opções configuráveis e aguardará que o usuário interaja com estas telas. Para evitar esse comportamento e usar apenas as opções padrões, inclua <option>-G</option> no comando acima.</para>

	<para>Quando as atualizações de software estiverem concluídas, conclua o processo de atualização com uma chamada final para o <command>freebsd-update</command> para amarrar todas as pontas soltas no processo de atualização:</para>

	<screen><prompt>#</prompt> <userinput>freebsd-update install</userinput></screen>

	<para>Se o kernel <filename>GENERIC</filename> foi usado temporariamente, este é o momento de construir e instalar um novo kernel personalizado usando as instruções do <xref linkend="kernelconfig"/>.</para>

	<para>Reinicialize a máquina na nova versão do FreeBSD. O processo de atualização está concluído agora.</para>
      </sect3>
    </sect2>

    <sect2 xml:id="freebsdupdate-system-comparison">
      <title>Comparação do estado do sistema</title>

      <para>O estado da versão instalada do FreeBSD em relação a uma boa cópia conhecida pode ser testado usando o <command>freebsd-update IDS</command>. Este comando avalia a versão atual dos utilitários do sistema, bibliotecas e arquivos de configuração e pode ser usado como um Sistema de Detecção de Intrusão embutido (<acronym>IDS</acronym>).</para>

      <warning>
	<para>Este comando não é um substituto para um <acronym>IDS</acronym> real como o <package>security/snort</package>. Como o <command>freebsd-update</command> armazena dados no disco, a possibilidade de adulteração é evidente. Embora esta possibilidade possa ser reduzida usando o <varname>kern.securelevel</varname> e armazenando os dados do <command>freebsd-update</command> em um sistema de arquivos read-only quando não estiver em uso, uma solução melhor seria comparar o sistema com um disco seguro, como um <acronym>DVD</acronym> ou dispositivo de disco externo <acronym>USB</acronym> armazenado em segurança. Um método alternativo para fornecer a funcionalidade de <acronym>IDS</acronym> usando um utilitário interno é descrito em <xref linkend="security-ids"/></para>
      </warning>

      <para>Para começar a comparação, especifique um arquivo de saída para salvar os resultados:</para>

      <screen><prompt>#</prompt> <userinput>freebsd-update IDS &gt;&gt; outfile.ids</userinput></screen>

      <para>O sistema agora será inspecionado e uma longa lista de arquivos, junto com os valores de hash <acronym>SHA256</acronym> tanto para o valor conhecido na release e como na instalação atual, será enviada para o arquivo de saída especificado.</para>

      <para>As entradas na listagem são extremamente longas, mas o formato de saída pode ser facilmente analisado. Por exemplo, para obter uma lista de todos os arquivos que diferem daqueles na release, execute o seguinte comando:</para>

      <screen><prompt>#</prompt> <userinput>cat outfile.ids | awk '{ print $1 }' | more</userinput>
/etc/master.passwd
/etc/motd
/etc/passwd
/etc/pf.conf</screen>

      <para>Este exemplo de saída foi truncado, pois existem muito mais arquivos. Alguns arquivos possuem modificações naturais. Por exemplo, o <filename>/etc/passwd</filename> será modificado se usuários tiverem sido adicionados ao sistema. Módulos de kernel podem diferir pois o <command>freebsd-update</command> pode tê-los atualizado. Para excluir arquivos ou diretórios específicos, adicione-os à opção <literal>IDSIgnorePaths</literal> em <filename>/etc/freebsd-update.conf</filename>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="updating-upgrading-documentation">
    <title>Atualizando o Conjunto de Documentação</title>

    <indexterm><primary>Updating and Upgrading</primary></indexterm>

    <indexterm><primary>Documentation</primary> <see>Updating and Upgrading</see></indexterm>

    <para>A documentação é parte integrante do sistema operacional FreeBSD. Enquanto uma versão atualizada da documentação do FreeBSD está sempre disponível no site do FreeBSD (<link xlink:href="@@URL_RELPREFIX@@/doc/">https://www.freebsd.org/doc/</link>), pode ser útil ter uma cópia local atualizada do site do FreeBSD, manuais, <acronym>FAQ</acronym> e artigos.</para>

    <para>Esta seção descreve como usar os fontes ou a Coleção de Ports do FreeBSD para manter uma cópia local da documentação do FreeBSD atualizada.</para>

    <para>Para obter informações sobre como editar e enviar correções para a documentação, consulte o Primer do Projeto de Documentação do FreeBSD para Novos Colaboradores (<link xlink:href="@@URL_RELPREFIX@@/doc/en_US.ISO8859-1/books/fdp-primer">https://www.freebsd.org/doc/en_US.ISO8859-1/books/fdp-primer/</link>).</para>

    <sect2 xml:id="updating-installed-documentation">
      <title>Atualizando a documentação a partir do código-fonte</title>

      <para>Recompilar a documentação do FreeBSD a partir do código-fonte requer uma coleção de ferramentas que não fazem parte do sistema básico do FreeBSD. As ferramentas necessárias podem ser instaladas a partir do pacote <package>textproc/docproj</package> ou do port desenvolvido pelo Projeto de Documentação do FreeBSD.</para>

      <para>Uma vez instalado, use o <application>svnlite</application> para buscar uma cópia limpa dos fontes da documentação:</para>

      <screen><prompt>#</prompt> <userinput>svnlite checkout https://svn.FreeBSD.org/doc/head /usr/doc</userinput></screen>

      <para>O download inicial dos fontes da documentação pode demorar um pouco. Deixe executar até completar.</para>

      <para>Futuras atualizações dos fontes da documentação podem ser obtidas executando:</para>

      <screen><prompt>#</prompt> <userinput>svnlite update /usr/doc</userinput></screen>

      <para>Depois que um snapshot atualizado dos fontes da documentação for obtido e disponibilizado em <filename>/usr/doc</filename>, tudo estará pronto para uma atualização da documentação instalada.</para>

      <para>Uma atualização completa de todos os idiomas disponíveis pode ser realizada digitando:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/doc</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>

      <para>Se uma atualização de apenas um idioma específico for desejada, o <command>make</command> pode ser executado em um subdiretório específico de idioma do <filename>/usr/doc</filename>:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/doc/en_US.ISO8859-1</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>

      <para>Uma maneira alternativa de atualizar a documentação é executar este comando a partir do <filename>/usr/doc</filename> ou do subdiretório específico do idioma desejado:</para>

      <screen><prompt>#</prompt> <userinput>make update</userinput></screen>

      <para>Os formatos de saída que serão instalados podem ser especificados definindo o parâmetro <varname>FORMATS</varname>:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/doc</userinput>
<prompt>#</prompt> <userinput>make FORMATS='html html-split' install clean</userinput></screen>

      <para>Várias opções estão disponíveis para facilitar o processo de atualização de apenas partes da documentação ou a construção de traduções específicas. Estas opções podem ser configuradas como opções de todo o sistema no <filename>/etc/make.conf</filename>, ou como opções de linha de comando passadas para o <command>make</command>.</para>

      <para>As opções incluem:</para>

      <variablelist>
	<varlistentry>
	  <term><varname>DOC_LANG</varname></term>

	  <listitem>
	    <para>A lista de idiomas e codificações para compilar e instalar, como <literal>en_US.ISO8859-1</literal> para documentação em inglês.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><varname>FORMATS</varname></term>

	  <listitem>
	    <para>Um formato único ou uma lista de formatos de saída a serem criados. Atualmente os formatos suportados são, <literal>html</literal>, <literal>html-split</literal>, <literal>txt</literal>, <literal>ps</literal>, e <literal>pdf</literal>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><varname>DOCDIR</varname></term>

	  <listitem>
	    <para>Onde instalar a documentação. O padrão é <filename>/usr/share/doc</filename>.</para>
	  </listitem>
	</varlistentry>
      </variablelist>

      <para>Para mais variáveis do <command>make</command> suportadas como opções system-wide no FreeBSD, consulte <citerefentry><refentrytitle>make.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>
    </sect2>

    <sect2 xml:id="doc-ports-install-package">
      <info>
	<title>Atualizando a documentação a partir do ports</title>

	<authorgroup>
	  <author><personname> <firstname>Marc</firstname> <surname>Fonvieille</surname> </personname> <contrib> Baseado no trabalho de </contrib></author>
	</authorgroup>
      </info>

      <indexterm><primary>Updating and Upgrading</primary></indexterm>

      <indexterm><primary>documentation package</primary> <see>Updating and Upgrading</see></indexterm>

      <para>A seção anterior apresentou um método para atualizar a documentação do FreeBSD a partir do código fonte. Esta seção descreve um método alternativo que usa a Coleção de Ports e possibilita:</para>

      <itemizedlist>
	<listitem>
	  <para>Instalar pacotes pré-compilados da documentação, sem precisar compilar nada localmente ou instalar o conjunto de ferramentas de documentação.</para>
	</listitem>

	<listitem>
	  <para>Compilar o código fonte da documentação por meio do framework de ports, facilitando o check-out e as etapas de compilação.</para>
	</listitem>
      </itemizedlist>

      <para>Este método de atualização da documentação do FreeBSD é suportado por um conjunto de ports e pacotes de documentação que são atualizados mensalmente pela Equipe de Engenharia da Documentação <email>doceng@FreeBSD.org</email>. Eles estão listados na Coleção de Ports do FreeBSD, na categoria docs (<link xlink:href="http://www.freshports.org/docs/">http://www.freshports.org/docs/</link>).</para>

      <para>A organização dos ports de documentação é a seguinte:</para>

      <itemizedlist>
	<listitem>
	  <para>O pacote ou port <package>misc/freebsd-doc-en</package> instala toda a documentação em inglês.</para>
	</listitem>

	<listitem>
	  <para>O meta-pacote ou port do pacote <package>misc/freebsd-doc-all</package> instala toda a documentação em todos os idiomas disponíveis.</para>
	</listitem>

	<listitem>
	  <para>Existe um pacote e um port para cada tradução, como <package>misc/freebsd-doc-hu</package> para a documentação húngara.</para>
	</listitem>
      </itemizedlist>

      <para>Quando pacotes binários são usados, a documentação do FreeBSD será instalada em todos os formatos disponíveis para o idioma especificado. Por exemplo, o comando a seguir instalará o pacote mais recente da documentação em húngaro:</para>

      <screen><prompt>#</prompt> <userinput>pkg install hu-freebsd-doc</userinput></screen>

      <note>
	<para>Os pacotes usam um formato que difere do nome do port correspondente: <literal><replaceable>lang</replaceable>-freebsd-doc</literal>, onde <replaceable>lang</replaceable> é o formato abreviado do código de idioma, como <literal>hu</literal> para húngaro, ou <literal>zh_cn</literal> para chinês simplificado.</para>
      </note>

      <para>Para especificar o formato da documentação, compile o port em vez de instalar o pacote. Por exemplo, para compilar e instalar a documentação em inglês:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/misc/freebsd-doc-en</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>

      <para>O port fornece um menu de configuração no qual o formato para compilar e instalar pode ser especificado. Por padrão, o <acronym> HTML</acronym> dividido, semelhante ao formato usado em <uri xlink:href="http://www.FreeBSD.org">http://www.FreeBSD.org</uri> e o <acronym>PDF</acronym> estão selecionados.</para>

      <para>Alternativamente, várias opções <command>make</command> podem ser especificadas ao compilar um port de documentação, incluindo:</para>

      <variablelist>
	<varlistentry>
	  <term><varname>WITH_HTML</varname></term>

	  <listitem>
	    <para>Cria o formato HTML com um único arquivo HTML por documento. A documentação formatada é salva em um arquivo chamado <filename>article.html</filename> ou <filename>book.html</filename>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><varname>WITH_PDF</varname></term>

	  <listitem>
	    <para>A documentação formatada é salva em um arquivo chamado <filename>article.pd </filename> ou <filename>book.pdf</filename>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><varname>DOCBASE</varname></term>

	  <listitem>
	    <para>Especifica onde instalar a documentação. O padrão é <filename>/usr/local/share/doc/freebsd</filename>.</para>
	  </listitem>
	</varlistentry>
      </variablelist>

      <para>Este exemplo usa variáveis para instalar a documentação húngara como um arquivo <acronym>PDF</acronym> no diretório especificado:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/misc/freebsd-doc-hu</userinput>
<prompt>#</prompt> <userinput>make -DWITH_PDF DOCBASE=share/doc/freebsd/hu install clean</userinput></screen>

      <para>Pacotes ou ports de documentação podem ser atualizados usando as instruções em <xref linkend="ports"/>. Por exemplo, o seguinte comando atualiza a documentação húngara instalada usando <package>ports-mgmt/portmaster</package> através do uso apenas de pacotes:</para>

      <screen><prompt>#</prompt> <userinput>portmaster -PP hu-freebsd-doc</userinput></screen>
    </sect2>
  </sect1>

  <sect1 xml:id="current-stable">
    <title>Acompanhando um ramo de desenvolvimento</title>

    <indexterm><primary>-CURRENT</primary></indexterm>
    <indexterm><primary>-STABLE</primary></indexterm>

    <para>O FreeBSD possui duas ramificações de desenvolvimento: FreeBSD-CURRENT e FreeBSD-STABLE.</para>

    <para>Esta seção fornece uma explicação sobre cada ramo e seu público-alvo, bem como manter um sistema atualizado com cada ramo respectivo.</para>

    <sect2 xml:id="current">
      <title>Usando o FreeBSD-CURRENT</title>

      <para>O FreeBSD-CURRENT é o desenvolvimento <quote>bleeding edge</quote> do FreeBSD e espera-se que os usuários do FreeBSD-CURRENT tenham um alto grau de habilidade técnica. Usuários menos técnicos que desejam acompanhar um ramo de desenvolvimento devem acompanhar o FreeBSD-STABLE.</para>

      <para>O FreeBSD-CURRENT é o código-fonte mais recente do FreeBSD e inclui trabalhos em andamento, mudanças experimentais e mecanismos de transição que podem ou não estar presentes na próxima versão oficial. Enquanto muitos desenvolvedores do FreeBSD compilam o código-fonte do FreeBSD-CURRENT diariamente, há curtos períodos de tempo em que o código fonte pode não ser compilável. Esses problemas são resolvidos o mais rápidamente possível, mas se o FreeBSD-CURRENT traz ou não uma nova funcionalidade pode ser uma questão de quando o código-fonte foi sincronizado.</para>

      <para>O FreeBSD-CURRENT é disponibilizado para três grupos de interesse principais:</para>

      <orderedlist>
	<listitem>
	  <para>Membros da comunidade do FreeBSD que estão trabalhando ativamente em alguma parte da árvore de códigos fontes.</para>
	</listitem>

	<listitem>
	  <para>Membros da comunidade FreeBSD que são testadores ativos. Eles estão dispostos a gastar tempo resolvendo problemas, fazendo sugestões sobre mudanças e sobre a direção geral do FreeBSD, e enviando correções.</para>
	</listitem>

	<listitem>
	  <para>Usuários que desejam ficar de olho nas coisas, usam o código fonte atual para fins de referência ou fazem comentários ocasionais ou contribuições de código.</para>
	</listitem>
      </orderedlist>

      <para>O FreeBSD-CURRENT <emphasis>não</emphasis> deve ser considerado um fast-track para obter novos recursos antes do próximo release, já que os recursos de pré-release ainda não foram totalmente testados e provavelmente contêm bugs. Não é uma maneira rápida de obter correções de bugs, pois qualquer commit é tão provável de introduzir novos bugs quanto consertar os existentes. O FreeBSD-CURRENT não é de nenhuma maneira <quote>oficialmente suportado</quote>.</para>

      <indexterm><primary>-CURRENT</primary> <secondary>using</secondary></indexterm>

      <para>Para acompanhar o FreeBSD-CURRENT:</para>

      <orderedlist>
	<listitem>
	  <para>Junte-se as listas <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current">freebsd-current</link> e <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-head">svn-src-head</link>. Isto é <emphasis>essencial</emphasis> para ver os comentários que as pessoas estão fazendo sobre o estado atual do sistema e para receber importantes boletins sobre o estado atual do FreeBSD-CURRENT.</para>

	  <para>A lista <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-head">svn-src-head</link> registra a entrada de log de commit para cada alteração assim que ela é feita, juntamente com qualquer informação pertinente sobre possíveis efeitos colaterais.</para>

	  <para>Para juntar-se a estas listas, vá para <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo">http://lists.FreeBSD.org/mailman/listinfo</link>, clique na lista para se inscrever e siga as instruções. A fim de rastrear mudanças em toda a árvore de código-fonte, não apenas as mudanças no FreeBSD-CURRENT, inscreva-se na lista <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-all">svn-src-all</link>.</para>
	</listitem>

	<listitem>
	  <para>Sincronize com o código-fonte do FreeBSD-CURRENT. Normalmente, o <link linkend="svn">svnlite</link> é usado para obter o código -CURRENT da ramificação <literal>head</literal> de um dos sites espelhos do Subversion listados em <xref linkend="svn-mirrors"/>.</para>
	</listitem>

	<listitem>
	  <para>Devido ao tamanho do repositório, alguns usuários escolhem sincronizar apenas as seções do código-fonte que lhes interessam ou para as quais estão contribuindo com correções. No entanto, os usuários que planejam compilar o sistema operacional a partir do código-fonte devem baixar <emphasis>tudo</emphasis> do FreeBSD-CURRENT, não apenas as partes selecionadas.</para>

	  <para>Antes de compilar o FreeBSD-CURRENT <indexterm>
	      <primary>-CURRENT</primary>
		<secondary>compiling</secondary>
	    </indexterm>, leia o <filename>/usr/src/Makefile</filename> com muito cuidado e siga as instruções em <xref linkend="makeworld"/>. Leia a <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current">lista de discussão do FreeBSD-CURRENT</link> e o <filename>/usr/src/UPDATING</filename> para manter-se atualizado sobre outros procedimentos de bootstrapping que algumas vezes se tornam necessários no caminho para a próxima versão.</para>
	</listitem>

	<listitem>
	  <para>Ser ativo! Usuários do FreeBSD-CURRENT são encorajados a enviar suas sugestões para melhorias ou correções de bugs. Sugestões acompanhadas de código são sempre bem vindas.</para>
	</listitem>
      </orderedlist>
    </sect2>

    <sect2 xml:id="stable">
      <title>Usando o FreeBSD-STABLE</title>

      <para>O FreeBSD-STABLE é o ramo de desenvolvimento a partir do qual as releases principais são feitas. Mudanças entram neste ramo em um ritmo mais lento e com a suposição geral de que elas foram testadas primeiro no FreeBSD-CURRENT. Ele <emphasis>ainda</emphasis> é um ramo de desenvolvimento e, a qualquer momento, as fontes para o FreeBSD-STABLE podem ou não ser adequadas para uso geral. É simplesmente outra trilha de desenvolvimento de engenharia, não um recurso para usuários finais. Usuários que não possuem recursos para realizar testes devem, ao invés disso, executar a release mais recente do FreeBSD.</para>

      <para>Os interessados em acompanhar ou contribuir para o processo de desenvolvimento do FreeBSD, especialmente no que se refere à próxima versão do FreeBSD, devem considerar seguir o FreeBSD-STABLE.</para>

      <para>Embora seja esperado que o ramo FreeBSD-STABLE compile e execute o tempo todo, isso não pode ser garantido. Uma vez que mais pessoas executam o FreeBSD-STABLE do que o FreeBSD-CURRENT, é inevitável que bugs e problemas mais raros às vezes sejam encontrados no FreeBSD-STABLE os quais não foram detectados no FreeBSD-CURRENT. Por esta razão, não se deve seguir cegamente o FreeBSD-STABLE. É particularmente importante <emphasis>não</emphasis> atualizar quaisquer servidores de produção para o FreeBSD-STABLE sem testar completamente o código em um ambiente de desenvolvimento ou de teste.</para>

      <para>Para acompanhar o FreeBSD-STABLE:</para>

      <indexterm><primary>-STABLE</primary> <secondary>using</secondary></indexterm>
      <orderedlist>
	<listitem>
	  <para>Junte-se à lista <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-stable">freebsd-stable</link> para se manter informado sobre as dependências de compilação que podem aparecer no FreeBSD-STABLE ou qualquer outro problema que requeira atenção especial. Os desenvolvedores também farão anúncios nesta lista de e-mails quando estiverem contemplando alguma correção ou atualização controversa, dando aos usuários uma chance de responder se tiverem alguma questão a ser levantada sobre a alteração proposta.</para>

	  <para>Junte-se à lista <application>svn</application> relevante para o ramo que está sendo acompanhado. Por exemplo, os usuários que acompanham o ramo 9-STABLE devem se juntar a lista <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-9">svn-src-stable-9</link>. Esta lista registra a entrada do log de commit para cada alteração à medida que ela é feita, junto com qualquer informação pertinente sobre os possíveis efeitos colaterais.</para>

	  <para>Para se juntar a estas listas, vá para <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo">http://lists.FreeBSD.org/mailman/listinfo</link>, clique na lista para se inscrever e siga as instruções. Se desejar acompanhar as mudanças para toda a árvore de código-fonte, inscreva-se na <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-all">svn-src-all</link> .</para>
	</listitem>

	<listitem>
	  <para>Para instalar um novo sistema FreeBSD-STABLE, instale a versão mais recente do FreeBSD-STABLE a partir de um dos <link linkend="mirrors">sites espelho do FreeBSD</link> ou use um snapshot mensal criado a partir do FreeBSD-STABLE. Consulte <link xlink:href="@@URL_RELPREFIX@@/snapshots/">www.freebsd.org/snapshots</link> para maiores informações sobre snapshots.</para>

	  <para>Para compilar ou atualizar um sistema FreeBSD existente para o FreeBSD-STABLE, use o <link linkend="svn">svn</link> <indexterm>
		<primary>Subversion</primary>
	      </indexterm> para obter o código-fonte da ramificação desejada. Os nomes das ramificações, como <literal>stable/9</literal>, estão listados em <link xlink:href="@@URL_RELPREFIX@@/releng/">www.freebsd.org/releng</link>.</para>
	</listitem>

	<listitem>
	  <para>Antes de compilar ou atualizar para o FreeBSD-STABLE <indexterm>
	      <primary>-STABLE</primary>
		<secondary>compiling</secondary>
	    </indexterm>, leia o <filename>/usr/src/Makefile</filename> cuidadosamente e siga as instruções em <xref linkend="makeworld"/>. Leia a <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-stable">lista de discussão FreeBSD-STABLE</link> e o <filename>/usr/src/UPDATING</filename> para manter-se atualizado sobre outros procedimentos de bootstrapping que às vezes se tornam necessários no caminho para o próximo release.</para>
	</listitem>
      </orderedlist>
    </sect2>
  </sect1>

  <sect1 xml:id="makeworld">
    <title xml:id="updating-src">Atualizando o FreeBSD a partir do código fonte</title>

    <para>A atualização do FreeBSD através da compilação a partir do código-fonte oferece várias vantagens sobre as atualizações binárias. O código pode ser compilado com opções para aproveitar o hardware específico. Partes do sistema base podem ser compiladas com configurações não padrões, ou deixadas de fora somente onde não são necessárias ou desejadas. O processo de compilação leva mais tempo para atualizar um sistema do que apenas instalar atualizações binárias, mas permite customização completa para produzir uma versão do FreeBSD adaptada as suas necessidades.</para>

    <sect2 xml:id="updating-src-quick-start">
      <title>Inicio Rápido</title>

      <para>Esta é uma referência rápida para as etapas típicas usadas para atualizar o FreeBSD compilando-o a partir do código  fonte. As seções posteriores descrevem o processo com mais detalhes.</para>

      <procedure>
	<step>
	  <title>Atualizar e Compilar</title>

	  <screen><prompt>#</prompt> <userinput>svnlite update /usr/src</userinput>  <co xml:id="updating-src-qs-svnup"/>
<emphasis>check <filename>/usr/src/UPDATING</filename></emphasis>  <co xml:id="updating-src-qs-review-updating"/>
<prompt>#</prompt> <userinput>cd /usr/src</userinput>          <co xml:id="updating-src-qs-cd"/>
<prompt>#</prompt> <userinput>make -j<replaceable>4</replaceable> buildworld</userinput>  <co xml:id="updating-src-qs-buildworld"/>
<prompt>#</prompt> <userinput>make -j<replaceable>4</replaceable> kernel</userinput>      <co xml:id="updating-src-qs-kernel"/>
<prompt>#</prompt> <userinput>shutdown -r now</userinput>      <co xml:id="updating-src-qs-reboot"/>
<prompt>#</prompt> <userinput>cd /usr/src</userinput>          <co xml:id="updating-src-qs-cd2"/>
<prompt>#</prompt> <userinput>make installworld</userinput>    <co xml:id="updating-src-qs-installworld"/>
<prompt>#</prompt> <userinput>mergemaster -Ui</userinput>      <co xml:id="updating-src-qs-mergemaster"/>
<prompt>#</prompt> <userinput>shutdown -r now</userinput>      <co xml:id="updating-src-qs-shutdown"/></screen>

	  <calloutlist>
	    <callout arearefs="updating-src-qs-svnup">
	      <para>Obtenha a versão mais recente do código fonte. Veja <xref linkend="updating-src-obtaining-src"/> para maiores  informações sobre como obter e atualizar o código fonte.</para>
	    </callout>

	    <callout arearefs="updating-src-qs-review-updating">
	      <para>Verifique o <filename>/usr/src/UPDATING</filename> para quaisquer etapas manuais necessárias antes ou depois de compilar a partir do código fonte.</para>
	    </callout>

	    <callout arearefs="updating-src-qs-cd">
	      <para>Vá para o diretório de origem.</para>
	    </callout>

	    <callout arearefs="updating-src-qs-buildworld">
	      <para>Compile o mundo, tudo exceto o kernel.</para>
	    </callout>

	    <callout arearefs="updating-src-qs-kernel">
	      <para>Compile e instale o kernel. Isso é equivalente a <command>make installkernel installkernel</command>.</para>
	    </callout>

	    <callout arearefs="updating-src-qs-reboot">
	      <para>Reinicialize o sistema com o novo kernel.</para>
	    </callout>

	    <callout arearefs="updating-src-qs-cd2">
	      <para>Vá para o diretório de origem.</para>
	    </callout>

	    <callout arearefs="updating-src-qs-installworld">
	      <para>Instale o mundo.</para>
	    </callout>

	    <callout arearefs="updating-src-qs-mergemaster">
	      <para>Atualize e mescle os arquivos de configuração em <filename>/etc/</filename>.</para>
	    </callout>

	    <callout arearefs="updating-src-qs-shutdown">
	      <para>Reinicie o sistema para usar o mundo e o kernel recém-compilados.</para>
	    </callout>
	  </calloutlist>
	</step>
      </procedure>
    </sect2>

    <sect2 xml:id="updating-src-preparing">
      <title>Preparando-se para uma atualização a partir do código fonte</title>

      <para>Leia o <filename>/usr/src/UPDATING</filename>. Quaisquer etapas manuais que devem ser executadas antes ou depois de uma atualização são descritas neste arquivo.</para>
    </sect2>

    <sect2 xml:id="updating-src-obtaining-src">
      <title>Atualizando o código fonte</title>

      <para>O código fonte do FreeBSD está localizado em <filename>/usr/src/</filename>. O método preferido para atualizar os fontes é através do sistema de controle de versão do <application>Subversion</application>. Verifique se o código-fonte está sob controle de versão:</para>

      <screen><prompt>#</prompt> <userinput>svnlite info /usr/src</userinput>
Path: /usr/src
Working Copy Root Path: /usr/src
...</screen>

      <para>Isto indica que o <filename>/usr/src/</filename> está sob controle de versão e pode ser atualizado com o <citerefentry><refentrytitle>svnlite</refentrytitle><manvolnum>1</manvolnum></citerefentry>:</para>

      <screen xml:id="synching"><prompt>#</prompt> <userinput>svnlite update /usr/src</userinput></screen>

      <para>O processo de atualização pode levar algum tempo se o diretório não tiver sido atualizado recentemente. Após a conclusão, o código-fonte estará atualizado e o processo de compilação descrito na próxima seção poderá começar.</para>

      <note xml:id="updating-src-obtaining-src-checkout">
	<title>Obtendo o código fonte</title>

	<para>Se a saída disser que <literal>'/usr/src' is not a working copy</literal>,  estão faltando arquivos no diretório ou eles foram instalados com um método diferente. Um novo checkout da fonte é necessário.</para>

	<table xml:id="updating-src-obtaining-src-repopath">
	  <title>Versões do FreeBSD e Caminhos do Repositório</title>

	  <tgroup cols="3">
	    <thead>
	      <row>
		<entry>Saída do <command>uname -r</command></entry>
		<entry>Caminho do Repositório</entry>
		<entry>Descrição</entry>
	      </row>
	    </thead>

	    <tbody>
	      <row>
		<entry><literal><replaceable>X.Y</replaceable>-RELEASE</literal></entry>
		<entry><literal>base/releng/</literal><replaceable>X.Y</replaceable></entry>
		<entry>A versão do release mais apenas correções críticas de segurança e correção de erros. Este ramo é recomendado para a maioria dos usuários.</entry>
	      </row>

	      <row xml:id="STABLE">
		<entry><literal><replaceable>X.Y</replaceable>-STABLE</literal></entry>
		<entry><literal>base/stable/</literal><replaceable>X</replaceable></entry>
		<entry>
		  <para>A versão de Release mais todos os desenvolvimentos adicionais nesse ramo. O <emphasis>STABLE</emphasis> refere-se à interface binária de aplicativos (<acronym>ABI</acronym>) não sendo alterada, portanto, o software compilado para versões anteriores ainda é executado. Por exemplo, o software compilado para rodar no FreeBSD 10.1 ainda rodará no FreeBSD 10-STABLE compilado posteriormente.</para>

		  <para>Os ramos STABLE ocasionalmente possuem bugs ou incompatibilidades que podem afetar os usuários, embora sejam normalmente corrigidos rapidamente.</para>
		</entry>
	      </row>

	      <row>
		<entry><literal><replaceable>X</replaceable>-CURRENT</literal></entry>
		<entry><literal>base/head/</literal></entry>
		<entry>A mais recente versão de desenvolvimento do FreeBSD. A ramificação CURRENT pode ter grandes erros ou incompatibilidades e é recomendada apenas para usuários avançados.</entry>
	      </row>
	    </tbody>
	  </tgroup>
	</table>

	<para>Determine qual versão do FreeBSD está sendo usada com <citerefentry><refentrytitle>uname</refentrytitle><manvolnum>1</manvolnum></citerefentry>:</para>

	<screen><prompt>#</prompt> <userinput>uname -r</userinput>
10.3-RELEASE</screen>

	<para>Baseado em <xref linkend="updating-src-obtaining-src-repopath"/>, a fonte usada para atualizar <literal> 10.3-RELEASE </literal> tem como caminho de repositório <literal>base/releng/10.3</literal>. Este caminho é usado ao verificar a fonte:</para>

	<screen><prompt>#</prompt> <userinput>mv /usr/src /usr/src.bak</userinput>  <co xml:id="updating-src-obtaining-src-mv"/>
<prompt>#</prompt> <userinput>svnlite checkout https://svn.freebsd.org/base/<replaceable>releng/10.3</replaceable> /usr/src</userinput>  <co xml:id="updating-src-obtaining-src-checkout-cmd"/></screen>

	<calloutlist>
	  <callout arearefs="updating-src-obtaining-src-mv">
	    <para>Mova o diretório antigo para fora do caminho. Se não houver modificações locais nesse diretório, ele poderá ser excluído.</para>
	  </callout>

	  <callout arearefs="updating-src-obtaining-src-checkout-cmd">
	    <para>O caminho da <xref linkend="updating-src-obtaining-src-repopath"/> é adicionado a <acronym>URL</acronym> repositório . O terceiro parâmetro é o diretório de destino do código-fonte no sistema local.</para>
	  </callout>
	</calloutlist>
      </note>
    </sect2>

    <sect2 xml:id="updating-src-building">
      <title>Compilando a partir do código-fonte</title>

      <para>O <emphasis>world</emphasis>, ou todo o sistema operacional, exceto o kernel, é compilado. Isso é feito primeiro para fornecer ferramentas atualizadas para construir o kernel. Então o próprio kernel é construído:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/src</userinput>
<prompt>#</prompt> <userinput>make buildworld</userinput>
<prompt>#</prompt> <userinput>make buildkernel</userinput></screen>

      <para>O código compilado é escrito em <filename>/usr/obj</filename>.</para>

      <para>Estes são os passos básicos. Opções adicionais para controlar a compilação são descritas abaixo.</para>

      <sect3 xml:id="updating-src-building-clean-build">
	<title>Executando uma compilação limpa</title>

	<para>Algumas versões do sistema de compilação do FreeBSD deixam o código previamente compilado no diretório de objetos temporários, <filename>/usr/obj</filename>. Isso pode acelerar as compilações posteriores, evitando recompilar o código que não foi alterado. Para forçar uma reconstrução limpa de tudo, use <buildtarget>cleanworld</buildtarget> antes de iniciar uma construção:</para>

	<screen><prompt>#</prompt> <userinput>make cleanworld</userinput></screen>
      </sect3>

      <sect3 xml:id="updating-src-building-jobs">
	<title>Definindo o Número de Jobs</title>

	<para>Aumentar o número de jobs de compilação em processadores com vários núcleos pode melhorar a velocidade de construção. Determine o número de núcleos com <command>sysctl hw.ncpu</command>. Os processadores variam, assim como os sistemas de compilação usados com diferentes versões do FreeBSD, portanto, o teste é o único método seguro para determinar como um número diferente de tarefas afeta a velocidade de compilação. Como ponto de partida, considere valores entre metade e o dobro do número de núcleos. O número de jobs é especificado com a opção <option>-j</option>.</para>

	<example xml:id="updating-src-building-jobs-example">
	  <title>Aumentando o número de jobs de compilação</title>

	  <para>Compilando o mundo e o kernel com quatro jobs:</para>

	  <screen><prompt>#</prompt> <userinput>make -j4 buildworld buildkernel</userinput></screen>
	</example>
      </sect3>

      <sect3 xml:id="updating-src-building-only-kernel">
	<title>Compilando Apenas o Kernel</title>

	<para>Um <buildtarget>buildworld</buildtarget> deve ser completado se o código-fonte for alterado. Depois disso, um <buildtarget>buildkernel</buildtarget> para compilar um kernel pode ser executado a qualquer momento. Para compilar apenas o kernel:</para>

	<screen><prompt>#</prompt> <userinput>cd /usr/src</userinput>
<prompt>#</prompt> <userinput>make buildkernel</userinput></screen>
      </sect3>

      <sect3 xml:id="updating-src-building-custom-kernel">
	<title>Compilando um Kernel Customizado</title>

	<para>O kernel padrão do FreeBSD é baseado em um <emphasis>arquivo de configuração do kernel</emphasis> chamado <filename>GENERIC</filename>. O kernel <filename>GENERIC</filename> inclui os drivers e opções de dispositivos mais comumente necessários. Às vezes, é útil ou necessário criar um kernel personalizado, adicionando ou removendo drivers de dispositivo ou opções para atender a uma necessidade específica.</para>

	<para>Por exemplo, alguém que desenvolve um pequeno computador embarcado com RAM <acronym>severamente limitada</acronym> pode remover drivers de dispositivo desnecessários ou opções para tornar o kernel um pouco menor.</para>

	<para>Os arquivos de configuração do Kernel estão localizados em <filename>/usr/src/sys/<replaceable>arch</replaceable>/conf/</filename>, onde <replaceable>arch</replaceable> é a saída do <command>uname - m</command>. Na maioria dos computadores, a saida será <literal>amd64</literal>, resultando no diretório de arquivos de configuração <filename>/usr/src/sys/<replaceable>amd64</replaceable>/conf/</filename>.</para>

	<tip>
	  <para>O <filename>/usr/src</filename> pode ser deletado ou recriado, então é preferível manter os arquivos de configuração do kernel em um diretório separado, como por exemplo em <filename>/root</filename>. Vincule o arquivo de configuração do kernel ao diretório <filename>conf</filename>. Se esse diretório for excluído ou sobrescrito, a configuração do kernel pode ser vinculada novamente ao novo.</para>
	</tip>

	<para>Um arquivo de configuração personalizado pode ser criado copiando o arquivo de configuração <filename>GENERIC</filename>. Neste exemplo, o novo kernel personalizado é para um servidor de armazenamento, portanto, é denominado <filename>STORAGESERVER</filename>:</para>

	<screen><prompt>#</prompt> <userinput>cp /usr/src/sys/amd64/conf/GENERIC /root/STORAGESERVER</userinput>
<prompt>#</prompt> <userinput>cd /usr/src/sys/amd64/conf</userinput>
<prompt>#</prompt> <userinput>ln -s /root/STORAGESERVER .</userinput></screen>

	<para>O <filename>/root/STORAGESERVER</filename> é então editado, adicionando ou removendo dispositivos ou opções como mostrado em <citerefentry><refentrytitle>config</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>

	<para>O kernel personalizado é compilado pela configuração <varname>KERNCONF</varname> no arquivo de configuração do kernel na linha de comando:</para>

	<screen><prompt>#</prompt> <userinput>make buildkernel KERNCONF=STORAGESERVER</userinput></screen>
      </sect3>
    </sect2>

    <sect2 xml:id="updating-src-installing">
      <title>Instalando o código compilado</title>

      <para>Depois que as etapas <buildtarget>buildworld</buildtarget> e <buildtarget>buildkernel</buildtarget> forem concluídas, o novo kernel e o restante do sistema base serão instalados:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/src</userinput>
<prompt>#</prompt> <userinput>make installkernel</userinput>
<prompt>#</prompt> <userinput>shutdown -r now</userinput>
<prompt>#</prompt> <userinput>cd /usr/src</userinput>
<prompt>#</prompt> <userinput>make installworld</userinput>
<prompt>#</prompt> <userinput>shutdown -r now</userinput></screen>

      <para>Se um kernel customizado foi compilado, <varname>KERNCONF</varname> também deve ser configurado para usar o novo kernel customizado:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/src</userinput>
<prompt>#</prompt> <userinput>make installkernel KERNCONF=STORAGESERVER</userinput>
<prompt>#</prompt> <userinput>shutdown -r now</userinput>
<prompt>#</prompt> <userinput>cd /usr/src</userinput>
<prompt>#</prompt> <userinput>make installworld</userinput>
<prompt>#</prompt> <userinput>shutdown -r now</userinput></screen>
    </sect2>

    <sect2 xml:id="updating-src-completing">
      <title>Concluindo a atualização</title>

      <para>Algumas tarefas finais completam a atualização. Quaisquer arquivos de configuração que tenham sido modificados serão mesclado com as novas versões, as bibliotecas desatualizadas são localizadas e removidas e, em seguida, o sistema é reiniciado.</para>

      <sect3 xml:id="updating-src-completing-merge-mergemaster">
	<title>Mesclando arquivos de configuração com o <citerefentry><refentrytitle>mergemaster</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

	<para>O <citerefentry><refentrytitle>mergemaster</refentrytitle><manvolnum>8</manvolnum></citerefentry> fornece uma maneira fácil de mesclar as alterações feitas nos arquivos de configuração do sistema com novas versões desses arquivos.</para>

	<para>Com a opção <option>-Ui</option>, o <citerefentry><refentrytitle>mergemaster</refentrytitle><manvolnum>8</manvolnum></citerefentry> atualizará automaticamente os arquivos que não foram modificados pelo usuário e instalará os novos arquivos que ainda não estiverem presentes:</para>

	<screen><prompt>#</prompt> <userinput>mergemaster -Ui</userinput></screen>

	<para>Se um arquivo precisar ser mesclado manualmente, uma exibição interativa permitirá que o usuário escolha quais partes dos arquivos serão mantidas. Veja <citerefentry><refentrytitle>mergemaster</refentrytitle><manvolnum>8</manvolnum></citerefentry> para maiores informações.</para>
      </sect3>

      <sect3 xml:id="updating-src-completing-check-old">
	<title>Verificando Arquivos e Bibliotecas Desatualizados</title>

	<para>Alguns arquivos ou diretórios obsoletos podem permanecer após uma atualização. Esses arquivos podem ser localizados:</para>

	<screen><prompt>#</prompt> <userinput>make check-old</userinput></screen>

	<para>e excluído:</para>

	<screen><prompt>#</prompt> <userinput>make delete-old</userinput></screen>

	<para>Algumas bibliotecas obsoletas também podem permanecer. Estes podem ser detectados com:</para>

	<screen><prompt>#</prompt> <userinput>make check-old-libs</userinput></screen>

	<para>e deletado com</para>

	<screen><prompt>#</prompt> <userinput>make delete-old-libs</userinput></screen>

	<para>Os programas que ainda estavam usando estas bibliotecas antigas deixarão de funcionar quando a biblioteca for excluída. Estes programas devem ser recompilados ou substituídos após a exclusão das bibliotecas antigas.</para>

	<tip>
	  <para>Quando todos os arquivos ou diretórios antigos forem considerados seguros para serem excluídos, a ação de pressionar  <keycap>y</keycap> e <keycap>Enter</keycap> para excluir cada arquivo poderá ser evitada  configurando a variável <varname>BATCH_DELETE_OLD_FILES</varname> no comando. Por exemplo:</para>

	  <screen><prompt>#</prompt> <userinput>make BATCH_DELETE_OLD_FILES=yes delete-old-libs</userinput></screen>
	</tip>
      </sect3>

      <sect3 xml:id="updating-src-completing-restart">
	<title>Reiniciando após a atualização</title>

	<para>A última etapa após a atualização é reiniciar o computador para que todas as alterações entrem em vigor:</para>

	<screen><prompt>#</prompt> <userinput>shutdown -r now</userinput></screen>
      </sect3>
    </sect2>
  </sect1>

  <sect1 xml:id="small-lan">
    <info>
      <title>Atualização de várias máquinas</title>

      <authorgroup>
	<author><personname> <firstname>Mike</firstname> <surname>Meyer</surname> </personname> <contrib>Contribuído por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>NFS</primary> <secondary>installing multiple machines</secondary></indexterm>

    <para>Quando várias máquinas precisam rastrear a mesma árvore de código-fonte, é um desperdício de espaço em disco, largura de banda de rede e ciclos de <acronym>CPU</acronym> se cada sistema tiver que baixar o código-fonte e recompilar tudo. A solução é ter uma máquina fazendo a maior parte do trabalho, enquanto o resto das máquinas montam esse trabalho via <acronym>NFS</acronym>. Esta seção descreve um método para fazer isso. Para maiores informações sobre o uso de <acronym>NFS</acronym>, consulte <xref linkend="network-nfs"/>.</para>

    <para>Primeiro, identifique um conjunto de máquinas que executará o mesmo conjunto de binários, conhecido como <firstterm>conjunto de compilação</firstterm>. Cada máquina pode ter um kernel customizado, mas executará os mesmos binários do userland. A partir desse conjunto, escolha uma máquina para ser a <firstterm>máquina de compilação</firstterm> em que o sistema base e o kernel serão compilados. Idealmente, esta deverá ser uma máquina rápida que tenha <acronym>CPU</acronym> suficiente disponível para executar o <command>make buildworld</command> e o <command>make buildkernel</command>.</para>

    <para>Selecione uma máquina para ser a <firstterm>máquina de teste</firstterm>, que testará as atualizações de software antes de serem colocadas em produção. Esta <emphasis>deve</emphasis> ser uma máquina que você possa se dar ao luxo de ficar inativa por um longo período de tempo. Pode ser a máquina de compilação, mas não precisa ser.</para>

    <para>Todas as máquinas neste conjunto de compilação precisam montar o <filename>/usr/obj</filename> e o <filename>/usr/src</filename> da máquina de compilação através do <acronym>NFS</acronym>. Para vários conjuntos de compilação, o <filename>/usr/src</filename> deve ser um sistema de arquivos local na máquina de compilação e um sistema montado por <acronym>NFS</acronym> nas demais.</para>

    <para>Certifique-se de que o <filename>/etc/make.conf</filename> e o <filename>/etc/src.conf</filename> em todas as máquinas no conjunto de compilação concordem com a máquina de compilação. Isso significa que a máquina de compilação deve compilar todas as partes do sistema base que qualquer máquina no conjunto de compilação irá instalar. Além disso, cada máquina de compilação deve ter seu nome de kernel definido com <varname>KERNCONF</varname> em <filename>/etc/make.conf</filename>, e a máquina de compilação deve listá-los todos em seu <varname>KERNCONF</varname>, listando seu próprio kernel primeiro. A máquina de compilação deve ter os arquivos de configuração do kernel para cada máquina em seu <filename>/usr/src/sys/<replaceable>arch</replaceable>/conf</filename>.</para>

    <para>Na máquina de compilação, compile o kernel e o mundo conforme descrito em <xref linkend="makeworld"/>, mas não instale nada na máquina de compilação. Em vez disso, instale o kernel compilado na máquina de teste. Na máquina de teste, monte <filename>/usr/src</filename> e o <filename>/usr/obj</filename> via <acronym>NFS</acronym>. Em seguida, execute <command>shutdown now</command> para ir para o modo de usuário único para instalar o novo kernel e o restante do sistema base e execute o <command>mergemaster</command> como de costume. Quando terminar, reinicialize para retornar às operações multiusuário normais.</para>

    <para>Depois de verificar se tudo na máquina de teste está funcionando corretamente, use o mesmo procedimento para instalar o novo software em cada uma das outras máquinas no conjunto de compilação.</para>

    <para>A mesma metodologia pode ser usada para a árvore de ports. O primeiro passo é compartilhar o <filename>/usr/ports</filename> via <acronym>NFS</acronym> para todas as máquinas no conjunto de compilação. Para configurar o <filename>/etc/make.conf</filename> para compartilhar os distfiles, configure o <varname>DISTDIR</varname> para um diretório compartilhado que possa ser escrito por qualquer usuário <systemitem class="username">root</systemitem> mapeado pela montagem <acronym>NFS</acronym>. Cada máquina deve definir o <varname>WRKDIRPREFIX</varname> para um diretório de compilação local, se os ports precisarem ser compilados localmente. Como alternativa, se o sistema de compilação tiver que compilar e distribuir pacotes para as máquinas no conjunto de compilação, configure o <varname>PACKAGES</varname> no sistema de compilação para um diretório semelhante ao <varname>DISTDIR</varname>.</para>
  </sect1>
</chapter>

    
<!--
Recently I suggested to myself that this should become a profiling
and debugging chapter, which covers things like ktrace(1) and
using other debugging (like -x in shell scripts).  But then I
realized that, over time and while DTrace becomes better supported,
that might make this chapter too large.
-->
<!--
     The FreeBSD Documentation Project
     $FreeBSD$
-->
<!-- XXXTR: Should probably put links and resources here.  I'm
        nervous about this chapter as it may require a partial
	re-write and large modification once DTrace is complete, but
	at least we can get everyone started ... -->
<chapter version="5.0" xml:id="dtrace">
  <info>
    <title>DTrace</title>

    <authorgroup>
      <author><personname><firstname>Tom</firstname><surname>Rhodes</surname></personname><contrib>Escrito por </contrib></author>
    </authorgroup>
  </info>

  <sect1 xml:id="dtrace-synopsis">
    <title>Sinopse</title>

    <indexterm><primary>DTrace</primary></indexterm>
    <indexterm><primary>DTrace support</primary> <see>DTrace</see></indexterm>

    <para>O DTrace, também conhecido como Dynamic Tracing, foi desenvolvido pela <trademark>Sun</trademark> como uma ferramenta para localizar gargalos de desempenho em sistemas de produção e pré-produção. Além de diagnosticar problemas de desempenho, o DTrace pode ser usado para ajudar a investigar e depurar comportamentos inesperados no kernel do FreeBSD e em programas da userland.</para>

    <para>O DTrace é uma ferramenta de criação de perfil notável, com uma impressionante variedade de recursos para diagnosticar problemas do sistema. Ele também pode ser usado para executar scripts pré-escritos para aproveitar seus recursos. Os usuários podem criar seus próprios utilitários usando a DTrace D Language, permitindo que eles personalizem seus perfis com base em necessidades específicas.</para>

    <para>A implementação do FreeBSD fornece suporte completo para o DTrace do kernel e suporte experimental para o DTrace da userland. O Userland DTrace permite que os usuários executem o rastreio de limite de função para programas de área de trabalho usando o provedor <literal>pid</literal> e insiram investigações estáticas em programas da userland para rastreamento posterior. Alguns ports, como <package>databases/postgresql12-server</package> e <package>lang/php74</package>, possuem uma opção do DTrace para ativar testes estáticos.</para>

    <para>O guia oficial do DTrace é mantido pelo projeto Illumos no <uri xlink:href="http://dtrace.org/guide">Guia do DTrace</uri>.</para>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>O que é o DTrace e quais recursos ele fornece.</para>
      </listitem>

      <listitem>
	<para>Diferenças entre a implementação do DTrace <trademark>Solaris</trademark> e a fornecida pelo FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como ativar e usar o DTrace no FreeBSD.</para>
      </listitem>
    </itemizedlist>

    <para>Antes de ler este capítulo, você deve:</para>

    <itemizedlist>
      <listitem>
	<para>Entender os fundamentos do <trademark class="registered">UNIX</trademark> e do FreeBSD (<xref linkend="basics"/>).</para>
      </listitem>

      <listitem>
	<para>Ter alguma familiaridade com segurança e como ela está presente no FreeBSD (<xref linkend="security"/>).</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="dtrace-implementation">
    <title>Diferenças de Implementação</title>

    <para>Embora o DTrace no FreeBSD seja semelhante ao encontrado no <trademark>Solaris</trademark>, existem diferenças. A principal diferença é que no FreeBSD, o DTrace é implementado como um conjunto de módulos do kernel e o DTrace não pode ser usado até que os módulos sejam carregados. Para carregar todos os módulos necessários:</para>

    <screen><prompt>#</prompt> <userinput>kldload dtraceall</userinput></screen>

    <para>Começando com o FreeBSD 10.0-RELEASE, os módulos são carregados automaticamente quando o <command>dtrace</command> é executado.</para>

    <para>O FreeBSD usa a opção do kernel <literal>DDB_CTF</literal> para ativar o suporte para carregar dados <acronym>CTF</acronym> dos módulos do kernel e do próprio kernel. O <acronym>CTF</acronym> é o <trademark>Solaris</trademark> Compact C Type Format, que encapsula uma forma reduzida de informações de depuração semelhantes ao <acronym>DWARF</acronym> e aos veneráveis stabs. Os dados do <acronym>CTF</acronym> são adicionados aos binários pelas ferramentas de compilação <command>ctfconvert</command> e <command>ctfmerge</command>. O utilitário <command>ctfconvert</command> analisa as seções de depuração do <acronym>DWARF</acronym> <acronym>ELF</acronym> criadas pelo compilador e o <command>ctfmerge</command> mescla as seções do <acronym>ELF</acronym> do <acronym>CTF</acronym> dos objetos em executáveis ou bibliotecas compartilhadas.</para>

    <para>Alguns provedores diferentes existem para o FreeBSD  não para o <trademark>Solaris</trademark>. O mais notável é o provedor <literal>dtmalloc</literal>, que permite rastrear <function>malloc()</function> por tipo no kernel do FreeBSD. Alguns dos provedores encontrados no <trademark>Solaris</trademark>, como <literal>cpc</literal> e <literal>mib</literal>, não estão presentes no FreeBSD. Estes podem aparecer em futuras versões do FreeBSD. Além disso, alguns dos provedores disponíveis em ambos os sistemas operacionais não são compatíveis, no sentido de que suas sondas têm tipos de argumentos diferentes. Assim, os scripts <acronym>D</acronym> escritos em <trademark>Solaris</trademark> podem ou não funcionar sem modificações no FreeBSD, e vice-versa.</para>

    <para>Devido as diferenças de segurança, somente o <systemitem class="username">root</systemitem> pode usar o DTrace no FreeBSD. O <trademark>Solaris</trademark> possui algumas verificações de segurança de baixo nível que ainda não existem no FreeBSD. Como tal, o <filename>/dev/dtrace/dtrace</filename> é estritamente limitado ao <systemitem class="username">root</systemitem>.</para>

    <para>O DTrace se enquadra na licença Common Development and Distribution License (<acronym>CDDL</acronym>). Para ver esta licença no FreeBSD, consulte <filename>/usr/src/cddl/contrib/opensolaris/OPENSOLARIS.LICENSE</filename> ou acesse on-line em <uri xlink:href="http://opensource.org/licenses/CDDL-1.0">http://opensource.org/licenses/CDDL-1.0</uri>. Enquanto um kernel do FreeBSD com suporte a DTrace é licenciado sob <acronym>BSD</acronym>, o <acronym>CDDL</acronym> é usado quando os módulos são distribuídos em formato binário ou quando os binários são carregados.</para>
  </sect1>

  <sect1 xml:id="dtrace-enable">
    <title>Ativando o Suporte do DTrace</title>

    <para>No FreeBSD 9.2 e 10.0, o suporte do DTrace está embutido no kernel <filename>GENERIC</filename>. Usuários de versões anteriores do FreeBSD ou que preferem compilar estaticamente o suporte do DTrace devem adicionar as seguintes linhas a um arquivo de configuração de kernel personalizado e recompilar o kernel usando as instruções em <xref linkend="kernelconfig"/>:</para>

    <programlisting>options         KDTRACE_HOOKS
options         DDB_CTF
makeoptions	DEBUG=-g
makeoptions	WITH_CTF=1</programlisting>

    <para>Os usuários da arquitetura AMD64 também devem adicionar esta linha:</para>

    <programlisting>options         KDTRACE_FRAME</programlisting>

    <para>Esta opção fornece suporte para <acronym>FBT</acronym>. Embora o DTrace funcione sem essa opção, haverá suporte limitado para o rastreamento de limite de função.</para>

    <para>Uma vez que o sistema FreeBSD foi reinicializado no novo kernel, ou os módulos de kernel do DTrace foram carregados usando <command>kldload dtraceall</command>, o sistema precisará de suporte para o shell Korn, pois o DTrace Toolkit possui vários utilitários escritos em <command>ksh</command>. Certifique-se de que o pacote ou port <package>shells/ksh93</package> esteja instalado. Também é possível rodar estas ferramentas com <package>shells/pdksh</package> ou <package>shells/mksh</package>.</para>

    <para>Por fim, instale o DTrace Toolkit atual, uma coleção de scripts prontos para coletar informações do sistema. Existem scripts para verificar arquivos abertos, memória, uso de <acronym>CPU</acronym> e muito mais. O FreeBSD 10 instala alguns desses scripts em <filename>/usr/share/dtrace</filename>. Em outras versões do FreeBSD, ou para instalar o DTrace Toolkit completo, use o pacote ou port <package>sysutils/DTraceToolkit</package>.</para>

    <note>
      <para>Os scripts encontrados em <filename>/usr/share/dtrace</filename> foram especificamente portados para o FreeBSD. Nem todos os scripts encontrados no DTrace Toolkit funcionarão no FreeBSD e alguns scripts podem exigir algum esforço para que funcionem no FreeBSD.</para>
    </note>

    <para>O DTrace Toolkit inclui muitos scripts no idioma especial do DTrace. Esta linguagem é chamada de linguagem D e é muito semelhante ao C++. Uma discussão aprofundada da linguagem está além do escopo deste documento. Ele é abordado extensivamente no <uri xlink:href="http://www.dtrace.org/guide">Illumos Dynamic Tracing Guide</uri>.</para></sect1>

  <sect1 xml:id="dtrace-using">
    <title>Usando o DTrace</title>

    <para>Os scripts do DTrace consistem em uma lista de um ou mais testes <firstterm>probes</firstterm>, ou pontos de instrumentação, em que cada teste é associado a uma ação. Sempre que a condição de uma sonda é atendida, a ação associada é executada. Por exemplo, uma ação pode ocorrer quando um arquivo é aberto, um processo é iniciado ou uma linha de código é executada. A ação pode ser registrar algumas informações ou modificar variáveis de contexto. A leitura e a escrita de variáveis de contexto permitem que os probes compartilhem informações e analisem cooperativa-mente a correlação de diferentes eventos.</para>

    <para>Para ver todos os probes, o administrador pode executar o seguinte comando:</para>

    <screen><prompt>#</prompt> <userinput>dtrace -l | more</userinput></screen>

    <para>Cada probe possui um <literal>ID</literal>, um <literal>PROVIDER</literal> (dtrace ou fbt), um <literal>MODULE</literal> e um <literal>FUNCTION NAME</literal>. Consulte <citerefentry><refentrytitle>dtrace</refentrytitle><manvolnum>1</manvolnum></citerefentry> para obter maiores informações sobre este comando.</para>

    <para>Os exemplos nesta seção fornecem uma visão geral de como usar dois dos scripts totalmente suportados dos scripts do DTrace Toolkit: o <filename>hotkernel</filename> e <filename>procsystime</filename>.</para>

    <para>O script <filename>hotkernel</filename> é projetado para identificar qual função está usando a maior parte do tempo do kernel. Ele produzirá uma saída semelhante à seguinte:</para>

    <screen><prompt>#</prompt> <userinput>cd /usr/local/share/dtrace-toolkit</userinput>
<prompt>#</prompt> <userinput>./hotkernel</userinput>
Sampling... Hit Ctrl-C to end.</screen>

    <para>Conforme instruído, use a combinação de teclas <keycombo action="simul"><keycap>Ctrl</keycap><keycap>C</keycap> </keycombo> para interromper o processo. Após o término, o script exibirá uma lista de funções do kernel e informações de tempo, classificando a saída em ordem crescente de tempo:</para>

    <screen>kernel`_thread_lock_flags                                   2   0.0%
0xc1097063                                                  2   0.0%
kernel`sched_userret                                        2   0.0%
kernel`kern_select                                          2   0.0%
kernel`generic_copyin                                       3   0.0%
kernel`_mtx_assert                                          3   0.0%
kernel`vm_fault                                             3   0.0%
kernel`sopoll_generic                                       3   0.0%
kernel`fixup_filename                                       4   0.0%
kernel`_isitmyx                                             4   0.0%
kernel`find_instance                                        4   0.0%
kernel`_mtx_unlock_flags                                    5   0.0%
kernel`syscall                                              5   0.0%
kernel`DELAY                                                5   0.0%
0xc108a253                                                  6   0.0%
kernel`witness_lock                                         7   0.0%
kernel`read_aux_data_no_wait                                7   0.0%
kernel`Xint0x80_syscall                                     7   0.0%
kernel`witness_checkorder                                   7   0.0%
kernel`sse2_pagezero                                        8   0.0%
kernel`strncmp                                              9   0.0%
kernel`spinlock_exit                                       10   0.0%
kernel`_mtx_lock_flags                                     11   0.0%
kernel`witness_unlock                                      15   0.0%
kernel`sched_idletd                                       137   0.3%
0xc10981a5                                              42139  99.3%</screen>

    <!-- XXXTR: I attempted to use objdump and nm on /boot/kernel/kernel
        to find 0xc10981a5, but to no avail.  It would be nice to know
	how we should look that up. -->

    <para>Este script também funcionará com módulos do kernel. Para usar este recurso, execute o script com <option>-m</option>:</para>

    <screen><prompt>#</prompt> <userinput>./hotkernel -m</userinput>
Sampling... Hit Ctrl-C to end.
^C
MODULE                                                  COUNT   PCNT
0xc107882e                                                  1   0.0%
0xc10e6aa4                                                  1   0.0%
0xc1076983                                                  1   0.0%
0xc109708a                                                  1   0.0%
0xc1075a5d                                                  1   0.0%
0xc1077325                                                  1   0.0%
0xc108a245                                                  1   0.0%
0xc107730d                                                  1   0.0%
0xc1097063                                                  2   0.0%
0xc108a253                                                 73   0.0%
kernel                                                    874   0.4%
0xc10981a5                                             213781  99.6%</screen>

    <!-- XXXTR: I was unable to match these up with output from
        kldstat and kldstat -v and grep.  Maybe I'm missing something
	seriously obvious.  It is 5AM btw. -->

    <para>O script <filename>procsystime</filename> captura e imprime o uso do tempo de chamada do sistema para um determinado processo <acronym>ID</acronym> (<acronym>PID</acronym>) ou nome do processo. No exemplo a seguir, uma nova instância de <filename>/bin/csh</filename> foi gerada. Então, <filename>procsystime</filename> foi executado e permaneceu aguardando enquanto alguns comandos foram digitados na outra instância do  <command>csh</command>. Estes são os resultados deste teste:</para>

    <screen><prompt>#</prompt> <userinput>./procsystime -n csh</userinput>
Tracing... Hit Ctrl-C to end...
^C

Elapsed Times for processes csh,

         SYSCALL          TIME (ns)
          getpid               6131
       sigreturn               8121
           close              19127
           fcntl              19959
             dup              26955
         setpgid              28070
            stat              31899
       setitimer              40938
           wait4              62717
       sigaction              67372
     sigprocmask             119091
    gettimeofday             183710
           write             263242
          execve             492547
           ioctl             770073
           vfork            3258923
      sigsuspend            6985124
            read         3988049784</screen>

    <para>Como mostrado, a chamada de sistema <function>read()</function> usou a maior parte do tempo em nanossegundos enquanto a chamada de sistema <function>getpid()</function> usou a menor quantidade de tempo.</para>
  </sect1>
</chapter>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->

<chapter version="5.0" xml:id="usb-device-mode">

  <title>Modo de dispositivo USB/USB OTG</title>

  <sect1 xml:id="usb-device-mode-synopsis">
    <title>Sinopse</title>

    <info>
      <authorgroup>
	<author><personname> <firstname>Edward Tomasz</firstname> <surname>Napierala</surname> </personname> <affiliation> <address>
	      <email>trasz@FreeBSD.org</email>
	    </address> </affiliation> <contrib>Escrito por </contrib></author>
      </authorgroup>
    </info>

    <para>Este capítulo aborda o uso do Modo de Dispositivo USB e USB On The Go (<acronym>USB OTG</acronym>) no FreeBSD. Isso inclui consoles seriais virtuais, interfaces de rede virtual e drives USB virtuais.</para>

    <para>Quando rodando em hardware que suporta o modo de dispositivo USB ou <acronym>USB OTG</acronym>, como aquele embutido em muitas placas embarcadas, a stack <acronym>USB</acronym> do FreeBSD pode ser executada em <emphasis>modo de dispositivo</emphasis>. O modo de dispositivo possibilita que o computador apresente-se como diferentes tipos de classes de dispositivos <acronym>USB</acronym>, incluindo portas seriais, adaptadores de rede e armazenamento em massa, ou uma combinação dos mesmos. Um host <acronym>USB</acronym> como um laptop ou computador desktop pode acessá-los assim como faria com dispositivos <acronym>USB</acronym> físicos. O modo de dispositivo é algumas vezes chamado de <quote>modo USB gadget</quote>.</para>

    <para>Existem duas maneiras básicas pelas quais o hardware pode fornecer a funcionalidade do modo de dispositivo: com uma "porta de cliente" separada, que suporta apenas o modo de dispositivo, e com uma porta USB OTG, que pode fornecer o modo de dispositivo e o modo de host. Para portas <acronym>USB OTG</acronym>, a stack <acronym>USB</acronym> alterna automaticamente entre o lado do host e o lado do dispositivo, dependendo do que estiver conectado à porta. Conectar um dispositivo <acronym>USB</acronym> como um cartão de memória à porta faz com que o FreeBSD mude para o modo de host. Conectar um host <acronym>USB</acronym> como um computador faz com que o FreeBSD mude para o modo de dispositivo. As "portas do cliente" de finalidade única sempre funcionam no modo de dispositivo.</para>

    <para>O que o FreeBSD apresenta para o host <acronym>USB</acronym> depende do sysctl <varname>hw.usb.template</varname>. Alguns modelos fornecem um único dispositivo, como um terminal serial; outros fornecem vários, que podem ser todos usados ao mesmo tempo. Um exemplo é o template 10, que fornece um dispositivo de armazenamento em massa, um console serial e uma interface de rede. Veja o <citerefentry><refentrytitle>usb_template</refentrytitle><manvolnum>4</manvolnum></citerefentry> para obter a lista de valores disponíveis.</para>

    <para>Observe que, em alguns casos, dependendo do hardware e do sistema operacional do host, para o host notar a alteração da configuração, ele deve ser fisicamente desconectado e reconectado ou forçado a verificar novamente o barramento <acronym>USB</acronym> de uma maneira específica do sistema. Quando o FreeBSD é executado no host, o <citerefentry vendor="current"><refentrytitle>usbconfig</refentrytitle><manvolnum>8</manvolnum></citerefentry> <command>reset</command> pode ser usado. Isto também deve ser feito após carregar o <filename>usb_template.ko</filename> se o host <acronym>USB</acronym> já estiver conectado ao soquete <acronym>USB</acronym> <acronym> OTG </acronym> .</para>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>Como configurar a funcionalidade do modo de dispositivo USB no FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como configurar a porta serial virtual no FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como se conectar à porta serial virtual de vários sistemas operacionais.</para>
      </listitem>

      <listitem>
	<para>Como configurar o FreeBSD para fornecer uma interface de rede virtual <acronym>USB</acronym>.</para>
      </listitem>

      <listitem>
	<para>Como configurar o FreeBSD para fornecer um dispositivo virtual de armazenamento <acronym>USB</acronym>.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="usb-device-mode-terminals">
    <title>Portas Seriais Virtuais <acronym>USB</acronym></title>

    <sect2>
      <title>Configurando Portas Seriais do Modo de Dispositivo USB</title>

      <para>O suporte para porta serial virtual é fornecido pelos templates número 3, 8 e 10. Observe que o template 3 funciona com o Microsoft Windows 10 sem a necessidade de drivers especiais e de arquivos INF. Outros sistemas operacionais host funcionam com todos os três modelos. Os módulos do kernel <citerefentry><refentrytitle>usb_template</refentrytitle><manvolnum>4</manvolnum></citerefentry> e <citerefentry><refentrytitle>umodem</refentrytitle><manvolnum>4</manvolnum></citerefentry> devem ser carregados.</para>

      <para>Para ativar as portas seriais do modo de dispositivo USB, adicione essas linhas ao <filename>/etc/ttys</filename>:</para>

      <programlisting>ttyU0	"/usr/libexec/getty 3wire"	vt100	onifconsole secure
ttyU1	"/usr/libexec/getty 3wire"	vt100	onifconsole secure</programlisting>

      <para>Então adicione estas linhas ao arquivo <filename>/etc/devd.conf</filename>:</para>

      <programlisting>notify 100 {
	match "system"		"DEVFS";
	match "subsystem"	"CDEV";
	match "type"		"CREATE";
	match "cdev"		"ttyU[0-9]+";
	action "/sbin/init q";
};</programlisting>

      <para>Recarregue a configuração se o <citerefentry><refentrytitle>devd</refentrytitle><manvolnum>8</manvolnum></citerefentry> já estiver em execução:</para>

      <screen><prompt>#</prompt> <userinput>service devd restart</userinput></screen>

      <para>Certifique-se de que os módulos necessários estejam carregados e que o template correto esteja configurado na inicialização, adicionando estas linhas ao <filename>/boot/loader.conf</filename>, criando-o se ele ainda não existir:</para>

      <screen>umodem_load="YES"
hw.usb.template=3</screen>

      <para>Para carregar o módulo e definir o modelo sem reiniciar, use:</para>

      <screen><prompt>#</prompt> <userinput>kldload umodem</userinput>
<prompt>#</prompt> <userinput>sysctl hw.usb.template=3</userinput></screen>

    </sect2>

    <sect2>
      <title>Conectando-se às portas seriais do modo de dispositivo USB a partir do FreeBSD</title>

      <para>Para conectar-se a uma placa configurada para fornecer portas seriais de um dispositivo USB, conecte o host USB, como um laptop, às placas USB OTG ou porta de cliente USB. Use <command>pstat -t</command> no host para listar as linhas de terminal. Perto do final da lista, você deve ver uma porta serial USB, por exemplo, "ttyU0". Para abrir a conexão, use:</para>

	<screen><prompt>#</prompt> <userinput>cu -l /dev/ttyU0</userinput></screen>

      <para>Depois de pressionar a tecla <keycap>Enter</keycap> algumas vezes, você verá um prompt de login.</para>
    </sect2>

    <sect2>
      <title>Conectando-se às Portas Seriais do Modo de Dispositivo USB a partir do <trademark class="registered">Mac OS</trademark></title>

      <para>Para conectar-se a uma placa configurada para fornecer portas seriais de modo de dispositivo USB, conecte o host USB, como um laptop, às placas USB OTG ou porta de cliente USB. Para abrir a conexão, use:</para>

	<screen><prompt>#</prompt> <userinput>cu -l /dev/cu.usbmodemFreeBSD1</userinput></screen>
    </sect2>

    <sect2>
      <title>Conectando-se às portas seriais do modo de dispositivo USB a partir do Linux</title>

      <para>Para conectar-se a uma placa configurada para fornecer portas seriais de modo de dispositivo USB, conecte o host USB, como um laptop, às placas USB OTG ou porta de cliente USB. Para abrir a conexão, use:</para>

	<screen><prompt>#</prompt> <userinput>minicom -D /dev/ttyACM0</userinput></screen>
    </sect2>

    <sect2>
      <title>Conectando-se às portas seriais do modo de dispositivo USB a partir do Microsoft Windows 10</title>

      <para>Para conectar-se a uma placa configurada para fornecer portas seriais de modo de dispositivo USB, conecte o host USB, como um laptop, às placas USB OTG ou porta de cliente USB. Para abrir uma conexão, você precisará de um programa de terminal serial, como <application>PuTTY</application>. Para verificar o nome da porta COM usada pelo Windows, execute o Gerenciador de dispositivos, expanda. "Ports (COM &amp; LPT)".Você verá um nome semelhante a "USB Serial Device (COM4)". Execute o programa do terminal serial de sua escolha, por exemplo, <application>PuTTY</application>. Na caixa de diálogo <application>PuTTY</application> defina "Connection type" como "Serial", digite o COMx obtido no Gerenciador de Dispositivos na caixa de diálogo "Serial line" e clique em Abrir.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="usb-device-mode-network">

    <title>Interfaces de rede do modo de dispositivo <acronym>USB</acronym></title>

    <para>O suporte a interfaces de rede virtuais é fornecido pelos templates número 1, 8 e 10. Observe que nenhum deles funciona com o Microsoft Windows. Outros sistemas operacionais host funcionam com todos os três modelos. Os módulos de kernel <citerefentry><refentrytitle>usb_template</refentrytitle><manvolnum>4</manvolnum></citerefentry> e <citerefentry><refentrytitle>if_cdce</refentrytitle><manvolnum>4</manvolnum></citerefentry> devem ser carregados.</para>

    <para>Certifique-se de que os módulos necessários estejam carregados e que o template correto esteja configurado na inicialização, adicionando estas linhas ao <filename>/boot/loader.conf</filename>, criando-o se ele ainda não existir:</para>

    <programlisting>if_cdce_load="YES"
hw.usb.template=1</programlisting>

    <para>Para carregar o módulo e definir o modelo sem reiniciar, use:</para>

    <screen><prompt>#</prompt> <userinput>kldload if_cdce</userinput>
<prompt>#</prompt> <userinput>sysctl hw.usb.template=1</userinput></screen>
  </sect1>

  <sect1 xml:id="usb-device-mode-storage">
    <title>Dispositivo de armazenamento virtual <acronym>USB</acronym></title>

    <note>
      <para>O driver <citerefentry><refentrytitle>cfumass</refentrytitle> <manvolnum>4</manvolnum></citerefentry> é um driver de modo de dispositivo <acronym>USB</acronym> disponibilizado pela primeira vez no FreeBSD 12.0.</para>
    </note>

    <para>O target de armazenamento em massa é fornecido pelos templates 0 e 10. Os módulos de kernel <citerefentry><refentrytitle>usb_template</refentrytitle><manvolnum>4</manvolnum></citerefentry> e <citerefentry><refentrytitle>cfumass</refentrytitle><manvolnum>4</manvolnum></citerefentry> devem ser carregados. O <citerefentry><refentrytitle>cfumass</refentrytitle><manvolnum>4</manvolnum></citerefentry> faz interface com o subsistema CTL, o mesmo usado para os targets <acronym>iSCSI</acronym> ou Fibre Channel. No lado do host, os inicializadores do armazenamento em massa <acronym>USB</acronym> só podem acessar um único <acronym>LUN</acronym>, o <acronym>LUN</acronym> 0.</para>

    <sect2>
      <title>Configurando o target de armazenamento em massa USB usando o script de inicialização cfumass</title>

      <para>A maneira mais simples de configurar um target de armazenamento USB somente de leitura é usar o script rc <filename>cfumass</filename>. Para configurá-lo dessa maneira, copie os arquivos a serem apresentados para a máquina host USB no diretório <literal>/var/cfumass</literal> e inclua esta linha no <filename>/etc/rc.conf</filename> :</para>

      <programlisting>cfumass_enable="YES"</programlisting>

      <para>Para fazer valer a configuração sem reiniciar, execute este comando:</para>

      <screen><prompt>#</prompt> <userinput>service cfumass start</userinput></screen>

      <para>Diferentemente da funcionalidade serial e de rede, o modelo não deve ser definido como 0 ou 10 no <filename>/boot/loader.conf</filename>. Isso ocorre porque o LUN deve ser configurado antes de definir o template. O script de inicialização cfumass define o número do modelo correto automaticamente quando iniciado.</para>
    </sect2>
    <sect2>
      <title>Configurando o armazenamento em massa USB usando outros meios</title>

      <para>O restante deste capítulo fornece uma descrição detalhada da configuração do target sem usar o arquivo rc cfumass. Isso é necessário se, por exemplo, alguém quiser fornecer um LUN gravável.</para>

      <para>O armazenamento em massa<acronym>USB</acronym> não exige que o daemon <citerefentry><refentrytitle>ctld</refentrytitle><manvolnum>8</manvolnum></citerefentry> esteja em execução, embora ele possa ser usado se desejado. Isso é diferente do <acronym>iSCSI</acronym>. Portanto, existem duas maneiras de configurar o target: o <citerefentry><refentrytitle>ctladm</refentrytitle><manvolnum>8</manvolnum></citerefentry> ou o <citerefentry><refentrytitle>ctld</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Ambos exigem que o módulo do kernel <filename>cfumass.ko</filename> seja carregado. O módulo pode ser carregado manualmente:</para>

      <screen><prompt>#</prompt> <userinput>kldload cfumass</userinput></screen>

      <para>Se o <filename>cfumass.ko</filename> não foi compilado estaticamente no kernel, o <filename>/boot/loader.conf</filename> pode ser configurado para carregar o módulo na inicialização:</para>

      <programlisting>cfumass_load="YES"</programlisting>

      <para>Um <acronym>LUN</acronym> pode ser criado sem o daemon <citerefentry><refentrytitle>ctld</refentrytitle><manvolnum>8</manvolnum></citerefentry>:</para>

      <screen><prompt>#</prompt> <userinput>ctladm create -b block -o file=/data/target0</userinput></screen>

      <para>Isto apresenta o conteúdo do arquivo de imagem <filename>/data/target0</filename> como um <acronym>LUN</acronym> para o host <acronym>USB</acronym>. O arquivo deve existir antes de executar o comando. Para configurar o <acronym>LUN</acronym> na inicialização do sistema, adicione o comando ao <filename>/etc/rc.local</filename>.</para>

      <para>O <citerefentry><refentrytitle>ctld</refentrytitle><manvolnum>8</manvolnum></citerefentry> também pode ser usado para gerenciar <acronym>LUN</acronym>s. Crie <filename>/etc/ctl.conf</filename>, adicione uma linha ao <filename>/etc/rc.conf</filename> para certificar-se <citerefentry><refentrytitle>ctld</refentrytitle><manvolnum>8</manvolnum></citerefentry> é iniciado automaticamente na inicialização e, em seguida, inicie o daemon.</para>

      <para>Este é um exemplo de um arquivo de configuração <filename>/etc/ctl.conf</filename> simple. Consulte <citerefentry><refentrytitle>ctl.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry> para obter uma descrição mais completa das opções.</para>

      <programlisting>target naa.50015178f369f092 {
	lun 0 {
		path /data/target0
		size 4G
	}
}</programlisting>

      <para>O exemplo cria um único target com um único <acronym>LUN</acronym>. O <literal>naa.50015178f369f092</literal> é um identificador de dispositivo composto por 32 dígitos hexadecimais aleatórios. A linha <literal>path</literal> define o caminho completo para o arquivo ou zvol que suporta o <acronym>LUN</acronym>. Esse arquivo deve existir antes do <citerefentry><refentrytitle>ctld</refentrytitle><manvolnum>8</manvolnum></citerefentry> ser iniciado. A segunda linha é opcional e especifica o tamanho do <acronym>LUN</acronym>.</para>

      <para>Para ter certeza que o daemon <citerefentry><refentrytitle>ctld</refentrytitle><manvolnum>8</manvolnum></citerefentry> foi iniciado na inicialização, adicione esta linha ao <filename>/etc/rc.conf</filename>:</para>

      <programlisting>ctld_enable="YES"</programlisting>

      <para>Para iniciar o <citerefentry><refentrytitle>ctld</refentrytitle><manvolnum>8</manvolnum></citerefentry> agora, execute este comando:</para>

      <screen><prompt>#</prompt> <userinput>service ctld start</userinput></screen>

      <para>Quando o daemon <citerefentry><refentrytitle>ctld</refentrytitle><manvolnum>8</manvolnum></citerefentry> é iniciado, ele lê o <filename>/etc/ctl.conf</filename>. Se esse arquivo for editado depois que o daemon iniciar, recarregue as alterações para que elas entrem em vigor imediatamente:</para>

      <screen><prompt>#</prompt> <userinput>service ctld reload</userinput></screen>
    </sect2>
  </sect1>
</chapter>

  </part>

  <part xml:id="network-communication">
    <title>Comunicação de rede</title>

    <partintro>
      <para>O FreeBSD é um dos sistemas operacionais mais amplamente implantados para servidores de rede de alto desempenho. Os capítulos desta parte cobrem:</para>

      <itemizedlist>
	<listitem>
	  <para>Comunicação Serial</para>
	</listitem>

	<listitem>
	  <para><acronym>PPP</acronym> e <acronym>PPP</acronym> sobre Ethernet</para>
	</listitem>

	<listitem>
	  <para>Correio Eletrônico</para>
	</listitem>

	<listitem>
	  <para>Executando Servidores de Rede</para>
	</listitem>

	<listitem>
	  <para>Firewalls</para>
	</listitem>

	<listitem>
	  <para>Outros tópicos avançados de rede</para>
	</listitem>
      </itemizedlist>

      <para>Esses capítulos são projetados para serem lidos quando a informação for necessária. Eles não precisam ser lidos em qualquer ordem específica, nem é necessário ler todos eles antes de usar o FreeBSD em um ambiente de rede.</para>
    </partintro>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<chapter version="5.0" xml:id="serialcomms">
  <title>Comunicações Seriais</title>

  <sect1 xml:id="serial-synopsis">
    <title>Sinopse</title>

    <indexterm><primary>serial communications</primary></indexterm>

    <para>O <trademark class="registered">UNIX</trademark> sempre teve suporte para comunicação serial, pois as primeiras máquinas <trademark class="registered">UNIX</trademark> dependiam de linhas seriais para entrada e saída do usuário. As coisas mudaram muito desde os dias em que o terminal médio consistia de uma impressora serial de 10 caracteres por segundo e um teclado. Este capítulo aborda algumas das maneiras pelas quais as comunicações seriais podem ser usadas no FreeBSD.</para>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>Como conectar terminais a um sistema FreeBSD.</para>
      </listitem>
      <listitem>
	<para>Como usar um modem para discar para hosts remotos.</para>
      </listitem>
      <listitem>
	<para>Como permitir que usuários remotos efetuem login em um sistema FreeBSD com um modem.</para>
      </listitem>
      <listitem>
	<para>Como inicializar um sistema FreeBSD a partir de uma console serial.</para>
      </listitem>
    </itemizedlist>

    <para>Antes de ler este capítulo, você deve:</para>

    <itemizedlist>
      <listitem>
	<para>Saiba como <link linkend="kernelconfig">configurar e instalar um kernel personalizado</link>.</para>
      </listitem>
      <listitem>
	<para>Entenda <link linkend="basics">permissões e processos do FreeBSD</link>.</para>
      </listitem>
      <listitem>
	<para>Tenha acesso ao manual técnico para o hardware serial a ser usado com o FreeBSD.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="serial">
    <title>Terminologia serial e hardware</title>

    <para>Os termos a seguir são frequentemente usados em comunicações seriais:</para>
    <variablelist>
      <varlistentry>
	<term><acronym>bps</acronym></term>
	<listitem>
	  <para>Bits por Segundo <indexterm><primary>bits-per-second</primary></indexterm> (<acronym>bps</acronym>) é a taxa na qual os dados são transmitidos.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><acronym>DTE</acronym></term>
	<listitem>
	  <para>Equipamento Terminal de Dados <indexterm><primary>DTE</primary></indexterm> (<acronym>DTE</acronym>) é um dos dois terminais em uma comunicação serial. Um exemplo seria um computador.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><acronym>DCE</acronym></term>
	<listitem>
	  <para>Equipamento de Comunicações de Dados <indexterm><primary>DCE</primary></indexterm> (<acronym>DTE</acronym>) é o outro terminal em uma comunicação serial. Normalmente, é um modem ou terminal serial.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><acronym>RS-232</acronym></term>
	<listitem>
	  <para>O padrão original que definiu as comunicações seriais de hardware. Desde então, foi renomeado para <acronym>TIA-232</acronym>.</para>
	</listitem>
      </varlistentry>
    </variablelist>

    <para>Ao se referir a taxas de dados de comunicação, esta seção não usa o termo <firstterm>baud</firstterm>. Baud refere-se ao número de transições de estado elétrico feitas em um período de tempo, enquanto <acronym>bps</acronym> é o termo correto a ser usado.</para>

    <para>Para conectar um terminal serial a um sistema FreeBSD, são necessárias uma porta serial no computador e o cabo adequado para conectar ao dispositivo serial. Os usuários que já estão familiarizados com hardware serial e cabeamento podem pular esta seção com segurança.</para>

    <sect2 xml:id="term-cables-null">
      <title>Cabos Serial e Portas</title>

      <para>Existem vários tipos diferentes de cabos seriais. Os dois tipos mais comuns são cabo null-modem e cabo padrão <acronym>RS-232</acronym>. A documentação do hardware deve descrever o tipo de cabo necessário.</para>

      <para>Estes dois tipos de cabos diferem em como os fios são conectados ao conector. Cada fio representa um sinal, com os sinais definidos resumidos em <xref linkend="serialcomms-signal-names"/>. Um cabo serial padrão passa todos os sinais <acronym>RS-232C</acronym> diretamente. Por exemplo, o pino <quote>Transmitted Data</quote> em uma extremidade do cabo vai para o pino <quote>Transmitted Data</quote> na outra extremidade. Este é o tipo de cabo usado para conectar um modem ao sistema FreeBSD e também é apropriado para alguns terminais.</para>

      <para>Um cabo de modem nulo alterna o pino <quote>Transmitted Data</quote> do conector em uma extremidade com o pino <quote>Received Data</quote> na outra extremidade. O conector pode ser um <acronym>DB-25</acronym> ou um <acronym>DB-9</acronym>.</para>

      <para>Um cabo de modem nulo pode ser construído usando as conexões de pinos resumidas em <xref linkend="nullmodem-db25"/>, <xref linkend="nullmodem-db9"/> e <xref linkend="nullmodem-db9-25"/>. Enquanto o padrão exige um pino direto 1 para fixar uma linha <quote>Protective Ground</quote>, ele é freqüentemente omitido. Alguns terminais funcionam usando apenas os pinos 2, 3 e 7, enquanto outros exigem configurações diferentes. Em caso de dúvida, consulte a documentação do hardware.</para>

      <indexterm><primary>null-modem cable</primary></indexterm>

      <table frame="none" pgwide="1" xml:id="serialcomms-signal-names">
	<title><acronym>RS-232C</acronym> Nomes dos Sinais</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry align="left">Siglas</entry>
	      <entry align="left">Nomes</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><acronym>RD</acronym></entry>
	      <entry>Received Data</entry>
	    </row>

	    <row>
	      <entry><acronym>TD</acronym></entry>
	      <entry>Transmitted Data</entry>
	    </row>

	    <row>
	      <entry><acronym>DTR</acronym></entry>
	      <entry>Data Terminal Ready</entry>
	    </row>

	    <row>
	      <entry><acronym>DSR</acronym></entry>
	      <entry>Data Set Ready</entry>
	    </row>

	    <row>
	      <entry><acronym>DCD</acronym></entry>
	      <entry>Data Carrier Detect</entry>
	    </row>

	    <row>
	      <entry><acronym>SG</acronym></entry>
	      <entry>Signal Ground</entry>
	    </row>

	    <row>
	      <entry><acronym>RTS</acronym></entry>
	      <entry>Request to Send</entry>
	    </row>

	    <row>
	      <entry><acronym>CTS</acronym></entry>
	      <entry>Clear to Send</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <table frame="none" pgwide="1" xml:id="nullmodem-db25">
	<title>Cabo Null-Modem DB-25 para DB-25</title>

	<tgroup cols="5">
	  <thead>
	    <row>
	      <entry align="left">Sinal</entry>
	      <entry align="left">Pin #</entry>
	      <entry/>
	      <entry align="left">Pin #</entry>
	      <entry align="left">Sinal</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry>SG</entry>
	      <entry>7</entry>
	      <entry>conecta-se a</entry>
	      <entry>7</entry>
	      <entry>SG</entry>
	    </row>

	    <row>
	      <entry>TD</entry>
	      <entry>2</entry>
	      <entry>conecta-se a</entry>
	      <entry>3</entry>
	      <entry>RD</entry>
	    </row>

	    <row>
	      <entry>RD</entry>
	      <entry>3</entry>
	      <entry>conecta-se a</entry>
	      <entry>2</entry>
	      <entry>TD</entry>
	    </row>

	    <row>
	      <entry>RTS</entry>
	      <entry>4</entry>
	      <entry>conecta-se a</entry>
	      <entry>5</entry>
	      <entry>CTS</entry>
	    </row>

	    <row>
	      <entry>CTS</entry>
	      <entry>5</entry>
	      <entry>conecta-se a</entry>
	      <entry>4</entry>
	      <entry>RTS</entry>
	    </row>

	    <row>
	      <entry>DTR</entry>
	      <entry>20</entry>
	      <entry>conecta-se a</entry>
	      <entry>6</entry>
	      <entry>DSR</entry>
	    </row>

	    <row>
	      <entry>DTR</entry>
	      <entry>20</entry>
	      <entry>conecta-se a</entry>
	      <entry>8</entry>
	      <entry>DCD</entry>
	    </row>

	    <row>
	      <entry>DSR</entry>
	      <entry>6</entry>
	      <entry>conecta-se a</entry>
	      <entry>20</entry>
	      <entry>DTR</entry>
	    </row>

	    <row>
	      <entry>DCD</entry>
	      <entry>8</entry>
	      <entry>conecta-se a</entry>
	      <entry>20</entry>
	      <entry>DTR</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <table frame="none" pgwide="1" xml:id="nullmodem-db9">
	<title>Cabo DB-9 para DB-9 Null-Modem</title>

	<tgroup cols="5">
	  <thead>
	    <row>
	      <entry align="left">Sinal</entry>
	      <entry align="left">Pin #</entry>
	      <entry/>
	      <entry align="left">Pin #</entry>
	      <entry align="left">Sinal</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry>RD</entry>
	      <entry>2</entry>
	      <entry>conecta-se a</entry>
	      <entry>3</entry>
	      <entry>TD</entry>
	    </row>

	    <row>
	      <entry>TD</entry>
	      <entry>3</entry>
	      <entry>conecta-se a</entry>
	      <entry>2</entry>
	      <entry>RD</entry>
	    </row>

	    <row>
	      <entry>DTR</entry>
	      <entry>4</entry>
	      <entry>conecta-se a</entry>
	      <entry>6</entry>
	      <entry>DSR</entry>
	    </row>

	    <row>
	      <entry>DTR</entry>
	      <entry>4</entry>
	      <entry>conecta-se a</entry>
	      <entry>1</entry>
	      <entry>DCD</entry>
	    </row>

	    <row>
	      <entry>SG</entry>
	      <entry>5</entry>
	      <entry>conecta-se a</entry>
	      <entry>5</entry>
	      <entry>SG</entry>
	    </row>

	    <row>
	      <entry>DSR</entry>
	      <entry>6</entry>
	      <entry>conecta-se a</entry>
	      <entry>4</entry>
	      <entry>DTR</entry>
	    </row>

	    <row>
	      <entry>DCD</entry>
	      <entry>1</entry>
	      <entry>conecta-se a</entry>
	      <entry>4</entry>
	      <entry>DTR</entry>
	    </row>

	    <row>
	      <entry>RTS</entry>
	      <entry>7</entry>
	      <entry>conecta-se a</entry>
	      <entry>8</entry>
	      <entry>CTS</entry>
	    </row>

	    <row>
	      <entry>CTS</entry>
	      <entry>8</entry>
	      <entry>conecta-se a</entry>
	      <entry>7</entry>
	      <entry>RTS</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <table frame="none" pgwide="1" xml:id="nullmodem-db9-25">
	<title>Cabo DB-9 para DB-25 Null-Modem</title>

	<tgroup cols="5">
	  <thead>
	    <row>
	      <entry align="left">Sinal</entry>
	      <entry align="left">Pin #</entry>
	      <entry/>
	      <entry align="left">Pin #</entry>
	      <entry align="left">Sinal</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry>RD</entry>
	      <entry>2</entry>
	      <entry>conecta-se a</entry>
	      <entry>2</entry>
	      <entry>TD</entry>
	    </row>

	    <row>
	      <entry>TD</entry>
	      <entry>3</entry>
	      <entry>conecta-se a</entry>
	      <entry>3</entry>
	      <entry>RD</entry>
	    </row>

	    <row>
	      <entry>DTR</entry>
	      <entry>4</entry>
	      <entry>conecta-se a</entry>
	      <entry>6</entry>
	      <entry>DSR</entry>
	    </row>

	    <row>
	      <entry>DTR</entry>
	      <entry>4</entry>
	      <entry>conecta-se a</entry>
	      <entry>8</entry>
	      <entry>DCD</entry>
	    </row>

	    <row>
	      <entry>SG</entry>
	      <entry>5</entry>
	      <entry>conecta-se a</entry>
	      <entry>7</entry>
	      <entry>SG</entry>
	    </row>

	    <row>
	      <entry>DSR</entry>
	      <entry>6</entry>
	      <entry>conecta-se a</entry>
	      <entry>20</entry>
	      <entry>DTR</entry>
	    </row>

	    <row>
	      <entry>DCD</entry>
	      <entry>1</entry>
	      <entry>conecta-se a</entry>
	      <entry>20</entry>
	      <entry>DTR</entry>
	    </row>

	    <row>
	      <entry>RTS</entry>
	      <entry>7</entry>
	      <entry>conecta-se a</entry>
	      <entry>5</entry>
	      <entry>CTS</entry>
	    </row>

	    <row>
	      <entry>CTS</entry>
	      <entry>8</entry>
	      <entry>conecta-se a</entry>
	      <entry>4</entry>
	      <entry>RTS</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <note>
	<para>Quando um pino em uma extremidade se conecta a um par de pinos na outra extremidade, geralmente é implementado com um fio curto entre o par de pinos em seu conector e um fio longo no outro pino único.</para>
      </note>

      <para>As portas seriais são os dispositivos através dos quais os dados são transferidos entre o computador host do FreeBSD e o terminal. Vários tipos de portas seriais existem. Antes de comprar ou construir um cabo, verifique se ele irá se encaixar nas portas do terminal e no sistema FreeBSD.</para>

      <para>A maioria dos terminais tem portas <acronym>DB-25</acronym>. Os computadores pessoais podem ter portas <acronym>DB-25</acronym> ou <acronym>DB-9</acronym>. Um cartão serial multiportas pode ter portas <acronym>RJ-12</acronym> ou <acronym>RJ-45/</acronym>. Consulte a documentação que acompanha o hardware para especificações sobre o tipo de porta ou verifique visualmente o tipo de porta.</para>

      <para>No FreeBSD, cada porta serial é acessada através de uma entrada em <filename>/dev</filename>. Existem dois tipos diferentes de entradas:</para>

      <itemizedlist>
	<listitem>
	  <para>As portas de chamada são nomeadas <filename>/dev/ttyu<replaceable>N</replaceable></filename> onde <replaceable>N</replaceable> é o número da porta, começando do zero. Se um terminal estiver conectado a primeira porta serial (<filename>COM1</filename>), use <filename>/dev/ttyu0</filename> para se referir ao terminal. Se o terminal estiver na segunda porta serial (<filename>COM2</filename>), use <filename>/dev/ttyu1</filename> e assim por diante. Geralmente, a porta de chamada é usada para terminais. As portas de chamada requerem que a linha serial declare o sinal <quote>Data Carrier Detect</quote> para funcionar corretamente.</para>
	</listitem>

	<listitem>
	  <para>As portas de chamadas de saida são nomeadas <filename>/dev/cuau<replaceable>N</replaceable></filename> nas versões 8.X e superiores do FreeBSD e <filename>/dev/cuad<replaceable>N</replaceable></filename> nas versões 7.X e inferiores do FreeBSD. As portas de chamada de saida geralmente não são usadas para terminais, mas são usadas para modems. A porta de evocação pode ser usada se o cabo serial ou o terminal não suportar o sinal <quote>Data Carrier Detect</quote>.</para>
	</listitem>
      </itemizedlist>

      <para>O FreeBSD também fornece dispositivos de inicialização (<filename>/dev/ttyu<replaceable>N</replaceable>.init</filename> e <filename>/dev/cuau<replaceable>N</replaceable>.init</filename> ou <filename>/dev/cuad<replaceable>N</replaceable>.init</filename>) e dispositivos de bloqueio (<filename>/dev/ttyu<replaceable>N</replaceable>.lock</filename> e <filename>/dev/cuau<replaceable>N</replaceable>.lock</filename> ou <filename>/dev/cuad<replaceable>N</replaceable>.lock</filename>). Os dispositivos de inicialização são utilizados para inicializar os parâmetros da porta de comunicações de cada vez que uma porta é aberta, tal como o <literal>crtscts</literal> para modems que usam <literal>RTS/CTS</literal> sinalização para controle de fluxo. Os dispositivos de bloqueio são usados para bloquear sinalizadores nas portas para impedir que usuários ou programas alterem determinados parâmetros. Consulte <citerefentry><refentrytitle>termios</refentrytitle><manvolnum>4</manvolnum></citerefentry>, <citerefentry><refentrytitle>sio</refentrytitle><manvolnum>4</manvolnum></citerefentry>, e <citerefentry><refentrytitle>stty</refentrytitle><manvolnum>1</manvolnum></citerefentry> para obter informações sobre configurações de terminal, bloqueio e inicialização de dispositivos e configuração de opções de terminal, respectivamente.</para>
    </sect2>

    <sect2 xml:id="serial-hw-config">
      <title>Configuração de Porta Serial</title>

      <para>Por padrão, o FreeBSD suporta quatro portas seriais que são comumente conhecidas como <filename>COM1</filename>, <filename>COM2</filename>, <filename>COM3</filename> e <filename>COM4</filename>. O FreeBSD também suporta placas de interfaces seriais multi-port, como o BocaBoard 1008 e 2016, bem como placas multi-port mais inteligentes, como as feitas pela Digiboard. No entanto, o kernel padrão procura apenas as portas padrão <filename>COM</filename>.</para>

      <para>Para ver se o sistema reconhece as portas seriais, procure por mensagens de inicialização do sistema que começam com <literal>uart</literal>:</para>

      <screen><prompt>#</prompt> <userinput>grep uart /var/run/dmesg.boot</userinput></screen>

      <para>Se o sistema não reconhecer todas as portas seriais necessárias, entradas adicionais podem ser adicionadas ao <filename>/boot/device.hints</filename>. Este arquivo já contém entradas <literal>hint.uart.0.*</literal> para entradas <filename>COM1</filename> e <literal>hint.uart.1.*</literal> para <filename>COM2</filename>. Ao adicionar uma entrada de porta para <filename>COM3</filename> use <literal>0x3E8</literal> e para <filename>COM4</filename> use <literal>0x2E8</literal>. Endereços comuns de <acronym>IRQ</acronym> são <literal>5</literal> para <filename>COM3</filename> e <literal>9</literal> para <filename>COM4</filename>.</para>

      <indexterm><primary><filename>ttyu</filename></primary></indexterm>
      <indexterm><primary><filename>cuau</filename></primary></indexterm>

      <para>Para determinar o conjunto padrão de configurações de terminal <acronym>E/S</acronym> usadas pela porta, especifique o nome do dispositivo. Este exemplo determina as configurações para a porta de chamada em <filename>COM2</filename>:</para>

      <screen><prompt>#</prompt> <userinput>stty -a -f /dev/<replaceable>ttyu1</replaceable></userinput></screen>

      <para>A inicialização de dispositivos seriais em todo o sistema é controlada por <filename>/etc/rc.d/serial</filename>. Este arquivo afeta as configurações padrão dos dispositivos seriais. Para alterar as configurações de um dispositivo, use <command>stty</command>. Por padrão, as configurações alteradas estão em vigor até que o dispositivo seja fechado e, quando o dispositivo for reaberto, volte para o conjunto padrão. Para alterar permanentemente o conjunto padrão, abra e ajuste as configurações do dispositivo de inicialização. Por exemplo, para ativar o modo <option>CLOCAL</option>, comunicação de 8 bits e controle de fluxo <option>XON/XOFF</option> para <filename>ttyu5</filename>, digite:</para>

      <screen><prompt>#</prompt> <userinput>stty -f /dev/ttyu5.init clocal cs8 ixon ixoff</userinput></screen>

      <indexterm><primary>rc files</primary> <secondary><filename>rc.serial</filename></secondary></indexterm>

      <para>Para impedir que determinadas configurações sejam alteradas por um aplicativo, faça ajustes no dispositivo de bloqueio. Por exemplo, para bloquear a velocidade de <filename>ttyu5</filename> para 57600 bps, digite:</para>

      <screen><prompt>#</prompt> <userinput>stty -f /dev/ttyu5.lock 57600</userinput></screen>

      <para>Agora, qualquer aplicativo que abra <filename>ttyu5</filename> e tente alterar a velocidade da porta será bloqueado com 57600 bps.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="term">
    <info>
      <title>Terminais</title>

      <authorgroup>
	<author><personname> <firstname>Sean</firstname> <surname>Kelly</surname> </personname> <contrib>Contributed by </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>terminals</primary></indexterm>

    <para>Os terminais fornecem uma maneira conveniente e barata de acessar um sistema FreeBSD quando não estão no console do computador ou em uma rede conectada. Esta seção descreve como usar terminais com o FreeBSD.</para>

    <para>Os sistemas originais <trademark class="registered">UNIX</trademark> não tinham consoles. Em vez disso, os usuários efetuaram login e executaram programas por meio de terminais conectados as portas seriais do computador.</para>

    <para>A capacidade de estabelecer uma sessão de login em uma porta serial ainda existe em quase todos os sistemas operacionais do tipo <trademark class="registered">UNIX</trademark> hoje, incluindo o FreeBSD. Usando um terminal conectado a uma porta serial não usada, um usuário pode efetuar login e executar qualquer programa de texto que possa ser executado normalmente no console ou em uma janela <command>xterm</command>.</para>

    <para>Muitos terminais podem ser conectados a um sistema FreeBSD. Um computador sobressalente mais antigo pode ser usado como um terminal conectado a um computador mais potente executando o FreeBSD. Isso pode transformar o que poderia ser um computador de usuário único em um poderoso sistema de múltiplos usuários.</para>

    <para>O FreeBSD suporta três tipos de terminais:</para>

    <variablelist>
      <varlistentry>
	<term>Terminais Burros</term>
	<listitem>
	  <para>Terminais burro são um hardware especializado que se conecta a computadores através de linhas seriais. Eles são chamados de <quote>dumb</quote> porque eles possuem apenas poder computacional suficiente para exibir, enviar e receber texto. Nenhum programa pode ser executado nesses dispositivos. Em vez disso, os terminais burros se conectam a um computador que executa os programas necessários.</para>

	  <para>Existem centenas de tipos de terminais burro feitos por muitos fabricantes, e praticamente qualquer tipo funciona com o FreeBSD. Alguns terminais high-end podem até exibir gráficos, mas apenas determinados pacotes de software podem aproveitar esses recursos avançados.</para>

	  <para>Terminais burro são populares em ambientes de trabalho onde os trabalhadores não precisam de acesso a aplicativos gráficos.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Computadores Atuando como Terminais</term>
	<listitem>
	  <para>Como um terminal burro tem capacidade suficiente para exibir, enviar e receber texto, qualquer computador de reserva pode ser um terminal burro. Tudo o que é necessário é o cabo adequado e algum software de <firstterm>terminal emulation</firstterm> para ser executado no computador.</para>

	  <para>Esta configuração pode ser útil. Por exemplo, se um usuário está ocupado trabalhando no console do sistema FreeBSD, outro usuário pode fazer algum trabalho somente de texto ao mesmo tempo de um computador pessoal menos potente ligado como um terminal ao sistema FreeBSD.</para>

	  <para>Existem pelo menos dois utilitários no sistema base do FreeBSD que podem ser usados para trabalhar através de uma conexão serial: <citerefentry><refentrytitle>cu</refentrytitle><manvolnum>1</manvolnum></citerefentry> e <citerefentry><refentrytitle>tip</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</para>

	  <para>Por exemplo, para conectar-se de um sistema cliente que executa o FreeBSD para a conexão serial de outro sistema:</para>

	  <screen><prompt>#</prompt> <userinput>cu -l /dev/cuau<replaceable>N</replaceable></userinput></screen>

	  <para>Portas são numeradas a partir de zero. Isso significa que <filename>COM1</filename> é <filename>/dev/cuau0</filename>.</para>

	  <para>Programas adicionais estão disponíveis através da coleção de ports, como <package>comms/minicom</package>.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Terminais X</term>
	<listitem>
	  <para>Os terminais X são o tipo de terminal mais sofisticado disponível. Em vez de se conectar a uma porta serial, eles geralmente se conectam a uma rede como a Ethernet. Em vez de serem relegados a aplicativos somente de texto, eles podem exibir qualquer aplicativo <application>Xorg</application>.</para>

	  <para>Este capítulo não cobre a configuração ou uso de terminais X.</para>
	</listitem>
      </varlistentry>
    </variablelist>

    <sect2 xml:id="term-config">
      <title>Configuração do Terminal</title>

      <para>Esta seção descreve como configurar um sistema FreeBSD para ativar uma sessão de login em um terminal serial. Assume-se que o sistema reconhece a porta serial a qual o terminal está conectado e que o terminal está conectado com o cabo correto.</para>

      <para>No FreeBSD, o <command>init</command> lê o <filename>/etc/ttys</filename> e inicia um processo <command>getty</command> nos terminais disponíveis. O processo <command>getty</command> é responsável por ler um nome de login e iniciar o programa <command>login</command>. As portas no sistema FreeBSD que permitem logins estão listadas em <filename>/etc/ttys</filename>. Por exemplo, o primeiro console virtual, <filename>ttyv0</filename>, possui uma entrada nesse arquivo, permitindo logins no console. Este arquivo também contém entradas para os outros consoles virtuais, portas seriais e pseudo-ttys. Para um terminal com fio, a entrada <filename>/dev</filename> da porta serial é listada sem a parte <literal>/dev</literal>. Por exemplo, <filename>/dev/ttyv0</filename> está listado como <literal>ttyv0</literal>.</para>

      <para>Por padrão o <filename>/etc/ttys</filename> configura o suporte para as quatro primeiras portas seriais, <filename>ttyu0</filename> até <filename>ttyu3</filename>:</para>

      <programlisting>ttyu0   "/usr/libexec/getty std.9600"   dialup  off secure
ttyu1   "/usr/libexec/getty std.9600"   dialup  off secure
ttyu2   "/usr/libexec/getty std.9600"   dialup  off secure
ttyu3   "/usr/libexec/getty std.9600"   dialup  off secure</programlisting>

      <para>Ao conectar um terminal a uma destas portas, modifique a entrada padrão para definir a velocidade e o tipo de terminal necessários, para ligar o dispositivo <literal>on</literal> e, se necessário, para alterar o <literal>secure</literal> da porta. Se o terminal estiver conectado a outra porta, adicione uma entrada para a porta.</para>

      <para><xref linkend="ex-etc-ttys"/> configura dois terminais em <filename>/etc/ttys</filename>. A primeira entrada configura um Wyse-50 conectado ao <filename>COM2</filename>. A segunda entrada configura um computador antigo executando o software do terminal <application>Procomm</application> emulando um terminal VT-100. O computador está conectado à sexta porta serial em uma placa serial com várias portas.</para>

      <example xml:id="ex-etc-ttys">
	<title>Configurando Entradas de Terminal</title>

	<programlisting>ttyu1<co xml:id="co-ttys-line1col1"/>  "/usr/libexec/getty std.38400"<co xml:id="co-ttys-line1col2"/>  wy50<co xml:id="co-ttys-line1col3"/>  on<co xml:id="co-ttys-line1col4"/>  insecure<co xml:id="co-ttys-line1col5"/>
ttyu5   "/usr/libexec/getty std.19200"  vt100  on insecure</programlisting>

	<calloutlist>
	  <callout arearefs="co-ttys-line1col1">
	    <para>O primeiro campo especifica o nome do dispositivo do terminal serial.</para>
	  </callout>

	  <callout arearefs="co-ttys-line1col2">
	    <para>O segundo campo informa ao <command>getty</command> para inicializar e abrir a linha, definir a velocidade da linha, solicitar um nome de usuário e, em seguida, executar o programa <command>login</command>. O tipo de <firstterm>getty type</firstterm> configura características na linha do terminal, como taxa e paridade <acronym>bps</acronym>. Os tipos de getty disponíveis estão listados em <filename>/etc/gettytab</filename>. Em quase todos os casos, os tipos de getty que começam com <literal>std</literal> funcionarão para terminais conectados, já que essas entradas ignoram a paridade. Há uma entrada <literal>std</literal> para cada taxa de <acronym>bps</acronym> de 110 a 115200. Consulte <citerefentry><refentrytitle>gettytab</refentrytitle><manvolnum>5</manvolnum></citerefentry> para mais informações.</para>

	    <para>Ao definir o tipo de getty, certifique-se de coincidir com as configurações de comunicação usadas pelo terminal. Para este exemplo, o Wyse-50 não usa paridade e se conecta a 38400 bps. O computador não usa paridade e se conecta a 19200 bps.</para>
	  </callout>

	  <callout arearefs="co-ttys-line1col3">
	    <para>O terceiro campo é o tipo de terminal. Para portas dial-up, <literal>unknown</literal> ou <literal>dialup</literal> é normalmente usado, pois os usuários podem discar praticamente com qualquer tipo de terminal ou software. Como o tipo de terminal não muda para terminais com fio, um tipo de terminal real de <filename>/etc/termcap</filename> pode ser especificado. Para este exemplo, o Wyse-50 usa o tipo de terminal real enquanto o computador executando o <application>Procomm</application> está configurado para emular um VT-100.</para>
	  </callout>

	  <callout arearefs="co-ttys-line1col4">
	    <para>O quarto campo especifica se a porta deve estar ativada. Para ativar logins nessa porta, este campo deve ser definido como <literal>on</literal>.</para>
	  </callout>

	  <callout arearefs="co-ttys-line1col5">
	    <para>O campo final é usado para especificar se a porta é segura. Marcar uma porta como <literal>secure</literal> significa que ela é confiável o suficiente para permitir que <systemitem class="username">root</systemitem> faça login a partir dessa porta. As portas inseguras não permitem logins <systemitem class="username">root</systemitem>. Em uma porta insegura, os usuários devem efetuar login de contas não privilegiadas e, em seguida, usar o <command>su</command> ou um mecanismo semelhante para obter privilégios de superusuário, conforme descrito em <xref linkend="users-superuser"/>. Por razões de segurança, recomenda-se alterar esta configuração para <literal>insecure</literal>.</para>
	  </callout>
	</calloutlist>
      </example>

      <para>Depois de fazer qualquer alteração em <filename>/etc/ttys</filename>, envie um sinal SIGHUP (hangup) para o processo <command>init</command> para forçá-lo a reler seu arquivo de configuração:</para>

      <screen><prompt>#</prompt> <userinput>kill -HUP 1</userinput></screen>

      <para>Como o <command>init</command> é sempre o primeiro processo executado em um sistema, ele sempre tem um processo <acronym>ID</acronym> de<literal> 1</literal>.</para>

      <para>Se tudo estiver configurado corretamente, todos os cabos estiverem no lugar e os terminais ligados, um processo <command>getty</command> deverá estar em execução em cada terminal e as solicitações de login deverão estar disponíveis em cada terminal.</para>
    </sect2>

    <sect2 xml:id="term-debug">
      <title>Solução de Problemas da Conexão</title>

      <para>Mesmo com a mais meticulosa atenção aos detalhes, algo poderia dar errado ao configurar um terminal. Aqui está uma lista de sintomas comuns e algumas correções sugeridas.</para>

      <para>Se nenhum prompt de login aparecer, verifique se o terminal está conectado e ligado. Se for um computador pessoal atuando como um terminal, verifique se ele está executando o software de emulação de terminal na porta serial correta.</para>

      <para>Certifique-se de que o cabo esteja conectado firmemente ao terminal e ao computador do FreeBSD. Certifique-se de que é o tipo certo de cabo.</para>

      <para>Certifique-se de que o terminal e o FreeBSD concordem com as configurações de taxa e paridade de <acronym>bps</acronym>. Para um terminal de exibição de vídeo, verifique se os controles de contraste e brilho estão ativados. Se for um terminal de impressão, verifique se o papel e a tinta estão em bom estado.</para>

      <para>Use <command>ps</command> para certificar-se de que um processo <command>getty</command> esteja em execução e atendendo ao terminal. Por exemplo, a listagem a seguir mostra que um <command>getty</command> está sendo executado na segunda porta serial, <filename>ttyu1</filename>, e está usando a entrada <literal>std.38400</literal> em <filename>/etc/gettytab</filename>:</para>

      <screen><prompt>#</prompt> <userinput>ps -axww|grep ttyu</userinput>
22189  d1  Is+    0:00.03 /usr/libexec/getty std.38400 ttyu1</screen>

      <para>Se nenhum processo <command>getty</command> estiver em execução, certifique-se de que a porta esteja ativada em <filename>/etc/ttys</filename>. Lembre-se de executar <command>kill -HUP 1</command> após modificar <filename>/etc/ttys</filename>.</para>

      <para>Se o processo <command>getty</command> estiver em execução, mas o terminal ainda não exibir um prompt de login ou se exibir um prompt, mas não aceitar entrada digitada, o terminal ou cabo poderá não suportar handshaking de hardware. Tente alterar a entrada em <filename>/etc/ttys</filename> de <literal>std.38400</literal> para <literal>3wire.38400</literal> e, em seguida, execute <command>kill -HUP 1</command> depois de modificar o <filename>/etc/ttys</filename>. A entrada <literal>3wire</literal> é semelhante a <literal>std</literal>, mas ignora handshaking de hardware. Pode ser necessário reduzir a taxa de transmissão ou ativar o controle de fluxo de software ao usar <literal>3wire</literal> para evitar buffer overflows.</para>

      <para>Se aparecer lixo em vez de um prompt de login, certifique-se de que o terminal e o FreeBSD concordem com as configurações de taxa e paridade de <acronym>bps</acronym>. Verifique os processos <command>getty</command> para certificar-se de que o tipo correto <replaceable>getty</replaceable> esteja em uso. Se não, edite <filename>/etc/ttys</filename> e execute <command>kill -HUP 1</command>.</para>

      <para>Se os caracteres aparecerem duplicados e a senha aparecer quando digitada, alterne o terminal ou o software de emulação de terminal de <quote>half duplex</quote> ou <quote>local echo</quote> para <quote>full duplex.</quote></para>
    </sect2>
  </sect1>

  <sect1 xml:id="dialup">
    <info>
      <title>Serviço Dial-in</title>

      <authorgroup>
	<author><personname> <firstname>Guy</firstname> <surname>Helmer</surname> </personname> <contrib>Contributed by </contrib></author>
      </authorgroup>

      <authorgroup>
	<author><personname> <firstname>Sean</firstname> <surname>Kelly</surname> </personname> <contrib>Additions by </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>dial-in service</primary></indexterm>

    <para>Configurar um sistema FreeBSD para serviço de discagem é semelhante a configurar terminais, exceto que os modens são usados em vez de dispositivos terminais. O FreeBSD suporta modens externos e internos.</para>

    <para>Os modems externos são mais convenientes, pois geralmente podem ser configurados por meio de parâmetros armazenados em <acronym>RAM</acronym> não voláteis e geralmente fornecem indicadores luminosos que exibem o estado dos sinais <acronym>RS-232</acronym> importantes, indicando se o modem está funcionando corretamente.</para>

    <para>Normalmente, os modems internos não possuem <acronym>RAM</acronym> não volátil, portanto, sua configuração pode ser limitada à configuração de switches <acronym>DIP</acronym>. Se o modem interno tiver luzes indicadoras de sinal, elas serão difíceis de visualizar quando a tampa do sistema estiver no lugar.</para>

    <indexterm><primary>modem</primary></indexterm>

    <para>Ao usar um modem externo, é necessário um cabo adequado. Um cabo serial padrão de <acronym>RS-232C</acronym> deve ser suficiente.</para>

    <para>O FreeBSD precisa dos sinais <acronym>RTS</acronym> e <acronym>CTS</acronym> para controle de fluxo em velocidades acima de 2400 bps, o sinal <acronym>CD</acronym> para detectar quando uma chamada foi atendida ou a linha foi desligada e o sinal <acronym>DTR</acronym> para redefinir o modem após a conclusão de uma sessão. Alguns cabos são conectados sem todos os sinais necessários, portanto, se uma sessão de login não desaparecer quando a linha for desligada, pode haver um problema com o cabo. Consulte <xref linkend="term-cables-null"/> para mais informações sobre esses sinais.</para>

    <para>Como outros sistemas operacionais similares ao <trademark class="registered">UNIX</trademark>-like, o FreeBSD usa os sinais de hardware para descobrir quando uma chamada foi atendida ou uma linha foi desconectada e para desligar e reinicializar o modem após uma chamada. O FreeBSD evita enviar comandos para o modem ou observar relatórios de status do modem.</para>

    <para>O FreeBSD suporta interfaces de comunicação <acronym>NS8250</acronym>, <acronym>NS16450</acronym>, <acronym>NS16550</acronym> e <acronym>NS16550A</acronym> baseado em <acronym>RS-232C</acronym> (<acronym>CCITT</acronym> V.24). Os dispositivos 8250 e 16450 possuem buffers de caractere único. O dispositivo 16550 fornece um buffer de 16 caracteres, o que permite um melhor desempenho do sistema. Bugs em dispositivos simples 16550 impedem o uso do buffer de 16 caracteres, portanto, use dispositivos 16550A, se possível. Como os dispositivos de buffer de caractere único requerem mais trabalho pelo sistema operacional do que os dispositivos de buffer de 16 caracteres, as placas de interface serial baseadas no 16550A são preferidas. Se o sistema tiver muitas portas seriais ativas ou tiver uma carga pesada, as placas baseadas em 16550A são melhores para comunicações com baixa taxa de erro.</para>

    <para>O restante desta seção demonstra como configurar um modem para receber conexões de entrada, como se comunicar com o modem e oferece algumas dicas de solução de problemas.</para>

    <sect2 xml:id="dialup-ttys">
      <title>Configuração de Modem</title>

      <indexterm><primary>getty</primary></indexterm>
      <para>Como nos terminais, o <command>init</command> gera um processo <command>getty</command> para cada porta serial configurada usada para conexões de dial-in. Quando um usuário disca a linha do modem e os modems se conectam, o sinal <quote>Carrier Detect</quote> é informado pelo modem. O kernel percebe que a portadora foi detectada e instrui o <command>getty</command> a abrir a porta e exibir um prompt <prompt>login:</prompt> na velocidade da linha inicial especificada. Em uma configuração típica, se caracteres de lixo forem recebidos, geralmente devido à velocidade de conexão do modem ser diferente da velocidade configurada, o <command>getty</command> tenta ajustar as velocidades de linha até receber caracteres razoáveis. Depois que o usuário digita seu nome de login, o <command>getty</command> executa o <command>login</command>, que conclui o processo de login solicitando a senha do usuário e iniciando o shell do usuário.</para>

      <indexterm><primary><command>/usr/bin/login</command></primary></indexterm>

      <para>Existem duas escolas de pensamento sobre modems dial-up. Um método de configuração é definir os modems e sistemas de modo que, independentemente da velocidade em que um usuário remoto disca, a interface de discagem <acronym>RS-232</acronym> seja executada em uma velocidade travada. O benefício dessa configuração é que o usuário remoto sempre vê um prompt de login do sistema imediatamente. A desvantagem é que o sistema não sabe qual é a verdadeira taxa de dados do usuário, portanto, programas em tela cheia como o <application>Emacs</application> não ajustam seus métodos de tela para melhorar a resposta para conexões mais lentas.</para>

      <para>O segundo método é configurar a interface <acronym>RS-232</acronym> para variar sua velocidade com base na velocidade de conexão do usuário remoto. Como o <command>getty</command> não compreende o relatório de velocidade de conexão de nenhum modem em particular, ele fornece uma mensagem <prompt>login:</prompt> em uma velocidade inicial e observa os caracteres que retornam em resposta. Se o usuário vê lixo, eles devem pressionar <keycap>Enter</keycap> até que um prompt reconhecível seja exibido. Se as taxas de dados não corresponderem, <command>getty</command> verá qualquer coisa que o usuário digita como lixo, e tentará a próxima velocidade e informará novamente o prompt <prompt>login:</prompt>. Esse procedimento normalmente leva apenas um pressionamento de tecla ou dois antes que o usuário veja um bom prompt. Essa seqüência de login não parece tão limpa quanto o método de velocidade travada, mas um usuário em uma conexão de baixa velocidade deve receber uma melhor resposta interativa de programas em tela cheia.</para>

      <para>Ao travar a taxa de comunicação de dados de um modem a uma velocidade específica, nenhuma alteração em <filename>/etc/gettytab</filename> deve ser necessária. No entanto, para uma configuração de velocidade compatível, entradas adicionais podem ser necessárias para definir as velocidades a serem usadas para o modem. Este exemplo configura um modem de 14,4 Kbps com uma velocidade de interface superior de 19,2 Kbps usando conexões de 8 bits sem paridade. Ele configura o <command>getty</command> para iniciar a taxa de comunicação para uma conexão V.32bis a 19,2 Kbps, passando por 9600 bps, 2400 bps, 1200 bps, 300 bps e de volta para 19,2 Kbps. O ciclo de taxa de comunicação é implementado com o recurso <literal>nx=</literal> (proxima tabela). Cada linha usa uma entrada <literal>tc=</literal> (continuação de tabela) para selecionar o restante das configurações para uma taxa de dados específica.</para>

      <programlisting>#
# Additions for a V.32bis Modem
#
um|V300|High Speed Modem at 300,8-bit:\
        :nx=V19200:tc=std.300:
un|V1200|High Speed Modem at 1200,8-bit:\
        :nx=V300:tc=std.1200:
uo|V2400|High Speed Modem at 2400,8-bit:\
        :nx=V1200:tc=std.2400:
up|V9600|High Speed Modem at 9600,8-bit:\
        :nx=V2400:tc=std.9600:
uq|V19200|High Speed Modem at 19200,8-bit:\
        :nx=V9600:tc=std.19200:</programlisting>

      <para>Para um modem de 28,8 Kbps ou para aproveitar a compactação em um modem de 14,4 Kbps, use uma taxa de comunicação mais alta, conforme mostrado neste exemplo:</para>

      <programlisting>#
# Additions for a V.32bis or V.34 Modem
# Starting at 57.6 Kbps
#
vm|VH300|Very High Speed Modem at 300,8-bit:\
        :nx=VH57600:tc=std.300:
vn|VH1200|Very High Speed Modem at 1200,8-bit:\
        :nx=VH300:tc=std.1200:
vo|VH2400|Very High Speed Modem at 2400,8-bit:\
        :nx=VH1200:tc=std.2400:
vp|VH9600|Very High Speed Modem at 9600,8-bit:\
        :nx=VH2400:tc=std.9600:
vq|VH57600|Very High Speed Modem at 57600,8-bit:\
        :nx=VH9600:tc=std.57600:</programlisting>

      <para>Para uma <acronym>CPU</acronym> lenta ou um sistema altamente carregado sem portas seriais baseadas no 16550A, esta configuração pode produzir erros <errorname>sio</errorname> <quote>silo</quote> a 57,6 Kbps.</para>

      <indexterm><primary><filename>/etc/ttys</filename></primary></indexterm>

      <para>A configuração do <filename>/etc/ttys</filename> é similar a <xref linkend="ex-etc-ttys"/>, mas um argumento diferente é passado para o <command>getty</command> e <literal>dialup</literal> é usado para o tipo de terminal. Substitua <replaceable>xxx</replaceable> pelo processo <command>init</command> que será executado no dispositivo:</para>

      <programlisting>ttyu0   "/usr/libexec/getty <replaceable>xxx</replaceable>"   dialup on</programlisting>

      <para>O tipo de terminal <literal>dialup</literal> pode ser alterado. Por exemplo, definir <literal>vt102</literal> como o tipo de terminal padrão permite que os usuários usem a emulação <acronym>VT102</acronym> em seus sistemas remotos.</para>

      <para>Para uma configuração de velocidade travada, especifique a velocidade com um tipo válido listado em <filename>/etc/gettytab</filename>. Este exemplo é para um modem cuja velocidade de porta está travada em 19,2 Kbps:</para>

      <programlisting>ttyu0   "/usr/libexec/getty std.<replaceable>19200</replaceable>"   dialup on</programlisting>

      <para>Em uma configuração de velocidade correspondente, a entrada precisa referenciar a entrada inicial apropriada <quote>auto-baud</quote> em <filename>/etc/gettytab</filename>. Para continuar o exemplo de um modem com velocidade correspondente que começa em 19,2 Kbps, use esta entrada:</para>

      <programlisting>ttyu0   "/usr/libexec/getty V19200"   dialup on</programlisting>

      <para>Depois de editar o <filename>/etc/ttys</filename>, espere até que o modem esteja devidamente configurado e conectado antes de sinalizar o <command>init</command>:</para>

      <screen><prompt>#</prompt> <userinput>kill -HUP 1</userinput></screen>

      <indexterm><primary>rc files</primary> <secondary><filename>rc.serial</filename></secondary></indexterm>

      <para>Modems de alta velocidade, como os modems <acronym>V.32</acronym>, <acronym>V.32bis</acronym> e <acronym>V.34</acronym>, usam hardware (<literal>RTS/CTS</literal>) para controle de fluxo. Use o <command>stty</command> para definir a flag de controle de fluxo de hardware para a porta do modem. Este exemplo define a flag <varname>crtscts</varname> na inicialização dos dispositivos <filename>COM2</filename> de dial-in e de dial-out:</para>

      <screen><prompt>#</prompt> <userinput>stty -f /dev/ttyu1.init crtscts</userinput>
<prompt>#</prompt> <userinput>stty -f /dev/cuau1.init crtscts</userinput></screen>
    </sect2>

<!--
Comment out for now. If this is still needed, the example should
either be updated or the section modified to be more generic
e.g. refer to the modem's manual
    <sect2>
      <title>Modem Settings</title>

      <para>For a modem whose parameters may be permanently set in
	non-volatile RAM, a terminal program such as
	<command>tip</command> can be used to set the parameters.
	Connect to the modem using the same communications speed as
	the initial speed <command>getty</command> will use and
	configure the modem's non-volatile RAM to match these
	requirements:</para>

      <itemizedlist>
	<listitem>
	  <para><acronym>CD</acronym> asserted when connected.</para>
	</listitem>

	<listitem>
	  <para><acronym>DTR</acronym> asserted for operation and
	    dropping DTR hangs up the line and resets the
	    modem.</para>
	</listitem>

	<listitem>
	  <para><acronym>CTS</acronym> transmitted data flow
	    control.</para>
	</listitem>

	<listitem>
	  <para>Disable <acronym>XON/XOFF</acronym> flow
	    control.</para>
	</listitem>

	<listitem>
	  <para><acronym>RTS</acronym> received data flow
	    control.</para>
	</listitem>

	<listitem>
	  <para>Quiet mode (no result codes).</para>
	</listitem>

	<listitem>
	  <para>No command echo.</para>
	</listitem>
      </itemizedlist>

      <para>Read the documentation for the modem to find out
	which commands and/or DIP switch settings are needed.</para>

      <para>For example, to set the above parameters on a &usrobotics;
	&sportster; 14,400 external modem, give these commands to
	the modem:</para>

      <programlisting>ATZ
AT&amp;C1&amp;D2&amp;H1&amp;I0&amp;R2&amp;W</programlisting>

      <para>Other settings can be adjusted in the modem, such as
	whether it will use V.42bis and/or MNP5 compression.</para>

      <para>The &usrobotics; &sportster; 14,400 external modem also
	has some DIP switches that need to be set.  Other modems,
	may need these settings:</para>

      <itemizedlist>
	<listitem>
	  <para>Switch 1: UP &mdash; DTR Normal</para>
	</listitem>

	<listitem>
	  <para>Switch 2: N/A (Verbal Result Codes/Numeric Result
	    Codes)</para>
	</listitem>

	<listitem>
	  <para>Switch 3: UP &mdash; Suppress Result Codes</para>
	</listitem>

	<listitem>
	  <para>Switch 4: DOWN &mdash; No echo, offline
	    commands</para>
	</listitem>

	<listitem>
	  <para>Switch 5: UP &mdash; Auto Answer</para>
	</listitem>

	<listitem>
	  <para>Switch 6: UP &mdash; Carrier Detect Normal</para>
	</listitem>

	<listitem>
	  <para>Switch 7: UP &mdash; Load NVRAM Defaults</para>
	</listitem>

	<listitem>
	  <para>Switch 8: N/A (Smart Mode/Dumb Mode)</para>
	</listitem>
      </itemizedlist>

      <para>Result codes should be disabled/suppressed for dial-up
	modems to avoid problems that can occur if
	<command>getty</command> mistakenly gives a
	<prompt>login:</prompt> prompt to a modem that is in command
	mode and the modem echoes the command or returns a result
	code.  This sequence can result in an extended, silly
	conversation between <command>getty</command> and the
	modem.</para>

      <para>For a locked-speed configuration, configure the modem to
	maintain a constant modem-to-computer data rate independent
	of the communications rate.  On a &usrobotics; &sportster;
	14,400 external modem, these commands will lock the
	modem-to-computer data rate at the speed used to issue the
	commands:</para>

      <programlisting>ATZ
AT&amp;B1&amp;W</programlisting>

      <para>For a variable-speed configuration, configure the modem
	to adjust its serial port data rate to match the incoming
	call rate.  On a &usrobotics; &sportster; 14,400 external
	modem, these commands will lock the modem's error-corrected
	data rate to the speed used to issue the commands, while
	allowing the serial port rate to vary for
	non-error-corrected connections:</para>

      <programlisting>ATZ
AT&amp;B2&amp;W</programlisting>

      <para>Most high-speed modems provide commands to view the
	modem's current operating parameters in a somewhat
	human-readable fashion.  On the &usrobotics; &sportster;
	14,400 external modem, <command>ATI5</command> displays the
	settings that are stored in the non-volatile RAM.  To see the
	true operating parameters of the modem, as influenced by the
	modem's DIP switch settings, use <command>ATZ</command> and
	then <command>ATI4</command>.</para>

      <para>For a different brand of modem, check the modem's manual
	to see how to double-check the modem's configuration
	parameters.</para>
    </sect2>
    -->

    <sect2>
      <title>Solução de problemas</title>

      <para>Esta seção fornece algumas dicas para solucionar problemas de um modem dial-up que não se conecta há um sistema FreeBSD.</para>

      <para>Conecte o modem ao sistema FreeBSD e inicialize o sistema. Se o modem tiver luzes de indicação de status, observe se o indicador <acronym>DTR</acronym> do modem acende quando o prompt <prompt>login:</prompt> é exibido no console do sistema. Se acender, isso deve significar que o FreeBSD iniciou um processo <command>getty</command> na porta de comunicação apropriada e está aguardando o modem aceitar uma chamada.</para>

      <para>Se o indicador <acronym>DTR</acronym> não acender, faça o login no sistema FreeBSD através do console e digite <command>ps ax</command> para ver se o FreeBSD está executando um processo <command>getty</command> na porta correta:</para>

      <screen>  114 ??  I      0:00.10 /usr/libexec/getty V19200 <replaceable>ttyu0</replaceable></screen>

      <para>Se a segunda coluna contiver um <literal>d0</literal> em vez de um <literal>??</literal> e o modem ainda não aceitou uma chamada, isso significa que o <command>getty</command> completou sua chamada na porta de comunicações. Isso pode indicar um problema com o cabeamento ou com um modem configurado incorretamente porque o <command>getty</command> não deve conseguir abrir a porta de comunicação até que o sinal de detecção da portadora tenha sido declarado pelo modem.</para>

      <para>Se nenhum processo <command>getty</command> estiver aguardando para abrir a porta, verifique se a entrada da porta está correta no <filename>/etc/ttys</filename>. Além disso, verifique o <filename>/var/log/messages</filename> para ver se há alguma mensagem de log do <command>init</command> ou do <command>getty</command>.</para>

      <para>Em seguida, tente discar para o sistema. Certifique-se de usar 8 bits, sem paridade e 1 bit de stop no sistema remoto. Se um prompt não aparecer imediatamente ou o prompt mostrar lixo, tente pressionar <keycap>Enter</keycap> uma vez por segundo durante alguns segundos. Se ainda não houver nenhum prompt de <prompt>login:</prompt>, tente enviar um <command>BREAK</command>. Ao usar um modem de alta velocidade, tente discar novamente após travar a velocidade da interface do modem de discagem.</para>

      <para>Se ainda não houver o prompt <prompt>login:</prompt>, verifique novamente o <filename>/etc/gettytab</filename> e faça um double-check:</para>

      <itemizedlist>
	<listitem>
	  <para>O nome do recurso inicial especificado na entrada em <filename>/etc/ttys</filename> corresponde ao nome de um recurso em <filename>/etc/gettytab</filename>.</para>
	</listitem>

	<listitem>
	  <para>Cada entrada <literal>nx=</literal> corresponde a outro nome de recurso <filename>gettytab</filename>.</para>
	</listitem>

	<listitem>
	  <para>Cada entrada <literal>tc=</literal> corresponde a outro nome de recurso <filename>gettytab</filename>.</para>
	</listitem>
      </itemizedlist>

      <para>Se o modem no sistema FreeBSD não responder, verifique se o modem está configurado para atender o telefone quando o <acronym>DTR</acronym> é ativado. Se o modem parece estar configurado corretamente, verifique se a linha <acronym>DTR</acronym> é ativada, verificando as luzes indicadoras do modem.</para>

      <para>Se ainda assim não funcionar, tente enviar um e-mail para a <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions">lista de discussão de perguntas gerais do FreeBSD</link> descrevendo o modem e o problema.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="dialout">
    <title>Serviço de Dial-in</title>

    <indexterm><primary>dial-out service</primary></indexterm>

    <para>A seguir, dicas para fazer com que o host conecte-se através do modem a outro computador. Isto é apropriado para estabelecer uma sessão de terminal com um host remoto.</para>

    <para>Esse tipo de conexão pode ser útil para obter um arquivo na Internet, caso haja problemas no uso do PPP. Se o PPP não estiver funcionando, use a sessão do terminal para enviar por FTP o arquivo necessário. Em seguida, use o zmodem para transferi-lo para a máquina.</para>

    <sect2 xml:id="hayes-unsupported">
      <title>Usando um Modem Stock Hayes</title>

      <para>Um dialer Hayes genérico está incorporado no <command>tip</command>. Use <literal>at=hayes</literal> em <filename>/etc/remote</filename>.</para>

      <para>O driver Hayes não é inteligente o suficiente para reconhecer alguns dos recursos avançados de mensagens de modems mais recentes como <literal>BUSY</literal>, <literal>NO DIALTONE</literal> ou <literal>CONNECT 115200</literal>. Desative essas mensagens ao usar o <command>tip</command> com o <command>ATX0&amp;W</command>.</para>

      <para>O tempo limite de discagem para o <command>tip</command> é de 60 segundos. O modem deve usar algo menor, ou então o <command>tip</command> irá achar que existe um problema de comunicação. Tente usar  <command>ATS7=45&amp;W</command>.</para>
    </sect2>

    <sect2 xml:id="direct-at">
      <title>Usando comandos <literal>AT</literal></title>

      <indexterm><primary><filename>/etc/remote</filename></primary></indexterm>
      <para>Crie uma entrada <quote>direct</quote> em <filename>/etc/remote</filename>. Por exemplo, se o modem estiver conectado à primeira porta serial, <filename>/dev/cuau0</filename>, use a seguinte linha:</para>

      <programlisting>cuau0:dv=/dev/cuau0:br#19200:pa=none</programlisting>

      <para>Use a taxa mais alta de <acronym>bps</acronym> que o modem suporta no recurso <literal>br</literal>. Em seguida, digite <command>tip cuau0</command> para conectar-se ao modem.</para>

      <para>Ou use <command>cu</command> como <systemitem class="username">root</systemitem> com o seguinte comando:</para>

      <screen><prompt>#</prompt> <userinput>cu -l<replaceable>line</replaceable> -s<replaceable>speed</replaceable></userinput></screen>

      <para><replaceable>line</replaceable> é a porta serial, tal como <filename>/dev/cuau0</filename>, e <replaceable>speed</replaceable> é a velocidade, tal como <literal>57600</literal> . Quando terminar de digitar os comandos AT, digite<command>~.</command> para sair.</para>
    </sect2>

    <sect2 xml:id="gt-failure">
      <title>O Sinal <literal>@</literal> Não Funciona</title>

      <para>O <literal>@</literal> na capability do número de telefone diz ao <command>tip</command> para procurar em  <filename>/etc/phones</filename> um número de telefone. Mas, o sinal. <literal>@</literal> também é um caractere especial em arquivos de capablity como o <filename>/etc/remote</filename>, então ele precisa ser escapado com uma barra invertida:</para>

      <programlisting>pn=\@</programlisting>
    </sect2>

    <sect2 xml:id="dial-command-line">
      <title>Discando a Partir da Linha de Comando</title>

      <para>Coloque uma entrada <quote>genérica</quote> em <filename>/etc/remote</filename>. Por exemplo:</para>

      <programlisting>tip115200|Dial any phone number at 115200 bps:\
        :dv=/dev/cuau0:br#115200:at=hayes:pa=none:du:
tip57600|Dial any phone number at 57600 bps:\
        :dv=/dev/cuau0:br#57600:at=hayes:pa=none:du:</programlisting>

      <para>Isto deve funcionar agora:</para>

      <screen><prompt>#</prompt> <userinput>tip -115200 5551234</userinput></screen>

      <para>Usuários que preferem comando <command>cu</command> ao <command>tip</command>, podem usar uma entrada <literal>cu</literal> genérica:</para>

      <programlisting>cu115200|Use cu to dial any number at 115200bps:\
        :dv=/dev/cuau1:br#57600:at=hayes:pa=none:du:</programlisting>

      <para>e digite:</para>

      <screen><prompt>#</prompt> <userinput>cu 5551234 -s 115200</userinput></screen>
    </sect2>

    <sect2 xml:id="set-bps">
      <title>Definindo a Taxa de <acronym>bps</acronym></title>

      <para>Coloque uma entrada para <literal>tip1200</literal> ou <literal>cu1200</literal>, mas vá em frente e use qualquer taxa <acronym>bps</acronym> apropriada com o capability <literal>br</literal>. O <command>tip</command> acha que um bom padrão é de 1200 bps, e é por isso que ele procura por uma entrada <literal>tip1200</literal>. No entanto, 1200 bps não precisa ser usado.</para>
    </sect2>

    <sect2 xml:id="terminal-server">
      <title>Acessando um Conjunto de Hosts por Meio de um Servidor de Terminal</title>

      <para>Em vez de esperar até conectar-se e digitar <command>CONNECT<replaceable>host</replaceable></command> a cada vez, use o recurso <literal>cm</literal> do <command>tip</command>. Por exemplo, estas entradas no <filename>/etc/remote</filename> permitirão que você digite <command>tip pain</command> ou <command>tip muffin</command> para conectar-se aos hosts <systemitem>pain</systemitem> ou <systemitem>muffin</systemitem> e <command>tip deep13</command> para conectar ao servidor de terminal.</para>

      <programlisting>pain|pain.deep13.com|Forrester's machine:\
        :cm=CONNECT pain\n:tc=deep13:
muffin|muffin.deep13.com|Frank's machine:\
        :cm=CONNECT muffin\n:tc=deep13:
deep13:Gizmonics Institute terminal server:\
        :dv=/dev/cuau2:br#38400:at=hayes:du:pa=none:pn=5551234:</programlisting>

    </sect2>

    <sect2 xml:id="tip-multiline">
      <title>Usando Mais de Uma Linha com <command>tip</command></title>

      <para>Isto geralmente é um problema em que uma universidade tem várias linhas de modems e vários milhares de estudantes tentando usá-las.</para>

      <para>Faça uma entrada em <filename>/etc/remote</filename> e use <literal>@</literal> para o recurso <literal>pn</literal>:</para>

      <programlisting>big-university:\
        :pn=\@:tc=dialout
dialout:\
        :dv=/dev/cuau3:br#9600:at=courier:du:pa=none:</programlisting>

      <para>Em seguida, liste os números de telefone em <filename>/etc/phones</filename>:</para>

      <programlisting>big-university 5551111
big-university 5551112
big-university 5551113
big-university 5551114</programlisting>

      <para>O <command>tip</command> tentará cada número na ordem listada, depois desistirá. Para continuar tentando, execute o <command>tip</command> em um loop <literal>while</literal>.</para>
    </sect2>

    <sect2 xml:id="multi-controlp">
      <title>Usando o Caractere de Force</title>

      <para>O <keycombo action="simul"> <keycap>Ctrl</keycap> <keycap>P</keycap> </keycombo> é o caracter <quote>force</quote> padrão, usado para dizer ao <command>tip</command> que o próximo caractere é um dado literal. O caractere force pode ser definido para qualquer outro caractere com o escape <command>~s</command>, o que significa <quote>definir uma variável.</quote></para>

      <para>Digite <command>~sforce=<replaceable>single-char</replaceable> </command> seguido por uma nova linha. Onde <replaceable>single-char</replaceable> é qualquer caractere único. Se o <replaceable>single-char</replaceable> for omitido, o caractere force será o caractere nulo, que é acessado digitando-se <keycombo action="simul"> <keycap>Ctrl</keycap> <keycap>2</keycap> </keycombo> ou <keycombo action="simul"> <keycap>Ctrl</keycap> <keycap>Espace</keycap> </keycombo>. Um valor muito bom para <replaceable>single-char</replaceable> é o <keycombo action="simul"> <keycap>Shift</keycap> <keycap>Ctrl</keycap> <keycap>6</keycap> </keycombo>, que é usado apenas em alguns servidores de terminal.</para>

      <para>Para alterar o caractere force, especifique o seguinte em <filename>~/.tiprc</filename>:</para>

      <programlisting>force=<replaceable>single-char</replaceable></programlisting>
    </sect2>

    <sect2 xml:id="uppercase">
      <title>Caracteres Maiúsculos</title>

      <para>Isso acontece quando o <keycombo action="simul"> <keycap>Ctrl</keycap> <keycap>A</keycap> </keycombo> é pressionado, o qual corresponde ao  <command>tip</command> <quote>raise character</quote>, especialmente concebido para pessoas coma tecla de caps-lock quebrada. Use <command>~s</command> para definir <literal>raisechar</literal> para algo razoável. Ele pode ser configurado para ser o mesmo que o caractere de force, se nenhum recurso for usado.</para>

      <para>Aqui está um exemplo do <filename>~/.tiprc</filename> para os usuários do <application>Emacs</application> que precisam digitar <keycombo action="simul"> <keycap>Ctrl</keycap> <keycap>2</keycap> </keycombo> e <keycombo action="simul"> <keycap>Ctrl</keycap> <keycap>A</keycap> </keycombo>:</para>

    <programlisting>force=^^
raisechar=^^</programlisting>

      <para>O <literal>^^</literal> é <keycombo action="simul"> <keycap>Shift</keycap><keycap>Ctrl</keycap><keycap>6</keycap> </keycombo>.</para>

    </sect2>

    <sect2 xml:id="tip-filetransfer">
      <title>Transferências de Arquivos com <command>tip</command></title>

      <para>Ao falar com outro sistema operacional semelhante ao <trademark class="registered">UNIX</trademark>, os arquivos podem ser enviados e recebidos usando <command>~p</command> (put) e <command>~t</command> (take). Esses comandos executam <command>cat</command> e <command>echo</command> no sistema remoto para aceitar e enviar arquivos. A sintaxe é:</para>

      <cmdsynopsis><command>~p</command> <arg choice="plain">local-file</arg> <arg choice="opt">remote-file</arg></cmdsynopsis>

      <cmdsynopsis><command>~t</command> <arg choice="plain">remote-file</arg> <arg choice="opt">local-file</arg></cmdsynopsis>

      <para>Não há verificação de erros, então outro protocolo, como zmodem, provavelmente deveria ser usado.</para>
    </sect2>

    <sect2 xml:id="zmodem-tip">
      <title>Usando o <application>zmodem</application> com o <command>tip</command>?</title>

      <para>Para receber arquivos, inicie o programa de envio no terminal remoto. Em seguida, digite <command>~C rz</command> para começar a recebê-los localmente.</para>

      <para>Para enviar arquivos, inicie o programa de recebimento no terminal remoto. Em seguida, digite <command>~C sz <replaceable>files</replaceable></command> para enviá-los ao sistema remoto.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="serialconsole-setup">
    <info>
      <title>Configurando o Console Serial</title>

      <authorgroup>
	<author><personname> <firstname>Kazutaka</firstname> <surname>YOKOTA</surname> </personname> <contrib>Contributed by </contrib></author>
      </authorgroup>

      <authorgroup>
	<author><personname> <firstname>Bill</firstname> <surname>Paul</surname> </personname> <contrib>Based on a document by </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>console serial</primary></indexterm>

    <para>O FreeBSD tem a capacidade de inicializar um sistema com um terminal burro em uma porta serial como um console. Esta configuração é útil para administradores de sistemas que desejam instalar o FreeBSD em máquinas que não possuem teclado ou monitor conectados, e desenvolvedores que desejam depurar o kernel ou drivers de dispositivos.</para>

    <para>Como descrito em <xref linkend="boot"/>, o FreeBSD emprega um bootstrap de três estágios. Os dois primeiros estágios estão no código do bloco de inicialização que é armazenado no início da slice do FreeBSD no disco de inicialização. O bloco de inicialização, em seguida, carrega e executa o carregador de boot como o código do terceiro estágio.</para>

    <para>Para configurar a inicialização a partir de um console serial, o código do bloco de inicialização, o código do carregador de inicialização e o kernel precisam ser configurados.</para>

    <sect2 xml:id="serialconsole-howto-fast">
      <title>Configuração Rápida do Console Serial</title>

      <para>Esta seção fornece uma visão geral rápida da configuração do console serial. Este procedimento pode ser usado quando o terminal burro é conectado ao <filename>COM1</filename>.</para>

      <procedure>
	<title>Configurando um Console Serial no <filename>COM1</filename></title>

	<step>
	  <para>Conecte o cabo serial ao <filename>COM1</filename> e ao terminal de controle.</para>
	</step>

	<step>
	  <para>Para configurar mensagens de inicialização para exibição no console serial, emita o seguinte comando como o superusuário:</para>

	  <screen><prompt>#</prompt> echo 'console="comconsole"' &gt;&gt; /boot/loader.conf</screen>
	</step>

	<step>
	  <para>Edite <filename>/etc/ttys</filename> e mude <literal>off</literal> para <literal>on</literal> e <literal>dialup</literal> para <literal>vt100</literal> para a entrada <filename>ttyu0</filename>. Caso contrário, uma senha não será necessária para conectar-se através do console serial, resultando em uma potencial brecha de segurança.</para>
	</step>

	<step>
	  <para>Reinicialize o sistema para ver se as alterações entraram em vigor.</para>
	</step>

      </procedure>

      <para>Se uma configuração diferente for necessária, consulte a próxima seção para obter uma explicação de configuração mais detalhada.</para>
    </sect2>

    <sect2 xml:id="serialconsole-howto">
      <title>Configuração do console serial em profundidade</title>

      <para>Esta seção fornece uma explicação mais detalhada das etapas necessárias para configurar um console serial no FreeBSD.</para>

      <procedure>
	<title>Configurando um Console Serial</title>

	<step>
	  <para>Prepare um cabo serial.</para>

	  <indexterm><primary>null-modem cable</primary></indexterm>

	  <para>Use um cabo de null-modem ou um cabo serial padrão e um adaptador de null-modem. Veja <xref linkend="term-cables-null"/> para uma discussão sobre cabos seriais.</para>
	</step>

	<step>
	  <para>Desconecte o teclado.</para>

	  <para>Muitos sistemas detectam o teclado durante o Power-On Self-Test (<acronym>POST</acronym>) e geram um erro se o teclado não for detectado. Algumas máquinas recusarão a inicialização até que o teclado esteja conectado.</para>

	  <para>Se o computador reclamar do erro, mas inicializar de qualquer maneira, nenhuma outra configuração será necessária.</para>

	  <para>Se o computador se recusar a inicializar sem um teclado conectado, configure o <acronym>BIOS</acronym> para que ele ignore este erro. Consulte o manual da placa-mãe para obter detalhes sobre como fazer isso.</para>

	  <tip>
	    <para>Tente configurar o teclado para <quote>Not installed</quote> no <acronym>BIOS</acronym>. Esta configuração diz ao <acronym>BIOS</acronym> para não detectar um teclado ao ligar, então ele não deve reclamar se o teclado estiver ausente. Se essa opção não estiver presente no <acronym>BIOS</acronym>, procure uma opção <quote>Halt on Error</quote>. Configurando isto para <quote>All but Keyboard</quote> ou para <quote>No Errors</quote> terá o mesmo efeito.</para>
	  </tip>

	  <para>Se o sistema tiver um mouse <trademark class="registered">PS/2</trademark>, desconecte-o também. Os mouses <trademark class="registered">PS/2</trademark> compartilham algum hardware com o teclado e, deixar o mouse conectado, pode enganar o sistema e faze-lo pensar que o teclado ainda está lá.</para>

	  <note>
	    <para>Embora a maioria dos sistemas inicialize sem um teclado, alguns não inicializarão sem um adaptador gráfico. Alguns sistemas podem ser configurados para inicializar sem nenhum adaptador gráfico alterando a configuração do <quote>graphics adapter</quote> na configuração <acronym>BIOS</acronym> para <quote>Not installed</quote>. Outros sistemas não suportam esta opção e recusarão a inicialização se não houver hardware de exibição no sistema. Com estas máquinas, deixe algum tipo de placa gráfica ligada, mesmo que seja apenas uma placa mono lixo. Um monitor não precisa ser conectado.</para>
	  </note>
	</step>

	<step>
	  <para>Conecte um terminal burro, um computador antigo com um programa de modem ou a porta serial de outra máquina <trademark class="registered">UNIX</trademark> na porta serial da máquina  freebsd.</para>
	</step>

	<step>
	  <para>Adicione as entradas <literal>hint.sio.*</literal> apropriadas para o <filename>/boot/device.hints</filename> para a porta serial. Algumas placas com várias portas também exigem opções de configuração do kernel. Consulte <citerefentry><refentrytitle>sio</refentrytitle><manvolnum>4</manvolnum></citerefentry> para obter as opções necessárias e os device hints para cada porta serial suportada.</para>
	</step>

	<step>
	  <para>Crie o <filename>boot.config</filename> no diretório raiz da partição <literal>a</literal> na unidade de inicialização.</para>

	  <para>Este arquivo instrui o código do bloco de inicialização como inicializar o sistema. Para ativar o console serial, uma ou mais das seguintes opções são necessárias. Ao usar várias opções, inclua todas elas na mesma linha:</para>

	  <variablelist>
	    <varlistentry>
	      <term><option>-h</option></term>

	      <listitem>
		<para>Alterna entre os consoles interno e serial. Use isso para alternar dispositivos do console. Por exemplo, para inicializar a partir do console (vídeo) interno, use <option>-h</option> para direcionar o carregador de boot e o kernel para usar a porta serial como seu dispositivo de console. Alternativamente, para inicializar a partir da porta serial, use <option>-h</option> para dizer ao gerenciador de inicialização e ao kernel para usar a exibição de vídeo como o console.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term><option>-D</option></term>

	      <listitem>
		<para>Alterna entre as configurações de console única e dupla. Na configuração única, o console será o console interno (exibição de vídeo) ou a porta serial, dependendo do estado de <option>-h</option>. Na configuração do console duplo, a exibição de vídeo e a porta serial se tornarão o console ao mesmo tempo, independentemente do estado de <option>-h</option>. No entanto, a configuração do console duplo entrará em vigor somente enquanto o bloco de inicialização estiver em execução. Depois que o gerenciador de boot obtiver controle, o console especificado por <option>-h</option> se tornará o único console.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term><option>-P</option></term>

	      <listitem>
		<para>Faz com que o bloco de inicialização avalie o teclado. Se nenhum teclado for encontrado, as opções <option>-D</option> e <option>-h</option> serão automaticamente definidas.</para>

		<note>
		  <para>Devido a restrições de espaço na versão atual dos blocos de inicialização, <option>-P</option> é capaz de detectar somente teclados estendidos. Teclados com menos de 101 teclas e sem as teclas F11 e F12 podem não ser detectados. Teclados em alguns laptops podem não ser encontrados corretamente devido a essa limitação. Se este for o caso, não use <option>-P</option>.</para>
		</note>
	      </listitem>
	    </varlistentry>
	  </variablelist>

	  <para>Use <option>-P</option> para selecionar o console automaticamente ou <option>-h</option> para ativar o console serial. Consulte <citerefentry> <refentrytitle>boot</refentrytitle> <manvolnum>8</manvolnum> </citerefentry> e <citerefentry> <refentrytitle>boot.config</refentrytitle><manvolnum>5</manvolnum> </citerefentry> para maiores detalhes.</para>

	  <para>As opções, exceto para <option>-P</option>, são passadas para o carregador de boot. O gerenciador de boot determinará se o vídeo interno ou a porta serial deve se tornar o console examinando o estado de <option>-h</option>. Isto significa que se <option>-D</option> for especificado mas <option>-h</option> não estiver especificado no <filename>/boot.config</filename>, a porta serial pode ser usada como console somente durante o bloco de inicialização, pois o gerenciador de inicialização usará a exibição de vídeo interna como o console.</para>
	</step>

	<step>
	  <para>Inicialize a máquina.</para>

	  <para>Quando o FreeBSD inicia, os blocos de inicialização mostram o conteúdo do <filename>/boot.config</filename> para o console. Por exemplo:</para>

	  <screen>/boot.config: -P
Keyboard: no</screen>

	  <para>A segunda linha aparece somente se <option>-P</option> aparecer no <filename>/boot.config</filename> e indica a presença ou ausência do teclado. Estas mensagens vão para o console serial ou interno, ou ambos, dependendo da opção em <filename>/boot.config</filename>:</para>

	  <informaltable frame="none" pgwide="1">
	    <tgroup cols="2">
	      <thead>
		<row>
		  <entry align="left">Opções</entry>
		  <entry align="left">Mensagem vai para</entry>
		</row>
	      </thead>

	      <tbody>
		<row>
		  <entry>nenhum</entry>
		  <entry>console interno</entry>
		</row>

		<row>
		  <entry><option>-h</option></entry>
		  <entry>console serial</entry>
		</row>

		<row>
		  <entry><option>-D</option></entry>
		  <entry>consoles seriais e internos</entry>
		</row>

		<row>
		  <entry><option>-Dh</option></entry>
		  <entry>consoles seriais e internos</entry>
		</row>

		<row>
		  <entry><option>-P</option>, teclado presente</entry>
		  <entry>console interno</entry>
		</row>

		<row>
		  <entry><option>-P</option>, teclado ausente</entry>
		  <entry>console serial</entry>
		</row>
	      </tbody>
	    </tgroup>
	  </informaltable>

	  <para>Após a mensagem, haverá uma pequena pausa antes que os blocos de inicialização continuem carregando o carregador de boot e antes que qualquer outra mensagem seja impressa no console. Em circunstâncias normais, não há necessidade de interromper os blocos de inicialização, mas pode-se fazê-lo para garantir que as coisas sejam configuradas corretamente.</para>

	  <para>Pressione qualquer tecla, exceto <keycap>Enter</keycap>, no console para interromper o processo de inicialização. Os blocos de inicialização então solicitarão mais ações:</para>

	  <screen>&gt;&gt; FreeBSD/i386 BOOT
Default: 0:ad(0,a)/boot/loader
boot:</screen>

	  <para>Verifique se a mensagem acima aparece no console serial ou interno, ou em<filename>/boot.config</filename>. Se a mensagem aparecer no console correto, pressione <keycap>Enter</keycap> para continuar o processo de inicialização.</para>

	  <para>Se não houver nenhum prompt no terminal serial, algo está errado com as configurações. Digite <option>-h</option> e depois <keycap>Enter</keycap> ou <keycap>Return</keycap> para informar o bloco de inicialização (e depois o carregador de inicialização e o kernel) para escolher a porta serial para o console. Quando o sistema estiver ativo, volte e verifique o que deu errado.</para>
	</step>
      </procedure>

      <para>Durante o terceiro estágio do processo de inicialização, ainda é possível alternar entre o console interno e o console serial definindo as variáveis de ambiente apropriadas no carregador de inicialização. Veja <citerefentry> <refentrytitle>loader</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter maiores informações.</para>

      <note>
	<para>Esta linha no <filename>/boot/loader.conf</filename> ou <filename>/boot/loader.conf.local</filename> configura o carregador de inicialização e o kernel para enviar suas mensagens de inicialização para o console serial, independentemente das opções no <filename>/boot.config</filename>:</para>

	<programlisting>console="comconsole"</programlisting>

	<para>Esta linha deve ser a primeira linha do <filename>/boot/loader.conf</filename> para que as mensagens de boot sejam exibidas no console serial o mais cedo possível.</para>

	<para>Se essa linha não existir, ou se estiver definida como <literal>console="vidconsole"</literal>, o carregador de inicialização e o kernel usarão qualquer console indicado por <option>-h</option> no bloco de inicialização. Veja <citerefentry> <refentrytitle>loader.conf</refentrytitle><manvolnum>5 </manvolnum></citerefentry> para maiores informações.</para>

	<para>No momento, o carregador de boot não tem nenhuma opção equivalente a <option>-P</option> no bloco de inicialização, e não há provisão para selecionar automaticamente o console interno e o console serial com base na presença do teclado.</para>
      </note>

      <tip>
	<para>Embora não seja obrigatório, é possível fornecer um prompt <command>login</command> na linha serial. Para configurar isto, edite a entrada para a porta serial em <filename>/etc/ttys</filename> usando as instruções em <xref linkend="term-config"/>. Se a velocidade da porta serial tiver sido alterada, altere <literal>std.9600</literal> para corresponder à nova configuração.</para>
      </tip>
    </sect2>

    <sect2>
      <title>Defina uma velocidade de porta serial mais rápida</title>

      <para>Por padrão, as configurações da porta serial são 9600 baud, 8 bits, sem paridade e 1 bit de parada. Para alterar a velocidade do console padrão, use uma das seguintes opções:</para>

      <itemizedlist>
	<listitem>
	  <para>Edite o <filename>/etc/make.conf</filename> e configure o <varname>BOOT_COMCONSOLE_SPEED</varname> para a nova velocidade do console. Em seguida, recompile e instale os blocos de inicialização e o carregador de boot:</para>

	  <screen><prompt>#</prompt> <userinput>cd /sys/boot</userinput>
<prompt>#</prompt> <userinput>make clean</userinput>
<prompt>#</prompt> <userinput>make</userinput>
<prompt>#</prompt> <userinput>make install</userinput></screen>

	  <para>Se o console serial estiver configurado de alguma outra maneira que não seja inicializando com <option>-h</option>, ou se o console serial usado pelo kernel for diferente daquele usado pelos blocos de inicialização, adicione a seguinte opção, com a velocidade desejada, em um arquivo de configuração de kernel personalizado e compile um novo kernel:</para>

	  <programlisting>options CONSPEED=<replaceable>19200</replaceable></programlisting>
	</listitem>

	<listitem>
	  <para>Acrescente a opção de inicialização <option>-S<replaceable>19200</replaceable></option> ao <filename>/boot.config</filename>, substituindo <replaceable>19200</replaceable> pela velocidade a ser utilizada.</para>
	</listitem>

	<listitem>
	  <para>Adicione as seguintes opções ao <filename>/boot/loader.conf</filename>. Substitua <replaceable>115200</replaceable> pela velocidade de uso.</para>

	  <programlisting>boot_multicons="YES"
boot_serial="YES"
comconsole_speed="<replaceable>115200</replaceable>"
console="comconsole,vidconsole"</programlisting>
	</listitem>
      </itemizedlist>
    </sect2>

    <sect2 xml:id="serialconsole-ddb">
      <title>Entrando no Depurador DDB da Linha Serial</title>

      <para>Para configurar a capacidade de inserir o depurador de kernel no console serial, inclua as seguintes opções em um arquivo de configuração de kernel personalizado e compile o kernel usando as instruções em <xref linkend="kernelconfig"/>. Observe que, embora isso seja útil para diagnósticos remotos, também é perigoso se um BREAK espúrio for gerado na porta serial. Consulte <citerefentry><refentrytitle>ddb</refentrytitle> <manvolnum>4</manvolnum></citerefentry> e <citerefentry> <refentrytitle>ddb</refentrytitle><manvolnum>8</manvolnum></citerefentry> para mais informações sobre o depurador do kernel.</para>

      <programlisting>options BREAK_TO_DEBUGGER
options DDB</programlisting>
    </sect2>
  </sect1>
</chapter>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<chapter version="5.0" xml:id="ppp-and-slip">
  <!--
  <chapterinfo>
    <authorgroup>
      <author>
	<firstname>Jim</firstname>
	<surname>Mock</surname>
	<contrib>Restructured, reorganized, and updated by in Mar 2000</contrib>
      </author>
    </authorgroup>
  </chapterinfo>
  -->

  <title><acronym>PPP</acronym></title>

  <sect1 xml:id="ppp-and-slip-synopsis">
    <title>Sinopse</title>

    <indexterm xml:id="ppp-ppp"><primary><acronym>PPP</acronym></primary></indexterm>

    <para>O FreeBSD suporta o protocolo Point-to-Point (<acronym>PPP</acronym>) que pode ser usado para estabelecer uma conexão de rede ou Internet usando um modem dial-up. Este capítulo descreve como configurar serviços de comunicação baseados em modem no FreeBSD.</para>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>Como configurar, usar e solucionar problemas de uma conexão <acronym>PPP</acronym>.</para>
      </listitem>
      <listitem>
	<para>Como configurar o <acronym>PPP</acronym> sobre Ethernet (<acronym>PPPoE</acronym>).</para>
      </listitem>
      <listitem>
	<para>Como configurar o <acronym>PPP</acronym> sobre <acronym>ATM</acronym> (<acronym>PPPoA</acronym>).</para>
      </listitem>
    </itemizedlist>

    <indexterm><primary><acronym>PPP</acronym></primary></indexterm>
    <indexterm><primary><acronym>PPP</acronym></primary> <secondary>over Ethernet</secondary></indexterm>

    <para>Antes de ler este capítulo, você deve:</para>

    <itemizedlist>
      <listitem>
	<para>Estar familiarizado com a terminologia básica de rede.</para>
      </listitem>
      <listitem>
	<para>Entender os conceitos básicos e o propósito de uma conexão dial-up e <acronym>PPP</acronym>.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="userppp">
    <!--
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Tom</firstname>
	  <surname>Rhodes</surname>
	  <contrib>Updated and enhanced by </contrib>
	</author>
      </authorgroup>
      <authorgroup>
	<author>
	  <firstname>Brian</firstname>
	  <surname>Somers</surname>
	  <contrib>Originally contributed by </contrib>
	</author>
      </authorgroup>
      <authorgroup>
	<author>
	  <firstname>Nik</firstname>
	  <surname>Clayton</surname>
	  <contrib>With input from </contrib>
	</author>
	<author>
	  <firstname>Dirk</firstname>
	  <surname>Fr&ouml;mberg</surname>
	</author>
	<author>
	  <firstname>Peter</firstname>
	  <surname>Childs</surname>
	</author>
      </authorgroup>
    </sect1info>
    -->

    <title>Configurando o <acronym>PPP</acronym></title>

    <para>O FreeBSD fornece suporte nativo para gerenciamento conexões dial-up <acronym>PPP</acronym> usando <citerefentry><refentrytitle>ppp</refentrytitle><manvolnum>8</manvolnum></citerefentry>. O kernel padrão do FreeBSD fornece suporte para o <filename>tun</filename>, que é usado para interagir com um hardware de modem. A configuração é executada editando pelo menos um arquivo de configuração, e exemplos destes arquivos de configuração são fornecidos com o sistema. Finalmente, o <command>ppp</command> é usado para iniciar e gerenciar conexões.</para>

    <para>Para usar uma conexão <acronym>PPP</acronym>, os seguintes itens são necessários:</para>

    <itemizedlist>
      <listitem>
	<para>Uma conta dial-up com um provedor de serviços de Internet (<acronym>ISP</acronym>).</para>
      </listitem>

      <listitem>
	<para>Um modem dial-up.</para>
      </listitem>

      <listitem>
	<para>O número de discagem para o <acronym>ISP</acronym>.</para>
      </listitem>

      <listitem>
	<para>O nome de usuário e a senha atribuídos pelo <acronym>ISP</acronym>.</para>
      </listitem>

      <listitem>
	<para>O endereço <acronym>IP</acronym> de um ou mais servidores de <acronym>DNS</acronym>. Normalmente, o <acronym>ISP</acronym> fornece estes endereços. Caso contrário, o FreeBSD pode ser configurado para usar a negociação de <acronym>DNS</acronym>.</para>
      </listitem>
    </itemizedlist>

    <para>Se alguma das informações necessárias estiver faltando, entre em contato com o <acronym>ISP</acronym>.</para>

    <para>As seguintes informações podem ser fornecidas pelo <acronym>ISP</acronym>, mas não são necessárias:</para>

    <itemizedlist>
      <listitem>
	<para>O endereço <acronym>IP</acronym> do gateway padrão. Se esta informação for desconhecida, o <acronym>ISP</acronym> fornecerá automaticamente o valor correto durante a configuração da conexão. Ao configurar o <acronym>PPP</acronym> no FreeBSD, este endereço é chamado de <literal>HISADDR</literal>.</para>
      </listitem>

      <listitem>
	<para>A máscara de sub-rede. Se o <acronym>ISP</acronym> não tiver fornecido um, <systemitem class="netmask">255.255.255.255</systemitem> será usado no arquivo de configuração do <citerefentry><refentrytitle>ppp</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
      </listitem>

      <listitem>
	<indexterm xml:id="ppp-static-ip"><primary>static <acronym>IP</acronym> address</primary></indexterm>

	<para>Se o <acronym>ISP</acronym> tiver atribuído um endereço <acronym>IP</acronym> estático e um nome de host, ele deverá ser inserido no arquivo de configuração. Caso contrário, essas informações serão fornecidas automaticamente durante a configuração da conexão.</para>
      </listitem>
    </itemizedlist>

    <para>O restante desta seção demonstra como configurar o FreeBSD para cenários de conexão <acronym>PPP</acronym> comuns. O arquivo de configuração requerido é o <filename>/etc/ppp/ppp.conf</filename> e arquivos de exemplos adicionais estão disponíveis em <filename>/usr/share/examples/ppp/</filename>.</para>

    <note>
      <para>Ao longo desta seção, muitos dos exemplos de arquivos exibem números de linha. Esses números de linha foram adicionados para facilitar o acompanhamento da discussão e não devem ser colocados no arquivo real.</para>

      <para>Ao editar um arquivo de configuração, o recuo adequado é importante. Linhas que terminam em um <literal>:</literal> iniciam na primeira coluna (início da linha) enquanto todas as outras linhas devem ser recuadas como mostrado usando espaços ou tabulações.</para>
    </note>

    <sect2 xml:id="userppp-staticIP">
      <title>Configuração básica</title>

      <indexterm><primary>PPP</primary> <secondary>with static <acronym>IP</acronym> addresses</secondary></indexterm>

      <para>Para configurar uma conexão <acronym>PPP</acronym>, primeiro edite o <filename>/etc/ppp/ppp.conf</filename> com as informações de discagem do <acronym>ISP</acronym>. Este arquivo é descrito da seguinte maneira:</para>

      <programlisting>1     default:
2       set log Phase Chat LCP IPCP CCP tun command
3       ident user-ppp VERSION
4       set device /dev/cuau0
5       set speed 115200
6       set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \
7                 \"\" AT OK-AT-OK ATE1Q0 OK \\dATDT\\T TIMEOUT 40 CONNECT"
8       set timeout 180
9       enable dns
10
11    provider:
12      set phone "(123) 456 7890"
13      set authname foo
14      set authkey bar
15      set timeout 300
16      set ifaddr <replaceable>x.x.x.x</replaceable>/0 <replaceable>y.y.y.y</replaceable>/0 255.255.255.255 0.0.0.0
17      add default HISADDR</programlisting>

	  <variablelist>
	    <varlistentry>
	      <term>Linha 1:</term>

	      <listitem>
		<para>Identifica a entrada <literal>default</literal>. Os comandos nesta entrada (linhas 2 a 9) são executados automaticamente quando o <command>ppp</command> é executado.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 2:</term>

	      <listitem>
		<para>Ativa os parâmetros de log detalhado para testar a conexão. Uma vez que a configuração esteja funcionando satisfatoriamente, esta linha deve ser reduzida para:</para>

		  <programlisting>set log phase tun</programlisting>

	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 3:</term>

	      <listitem>
		<para>Exibe a versão do <citerefentry><refentrytitle>ppp</refentrytitle><manvolnum>8</manvolnum></citerefentry> para o software <acronym>PPP</acronym> em execução no outro lado da conexão.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 4:</term>

	      <listitem>
		<para>Identifica o dispositivo ao qual o modem está conectado, onde <filename>COM1</filename> é <filename>/dev/cuau0</filename> e <filename>COM2</filename> é <filename>/dev/cuau1</filename>.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 5:</term>

	      <listitem>
		<para>Define a velocidade de conexão. Se <literal>115200</literal> não funcionar em um modem mais antigo, tente <literal>38400</literal> em seu lugar.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linhas 6 &amp; 7:</term>

	      <listitem>
		<para>A string de discagem escrita como na sintaxe de envio e espera. Consulte <citerefentry><refentrytitle>chat</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter maiores informações.</para>

		<para>Observe que esse comando continua na próxima linha para facilitar a leitura. Qualquer comando no <filename>ppp.conf</filename> pode fazer isso se o último caractere na linha for <literal>\</literal>.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 8:</term>

	      <listitem>
		<para>Define o tempo ocioso limite do link em segundos.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 9:</term>

	      <listitem>
		<para>Instrui o peer para confirmar as configurações de <acronym>DNS</acronym>. Se a rede local estiver executando seu próprio servidor <acronym>DNS</acronym>, essa linha deve ser comentada, adicionando um <literal>#</literal> no início da linha ou removendo-a.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 10:</term>

	      <listitem>
		<para>Uma linha em branco para facilitar a leitura. Linhas em branco são ignoradas pelo <citerefentry><refentrytitle>ppp</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 11:</term>

	      <listitem>
		<para>Identifica uma entrada chamada <literal>provider</literal>. Isto pode ser alterado para o nome do <acronym>ISP</acronym>, para que <option>load <replaceable>ISP</replaceable></option> possa ser usado para iniciar a conexão.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 12:</term>

	      <listitem>
		<para>Use o número de telefone para o <acronym>ISP</acronym>. Vários números de telefone podem ser especificados usando os dois-pontos (<literal>:</literal>) ou o caractere pipe (<literal>|</literal>) como um separador. Para rotacionar entre os números, use dois pontos. Para sempre tentar discar o primeiro número primeiro e usar os outros números apenas se o primeiro número falhar, use o caractere pipe. Sempre coloque todo o conjunto de números de telefone entre aspas (<literal>"</literal>) para evitar falhas de discagem.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linhas 13 &amp; 14:</term>

	      <listitem>
		<para>Use o nome de usuário e senha para o <acronym>ISP</acronym>.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 15:</term>

	      <listitem>
		<para>Define o tempo ocioso limite padrão em segundos para a conexão. Neste exemplo, a conexão será fechada automaticamente após 300 segundos de inatividade. Para evitar um tempo limite, defina esse valor como zero.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 16:</term>
	      <listitem>
		<para>Define os endereços da interface. Os valores usados dependem de se um endereço <acronym>IP</acronym> estático foi obtido do <acronym>ISP</acronym> ou se ele negocia um endereço <acronym>IP</acronym> dinâmico durante a conexão.</para>

		<para>Se o <acronym>ISP</acronym> tiver alocado um endereço <acronym>IP</acronym> estático e um gateway padrão, substitua <replaceable>xxxx</replaceable> pelo endereço <acronym>IP</acronym> estático e substitua <replaceable>yyyy</replaceable> com o endereço <acronym>IP</acronym> do gateway padrão. Se o <acronym>ISP</acronym> tiver fornecido apenas um endereço <acronym>IP</acronym> estático sem um endereço de gateway, substitua <replaceable> yyyy </replaceable> por <systemitem class="netmask">10.0.0.2/0</systemitem>.</para>

		<para>Se o endereço <acronym>IP</acronym> mudar sempre que uma conexão for feita, altere essa linha para o seguinte valor. Isso diz ao <citerefentry><refentrytitle>ppp</refentrytitle><manvolnum>8</manvolnum></citerefentry>para usar o <acronym>IP</acronym> Configuration Protocol (<acronym>IPCP</acronym>) para negociar um endereço <acronym>IP</acronym> dinâmico:</para>

	  <programlisting>set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.255 0.0.0.0</programlisting>

	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 17:</term>

	      <listitem>
		<para>Mantenha esta linha como está, pois ela adiciona uma rota padrão ao gateway. O <literal>HISADDR</literal> será automaticamente substituído pelo endereço do gateway especificado na linha 16. É importante que esta linha apareça depois da linha 16.</para>
	      </listitem>
	    </varlistentry>
	  </variablelist>

	  <para>Dependendo se o <citerefentry><refentrytitle>ppp</refentrytitle><manvolnum>8</manvolnum></citerefentry> for iniciado manualmente ou automaticamente, um arquivo <filename>/etc/ppp/ppp.linkup</filename> também pode precisar ser criado, contendo as seguintes linhas. Este arquivo é requerido ao executar o <command>ppp</command> no modo <option>-auto</option>. Este arquivo é usado após a conexão ter sido estabelecida. Neste ponto, o endereço <acronym>IP</acronym> será atribuído e agora será possível adicionar as entradas da tabela de roteamento. Ao criar este arquivo, certifique-se de que o <replaceable>provider</replaceable> corresponda ao valor demonstrado na linha 11 do <filename>ppp.conf</filename>.</para>

	  <programlisting>provider:
      add default HISADDR</programlisting>

	<para>Este arquivo também é necessário quando o endereço do gateway padrão é <quote>adivinhado</quote> em uma configuração de endereço <acronym>IP</acronym> estático. Neste caso, remova a linha 17 do <filename>ppp.conf</filename> e crie o <filename>/etc/ppp/ppp.linkup</filename> com as duas linhas acima. Outros  exemplos para este arquivo podem ser encontrados em <filename>/usr/share/examples/ppp/</filename>.</para>

	<para>Por padrão, o <command>ppp</command> deve ser executado como <systemitem class="username">root</systemitem>. Para alterar esse padrão, adicione a conta do usuário que deve executar o <command>ppp</command> ao grupo <systemitem class="groupname">network</systemitem> em <filename>/etc/group</filename> .</para>

	<para>Em seguida, conceda ao usuário acesso a uma ou mais entradas em <filename>/etc/ppp/ppp.conf</filename> com <command>allow</command>. Por exemplo, para dar a permissão para os usuários <systemitem class="username">fred</systemitem> e <systemitem class="username">mary</systemitem> somente à entrada <literal>provider:</literal>, inclua esta linha para a seção <literal>provider:</literal>:</para>

	<programlisting>allow users <replaceable>fred mary</replaceable></programlisting>

	<para>Para fornecer aos usuários especificados acesso a todas as entradas, coloque essa linha na seção <literal>default</literal>.</para>
      </sect2>

    <?ignore <sect2>
	  <title>Receiving Incoming Calls</title>

	  <indexterm>
	    <primary><acronym>PPP</acronym></primary>
	    <secondary>receiving incoming calls</secondary>
	  </indexterm>

	  <para>When configuring &man.ppp.8; to receive incoming calls
	    on a machine connected to a Local Area Network
	    (<acronym>LAN</acronym>), decide if packets should be
	    forwarded to the <acronym>LAN</acronym>.  If so, allocate
	    the connecting system an <acronym>IP</acronym> address
	    from the <acronym>LAN</acronym>'s subnet, and add the
	    <command>enable proxy</command> line to
	    <filename>/etc/ppp/ppp.conf</filename>.
	    Also, confirm that <filename>/etc/rc.conf</filename>
	    contains the following line:</para>

	  <programlisting>gateway_enable="YES"</programlisting>

	  <para>Refer to &man.ppp.8; and
	    <filename>/usr/share/examples/ppp/ppp.conf.sample</filename>
	    for more details.  The following steps will also be
	    required:</para>

	  <procedure>
	    <step>
	      <para>Create an entry in
		<filename>/etc/passwd</filename> (using the
		&man.vipw.8; program).</para>
	    </step>

	    <step>
	      <para>Create a profile in this users home directory that
		runs <command>ppp -direct direct-server</command> or
		similar.</para>
	    </step>

	    <step>
	      <para>Create an entry in
		<filename>/etc/ppp/ppp.conf</filename>.  The
		<filename>direct-server</filename> example should
		suffice.</para>
	    </step>

	    <step>
	      <para>Create an entry in
		<filename>/etc/ppp/ppp.linkup</filename>.</para>
	    </step>
	  </procedure>
	</sect2>

	  <title><acronym>PPP</acronym> Shells for Dynamic
	    <acronym>IP</acronym> Users</title>

	  <indexterm>
	    <primary><acronym>PPP</acronym> shells</primary>
	  </indexterm>

	  <para>Create a file called
	    <filename>/etc/ppp/ppp-shell</filename> containing the
	    following:</para>

	  <programlisting>#!/bin/sh
IDENT=`echo $0 | sed -e 's/^.*-\(.*\)$/\1/'`
CALLEDAS="$IDENT"
TTY=`tty`

if [ x$IDENT = xdialup ]; then
        IDENT=`basename $TTY`
fi

echo "PPP for $CALLEDAS on $TTY"
echo "Starting PPP for $IDENT"

exec /usr/sbin/ppp -direct $IDENT</programlisting>

	  <para>This script should be executable.  Now make a
	    symbolic link called <filename>ppp-dialup</filename> to
	    this script using the following commands:</para>

	  <screen>&prompt.root; <userinput>ln -s ppp-shell /etc/ppp/ppp-dialup</userinput></screen>

	  <para>Use this script as the
	    <emphasis>shell</emphasis> for all of dial-up users.  This
	    is an example from <filename>/etc/passwd</filename> for a
	    dial-up <acronym>PPP</acronym>:</para>

	    <programlisting>pchilds:*:1011:300:Peter Childs PPP:/home/ppp:/etc/ppp/ppp-dialup</programlisting>

	    <para>Create a <filename
		>/home/ppp</filename> directory that
	      is world readable containing the following 0 byte
	      files:</para>

	    <screen>-r--r--r--   1 root     wheel           0 May 27 02:23 .hushlogin
-r--r--r--   1 root     wheel           0 May 27 02:22 .rhosts</screen>

	    <para>which prevents <filename>/etc/motd</filename> from
	      being displayed.</para>
	  </sect2>
	  <sect2>
	    <title><acronym>PPP</acronym> Shells for Static
	      <acronym>IP</acronym> Users</title>

	    <indexterm>
	      <primary><acronym>PPP</acronym> shells</primary>
	    </indexterm>

	    <para>Create <filename>ppp-shell</filename> as
	      above, and for each account with statically assigned
	      <acronym>IP</acronym>s create a symbolic link to
	      <filename>ppp-shell</filename>.</para>

	    <para>For example, to route /24 CIDR networks for the
	      dial-up customers <username>fred</username>,
	      <username>sam</username>, and
	      <username>mary</username>, type:</para>

	    <screen>&prompt.root; <userinput>ln -s /etc/ppp/ppp-shell /etc/ppp/ppp-fred</userinput>
&prompt.root; <userinput>ln -s /etc/ppp/ppp-shell /etc/ppp/ppp-sam</userinput>
&prompt.root; <userinput>ln -s /etc/ppp/ppp-shell /etc/ppp/ppp-mary</userinput></screen>

	    <para>Each of these users dial-up accounts should have
	      their shell set to the symbolic link created above (for
	      example, <username>mary</username>'s shell should be
	      <filename>/etc/ppp/ppp-mary</filename>).</para>
	  </sect2>

	  <sect2>
	    <title>Setting Up <filename>ppp.conf</filename> for
	      Dynamic <acronym>IP</acronym> Users</title>

	    <para>Ensure that <filename>/etc/ppp/ppp.conf</filename>
	      contains something along the lines of:</para>

	    <programlisting>default:
  set debug phase lcp chat
  set timeout 0

ttyu0:
  set ifaddr 203.14.100.1 203.14.100.20 255.255.255.255
  enable proxy

ttyu1:
  set ifaddr 203.14.100.1 203.14.100.21 255.255.255.255
  enable proxy</programlisting>

	    <note>
	      <para>The indenting is important.</para>
	    </note>

	    <para>The <literal>default:</literal> section is loaded
	      for each session.  For each dial-up line enabled in
	      <filename>/etc/ttys</filename> create an entry similar
	      to the one for <literal>ttyu0:</literal> above.  Each
	      line should get a unique <acronym>IP</acronym> address
	      from the pool of <acronym>IP</acronym> addresses for
	      dynamic users.</para>
	  </sect2>

	  <sect2>
	    <title>Setting Up <filename>ppp.conf</filename> for
	      Static <acronym>IP</acronym> Users</title>

	    <para>Along with the contents of the sample
	      <filename>/usr/share/examples/ppp/ppp.conf</filename>
	      above, add a section for each of the statically assigned
	      dial-up users:.</para>

	    <programlisting>fred:
  set ifaddr 203.14.100.1 203.14.101.1 255.255.255.255

sam:
  set ifaddr 203.14.100.1 203.14.102.1 255.255.255.255

mary:
  set ifaddr 203.14.100.1 203.14.103.1 255.255.255.255</programlisting>

	    <para>The file <filename>/etc/ppp/ppp.linkup</filename>
	      should also contain routing information for each static
	      <acronym>IP</acronym> user if required.  The line below
	      would add a route for the <hostid
		role="ipaddr">203.14.101.0/24</hostid> network via the
	      client's ppp link.</para>

	    <programlisting>fred:
  add 203.14.101.0 netmask 255.255.255.0 HISADDR

sam:
  add 203.14.102.0 netmask 255.255.255.0 HISADDR

mary:
  add 203.14.103.0 netmask 255.255.255.0 HISADDR</programlisting>
	</sect2>
	?>

	<sect2>
	  <title>Configuração Avançada</title>

	  <indexterm><primary>DNS</primary></indexterm>

	  <indexterm><primary>NetBIOS</primary></indexterm>

	  <indexterm><primary><acronym>PPP</acronym></primary> <secondary>Microsoft extensions</secondary></indexterm>

	  <para>É possível configurar o PPP para fornecer endereços de servidores DNS e NetBIOS sob demanda.</para>

	  <para>Para habilitar estas extensões com o <acronym>PPP</acronym> versão 1.x, as seguintes linhas podem ser adicionadas à seção relevante do <filename>/etc/ppp/ppp.conf</filename>.</para>

	  <programlisting>enable msext
set ns 203.14.100.1 203.14.100.2
set nbns 203.14.100.5</programlisting>

	  <para>E para o <acronym>PPP</acronym> versão 2 e acima:</para>

	  <programlisting>accept dns
set dns 203.14.100.1 203.14.100.2
set nbns 203.14.100.5</programlisting>

	  <para>Isso informará aos clientes os endereços do servidor de nomes primário e secundário e um host do servidor de nomes NetBIOS.</para>

	  <para>Na versão 2 e acima, se a linha <literal>set dns</literal> for omitida, o <acronym>PPP</acronym> usará os valores encontrados em <filename>/etc/resolv.conf</filename>.</para>

	<sect3 xml:id="userppp-PAPnCHAP">
	  <title>Autenticação PAP e CHAP</title>

	  <indexterm><primary>PAP</primary></indexterm>
	  <indexterm><primary>CHAP</primary></indexterm>
	  <para>Alguns <acronym>ISP</acronym>s configuram seu sistema para que a parte de autenticação da conexão seja feita usando um dos mecanismos de autenticação PAP ou CHAP. Se este for o caso, o <acronym>ISP</acronym> não exibirá um prompt <prompt>login:</prompt> na conexão, mas começará a falar <acronym>PPP</acronym> imediatamente.</para>

	  <para>O PAP é menos seguro que o CHAP, mas a segurança normalmente não é um problema aqui, pois as senhas, embora sejam enviadas como texto simples com o PAP, estão sendo transmitidas apenas por uma linha serial. Não há muito espaço para crackers <quote>escutarem</quote>.</para>

	  <para>As seguintes alterações devem ser feitas:</para>

	  <programlisting>13      set authname <replaceable>MyUserName</replaceable>
14      set authkey <replaceable>MyPassword</replaceable>
15      set login</programlisting>

	  <variablelist>
	    <varlistentry>
	      <term>Linha 13:</term>

	      <listitem>
		<para>Esta linha especifica o nome de usuário do PAP/CHAP. Insira o valor correto para <replaceable>MyUserName</replaceable>.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 14:</term>
	      <listitem>
		<para>Esta linha especifica a senha PAP/CHAP <indexterm><primary>password</primary></indexterm>. Insira o valor correto para <replaceable>MyPassword</replaceable>. Você pode querer adicionar uma linha adicional, como:</para>

		<programlisting>16      accept PAP</programlisting>

		<para>ou</para>

		<programlisting>16      accept CHAP</programlisting>

		<para>para tornar óbvio que essa é a intenção, mas o PAP e o CHAP são aceitos por padrão.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 15:</term>

	      <listitem>
		<para>O <acronym>ISP</acronym> normalmente não exigirá um login no servidor ao usar o PAP ou o CHAP. Portanto, desabilite a string <quote>set login</quote>.</para>
	      </listitem>
	    </varlistentry>
	  </variablelist>
	</sect3>

      <sect3 xml:id="userppp-nat">
	<title>Usando a funcionalidade de conversão de endereços de rede (NAT) do <acronym>PPP</acronym></title>

	<indexterm><primary><acronym>PPP</acronym></primary><secondary>NAT</secondary></indexterm>

	<para>O PPP tem a capacidade de usar o NAT interno sem recursos de diverting do kernel. Esta funcionalidade pode ser ativada pela seguinte linha no <filename>/etc/ppp/ppp.conf</filename>:</para>

	<programlisting>nat enable yes</programlisting>

	<para>Como alternativa, o NAT pode ser ativado pela opção de linha de comando <literal>-nat</literal>. Há também uma opção no <filename>/etc/rc.conf</filename> chamada <literal>ppp_nat </literal>, que é ativada por padrão.</para>

	<para>Ao usar este recurso, pode ser útil incluir as seguintes opções no <filename>/etc/ppp/ppp.conf</filename> para habilitar o encaminhamento de conexões de entrada:</para>

	<programlisting>nat port tcp 10.0.0.2:ftp ftp
nat port tcp 10.0.0.2:http http</programlisting>

	<para>ou para não confiar em nenhuma conexão de entrada</para>

	<programlisting>nat deny_incoming yes</programlisting>
      </sect3>
      </sect2>

      <sect2 xml:id="userppp-final">
	<title>Configuração final do sistema</title>

	<indexterm><primary><acronym>PPP</acronym></primary><secondary>configuration</secondary></indexterm>

	<para>Embora o <command>ppp</command> agora esteja configurado, algumas edições ainda precisam ser feitas no <filename>/etc/rc.conf</filename>.</para>

	<para>Trabalhando de cima para baixo neste arquivo, certifique-se de que a linha <literal>hostname=</literal> esteja configurada:</para>

	<programlisting>hostname="foo.example.com"</programlisting>

	<para>Se o <acronym>ISP</acronym> tiver fornecido um nome de host e um endereço <acronym>IP</acronym> estático, use este nome como o nome do host.</para>

	<para>Procure pela variável <literal>network_interfaces</literal>. Para configurar o sistema para discar para o <acronym>ISP</acronym> sob demanda, certifique-se de que o dispositivo <filename>tun0</filename> esteja adicionado à lista, caso contrário, remova-o.</para>

	<programlisting>network_interfaces="lo0 tun0"
ifconfig_tun0=</programlisting>

	<note>
	  <para>A variável <literal>ifconfig_tun0</literal> deve estar vazia, e um arquivo chamado <filename>/etc/start_if.tun0</filename> deve ser criado. Este arquivo deve conter a linha:</para>

	  <programlisting>ppp -auto mysystem</programlisting>

	  <para>Este script é executado no momento da configuração da rede, iniciando o daemon do ppp no modo automático. Se esta máquina funcionar como um gateway, considere incluir a opção <option>-alias</option>. Consulte a página de manual para maiores detalhes.</para>
	</note>

	<para>Certifique-se de que o programa roteador está configurado para <literal>NO</literal> com a seguinte linha em <filename>/etc/rc.conf</filename>:</para>

	<programlisting>router_enable="NO"</programlisting>

	<indexterm><primary><application>routed</application></primary></indexterm>

	<para>É importante que o daemon <command>routed</command> não seja iniciado, pois o <command>routed</command> tende a excluir as entradas da tabela de roteamento padrão criadas pelo <command>ppp</command>.</para>

	<para>É provavelmente uma boa idéia garantir que a linha <literal>sendmail_flags</literal> não inclua a opção <option>-q</option>, caso contrário o <command>sendmail</command> tentará fazer uma pesquisa de rede de vez em quando, possivelmente fazendo com que sua máquina disque. Você pode tentar:</para>

	<programlisting>sendmail_flags="-bd"</programlisting>

	<indexterm><primary><application>sendmail</application></primary></indexterm>
	<para>A desvantagem é que o <command>sendmail</command> é forçado a reexaminar a fila de mensagens sempre que o link ppp subir. Para automatizar isso, inclua <command>!Bg</command> no <filename>ppp.linkup</filename>:</para>

	<programlisting>1     provider:
2       delete ALL
3       add 0 0 HISADDR
4       !bg sendmail -bd -q30m</programlisting>

	<indexterm><primary>SMTP</primary></indexterm>

	<para>Uma alternativa é configurar um <quote>dfilter</quote> para bloquear o tráfego SMTP. Consulte os arquivos de exemplo para maiores detalhes.</para>
      </sect2>

      <sect2>
	<title>Usando o <command>ppp</command></title>

	<para>Tudo o que resta é reiniciar a máquina. Após a reinicialização, digite:</para>

	<screen><prompt>#</prompt> <userinput>ppp</userinput></screen>

	<para>e, em seguida, o <command>dial provider</command> para iniciar a sessão <acronym>PPP</acronym> ou para configurar o <command>ppp</command> para estabelecer sessões automaticamente quando houver tráfego de saída e o <filename>start_if .tun0</filename> não existir, digite:</para>

      <screen><prompt>#</prompt> <userinput>ppp -auto provider</userinput></screen>

	  <para>É possível falar com o programa <command>ppp</command> enquanto ele está sendo executado em segundo plano, mas somente se uma porta de diagnóstico adequada tiver sido configurada. Para fazer isso, adicione a seguinte linha à configuração:</para>

	  <programlisting>set server /var/run/ppp-tun<replaceable>%d</replaceable> DiagnosticPassword 0177</programlisting>

	<para>Isso fará com que o PPP escute no soquete de domínio <trademark class="registered">UNIX</trademark> especificado, solicitando aos clientes a senha especificada antes de permitir o acesso. O <literal>%d</literal> no nome é substituído pelo número do dispositivo <filename>tun</filename> que está em uso.</para>

	<para>Uma vez que um socket tenha sido configurado, o programa <citerefentry><refentrytitle>pppctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> pode ser usado em scripts que desejam manipular o programa em execução.</para>
      </sect2>

	<sect2 xml:id="userppp-mgetty">
	  <title>Configurando serviços de discagem</title>

	  <indexterm><primary><command>mgetty</command></primary></indexterm>

	  <indexterm><primary>AutoPPP</primary></indexterm>

	  <indexterm><primary>LCP</primary></indexterm>
	  <para>A <xref linkend="dialup"/> fornece uma boa descrição sobre como ativar serviços dial-up usando o <citerefentry><refentrytitle>getty</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>

	  <para>Uma alternativa para o <command>getty</command> é o port <package>comms/mgetty+sendfax</package>), uma versão mais inteligente do <command>getty</command> projetada com as linhas dial-up em mente.</para>

	  <para>As vantagens de usar o <command>mgetty</command> é que ele <emphasis>fala</emphasis> ativamente com os  modems, o que significa que se a porta estiver desligada no <filename>/etc/ttys</filename> então o modem não irá atender o telefone.</para>

	  <para>Versões posteriores do <command>mgetty</command> (da 0.99beta em diante) também suportam a detecção automática de fluxos <acronym>PPP</acronym>, permitindo acesso ao servidor de clientes sem script.</para>

	  <para>Consulte a URL <link xlink:href="http://mgetty.greenie.net/doc/mgetty_toc.html">http://mgetty.greenie.net/doc/mgetty_toc.html</link> para maiores informações sobre o <command>mgetty</command>.</para>

	  <para>Por padrão, o port <package>comms/mgetty+sendfax</package> vem com a opção <literal>AUTO_PPP</literal> ativada permitindo que o <command>mgetty</command> detecte a fase LCP das conexões  <acronym>PPP</acronym> e crie automaticamente um shell ppp. No entanto, como a sequência de login/senha padrão não ocorre, é necessário autenticar os usuários usando o PAP ou o CHAP.</para>

	  <para>Esta seção assume que o usuário compilou com sucesso e instalou o port <package>comms/mgetty+sendfax</package> em seu sistema.</para>

	  <para>Assegure-se de que o <filename>/usr/local/etc/mgetty+sendfax/login.config</filename> tenha o seguinte:</para>

	  <programlisting>/AutoPPP/ -     - /etc/ppp/ppp-pap-dialup</programlisting>

	  <para>Isto diz ao <command>mgetty</command> para executar o <filename>ppp-pap-dialup</filename> para conexões <acronym>PPP</acronym> detectadas.</para>

	  <para>Crie um arquivo executável chamado <filename>/etc/ppp/ppp-pap-dialup</filename> contendo o seguinte:</para>

	  <programlisting>#!/bin/sh
exec /usr/sbin/ppp -direct pap$IDENT</programlisting>

	  <para>Para cada linha dial-up ativada em <filename>/etc/ttys</filename>, crie uma entrada correspondente em <filename>/etc/ppp/ppp.conf</filename>. Isso irá coexistir com as definições que criamos acima.</para>

	  <programlisting>pap:
  enable pap
  set ifaddr 203.14.100.1 203.14.100.20-203.14.100.40
  enable proxy</programlisting>

	  <para>Cada usuário que fizer login com este método precisará ter um nome de usuário/senha em <filename>/etc/ppp/ppp.secret</filename> ou, como alternativa, adicione a seguinte opção para autenticar os usuários via PAP a partir de <filename>/etc/passwd</filename>.</para>

	  <programlisting>enable passwdauth</programlisting>

	  <para>Para atribuir à alguns usuários um endereço de <acronym>IP</acronym> estático , especifique o endereço como o terceiro argumento em <filename>/etc/ppp/ppp.secret</filename>. Consulte o <filename>/usr/share/examples/ppp/ppp.secret.sample</filename> para exemplos.</para>
	</sect2>
  </sect1>

  <sect1 xml:id="ppp-troubleshoot">
    <!--
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Tom</firstname>
	  <surname>Rhodes</surname>
	  <contrib>Contributed by in June 2003</contrib>
	</author>
      </authorgroup>
    </sect1info>
    -->
    <title>Solução de problemas de conexões <acronym>PPP</acronym></title>

    <indexterm><primary><acronym>PPP</acronym></primary> <secondary>troubleshooting</secondary></indexterm>

    <para>Esta seção aborda alguns problemas que podem surgir ao usar <acronym>PPP</acronym> em uma conexão de modem. Alguns <acronym>ISP</acronym>s apresentam o prompt <literal>ssword</literal> enquanto outros apresentam <literal>password</literal>. Se o script <command>ppp</command> não for escrito de acordo, a tentativa de login falhará. A maneira mais comum de depurar as conexões <command>ppp</command> é conectando manualmente conforme descrito nesta seção.</para>

    <sect2>
      <title>Verifique os Device Nodes</title>

      <para>Ao usar um kernel personalizado, certifique-se de incluir a seguinte linha no arquivo de configuração do kernel:</para>

      <programlisting>device   uart</programlisting>

      <para>O dispositivo <filename>uart</filename> já está incluído no kernel <literal>GENERIC</literal>, portanto, nenhuma etapa adicional é necessária neste caso. Basta verificar a saída do <command>dmesg</command> para o dispositivo do modem com:</para>

      <screen><prompt>#</prompt> <userinput>dmesg | grep uart</userinput></screen>

      <para>Isso deve exibir alguma saída pertinente sobre os dispositivos <filename>uart</filename>. Estas são as portas COM que precisamos. Se o modem funcionar como uma porta serial padrão, ele deve estar listado em <filename>uart1</filename> ou <filename>COM2</filename>. Nesse caso, uma recompilação do kernel não é necessária. Ao fazer a verificação, se o modem estiver em <filename>uart1</filename>, o dispositivo do modem será <filename>/dev/cuau1</filename>.</para>
    </sect2>

    <sect2>
      <title>Conectando Manualmente</title>

      <para>Conectar-se à Internet controlando manualmente o <command>ppp</command> é rápido, fácil e uma ótima maneira de depurar uma conexão ou simplesmente obter informações sobre como o <acronym>ISP</acronym> trata as conexões <command>ppp</command> do cliente. Vamos iniciar o <application>PPP</application> na linha de comando. Note que em todos os nossos exemplos nós usaremos <emphasis>example</emphasis> como o nome do host da máquina rodando o <application>PPP</application>. Para iniciar o <command>ppp</command>:</para>

      <screen><prompt>#</prompt> <userinput>ppp</userinput></screen>

      <screen>ppp ON example&gt; <userinput>set device /dev/cuau1</userinput></screen>

      <para>Este segundo comando define o dispositivo do modem como <filename>cuau1</filename>.</para>

      <screen>ppp ON example&gt; <userinput>set speed 115200</userinput></screen>

      <para>Isso define a velocidade de conexão para 115.200 <acronym>kbps</acronym>.</para>

      <screen>ppp ON example&gt; <userinput>enable dns</userinput></screen>

      <para>Isto diz ao <command>ppp</command> para configurar o resolver e adicionar as linhas do servidor de nomes ao <filename>/etc/resolv.conf</filename>. Se o <command>ppp</command> não puder determinar o nome do host, ele poderá ser configurado manualmente mais tarde.</para>

      <screen>ppp ON example&gt; <userinput>term</userinput></screen>

      <para>Isso alterna para o modo de <quote>terminal</quote> para controlar manualmente o modem.</para>

      <programlisting>deflink: Entering terminal mode on <filename class="devicefile">/dev/cuau1</filename>
type '~h' for help</programlisting>

      <screen><userinput>at</userinput>
OK
<userinput>atdt<replaceable>123456789</replaceable></userinput></screen>

      <para>Use o comando <command>at</command> para inicializar o modem, então use o comando <command>atdt</command> e o número o <acronym>ISP</acronym> para iniciar o processo de discagem.</para>

      <screen>CONNECT</screen>

      <para>Confirmação da conexão, se tivermos problemas de conexão, não relacionados ao hardware, aqui é onde tentaremos resolvê-los.</para>

      <screen>ISP Login:<userinput>myusername</userinput></screen>

      <para>Nesse prompt, responda com o nome de usuário fornecido pelo <acronym>ISP</acronym>.</para>

      <screen>ISP Pass:<userinput>mypassword</userinput></screen>

      <para>Nesse prompt, responda com a senha fornecida pelo <acronym>ISP</acronym>. Assim como ocorre ao se logar no FreeBSD, a senha não será exibida quando você a digitar.</para>

      <screen>Shell or PPP:<userinput>ppp</userinput></screen>

      <para>Dependendo do <acronym>ISP</acronym>, este aviso pode não aparecer. Em caso afirmativo, ele está perguntando se deve usar um shell no provedor ou iniciar o <command>ppp</command>. Neste exemplo, o <command>ppp</command> foi selecionado para estabelecer uma conexão com a Internet.</para>

      <screen>Ppp ON example&gt;</screen>

      <para>Observe que neste exemplo o primeiro <option>p</option> foi capitalizado. Isso mostra que nós nos conectamos com sucesso ao <acronym>ISP</acronym>.</para>

      <screen>PPp ON example&gt;</screen>

      <para>Nós nos autenticamos com sucesso com nosso <acronym>ISP</acronym> e estamos aguardando que o endereço <acronym>IP</acronym> seja atribuído.</para>

      <screen>PPP ON example&gt;</screen>

      <para>Fizemos a negociação de um endereço <acronym>IP</acronym> e concluímos nossa conexão com êxito.</para>

      <screen>PPP ON example&gt;<userinput>add default HISADDR</userinput></screen>

      <para>Aqui nós adicionamos nossa rota padrão, precisamos fazer isso antes de podermos conversar com o mundo externo, já que atualmente a única conexão estabelecida é com o peer. Se isso falhar devido a rotas existentes, coloque o caractere <literal>!</literal> na frente do <option>add</option>. Alternativamente, defina isso antes de fazer a conexão real e ele negociará uma nova rota de acordo.</para>

      <para>Se tudo correu bem, agora deveríamos ter uma conexão ativa com a Internet, que poderia ser colocada em segundo plano usando <keycombo action="simul"><keycap>CTRL</keycap> <keycap>z</keycap> </keycombo> Se o <command>PPP</command> retornar para <command>ppp</command>, a conexão será perdida. É bom saber isso  porque mostra o status da conexão. Os P maiúsculos representam uma conexão com o <acronym>ISP</acronym> e os p minúsculos mostram que a conexão foi perdida.</para>
      </sect2>

      <sect2>
	<title>Depuração</title>

	<para>Se uma conexão não puder ser estabelecida, desligue o fluxo de hardware <acronym>CTS/RTS</acronym> usando <option>set ctsrts off</option>. Normalmente este é o problema quando nos conectamos há alguns servidores de terminal com <application>PPP</application>, onde o <application>PPP</application> trava quando tenta gravar dados no link de comunicação e aguarda um Clear To Send (<acronym>CTS</acronym>), sinal que pode nunca vir. Ao usar esta opção, inclua <option>set accmap</option>, pois isso pode ser necessário para evitar que o hardware dependa de passar certos caracteres de ponta a ponta, na maioria das vezes XON/XOFF. Consulte <citerefentry><refentrytitle>ppp</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter maiores informações sobre essa opção e como ela é usada.</para>

	<para>Um modem mais antigo pode precisar de <option>set parity even</option>. A paridade é definida como none por padrão, mas é usada para verificação de erros com um grande aumento no tráfego, em modems mais antigos.</para>

	<para>O <application>PPP</application> pode não retornar ao modo de comando, que geralmente é um erro de negociação em que o <acronym>ISP</acronym> está aguardando a negociação começar. Neste ponto, usando <command>~p</command> forçará o ppp a começar a enviar as informações de configuração.</para>

	<para>Se um prompt de login nunca aparecer, a autenticação <acronym>PAP</acronym> ou <acronym>CHAP</acronym> provavelmente será necessária. Para usar <acronym>PAP</acronym> ou <acronym>CHAP</acronym>, adicione as seguintes opções ao <application>PPP</application> antes de entrar no modo terminal:</para>

	<screen>ppp ON example&gt; <userinput>set authname <replaceable>myusername</replaceable></userinput></screen>

	<para>Onde <replaceable>myusername</replaceable> deve ser substituído pelo nome de usuário que foi atribuído pelo <acronym>ISP</acronym>.</para>

	<screen>ppp ON example&gt; <userinput>set authkey <replaceable>mypassword</replaceable></userinput></screen>

	<para>Onde <replaceable>mypassword</replaceable> deve ser substituído pela senha que foi atribuída pelo <acronym>ISP</acronym>.</para>

	<para>Se uma conexão for estabelecida, mas não conseguir encontrar nenhum nome de domínio, tente utilizar o <citerefentry><refentrytitle>ping</refentrytitle><manvolnum>8</manvolnum></citerefentry> em um endereço <acronym>IP</acronym>. Se houver 100 por cento (100%) de perda de pacotes, é provável que uma rota padrão não tenha sido atribuída. Verifique novamente se <option>add default HISADDR</option> foi definido durante a conexão. Se uma conexão puder ser feita para um endereço <acronym>IP</acronym> remoto, é possível que um endereço de resolvedor não tenha sido adicionado ao <filename>/etc/resolv.conf</filename>. Este arquivo deve se parecer com:</para>

	<programlisting>domain <replaceable>example.com</replaceable>
nameserver <replaceable>x.x.x.x</replaceable>
nameserver <replaceable>y.y.y.y</replaceable></programlisting>

	<para>Onde <replaceable>x.x.x.x</replaceable> e <replaceable>y.y.y.y</replaceable> deve ser substituído pelo endereço <acronym>IP</acronym> dos servidores DNS do <acronym>ISP</acronym>.</para>

	<para>Para configurar <citerefentry><refentrytitle>syslog</refentrytitle><manvolnum>3</manvolnum></citerefentry> para fornecer o registro para a conexão <application>PPP</application>, verifique se essa linha existe no <filename>/etc/syslog.conf</filename>:</para>

	<programlisting>!ppp
*.*     /var/log/ppp.log</programlisting>

    </sect2>
  </sect1>

  <sect1 xml:id="pppoe">
    <!--
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Jim</firstname>
	  <surname>Mock</surname>
	  <contrib>Contributed (from
	    http://node.to/freebsd/how-tos/how-to-freebsd-pppoe.html)
	    by in Jan 2000</contrib>
	</author>
      </authorgroup>
    </sect1info>
    -->
    <title>Usando o <acronym>PPP</acronym> sobre Ethernet (PPPoE)</title>

    <indexterm><primary><acronym>PPP</acronym></primary> <secondary>over Ethernet</secondary></indexterm>

    <para>Esta seção descreve como configurar o <acronym>PPP</acronym> sobre Ethernet (<acronym>PPPoE</acronym>).</para>

    <para>Aqui está um exemplo de <filename>ppp.conf</filename> funcional:</para>

    <programlisting>default:
  set log Phase tun command # you can add more detailed logging if you wish
  set ifaddr 10.0.0.1/0 10.0.0.2/0

name_of_service_provider:
  set device PPPoE:<replaceable>xl1</replaceable> # replace xl1 with your Ethernet device
  set authname YOURLOGINNAME
  set authkey YOURPASSWORD
  set dial
  set login
  add default HISADDR</programlisting>

      <para>Como <systemitem class="username">root</systemitem>, execute:</para>

      <screen><prompt>#</prompt> <userinput>ppp -ddial name_of_service_provider</userinput></screen>

      <para>Adicione o seguinte ao <filename>/etc/rc.conf</filename>:</para>

      <programlisting>ppp_enable="YES"
ppp_mode="ddial"
ppp_nat="YES"	# if you want to enable nat for your local network, otherwise NO
ppp_profile="name_of_service_provider"</programlisting>

    <sect2>
      <title>Usando um nome de perfil PPPoE</title>

      <para>Às vezes, será necessário usar nome de perfil para estabelecer a conexão. Nomes de perfil são usados para distinguir entre diferentes servidores PPPoE conectados a uma determinada rede.</para>

      <para>Qualquer informação do nome do perfil necessário deve estar na documentação fornecida pelo <acronym>ISP</acronym>.</para>

      <para>Como último recurso, pode-se tentar instalar o pacote ou port <package>net/rr-pppoe</package>. Lembre-se, no entanto, que isso pode desprogramar o seu modem e torná-lo inútil, então pense duas vezes antes de fazê-lo. Basta instalar o programa enviado com o modem. Em seguida, acesse o menu <guimenu>System</guimenu> do programa. O nome do perfil deve estar listado lá. Geralmente é <emphasis>ISP</emphasis>.</para>

      <para>O nome do perfil (service tag) será usado na entrada de configuração PPPoE em <filename>ppp.conf</filename> como a parte do provedor para o <command>set device</command>. Consulte <citerefentry><refentrytitle>ppp</refentrytitle><manvolnum>8</manvolnum></citerefentry> para detalhes completos. Deve ficar assim:</para>

      <programlisting>set device PPPoE:<replaceable>xl1</replaceable>:<replaceable>ISP</replaceable></programlisting>

      <para>Não se esqueça de alterar o <replaceable>xl1</replaceable> para o dispositivo adequado para a placa Ethernet.</para>

      <para>Não se esqueça de alterar o <replaceable>ISP</replaceable> para o nome de perfil.</para>

      <para>Para informações adicionais, consulte <link xlink:href="http://web.archive.org/web/20130907043447/http://renaud.waldura.com:80/doc/freebsd/pppoe/">Banda larga mais barata com o FreeBSD em DSL</link> por Renaud Waldura.</para>
    </sect2>

    <sect2 xml:id="ppp-3com">

      <title>PPPoE com um <trademark class="registered">3Com</trademark> <trademark class="registered">HomeConnect</trademark> ADSL Modem Dual Link</title>

      <para>Este modem não segue a especificação PPPoE definida em <link xlink:href="http://www.faqs.org/rfcs/rfc2516.html">RFC 2516</link>.</para>

      <para>Para tornar o FreeBSD capaz de se comunicar com este dispositivo, um sysctl deve ser configurado. Isso pode ser feito automaticamente no momento da inicialização, atualizando o <filename>/etc/sysctl.conf</filename>:</para>

	<programlisting>net.graph.nonstandard_pppoe=1</programlisting>

      <para>ou pode ser feito imediatamente com o comando:</para>

      <screen><prompt>#</prompt> <userinput>sysctl net.graph.nonstandard_pppoe=1</userinput></screen>

      <para>Infelizmente, como essa é uma configuração valida para todo o sistema, não é possível falar com um cliente ou servidor PPPoE normal e um <trademark class="registered">3Com</trademark> <trademark class="registered">HomeConnect</trademark> Modem ADSL ao mesmo tempo.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="pppoa">
    <title>Usando <application>PPP</application> sobre <acronym>ATM</acronym> (PPPoA)</title>

    <indexterm><primary><acronym>PPP</acronym></primary> <secondary>over <acronym>ATM</acronym></secondary></indexterm>

    <indexterm><primary>PPPoA</primary></indexterm>

    <para>Esta sessão descreve como configurar o PPP sobre <acronym>ATM</acronym> (PPPoA). O PPPoA é uma escolha popular entre os provedores europeus de DSL.</para>
<!--
This port is broken as of June, 2009
    <sect2>
      <title>Using PPPoA with the Alcatel &speedtouch; USB</title>

      <para>PPPoA support for this device is supplied as a port in
	&os; because the firmware is distributed under <ulink
	url="http://www.speedtouchdsl.com/disclaimer_lx.htm">Alcatel's
	license agreement</ulink> and can not be redistributed freely
	with the base system of &os;.</para>

      <para>This software can be installed using the
	<filename role="package">net/pppoa</filename> package or port.  Once installed, follow
	the instructions provided with it.</para>

      <para>Like many USB devices, the Alcatel &speedtouch; USB needs
	to download firmware from the host computer to operate
	properly.  It is possible to automate this process in &os;
	so that this transfer takes place whenever the device is
	plugged into a USB port.  The following information can be
	added to the <filename>/etc/usbd.conf</filename> file to
	enable this automatic firmware transfer.  This file must be
	edited as the <username>root</username> user.</para>

      <programlisting>device "Alcatel SpeedTouch USB"
    devname "ugen[0-9]+"
    vendor 0x06b9
    product 0x4061
    attach "/usr/local/sbin/modem_run -f /usr/local/libdata/mgmt.o"</programlisting>

      <para>To enable the USB daemon, <application>usbd</application>,
	put the following the line into
	<filename>/etc/rc.conf</filename>:</para>

      <programlisting>usbd_enable="YES"</programlisting>

      <para>It is also possible to set up
	<application>ppp</application> to dial up at startup.  To do
	this add the following lines to
	<filename>/etc/rc.conf</filename>.  Again, for this procedure
	you will need to be logged in as the <username>root</username>
	user.</para>

      <programlisting>ppp_enable="YES"
ppp_mode="ddial"
ppp_profile="adsl"</programlisting>

      <para>For this to work correctly you will need to have used the
	sample <filename>ppp.conf</filename> which is supplied with
	the <filename role="package">net/pppoa</filename> port.</para>
    </sect2>
    -->

    <sect2>
      <title>Usando o mpd</title>

      <para>O aplicativo <application>mpd</application> pode ser usado para conectar-se a uma variedade de serviços, em particular serviços PPTP. Ele pode ser instalado usando o pacote ou port <package>net/mpd5</package>. Muitos modems ADSL exigem que um túnel PPTP seja criado entre o modem e o computador.</para>

      <para>Uma vez instalado, configure o <application>mpd</application> para adequar-se às configurações do provedor. O  port coloca um conjunto de arquivos de configuração de exemplos os quais são bem documentados em <filename>/usr/local/etc/mpd/</filename>. Um guia completo para configurar o <application>mpd</application> está disponível no formato HTML em <filename>/usr/ports/share/doc/mpd/</filename>. Aqui está uma configuração de exemplo para conectar-se a um serviço ADSL com o <application>mpd</application>. A configuração está espalhada em dois arquivos, primeiro o <filename>mpd.conf</filename>:</para>

      <note>
	<para>Este exemplo de <filename>mpd.conf</filename> só funciona com o <application>mpd</application> 4.x.</para>
      </note>

      <programlisting>default:
    load adsl

adsl:
    new -i ng0 adsl adsl
    set bundle authname <replaceable>username</replaceable> <co xml:id="co-mpd-ex-user"/>
    set bundle password <replaceable>password</replaceable> <co xml:id="co-mpd-ex-pass"/>
    set bundle disable multilink

    set link no pap acfcomp protocomp
    set link disable chap
    set link accept chap
    set link keep-alive 30 10

    set ipcp no vjcomp
    set ipcp ranges 0.0.0.0/0 0.0.0.0/0

    set iface route default
    set iface disable on-demand
    set iface enable proxy-arp
    set iface idle 0

    open</programlisting>

    <calloutlist>
      <callout arearefs="co-mpd-ex-user">
	<para>O nome de usuário usado para autenticar com seu <acronym>ISP</acronym>.</para>
      </callout>
      <callout arearefs="co-mpd-ex-pass">
	<para>A senha usada para autenticar com seu <acronym>ISP</acronym>.</para>
      </callout>
    </calloutlist>

    <para>Informações sobre o link, ou links, a estabelecer são encontradas em <filename>mpd.links</filename>. Um exemplo do <filename>mpd.links</filename> para acompanhar o exemplo acima é dado abaixo:</para>

    <programlisting>adsl:
    set link type pptp
    set pptp mode active
    set pptp enable originate outcall
    set pptp self <replaceable>10.0.0.1</replaceable> <co xml:id="co-mpd-ex-self"/>
    set pptp peer <replaceable>10.0.0.138</replaceable> <co xml:id="co-mpd-ex-peer"/></programlisting>

    <calloutlist>
      <callout arearefs="co-mpd-ex-self">
	<para>O endereço <acronym>IP</acronym> do computador FreeBSD executando o <application>mpd</application>.</para>
      </callout>
      <callout arearefs="co-mpd-ex-peer">
	<para>O endereço <acronym>IP</acronym> do modem ADSL. O padrão do Alcatel <trademark>SpeedTouch</trademark> padrão é <systemitem class="ipaddress">10.0.0.138</systemitem>.</para>
      </callout>
    </calloutlist>

    <para>É possível inicializar a conexão facilmente, emitindo o seguinte comando como <systemitem class="username">root</systemitem>:</para>

    <screen><prompt>#</prompt> <userinput>mpd -b <replaceable>adsl</replaceable></userinput></screen>

    <para>Para ver o status da conexão:</para>

    <screen><prompt>%</prompt> <userinput>ifconfig <replaceable>ng0</replaceable></userinput>
ng0: flags=88d1&lt;UP,POINTOPOINT,RUNNING,NOARP,SIMPLEX,MULTICAST&gt; mtu 1500
     inet 216.136.204.117 --&gt; 204.152.186.171 netmask 0xffffffff</screen>

    <para>Usar o <application>mpd</application> é a maneira recomendada de se conectar a um serviço ADSL com o FreeBSD.</para>
  </sect2>

  <sect2>
    <title>Usando o pptpclient</title>

    <para>Também é possível usar o FreeBSD para conectar-se a outros serviços PPPoA usando o <package>net/pptpclient</package>.</para>

    <para>Para usar o <package>net/pptpclient</package> para conectar-se a um serviço DSL, instale o port ou o pacote e edite o <filename>/etc/ppp/ppp.conf</filename>. Uma seção de exemplo do <filename>ppp.conf</filename> é dada abaixo. Para maiores informações sobre as opções do <filename>ppp.conf</filename> consulte <citerefentry><refentrytitle>ppp</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>

    <programlisting>adsl:
 set log phase chat lcp ipcp ccp tun command
 set timeout 0
 enable dns
 set authname <replaceable>username</replaceable> <co xml:id="co-pptp-ex-user"/>
 set authkey <replaceable>password</replaceable> <co xml:id="co-pptp-ex-pass"/>
 set ifaddr 0 0
 add default HISADDR</programlisting>

    <calloutlist>
      <callout arearefs="co-pptp-ex-user">
	<para>O nome de usuário no provedor de DSL.</para>
      </callout>

      <callout arearefs="co-pptp-ex-pass">
	<para>A senha da sua conta.</para>
      </callout>
    </calloutlist>

    <warning>
      <para>Como a senha da conta é adicionada ao <filename>ppp.conf</filename> em forma de texto simples, certifique-se de que ninguém possa ler o conteúdo deste arquivo:</para>

      <screen><prompt>#</prompt> <userinput>chown root:wheel /etc/ppp/ppp.conf</userinput>
<prompt>#</prompt> <userinput>chmod 600 /etc/ppp/ppp.conf</userinput></screen>

      </warning>

      <para>Isso abrirá um túnel para uma sessão <acronym>PPP</acronym> para o roteador DSL. Os modems Ethernet DSL têm um endereço <acronym>IP</acronym> LAN pré-configurado para conexão. No caso do Alcatel <trademark>SpeedTouch</trademark> Home, este endereço é <systemitem class="ipaddress">10.0.0.138</systemitem>. A documentação do roteador deve listar o endereço que o dispositivo usa. Para abrir o túnel e iniciar uma sessão <acronym>PPP</acronym>:</para>

      <screen><prompt>#</prompt> <userinput>pptp <replaceable>address</replaceable> <replaceable>adsl</replaceable></userinput></screen>

      <tip>
	<para>Se um E comercial (<quote>&amp;</quote>) for adicionado ao final desse comando, o <application>pptp</application> retornará ao prompt.</para>
      </tip>

      <para>Um dispositivo de túnel virtual <filename>tun</filename> será criado para interação entre os processos do <application>pptp</application> e do <application>ppp</application>. Quando o prompt for retornado ou o processo do <application>pptp</application> confirmar uma conexão, examine o túnel:</para>

      <screen><prompt>%</prompt> <userinput>ifconfig <replaceable>tun0</replaceable></userinput>
tun0: flags=8051&lt;UP,POINTOPOINT,RUNNING,MULTICAST&gt; mtu 1500
        inet 216.136.204.21 --&gt; 204.152.186.171 netmask 0xffffff00
	Opened by PID 918</screen>

      <para>Se a conexão falhar, verifique a configuração do roteador, que geralmente é acessível usando um navegador da web. Além disso, examine a saída do <command>pptp</command> e o conteúdo do arquivo de log <filename>/var/log/ppp.log</filename> para pistas.</para>
    </sect2>
  </sect1>
</chapter>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<chapter version="5.0" xml:id="mail">
  <info>
    <title>Correio Eletrônico</title>

    <authorgroup>
      <author><personname> <firstname>Bill</firstname> <surname>Lloyd</surname> </personname> <contrib>Trabalho original por </contrib></author>
    </authorgroup>
    <authorgroup>
      <author><personname><firstname>Jim</firstname><surname>Mock</surname></personname><contrib>Reescrito por </contrib></author>
    </authorgroup>
  </info>

  <sect1 xml:id="mail-synopsis">
    <title>Sinopse</title>

    <indexterm><primary>email</primary></indexterm>

    <para>O <quote>Electronic Mail</quote>, mais conhecido como email, é uma das formas de comunicação mais utilizadas atualmente. Este capítulo fornece uma introdução básica à execução de um servidor de email no FreeBSD, bem como uma introdução ao envio e recebimento de email usando o FreeBSD. Para uma cobertura mais completa deste assunto, consulte os livros listados em <xref linkend="bibliography"/>.</para>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>Quais softwares estão envolvidos no envio e recebimento de mensagens de email.</para>
      </listitem>

      <listitem>
	<para>Onde os arquivos básicos de configuração do <application>Sendmail</application> estão localizados no FreeBSD.</para>
      </listitem>

      <listitem>
	<para>A diferença entre caixas de correio remotas e locais.</para>
      </listitem>

      <listitem>
	<para>Como bloquear spammers de utilizar ilegalmente um servidor de email como relay.</para>
      </listitem>

      <listitem>
	<para>Como instalar e configurar um Mail Transfer Agent, substituindo o <application>Sendmail</application>.</para>
      </listitem>

      <listitem>
	<para>Como solucionar problemas comuns de servidor de email.</para>
      </listitem>

      <listitem>
	<para>Como configurar o sistema para apenas enviar email.</para>
      </listitem>

      <listitem>
	<para>Como usar email com uma conexão discada.</para>
      </listitem>

      <listitem>
	<para>Como configurar a autenticação SMTP para segurança adicional.</para>
      </listitem>

      <listitem>
	<para>Como instalar e usar um Mail User Agent, como o <application>mutt</application>, para enviar e receber email.</para>
      </listitem>

      <listitem>
	<para>Como baixar emails de um servidor remoto utilizando <acronym>POP</acronym> ou <acronym>IMAP</acronym>.</para>
      </listitem>

      <listitem>
	<para>Como aplicar automaticamente filtros e regras ao email recebido.</para>
      </listitem>
    </itemizedlist>

    <para>Antes de ler este capítulo, você deve:</para>

    <itemizedlist>
      <listitem>
	<para>Configurar corretamente uma conexão de rede (<xref linkend="advanced-networking"/>).</para>
      </listitem>

      <listitem>
	<para>Configure corretamente as informações de <acronym>DNS</acronym> para um host de email (<xref linkend="network-servers"/>).</para>
      </listitem>

      <listitem>
	<para>Saber como instalar software adicional de terceiros (<xref linkend="ports"/>).</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="mail-using">
    <title>Componentes de Email</title>

    <indexterm><primary>POP</primary></indexterm>
    <indexterm><primary>IMAP</primary></indexterm>
    <indexterm><primary>DNS</primary></indexterm>
      <indexterm><primary>mail server daemons</primary> <secondary><application>Sendmail</application></secondary></indexterm>
      <indexterm><primary>mail server daemons</primary> <secondary><application>Postfix</application></secondary></indexterm>
      <indexterm><primary>mail server daemons</primary> <secondary><application>qmail</application></secondary></indexterm>
      <indexterm><primary>mail server daemons</primary> <secondary><application>Exim</application></secondary></indexterm>
      <indexterm><primary>email</primary> <secondary>receiving</secondary></indexterm>
      <indexterm><primary>MX record</primary></indexterm>
      <indexterm><primary>mail host</primary></indexterm>

    <para>Há cinco partes principais envolvidas em uma troca de email: o Mail User Agent (<acronym>MUA</acronym>), o Mail Transfer Agent (<acronym>MTA</acronym>), um host de email, uma caixa de correio remota ou local e <acronym>DNS</acronym>. Esta seção fornece uma visão geral desses componentes.</para>

    <variablelist>
      <varlistentry>
	<term>Mail User Agent (<acronym>MUA</acronym>)</term>
	<listitem>
	  <para>O Mail User Agent (<acronym>MUA</acronym>) é um aplicativo que é usado para redigir, enviar e receber emails. Este aplicativo pode ser um programa de linha de comando, como o utilitário <command>mail</command> interno ou um aplicativo de terceiros da Coleção de Ports, como <application>mutt</application>, <application>alpine</application> ou <application>elm</application>. Dezenas de programas gráficos também estão disponíveis na Coleção de Ports, incluindo o <application>Claws Mail</application>, <application>Evolution</application> e <application>Thunderbird</application>. Algumas organizações fornecem um programa web de email que pode ser acessado por meio de um navegador. Mais informações sobre como instalar e usar um <acronym>MUA</acronym> no FreeBSD podem ser encontradas em <xref linkend="mail-agents"/>.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Mail Transfer Agent (<acronym>MTA</acronym>)</term>
	<listitem>
	  <para>O Mail Transfer Agent (<acronym>MTA</acronym>) é responsável por receber emails de entrada e entregar emails de saída. O FreeBSD vem com o <application>Sendmail</application> como o <acronym>MTA</acronym> padrão, mas também suporta vários outros daemons de servidor de email, incluindo <application>Exim</application>, <application>Postfix</application> e <application>qmail</application>. A configuração do <application>Sendmail</application> é descrita em <xref linkend="sendmail"/>. Se outro <acronym>MTA</acronym> estiver instalado usando a Coleção de Ports, consulte sua mensagem de pós-instalação para detalhes de configuração específicos do FreeBSD e o site do aplicativo para obter instruções de configuração mais completas.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Servidor de Email e Caixas de Correio</term>
	<listitem>
	  <para>O servidor de email é um servidor responsável por entregar e receber emails para um host ou uma rede. O servidor de email coleta todas as mensagens enviadas para o domínio e as armazena no <filename>mbox</filename> padrão ou no formato alternativo Maildir, dependendo da configuração. Uma vez que o email foi armazenado, ele pode ser lido localmente usando um <acronym>MUA</acronym> ou acessado e coletado remotamente usando protocolos como <acronym>POP</acronym> ou <acronym>IMAP</acronym>. Se o email for lido localmente, não é necessário instalar um servidor <acronym>POP</acronym> ou <acronym>IMAP</acronym>.</para>

	  <para>Para acessar as caixas de email remotamente, é necessário um servidor <acronym>POP</acronym> ou <acronym>IMAP</acronym>, pois esses protocolos permitem que os usuários se conectem a suas caixas de correio de locais remotos. O <acronym>IMAP</acronym> oferece várias vantagens sobre o <acronym>POP</acronym>. Isso inclui a capacidade de armazenar uma cópia de mensagens em um servidor remoto após o download e atualizações simultâneas. O <acronym>IMAP</acronym> pode ser útil em links de baixa velocidade, pois permite aos usuários buscar a estrutura das mensagens sem baixá-las. Ele também pode executar tarefas como pesquisas no servidor para minimizar a transferência de dados entre clientes e servidores.</para>

	  <para>Vários servidores <acronym>POP</acronym> e <acronym>IMAP</acronym> estão disponíveis na Coleção de Ports. Estes incluem o <package>mail/qpopper</package>, <package>mail/imap-uw</package>, <package>mail/courier-imap</package> e <package>mail/dovecot2</package> .</para>

	  <warning>
	    <para>Deve-se notar que o <acronym>POP</acronym> e o <acronym>IMAP</acronym> transmitem informações, incluindo nome de usuário e senha, em texto não criptografado. Para garantir a segurança na transmissão de informações entre esses protocolos, considere a utilização de túneis seguros com <citerefentry><refentrytitle>ssh</refentrytitle><manvolnum>1</manvolnum></citerefentry> (<xref linkend="security-ssh-tunneling"/>) ou utilize <acronym>SSL</acronym> (<xref linkend="openssl"/>).</para>
	  </warning>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Sistema de Nomes de Domínio (<acronym>DNS</acronym>)</term>
	<listitem>
	  <para>O Sistema de Nomes de Domínio (<acronym>DNS</acronym>) e seu daemon <command>named</command> desempenham um grande papel na entrega de email. Para enviar emails de um site para outro, o <acronym>MTA</acronym> procurará o site remoto por <acronym>DNS</acronym> para determinar qual host receberá os emails para o destino. Esse processo também ocorre quando o email é enviado de um host remoto para o <acronym>MTA</acronym>.</para>

	  <para>Além de mapear nomes de hosts para endereços de <acronym>IP</acronym>, o <acronym>DNS</acronym> é responsável por armazenar informações específicas da entrega de emails, conhecidas como Mail eXchanger <acronym>MX</acronym>. O registro <acronym>MX</acronym> especifica quais hosts receberão mensagens de um domínio em particular.</para>

	  <para>Para visualizar os registros <acronym>MX</acronym> de um domínio, especifique o tipo de registro. Consulte <citerefentry><refentrytitle>host</refentrytitle><manvolnum>1</manvolnum></citerefentry>, para mais detalhes sobre este comando:</para>

	  <screen><prompt>%</prompt> <userinput>host -t mx FreeBSD.org</userinput>
FreeBSD.org mail is handled by 10 mx1.FreeBSD.org</screen>

	  <para>Consulte <xref linkend="network-dns"/> para mais informações sobre <acronym>DNS</acronym> e sua configuração.</para>
	</listitem>
      </varlistentry>
    </variablelist>
  </sect1>

  <sect1 xml:id="sendmail">
    <info>
      <title>Arquivos de Configuração do <application>Sendmail</application></title>

      <authorgroup>
	<author><personname> <firstname>Christopher</firstname> <surname>Shumway</surname> </personname> <contrib>Contributed by </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary><application>Sendmail</application></primary></indexterm>

    <para><application>Sendmail</application> é o <acronym>MTA</acronym> padrão instalado com o FreeBSD. Ele aceita emails de <acronym>MUA</acronym>s e os entrega ao host de email apropriado, conforme definido por sua configuração. O <application>Sendmail</application> também pode aceitar conexões de rede e enviar mensagens para caixas de correio locais ou para outro programa.</para>

    <para>Os arquivos de configuração do <application>Sendmail</application> estão localizados em <filename>/etc/mail</filename>. Esta seção descreve esses arquivos em mais detalhes.</para>

    <indexterm><primary><filename>/etc/mail/access</filename></primary></indexterm>
    <indexterm><primary><filename>/etc/mail/aliases</filename></primary></indexterm>
    <indexterm><primary><filename>/etc/mail/local-host-names</filename></primary></indexterm>
    <indexterm><primary><filename>/etc/mail/mailer.conf</filename></primary></indexterm>
    <indexterm><primary><filename>/etc/mail/mailertable</filename></primary></indexterm>
    <indexterm><primary><filename>/etc/mail/sendmail.cf</filename></primary></indexterm>
    <indexterm><primary><filename>/etc/mail/virtusertable</filename></primary></indexterm>

    <variablelist>
      <varlistentry>
	<term><filename>/etc/mail/access</filename></term>
	<listitem>
	  <para>Este arquivo de acesso define quais hosts ou endereços de <acronym>IP</acronym> têm acesso ao servidor de email local e que tipo de acesso eles possuem. Os hosts listados como <option>OK</option>, que é a opção padrão, têm permissão para enviar emails para esse host, desde que o destino final do email seja a máquina local. Os hosts listados como <option>REJECT</option> são rejeitados para todas as conexões de email. Os hosts listados como <option>RELAY</option> têm permissão para enviar emails para qualquer destino usando este servidor de email. Os hosts listados como <option>ERROR</option> terão seus emails retornados com o erro de email especificado. Se um host estiver listado como <option>SKIP</option>, o <application>Sendmail</application> interromperá a pesquisa atual por esta entrada sem aceitar ou rejeitar o email. Os hosts listados como <option>QUARANTINE</option> terão suas mensagens retidas e receberão o texto especificado como o motivo da retenção.</para>

	  <para>Exemplos de uso destas opções para endereços <acronym>IPv4</acronym> e <acronym>IPv6</acronym> podem ser encontrados na configuração de exemplo do FreeBSD, <filename>/etc/mail/access.sample</filename>:</para>

	  <programlisting># <phrase its:translate="no">$FreeBSD$</phrase>
#
# Mail relay access control list.  Default is to reject mail unless the
# destination is local, or listed in /etc/mail/local-host-names
#
## Examples (commented out for safety)
#From:cyberspammer.com          ERROR:"550 We don't accept mail from spammers"
#From:okay.cyberspammer.com     OK
#Connect:sendmail.org           RELAY
#To:sendmail.org                RELAY
#Connect:128.32                 RELAY
#Connect:128.32.2               SKIP
#Connect:IPv6:1:2:3:4:5:6:7     RELAY
#Connect:suspicious.example.com QUARANTINE:Mail from suspicious host
#Connect:[127.0.0.3]            OK
#Connect:[IPv6:1:2:3:4:5:6:7:8] OK</programlisting>

	  <para>Para configurar o arquivo de acesso, use o formato mostrado no exemplo para adicionar entradas em <filename>/etc/mail/access</filename>, mas não coloque um símbolo de comentário (<literal>#</literal>) na frente das entradas. Crie uma entrada para cada host ou rede cujo acesso deve ser configurado. Os remetentes de email que correspondem ao lado esquerdo da tabela são afetados pela ação no lado direito da tabela.</para>

	  <para>Sempre que este arquivo for atualizado, atualize seu banco de dados e reinicie o <application>Sendmail</application>:</para>

	  <screen><prompt>#</prompt> <userinput>makemap hash /etc/mail/access &lt; /etc/mail/access</userinput>
<prompt>#</prompt> <userinput>service sendmail restart</userinput></screen>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><filename>/etc/mail/aliases</filename></term>
	<listitem>
	  <para>Este arquivo aliases contém uma lista de caixas de correio virtuais que são expandidas para usuários, arquivos, programas ou outros aliases. Aqui estão algumas entradas para ilustrar o formato do arquivo:</para>

	  <programlisting>root: localuser
ftp-bugs: joe,eric,paul
bit.bucket:  /dev/null
procmail: "|/usr/local/bin/procmail"</programlisting>

	  <para>O nome da caixa de correio no lado esquerdo dos dois pontos é expandido para o(s) alvo(s) à direita. A primeira entrada expande a caixa de correio <systemitem class="username">root</systemitem> para a caixa de correio <systemitem class="username">localuser</systemitem>, que é então pesquisada no <filename>/etc/mail/aliases</filename>. Se nenhuma correspondência for encontrada, a mensagem será entregue para <systemitem class="username">localuser</systemitem>. A segunda entrada mostra uma lista de email. Um email para <systemitem class="username">ftp-bugs</systemitem> é expandido para as três caixas de correio locais <systemitem class="username">joe</systemitem>, <systemitem class="username">eric</systemitem> e <systemitem class="username">paul</systemitem>. Uma caixa de correio remota pode ser especificada como <replaceable>user@example.com</replaceable>. A terceira entrada mostra como escrever mensagens em um arquivo, neste caso, <filename>/dev/null</filename>. A última entrada demonstra como enviar email para um programa, <filename>/usr/local/bin/procmail</filename>, através de um pipe <trademark class="registered">UNIX</trademark>. Consulte <citerefentry><refentrytitle>aliases</refentrytitle><manvolnum>5</manvolnum></citerefentry> para obter mais informações sobre o formato desse arquivo.</para>

	  <para>Sempre que este arquivo for atualizado, execute <command>newaliases</command> para atualizar e inicializar o banco de dados de aliases.</para>
	</listitem>
      </varlistentry>
<!--
This section needs to explain that this feature is for hosts with
alternate names, such as a host that MXs for a dynamic set of other
hosts.
It won't work unless freebsd.mc is built with FEATURE(`use_cw_file'),
meaning it needs a section to refer to on how to make mc files.
    <varlistentry>
      <term><filename>/etc/mail/local-host-names</filename></term>
      <listitem>
      <para>This is a list of hostnames <application>Sendmail</application> will accept
	as the local host name.  Place any domains or hosts that
	<application>Sendmail</application> will receive mail for.
	For example, to configure a mail server to accept mail for the
	domain <systemitem
	  class="fqdomainname">example.com</systemitem> and the host
	<systemitem
	  class="fqdomainname">mail.example.com</systemitem>, add
	these entries to
	<filename>local-host-names</filename>:</para>

      <programlisting>example.com
mail.example.com</programlisting>

    <para>Whenever this file is updated, &man.sendmail.8; needs to be
      restarted so that it will read the changes.</para>
  </listitem>
  </varlistentry>
  -->
      <varlistentry>
	<term><filename>/etc/mail/sendmail.cf</filename></term>
	<listitem>
	  <para>Este é o arquivo de configuração principal do <application>Sendmail</application>. Ele controla o comportamento geral do <application>Sendmail</application>, incluindo tudo desde a tradução de endereços de email até a impressão de mensagens de rejeição para servidores de email remotos. Assim, este arquivo de configuração é bastante complexo. Felizmente, esse arquivo raramente precisa ser alterado para servidores de email padrão.</para>

	  <para>O arquivo de configuração master do <application>Sendmail</application> pode ser criado a partir de macros <citerefentry><refentrytitle>m4</refentrytitle><manvolnum>1</manvolnum></citerefentry> que definem os recursos e o comportamento do <application>Sendmail</application>. Consulte <filename>/usr/src/contrib/sendmail/cf/README</filename> para mais detalhes.</para>

	  <para>Sempre que alterações nesse arquivo são feitas, o <application>Sendmail</application> precisa ser reiniciado para que as alterações entrem em vigor.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><filename>/etc/mail/virtusertable</filename></term>
	<listitem>
	  <para>Esse arquivo mapeia endereços de email de domínios virtuais para caixas de correio usuários reais. Essas caixas de correio podem ser locais, remotas, aliases definidas em <filename>/etc/mail/aliases</filename> ou arquivos. Isso permite que vários domínios virtuais sejam hospedados em uma máquina.</para>

	  <para>O FreeBSD fornece um exemplo de arquivo de configuração em <filename>/etc/mail/virtusertable.sample</filename> para demonstrar ainda mais seu formato. O exemplo a seguir demonstra como criar entradas personalizadas usando esse formato:</para>

	  <programlisting>root@example.com                root
postmaster@example.com          postmaster@noc.example.net
@example.com                    joe</programlisting>

	  <para>Este arquivo é processado pela primeira entrada que for correspondida. Quando um endereço de email corresponde ao endereço à esquerda, ele é mapeado para a caixa de correio local listada à direita. O formato da primeira entrada neste exemplo mapeia um endereço de email específico para uma caixa de correio local, enquanto o formato da segunda entrada mapeia um endereço de email específico para uma caixa de correio remota. Por fim, qualquer endereço de email de <literal>example.com</literal> que não correspondeu a nenhuma das entradas anteriores corresponderá ao último mapeamento e será enviado para a caixa de correio local <literal>joe</literal>. Ao criar entradas personalizadas, use este formato e adicione-as ao <filename>/etc/mail/virtusertable</filename>. Sempre que este arquivo for editado, atualize seu banco de dados e reinicie o <application>Sendmail</application>:</para>

	  <screen><prompt>#</prompt> <userinput>makemap hash /etc/mail/virtusertable &lt; /etc/mail/virtusertable</userinput>
<prompt>#</prompt> <userinput>service sendmail restart</userinput></screen>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><filename>/etc/mail/relay-domains</filename></term>
	<listitem>
	  <para>Em uma instalação padrão do FreeBSD, o <application>Sendmail</application> é configurado para enviar apenas mensagens provenientes do host em que está sendo executado. Por exemplo, se um servidor <acronym>POP</acronym> estiver disponível, os usuários poderão verificar os emails de locais remotos, mas não poderão enviar emails de domínios externos. Normalmente, após alguns momentos da tentativa, um email será enviado de <literal>MAILER-DAEMON</literal> com uma mensagem <errorname>5.7 Relaying Denied</errorname>.</para>

	  <para>A solução mais simples é adicionar o <acronym>FQDN</acronym> do <acronym>ISP</acronym> ao <filename>/etc/mail/relay-domains</filename>. Se vários endereços forem necessários, adicione-os um por linha:</para>

	  <programlisting>your.isp.example.com
other.isp.example.net
users-isp.example.org
www.example.org</programlisting>

	  <para>Depois de criar ou editar este arquivo, reinicie o <application>Sendmail</application> com <command>service sendmail restart</command>.</para>

	  <para>Agora, qualquer mensagem enviada pelo sistema por qualquer domínio dessa lista, desde que o usuário tenha uma conta no sistema, será aceita. Isso permite que os usuários enviem emails de domínios remotos do sistema sem precisar liberar acesso externo ao sistema, evitando <acronym>SPAM</acronym> da Internet.</para>
	</listitem>
      </varlistentry>
    </variablelist>
  </sect1>

  <sect1 xml:id="mail-changingmta">
    <info>
      <title>Alterando o Mail Transfer Agent</title>

      <authorgroup>
	<author><personname> <firstname>Andrew</firstname> <surname>Boothman</surname> </personname> <contrib>Written by </contrib></author>
      </authorgroup>

      <authorgroup>
	<author><personname> <firstname>Gregory</firstname> <surname>Neil Shapiro</surname> </personname> <contrib>Information taken from emails written by </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>email</primary> <secondary>change mta</secondary></indexterm>

    <para>O FreeBSD vem com o <application>Sendmail</application> já instalado como <acronym>MTA</acronym>, que é responsável pelos emails enviados e recebidos. No entanto, o administrador do sistema pode alterar o <acronym>MTA</acronym> do sistema. Uma ampla lista de alternativas de <acronym>MTA</acronym>s está disponível na categoria <literal>mail</literal> da Coleção de Ports do FreeBSD.</para>

    <para>Uma vez que um novo <acronym>MTA</acronym> esteja instalado, configure e teste o novo software antes de substituir o <application>Sendmail</application>. Consulte a documentação do novo <acronym>MTA</acronym> para obter informações sobre como configurar o software.</para>

    <para>Uma vez que o novo <acronym>MTA</acronym> estiver funcionando, use as instruções nesta seção para desativar o <application>Sendmail</application> e configurar o FreeBSD para usar o <acronym>MTA</acronym> substituto.</para>

    <sect2 xml:id="mail-disable-sendmail">
      <title>Desativar o <application>Sendmail</application></title>

      <warning>
	<para>Se o serviço de email de saída do <application>Sendmail</application> estiver desabilitado, é importante que ele seja substituído por um sistema de entrega de email alternativo. Caso contrário, as funções do sistema, como <citerefentry><refentrytitle>periodic</refentrytitle><manvolnum>8</manvolnum></citerefentry>, não poderão entregar seus resultados por email. Muitas partes do sistema esperam um <acronym>MTA</acronym> funcional. Se os aplicativos continuarem a usar os binários do <application>Sendmail</application> para tentar enviar emails depois que eles forem desativados, o email poderá entrar em uma fila inativa do <application>Sendmail</application> e nunca será entregue.</para>
      </warning>

      <para>Para desabilitar completamente o <application>Sendmail</application>, adicione ou edite as seguintes linhas no <filename>/etc/rc.conf</filename>:</para>

      <programlisting>sendmail_enable="NO"
sendmail_submit_enable="NO"
sendmail_outbound_enable="NO"
sendmail_msp_queue_enable="NO"</programlisting>

      <para>Para desabilitar somente o serviço de email de entrada do <application>Sendmail</application>, use apenas esta entrada no <filename>/etc/rc.conf</filename>:</para>

      <programlisting>sendmail_enable="NO"</programlisting>

      <para>Mais informações sobre as opções de inicialização do <application>Sendmail</application> estão disponíveis em <citerefentry><refentrytitle>rc.sendmail</refentrytitle><manvolnum>8</manvolnum> </citerefentry>.</para>
    </sect2>

    <sect2>
      <title>Substitua o <acronym> MTA</acronym> Padrão</title>

      <para>Quando um novo <acronym>MTA</acronym> é instalado usando a Coleção de Ports, seu script de inicialização também é instalado e as instruções de inicialização são mencionadas em sua mensagem de pacote. Antes de iniciar o novo <acronym>MTA</acronym>, pare os processos do <application>Sendmail</application> em execução. Este exemplo interrompe todos esses serviços e em seguida, inicia o serviço <application>Postfix</application>:</para>

      <screen><prompt>#</prompt> <userinput>service sendmail stop</userinput>
<prompt>#</prompt> <userinput>service postfix start</userinput></screen>

      <para>Para configurar a substituição <acronym>MTA</acronym> na inicialização do sistema, adicione sua linha de configuração ao <filename>/etc/rc.conf</filename>. Esta entrada habilita o <acronym>MTA</acronym> Postfix:</para>

      <programlisting>postfix_enable="YES"</programlisting>

      <para>Algumas configurações adicionais são necessárias, pois o <application>Sendmail</application> é tão onipresente que alguns softwares assumem que ele já está instalado e configurado. Verifique o <filename>/etc/periodic.conf</filename> e certifique-se de que esses valores estejam configurados como <literal>NO</literal>. Se este arquivo não existir, crie-o com estas entradas:</para>

      <programlisting>daily_clean_hoststat_enable="NO"
daily_status_mail_rejects_enable="NO"
daily_status_include_submit_mailq="NO"
daily_submit_queuerun="NO"</programlisting>

      <para>Alguns <acronym>MTA</acronym>s alternativos fornecem suas próprias implementações compatíveis de linha de comando do <application>Sendmail</application> para facilitar o uso delas como substitutos para o <application>Sendmail</application>. No entanto, alguns <acronym>MUA</acronym>s podem tentar executar binários padrão do <application>Sendmail</application> em vez dos binários do novo <acronym>MTA</acronym>. O FreeBSD usa o <filename>/etc/mail/mailer.conf</filename> para mapear os binários esperados do <application>Sendmail</application> para o local dos novos binários. Mais informações sobre esse mapeamento podem ser encontradas em <citerefentry><refentrytitle>mailwrapper</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>

      <para>O <filename>/etc/mail/mailer.conf</filename> padrão se parece com isto:</para>

      <programlisting># <phrase its:translate="no">$FreeBSD$</phrase>
#
# Execute the "real" sendmail program, named /usr/libexec/sendmail/sendmail
#
sendmail        /usr/libexec/sendmail/sendmail
send-mail       /usr/libexec/sendmail/sendmail
mailq           /usr/libexec/sendmail/sendmail
newaliases      /usr/libexec/sendmail/sendmail
hoststat        /usr/libexec/sendmail/sendmail
purgestat       /usr/libexec/sendmail/sendmail</programlisting>

      <para>Quando qualquer um dos comandos listados à esquerda é executado, o sistema na verdade executa o comando associado mostrado à direita. Esse sistema facilita a alteração de quais binários são executados quando esses binários padrões são chamados.</para>

      <para>Alguns <acronym>MTA</acronym>s, quando instalados usando a Coleção de Ports, solicitarão a atualização deste arquivo para os novos binários. Por exemplo, o <application>Postfix</application> atualizará o arquivo da seguinte forma:</para>

      <programlisting>#
# Execute the Postfix sendmail program, named /usr/local/sbin/sendmail
#
sendmail        /usr/local/sbin/sendmail
send-mail       /usr/local/sbin/sendmail
mailq           /usr/local/sbin/sendmail
newaliases      /usr/local/sbin/sendmail</programlisting>

      <para>Se a instalação do <acronym>MTA</acronym> não atualizar automaticamente o <filename>/etc/mail/mailer.conf</filename>, edite esse arquivo em um editor de texto para que ele aponte para os novos binários. Este exemplo aponta para os binários instalados pelo <package>mail/ssmtp</package>:</para>

      <programlisting>sendmail        /usr/local/sbin/ssmtp
send-mail       /usr/local/sbin/ssmtp
mailq           /usr/local/sbin/ssmtp
newaliases      /usr/local/sbin/ssmtp
hoststat        /usr/bin/true
purgestat       /usr/bin/true</programlisting>

      <para>Depois que tudo estiver configurado, é recomendável reinicializar o sistema. A reinicialização oferece a oportunidade de garantir que o sistema esteja configurado corretamente para iniciar o novo <acronym>MTA</acronym> automaticamente no boot.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="mail-trouble">
    <title>Solução de problemas</title>

    <indexterm><primary>email</primary> <secondary>troubleshooting</secondary></indexterm>

    <qandaset>
      <qandaentry>
	<question>
	  <para>Por que preciso usar o FQDN para hosts no meu site?</para>
	</question>

	<answer>
	  <para>O host pode, na verdade, estar em um domínio diferente. Por exemplo, para um host em <systemitem class="fqdomainname">foo.bar.edu</systemitem> se conectar a um host chamado <systemitem>mumble</systemitem> no domínio <systemitem class="fqdomainname">bar.edu</systemitem>, faça a referência pelo Nome de Domínio Totalmente Qualificado (Fully-Qualified Domain Name) <acronym>FQDN</acronym>, <systemitem class="fqdomainname">mumble.bar.edu</systemitem>, em vez de apenas <systemitem>mumble</systemitem>.</para>

	  <para>Isso ocorre porque a versão do <application>BIND</application><indexterm>
	    <primary>BIND</primary></indexterm> que vem com o FreeBSD não fornece mais abreviações padrão para não-FQDNs que não sejam o domínio local. Um host não qualificado como <systemitem>mumble</systemitem> deve ser encontrado como <systemitem class="fqdomainname">mumble.foo.bar.edu</systemitem>, ou ele será procurado no domínio raiz.</para>

	  <para>Nas versões mais antigas do <application>BIND</application>, a pesquisa continuava em <systemitem class="fqdomainname">mumble.bar.edu</systemitem> e <systemitem class="fqdomainname">mumble.edu</systemitem>. A RFC 1535 detalha por que isso é considerado uma má prática ou até mesmo uma falha de segurança.</para>

	  <para>Como uma boa solução, coloque a linha:</para>

	  <programlisting>search foo.bar.edu bar.edu</programlisting>

	  <para>em vez do anterior:</para>

	  <programlisting>domain foo.bar.edu</programlisting>

	  <para>no <filename>/etc/resolv.conf</filename>. No entanto, certifique-se de que a ordem de pesquisa não ultrapasse o limite <quote>entre administração local e pública</quote>, como a RFC 1535 a chama.</para>
	</answer>
      </qandaentry>

      <qandaentry>
	<question>
	  <para>Como posso executar um servidor de email em um host PPP dial-up?</para>
	</question>

	<answer>
	  <para>Conecte-se a um gateway de email FreeBSD na LAN. A conexão PPP não é dedicada.</para>

	  <para>Uma maneira de fazer isso é obter um servidor de Internet em tempo integral para fornecer serviços <acronym>MX</acronym><indexterm><primary>MX record</primary></indexterm> secundários para o domínio. Neste exemplo, o domínio é <systemitem class="fqdomainname">example.com</systemitem> e o ISP configurou <systemitem class="fqdomainname">example.net</systemitem> para fornecer o serviço de <acronym>MX</acronym> secundário para o domínio:</para>

	  <programlisting>example.com.          MX        10      example.com.
                      MX        20      example.net.</programlisting>

	  <para>Apenas um host deve ser especificado como o destinatário final. Para <application>Sendmail</application>, adicione <literal>Cw example.com</literal> em <filename>/etc/mail/sendmail.cf</filename> em <systemitem class="fqdomainname">example.com</systemitem>.</para>

	  <para>Quando o <acronym>MTA</acronym> de envio tentar entregar o email, ele tentará conectar ao sistema, <systemitem class="fqdomainname">example.com</systemitem>, através do link PPP. Isso expirará se o destino estiver offline. O <acronym>MTA</acronym> irá entregá-lo automaticamente ao site <acronym>MX</acronym> secundário no Provedor de Serviços de Internet (<acronym>ISP</acronym>), <systemitem class="fqdomainname">example.net</systemitem>. O site secundário de <acronym>MX</acronym> tentará conectar-se periodicamente ao host primário <acronym>MX</acronym>, <systemitem class="fqdomainname">example.com</systemitem>.</para>

	  <para>Use algo assim como um script de login:</para>

	  <programlisting>#!/bin/sh
# Put me in /usr/local/bin/pppmyisp
( sleep 60 ; /usr/sbin/sendmail -q ) &amp;
/usr/sbin/ppp -direct pppmyisp</programlisting>

	  <para>Ao criar um script de login separado para usuários, use <command>sendmail -qRexample.com</command> no script acima. Isso forçará todos os emails na fila para que <systemitem class="fqdomainname">example.com</systemitem> sejam processados imediatamente.</para>

	  <para>Um refinamento adicional da situação pode ser visto neste exemplo na lista de discussão <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-isp">Lista de discussão de provedor de serviços de Internet do FreeBSD</link>:</para>

	  <programlisting>&gt; we provide the secondary MX for a customer. The customer connects to
&gt; our services several times a day automatically to get the mails to
&gt; his primary MX (We do not call his site when a mail for his domains
&gt; arrived). Our sendmail sends the mailqueue every 30 minutes. At the
&gt; moment he has to stay 30 minutes online to be sure that all mail is
&gt; gone to the primary MX.
&gt;
&gt; Is there a command that would initiate sendmail to send all the mails
&gt; now? The user has not root-privileges on our machine of course.

In the <quote>privacy flags</quote> section of sendmail.cf, there is a
definition Opgoaway,restrictqrun

Remove restrictqrun to allow non-root users to start the queue processing.
You might also like to rearrange the MXs. We are the 1st MX for our
customers like this, and we have defined:

# If we are the best MX for a host, try directly instead of generating
# local config error.
OwTrue

That way a remote site will deliver straight to you, without trying
the customer connection.  You then send to your customer.  Only works for
<quote>hosts</quote>, so you need to get your customer to name their mail
machine <quote>customer.com</quote> as well as
<quote>hostname.customer.com</quote> in the DNS.  Just put an A record in
the DNS for <quote>customer.com</quote>.</programlisting>
	</answer>
      </qandaentry>
    </qandaset>
  </sect1>

  <sect1 xml:id="mail-advanced">
    <title>Tópicos Avançados</title>

    <para>Esta seção aborda tópicos mais envolvidos, como configuração de email e configuração de email para um domínio inteiro.</para>

    <sect2 xml:id="mail-config">
      <title>Configuração básica</title>

      <indexterm><primary>email</primary> <secondary>configuration</secondary></indexterm>

      <para>Fora da caixa, pode-se enviar email para hosts externos desde que <filename>/etc/resolv.conf</filename> esteja configurado ou a rede tenha acesso a um servidor <acronym>DNS</acronym>. Para ter um email entregue ao <acronym>MTA</acronym> em um host FreeBSD, siga um destes procedimentos:</para>

      <itemizedlist>
	<listitem>
	  <para>Execute um servidor <acronym>DNS</acronym> para o domínio.</para>
	</listitem>

	<listitem>
	  <para>Tenha o email entregue diretamente para o <acronym>FQDN</acronym> para a máquina.</para>
	</listitem>
      </itemizedlist>

      <indexterm><primary>SMTP</primary></indexterm>
      <para>Para que o email seja entregue diretamente a um host, ele deve ter um endereço IP estático permanente, não um endereço IP dinâmico. Se o sistema estiver protegido por um firewall, ele deverá ser configurado para permitir o tráfego SMTP. Para receber mensagens diretamente em um host, um desses dois deve ser configurado:</para>

      <itemizedlist>
	<listitem>
	  <para>Certifique-se de que o registro <acronym>MX</acronym><indexterm><primary>MX
	      record</primary></indexterm> de menor numeração no <acronym>DNS</acronym> aponte para o endereço IP estático do host.</para>
	</listitem>

	<listitem>
	  <para>Certifique-se de que não exista nenhuma entrada <acronym>MX</acronym> no <acronym>DNS</acronym> para o host.</para>
	</listitem>
      </itemizedlist>

      <para>Qualquer um dos itens acima permitirá que o correio seja recebido diretamente no host.</para>

      <para>Tente isto:</para>

      <screen><prompt>#</prompt> <userinput>hostname</userinput>
example.FreeBSD.org
<prompt>#</prompt> <userinput>host example.FreeBSD.org</userinput>
example.FreeBSD.org has address 204.216.27.XX</screen>

      <para>Neste exemplo, as mensagens enviadas diretamente para <email role="nolink">yourlogin@exemplo.FreeBSD.org</email> devem funcionar sem problemas, supondo que o <application>Sendmail</application> esteja sendo executado corretamente em <systemitem class="fqdomainname">example.FreeBSD.org</systemitem>.</para>

      <para>Para este exemplo:</para>

      <screen><prompt>#</prompt> <userinput>host example.FreeBSD.org</userinput>
example.FreeBSD.org has address 204.216.27.XX
example.FreeBSD.org mail is handled (pri=10) by nevdull.FreeBSD.org</screen>

      <para>Todas as mensagens enviadas para <systemitem class="fqdomainname">exemple.FreeBSD.org</systemitem> serão coletadas no <systemitem>hub</systemitem> sob o mesmo nome de usuário, em vez de serem enviadas diretamente para o seu host.</para>

      <para>As informações acima são tratadas pelo servidor <acronym>DNS</acronym>. O registro <acronym>DNS</acronym> que possui as informações de roteamento de email é a entrada <acronym>MX</acronym>. Se não existir nenhum registro <acronym>MX</acronym>, os emails serão entregues diretamente ao host por meio de seu endereço IP.</para>

      <para>A entrada <acronym>MX</acronym> de <systemitem class="fqdomainname">freefall.FreeBSD.org</systemitem> uma vez foi assim:</para>

      <programlisting>freefall		MX	30	mail.crl.net
freefall		MX	40	agora.rdrop.com
freefall		MX	10	freefall.FreeBSD.org
freefall		MX	20	who.cdrom.com</programlisting>

      <para><systemitem>freefall</systemitem> teve muitas entradas <acronym>MX</acronym>. O menor número <acronym>MX</acronym> é o host que recebe email diretamente, se disponível. Se não for acessível por algum motivo, o próximo host de número mais baixo aceitará as mensagens temporariamente e as transmitirá quando um host de número inferior for disponibilizado.</para>

      <para>Sites alternativos de <acronym>MX</acronym> devem ter conexões de Internet separadas para serem mais úteis. Seu <acronym>ISP</acronym> pode fornecer este serviço.</para>
    </sect2>

    <sect2 xml:id="mail-domain">
      <title>Email para um Domínio</title>

      <para>Ao configurar um <acronym>MTA</acronym> para uma rede, qualquer mensagem enviada para hosts em seu domínio deve ser desviada para o <acronym>MTA</acronym> para que os usuários possam receber seus emails no servidor de email principal.</para>

      <indexterm><primary>DNS</primary></indexterm>
      <para>Para tornar a vida mais fácil, uma conta de usuário com o mesmo <emphasis>username</emphasis> deve existir tanto no <acronym>MTA</acronym> como no sistema com o <acronym>MUA</acronym>. Use <citerefentry><refentrytitle>adduser</refentrytitle><manvolnum>8</manvolnum></citerefentry> para criar as contas de usuário.</para>

      <para>O <acronym>MTA</acronym> deve ser o servidor de mensagens designado para cada estação de trabalho na rede. Isso é feito na configuração <acronym>DNS</acronym> com um registro <acronym>MX</acronym>:</para>

      <programlisting>example.FreeBSD.org	A	204.216.27.XX		; Workstation
			MX	10 nevdull.FreeBSD.org	; Mailhost</programlisting>

      <para>Isso redirecionará o email para a estação de trabalho para o <acronym>MTA</acronym>, não importa onde o registro A aponta. O email é enviado para o host <acronym>MX</acronym>.</para>

      <para>Isso deve ser configurado em um servidor <acronym>DNS</acronym>. Se a rede não executar seu próprio servidor <acronym>DNS</acronym>, fale com o <acronym>ISP</acronym> ou provedor <acronym>DNS</acronym>.</para>

      <para>A seguir, um exemplo de hospedagem de email virtual. Considere um cliente com o domínio <systemitem class="fqdomainname">customer1.org</systemitem>, onde todas as mensagens para <systemitem class="fqdomainname">customer1.org</systemitem> devem ser enviadas para <systemitem class="fqdomainname">mail.myhost.com</systemitem>. A entrada <acronym>DNS</acronym> deve ficar assim:</para>

      <programlisting>customer1.org		MX	10	mail.myhost.com</programlisting>

      <para>Um registro <literal>A</literal> <emphasis>não</emphasis> é necessário em <systemitem class="fqdomainname">customer1.org</systemitem> para que seja enviado emails para esse domínio. No entanto, um <command>ping</command> em <systemitem class="fqdomainname">customer1.org</systemitem> não funcionará, a menos que exista um registro <literal>A</literal> para ele.</para>

      <para>Diga ao <acronym>MTA</acronym> quais domínios e/ou nomes de host que ele deve aceitar emails. Qualquer um dos itens a seguir funcionará para o <application>Sendmail</application>:</para>

      <itemizedlist>
	<listitem>
	  <para>Adicione os hosts ao <filename>/etc/mail/local-host-names</filename> ao usar <literal>FEATURE (use_cw_file)</literal>.</para>
	</listitem>

	<listitem>
	  <para>Adicione uma linha <literal>Cwyour.host.com</literal> em <filename>/etc/sendmail.cf</filename>.</para>
	</listitem>
      </itemizedlist>
    </sect2>
  </sect1>

  <sect1 xml:id="outgoing-only">
    <info>
      <title>Configurando Apenas Envio</title>

      <authorgroup>
	<author><personname> <firstname>Bill</firstname> <surname>Moran</surname> </personname> <contrib>Contributed by </contrib></author>
      </authorgroup>
    </info>

    <para>Há muitos casos em que muitas instâncias podem querer enviar email através de um relay. Alguns exemplos são:</para>

    <itemizedlist>
      <listitem>
	<para>O computador é uma máquina desktop que precisa usar programas como <citerefentry> <refentrytitle>mail</refentrytitle><manvolnum>1</manvolnum></citerefentry>, usando o relay de email do <acronym>ISP</acronym>.</para>
      </listitem>

      <listitem>
	<para>O computador é um servidor que não manipula emails localmente, mas precisa passar todos os emails para um relay para processamento.</para>
      </listitem>
    </itemizedlist>

    <para>Embora qualquer <acronym>MTA</acronym> seja capaz de preencher esse nicho específico, pode ser difícil configurar adequadamente um <acronym>MTA</acronym> com todos os recursos apenas para lidar com o descarregamento de email. Programas como <application>Sendmail</application> e <application>Postfix</application> são um exagero para esse uso.</para>

    <para>Além disso, um acordo típico de serviço de acesso à Internet pode proibir a execução de um <quote>servidor de email</quote>.</para>

    <para>A maneira mais fácil de atender a essas necessidades é instalar o port <package>mail/ssmtp</package>:</para>

    <screen><prompt>#</prompt> <userinput>cd /usr/ports/mail/ssmtp</userinput>
<prompt>#</prompt> <userinput>make install replace clean</userinput></screen>

    <para>Uma vez instalado, o <package>mail/ssmtp</package> pode ser configurado em <filename>/usr/local/etc/ssmtp/ssmtp.conf</filename>:</para>

    <programlisting>root=yourrealemail@example.com
mailhub=mail.example.com
rewriteDomain=example.com
hostname=_HOSTNAME_</programlisting>

    <para>Use o endereço de email real para <systemitem class="username">root</systemitem>. Insira a retransmissão de mensagens de saída do <acronym>ISP</acronym> no lugar de <systemitem class="fqdomainname">mail.example.com</systemitem>. Alguns <acronym>ISP</acronym>s chamam isso de <quote>servidor de email de saída</quote> ou <quote>servidor SMTP</quote>.</para>

    <para>Certifique-se de desativar o <application>Sendmail</application>, incluindo o serviço de envio de mensagens. Veja <xref linkend="mail-disable-sendmail"/> para detalhes.</para>

    <para><package>mail/ssmtp</package> tem algumas outras opções disponíveis. Consulte os exemplos em <filename>/usr/local/etc/ssmtp</filename> ou na página de manual do <application>ssmtp</application> para obter mais informações.</para>

    <para>A configuração do <application>ssmtp</application> dessa maneira permite que qualquer software no computador que precise enviar mensagens funcione corretamente, sem violar a política de uso dos <acronym>ISP</acronym>s ou permitindo que o computador seja sequestrado para envio de spam.</para>
  </sect1>

  <sect1 xml:id="SMTP-dialup">
    <title>Usando Email com uma Conexão Dialup</title>

    <para>Ao usar um endereço IP estático, não é necessário ajustar a configuração padrão. Configure o nome do host para o nome da Internet designado e o <application>Sendmail</application> fará o resto.</para>

    <para>Ao usar um endereço IP atribuído dinamicamente e uma conexão PPP de discagem à Internet, geralmente há uma caixa de correio no servidor de email do <acronym>ISP</acronym>. Neste exemplo, o domínio do <acronym>ISP</acronym> é <systemitem class="fqdomainname">example.net</systemitem>, o nome de usuário é <systemitem class="username">user</systemitem>, o nome do host é <systemitem class="fqdomainname">bsd.home</systemitem>, e o <acronym>ISP</acronym> permitiu <systemitem class="fqdomainname">relay.example.net</systemitem> como um relay de email.</para>

    <para>Para baixar emails da caixa de correio do <acronym>ISP</acronym>, instale um agente pela coleção de ports. O <package>mail/fetchmail</package> é uma boa escolha, pois suporta muitos protocolos diferentes. Normalmente, o <acronym>ISP</acronym> fornecerá <acronym>POP</acronym>. Ao usar o usuário <acronym>PPP</acronym>, o email pode ser baixado automaticamente quando uma conexão com a Internet é estabelecida com a seguinte entrada em <filename>/etc/ppp/ppp.linkup</filename>:</para>

    <programlisting>MYADDR:
!bg su user -c fetchmail</programlisting>

    <para>Ao usar o <application>Sendmail</application> para entregar emails em contas não locais, configure o <application>Sendmail</application> para processar a fila de mensagens assim que a conexão com a Internet for estabelecida. Para fazer isso, adicione esta linha após a entrada <command>fetchmail</command> acima em <filename>/etc/ppp/ppp.linkup</filename>:</para>

    <programlisting>  !bg su user -c "sendmail -q"</programlisting>

    <para>Neste exemplo, há uma conta para <systemitem class="username">user</systemitem>em<systemitem class="fqdomainname">bsd.home</systemitem>. No diretório home de <systemitem class="username">user</systemitem> em <systemitem class="fqdomainname">bsd.home</systemitem>, crie um <filename>.fetchmailrc</filename> que contenha esta linha :</para>

    <programlisting>poll example.net protocol pop3 fetchall pass MySecret</programlisting>

    <para>Este arquivo não deve ter permissão de leitura para ninguém, exceto pelo <systemitem class="username">user</systemitem>, pois contém a senha <literal>MySecret</literal>.</para>

    <para>Para enviar emails com o cabeçalho correto <literal>from:</literal>, configure o <application>Sendmail</application> para usar <email>user@example.net</email> em vez de <email role="nolink">user@bsd.home</email> e para enviar todos os emails através de <systemitem class="fqdomainname">relay.example.net</systemitem>, permitindo uma transmissão de email mais rápida.</para>

    <para>O seguinte <filename>.mc</filename> deve ser suficiente:</para>

    <programlisting>VERSIONID(`bsd.home.mc version 1.0')
OSTYPE(bsd4.4)dnl
FEATURE(nouucp)dnl
MAILER(local)dnl
MAILER(smtp)dnl
Cwlocalhost
Cwbsd.home
MASQUERADE_AS(`example.net')dnl
FEATURE(allmasquerade)dnl
FEATURE(masquerade_envelope)dnl
FEATURE(nocanonify)dnl
FEATURE(nodns)dnl
define(`SMART_HOST', `relay.example.net')
Dmbsd.home
define(`confDOMAIN_NAME',`bsd.home')dnl
define(`confDELIVERY_MODE',`deferred')dnl</programlisting>

    <para>Consulte a seção anterior para obter detalhes sobre como converter esse arquivo no formato <filename>sendmail.cf</filename>. Não esqueça de reiniciar o <application>Sendmail</application> após atualizar o <filename>sendmail.cf</filename>.</para>
  </sect1>

  <sect1 xml:id="SMTP-Auth">
    <info>
      <title>Autenticação SMTP</title>

      <authorgroup>
	<author><personname> <firstname>James</firstname> <surname>Gorham</surname> </personname> <contrib>Written by </contrib></author>
      </authorgroup>
    </info>

    <para>Configurar a autenticação <acronym>SMTP</acronym> no <acronym>MTA</acronym> oferece vários benefícios. A autenticação <acronym>SMTP</acronym> adiciona uma camada de segurança ao <application>Sendmail</application> e fornece aos usuários móveis que alternam os hosts a capacidade de usar o mesmo <acronym>MTA</acronym> sem a necessidade de reconfigurar as configurações de seus clientes de email a cada vez.</para>

    <procedure>
      <step>
	<para>Instale o <package>security/cyrus-sasl2</package> da Coleção de Ports. Este port suporta várias opções de tempo de compilação. Para o método de autenticação SMTP demonstrado neste exemplo, certifique-se de que <option>LOGIN</option> não esteja desabilitado.</para>
      </step>


      <step>
	<para>Depois de instalar o <package>security/cyrus-sasl2</package>, edite o <filename>/usr/local/lib/sasl2/Sendmail.conf</filename>, ou crie-o se ele não existir, e adicione a seguinte linha :</para>

	<programlisting>pwcheck_method: saslauthd</programlisting>
      </step>

      <step>
	<para>Em seguida, instale o <package>security/cyrus-sasl2-saslauthd</package> e adicione a seguinte linha ao <filename>/etc/rc.conf</filename>:</para>

	<programlisting>saslauthd_enable="YES"</programlisting>

	<para>Finalmente, inicie o daemon saslauthd:</para>

	<screen><prompt>#</prompt> <userinput>service saslauthd start</userinput></screen>

	<para>Este daemon serve como um intermediário para o <application>Sendmail</application> autenticar no banco de dados do FreeBSD o <citerefentry><refentrytitle>passwd</refentrytitle><manvolnum>5</manvolnum></citerefentry>. Isso evita o trabalho de criar um novo conjunto de nomes de usuário e senhas para cada usuário que precise usar a autenticação <acronym>SMTP</acronym> e mantém a senha de login e email igual.</para>
      </step>

      <step>
	<para>Em seguida, edite o <filename>/etc/make.conf</filename> e adicione as seguintes linhas:</para>

	<programlisting>SENDMAIL_CFLAGS=-I/usr/local/include/sasl -DSASL
SENDMAIL_LDADD=/usr/local/lib/libsasl2.so</programlisting>

	<para>Essas linhas fornecem ao <application>Sendmail</application> as opções de configuração apropriadas para vincular ao <package>cyrus-sasl2</package> em tempo de compilação. Certifique-se de que o <package>cyrus-sasl2</package> tenha sido instalado antes de recompilar o <application>Sendmail</application>.</para>
      </step>

      <step>
	<para>Recompile o <application>Sendmail</application> executando os seguintes comandos:</para>

	<screen><prompt>#</prompt> <userinput>cd /usr/src/lib/libsmutil</userinput>
<prompt>#</prompt> <userinput>make cleandir &amp;&amp; make obj &amp;&amp; make</userinput>
<prompt>#</prompt> <userinput>cd /usr/src/lib/libsm</userinput>
<prompt>#</prompt> <userinput>make cleandir &amp;&amp; make obj &amp;&amp; make</userinput>
<prompt>#</prompt> <userinput>cd /usr/src/usr.sbin/sendmail</userinput>
<prompt>#</prompt> <userinput>make cleandir &amp;&amp; make obj &amp;&amp; make &amp;&amp; make install</userinput></screen>

	<para>Esta compilação não deve ter nenhum problema se o <filename>/usr/src</filename> não foi alterado extensivamente e as bibliotecas compartilhadas necessárias estiverem disponíveis.</para>
      </step>

      <step>
	<para>Depois que o <application>Sendmail</application> tenha sido compilado e reinstalado, edite o <filename>/etc/mail/freebsd.mc</filename> ou o arquivo local <filename>.mc</filename>. Muitos administradores optam por usar a saída de <citerefentry><refentrytitle>hostname</refentrytitle><manvolnum>1</manvolnum></citerefentry> como o nome de <filename>.mc</filename> para exclusividade. Adicione estas linhas:</para>

	<programlisting>dnl set SASL options
TRUST_AUTH_MECH(`GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN')dnl
define(`confAUTH_MECHANISMS', `GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN')dnl</programlisting>

	<para>Essas opções configuram os diferentes métodos disponíveis para que o <application>Sendmail</application> autentique usuários. Para usar um método diferente de <application>pwcheck</application>, consulte a documentação do <application>Sendmail</application>.</para>
      </step>

      <step>
	<para>Finalmente, execute <citerefentry><refentrytitle>make</refentrytitle><manvolnum>1</manvolnum></citerefentry> enquanto estiver em <filename>/etc/mail</filename>. Isso executará o novo <filename>.mc</filename> e criará um <filename>.cf</filename> chamado <filename>freebsd.cf</filename> ou o nome usado para o arquivo local <filename>.mc</filename>. Em seguida, execute <command>make install restart</command>, que copiará o arquivo para o <filename>sendmail.cf</filename>, e reinicie corretamente o <application>Sendmail</application>. Para mais informações sobre este processo, consulte <filename>/etc/mail/Makefile</filename>.</para>
      </step>
    </procedure>

    <para>Para testar a configuração, use um <acronym>MUA</acronym> para enviar uma mensagem de teste. Para investigações posteriores, defina o <option>LogLevel</option> do <application>Sendmail</application> como <literal>13</literal> e verifique o <filename>/var/log/maillog</filename> para quaisquer erros.</para>

    <para>Para mais informações, consulte <link xlink:href="http://www.sendmail.org/~ca/email/auth.html">autenticação <acronym>SMTP</acronym></link>.</para>
  </sect1>

  <sect1 xml:id="mail-agents">
    <info>
      <title>Mail User Agents</title>

      <authorgroup>
	<author><personname> <firstname>Marc</firstname> <surname>Silver</surname> </personname> <contrib>Contributed by </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>Mail User Agents</primary></indexterm>

    <para>Um <acronym>MUA</acronym> é um aplicativo usado para enviar e receber emails. À medida que o email <quote>evolui</quote> e se torna mais complexo, os <acronym>MUA</acronym>s estão se tornando cada vez mais poderosos e fornecem aos usuários maior funcionalidade e flexibilidade. A categoria <literal>mail</literal> da Coleção de Ports do FreeBSD contém numerosos <acronym>MUA</acronym>s. Eles incluem clientes de email gráficos como <application>Evolution</application> ou <application>Balsa</application> e clientes baseados em console, como <application>mutt</application> ou <application>alpine</application>.</para>

    <sect2 xml:id="mail-command">
      <title><command>mail</command></title>

      <para><citerefentry><refentrytitle>mail</refentrytitle><manvolnum>1</manvolnum></citerefentry> é o <acronym>MUA</acronym> padrão instalado com o FreeBSD. É um <acronym>MUA</acronym> baseado em console que oferece a funcionalidade básica necessária para enviar e receber email em texto. Ele fornece suporte limitado a anexos e só pode acessar caixas de correio locais.</para>

      <para>Embora o <command>mail</command> não suporte nativamente a interação com os servidores <acronym>POP</acronym> ou <acronym>IMAP</acronym>, essas caixas de correio podem ser baixadas para um arquivo <filename>mbox</filename> local usando um aplicativo como <application>fetchmail</application>.</para>

      <para>Para enviar e receber email, execute <command>mail</command>:</para>

      <screen><prompt>%</prompt> <userinput>mail</userinput></screen>

      <para>O conteúdo da caixa de correio do usuário em <filename>/var/mail</filename> é lido automaticamente pelo <command>mail</command>. Se a caixa de correio estiver vazia, o utilitário sairá com uma mensagem indicando que nenhum email foi encontrado. Se o email existir, a interface do aplicativo será iniciada e uma lista de mensagens será exibida. As mensagens são numeradas automaticamente, como pode ser visto no exemplo a seguir:</para>

      <screen>Mail version 8.1 6/6/93.  Type ? for help.
"/var/mail/marcs": 3 messages 3 new
&gt;N  1 root@localhost        Mon Mar  8 14:05  14/510   "test"
 N  2 root@localhost        Mon Mar  8 14:05  14/509   "user account"
 N  3 root@localhost        Mon Mar  8 14:05  14/509   "sample"</screen>

      <para>Agora as mensagens podem ser lidas digitando <keycap>t</keycap> seguido pelo número da mensagem. Este exemplo lê o primeiro email:</para>

      <screen>&amp; <userinput>t 1</userinput>
Message 1:
From root@localhost  Mon Mar  8 14:05:52 2004
X-Original-To: marcs@localhost
Delivered-To: marcs@localhost
To: marcs@localhost
Subject: test
Date: Mon,  8 Mar 2004 14:05:52 +0200 (SAST)
From: root@localhost (Charlie Root)

This is a test message, please reply if you receive it.</screen>

      <para>Como visto neste exemplo, a mensagem será exibida com cabeçalhos completos. Para exibir novamente a lista de mensagens, pressione <keycap>h</keycap>.</para>

      <para>Se o email exigir uma resposta, pressione as teclas <keycap>R</keycap> ou <keycap>r</keycap> no <command>mail</command>. <keycap>R</keycap> instrui o <command>mail</command> a responder apenas ao remetente do email, enquanto <keycap>r</keycap> responde a todos os outros destinatários da mensagem. Esses comandos podem ser sufixados com o número do email. Depois de digitar a resposta, o final da mensagem deve ser marcado por um único <keycap>.</keycap> em sua própria linha. Um exemplo pode ser visto abaixo:</para>

      <screen>&amp; <userinput>R 1</userinput>
To: root@localhost
Subject: Re: test

<userinput>Thank you, I did get your email.
.</userinput>
EOT</screen>

      <para>Para enviar um novo email, pressione <keycap>m</keycap>, seguido pelo endereço de email do destinatário. Vários destinatários podem ser especificados separando cada endereço com o delimitador <keycap>,</keycap>. O assunto da mensagem pode então ser inserido, seguido pelo conteúdo da mensagem. O final da mensagem deve ser especificado colocando um único <keycap>.</keycap> em sua própria linha.</para>

      <screen>&amp; <userinput>mail root@localhost</userinput>
Subject: <userinput>I mastered mail

Now I can send and receive email using mail ... :)
.</userinput>
EOT</screen>

      <para>Enquanto estiver usando o <command>mail</command>, pressione <keycap>?</keycap> para exibir a ajuda a qualquer momento. Consulte <citerefentry><refentrytitle>mail</refentrytitle><manvolnum>1</manvolnum></citerefentry> para obter mais detalhes sobre como usar o <command>mail</command>.</para>

      <note>
	<para>O <citerefentry><refentrytitle>mail</refentrytitle><manvolnum>1</manvolnum></citerefentry> não foi projetado para manipular anexos e, portanto, lida mal com eles. Novos <acronym>MUA</acronym>s lidam com anexos de uma maneira mais inteligente. Usuários que preferem usar <command>mail</command> podem preferir o port <package>converters/mpack</package>.</para>
      </note>
    </sect2>

    <sect2 xml:id="mutt-command">
      <title><application>mutt</application></title>

      <para>O <application>mutt</application> é um poderoso <acronym>MUA</acronym>, com muitos recursos, incluindo:</para>

      <itemizedlist>
	<listitem>
	  <para>A capacidade de enviar mensagens.</para>
	</listitem>

	<listitem>
	  <para>Suporte PGP para assinatura digital e criptografia de email.</para>
	</listitem>

	<listitem>
	  <para>Suporte MIME.</para>
	</listitem>

	<listitem>
	  <para>Suporte Maildir.</para>
	</listitem>

	<listitem>
	  <para>Altamente personalizável.</para>
	</listitem>
      </itemizedlist>

      <para>Consulte <uri xlink:href="http://www.mutt.org">http://www.mutt.org</uri> para mais informações sobre o <application>mutt</application>.</para>

      <para>O <application>mutt</application> pode ser instalado usando o port <package>mail/mutt</package>. Após o port ter sido instalado, o <application>mutt</application> pode ser iniciado com o seguinte comando:</para>

      <screen><prompt>%</prompt> <userinput>mutt</userinput></screen>

      <para>O <application>mutt</application>  irá automaticamente ler o conteúdo da caixa de correio do usuário em <filename>/var/mail</filename>. Se nenhum email for encontrado, o <application>mutt</application> aguardará os comandos do usuário. O exemplo abaixo mostra o <application>mutt</application> exibindo uma lista de mensagens:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="mail/mutt1"/>
	</imageobject>
      </mediaobject>

      <para>Para ler um email, selecione-o usando as teclas de cursor e pressione <keycap>Enter</keycap>. Um exemplo de email exibido pelo <application>mutt</application> pode ser visto abaixo:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="mail/mutt2"/>
	</imageobject>
      </mediaobject>

      <para>Semelhante ao <citerefentry><refentrytitle>mail</refentrytitle><manvolnum>1</manvolnum></citerefentry>, o <application>mutt</application> pode ser usado para responder apenas ao remetente da mensagem, bem como para todos os destinatários. Para responder apenas ao remetente do email, pressione <keycap>r</keycap>. Para enviar uma resposta de grupo ao remetente original e a todos os destinatários da mensagem, pressione <keycap>g</keycap>.</para>

      <note>
	<para>Por padrão, o <application>mutt</application> usa o editor <citerefentry><refentrytitle>vi</refentrytitle><manvolnum>1</manvolnum></citerefentry> para criar e responder emails. Cada usuário pode personalizar isso criando ou editando o <filename>.muttrc</filename> em seu diretório home e configurando a variável <literal>editor</literal> ou definindo a variável de ambiente <envar>EDITOR</envar>. Consulte <uri xlink:href="http://www.mutt.org/">http://www.mutt.org/</uri> para obter mais informações sobre como configurar o <application>mutt</application>.</para>
      </note>

      <para>Para escrever uma nova mensagem de email, pressione <keycap>m</keycap>. Depois que um assunto válido foi dado, <application>mutt</application> iniciará o <citerefentry><refentrytitle>vi</refentrytitle><manvolnum>1</manvolnum></citerefentry> para que o email possa ser escrito. Quando o conteúdo do email estiver completo, salve e saia do <command>vi</command>. O <application>mutt</application> será retomado, exibindo uma tela de resumo do email que será enviado. Para enviar o email, pressione <keycap>y</keycap>. Um exemplo da tela de resumo pode ser visto abaixo:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="mail/mutt3"/>
	</imageobject>
      </mediaobject>

      <para>O <application>mutt</application> contém manuais extensos que podem ser acessados pela maioria dos menus pressionando <keycap>?</keycap>. A linha superior também exibe os atalhos de teclado, quando apropriado.</para>

    </sect2>

    <sect2 xml:id="alpine-command">
      <title><application>alpine</application></title>

      <para>O <application>alpine</application> é destinado a um usuário iniciante, mas também inclui alguns recursos avançados.</para>

      <warning>
	<para>O <application>alpine</application> teve várias vulnerabilidades remotas descobertas no passado, que permitiam que atacantes remotos executassem código arbitrário como usuários no sistema local, pela ação de enviar um email especialmente preparado. Enquanto problemas <emphasis>conhecidos</emphasis> foram corrigidos, o código <application>alpine</application> foi escrito em um estilo inseguro e o FreeBSD Security Officer acredita que provavelmente há outras vulnerabilidades não descobertas. Os usuários instalam o <application>alpine</application> por sua conta e risco.</para>
      </warning>

      <para>A versão atual do <application>alpine</application> pode ser instalada usando o port <package>mail/alpine</package>. Após a instalação do port, o <application>alpine</application> pode ser iniciado executando o seguinte comando:</para>

      <screen><prompt>%</prompt> <userinput>alpine</userinput></screen>

      <para>A primeira vez que o <application>alpine</application> é executado, ele exibe uma página de saudação com uma breve introdução, bem como uma solicitação da equipe de desenvolvimento do <application>alpine</application> para enviar uma mensagem de email anônima para que eles saibam quantos usuários estão usando o seu cliente. Para enviar esta mensagem anônima, pressione <keycap>Enter</keycap>. Como alternativa, pressione <keycap>E</keycap> para sair da saudação sem enviar uma mensagem anônima. Um exemplo da página de saudação é mostrado abaixo:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="mail/pine1"/>
	</imageobject>
      </mediaobject>

      <para>O menu principal é então apresentado, o qual pode ser navegado usando as teclas de cursor. Esse menu principal fornece atalhos para a composição de novos emails, navegação em diretórios de email e administração de entradas do catálogo de endereços. Abaixo do menu principal, são mostrados os atalhos de teclado relevantes para executar funções específicas da tarefa em questão.</para>

      <para>O diretório padrão aberto pelo <application>alpine</application> é o <filename>inbox</filename>. Para visualizar o índice da mensagem, pressione <keycap>I</keycap> ou selecione a opção <guimenuitem>MESSAGE INDEX</guimenuitem> mostrada abaixo:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="mail/pine2"/>
	</imageobject>
      </mediaobject>

      <para>O índice de mensagens mostra mensagens no diretório atual e pode ser navegado usando as teclas de cursor. As mensagens destacadas podem ser lidas pressionando <keycap>Enter</keycap>.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="mail/pine3"/>
	</imageobject>
      </mediaobject>

      <para>Na captura de tela abaixo, uma mensagem de exemplo é exibida pelo <application>alpine</application>. Atalhos de teclado contextuais são exibidos na parte inferior da tela. Um exemplo de um atalho é <keycap>r</keycap>, que diz ao <acronym>MUA</acronym> para responder à mensagem atual sendo exibida.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="mail/pine4"/>
	</imageobject>
      </mediaobject>

      <para>A resposta de um email pelo <application>alpine</application> é feita usando o editor <application>pico</application>, que é instalado por padrão com o <application>alpine</application>. O <application>pico</application> facilita a navegação na mensagem e é mais fácil de ser usado por usuários iniciantes do que o <citerefentry><refentrytitle>vi</refentrytitle><manvolnum>1</manvolnum> </citerefentry> ou <citerefentry><refentrytitle>mail</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Quando a resposta estiver completa, a mensagem pode ser enviada pressionando <keycombo action="simul"><keycap>Ctrl</keycap><keycap>X</keycap></keycombo>. O <application>alpine</application> solicitará confirmação antes de enviar a mensagem.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="mail/pine5"/>
	</imageobject>
      </mediaobject>

      <para>O <application>alpine</application> pode ser personalizado usando a opção <guimenuitem>SETUP</guimenuitem> no menu principal. Consulte <uri xlink:href="http://www.washington.edu/alpine/">http://www.washington.edu/alpine/</uri> para mais informações.</para>

    </sect2>
  </sect1>

  <sect1 xml:id="mail-fetchmail">
    <info>
      <title>Usando o <application>fetchmail</application></title>

      <authorgroup>
	<author><personname> <firstname>Marc</firstname> <surname>Silver</surname> </personname> <contrib>Contributed by </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>fetchmail</primary></indexterm>

    <para>O <application>fetchmail</application> é um cliente <acronym>IMAP</acronym> e <acronym>POP</acronym> completo. Ele permite que os usuários baixem automaticamente emails de servidores <acronym>IMAP</acronym> e <acronym>POP</acronym> remotos e os salvem em caixas de correio locais, onde podem ser acessados mais facilmente. O <application>fetchmail</application> pode ser instalado usando o port <package>mail/fetchmail</package> e oferece vários recursos, incluindo:</para>

    <itemizedlist>
      <listitem>
	<para>Suporte para os protocolos <acronym>POP3</acronym>, o <acronym>APOP</acronym>, o <acronym>KPOP</acronym>, o <acronym>IMAP</acronym>, o <acronym>ETRN</acronym> e o <acronym>ODMR</acronym>.</para>
      </listitem>

      <listitem>
	<para>Capacidade de encaminhar emails usando <acronym>SMTP</acronym>, que permite que a filtragem, o encaminhamento e aliases funcionem normalmente.</para>
      </listitem>

      <listitem>
	<para>Pode ser executado no modo daemon para verificar periodicamente novas mensagens.</para>
      </listitem>

      <listitem>
	<para>Pode buscar várias caixas de correio e encaminhá-las, com base na configuração, para diferentes usuários locais.</para>
      </listitem>
    </itemizedlist>

    <para>Esta seção explica alguns dos recursos básicos do <application>fetchmail</application>. Este utilitário requer uma configuração <filename>.fetchmailrc</filename> no diretório pessoal do usuário para que seja executado corretamente. Este arquivo inclui informações do servidor, bem como credenciais de login. Devido à natureza sensível do conteúdo deste arquivo, é aconselhável torná-lo legível apenas pelo usuário, com o seguinte comando:</para>

    <screen><prompt>%</prompt> <userinput>chmod 600 .fetchmailrc</userinput></screen>

    <para>O seguinte <filename>.fetchmailrc</filename> serve como um exemplo para fazer o download de uma única caixa de correio de usuário usando <acronym>POP</acronym>. Ele diz ao <application>fetchmail</application> para se conectar ao <systemitem class="fqdomainname">example.com</systemitem> usando um nome de usuário <systemitem class="username">joesoap</systemitem> e uma senha de <literal>XXX</literal>. Este exemplo pressupõe que o usuário <systemitem class="username">joesoap</systemitem> exista no sistema local.</para>

    <programlisting>poll example.com protocol pop3 username "joesoap" password "XXX"</programlisting>

    <para>O próximo exemplo conecta-se a vários servidores <acronym>POP</acronym> e <acronym>IMAP</acronym> e redireciona para diferentes nomes de usuários locais quando aplicável:</para>

    <programlisting>poll example.com proto pop3:
user "joesoap", with password "XXX", is "jsoap" here;
user "andrea", with password "XXXX";
poll example2.net proto imap:
user "john", with password "XXXXX", is "myth" here;</programlisting>

    <para><application>fetchmail</application> pode ser executado no modo daemon executando-o com <option>-d</option>, seguido pelo intervalo (em segundos) que o <application>fetchmail</application> deve pesquisar servidores listados em <filename>.fetchmailrc</filename>. O exemplo a seguir configura o <application>fetchmail</application> para pesquisar a cada 600 segundos:</para>

    <screen><prompt>%</prompt> <userinput>fetchmail -d 600</userinput></screen>

    <para>Mais informações sobre o <application>fetchmail</application> podem ser encontradas em <uri xlink:href="http://www.fetchmail.info/">http://www.fetchmail.info/</uri>.</para>
  </sect1>

  <sect1 xml:id="mail-procmail">
    <info>
      <title>Usando o <application>procmail</application></title>

      <authorgroup>
	<author><personname> <firstname>Marc</firstname> <surname>Silver</surname> </personname> <contrib>Contributed by </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>procmail</primary></indexterm>

    <para>O <application>procmail</application> é um poderoso aplicativo usado para filtrar mensagens recebidas. Ele permite que os usuários definam <quote>regras</quote> que podem ser correspondidas aos emails recebidos para executar funções específicas ou para redirecionar o email para caixas de correio alternativas ou endereços de email. O <application>procmail</application> pode ser instalado usando o port <package>mail/procmail</package>. Uma vez instalado, ele pode ser diretamente integrado na maioria dos <acronym>MTA</acronym>s. Consulte a documentação do <acronym>MTA</acronym> para mais informações. Alternativamente, <application>procmail</application> pode ser integrado adicionando a seguinte linha a um <filename>.forward</filename> no diretório pessoal do usuário:</para>

    <programlisting>"|exec /usr/local/bin/procmail || exit 75"</programlisting>

    <para>A seção a seguir exibe algumas regras básicas do <application>procmail</application>, além de breves descrições do que elas fazem. As regras devem ser inseridas em um <filename>.procmailrc</filename>, que deve residir no diretório pessoal do usuário.</para>

    <para>A maioria dessas regras pode ser encontrada em <citerefentry vendor="ports"> <refentrytitle>procmailex</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>

    <para>Para encaminhar todos os emails de <email>user@example.com</email> para um endereço externo de <email role="nolink">goodmail@example2.com</email>:</para>

      <programlisting>:0
* ^From.*user@example.com
! goodmail@example2.com</programlisting>

    <para>Para encaminhar todos os emails com menos de 1000 bytes para um endereço externo de <email role="nolink">goodmail@example2.com</email>:</para>

      <programlisting>:0
* &lt; 1000
! goodmail@example2.com</programlisting>

    <para>Para enviar todas as mensagens enviadas para <email>alternate@example.com</email> para uma caixa de correio chamada <filename>alternate</filename>:</para>

    <programlisting>:0
* ^TOalternate@example.com
alternate</programlisting>

    <para>Para enviar todas as mensagens com um assunto de <quote>Spam</quote> para <filename>/dev/null</filename>:</para>

    <programlisting>:0
^Subject:.*Spam
/dev/null</programlisting>

    <para>Uma receita útil que analisa listas de discussão <systemitem class="fqdomainname">do FreeBSD.org</systemitem> e coloca cada lista em sua própria caixa de correio:</para>

    <programlisting>:0
* ^Sender:.owner-freebsd-\/[^@]+@FreeBSD.ORG
{
	LISTNAME=${MATCH}
	:0
	* LISTNAME??^\/[^@]+
	FreeBSD-${MATCH}
}</programlisting>
  </sect1>
</chapter>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<chapter version="5.0" xml:id="network-servers">
  <!--
  <chapterinfo>
    <authorgroup>
      <author>
	<firstname>Murray</firstname>
	<surname>Stokely</surname>
	<contrib>Reorganized by in July 2004</contrib>
      </author>
    </authorgroup>
  </chapterinfo>
  -->

  <title>Servidores de Rede</title>

  <sect1 xml:id="network-servers-synopsis">
    <title>Sinopse</title>

    <para>Este capítulo aborda alguns dos serviços de rede usados com mais frequência em sistemas <trademark class="registered">UNIX</trademark>. Isso inclui instalar, configurar, testar e manter muitos tipos diferentes de serviços de rede. Exemplos de arquivos de configuração estão incluídos neste capítulo para referência.</para>

    <para>No final deste capítulo, os leitores saberão:</para>

    <itemizedlist>
      <listitem>
	<para>Como gerenciar o daemon <application>inetd</application>.</para>
      </listitem>

      <listitem>
	<para>Como configurar o Network File System (<acronym>NFS</acronym>).</para>
      </listitem>

      <listitem>
	<para>Como configurar o Network Information Server (<acronym>NIS</acronym>) para centralizar e compartilhar contas de usuários.</para>
      </listitem>

      <listitem>
	<para>Como configurar o FreeBSD para funcionar como um servidor ou cliente <acronym>LDAP</acronym></para>
      </listitem>

      <listitem>
	<para>Como configurar configurações de rede automáticas usando o <acronym>DHCP</acronym>.</para>
      </listitem>

      <listitem>
	<para>Como configurar um Domain Name Server (<acronym>DNS</acronym>).</para>
      </listitem>

      <listitem>
	<para>Como configurar o servidor <application>Apache</application> <acronym>HTTP</acronym>.</para>
      </listitem>

      <listitem>
	<para>Como Configurar um Servidor de File Transfer Protocol (<acronym>FTP</acronym>).</para>
      </listitem>

      <listitem>
	<para>Como configurar um servidor de arquivo e de impressão para clientes <trademark class="registered">Windows</trademark> usando o <application>Samba</application>.</para>
      </listitem>

      <listitem>
	<para>Como sincronizar a hora e a data e configurar um servidor de horário usando o Network Time Protocol (<acronym>NTP</acronym>).</para>
      </listitem>

      <listitem>
	<para>Como configurar o <acronym>iSCSI</acronym>.</para>
      </listitem>
    </itemizedlist>

    <para>Este capítulo pressupõe um conhecimento básico de:</para>

    <itemizedlist>
      <listitem>
	<para>scripts <filename>/etc/rc</filename>.</para>
      </listitem>

      <listitem>
	<para>Terminologia de rede.</para>
      </listitem>

      <listitem>
	<para>Instalação de software adicional de terceiros (<xref linkend="ports"/>).</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="network-inetd">
    <title>O super-servidor <application>inetd</application></title>

    <!--
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Chern</firstname>
	  <surname>Lee</surname>
	  <contrib>Contributed by </contrib>
	</author>
      </authorgroup>
      <authorgroup>
	<author>
	  <contrib>Updated by </contrib>
	  <othername>The &os; Documentation Project</othername>
	</author>
      </authorgroup>
    </sect1info>
    -->

    <para>O daemon <citerefentry><refentrytitle>inetd</refentrytitle><manvolnum>8</manvolnum></citerefentry> é algumas vezes chamado de Super-Servidor porque gerencia conexões para muitos serviços. Em vez de iniciar vários aplicativos, apenas o serviço <application>inetd</application> precisa ser iniciado. Quando uma conexão é recebida para um serviço gerenciado pelo <application>inetd</application>, ele determina para qual programa a conexão está destinada, gera um processo para esse programa e delega ao programa um socket. O uso de <application>inetd</application> para serviços que não são muito usados pode reduzir a carga do sistema, quando comparado à execução de cada daemon individualmente no modo independente.</para>

    <para>Primeiramente, <application>inetd</application> é usado para gerar outros daemons, mas vários protocolos triviais são tratados internamente, como <application>chargen</application>, <application>auth</application>, <application>time</application>, <application>echo</application>, <application>discard</application> e <application>daytime</application>.</para>

    <para>Esta seção aborda os conceitos básicos da configuração do <application>inetd</application>.</para>

    <sect2 xml:id="network-inetd-conf">
      <title>Arquivo de Configuração</title>

      <para>A configuração do <application>inetd</application> é feita editando o <filename>/etc/inetd.conf</filename>. Cada linha deste arquivo de configuração representa um aplicativo que pode ser iniciado pelo <application>inetd</application>. Por padrão, cada linha começa com um comentário (<literal>#</literal>), o que significa que <application>inetd</application> não está atendendo a nenhum aplicativo. Para configurar o <application>inetd</application> para escutar as conexões de um aplicativo, remova o <literal>#</literal> no início da linha desse aplicativo.</para>

      <para>Depois de salvar suas edições, configure o <application>inetd</application> para iniciar na inicialização do sistema editando o arquivo <filename>/etc/rc.conf</filename>:</para>

      <programlisting>inetd_enable="YES"</programlisting>

      <para>Para iniciar o <application>inetd</application> agora, para que ele ouça o serviço que você configurou, digite:</para>

      <screen><prompt>#</prompt> <userinput>service inetd start</userinput></screen>

      <para>Uma vez iniciado o <application>inetd</application>, ele precisa ser notificado sempre que uma modificação for feita no arquivo <filename>/etc/inetd.conf</filename>:</para>

      <example xml:id="network-inetd-reread">
	<title>Recarregando o Arquivo de Configuração do <application>inetd</application></title>

	<screen><prompt>#</prompt> <userinput>service inetd reload</userinput></screen>
      </example>

      <para>Normalmente, a entrada padrão de um aplicativo não precisa ser editada além da remoção do <literal>#</literal>. Em algumas situações, pode ser apropriado editar a entrada padrão.</para>

      <para>Como exemplo, esta é a entrada padrão para <citerefentry><refentrytitle>ftpd</refentrytitle><manvolnum>8</manvolnum></citerefentry> sobre o IPv4:</para>

      <programlisting>ftp     stream  tcp     nowait  root    /usr/libexec/ftpd       ftpd -l</programlisting>

      <para>As sete colunas em uma entrada são as seguintes:</para>

      <programlisting>service-name
socket-type
protocol
{wait|nowait}[/max-child[/max-connections-per-ip-per-minute[/max-child-per-ip]]]
user[:group][/login-class]
server-program
server-program-arguments</programlisting>

      <para>Onde:</para>

      <variablelist>
	<varlistentry>
	  <term>service-name</term>

	  <listitem>
	    <para>O nome do serviço do daemon para iniciar. Deve corresponder a um serviço listado no arquivo <filename>/etc/services</filename>. Isso determina qual porta <application>inetd</application> atende para conexões de entrada para esse serviço. Ao usar um serviço personalizado, ele deve primeiro ser adicionado ao arquivo <filename>/etc/services</filename>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>socket-type</term>

	  <listitem>
	    <para>Ou <literal>stream</literal>, <literal>dgram</literal>, <literal>raw</literal>, ou <literal>seqpacket</literal>. Use <literal>stream</literal> para conexões TCP e <literal>dgram</literal> para serviços <acronym>UDP</acronym>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>protocol</term>

	  <listitem>
	    <para>Use um dos seguintes nomes de protocolo:</para>

	    <informaltable frame="none" pgwide="1">
	      <tgroup cols="2">
		<thead>
		  <row>
		    <entry>Protocol Name</entry>
		    <entry>Explicação</entry>
		  </row>
		</thead>

		<tbody>
		  <row>
		    <entry>tcp ou tcp4</entry>
		    <entry>TCP IPv4</entry>
		  </row>

		  <row>
		    <entry>udp ou udp4</entry>
		    <entry><acronym>UDP</acronym> IPv4</entry>
		  </row>

		  <row>
		    <entry>tcp6</entry>
		    <entry>TCP IPv6</entry>
		  </row>

		  <row>
		    <entry>udp6</entry>
		    <entry><acronym>UDP</acronym> IPv6</entry>
		  </row>

		  <row>
		    <entry>tcp46</entry>
		    <entry>Ambos TCP IPv4 e IPv6</entry>
		  </row>

		  <row>
		    <entry>udp46</entry>
		    <entry>Ambos <acronym>UDP</acronym> IPv4 e IPv6</entry>
		  </row>
		</tbody>
	      </tgroup>
	    </informaltable>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>{wait|nowait}[/max-child[/max-connections-per-ip-per-minute[/max-child-per-ip]]]</term>

	  <listitem>
	    <para>Neste campo, <option>wait</option> ou <option>nowait</option> deve ser especificado. <option>max-child</option>, <option>max-connections-per-ip-por-minute</option> e <option>max-child-per-ip</option> são opcionais.</para>

	    <para><option>wait|nowait</option> indica se o serviço pode ou não manipular seu próprio socket. Os tipos de socket <option>dgram</option> devem usar <option>wait</option> enquanto os daemons <option>stream</option>, que geralmente são multi-threaded, devem usar <option>nowait</option>. <option>wait</option> geralmente passa vários sockets para um único daemon, enquanto <option>nowait</option> gera um daemon filho para cada novo socket.</para>

	    <para>O número máximo de daemons <application>inetd</application>  que podem aparecer é definido por <option>max-child</option>. Por exemplo, para limitar dez instâncias do daemon, coloque um <literal>/10</literal> após o <option>nowait</option>. Especificar <literal>/0</literal> permite um número ilimitado de filhos.</para>

	    <para><option>max-connections-per-ip-per-minute</option> limita o número de conexões de qualquer endereço específico de <acronym>IP</acronym> por minuto. Quando o limite for atingido, outras conexões desse endereço IP serão descartadas até o final do minuto. Por exemplo, um valor de <literal>/10</literal> limitaria qualquer endereço <acronym>IP</acronym> específico a dez tentativas de conexão por minuto. <option>max-child-per-ip</option> limita o número de processos-filhos que podem ser iniciados em nome de um único endereço <acronym>IP</acronym> a qualquer momento. Essas opções podem limitar o consumo excessivo de recursos e ajudar a impedir ataques de negação de serviço (DoS (Denial Of Service)).</para>

	    <para>Um exemplo pode ser visto nas configurações padrão para <citerefentry><refentrytitle>fingerd</refentrytitle><manvolnum>8</manvolnum></citerefentry>:</para>

	    <programlisting>finger stream  tcp     nowait/3/10 nobody /usr/libexec/fingerd fingerd -k -s</programlisting>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>usuário</term>

	  <listitem>
	    <para>O nome de usuário que o daemon será executado como. Daemons geralmente são executados como <systemitem class="username">root</systemitem>, <systemitem class="username">daemon</systemitem>, ou <systemitem class="username">nobody</systemitem>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>programa servidor</term>

	  <listitem>
	    <para>O caminho completo para o daemon. Se o daemon for um serviço fornecido pelo <application>inetd</application> internamente, use <option>internal</option>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>argumentos do programa servidor</term>

	  <listitem>
	    <para>Usado para especificar qualquer argumento de comando a ser transmitido ao daemon na chamada. Se o daemon for um serviço interno, use <option>internal</option>.</para>
	  </listitem>
	</varlistentry>
      </variablelist>
    </sect2>

    <sect2 xml:id="network-inetd-cmdline">
      <title>Opções de linha de comando</title>

      <para>Como a maioria dos daemons de servidor, o <application>inetd</application> tem várias opções que podem ser usadas para modificar seu comportamento. Por padrão, <application>inetd</application> é iniciado com <literal>-wW -C 60</literal>. Essas opções ativam TCP wrappers para todos os serviços, incluindo serviços internos, e impedem que qualquer endereço de <acronym>IP</acronym> solicite qualquer serviço mais de 60 vezes por minuto.</para>

      <para>Para alterar as opções padrão que são passadas para <application>inetd</application>, adicione uma entrada para <literal>inetd_flags</literal> no arquivo <filename>/etc/rc.conf</filename>. Se o <application>inetd</application> já estiver em execução, reinicie-o com <command>service inetd restart</command>.</para>

      <para>As opções disponíveis de limitação de taxa são:</para>

      <variablelist>
	<varlistentry>
	  <term>-c máximo</term>

	  <listitem>
	    <para>Especifique o número máximo padrão de chamadas simultâneas de cada serviço, em que o padrão é ilimitado. Pode ser sobrescrito com base no serviço usando <option>max-child</option> em <filename>/etc/inetd.conf</filename>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>-C taxa</term>

	  <listitem>
	    <para>Especifique o número máximo padrão de vezes por minuto que um serviço pode ser chamado a partir de um único endereço de <acronym>IP</acronym>. Pode ser substituído com base no serviço usando <option>max-connections-per-ip-por-minute</option> em <filename>/etc/inetd.conf</filename>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>-R taxa</term>

	  <listitem>
	    <para>Especifique o número máximo de vezes que um serviço pode ser chamado em um minuto, em que o padrão é <literal>256</literal>. Uma taxa de <literal>0</literal> permite um número ilimitado.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>-s máximo</term>

	  <listitem>
	    <para>Especifique o número máximo de vezes que um serviço pode ser chamado a partir de um único endereço <acronym>IP</acronym> a qualquer momento, em que o padrão é ilimitado. Pode ser sobrescrito com base no serviço usando <option>max-child-per-ip</option> no arquivo <filename>/etc/inetd.conf</filename>.</para>
	  </listitem>
	</varlistentry>
      </variablelist>

      <para>Opções adicionais estão disponíveis. Consulte <citerefentry><refentrytitle>inetd</refentrytitle><manvolnum>8</manvolnum></citerefentry> para a lista completa de opções.</para>
    </sect2>

    <sect2 xml:id="network-inetd-security">
      <title>Considerações de segurança</title>

      <para>Muitos dos daemons que podem ser gerenciados pelo <application>inetd</application> não são conscientes da segurança. Alguns daemons, como <application>fingerd</application>, podem fornecer informações que podem ser úteis para um invasor. Ative apenas os serviços necessários e monitore o sistema para tentativas excessivas de conexão. <literal>max-connections-per-ip-por-minute</literal>, <literal>max-child</literal> e <literal>max-child-per-ip</literal> podem ser usados para limitar tais ataques.</para>

      <para>Por padrão, TCP wrappers estão ativados. Consulte <citerefentry><refentrytitle>hosts_access</refentrytitle><manvolnum>5</manvolnum></citerefentry> para obter mais informações sobre como colocar restrições TCP em vários daemons chamados pelo <application>inetd</application>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="network-nfs">
    <info>
      <title>Network File System (NFS)</title>

      <authorgroup>
	<author><personname> <firstname>Tom</firstname> <surname>Rhodes</surname> </personname> <contrib>Reorganizado e aprimorado por </contrib></author>
      </authorgroup>

      <authorgroup>
	<author><personname> <firstname>Bill</firstname> <surname>Swingle</surname> </personname> <contrib>Escrito por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>NFS</primary></indexterm>
    <para>O FreeBSD suporta o Network File System (<acronym>NFS</acronym>), que permite que um servidor compartilhe diretórios e arquivos com clientes através de uma rede. Com o <acronym>NFS</acronym>, os usuários e programas podem acessar arquivos em sistemas remotos como se estivessem armazenados localmente.</para>

    <para><acronym>NFS</acronym> tem muitos usos práticos. Alguns dos usos mais comuns incluem:</para>

    <itemizedlist>
      <listitem>
	<para>Os dados que seriam duplicados em cada cliente podem ser mantidos em um único local e acessados por clientes na rede.</para>
      </listitem>

      <listitem>
	<para>Vários clientes podem precisar de acesso ao diretório <filename>/usr/ports/distfiles</filename>. Compartilhar esse diretório permite acesso rápido aos arquivos fonte sem precisar baixá-los para cada cliente.</para>
      </listitem>

      <listitem>
	<para>Em grandes redes, geralmente é mais conveniente configurar um servidor central <acronym>NFS</acronym> no qual todos os diretórios home dos usuários são armazenados. Os usuários podem logar em um cliente em qualquer lugar da rede e ter acesso aos seus diretórios home.</para>
      </listitem>

      <listitem>
	<para>A administração de exports do <acronym>NFS</acronym> é simplificada. Por exemplo, há apenas um sistema de arquivos no qual as políticas de segurança ou de backup devem ser definidas.</para>
      </listitem>

      <listitem>
	<para>Dispositivos removíveis de armazenamento de mídia podem ser usados por outras máquinas na rede. Isso reduz o número de dispositivos em toda a rede e fornece um local centralizado para gerenciar sua segurança. Geralmente, é mais conveniente instalar software em várias máquinas a partir de uma mídia de instalação centralizada.</para>
      </listitem>
    </itemizedlist>

    <para>O <acronym>NFS</acronym> consiste em um servidor e um ou mais clientes. O cliente acessa remotamente os dados armazenados na máquina do servidor. Para que isso funcione corretamente, alguns processos precisam ser configurados e executados.</para>

    <para>Esses daemons devem estar em execução no servidor:</para>
    <indexterm><primary>NFS</primary> <secondary>server</secondary></indexterm>
     <indexterm><primary>file server</primary> <secondary>UNIX clients</secondary></indexterm>

      <indexterm><primary><application>rpcbind</application></primary></indexterm>
      <indexterm><primary><application>mountd</application></primary></indexterm>
      <indexterm><primary><application>nfsd</application></primary></indexterm>

      <informaltable frame="none" pgwide="1">
	<tgroup cols="2">
	  <colspec colwidth="1*"/>
	  <colspec colwidth="3*"/>

	  <thead>
	    <row>
	      <entry>Daemon</entry>
	      <entry>Descrição</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><application>nfsd</application></entry>
	      <entry>O daemon <acronym>NFS</acronym> que atende a solicitações de clientes <acronym>NFS</acronym>.</entry>
	    </row>

	    <row>
	      <entry><application>mountd</application></entry>
	      <entry>O daemon de montagem do <acronym>NFS</acronym> que realiza solicitações recebidas do <application>nfsd</application>.</entry>
	    </row>

	    <row>
	      <entry><application>rpcbind</application></entry>
	      <entry>Este daemon permite que clientes <acronym>NF </acronym> descubram qual porta o servidor <acronym>NFS</acronym> está usando.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </informaltable>

      <para>A execução de <citerefentry><refentrytitle>nfsiod</refentrytitle><manvolnum>8</manvolnum></citerefentry> no cliente pode melhorar o desempenho, mas não é necessária.</para>

      <sect2 xml:id="network-configuring-nfs">
	<title>Configurando o Servidor</title>

	<indexterm><primary>NFS</primary> <secondary>configuration</secondary></indexterm>

      <para>Os sistemas de arquivos que o servidor <acronym>NFS</acronym> irá compartilhar são especificados no arquivo <filename>/etc/exports</filename>. Cada linha neste arquivo especifica um sistema de arquivos a ser exportado, quais clientes têm acesso a esse sistema de arquivos e quaisquer opções de acesso. Ao adicionar entradas a este arquivo, cada sistema de arquivos exportado, suas propriedades e hosts permitidos devem ocorrer em uma única linha. Se nenhum cliente estiver listado na entrada, qualquer cliente na rede poderá montar esse sistema de arquivos.</para>

      <indexterm><primary>NFS</primary> <secondary>export examples</secondary></indexterm>

      <para>As seguintes entradas no arquivo <filename>/etc/exports</filename> demonstram como exportar sistemas de arquivos. Os exemplos podem ser modificados para corresponder aos sistemas de arquivos e nomes de clientes na rede do leitor. Existem muitas opções que podem ser usadas neste arquivo, mas apenas algumas serão mencionadas aqui. Veja <citerefentry><refentrytitle>exports</refentrytitle><manvolnum>5</manvolnum></citerefentry> para a lista completa de opções.</para>

      <para>Este exemplo mostra como exportar <filename>/cdrom</filename> para três hosts chamados <replaceable>alpha</replaceable>, <replaceable>bravo</replaceable> e <replaceable>charlie</replaceable>:</para>

      <programlisting>/cdrom -ro <replaceable>alpha</replaceable> <replaceable>bravo</replaceable> <replaceable>charlie</replaceable></programlisting>

      <para>A flag <literal>-ro</literal> torna o sistema de arquivos somente leitura, impedindo que os clientes façam alterações no sistema de arquivos exportado. Este exemplo assume que os nomes de host estão no <acronym>DNS</acronym> ou no arquivo <filename>/etc/hosts</filename>. Consulte <citerefentry><refentrytitle>hosts</refentrytitle><manvolnum>5</manvolnum></citerefentry> se a rede não tiver um servidor de <acronym>DNS</acronym>.</para>

      <para>O próximo exemplo exporta <filename>/home</filename> para três clientes pelo endereço <acronym>IP</acronym>. Isso pode ser útil para redes sem <acronym>DNS</acronym> ou <filename>/etc/hosts</filename>. A flag <literal>-alldirs</literal> permite que os subdiretórios sejam pontos de montagem. Em outras palavras, ele não montará automaticamente os subdiretórios, mas permitirá que o cliente monte os diretórios necessários conforme necessário.</para>

      <programlisting>/usr/home  -alldirs  10.0.0.2 10.0.0.3 10.0.0.4</programlisting>

      <para>Este próximo exemplo exporta <filename>/a</filename> para que dois clientes de domínios diferentes possam acessar esse sistema de arquivos. <option>-maproot=root</option> permite que o usuário <systemitem class="username">root</systemitem> no sistema remoto grave os dados no sistema de arquivos exportado como <systemitem class="username">root</systemitem>. Se <literal>-maproot=root</literal> não for especificado, o usuário <systemitem class="username">root</systemitem> do cliente será mapeado para a conta <systemitem class="username">nobody</systemitem> do servidor e estará sujeito às limitações de acesso definidas para <systemitem class="username">nobody</systemitem>.</para>

      <programlisting>/a  -maproot=root  host.example.com box.example.org</programlisting>

      <para>Um cliente só pode ser especificado uma vez por sistema de arquivos. Por exemplo, se <filename>/usr</filename> for um único sistema de arquivos, essas entradas serão inválidas, já que ambas as entradas especificam o mesmo host:</para>

      <programlisting># Invalid when /usr is one file system
/usr/src   client
/usr/ports client</programlisting>

      <para>O formato correto para essa situação é usar uma entrada:</para>

      <programlisting>/usr/src /usr/ports  client</programlisting>

      <para>A seguir, um exemplo de uma lista de exportação válida, em que <filename>/usr</filename> e <filename>/exports</filename> são sistemas de arquivos locais:</para>

      <programlisting># Export src and ports to client01 and client02, but only
# client01 has root privileges on it
/usr/src /usr/ports -maproot=root    client01
/usr/src /usr/ports               client02
# The client machines have root and can mount anywhere
# on /exports. Anyone in the world can mount /exports/obj read-only
/exports -alldirs -maproot=root      client01 client02
/exports/obj -ro</programlisting>

      <para>Para habilitar os processos requeridos pelo servidor <acronym>NFS</acronym> no momento da inicialização, adicione estas opções ao arquivo <filename>/etc/rc.conf</filename>:</para>

      <programlisting>rpcbind_enable="YES"
nfs_server_enable="YES"
mountd_enable="YES"</programlisting>

      <para>O servidor pode ser iniciado agora executando este comando:</para>

      <screen><prompt>#</prompt> <userinput>service nfsd start</userinput></screen>

      <para>Sempre que o servidor <acronym>NFS</acronym> for iniciado, o <application>mountd</application> também é iniciado automaticamente. No entanto, <application>mountd</application> lê apenas <filename>/etc/exports</filename> quando é iniciado. Para fazer as edições subsequentes de <filename>/etc/exports</filename> entrarem em vigor imediatamente, force <application>mountd</application> para ler novamente:</para>

      <screen><prompt>#</prompt> <userinput>service mountd reload</userinput></screen>
    </sect2>

    <sect2>
      <title>Configurando o Cliente</title>

      <para>Para ativar clientes <acronym>NFS</acronym>, defina essa opção no arquivo <filename>/etc/rc.conf</filename> de cada cliente:</para>

      <programlisting>nfs_client_enable="YES"</programlisting>

      <para>Em seguida, execute este comando em cada cliente <acronym>NFS</acronym>:</para>

      <screen><prompt>#</prompt> <userinput>service nfsclient start</userinput></screen>

      <para>O cliente agora tem tudo de que precisa para montar um sistema de arquivos remoto. Nestes exemplos, o nome do servidor é <systemitem>server</systemitem> e o nome do cliente é <systemitem>client</systemitem>. Para montar <filename>/home</filename> no <systemitem>server</systemitem> para o ponto de montagem <filename>/mnt</filename> no <systemitem>client</systemitem>:</para>

      <indexterm><primary>NFS</primary> <secondary>mounting</secondary></indexterm>
      <screen><prompt>#</prompt> <userinput>mount server:/home /mnt</userinput></screen>

      <para>Os arquivos e diretórios em <filename>/home</filename> agora estarão disponíveis no <systemitem>client</systemitem>, no diretório <filename>/mnt</filename>.</para>

      <para>Para montar um sistema de arquivos remoto toda vez que o cliente for inicializado, adicione-o ao arquivo <filename>/etc/fstab</filename>:</para>

      <programlisting>server:/home	/mnt	nfs	rw	0	0</programlisting>

      <para>Consulte <citerefentry><refentrytitle>fstab</refentrytitle><manvolnum>5</manvolnum></citerefentry> para obter uma descrição de todas as opções disponíveis.</para>
    </sect2>

    <sect2>
      <title>Bloqueando</title>

      <para>Alguns aplicativos exigem o bloqueio de arquivos para funcionar corretamente. Para ativar o bloqueio, adicione estas linhas ao arquivo <filename>/etc/rc.conf</filename> no cliente e no servidor:</para>

      <programlisting>rpc_lockd_enable="YES"
rpc_statd_enable="YES"</programlisting>

      <para>Então inicie as aplicações:</para>

      <screen><prompt>#</prompt> <userinput>service lockd start</userinput>
<prompt>#</prompt> <userinput>service statd start</userinput></screen>

      <para>Se o bloqueio não for necessário no servidor, o cliente <acronym>NFS</acronym> pode ser configurado para bloquear localmente incluindo <option>-L</option> ao executar o <application>mount</application>. Consulte <citerefentry><refentrytitle>mount_nfs</refentrytitle><manvolnum>8</manvolnum></citerefentry> para mais detalhes.</para>
    </sect2>

    <sect2 xml:id="network-autofs">
      <title>Automatizando Montagens com <citerefentry><refentrytitle>autofs</refentrytitle><manvolnum>5</manvolnum></citerefentry></title>

      <note>
	<para>O recurso de montagem automática <citerefentry><refentrytitle>autofs</refentrytitle><manvolnum>5</manvolnum></citerefentry> é suportado a partir do FreeBSD 10.1-RELEASE. Para usar a funcionalidade automounter em versões mais antigas do FreeBSD, use <citerefentry><refentrytitle>amd</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Este capítulo descreve apenas o montador automático <citerefentry><refentrytitle>autofs</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>
      </note>


      <indexterm><primary>autofs</primary></indexterm>
      <indexterm><primary>automounter subsystem</primary></indexterm>

      <para>O recurso <citerefentry><refentrytitle>autofs</refentrytitle><manvolnum>5</manvolnum></citerefentry> é um nome comum para vários componentes que, juntos, permitem a montagem automática de sistemas de arquivos locais e remotos sempre que um arquivo ou diretório dentro desse sistema de arquivos é acessado. Ele consiste no componente do kernel, <citerefentry><refentrytitle>autofs</refentrytitle><manvolnum>5</manvolnum></citerefentry> e vários aplicativos no espaço do usuário: <citerefentry><refentrytitle>automount</refentrytitle><manvolnum>8</manvolnum></citerefentry>, <citerefentry><refentrytitle>automountd</refentrytitle><manvolnum>8</manvolnum></citerefentry> e <citerefentry><refentrytitle>autounmountd</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Ele serve como uma alternativa para <citerefentry><refentrytitle>amd</refentrytitle><manvolnum>8</manvolnum></citerefentry> de versões anteriores do FreeBSD. Amd ainda é fornecido para fins de compatibilidade com versões anteriores, já que os dois usam formato de mapeamento diferentes; o usado pelo autofs é o mesmo que com outros automontadores do SVR4, como os do Solaris, MacOS X e Linux.</para>

      <para>O sistema de arquivos virtual <citerefentry><refentrytitle>autofs</refentrytitle><manvolnum>5</manvolnum></citerefentry> é montado em pontos de montagem especificados por <citerefentry><refentrytitle>automount</refentrytitle><manvolnum>8</manvolnum></citerefentry>, geralmente chamado durante a inicialização.</para>

      <para>Sempre que um processo tentar acessar o arquivo dentro do ponto de montagem <citerefentry><refentrytitle>autofs</refentrytitle><manvolnum/></citerefentry>, o kernel notificará o daemon <citerefentry><refentrytitle>automountd</refentrytitle><manvolnum>8</manvolnum></citerefentry> e irá pausar o processo de disparo. O daemon <citerefentry><refentrytitle>automountd</refentrytitle><manvolnum>8</manvolnum></citerefentry> processará as solicitações do kernel localizando o mapeamento apropriado e irá montar o sistema de arquivos de acordo com ele, então sinaliza ao kernel para liberar o processo bloqueado . O daemon <citerefentry><refentrytitle>autounmountd</refentrytitle><manvolnum>8</manvolnum></citerefentry> desmonta automaticamente os sistemas de arquivos montados automaticamente após algum tempo, a menos que eles ainda estejam sendo usados.</para>

      <para>O arquivo de configuração principal do autofs é o <filename>/etc/auto_master</filename>. Atribui mapeamentos individuais a montagens de nível superior. Para uma explicação do <filename>auto_master</filename> e da sintaxe do mapeamento, consulte <citerefentry><refentrytitle>auto_master</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>

      <para>Existe um mapeamento especial montado automaticamente em <filename>/net</filename>. Quando um arquivo é acessado dentro desse diretório, o <citerefentry><refentrytitle>autofs</refentrytitle><manvolnum>5</manvolnum></citerefentry> procura a montagem remota correspondente e monta-a automaticamente. Por exemplo, uma tentativa de acessar um arquivo dentro de <filename>/net/foobar/usr</filename> informaria <citerefentry><refentrytitle>automountd</refentrytitle><manvolnum>8</manvolnum></citerefentry> para montar a exportação <filename>/usr</filename> do host <systemitem class="fqdomainname">foobar</systemitem>.</para>

      <example>
	<title>Montando uma Exportação com <citerefentry><refentrytitle>autofs</refentrytitle><manvolnum>5</manvolnum></citerefentry></title>

	<para>Neste exemplo, <command>showmount -e</command> mostra os sistemas de arquivos exportados que podem ser montados a partir do servidor <acronym>NFS</acronym>, <systemitem class="fqdomainname">foobar</systemitem>:</para>

	<screen><prompt>%</prompt> <userinput>showmount -e foobar</userinput>
Exports list on foobar:
/usr                               10.10.10.0
/a                                 10.10.10.0
<prompt>%</prompt> <userinput>cd /net/foobar/usr</userinput></screen>
      </example>

      <para>A saída de <command>showmount</command> mostra <filename>/usr</filename> como uma exportação. Ao alterar os diretórios para <filename>/host/foobar/usr</filename>, o <citerefentry><refentrytitle>automountd</refentrytitle><manvolnum>8</manvolnum></citerefentry> intercepta o pedido e tenta resolver o nome do host <systemitem class="fqdomainname">foobar</systemitem>. Se for bem-sucedido, <citerefentry><refentrytitle>automountd</refentrytitle><manvolnum>8</manvolnum></citerefentry> montará automaticamente a exportação de origem.</para>

      <para>Para habilitar <citerefentry><refentrytitle>autofs</refentrytitle><manvolnum>5</manvolnum></citerefentry> no momento da inicialização, adicione esta linha ao arquivo <filename>/etc/rc.conf</filename>:</para>

      <programlisting>autofs_enable="YES"</programlisting>

      <para>Em seguida, <citerefentry><refentrytitle>autofs</refentrytitle><manvolnum>5</manvolnum></citerefentry> pode ser iniciado executando:</para>

      <screen><prompt>#</prompt> <userinput>service automount start</userinput>
<prompt>#</prompt> <userinput>service automountd start</userinput>
<prompt>#</prompt> <userinput>service autounmountd start</userinput></screen>

      <para>O formato de mapeamento de <citerefentry><refentrytitle>autofs</refentrytitle><manvolnum>5</manvolnum></citerefentry> é o mesmo que em outros sistemas operacionais. Informações sobre este formato de outras fontes podem ser úteis, como o <link xlink:href="http://web.archive.org/web/20160813071113/http://images.apple.com/business/docs/Autofs.pdf">documento do Mac OS X</link>.</para>

      <para>Consulte as páginas de manuais <citerefentry><refentrytitle>automount</refentrytitle><manvolnum>8</manvolnum></citerefentry>, <citerefentry><refentrytitle>automountd</refentrytitle><manvolnum>8</manvolnum></citerefentry>, <citerefentry><refentrytitle>autounmountd</refentrytitle><manvolnum>8</manvolnum></citerefentry> e <citerefentry><refentrytitle>auto_master</refentrytitle><manvolnum>5</manvolnum></citerefentry> para maiores informações.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="network-nis">
    <!--
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Bill</firstname>
	  <surname>Swingle</surname>
	  <contrib>Written by </contrib>
	</author>
      </authorgroup>
      <authorgroup>
	<author>
	  <firstname>Eric</firstname>
	  <surname>Ogren</surname>
	  <contrib>Enhanced by </contrib>
	</author>
	<author>
	  <firstname>Udo</firstname>
	  <surname>Erdelhoff</surname>
	</author>
      </authorgroup>
    </sect1info>
    -->
    <title>Sistema de Informação de Rede (<acronym>NIS</acronym>)</title>

    <indexterm><primary>NIS</primary></indexterm>
    <indexterm><primary>Solaris</primary></indexterm>
    <indexterm><primary>HP-UX</primary></indexterm>
    <indexterm><primary>AIX</primary></indexterm>
    <indexterm><primary>Linux</primary></indexterm>
    <indexterm><primary>NetBSD</primary></indexterm>
    <indexterm><primary>OpenBSD</primary></indexterm>
    <indexterm><primary>yellow pages</primary> <see>NIS</see></indexterm>

    <para>O Network Information System (<acronym>NIS</acronym>) foi projetado para centralizar a administração de sistemas <trademark class="registered">UNIX</trademark> como <trademark>Solaris</trademark>, HP-UX, <trademark class="registered">AIX</trademark>, Linux, NetBSD, OpenBSD e FreeBSD. O <acronym>NIS</acronym> era originalmente conhecido como Yellow Pages, mas o nome foi alterado devido a problemas de marca registrada. Esta é a razão pela qual os comandos do <acronym>NIS</acronym> começam com <literal>yp</literal>.</para>

    <indexterm><primary>NIS</primary> <secondary>domains</secondary></indexterm>

    <para>O <acronym>NIS</acronym> é um sistema cliente/servidor baseado em Remote Procedure Call (<acronym>RPC</acronym>) que permite que um grupo de máquinas dentro de um domínio <acronym>NIS</acronym> compartilhe um conjunto de arquivos de configuração. Isso permite que um administrador do sistema configure sistemas clientes <acronym>NIS</acronym> com apenas dados mínimos de configuração e adicione, remova ou modifique dados de configuração de um único local.</para>

    <para>O FreeBSD usa a versão 2 do protocolo <acronym>NIS</acronym>.</para>

    <sect2>
      <title>Termos do <acronym>NIS</acronym> e Processos</title>

      <para>A Tabela 28.1 resume os termos e processos importantes usados pelo <acronym>NIS</acronym>:</para>

      <indexterm><primary><application>rpcbind</application></primary></indexterm>
      <indexterm><primary><application>portmap</application></primary></indexterm>

      <table frame="none" pgwide="1">
	<title>Terminologia do <acronym>NIS</acronym></title>

	<tgroup cols="2">
	  <colspec colwidth="1*"/>
	  <colspec colwidth="3*"/>

	  <thead>
	    <row>
	      <entry>Termo</entry>
	      <entry>Descrição</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry>nome de domínio <acronym>NIS</acronym></entry>

	      <entry>Os servidores e clientes do <acronym>NIS</acronym> compartilham um nome de domínio <acronym>NIS</acronym>. Normalmente, esse nome não tem nada a ver com <acronym>DNS</acronym>.</entry>
	    </row>

	    <row>
	      <entry><citerefentry><refentrytitle>rpcbind</refentrytitle><manvolnum>8</manvolnum></citerefentry></entry>

	      <entry>Este serviço habilita o <acronym>RPC</acronym> e deve estar rodando para rodar um servidor <acronym>NIS</acronym> ou atuar como um cliente <acronym>NIS</acronym>.</entry>
	    </row>

	    <row>
	      <entry><citerefentry><refentrytitle>ypbind</refentrytitle><manvolnum>8</manvolnum></citerefentry></entry>
	      <entry>Este serviço liga um cliente <acronym>NIS</acronym> ao seu servidor <acronym>NIS</acronym>. Ele levará o nome de domínio <acronym>NIS</acronym> e usará <acronym>RPC</acronym> para se conectar ao servidor. É o núcleo da comunicação cliente/servidor em um ambiente <acronym>NIS</acronym>. Se este serviço não estiver sendo executado em uma máquina cliente, ele não poderá acessar o servidor <acronym>NIS</acronym>.</entry>
	    </row>

	    <row>
	      <entry><citerefentry><refentrytitle>ypserv</refentrytitle><manvolnum>8</manvolnum></citerefentry></entry>
	      <entry>Este é o processo para o servidor <acronym>NIS</acronym>. Se este serviço parar de funcionar, o servidor não poderá mais responder aos pedidos do <acronym>NIS</acronym>, portanto, esperamos que exista um servidor slave para assumir o controle. Alguns clientes não-FreeBSD não tentarão se reconectar usando um servidor slave e o processo <application>ypbind</application> pode precisar ser reiniciado nesses clientes.</entry>
	    </row>

	    <row>
	      <entry><citerefentry><refentrytitle>rpc.yppasswdd</refentrytitle><manvolnum>8</manvolnum></citerefentry></entry>
	      <entry>Este processo só é executado em servidores principais de <acronym>NIS</acronym>. Este daemon permite que clientes <acronym>NIS</acronym> alterem suas senhas do <acronym>NIS</acronym>. Se este daemon não estiver rodando, os usuários terão que acessar o servidor principal do <acronym>NIS</acronym> e alterar suas senhas lá.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>
      <!-- XXX Missing: rpc.ypxfrd (not important, though) May only run
      on the master -->
    </sect2>

    <sect2>
      <title>Tipos de Máquinas</title>

      <indexterm><primary>NIS</primary> <secondary>master server</secondary></indexterm>
      <indexterm><primary>NIS</primary> <secondary>slave server</secondary></indexterm>
      <indexterm><primary>NIS</primary> <secondary>client</secondary></indexterm>

      <para>Existem três tipos de hosts em um ambiente <acronym>NIS</acronym>:</para>

      <itemizedlist>
	<listitem>
	  <para>Servidor <acronym>NIS</acronym> master</para>

	  <para>Esse servidor atua como um repositório central para as informações de configuração do host e mantém a cópia autoritativa dos arquivos usados por todos os clientes do <acronym>NIS</acronym>. O <filename>passwd</filename>, o <filename>group</filename> e outros arquivos usados pelos clientes do <acronym>NIS</acronym> são armazenados no servidor master. Embora seja possível que uma máquina seja um servidor <acronym>NIS</acronym> master para mais de um domínio <acronym>NIS</acronym>, esse tipo de configuração não será abordado neste capítulo, pois pressupõe ambiente <acronym>NIS</acronym> de pequena escala.</para>
	</listitem>

	<listitem>
	  <para>Servidores <acronym>NIS</acronym> slave</para>

	  <para>Os servidores slaves do <acronym>NIS</acronym> mantêm cópias dos arquivos de dados do master do <acronym>NIS</acronym> para fornecer redundância. Os servidores slaves também ajudam a balancear a carga do servidor master, pois os clientes do <acronym>NIS</acronym> sempre se conectam ao servidor do <acronym>NIS</acronym> que responde primeiro.</para>
	</listitem>

	<listitem>
	  <para>Clientes <acronym>NIS</acronym></para>

	  <para>Os clientes do <acronym>NIS</acronym> autenticam-se contra o servidor <acronym>NIS</acronym> durante o logon.</para>
	</listitem>
      </itemizedlist>

      <para>Informações em muitos arquivos podem ser compartilhadas usando o <acronym>NIS </acronym>. Os arquivos <filename>master.passwd</filename>, <filename>group</filename> e <filename>hosts</filename> são comumente compartilhados via <acronym>NIS</acronym>. Sempre que um processo em um cliente precisa de informações que normalmente seriam encontradas nesses arquivos localmente, ele faz uma consulta ao servidor <acronym>NIS</acronym> ao qual está vinculado.</para>
    </sect2>

    <sect2>
      <title>Considerações de Planejamento</title>

      <para>Esta seção descreve um ambiente <acronym>NIS</acronym> de exemplo que consiste em 15 máquinas FreeBSD sem ponto de administração centralizado. Cada máquina tem seu próprio <filename>/etc/passwd</filename> e <filename>/etc/master.passwd</filename>. Esses arquivos são mantidos em sincronia entre si somente por meio de intervenção manual. Atualmente, quando um usuário é adicionado ao laboratório, o processo deve ser repetido em todas as 15 máquinas.</para>

      <para>A configuração do laboratório será a seguinte:</para>

      <informaltable frame="none" pgwide="1">
	<tgroup cols="3">
	  <thead>
	    <row>
	      <entry>Nome da maquina</entry>
	      <entry>Endereço <acronym>IP</acronym></entry>
	      <entry>Role da máquina</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><systemitem>ellington</systemitem></entry>
	      <entry><systemitem class="ipaddress">10.0.0.2</systemitem></entry>
	      <entry><acronym>NIS</acronym> master</entry>
	    </row>

	    <row>
	      <entry><systemitem>coltrane</systemitem></entry>
	      <entry><systemitem class="ipaddress">10.0.0.3</systemitem></entry>
	      <entry><acronym>NIS</acronym> slave</entry>
	    </row>

	    <row>
	      <entry><systemitem>basie</systemitem></entry>
	      <entry><systemitem class="ipaddress">10.0.0.4</systemitem></entry>
	      <entry>Estação de Trabalho da Facultativa</entry>
	    </row>

	    <row>
	      <entry><systemitem>bird</systemitem></entry>
	      <entry><systemitem class="ipaddress">10.0.0.5</systemitem></entry>
	      <entry>Máquina Cliente</entry>
	    </row>

	    <row>
	      <entry><systemitem>cli[1-11]</systemitem></entry>
	      <entry><systemitem class="ipaddress">10.0.0.[6-17]</systemitem></entry>
	      <entry>Outras Máquinas Clientes</entry>
	    </row>
	  </tbody>
	</tgroup>
      </informaltable>

      <para>Se esta é a primeira vez que um esquema de <acronym>NIS</acronym> está sendo desenvolvido, ele deve ser cuidadosamente planejado através do tempo. Independentemente do tamanho da rede, várias decisões precisam ser tomadas como parte do processo de planejamento.</para>

      <sect3>
	<title>Escolhendo um Nome de Domínio <acronym>NIS</acronym></title>

	<indexterm><primary>NIS</primary> <secondary>domain name</secondary></indexterm>
	<para>Quando um cliente transmite suas solicitações de informações, ele inclui o nome do domínio <acronym>NIS</acronym> do qual faz parte. É assim que vários servidores em uma rede podem informar qual servidor deve responder a qual solicitação. Pense no nome de domínio <acronym>NIS</acronym> como o nome de um grupo de hosts.</para>

	<para>Algumas organizações optam por usar o nome de domínio da Internet para o nome de domínio <acronym>NIS</acronym>. Isso não é recomendado, pois pode causar confusão ao tentar depurar problemas de rede. O nome de domínio <acronym>NIS</acronym> deve ser único dentro da rede e é útil se ele descrever o grupo de máquinas que representa. Por exemplo, o departamento de Arte da Acme Inc. pode estar no domínio <acronym>NIS</acronym> <quote>acme-art</quote>. Este exemplo usará o nome de domínio <literal>test-domain</literal>.</para>

	<para>No entanto, alguns sistemas operacionais não-FreeBSD exigem que o nome de domínio <acronym>NIS</acronym> seja o mesmo que o nome de domínio da Internet. Se uma ou mais máquinas na rede tiverem essa restrição, o nome de domínio da Internet <emphasis>deve</emphasis> ser usado como o nome de domínio <acronym>NIS</acronym>.</para>
      </sect3>

      <sect3>
	<title>Requisitos Físicos do Servidor</title>

	<para>Há várias coisas que você deve ter em mente ao escolher uma máquina para usar como um servidor <acronym>NIS</acronym>. Como os clientes do <acronym>NIS</acronym> dependem da disponibilidade do servidor, escolha uma máquina que não seja reinicializada com freqüência. O servidor do <acronym>NIS</acronym> deve idealmente ser uma máquina autônoma cujo único propósito seja ser um servidor <acronym>NIS</acronym>. Se a rede não for muito usada, é aceitável colocar o servidor <acronym>NIS</acronym> em uma máquina que executa outros serviços. No entanto, se o servidor <acronym>NIS</acronym> ficar indisponível, isso afetará negativamente todos os clientes <acronym>NIS</acronym>.</para>
      </sect3>
    </sect2>

    <sect2>
      <title>Configurando o Servidor <acronym>NIS</acronym> Master</title>

      <para>As cópias canônicas de todos os arquivos <acronym>NIS</acronym> são armazenadas no servidor master. Os bancos de dados usados para armazenar as informações são chamados de mapas de <acronym>NIS</acronym>. No FreeBSD, estes mapas são armazenados em <filename>/var/yp/[nome_do_domínio]</filename> onde <filename>[nome_do_dominio]</filename> é o nome do domínio <acronym>NIS</acronym>. Como vários domínios são suportados, é possível ter vários diretórios, um para cada domínio. Cada domínio terá seu próprio conjunto independente de mapas.</para>

      <para>Os servidores master e slave do <acronym>NIS</acronym> lidam com todas as requisições <acronym>NIS</acronym> através do <citerefentry><refentrytitle>ypserv</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Esse daemon é responsável por receber solicitações de entrada de clientes <acronym>NIS</acronym>, traduzindo o domínio e o nome do mapa solicitados para um caminho para o arquivo de banco de dados correspondente e transmitindo dados do banco de dados de volta ao cliente.</para>

      <indexterm><primary>NIS</primary> <secondary>server configuration</secondary></indexterm>
      <para>Configurar um servidor <acronym>NIS</acronym> master pode ser relativamente simples, dependendo das necessidades ambientais. Como o FreeBSD oferece suporte a <acronym>NIS</acronym> embutido, ele só precisa ser ativado adicionando as seguintes linhas ao arquivo <filename>/etc/rc.conf</filename>:</para>

      <programlisting>nisdomainname="<replaceable>test-domain</replaceable>"	<co xml:id="network-nis-co-domainname"/>
nis_server_enable="YES"		<co xml:id="network-nis-co-server"/>
nis_yppasswdd_enable="YES"	<co xml:id="network-nis-co-yppasswdd"/></programlisting>

      <calloutlist>
	<callout arearefs="network-nis-co-domainname">
	  <para>Esta linha define o nome de domínio <acronym>NIS</acronym> para <literal>test-domain</literal>.</para>
	</callout>

	<callout arearefs="network-nis-co-server">
	  <para>Isto automatiza o início dos processos do servidor <acronym>NIS</acronym> quando o sistema é inicializado.</para>
	</callout>

	<callout arearefs="network-nis-co-yppasswdd">
	  <para>Isso habilita o daemon <citerefentry><refentrytitle>rpc.yppasswdd</refentrytitle><manvolnum>8</manvolnum></citerefentry> para que os usuários possam alterar sua senha <acronym>NIS</acronym> de uma máquina cliente.</para>
	</callout>
      </calloutlist>

      <para>É preciso ter cuidado em um domínio com vários servidores, no qual as máquinas do servidor também são clientes <acronym>NIS</acronym>. Geralmente, é uma boa ideia forçar os servidores a fazerem bind em si mesmos, em vez de permitir que eles transmitam solicitações de bind e, possivelmente, fiquem vinculados um ao outro. Modos de falha estranhos podem ocorrer se um servidor cair e outros dependerem dele. Eventualmente, todos os clientes terão tempo limite e tentarão fazer bind em outros servidores, mas o atraso envolvido poderá ser considerável e o modo de falha ainda estará presente, uma vez que os servidores podem ligar-se entre si novamente.</para>

      <para>Um servidor que também é um cliente pode ser forçado fazer bind em um servidor em particular adicionando estas linhas adicionais ao arquivo <filename>/etc/rc.conf</filename>:</para>

<programlisting>nis_client_enable="YES"				<co xml:id="network-nis-co-client"/>
nis_client_flags="-S <replaceable>test-domain</replaceable>,<replaceable>server</replaceable>"	<co xml:id="network-nis-co-clientflags"/></programlisting>

      <calloutlist>
	<callout arearefs="network-nis-co-client">
	  <para>Isso permite rodar coisas do cliente também.</para>
	</callout>

	<callout arearefs="network-nis-co-clientflags">
	  <para>Esta linha define o nome de domínio <acronym>NIS</acronym> para <literal>test-domain</literal> e vincula para si mesmo.</para>
	</callout>
      </calloutlist>

      <para>Depois de salvar as edições, digite <command>/etc/netstart</command> para reiniciar a rede e aplicar os valores definidos no arquivo <filename>/etc/rc.conf</filename>. Antes de inicializar os mapas de <acronym>NIS</acronym>, inicie <citerefentry><refentrytitle>ypserv</refentrytitle><manvolnum>8</manvolnum></citerefentry>:</para>

      <screen><prompt>#</prompt> <userinput>service ypserv start</userinput></screen>

      <sect3>
	<title>Inicializando os mapas do <acronym>NIS</acronym></title>

	<indexterm><primary>NIS</primary> <secondary>maps</secondary></indexterm>
	<para>Os mapeamentos <acronym>NIS</acronym> são gerados a partir dos arquivos de configuração no diretório <filename>/etc</filename> no <acronym>NIS</acronym> master, com uma exceção: <filename>/etc/master.passwd</filename>. Isso evita a propagação de senhas para todos os servidores no domínio <acronym>NIS</acronym>. Portanto, antes de inicializar os mapas do <acronym>NIS</acronym>, configure os arquivos de senha primários:</para>

	<screen><prompt>#</prompt> <userinput>cp /etc/master.passwd /var/yp/master.passwd</userinput>
<prompt>#</prompt> <userinput>cd /var/yp</userinput>
<prompt>#</prompt> <userinput>vi master.passwd</userinput></screen>

	<para>É aconselhável remover todas as entradas de contas do sistema, bem como quaisquer contas de usuário que não precisem ser propagadas para os clientes do <acronym>NIS</acronym>, como o <systemitem class="username">root</systemitem> e quaisquer outras contas administrativas.</para>

	<note>
	  <para>Assegure-se de que o arquivo <filename>/var/yp/master.passwd</filename> não seja de grupo nem de mundo legível, definindo suas permissões para <literal>600</literal>.</para>
	</note>

	<para>Depois de concluir esta tarefa, inicialize os mapas do <acronym>NIS</acronym>. O FreeBSD inclui o script <citerefentry><refentrytitle>ypinit</refentrytitle><manvolnum>8</manvolnum></citerefentry> para fazer isso. Ao gerar mapas para o servidor master, inclua <option>-m</option> e especifique o nome de domínio <acronym>NIS</acronym>:</para>

	<screen>ellington<prompt>#</prompt> <userinput>ypinit -m test-domain</userinput>
Server Type: MASTER Domain: test-domain
Creating an YP server will require that you answer a few questions.
Questions will all be asked at the beginning of the procedure.
Do you want this procedure to quit on non-fatal errors? [y/n: n] <userinput>n</userinput>
Ok, please remember to go back and redo manually whatever fails.
If not, something might not work.
At this point, we have to construct a list of this domains YP servers.
rod.darktech.org is already known as master server.
Please continue to add any slave servers, one per line. When you are
done with the list, type a &lt;control D&gt;.
master server   :  ellington
next host to add:  <userinput>coltrane</userinput>
next host to add:  <userinput>^D</userinput>
The current list of NIS servers looks like this:
ellington
coltrane
Is this correct?  [y/n: y] <userinput>y</userinput>

[..output from map generation..]

NIS Map update completed.
ellington has been setup as an YP master server without any errors.</screen>

	<para>Isto irá criar <filename>/var/yp/Makefile</filename> a partir de <filename>/var/yp/Makefile.dist</filename>. Por padrão, este arquivo assume que o ambiente tem um único servidor <acronym>NIS</acronym> com apenas clientes FreeBSD. Como <literal>test-domain</literal> tem um servidor slave, edite esta linha no arquivo <filename>/var/yp/Makefile</filename> para que comece com um comentário (<literal> # </literal>) :</para>

	<programlisting>NOPUSH = "True"</programlisting>
      </sect3>

      <sect3>
	<title>Adicionando novos usuários</title>

	<para>Toda vez que um novo usuário é criado, a conta de usuário deve ser adicionada ao servidor mestre <acronym>NIS</acronym> e aos mapeamentos do <acronym>NIS</acronym> reconstruídos. Até que isso ocorra, o novo usuário não poderá efetuar login em nenhum lugar, exceto no <acronym>NIS</acronym> master. Por exemplo, para adicionar o novo usuário <systemitem class="username">jsmith</systemitem> ao domínio <literal>test-domain</literal>, execute estes comandos no servidor master:</para>

	<screen><prompt>#</prompt> <userinput>pw useradd jsmith</userinput>
<prompt>#</prompt> <userinput>cd /var/yp</userinput>
<prompt>#</prompt> <userinput>make test-domain</userinput></screen>

	<para>O usuário também pode ser adicionado usando <command>adduser jsmith</command> em vez de <command>pw useradd smith</command>.</para>
      </sect3>
    </sect2>

    <sect2>
      <title>Configurando um Servidor <acronym>NIS</acronym> Slave</title>

      <indexterm><primary>NIS</primary> <secondary>slave server</secondary></indexterm>
      <para>Para configurar um servidor <acronym>NIS</acronym> slave, faça o logon no servidor slave e edite o arquivo <filename>/etc/rc.conf</filename> assim como para o servidor master. Não gere nenhum mapa de <acronym>NIS</acronym>, pois estes já existem no servidor master. Ao executar <command>ypinit</command> no servidor slave, use <option>-s</option> (para slave) ao invés de <option>-m</option> (para master). Esta opção requer o nome do <acronym> NIS </acronym> master, além do nome do domínio, como visto neste exemplo:</para>

      <screen>coltrane<prompt>#</prompt> <userinput>ypinit -s ellington test-domain</userinput>

Server Type: SLAVE Domain: test-domain Master: ellington

Creating an YP server will require that you answer a few questions.
Questions will all be asked at the beginning of the procedure.

Do you want this procedure to quit on non-fatal errors? [y/n: n]  <userinput>n</userinput>

Ok, please remember to go back and redo manually whatever fails.
If not, something might not work.
There will be no further questions. The remainder of the procedure
should take a few minutes, to copy the databases from ellington.
Transferring netgroup...
ypxfr: Exiting: Map successfully transferred
Transferring netgroup.byuser...
ypxfr: Exiting: Map successfully transferred
Transferring netgroup.byhost...
ypxfr: Exiting: Map successfully transferred
Transferring master.passwd.byuid...
ypxfr: Exiting: Map successfully transferred
Transferring passwd.byuid...
ypxfr: Exiting: Map successfully transferred
Transferring passwd.byname...
ypxfr: Exiting: Map successfully transferred
Transferring group.bygid...
ypxfr: Exiting: Map successfully transferred
Transferring group.byname...
ypxfr: Exiting: Map successfully transferred
Transferring services.byname...
ypxfr: Exiting: Map successfully transferred
Transferring rpc.bynumber...
ypxfr: Exiting: Map successfully transferred
Transferring rpc.byname...
ypxfr: Exiting: Map successfully transferred
Transferring protocols.byname...
ypxfr: Exiting: Map successfully transferred
Transferring master.passwd.byname...
ypxfr: Exiting: Map successfully transferred
Transferring networks.byname...
ypxfr: Exiting: Map successfully transferred
Transferring networks.byaddr...
ypxfr: Exiting: Map successfully transferred
Transferring netid.byname...
ypxfr: Exiting: Map successfully transferred
Transferring hosts.byaddr...
ypxfr: Exiting: Map successfully transferred
Transferring protocols.bynumber...
ypxfr: Exiting: Map successfully transferred
Transferring ypservers...
ypxfr: Exiting: Map successfully transferred
Transferring hosts.byname...
ypxfr: Exiting: Map successfully transferred

coltrane has been setup as an YP slave server without any errors.
Remember to update map ypservers on ellington.</screen>

      <para>Isto irá gerar um diretório no servidor slave chamado <filename>/var/yp/test-domain</filename> que contém cópias dos mapas do servidor principal do <acronym>NIS</acronym>. Adicionar estas entradas ao arquivo <filename>/etc/crontab</filename> em cada servidor slave forçará os slaves a sincronizar seus mapas com os mapas no servidor master:</para>

      <programlisting>20      *       *       *       *       root   /usr/libexec/ypxfr passwd.byname
21      *       *       *       *       root   /usr/libexec/ypxfr passwd.byuid</programlisting>

      <para>Essas entradas não são obrigatórias porque o servidor master tenta enviar automaticamente quaisquer alterações no mapa para seus escravos. No entanto, como os clientes podem depender do servidor escravo para fornecer informações corretas de senha, recomenda-se forçar atualizações frequentes de mapas de senha. Isso é especialmente importante em redes ocupadas nas quais as atualizações de mapas nem sempre são concluídas.</para>

      <para>Para finalizar a configuração, execute <command>/etc/netstart</command> no servidor slave para iniciar os serviços do <acronym>NIS</acronym>.</para>
    </sect2>

    <sect2>
      <title>Configurando um cliente <acronym>NIS</acronym></title>

      <para>Um cliente <acronym>NIS</acronym> é vinculado a um servidor <acronym>NIS</acronym> usando <citerefentry><refentrytitle>ypbind</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Esse daemon transmite solicitações de RPC na rede local. Essas solicitações especificam o nome do domínio configurado no cliente. Se um servidor <acronym>NIS</acronym> no mesmo domínio receber uma das transmissões, ele responderá a <application>ypbind</application>, que registrará o endereço do servidor. Se houver vários servidores disponíveis, o cliente usará o endereço do primeiro servidor para responder e direcionará todas as suas solicitações de <acronym>NIS</acronym> para esse servidor. O cliente irá automaticamente <application>pingar</application> o servidor regularmente para garantir que ainda esteja disponível. Se ele não receber uma resposta dentro de um período de tempo razoável, o <application>ypbind</application> marcará o domínio como não acoplado e começará a transmitir novamente na esperança de localizar outro servidor.</para>

      <indexterm><primary>NIS</primary> <secondary>client configuration</secondary></indexterm>

      <para>Para configurar uma máquina FreeBSD para ser um cliente <acronym>NIS</acronym>:</para>

      <procedure>
	<step>
	  <para>Edite o <filename>/etc/rc.conf</filename> e adicione as seguintes linhas para definir o nome de domínio <acronym>NIS</acronym> e inicie <citerefentry><refentrytitle>ypbind</refentrytitle><manvolnum>8</manvolnum></citerefentry> durante a inicialização da rede:</para>

	  <programlisting>nisdomainname="test-domain"
nis_client_enable="YES"</programlisting>
	</step>

	<step>
	  <para>Para importar todas as possíveis entradas de senha do servidor <acronym>NIS</acronym>, use <command>vipw</command> para remover todas as contas de usuário, exceto uma do arquivo <filename>/etc/master.passwd</filename>. Ao remover as contas, lembre-se de que pelo menos uma conta local deve permanecer e essa conta deve ser membro do grupo <systemitem class="groupname">wheel</systemitem>. Se houver um problema com o <acronym>NIS</acronym>, essa conta local poderá ser usada para efetuar login remotamente, tornar-se o superusuário e corrigir o problema. Antes de salvar as edições, adicione a seguinte linha ao final do arquivo:</para>

	  <programlisting>+:::::::::</programlisting>

	  <para>Esta linha configura o cliente para fornecer qualquer pessoa com uma conta válida na senha do servidor do <acronym>NIS</acronym> mapeia uma conta no cliente. Existem várias maneiras de configurar o cliente <acronym>NIS</acronym> modificando essa linha. Um método é descrito em <xref linkend="network-netgroups"/>. Para uma leitura mais detalhada, consulte o livro <literal>Managing NFS and NIS</literal>, publicado pela O'Reilly Media.</para>
	</step>

	<step>
	  <para>Para importar todas as entradas de grupo possíveis do servidor <acronym>NIS</acronym>, adicione esta linha ao <filename>/etc/group</filename>:</para>

	  <programlisting>+:*::</programlisting>
	</step>
      </procedure>

      <para>Para iniciar imediatamente o cliente <acronym>NIS</acronym>, execute os seguintes comandos como superusuário:</para>

      <screen><prompt>#</prompt> <userinput>/etc/netstart</userinput>
<prompt>#</prompt> <userinput>service ypbind start</userinput></screen>

      <para>Depois de concluir estas etapas, a execução do <command>ypcat passwd</command> no cliente deve mostrar o mapa <filename>passwd</filename> do servidor.</para>
    </sect2>

    <sect2>
      <title>Segurança <acronym>NIS</acronym></title>

      <para>Como o <acronym>RPC</acronym> é um serviço baseado em broadcast, qualquer sistema executando o <application>ypbind</application> dentro do mesmo domínio pode recuperar o conteúdo dos mapas do <acronym>NIS</acronym>. Para evitar transações não autorizadas, <citerefentry><refentrytitle>ypserv</refentrytitle><manvolnum>8</manvolnum></citerefentry> suporta um recurso chamado <quote>securenets</quote> que pode ser usado para restringir o acesso a um dado conjunto de hosts. Por padrão, essas informações são armazenadas no arquivo <filename>/var/yp/securenets</filename>, a menos que <citerefentry><refentrytitle>ypserv</refentrytitle><manvolnum>8</manvolnum></citerefentry> seja iniciado com <option>-p</option> e um caminho alternativo. Este arquivo contém entradas que consistem em uma especificação de rede e uma máscara de rede separadas por espaço em branco. Linhas iniciando com <literal>#</literal> são consideradas comentários. Um exemplo de <filename>securenets</filename> pode ser assim:</para>

      <programlisting># allow connections from local host -- mandatory
127.0.0.1     255.255.255.255
# allow connections from any host
# on the 192.168.128.0 network
192.168.128.0 255.255.255.0
# allow connections from any host
# between 10.0.0.0 to 10.0.15.255
# this includes the machines in the testlab
10.0.0.0      255.255.240.0</programlisting>

      <para>Se <citerefentry><refentrytitle>ypserv</refentrytitle><manvolnum>8</manvolnum></citerefentry> receber uma solicitação de um endereço que corresponda a uma dessas regras, ela processará a solicitação normalmente. Se o endereço não corresponder a uma regra, a solicitação será ignorada e uma mensagem de aviso será registrada. Se o <filename>securenets</filename> não existir, o <command>ypserv</command> permitirá conexões de qualquer host.</para>

      <para><xref linkend="tcpwrappers"/> é um mecanismo alternativo para fornecer controle de acesso em vez de <filename>securenets</filename>. Embora o mecanismo de controle de acesso acrescente alguma segurança, ambos são vulneráveis a ataques como <quote><acronym>IP</acronym> spoofing</quote>. Todo o tráfego relacionado a <acronym>NIS</acronym> deve ser bloqueado no firewall.</para>

      <para>Servidores que usam <filename>securenets</filename> podem não servir clientes legítimos de <acronym>NIS</acronym> com implementações arcaicas de TCP/IP. Algumas dessas implementações definem todos os bits do host como zero ao fazer transmissões ou não observam a máscara de sub-rede ao calcular o endereço de transmissão. Embora alguns desses problemas possam ser corrigidos alterando a configuração do cliente, outros problemas podem forçar a desativação desses sistemas clientes ou o abandono do <filename>securenets</filename>.</para>

      <indexterm><primary>TCP Wrapper</primary></indexterm>
      <para>O uso de <application>TCP Wrapper</application> aumenta a latência do servidor <acronym>NIS</acronym>. O atraso adicional pode ser longo o suficiente para causar timeouts em programas clientes, especialmente em redes ocupadas com servidores <acronym>NIS</acronym> lentos. Se um ou mais clientes sofrerem de latência, converta esses clientes em servidores de <acronym>NIS</acronym> slaves e force-os a se ligarem a eles mesmos.</para>

      <sect3>
	<title>Barrando alguns usuários</title>

	<para>Neste exemplo, o sistema <systemitem>basie</systemitem> é uma estação de trabalho da dentro do domínio <acronym>NIS</acronym> facultativo. O mapa <filename>passwd</filename> no servidor <acronym>NIS</acronym> master contém contas para professores e alunos. Esta seção demonstra como permitir o login do corpo docente neste sistema e, ao mesmo tempo, recusar logins de alunos.</para>

	<para>Para previnir usuários específicos de logar em um sistema, desde que eles estejam presentes no banco de dados do <acronym>NIS</acronym>, use <command>vipw</command> para adicionar <literal>-<replaceable>username</replaceable></literal> com o numero correto de virgulas em direção ao fim do arquivo <filename>/etc/master.passwd</filename> no cliente, onde <replaceable>username</replaceable> é o nome de usuário a impedir de logar. A linha com o usuário bloqueado deve estar antes da linha <literal>+</literal> que permite usuários do <acronym>NIS</acronym>. Neste exemplo, <systemitem class="username">bill</systemitem> está impedido de logar no <systemitem>basie</systemitem>:</para>

	<screen>basie<prompt>#</prompt> <userinput>cat /etc/master.passwd</userinput>
root:[password]:0:0::0:0:The super-user:/root:/bin/csh
toor:[password]:0:0::0:0:The other super-user:/root:/bin/sh
daemon:*:1:1::0:0:Owner of many system processes:/root:/usr/sbin/nologin
operator:*:2:5::0:0:System &amp;:/:/usr/sbin/nologin
bin:*:3:7::0:0:Binaries Commands and Source,,,:/:/usr/sbin/nologin
tty:*:4:65533::0:0:Tty Sandbox:/:/usr/sbin/nologin
kmem:*:5:65533::0:0:KMem Sandbox:/:/usr/sbin/nologin
games:*:7:13::0:0:Games pseudo-user:/usr/games:/usr/sbin/nologin
news:*:8:8::0:0:News Subsystem:/:/usr/sbin/nologin
man:*:9:9::0:0:Mister Man Pages:/usr/share/man:/usr/sbin/nologin
bind:*:53:53::0:0:Bind Sandbox:/:/usr/sbin/nologin
uucp:*:66:66::0:0:UUCP pseudo-user:/var/spool/uucppublic:/usr/libexec/uucp/uucico
xten:*:67:67::0:0:X-10 daemon:/usr/local/xten:/usr/sbin/nologin
pop:*:68:6::0:0:Post Office Owner:/nonexistent:/usr/sbin/nologin
nobody:*:65534:65534::0:0:Unprivileged user:/nonexistent:/usr/sbin/nologin
-bill:::::::::
+:::::::::

basie<prompt>#</prompt></screen>
      </sect3>
    </sect2>

    <sect2 xml:id="network-netgroups">
      <!--
      <sect2info>
	<authorgroup>
	  <author>
	    <firstname>Udo</firstname>
	    <surname>Erdelhoff</surname>
	    <contrib>Contributed by </contrib>
	  </author>
	</authorgroup>
      </sect2info>
      -->

      <title>Usando Netgroups</title>

      <indexterm><primary>netgroups</primary></indexterm>

      <para>A exclusão de usuários especificados do logon em sistemas individuais torna-se imprestável em redes maiores e perde rapidamente o principal benefício  do <acronym>NIS</acronym>: administração <emphasis>centralizada</emphasis>.</para>

      <para>Os netgroups foram desenvolvidos para lidar com redes grandes e complexas com centenas de usuários e máquinas. Seu uso é comparável aos grupos <trademark class="registered">UNIX</trademark>, onde a principal diferença é a falta de um ID numérico e a capacidade de definir um netgroup incluindo contas de usuário e outros netgroups.</para>

      <para>Para expandir o exemplo usado neste capítulo, o domínio <acronym>NIS</acronym> será estendido para adicionar os usuários e sistemas mostrados nas Tabelas 28.2 e 28.3:</para>

      <table frame="none" pgwide="1">
	<title>Usuários Adicionais</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Nome(s) de usuário</entry>
	      <entry>Descrição</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><systemitem class="username">alpha</systemitem>, <systemitem class="username">beta</systemitem></entry>
	      <entry>Funcionários do departamento de TI</entry>
	    </row>

	    <row>
	      <entry><systemitem class="username">charlie</systemitem>, <systemitem class="username">delta</systemitem></entry>
	      <entry>Aprendizes do departamento de TI</entry>
	    </row>

	    <row>
	      <entry><systemitem class="username">echo</systemitem>, <systemitem class="username">foxtrott</systemitem>, <systemitem class="username">golf</systemitem>, ...</entry>
	      <entry>funcionários</entry>
	    </row>

	    <row>
	      <entry><systemitem class="username">able</systemitem>, <systemitem class="username">baker</systemitem>, ...</entry>
	      <entry>estagiários</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <table frame="none" pgwide="1">
	<title>Sistemas Adicionais</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Nome(s) de máquina</entry>
	      <entry>Descrição</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <!--  Names taken from "Good Omens" by Neil Gaiman and Terry
		    Pratchett.  Many thanks for a brilliant book.  -->
	      <entry><systemitem>war</systemitem>, <systemitem>death</systemitem>, <systemitem>famine</systemitem>, <systemitem>pollution</systemitem></entry>
	      <entry>Somente funcionários de TI podem fazer logon nesses servidores.</entry>
	    </row>

	    <row>
	      <!-- gluttony was omitted because it was too fat -->
	      <entry><systemitem>pride</systemitem>, <systemitem>greed</systemitem>, <systemitem>envy</systemitem>, <systemitem>wrath</systemitem>, <systemitem>lust</systemitem>, <systemitem>sloth</systemitem></entry>
	      <entry>Todos os membros do departamento de TI podem fazer login nesses servidores.</entry>
	    </row>

	    <row>
	      <entry><systemitem>one</systemitem>, <systemitem>two</systemitem>, <systemitem>three</systemitem>, <systemitem>four</systemitem>, ...</entry>
	      <entry>Estações de trabalho comuns usadas pelos funcionários.</entry>
	    </row>

	    <row>
	      <entry><systemitem>trashcan</systemitem></entry>
	      <entry>Uma máquina muito antiga sem dados críticos. Até os estagiários podem usar este sistema.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Ao usar netgroups para configurar esse cenário, cada usuário é atribuído a um ou mais netgroups e os logins são permitidos ou proibidos para todos os membros do netgroup. Ao adicionar uma nova máquina, as restrições de login devem ser definidas para todos os netgroups. Quando um novo usuário é adicionado, a conta deve ser adicionada a um ou mais netgroups. Se a configuração do <acronym>NIS</acronym> for planejada com cuidado, somente um arquivo de configuração central precisará ser modificado para conceder ou negar acesso a máquinas.</para>

      <para>O primeiro passo é a inicialização do mapa do <acronym>NIS</acronym> <literal>netgroup</literal>. No FreeBSD, este mapa não é criado por padrão. No servidor <acronym>NIS</acronym> master, use um editor para criar um mapa chamado <filename>/var/yp/netgroup</filename>.</para>

      <para>Este exemplo cria quatro grupos de rede para representar funcionários de TI, aprendizes de TI, funcionários e estagiários:</para>

      <programlisting>IT_EMP  (,alpha,test-domain)    (,beta,test-domain)
IT_APP  (,charlie,test-domain)  (,delta,test-domain)
USERS   (,echo,test-domain)     (,foxtrott,test-domain) \
        (,golf,test-domain)
INTERNS (,able,test-domain)     (,baker,test-domain)</programlisting>

      <para>Cada entrada configura um netgroup. A primeira coluna em uma entrada é o nome do netgroup. Cada conjunto de colchetes representa um grupo de um ou mais usuários ou o nome de outro grupo de rede. Ao especificar um usuário, os três campos delimitados por vírgula dentro de cada grupo representam:</para>

      <orderedlist>
	<listitem>
	  <para>O nome do(s) host(s) onde os outros campos que representam o usuário são válidos. Se um nome de host não for especificado, a entrada será válida em todos os hosts.</para>
	</listitem>

	<listitem>
	  <para>O nome da conta que pertence a este netgroup.</para>
	</listitem>

	<listitem>
	  <para>O domínio <acronym>NIS</acronym> da conta. As contas podem ser importadas de outros domínios do <acronym>NIS</acronym> para um netgroup.</para>
	</listitem>
      </orderedlist>

      <para>Se um grupo contiver vários usuários, separe cada usuário com espaço em branco. Além disso, cada campo pode conter curingas. Veja <citerefentry><refentrytitle>netgroup</refentrytitle><manvolnum>5</manvolnum></citerefentry> para detalhes.</para>

      <indexterm><primary>netgroups</primary></indexterm>
      <para>Nomes de grupos maiores que 8 caracteres não devem ser usados. Os nomes diferenciam maiúsculas de minúsculas e usar letras maiúsculas para nomes de grupos de rede é uma maneira fácil de distinguir entre nomes de usuários, máquinas e grupos de rede.</para>

      <para>Alguns clientes não-FreeBSD <acronym>NIS</acronym> não podem lidar com netgroups contendo mais de 15 entradas. Esse limite pode ser contornado criando vários grupos de sub-redes com 15 usuários ou menos e um grupo de rede real consistindo dos grupos de sub-redes, como visto neste exemplo:</para>

      <programlisting>BIGGRP1  (,joe1,domain)  (,joe2,domain)  (,joe3,domain) [...]
BIGGRP2  (,joe16,domain)  (,joe17,domain) [...]
BIGGRP3  (,joe31,domain)  (,joe32,domain)
BIGGROUP  BIGGRP1 BIGGRP2 BIGGRP3</programlisting>

      <para>Repita este processo se mais de 225 (15 vezes 15) usuários existirem dentro de um único netgroup.</para>

      <para>Para ativar e distribuir o novo mapa do <acronym>NIS</acronym>:</para>

      <screen>ellington<prompt>#</prompt> <userinput>cd /var/yp</userinput>
ellington<prompt>#</prompt> <userinput>make</userinput></screen>

      <para>Isso gerará os três mapas <acronym>NIS</acronym>, <filename>netgroup</filename>, <filename>netgroup.byhost</filename> e <filename>netgroup.byuser</filename>. Use a opção de chave de mapa <citerefentry><refentrytitle>ypcat</refentrytitle><manvolnum>1</manvolnum></citerefentry> para verificar se os novos mapas de <acronym>NIS</acronym> estão disponíveis:</para>

      <screen>ellington<prompt>%</prompt> <userinput>ypcat -k netgroup</userinput>
ellington<prompt>%</prompt> <userinput>ypcat -k netgroup.byhost</userinput>
ellington<prompt>%</prompt> <userinput>ypcat -k netgroup.byuser</userinput></screen>

      <para>A saída do primeiro comando deve lembrar o conteúdo de <filename>/var/yp/netgroup</filename>. O segundo comando só produz saída se os netgroups específicos do host foram criados. O terceiro comando é usado para obter a lista de netgroups de um usuário.</para>

      <para>Para configurar um cliente, use <citerefentry><refentrytitle>vipw</refentrytitle><manvolnum>8</manvolnum></citerefentry> para especificar o nome do netgroup. Por exemplo, no servidor chamado <systemitem>war</systemitem>, substitua esta linha:</para>

      <programlisting>+:::::::::</programlisting>

      <para>com</para>

      <programlisting>+@IT_EMP:::::::::</programlisting>

      <para>Isso especifica que apenas os usuários definidos no netgroup <literal>IT_EMP</literal> serão importados para o banco de dados de senhas deste sistema e somente esses usuários terão permissão para efetuar login nesse sistema.</para>

      <para>Essa configuração também se aplica à função <literal>~</literal> do shell e a todas as rotinas que convertem entre nomes de usuário e IDs de usuário numérico. Em outras palavras, <command>cd ~<replaceable>user</replaceable></command> não funcionará, <command>ls -l</command> mostrará o ID numérico em vez do nome de usuário e <command>find . -user joe -print</command> falhará com a mensagem <errorname>No such user</errorname>. Para corrigir isso, importe todas as entradas do usuário sem permitir que elas efetuem login nos servidores. Isto pode ser conseguido adicionando uma linha extra:</para>

      <programlisting>+:::::::::/usr/sbin/nologin</programlisting>

      <para>Esta linha configura o cliente para importar todas as entradas, mas para substituir o shell nessas entradas com <filename>/usr/sbin/nologin</filename>.</para>

      <!-- Been there, done that, got the scars to prove it - ue -->
      <para>Certifique-se que a linha extra é colocada <emphasis>após</emphasis> <literal>+@IT_EMP:::::::::</literal>. Caso contrário, todas as contas de usuário importadas do <acronym>NIS</acronym> terão <filename>/usr/sbin/nologin</filename> como seu shell de login e ninguém poderá efetuar o login no sistema.</para>

      <para>Para configurar os servidores menos importantes, substitua o antigo <literal>+:::::::::</literal> nos servidores com estas linhas:</para>

      <programlisting>+@IT_EMP:::::::::
+@IT_APP:::::::::
+:::::::::/usr/sbin/nologin</programlisting>

      <para>As linhas correspondentes para as estações de trabalho seriam:</para>

      <programlisting>+@IT_EMP:::::::::
+@USERS:::::::::
+:::::::::/usr/sbin/nologin</programlisting>

      <para>O NIS suporta a criação de grupos de rede de outros grupos de rede, o que pode ser útil se a política relacionada ao acesso do usuário for alterada. Uma possibilidade é a criação de netgroups baseados em funções. Por exemplo, pode-se criar um netgroup chamado <literal>BIGSRV</literal> para definir as restrições de login para os servidores importantes, outro grupo de rede chamado <literal>SMALLSRV</literal> para os servidores menos importantes e um terceiro netgroup chamado <literal>USERBOX</literal> para as estações de trabalho. Cada um desses netgroups contém os netgroups com permissão para efetuar login nessas máquinas. As novas entradas para o mapa do <acronym>NIS</acronym> <literal>netgroup</literal> seriam assim:</para>

      <programlisting>BIGSRV    IT_EMP  IT_APP
SMALLSRV  IT_EMP  IT_APP  ITINTERN
USERBOX   IT_EMP  ITINTERN USERS</programlisting>

      <para>Esse método de definir restrições de login funciona razoavelmente bem quando é possível definir grupos de máquinas com restrições idênticas. Infelizmente, esta é a exceção e não a regra. Na maioria das vezes, é necessária a capacidade de definir restrições de login por máquina.</para>

      <para>As definições de netgroup específicas da máquina são outra possibilidade para lidar com as mudanças na política. Neste cenário, o <filename>/etc/master.passwd</filename> de cada sistema contém duas linhas que começam com <quote>+</quote>. A primeira linha adiciona um netgroup com as contas permitidas para entrar nesta máquina e a segunda linha adiciona todas as outras contas com <filename>/usr/sbin/nologin</filename> como shell. Recomenda-se usar a versão <quote>ALL-CAPS</quote> do nome do host como o nome do netgroup:</para>

      <programlisting>+@<replaceable>BOXNAME</replaceable>:::::::::
+:::::::::/usr/sbin/nologin</programlisting>

      <para>Quando esta tarefa estiver completa em todas as máquinas, não haverá mais a necessidade de modificar as versões locais de <filename>/etc/master.passwd</filename> novamente. Todas as alterações posteriores podem ser manipuladas, modificando o mapa do <acronym>NIS</acronym>. Aqui está um exemplo de um possível mapa <literal>netgroup</literal> para este cenário:</para>

      <programlisting># Define groups of users first
IT_EMP    (,alpha,test-domain)    (,beta,test-domain)
IT_APP    (,charlie,test-domain)  (,delta,test-domain)
DEPT1     (,echo,test-domain)     (,foxtrott,test-domain)
DEPT2     (,golf,test-domain)     (,hotel,test-domain)
DEPT3     (,india,test-domain)    (,juliet,test-domain)
ITINTERN  (,kilo,test-domain)     (,lima,test-domain)
D_INTERNS (,able,test-domain)     (,baker,test-domain)
#
# Now, define some groups based on roles
USERS     DEPT1   DEPT2     DEPT3
BIGSRV    IT_EMP  IT_APP
SMALLSRV  IT_EMP  IT_APP    ITINTERN
USERBOX   IT_EMP  ITINTERN  USERS
#
# And a groups for a special tasks
# Allow echo and golf to access our anti-virus-machine
SECURITY  IT_EMP  (,echo,test-domain)  (,golf,test-domain)
#
# machine-based netgroups
# Our main servers
WAR       BIGSRV
FAMINE    BIGSRV
# User india needs access to this server
POLLUTION  BIGSRV  (,india,test-domain)
#
# This one is really important and needs more access restrictions
DEATH     IT_EMP
#
# The anti-virus-machine mentioned above
ONE       SECURITY
#
# Restrict a machine to a single user
TWO       (,hotel,test-domain)
# [...more groups to follow]</programlisting>

      <para>Pode não ser sempre aconselhável usar netgroups baseados em máquina. Ao implantar algumas dúzias ou centenas de sistemas, grupos de rede baseados em funções em vez de grupos de rede baseados em máquina podem ser usados para manter o tamanho do mapa do <acronym>NIS</acronym> dentro de limites razoáveis.</para>
    </sect2>

    <sect2>
      <title>Formatos de Senha</title>

      <indexterm><primary>NIS</primary> <secondary>password formats</secondary></indexterm>
      <para>O <acronym>NIS</acronym> requer que todos os hosts em um domínio <acronym>NIS</acronym> usem o mesmo formato para criptografar senhas. Se os usuários tiverem problemas para autenticar em um cliente <acronym>NIS</acronym>, pode ser devido a um formato de senha diferente. Em uma rede heterogênea, o formato deve ser suportado por todos os sistemas operacionais, onde <acronym>DES</acronym> é o padrão comum mais baixo.</para>

      <para>Para verificar qual formato um servidor ou cliente está usando, veja esta seção do <filename>/etc/login.conf</filename>:</para>

      <programlisting>default:\
	:passwd_format=des:\
	:copyright=/etc/COPYRIGHT:\
	[Further entries elided]</programlisting>

      <para>Neste exemplo, o sistema está usando o formato <acronym>DES</acronym>. Outros valores possíveis são <literal>blf</literal> para Blowfish e <literal>md5</literal> para senhas criptografadas com MD5.</para>

      <para>Se o formato em um host precisar ser editado para corresponder ao que está sendo usado no domínio <acronym>NIS</acronym>, o banco de dados de recursos de login deve ser reconstruído após salvar a alteração:</para>

      <screen><prompt>#</prompt> <userinput>cap_mkdb /etc/login.conf</userinput></screen>

      <note>
	<para>O formato das senhas das contas de usuários existentes não será atualizado até que cada usuário mude sua senha <emphasis>após</emphasis> o banco de dados de recursos de login ser reconstruído.</para>
      </note>
    </sect2>
  </sect1>

  <sect1 xml:id="network-ldap">
    <info>
      <title>Protocolo leve de acesso de diretório (<acronym> LDAP </acronym>)</title>

      <authorgroup>
	<author><personname> <firstname>Tom</firstname> <surname>Rhodes</surname> </personname> <contrib> Originalmente contribuido por </contrib></author>
      </authorgroup>
      <authorgroup>
	<author><personname> <firstname>Rocky</firstname> <surname>Hotas</surname> </personname> <contrib> Atualizado por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>LDAP</primary></indexterm>

    <para>O protocolo LDAP (<acronym>LDAP</acronym>) é um protocolo da camada de aplicação usado para acessar, modificar e autenticar objetos usando um serviço de informações de diretório distribuído. Pense nisso como um telefone ou livro de registro que armazena vários níveis de informações hierárquicas e homogêneas. Ele é usado nas redes do Active Directory e do <application>OpenLDAP</application> e permite que os usuários acessem vários níveis de informações internas utilizando uma única conta. Por exemplo, a autenticação de email, a obtenção de informações de contato dos funcionários e a autenticação interna de sites podem usar uma única conta de usuário na base de registros do servidor <acronym>LDAP</acronym>.</para>

    <para>Esta seção fornece um guia de início rápido para configurar um servidor <acronym>LDAP</acronym> em um sistema FreeBSD. Ele pressupõe que o administrador já tenha um plano de design que inclua o tipo de informação a ser armazenada, para que essas informações sejam usadas, quais usuários devem ter acesso a essas informações e como proteger essas informações contra acesso não autorizado.</para>

    <sect2>
      <title>Terminologia e Estrutura do <acronym>LDAP</acronym></title>

      <para>O <acronym>LDAP</acronym> usa vários termos que devem ser entendidos antes de iniciar a configuração. Todas as entradas de diretório consistem em um grupo de <firstterm>attributes</firstterm>. Cada um desses conjuntos de atributos contém um identificador exclusivo conhecido como <firstterm>Distinguished Name</firstterm> (<acronym>DN</acronym>) que é normalmente criado a partir de vários outros atributos, como Common ou <firstterm>Relative Distinguished Name</firstterm> (<acronym>RDN</acronym>). Semelhante a como os diretórios têm caminhos absolutos e relativos, considere um <acronym>DN</acronym> como um caminho absoluto e o <acronym>RDN</acronym> como o caminho relativo.</para>

      <para>Um exemplo de entrada <acronym>LDAP</acronym> é semelhante ao seguinte. Este exemplo procura a entrada para a conta de usuário especificada (<literal>uid</literal>), unidade organizacional (<literal>ou</literal>) e organização (<literal>o</literal>):</para>

      <screen><prompt>%</prompt> <userinput>ldapsearch -xb "uid=<replaceable>trhodes</replaceable>,ou=<replaceable>users</replaceable>,o=<replaceable>example.com</replaceable>"</userinput>
# extended LDIF
#
# LDAPv3
# base &lt;uid=trhodes,ou=users,o=example.com&gt; with scope subtree
# filter: (objectclass=*)
# requesting: ALL
#

# trhodes, users, example.com
dn: uid=trhodes,ou=users,o=example.com
mail: trhodes@example.com
cn: Tom Rhodes
uid: trhodes
telephoneNumber: (123) 456-7890

# search result
search: 2
result: 0 Success

# numResponses: 2
# numEntries: 1</screen>

      <para>Esta entrada de exemplo mostra os valores para os atributos <literal>dn</literal>, <literal>mail</literal>, <literal>cn</literal>, <literal>uid</literal> e <literal>telephoneNumber</literal>. O atributo do <acronym>cn</acronym> é o <acronym>RDN</acronym>.</para>

      <para>Maiores informações sobre o <acronym>LDAP</acronym> e sua terminologia podem ser encontradas em <uri xlink:href="http://www.openldap.org/doc/admin24/intro.html">http://www.openldap.org/doc/admin24/intro.html</uri>.</para>
    </sect2>

    <sect2 xml:id="ldap-config">
      <title>Configurando um servidor <acronym>LDAP</acronym></title>

      <indexterm><primary>LDAP Server</primary></indexterm>

      <para>O FreeBSD não provê um servidor <acronym>LDAP</acronym> embutido. Comece a configuração instalando o pacote ou port <package role="port">net/openldap-server</package>:</para>

      <screen><prompt>#</prompt> <userinput>pkg install openldap-server</userinput></screen>

      <para>Aqui está um largo conjunto de opções habilitadas no <link xlink:href="@@URL_RELPREFIX@@/doc/en_US.ISO8859-1/articles/linux-users/software.html">pacote</link>. Reveja-os rodando o comando <command>pkg info openldap-server</command>. Se não for suficiente (por exemplo se o suporte a SQL for necessário), por favor considere recompilar o port usando o framework <link xlink:href="@@URL_RELPREFIX@@/doc/en_US.ISO8859-1/books/handbook/ports-using.html">apropriado</link>.</para>

      <para>A instalação cria o diretório <filename>/var/db/openldap-data</filename> para conter os dados. O diretório para armazenar os certificados deve ser criado:</para>

      <screen><prompt>#</prompt> <userinput>mkdir /usr/local/etc/openldap/private</userinput></screen>

      <para>A próxima fase é configurar a autoridade de certificação. Os seguintes comandos devem ser executados em <filename>/usr/local/etc/openldap/private</filename>. Isso é importante, pois as permissões de arquivo precisam ser restritivas e os usuários não devem ter acesso a esses arquivos. Informações mais detalhadas sobre certificados e seus parâmetros podem ser encontradas em <xref linkend="openssl"/>. Para criar a Autoridade de Certificação, comece com este comando e siga os prompts:</para>

      <screen><prompt>#</prompt> <userinput>openssl req -days <replaceable>365</replaceable> -nodes -new -x509 -keyout ca.key -out ../ca.crt</userinput></screen>

      <para>As entradas para os prompts podem ser genéricas <emphasis>exceto</emphasis> para o <literal>Common Name</literal>. Esta entrada deve ser <emphasis>diferente</emphasis> do nome do host do sistema. Se este será  um certificado auto-assinado, prefixe o nome do host com <literal>CA</literal> para a Autoridade de Certificação.</para>

      <para>A próxima tarefa é criar uma solicitação de assinatura de certificado e uma chave privada. Insira este comando e siga os prompts:</para>

      <screen><prompt>#</prompt> <userinput>openssl req -days <replaceable>365</replaceable> -nodes -new -keyout server.key -out server.csr</userinput></screen>

      <para>Durante o processo de geração de certificados, certifique-se de configurar corretamente o atributo <literal>Common Name</literal>. A Solicitação de Assinatura de Certificado deve ser assinada com a Autoridade de Certificação para ser usada como um certificado válido:</para>

      <screen><prompt>#</prompt> <userinput>openssl x509 -req -days <replaceable>365</replaceable> -in server.csr -out ../server.crt -CA ../ca.crt -CAkey ca.key -CAcreateserial</userinput></screen>

      <para>A parte final do processo de geração de certificados é gerar e assinar os certificados do cliente:</para>

      <screen><prompt>#</prompt> <userinput>openssl req -days <replaceable>365</replaceable> -nodes -new -keyout client.key -out client.csr</userinput>
<prompt>#</prompt> <userinput>openssl x509 -req -days 3650 -in client.csr -out ../client.crt -CA ../ca.crt -CAkey ca.key</userinput></screen>

      <para>Lembre-se de usar o mesmo atributo <literal>Common Name</literal> quando solicitado. Quando terminar, assegure-se de que um total de oito (8) novos arquivos tenham sido gerado através dos comandos procedentes.</para>

      <para>O daemon que executa o servidor OpenLDAP é o <filename>slapd</filename>. Sua configuração é executada através do <filename>slapd.ldif</filename>: o antigo <filename>slapd.conf</filename> foi descontinuado pelo OpenLDAP.</para>

      <para><link xlink:href="http://www.openldap.org/doc/admin24/slapdconf2.html">Exemplos de configuração</link> para o <filename>slapd.ldif</filename> estão disponíveis e também podem ser encontrados em <filename>/usr/local/etc/openldap/slapd.ldif.sample</filename>. As opções estão documentadas em slapd-config(5). Cada seção do <filename>slapd.ldif</filename>, como todos os outros conjuntos de atributos LDAP, é identificada exclusivamente por meio de um DN. Certifique-se de que nenhuma linha em branco seja deixada entre a instrução <literal>dn:</literal> e o final desejado da seção. No exemplo a seguir, o TLS será usado para implementar um canal seguro. A primeira seção representa a configuração global:</para>

      <programlisting>#
# See slapd-config(5) for details on configuration options.
# This file should NOT be world readable.
#
dn: cn=config
objectClass: olcGlobal
cn: config
#
#
# Define global ACLs to disable default read access.
#
olcArgsFile: /var/run/openldap/slapd.args
olcPidFile: /var/run/openldap/slapd.pid
olcTLSCertificateFile: /usr/local/etc/openldap/server.crt
olcTLSCertificateKeyFile: /usr/local/etc/openldap/private/server.key
olcTLSCACertificateFile: /usr/local/etc/openldap/ca.crt
#olcTLSCipherSuite: HIGH
olcTLSProtocolMin: 3.1
olcTLSVerifyClient: never</programlisting>

      <para>A Autoridade de Certificação, o certificado do servidor e os arquivos de chave privada do servidor devem ser especificados aqui. Recomenda-se que os clientes escolham a opção de criptografia de segurança e omitam <literal>olcTLSCipherSuite</literal> (incompatível com clientes TLS diferentes de <filename>openssl</filename>). A opção <literal>olcTLSProtocolMin</literal> permite que o servidor exija um nível mínimo de segurança: é recomendado. Enquanto a verificação é obrigatória para o servidor, não é para o cliente: <literal>olcTLSVerifyClient: never</literal>.</para>

      <para>A segunda seção é sobre os módulos de backend e pode ser configurada da seguinte maneira:</para>

      <programlisting>#
# Load dynamic backend modules:
#
dn: cn=module,cn=config
objectClass: olcModuleList
cn: module
olcModulepath:	/usr/local/libexec/openldap
olcModuleload:	back_mdb.la
#olcModuleload:	back_bdb.la
#olcModuleload:	back_hdb.la
#olcModuleload:	back_ldap.la
#olcModuleload:	back_passwd.la
#olcModuleload:	back_shell.la</programlisting>

      <para>A terceira seção é dedicada a carregar os esquemas <literal>ldif</literal> necessários para serem usados pelos bancos de dados: eles são essenciais.</para>

      <programlisting>dn: cn=schema,cn=config
objectClass: olcSchemaConfig
cn: schema

include: file:///usr/local/etc/openldap/schema/core.ldif
include: file:///usr/local/etc/openldap/schema/cosine.ldif
include: file:///usr/local/etc/openldap/schema/inetorgperson.ldif
include: file:///usr/local/etc/openldap/schema/nis.ldif</programlisting>

      <para>Em seguida, a seção de configuração do frontend:</para>

      <programlisting># Frontend settings
#
dn: olcDatabase={-1}frontend,cn=config
objectClass: olcDatabaseConfig
objectClass: olcFrontendConfig
olcDatabase: {-1}frontend
olcAccess: to * by * read
#
# Sample global access control policy:
#	Root DSE: allow anyone to read it
#	Subschema (sub)entry DSE: allow anyone to read it
#	Other DSEs:
#		Allow self write access
#		Allow authenticated users read access
#		Allow anonymous users to authenticate
#
#olcAccess: to dn.base="" by * read
#olcAccess: to dn.base="cn=Subschema" by * read
#olcAccess: to *
#	by self write
#	by users read
#	by anonymous auth
#
# if no access controls are present, the default policy
# allows anyone and everyone to read anything but restricts
# updates to rootdn.  (e.g., "access to * by * read")
#
# rootdn can always read and write EVERYTHING!
#
olcPasswordHash: {SSHA}
# {SSHA} is already the default for olcPasswordHash</programlisting>

      <para>Outra seção é dedicada ao <emphasis>backend de configuração</emphasis>, a única maneira de acessar posteriormente a configuração do servidor OpenLDAP é como um superusuário global.</para>

      <programlisting>dn: olcDatabase={0}config,cn=config
objectClass: olcDatabaseConfig
olcDatabase: {0}config
olcAccess: to * by * none
olcRootPW: {SSHA}iae+lrQZILpiUdf16Z9KmDmSwT77Dj4U</programlisting>

      <para>O nome de usuário administrador padrão é <literal>cn=config</literal>. Digite <filename>slappasswd</filename> em um shell, escolha a senha e use sua hash <literal>olcRootPW</literal>. Se essa opção não for especificada agora, antes do arquivo <filename>slapd.ldif</filename> ser importado, ninguém poderá modificar a seção de <emphasis>configuração global</emphasis>.</para>

      <para>A última seção é sobre o back-end do banco de dados:</para>

      <programlisting>#######################################################################
# LMDB database definitions
#######################################################################
#
dn: olcDatabase=mdb,cn=config
objectClass: olcDatabaseConfig
objectClass: olcMdbConfig
olcDatabase: mdb
olcDbMaxSize: 1073741824
olcSuffix: dc=domain,dc=example
olcRootDN: cn=mdbadmin,dc=domain,dc=example
# Cleartext passwords, especially for the rootdn, should
# be avoided.  See slappasswd(8) and slapd-config(5) for details.
# Use of strong authentication encouraged.
olcRootPW: {SSHA}X2wHvIWDk6G76CQyCMS1vDCvtICWgn0+
# The database directory MUST exist prior to running slapd AND
# should only be accessible by the slapd and slap tools.
# Mode 700 recommended.
olcDbDirectory:	/var/db/openldap-data
# Indices to maintain
olcDbIndex: objectClass eq</programlisting>

      <para>Esse banco de dados hospeda os <emphasis>conteudos atuais</emphasis> do diretório <acronym>LDAP</acronym>. Outros tipos diferentes de <literal>mdb</literal> estão disponiveis. Esse é super-usuário, não confundir com um global, é configurado aqui: um usuário (possivelmente customizado) em <literal>olcRootDN</literal> e a hash da senha em <literal>olcRootPW</literal>; <filename>slappasswd</filename> pode ser usado como antes.</para>

      <para>Esse <link xlink:href="http://www.openldap.org/devel/gitweb.cgi?p=openldap.git;a=tree;f=tests/data/regressions/its8444;h=8a5e808e63b0de3d2bdaf2cf34fecca8577ca7fd;hb=HEAD">repositorio</link> contém quatro exemplos do arquivo <filename>slapd.ldif</filename>. Para converter um arquivo <filename>slapd.conf</filename> existente dentro de <filename>slapd.ldif</filename>, referencie a <link xlink:href="http://www.openldap.org/doc/admin24/slapdconf2.html">essa página</link> (por favor, note que isso pode introduzir algumas opções inuteis).</para>

      <para>Quando a configuração estiver concluída, o <filename>slapd.ldif</filename> deve ser colocado em um diretório vazio. Recomenda-se criá-lo como:</para>

      <screen><prompt>#</prompt> <userinput>mkdir /usr/local/etc/openldap/slapd.d/</userinput></screen>

      <para>Importe o banco de dados de configuração:</para>

      <screen><prompt>#</prompt> <userinput>/usr/local/sbin/slapadd -n0 -F /usr/local/etc/openldap/slapd.d/ -l /usr/local/etc/openldap/slapd.ldif</userinput></screen>

      <para>Inicie o daemon <filename>slapd</filename>:</para>

      <screen><prompt>#</prompt> <userinput>/usr/local/libexec/slapd -F /usr/local/etc/openldap/slapd.d/</userinput></screen>

      <para>A opção <literal>-d</literal> pode ser usada para depuração, conforme especificado em slapd(8). Para verificar se o servidor está em execução e funcionando:</para>

      <screen><prompt>#</prompt> <userinput>ldapsearch -x -b '' -s base '(objectclass=*)' namingContexts</userinput>
# extended LDIF
#
# LDAPv3
# base &lt;&gt; with scope baseObject
# filter: (objectclass=*)
# requesting: namingContexts
#

#
dn:
namingContexts: dc=domain,dc=example

# search result
search: 2
result: 0 Success

# numResponses: 2
# numEntries: 1</screen>

      <para>O servidor ainda deve ser confiável. Se isso nunca foi feito antes, siga estas instruções. Instale o pacote ou o port OpenSSL:</para>

      <screen><prompt>#</prompt> <userinput>pkg install openssl</userinput></screen>

      <para>No diretório onde o <filename>ca.crt</filename> está armazenado (neste exemplo, <filename>/usr/local/etc/openldap</filename>), execute:</para>

      <screen><prompt>#</prompt> <userinput>c_rehash .</userinput></screen>

      <para>Tanto a CA quanto o certificado do servidor agora são reconhecidos corretamente em suas respectivas funções. Para verificar isso, execute este comando no diretório <filename>server.crt</filename>:</para>

      <screen><prompt>#</prompt> <userinput>openssl verify -verbose -CApath . server.crt</userinput></screen>

      <para>Se o <filename>slapd</filename> estiver em execução, reinicie-o. Como declarado em <filename>/usr/local/etc/rc.d/slapd</filename>, para executar corretamente o <filename>slapd</filename> na inicialização, as seguintes linhas devem ser adicionadas ao <filename>/etc/rc.conf</filename>:</para>

      <programlisting>lapd_enable="YES"
slapd_flags='-h "ldapi://%2fvar%2frun%2fopenldap%2fldapi/
ldap://0.0.0.0/"'
slapd_sockets="/var/run/openldap/ldapi"
slapd_cn_config="YES"</programlisting>

      <para>O <filename>slapd</filename> não fornece depuração na inicialização. Verifique o <filename>/var/log/debug.log</filename>, o <filename>dmesg -a</filename> e o <filename>/var/log/messages </filename> para este propósito.</para>

      <para>O exemplo a seguir adiciona o grupo <literal>team</literal> e o usuário  <literal>john</literal> ao banco de dados <acronym>LDAP</acronym> de  <systemitem class="systemname">domain.example</systemitem>, que ainda está vazio. Primeiro, crie o arquivo <filename>domain.ldif</filename>:</para>

      <screen><prompt>#</prompt> <userinput>cat domain.ldif</userinput>
dn: dc=domain,dc=example
objectClass: dcObject
objectClass: organization
o: domain.example
dc: domain

dn: ou=groups,dc=domain,dc=example
objectClass: top
objectClass: organizationalunit
ou: groups

dn: ou=users,dc=domain,dc=example
objectClass: top
objectClass: organizationalunit
ou: users

dn: cn=team,ou=groups,dc=domain,dc=example
objectClass: top
objectClass: posixGroup
cn: team
gidNumber: 10001

dn: uid=john,ou=users,dc=domain,dc=example
objectClass: top
objectClass: account
objectClass: posixAccount
objectClass: shadowAccount
cn: John McUser
uid: john
uidNumber: 10001
gidNumber: 10001
homeDirectory: /home/john/
loginShell: /usr/bin/bash
userPassword: secret</screen>

      <para>Veja a documentação do OpenLDAP para mais detalhes. Use <filename>slappasswd</filename> para substituir a senha  <literal>secret</literal> em texto puro com um hash no <literal>userPassword</literal>. O caminho especificado como <literal>loginShell</literal> deve existir em todos sistemas onde <literal>john</literal> pode se logar. Finalmente, use o administrador <literal>mdb</literal> para modificar o banco de dados:</para>

      <screen><prompt>#</prompt> <userinput>ldapadd -W -D "cn=mdbadmin,dc=domain,dc=example" -f domain.ldif</userinput></screen>

      <para>Modificações para a seção <emphasis>configurações globais</emphasis> podem ser feitas apenas pelo super-usuário global. Por exemplo, assume que a opção <literal>olcTLSCipherSuite: HIGH:MEDIUM:SSLv3</literal> foi inicialmente especificada e deve agora ser deletada. Primeiro, crie um arquivo que contenha o seguinte:</para>

      <screen><prompt>#</prompt> <userinput>cat <replaceable>global_mod</replaceable></userinput>
dn: cn=config
changetype: modify
delete: olcTLSCipherSuite</screen>

      <para>Em seguida, aplique as modificações:</para>

      <screen><prompt>#</prompt> <userinput>ldapmodify -f global_mod -x -D "cn=config" -W</userinput></screen>

      <para>Quando solicitado, forneça a senha escolhida na seção <emphasis>configuração backend</emphasis>. O nome de usuário não é necessário: aqui, <literal>cn=config</literal> representa o DN da seção do banco de dados a ser modificada. Como alternativa, use <literal>ldapmodify</literal> para excluir uma única linha do banco de dados, <literal>ldapdelete</literal> para excluir uma entrada inteira.</para>

      <para>Se algo der errado ou se o superusuário global não puder acessar o backend de configuração, é possível excluir e reescrever toda a configuração:</para>

      <screen><prompt>#</prompt> <userinput>rm -rf /usr/local/etc/openldap/slapd.d/</userinput></screen>

      <para>O <filename>slapd.ldif</filename> pode então ser editado e importado novamente. Por favor, siga este procedimento somente quando nenhuma outra solução estiver disponível.</para>

      <para>Esta é a configuração do servidor apenas. A mesma máquina também pode hospedar um cliente LDAP, com sua própria configuração separada.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="network-dhcp">
    <!--
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Greg</firstname>
	  <surname>Sutter</surname>
	  <contrib>Written by </contrib>
	</author>
      </authorgroup>
    </sect1info>
    -->
    <title>Protocolo de configuração dinâmica de hosts (<acronym>DHCP</acronym>)</title>

    <indexterm><primary>Dynamic Host Configuration Protocol</primary> <see><acronym>DHCP</acronym></see></indexterm>
    <indexterm><primary>Internet Systems Consortium (ISC)</primary></indexterm>

    <para>O protocolo de configuração dinâmica de hosts (<acronym>DHCP</acronym>) permite que um sistema se conecte a uma rede para receber as informações de endereçamento necessárias para a comunicação nessa rede. O FreeBSD inclui a versão do <command>dhclient</command> do OpenBSD que é usada pelo cliente para obter as informações de endereçamento. O FreeBSD não instala um servidor <acronym>DHCP</acronym>, mas vários servidores estão disponíveis na coleção de Ports do FreeBSD. O protocolo <acronym>DHCP</acronym> é totalmente descrito em <link xlink:href="http://www.freesoft.org/CIE/RFC/2131/">RFC 2131</link>. Recursos informativos também estão disponíveis em <link xlink:href="http://www.isc.org/downloads/dhcp/">isc.org/downloads/dhcp/</link>.</para>

    <para>Esta seção descreve como usar o cliente <acronym>DHCP</acronym> integrado. Em seguida, descreve como instalar e configurar um servidor <acronym>DHCP</acronym>.</para>

    <note>
      <para>No FreeBSD, o dispositivo <citerefentry><refentrytitle>bpf</refentrytitle><manvolnum>4</manvolnum></citerefentry> é necessário tanto pelo servidor <acronym>DHCP</acronym> como pelo <acronym>DHCP</acronym> &gt; cliente. Este dispositivo está incluído no kernel <filename>GENERIC</filename> que é instalado com o FreeBSD. Usuários que preferem criar um kernel personalizado precisam manter este dispositivo se o <acronym>DHCP</acronym> for usado.</para>

      <para>Deve-se notar que o <filename>bpf</filename> também permite que usuários privilegiados executem sniffers de pacotes de rede naquele sistema.</para>
    </note>

    <sect2>
      <title>Configurando um cliente <acronym>DHCP</acronym></title>

      <para>O suporte ao cliente <acronym>DHCP</acronym> está incluído no instalador do FreeBSD, facilitando a configuração de um sistema recém-instalado para receber automaticamente as informações de endereçamento de rede de um servidor <acronym>DHCP</acronym> existente. Consulte <xref linkend="bsdinstall-post"/> para exemplos de configuração de rede.</para>

      <indexterm><primary><acronym>UDP</acronym></primary></indexterm>
      <para>Quando o <command>dhclient</command> é executado na máquina cliente, ele inicia as solicitações de transmissão das informações de configuração. Por padrão, esses pedidos usam a porta <acronym>UDP</acronym> 68. O servidor responde na porta <acronym>UDP</acronym> 67 , fornecendo ao cliente um endereço <acronym>IP</acronym> e outras informações de rede relevantes como uma máscara de sub-rede, gateway padrão e endereços de servidor <acronym>DNS</acronym>. Esta informação está na forma de uma <quote>concessão</quote> de <acronym>DHCP</acronym> e é válida por um tempo configurável. Isso permite que endereços <acronym>IP</acronym> obsoletos para clientes que não estejam mais conectados à rede sejam reutilizados automaticamente. Clientes <acronym>DHCP</acronym> podem obter uma grande quantidade de informações do servidor. Uma lista exaustiva pode ser encontrada em <citerefentry><refentrytitle>dhcp-options</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>

      <para>Por padrão, quando um sistema FreeBSD inicializa, seu cliente <acronym>DHCP</acronym> é executado em segundo plano, ou <firstterm>asynchronously</firstterm>. Outros scripts de inicialização continuam sendo executados enquanto o processo <acronym>DHCP</acronym> é concluído, o que acelera a inicialização do sistema.</para>

      <para>O <acronym>DHCP</acronym> em segundo plano funciona bem quando o servidor <acronym>DHCP</acronym> responde rapidamente às solicitações do cliente. No entanto, o <acronym>DHCP</acronym> pode levar muito tempo para ser concluído em alguns sistemas. Se os serviços de rede tentarem executar antes que o <acronym>DHCP</acronym> tenha atribuído as informações de endereçamento de rede, eles falharão. O uso do <acronym>DHCP</acronym> no modo <firstterm>synchronous</firstterm> impede esse problema, pois ele pausa a inicialização até que a configuração <acronym>DHCP</acronym> seja concluída.</para>

      <para>Esta linha no <filename>/etc/rc.conf</filename> é usada para configurar o modo background ou assíncrono:</para>

      <programlisting>ifconfig_<replaceable>fxp0</replaceable>="DHCP"</programlisting>

      <para>Esta linha pode já existir se o sistema foi configurado para usar o <acronym>DHCP</acronym> durante a instalação. Substitua o <replaceable>fxp0</replaceable> mostrado nesses exemplos pelo nome da interface a ser configurada dinamicamente, conforme descrito em <xref linkend="config-network-setup"/>.</para>

      <para>Para configurar o sistema para usar o modo síncrono e pausar durante a inicialização enquanto o <acronym>DHCP</acronym> é concluído, use <quote><literal>SYNCDHCP</literal></quote>:</para>

      <programlisting>ifconfig_<replaceable>fxp0</replaceable>="SYNCDHCP"</programlisting>

      <para>Opções adicionais do cliente estão disponíveis. Procure por <literal>dhclient</literal> in <citerefentry><refentrytitle>rc.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry> para detalhes.</para>

      <indexterm><primary><acronym>DHCP</acronym></primary> <secondary>configuration files</secondary></indexterm>

      <para>O cliente <acronym>DHCP</acronym> usa os seguintes arquivos:</para>

      <itemizedlist>
	<listitem>
	  <para><filename>/etc/dhclient.conf</filename></para>

	  <para>O arquivo de configuração usado pelo <command>dhclient</command>. Normalmente, esse arquivo contém apenas comentários, pois os padrões são adequados para a maioria dos clientes. Este arquivo de configuração é descrito em <citerefentry><refentrytitle>dhclient.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>
	</listitem>

	<listitem>
	  <para><filename>/sbin/dhclient</filename></para>

	  <para>Maiores informações sobre o comando em si podem ser encontradas em  <citerefentry><refentrytitle>dhclient</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
	</listitem>

	<listitem>
	  <para><filename>/sbin/dhclient-script</filename></para>

	  <para>O script de configuração do cliente <acronym>DHCP</acronym> específico do FreeBSD. Ele é descrito em <citerefentry><refentrytitle>dhclient-script</refentrytitle><manvolnum>8</manvolnum></citerefentry>, mas não deve precisar de nenhuma modificação do usuário para funcionar corretamente.</para>
	</listitem>

	<listitem>
	  <para><filename>/var/db/dhclient.leases.<replaceable>interface</replaceable></filename></para>

	  <para>O cliente <acronym>DHCP</acronym> mantém um banco de dados de concessões válidas neste arquivo, que é escrito como um log e é descrito em  <citerefentry><refentrytitle>dhclient.leases</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>
	</listitem>
      </itemizedlist>
    </sect2>

    <sect2 xml:id="network-dhcp-server">
      <title>Instalando e configurando um servidor <acronym>DHCP</acronym></title>

      <para>Esta seção demonstra como configurar um sistema FreeBSD para atuar como um servidor <acronym>DHCP</acronym> usando a implementação do servidor <acronym>DHCP</acronym> do Internet Systems Consortium (<acronym>ISC</acronym>). Esta implementação e a sua documentação podem ser instaladas usando o pacote ou port <package>net/isc-dhcp43-server</package>.</para>

      <indexterm><primary><acronym>DHCP</acronym></primary> <secondary>server</secondary></indexterm>

      <indexterm><primary><acronym>DHCP</acronym></primary> <secondary>installation</secondary></indexterm>

      <para>A instalação do <package>net/isc-dhcp43-server</package> instala um arquivo de configuração de exemplo. Copie o <filename>/usr/local/etc/dhcpd.conf.example</filename> para <filename>/usr/local/etc/dhcpd.conf</filename> e faça as alterações neste novo arquivo.</para>

      <indexterm><primary><acronym>DHCP</acronym></primary> <secondary>dhcpd.conf</secondary></indexterm>
      <para>O arquivo de configuração é composto de declarações para sub-redes e hosts que definem as informações que são fornecidas aos clientes <acronym>DHCP</acronym>. Por exemplo, essas linhas configuram o seguinte:</para>

      <programlisting>option domain-name "example.org";<co xml:id="domain-name"/>
option domain-name-servers ns1.example.org;<co xml:id="domain-name-servers"/>
option subnet-mask 255.255.255.0;<co xml:id="subnet-mask"/>

default-lease-time 600;<co xml:id="default-lease-time"/>
max-lease-time 72400;<co xml:id="max-lease-time"/>
ddns-update-style none;<co xml:id="ddns-update-style"/>

subnet 10.254.239.0 netmask 255.255.255.224 {
  range 10.254.239.10 10.254.239.20;<co xml:id="range"/>
  option routers rtr-239-0-1.example.org, rtr-239-0-2.example.org;<co xml:id="routers"/>
}

host fantasia {
  hardware ethernet 08:00:07:26:c0:a5;<co xml:id="hardware"/>
  fixed-address fantasia.fugue.com;<co xml:id="fixed-address"/>
}</programlisting>

      <calloutlist>
	<callout arearefs="domain-name">
	  <para>Esta opção especifica o domínio de pesquisa padrão que será fornecido aos clientes. Consulte <citerefentry><refentrytitle>resolv.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry> para obter maiores informações.</para>
	</callout>

	<callout arearefs="domain-name-servers">
	  <para>Esta opção especifica uma lista separada por vírgula de servidores <acronym>DNS</acronym> que o cliente deve usar. Eles podem ser listados por seus nomes de domínio totalmente qualificados (<acronym>FQDN</acronym>), como visto no exemplo, ou por seus endereços de <acronym>IP</acronym>.</para>
	</callout>

	<callout arearefs="subnet-mask">
	  <para>A máscara de sub-rede que será fornecida aos clientes.</para>
	</callout>

	<callout arearefs="default-lease-time">
	  <para>O tempo de expiração da concessão padrão em segundos. Um cliente pode ser configurado para substituir esse valor.</para>
	</callout>

	<callout arearefs="max-lease-time">
	  <para>O período máximo permitido de tempo, em segundos, para uma concessão. Se um cliente solicitar uma concessão mais longa, uma concessão ainda será emitida, mas será válida apenas para o tempo especificado em <literal>max-lease-time</literal>.</para>
	</callout>

	<callout arearefs="ddns-update-style">
	  <para>O padrão <option>none</option> desabilita as atualizações de DNS dinâmicas. Alterar isso para <option>interim</option> configura o servidor <acronym>DHCP</acronym> para atualizar um servidor <acronym>DNS</acronym> sempre que for concedido um contrato para que o servidor de <acronym>DNS</acronym> saiba quais endereços de <acronym>IP</acronym> estão associados a quais computadores na rede. Não altere a configuração padrão, a menos que o servidor de <acronym>DNS</acronym> tenha sido configurado para suportar <acronym>DNS</acronym> dinâmico.</para>
	</callout>

	<callout arearefs="range">
	  <para>Esta linha cria um conjunto de endereços <acronym>IP</acronym> disponíveis que são reservados para alocação a clientes <acronym>DHCP</acronym>. O intervalo de endereços deve ser válido para a rede ou sub-rede especificada na linha anterior.</para>
	</callout>

	<callout arearefs="routers">
	  <para>Declara o gateway padrão que é válido para a rede ou sub-rede especificada antes do colchete de abertura <literal>{</literal>.</para>
	</callout>

	<callout arearefs="hardware">
	  <para>Especifica o endereço de hardware <acronym>MAC</acronym> de um cliente para que o servidor <acronym>DHCP</acronym> possa reconhecer o cliente quando ele fizer uma solicitação.</para>
	</callout>

	<callout arearefs="fixed-address">
	  <para>Especifica que este host deve sempre receber o mesmo endereço <acronym>IP</acronym>. A utilização do nome do host está correta, pois o servidor <acronym>DHCP</acronym> resolverá o nome do host antes de retornar as informações de concessão.</para>
	</callout>
      </calloutlist>

      <para>Este arquivo de configuração suporta muito mais opções. Consulte o <citerefentry><refentrytitle>dhcpd.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>, instalado com o servidor, para obter detalhes e exemplos.</para>

      <para>Uma vez que a configuração do <filename>dhcpd.conf</filename> estiver completa, habilite o servidor <acronym>DHCP</acronym> em <filename>/etc/rc.conf</filename>:</para>

      <programlisting>dhcpd_enable="YES"
dhcpd_ifaces="dc0"</programlisting>

      <para>Substitua o <literal>dc0</literal> pela interface (ou interfaces, separadas por espaço em branco) que o servidor <acronym>DHCP</acronym> deverá escutar por solicitações de clientes <acronym>DHCP</acronym>.</para>

      <para>Inicie o servidor executando o seguinte comando:</para>

      <screen><prompt>#</prompt> <userinput>service isc-dhcpd start</userinput></screen>

      <para>Quaisquer mudanças futuras na configuração do servidor exigirão que o serviço <application>dhcpd</application> seja interrompido e, em seguida, iniciado usando <citerefentry><refentrytitle>service</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>

      <para>O servidor <acronym>DHCP</acronym> usa os seguintes arquivos. Observe que as páginas de manual são instaladas com o software do servidor.</para>

      <indexterm><primary><acronym>DHCP</acronym></primary> <secondary>configuration files</secondary></indexterm>
      <itemizedlist>
	<listitem>
	  <para><filename>/usr/local/sbin/dhcpd</filename></para>

	  <para>Maiores informações sobre o servidor <application>dhcpd</application> podem ser encontradas em <citerefentry><refentrytitle>dhcpd</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
	</listitem>

	<listitem>
	  <para><filename>/usr/local/etc/dhcpd.conf</filename></para>

	  <para>O arquivo de configuração do servidor precisa conter todas as informações que devem ser fornecidas aos clientes, juntamente com informações sobre a operação do servidor. Este arquivo de configuração é descrito no <citerefentry><refentrytitle>dhcpd.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>
	</listitem>

	<listitem>
	  <para><filename>/var/db/dhcpd.leases</filename></para>

	  <para>O servidor <acronym>DHCP</acronym> mantém um banco de dados das concessões que ele emitiu neste arquivo, que é gravado como um log. Consulte <citerefentry><refentrytitle>dhcpd.leases</refentrytitle><manvolnum>5</manvolnum></citerefentry>, o qual fornece uma descrição um pouco mais longa.</para>
	</listitem>

	<listitem>
	  <para><filename>/usr/local/sbin/dhcrelay</filename></para>

	  <para>Esse daemon é usado em ambientes avançados, onde um servidor <acronym>DHCP</acronym> encaminha uma solicitação de um cliente para outro servidor <acronym>DHCP</acronym> em uma rede separada. Se esta funcionalidade for necessária, instale o pacote ou port <package>net/isc-dhcp43-relay</package>. A instalação inclui o <citerefentry><refentrytitle>dhcrelay</refentrytitle><manvolnum>8</manvolnum></citerefentry>, que fornece maiores detalhes.</para>
	</listitem>
      </itemizedlist>
    </sect2>
  </sect1>

  <sect1 xml:id="network-dns">
    <!--
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Chern</firstname>
	  <surname>Lee</surname>
	  <contrib>Contributed by </contrib>
	</author>

	<author>
	  <firstname>Tom</firstname>
	  <surname>Rhodes</surname>
	</author>

	<author>
	  <firstname>Daniel</firstname>
	  <surname>Gerzo</surname>
	</author>
      </authorgroup>
    </sect1info>
    -->
    <title>Sistema de Nomes de Domínio (<acronym>DNS</acronym>)</title>

    <indexterm><primary>DNS</primary></indexterm>

    <para>O Sistema de Nomes de Domínio (<acronym>DNS</acronym>) é o protocolo através do qual os nomes de domínio são mapeados para endereços de <acronym>IP</acronym> e vice-versa. O <acronym>DNS</acronym> é coordenado pela Internet através de um sistema complexo de raiz de autoridade, Top Level Domain (<acronym>TLD</acronym>) e outros servidores de nomes de menor escala, que hospedam e armazenam em cache domínios individuais. Não é necessário executar um servidor de nomes para executar pesquisas de <acronym>DNS</acronym> em um sistema.</para>

    <indexterm><primary>resolver</primary></indexterm>
    <indexterm><primary>reverse <acronym>DNS</acronym></primary></indexterm>
    <indexterm><primary>root zone</primary></indexterm>

    <para>A tabela a seguir descreve alguns dos termos associados ao <acronym>DNS</acronym>:</para>

    <table frame="none" pgwide="1">
      <title>Terminologia <acronym>DNS</acronym></title>

      <tgroup cols="2">
	<colspec colwidth="1*"/>
	<colspec colwidth="3*"/>

	<thead>
	  <row>
	    <entry>Termo</entry>
	    <entry>Definição</entry>
	  </row>
	</thead>

	<tbody>
	  <row>
	    <entry>Encaminhamento de <acronym>DNS</acronym></entry>
	    <entry>Mapeamento de nomes de hosts para endereços de <acronym>IP</acronym>.</entry>
	  </row>

	  <row>
	    <entry>Origem</entry>
	    <entry>Refere-se ao domínio coberto em um arquivo de zona específico.</entry>
	  </row>

	  <row>
	    <entry>Resolver</entry>
	    <entry>Um processo do sistema através do qual uma máquina consulta um servidor de nomes para informações de zona.</entry>
	  </row>

	  <row>
	    <entry><acronym>DNS</acronym> Reverso</entry>
	    <entry>Mapeamento de endereços <acronym>IP</acronym> para hostnames.</entry>
	  </row>

	  <row>
	    <entry>Root zone</entry>

	    <entry>O início da hierarquia da zona da Internet. Todas as zonas se enquadram na zona de raiz, semelhante a como todos os arquivos em um sistema de arquivos se enquadram no diretório raiz.</entry>
	  </row>

	  <row>
	    <entry>Zona</entry>
	    <entry>Um domínio individual, subdomínio ou parte do <acronym>DNS</acronym> administrado pela mesma autoridade.</entry>
	  </row>
	</tbody>
      </tgroup>
    </table>

    <indexterm><primary>zones</primary> <secondary>examples</secondary></indexterm>

    <para>Exemplos de zonas:</para>

    <itemizedlist>
      <listitem>
	<para><systemitem>.</systemitem> é como a zona root é geralmente referida na documentação.</para>
      </listitem>

      <listitem>
	<para><systemitem>org.</systemitem> é um domínio de nível superior (<acronym>TLD</acronym>) sob a zona raiz.</para>
      </listitem>

      <listitem>
	<para><systemitem class="fqdomainname">example.org.</systemitem> é uma zona sob o <acronym>TLD</acronym> <systemitem>org.</systemitem>.</para>
      </listitem>

      <listitem>
	<para><systemitem>1.168.192.in-addr.arpa</systemitem> é uma zona que faz referência a todos os endereços <acronym>IP</acronym> que se enquadram no espaço de endereçamento <acronym>IP</acronym> <systemitem class="ipaddress">192.168.1.*</systemitem> .</para>
      </listitem>
    </itemizedlist>

    <para>Como se pode ver, a parte mais específica de um nome de host aparece à esquerda. Por exemplo, <systemitem class="fqdomainname">example.org.</systemitem> é mais específico que <systemitem>org.</systemitem>, como <systemitem>org.</systemitem> é mais específico que a zona raiz . O layout de cada parte de um nome de host é muito parecido com um sistema de arquivos: o diretório <filename>/dev</filename> está dentro da raiz e assim por diante.</para>

    <sect2>
      <title>Razões para executar um servidor de nomes</title>

      <para>Os servidores de nomes geralmente vêm em duas formas: servidores de nomes autoritativos e servidores de nomes de armazenamento em cache (também conhecidos como servidores de resolução).</para>

      <para>Um servidor de nomes autoritativo é necessário quando:</para>

      <itemizedlist>
	<listitem>
	  <para>Alguém quer servir ao mundo informações de <acronym>DNS</acronym>, respondendo autoritariamente a consultas.</para>
	</listitem>

	<listitem>
	  <para>Um domínio, como <systemitem class="fqdomainname">example.org</systemitem>, está registrado e os endereços <acronym>IP</acronym> precisam ser atribuídos a nomes de host sob ele.</para>
	</listitem>

	<listitem>
	  <para>Um bloco de endereços <acronym>IP</acronym> requer entradas reversas de <acronym>DNS</acronym> (<acronym>IP</acronym> para hostname).</para>
	</listitem>

	<listitem>
	  <para>Um servidor de nomes de backup ou secundário, chamado de escravo, responderá às consultas.</para>
	</listitem>
      </itemizedlist>

      <para>Um servidor de nomes em cache é necessário quando:</para>

      <itemizedlist>
	<listitem>
	  <para>Um servidor <acronym>DNS</acronym> local pode armazenar em cache e responder mais rapidamente do que consultar um servidor de nomes externo.</para>
	</listitem>
      </itemizedlist>

      <para>Quando alguém pergunta por <systemitem class="fqdomainname">www.FreeBSD.org</systemitem>, o resolvedor geralmente consulta o servidor de nomes do <acronym>ISP</acronym> e recupera a resposta. Com um servidor local, de cache <acronym>DNS</acronym>, a consulta só precisa ser feita uma vez para o mundo externo pelo servidor de Cache <acronym>DNS</acronym>. Consultas adicionais não precisarão sair da rede local, pois as informações estão armazenadas em um cache local.</para>
    </sect2>

    <sect2>
      <title>Configuração do servidor de <acronym>DNS</acronym></title>

      <para>O <application>Unbound</application> é fornecido no sistema básico do FreeBSD. Por padrão, ele fornecerá a resolução de <acronym>DNS</acronym> apenas para a máquina local. Embora o pacote básico do sistema possa ser configurado para fornecer serviços de resolução além da máquina local, é recomendável que esses requisitos sejam resolvidos instalando o <application>Unbound</application> da coleção de ports do FreeBSD.</para>

      <para>Para ativar o <application>Unbound</application>, adicione o seguinte ao <filename>/etc/rc.conf</filename>:</para>

      <programlisting>local_unbound_enable="YES"</programlisting>

      <para>Quaisquer servidores de nomes existentes em <filename>/etc/resolv.conf</filename> serão configurados como forwarders na nova configuração do <application>Unbound</application>.</para>

      <note>
	<para>Se algum dos servidores de nomes listados não suportar o <acronym>DNSSEC</acronym>, a resolução local <acronym>DNS</acronym> falhará. Certifique-se de testar cada servidor de nomes e remover qualquer um que falhe no teste. O seguinte comando mostrará a árvore de confiança ou uma falha para um servidor de nomes em execução em <systemitem class="ipaddress">192.168.1.1</systemitem>:</para>
      </note>

      <screen><prompt>%</prompt> <userinput>drill -S FreeBSD.org @<replaceable>192.168.1.1</replaceable></userinput></screen>

      <para>Quando cada servidor de nomes for confirmado para suportar <acronym>DNSSEC</acronym>, inicie o <application>Unbound</application>:</para>

      <screen><prompt>#</prompt> <userinput>service local_unbound onestart</userinput></screen>

      <para>Isso cuidará da atualização do arquivo <filename>/etc/resolv.conf</filename> para que as consultas para domínios seguros <acronym>DNSSEC</acronym> funcionem agora. Por exemplo, execute o seguinte <acronym>DNSSEC</acronym> para validar a árvore confiável do FreeBSD.org :</para>

      <screen><prompt>%</prompt> <userinput>drill -S FreeBSD.org</userinput>
;; Number of trusted keys: 1
;; Chasing: freebsd.org. A

DNSSEC Trust tree:
freebsd.org. (A)
|---freebsd.org. (DNSKEY keytag: 36786 alg: 8 flags: 256)
    |---freebsd.org. (DNSKEY keytag: 32659 alg: 8 flags: 257)
    |---freebsd.org. (DS keytag: 32659 digest type: 2)
        |---org. (DNSKEY keytag: 49587 alg: 7 flags: 256)
            |---org. (DNSKEY keytag: 9795 alg: 7 flags: 257)
            |---org. (DNSKEY keytag: 21366 alg: 7 flags: 257)
            |---org. (DS keytag: 21366 digest type: 1)
            |   |---. (DNSKEY keytag: 40926 alg: 8 flags: 256)
            |       |---. (DNSKEY keytag: 19036 alg: 8 flags: 257)
            |---org. (DS keytag: 21366 digest type: 2)
                |---. (DNSKEY keytag: 40926 alg: 8 flags: 256)
                    |---. (DNSKEY keytag: 19036 alg: 8 flags: 257)
;; Chase successful</screen>
    </sect2>
  </sect1>

  <sect1 xml:id="network-apache">
    <info>
      <title>Servidor HTTP Apache</title>

      <authorgroup>
	<author><personname> <firstname>Murray</firstname> <surname>Stokely</surname> </personname> <contrib>Contribuido por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>web servers</primary> <secondary>setting up</secondary></indexterm>
    <indexterm><primary>Apache</primary></indexterm>

    <para>O open source <application>Apache HTTP Server</application> é o servidor Web mais utilizado. O FreeBSD não instala este servidor web por padrão, mas ele pode ser instalado a partir do pacote ou Port <package>www/apache24</package>.</para>

    <para>Esta seção resume como configurar e iniciar a versão 2.<replaceable>x</replaceable> do <application>Servidor HTTP Apache</application> no FreeBSD. Para informações mais detalhadas sobre o <application>Apache</application>2.X e suas diretivas de configuração, consulte <link xlink:href="http://httpd.apache.org/">httpd.apache.org</link>.</para>

    <sect2>
      <title>Configurando e Iniciando o Apache</title>

      <indexterm><primary>Apache</primary> <secondary>configuration file</secondary></indexterm>

      <para>No FreeBSD, o arquivo de configuração principal do <application>Apache HTTP Server</application> é instalado como <filename>/usr/local/etc/apache2<replaceable>x</replaceable>/httpd.conf</filename>, onde <replaceable>x</replaceable> representa o número da versão. Este arquivo <acronym>ASCII</acronym> de texto inicia as linhas de comentário com um <literal>#</literal>. As diretivas modificadas com mais freqüência são:</para>

      <variablelist>
	<varlistentry>
	  <term><literal>ServerRoot "/usr/local"</literal></term>

	  <listitem>
	    <para>Especifica a hierarquia de diretório padrão para a instalação do <application>Apache</application>. Os binários são armazenados nos subdiretórios <filename>bin</filename> e <filename>sbin</filename> da raiz do servidor e os arquivos de configuração são armazenados no subdiretório <filename>etc/apache2<replaceable>x</replaceable></filename>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><literal>ServerAdmin you@example.com</literal></term>

	  <listitem>
	    <para>Altere isso para seu endereço de e-mail para receber problemas com o servidor. Esse endereço também aparece em algumas páginas geradas pelo servidor, como documentos de erro.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><literal>ServerName www.example.com:80</literal></term>

	  <listitem>
	    <para>Permite que um administrador defina um nome de host que é enviado de volta aos clientes pelo servidor. Por exemplo, <systemitem>www</systemitem> pode ser usado em vez do nome do host real. Se o sistema não tiver um nome registrado no <acronym>DNS</acronym>, insira seu endereço <acronym>IP</acronym>. Se o servidor irá escutar em um relatório alternativo, altere a porta <literal>80</literal> para o número de porta alternativa.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><literal>DocumentRoot "/usr/local/www/apache2<replaceable>x</replaceable>/data"</literal></term>

	  <listitem>
	    <para>O diretório no qual os documentos serão exibidos. Por padrão, todas as solicitações são obtidas desse diretório, mas os links e aliases simbólicos podem ser usados para apontar para outros locais.</para>
	  </listitem>
	</varlistentry>
      </variablelist>

      <para>É sempre uma boa ideia fazer uma cópia de backup do arquivo de configuração do <application>Apache</application> padrão antes de fazer alterações. Quando a configuração do <application>Apache</application> estiver concluída, salve o arquivo e verifique a configuração usando o <command>apachectl</command>. A execução do <command>apachectl configtest</command> deve retornar <literal>Syntax OK</literal>.</para>

      <indexterm><primary>Apache</primary> <secondary>starting or stopping</secondary></indexterm>

      <para>Para iniciar o <application>Apache</application> na inicialização do sistema, adicione a seguinte linha ao <filename>/etc/rc.conf</filename>:</para>

      <programlisting>apache<replaceable>24</replaceable>_enable="YES"</programlisting>

      <para>Se o <application>Apache</application> deve ser iniciado com opções não-padrão, a seguinte linha pode ser adicionada ao <filename>/etc/rc.conf</filename> para especificar os flags necessários:</para>

      <programlisting>apache<replaceable>24</replaceable>_flags=""</programlisting>

      <para>Se o <application>apachectl</application> não relatar erros de configuração, inicie o <command>httpd</command> agora:</para>

      <screen><prompt>#</prompt> <userinput>service apache<replaceable>24</replaceable> start</userinput></screen>

      <para>O serviço <command>httpd</command> pode ser testado inserindo <literal>http://<replaceable>localhost</replaceable></literal> em um navegador da Web, substituindo <replaceable>localhost</replaceable> pelo nome de domínio totalmente qualificado da máquina que está executando o <command>httpd</command>. A página padrão da Web exibida é <filename>/usr/local/www/apache<replaceable>24</replaceable>/data/index.html</filename>.</para>

      <para>A configuração do <application>Apache</application> pode ser testada quanto a erros depois de fazer alterações subsequentes de configuração enquanto o <command>httpd</command> está em execução usando o seguinte comando:</para>

      <screen><prompt>#</prompt> <userinput>service apache<replaceable>24</replaceable> configtest</userinput></screen>

      <note>
	<para>É importante notar que o <literal>configtest</literal> não é um padrão <citerefentry><refentrytitle>rc</refentrytitle><manvolnum>8</manvolnum></citerefentry> e não se espera que funcione para todos os scripts de inicialização.</para>
      </note>
    </sect2>

    <sect2>
      <title>Hospedagem Virtual</title>

      <para>A hospedagem virtual permite que vários sites sejam executados em um servidor <application>Apache</application>. Os hosts virtuais podem ser <firstterm>baseados em IP</firstterm> ou <firstterm>baseados em nome</firstterm>. A hospedagem virtual baseada em <acronym>IP</acronym> usa um endereço <acronym>IP</acronym> diferente para cada site. A hospedagem virtual baseada em nome usa os cabeçalhos HTTP/1.1 do cliente para descobrir o nome do host, o que permite que os sites compartilhem o mesmo endereço de <acronym>IP</acronym>.</para>

      <para>Para configurar o <application>Apache</application> para usar hospedagem virtual baseada em nome, adicione um bloco <literal>VirtualHost</literal> para cada site. Por exemplo, para o servidor Web denominado <systemitem class="fqdomainname">www.domain.tld</systemitem> com um domínio virtual de <systemitem class="fqdomainname">www.someotherdomain.tld</systemitem>, adicione as seguintes entradas ao arquivo <filename>httpd.conf</filename>:</para>

      <programlisting>&lt;VirtualHost *&gt;
    ServerName <replaceable>www.domain.tld</replaceable>
    DocumentRoot <replaceable>/www/domain.tld</replaceable>
&lt;/VirtualHost&gt;

&lt;VirtualHost *&gt;
    ServerName <replaceable>www.someotherdomain.tld</replaceable>
    DocumentRoot <replaceable>/www/someotherdomain.tld</replaceable>
&lt;/VirtualHost&gt;</programlisting>

      <para>Para cada host virtual, substitua os valores de <literal>ServerName</literal> e <literal>DocumentRoot</literal> pelos valores a serem usados.</para>

      <para>Para obter mais informações sobre como configurar hosts virtuais, consulte a documentação oficial do <application>Apache</application> em: <uri xlink:href="http://httpd.apache.org/docs/vhosts/">http://httpd.apache.org/docs/vhosts/</uri>.</para>
    </sect2>

    <sect2>
      <title>Módulos Apache</title>

      <indexterm><primary>Apache</primary> <secondary>modules</secondary></indexterm>

      <para>O <application>Apache</application> usa módulos para aumentar a funcionalidade fornecida pelo servidor básico. Consulte o <uri xlink:href="http://httpd.apache.org/docs/current/mod/">http://httpd.apache.org/docs/current/mod/</uri> para uma lista completa e detalhes de configuração para os módulos disponíveis.</para>

      <para>No FreeBSD, alguns módulos podem ser compilados com o port <package>www/apache24</package>. Digite <command>make config</command> dentro do diretório <filename>/usr/ports/www/apache24</filename> para ver quais módulos estão disponíveis e quais estão ativados por padrão. Se o módulo não é compilado com o port, a Coleção de Ports do FreeBSD fornece uma maneira fácil de instalar vários módulos. Esta seção descreve três dos módulos mais usados.</para>

      <sect3>
	<title>Suporte SSL</title>

	<indexterm><primary>web servers</primary> <secondary>secure</secondary></indexterm>
	<indexterm><primary>SSL</primary></indexterm>
	<indexterm><primary>cryptography</primary></indexterm>

	<para>Em algum momento, o suporte para o <acronym>SSL</acronym> dentro do Apache requer um modulo secundário chamado <filename>mod_ssl</filename>. Esse não é mais o casoe a instalação padrão do Apache vem com <acronym>SSL</acronym> embutido no servidor web. Um exemplo de como habilitar o suporte para paginas com <acronym>SSL</acronym> está disponível no arquivo <filename>http-ssl.conf</filename> instalado dentro do diretório <filename role="directory">/usr/local/etc/apache24/extra</filename>. Dentro desse diretório também esta um exemplo do arquivo chamado <filename>ssl.conf-sample</filename>. É recomendado que ambos arquivos sejam avaliados para configurar apropriadamente páginas seguras no servidor web Apache.</para>

	<para>Depois da configuração do <acronym>SSL</acronym> estiver completa, deve ser removido o comentário da linha seguinte no arquivo <filename>http.conf</filename> principal para ativar as mudanças no próximo restart ou reload do Apache:</para>

	<programlisting>#Include etc/apache24/extra/httpd-ssl.conf</programlisting>

	<warning>
	  <para>Versão dois do <acronym>SSL</acronym> e a versão três tem problemas de vulnerabilidades conhecidas. É altamente recomendado a versão 1.2 do TLS e 1.3 deve ser habilitada no lugar das velhas opções do SSL. Isso pode ser realizado configurando as seguintes opções no arquivo <filename>ssl.conf</filename>:</para>
	</warning>

	<programlisting>SSLProtocol all -SSLv3 -SSLv2 +TLSv1.2 +TLSv1.3
SSLProxyProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1</programlisting>

	<para>Para completar a configuração do <acronym>SSL</acronym> no servidor web, remova os comentários da seguinte linha para garantir que a configuração irá ser enviada para dentro do Apache durante o restart ou reload:</para>

	<programlisting># Secure (SSL/TLS) connections
Include etc/apache24/extra/httpd-ssl.conf</programlisting>

	<para>As linhas a seguir também devem ser descomentadas no <filename>httpd.conf</filename> para suportar totalmente o <acronym>SSL</acronym> no Apache:</para>

	<programlisting>LoadModule authn_socache_module libexec/apache24/mod_authn_socache.so
LoadModule socache_shmcb_module libexec/apache24/mod_socache_shmcb.so
LoadModule ssl_module libexec/apache24/mod_ssl.so</programlisting>

	<para>O próximo passo é trabalhar com uma autoridade certificadora para ter certificados apropriados instalados no sistema. Isso vai configurar um cadeia de confiança para a pagina e prever alguns avisos de certificados auto assinados.</para>

      </sect3>

      <sect3>
	<title><filename>mod_perl</filename></title>

	<indexterm><primary>mod_perl</primary> <secondary>Perl</secondary></indexterm>

	<para>O módulo <filename>mod_perl</filename> torna possível escrever módulos <application>Apache</application> em <application>Perl</application>. Além disso, o intérprete persistente embutido no servidor evita a sobrecarga de iniciar um intérprete externo e a penalidade do tempo de inicialização do <application>Perl</application>.</para>

	<para>O <filename>mod_perl</filename> pode ser instalado usando o pacote ou port <package>www/mod_perl2</package>. A documentação para usar este módulo pode ser encontrada em <uri xlink:href="http://perl.apache.org/docs/2.0/index.html">http://perl.apache.org/docs/2.0/index .html</uri>.</para>
      </sect3>

      <sect3>
	<info>
	  <title><filename>mod_php</filename></title>

	  <authorgroup>
	    <author><personname><firstname>Tom</firstname> <surname>Rhodes</surname></personname><contrib>Escrito por</contrib></author>
	  </authorgroup>
	</info>

	<indexterm><primary>mod_php</primary> <secondary>PHP</secondary></indexterm>

	<para><firstterm>PHP: Pré-processador de hipertexto</firstterm> (<acronym> PHP </acronym>) é uma linguagem de script de propósito geral que é especialmente adequada para desenvolvimento web. Capaz de ser incorporada em <acronym>HTML</acronym>, sua sintaxe se baseia em <application>C</application>, <trademark>Java</trademark> e <application>Perl</application> com a intenção de permitir desenvolvedores web para escrever rapidamente páginas da web geradas dinamicamente.</para>

	<para>Suporte para <acronym>PHP</acronym> para o <application>Apache</application> e alguma outra parte escrita na linguagem, pode ser adicionada instalando o port apropriado.</para>

	<para>Para todas versões suportadas, procure os dados do pacote usando o comando <command>pkg</command>:</para>

	<screen><prompt>#</prompt> <userinput>pkg search php</userinput></screen>

	<para>Uma lista vai ser disponibilizada incluindo as versões e partes adicionais que elas proverem. Os componentes são completamente modulares, significando que as partes especificas são habilitadas instalando o port apropriado. Para instalar o <acronym>PHP</acronym> na versão 7.4 para o Apache, use o seguinte comando:</para>

	<screen><prompt>#</prompt> <userinput>pkg install mod_php74</userinput></screen>

	<para>Se algum pacote dependente precisar ser instalado, ele irá ser instalado também.</para>

	<para>Por padrão, o <acronym>PHP</acronym> não estará habilitado. As seguintes linhas precisam ser adicionadas no arquivo de configuração do Apache localizado em <filename role="directory">/usr/local/etc/apache24</filename> para ativa-lo:</para>

	<programlisting>&lt;FilesMatch "\.php$"&gt;
    SetHandler application/x-httpd-php
&lt;/FilesMatch&gt;
&lt;FilesMatch "\.phps$"&gt;
    SetHandler application/x-httpd-php-source
&lt;/FilesMatch&gt;</programlisting>

	<para>Em adição, a opção <option>DirectoryIndex</option> no arquivo de configuração irá precisar ser atualizada também e o Apache irá precisar ser reiniciado ou feito um relaoad também para as mudanças surtirem efeito.</para>

	<para>Suporte para muitas partes do <acronym>PHP</acronym> podem ser instalado também usando o comando <command>pkg</command>. Por exemplo, para instalar suporte para o <acronym>XML</acronym> ou para <acronym>SSL</acronym>, instale os seguintes ports:</para>

	<screen><prompt>#</prompt> <userinput>pkg install php74-xml php74-openssl</userinput></screen>

	<para>Como antes, a configuração do Apache irá precisar ser recarregada para as mudanças surtirem efeito, mesmo em casos onde foi feita apenas a instalação de um modulo.</para>

	<para>Para realizar uma reinicialização normal para recarregar a configuração, digite o seguinte comando:</para>

	<screen><prompt>#</prompt> <userinput>apachectl graceful</userinput></screen>

	<para>Uma vez que a instalação esteja completa, há dois métodos para obter o suporte para os modulos do <acronym>PHP</acronym> e a informação do ambiente dessa instalação. A primeira é instalar o binário completo do <acronym>PHP</acronym> e rodar o seguinte comando para obter a informação:</para>

	<screen><prompt>#</prompt> <userinput>pkg install php74</userinput></screen>
	<screen><prompt>#</prompt> <userinput>php -i |less</userinput></screen>

	<para>Isso é necessário para passar a saída paga um paginador, como o comando <command>more</command> ou <command>less</command> para visualizar melhor a saída.</para>

	<para>Finalmente, para fazer alguma mudança na configuração global do <acronym>PHP</acronym> há um arquivo bem documentado instalado dentro de <filename role="directory">/usr/local/etc/php.ini</filename>. No momento da instalação, esse arquivo não irá existir porque há duas versões para escolher, uma é o arquivo <filename>php.ini-development</filename> e outra o <filename>php.ini-production</filename>. Esses são pontos iniciais para ajudar os administradores na implementação.</para>
      </sect3>

      <sect3>
	<info>
	  <title>Suporte a HTTP2</title>
	</info>

	<para>Suporte do <application>Apache</application> para o protocolo <acronym>HTTP</acronym> está incluido por padrão quando instala o port com o comando <command>pkg</command>. A nova versão do <acronym>HTTP</acronym> inclui muitas melhorias em relação a versão anterior, incluindo utilizar uma conexão singular para uma página, reduzindo as idas e vindas de conexões <acronym>TCP</acronym>. Também, os dados no cabeçalho do pacote é comprimido e o <acronym>HTTP</acronym>2 requer encriptação por padrão.</para>

	<para>Quando o <application>Apache</application> estiver configurado para usar <acronym>HTTP</acronym>2 apenas, os navegadores web irão requisitar conexões seguras, encriptadas com <acronym>HTTPS</acronym>. Quando o <application>Apache</application> estiver configurado para usar ambas versões, o <acronym>HTTP</acronym>1.1 irá ser considerado uma opção substituta se algum problema surgir durante a conexão.</para>

	<para>Embora essa mudança exija que os administradores façam alterações, elas são positivas e equivalem a uma Internet mais segura para todos. As mudanças são requeridas apenas para paginas não implementada corretamente com <acronym>SSL</acronym> e <acronym>TLS</acronym>.</para>

	<note>
	  <para>Essa configuração depende das seções anteriores, incluindo suporte a <acronym>TLS</acronym>. É recomendado que essas instruções seja seguidas antes de continuar com essa configuração.</para>
	</note>

	<para>Comece o processo habilitando o modulo <acronym>http</acronym>2 removendo o comentário da linha no arquivo <filename>/usr/local/etc/apache24/httpd.conf</filename> e trocando o modulo mpm_prefork pelo mpm_event pois o anterior não suporta o <acronym>http</acronym>2.</para>

	<programlisting>LoadModule http2_module libexec/apache24/mod_http2.so
LoadModule mpm_event_module libexec/apache24/mod_mpm_event.so</programlisting>

	<note>
	  <para>Aqui há um port <filename role="port">mod_http1</filename> distinto que está disponível. Ele existe pra entregar segurança e correção de bugs mais rápido que o modulo instalado por padrão com o port <filename role="port">apache24</filename>. Ele não é requisitado para o suporte do <acronym>HTTP</acronym>2 mas está disponível. Quando instalado, o <filename>mod_h2.so</filename> deve ser usado no lugar do <filename>mod_http2.so</filename> na configuração do <application>Apache</application>.</para>
	</note>

	<para>Aqui há dois métodos para implementar o <acronym>HTTP</acronym>2 no <application>Apache</application>; um caminho é de forma global para todos os sites e cada VirtualHost rodando no sistema. Para habilitar o <acronym>HTTP</acronym>2 globalmente, adicione a seguinte linha abaixo da diretiva ServerName:</para>

	<programlisting>Protocolos h2 http/1.1</programlisting>

	<note>
	  <para>Para habilitar <acronym>HTTP</acronym>2 sobre texto simples, use <acronym>h2</acronym><acronym>h2c</acronym><acronym>http</acronym>/1.1 no arquivo <filename>httpd.conf</filename>.</para>
	</note>

	<para>Tendo o <acronym>h2c</acronym> aqui irá permitir que o dado em texto simples do <acronym>HTTP</acronym>2 passar pelo sistema mas isso não é recomendado. Em adição a isso, usando o <acronym>http</acronym>/1.1 aqui irá permitir retornar para a versão do protocolo <acronym>HTTP</acronym>1.1 caso sejá necessário pelo sistema.</para>

	<para>Para habilitar <acronym>HTTP</acronym>2 para VirtualHosts individuais, adicione a mesma linha com a diretiva VirtualHost no arquivo <filename>httpd.conf</filename> ou <filename>httpd-ssl.conf</filename>.</para>

	<para>Recarregue a configuração usando o comando <command>apachectl</command><parameter>reload</parameter> e teste a configuração seguindo um dos métodos após visitar uma das paginas hosteadas:</para>

	<screen><prompt>#</prompt> <userinput>grep "HTTP/2.0" /var/log/httpd-access.log</userinput></screen>

	<para>A saída deve ser semelhante à seguinte:</para>

	<programlisting>192.168.1.205 - - [18/Oct/2020:18:34:36 -0400] "GET / HTTP/2.0" 304 -
192.0.2.205 - - [18/Oct/2020:19:19:57 -0400] "GET / HTTP/2.0" 304 -
192.0.0.205 - - [18/Oct/2020:19:20:52 -0400] "GET / HTTP/2.0" 304 -
192.0.2.205 - - [18/Oct/2020:19:23:10 -0400] "GET / HTTP/2.0" 304 -</programlisting>

	<para>O outro metodo é usar o navegador web padrão no debugger do site ou o comando <command>tcpdump</command>; contanto, o uso de qualquer método está além do escopo desse documento.</para>

	<para>Suporte para conexões do proxy reverso <acronym>HTTP</acronym>2 usando o modulo <filename>mod_proxy_http2.so</filename>. Quando declarado na configuração o ProxyPass ou RewriteRules [P], eles devem usar h2:// para a conexão.</para>
      </sect3>


    </sect2>

    <sect2>
      <title>Websites Dinâmicos</title>

      <indexterm><primary>web servers</primary> <secondary>dynamic</secondary></indexterm>

      <para>Além do <application>mod_perl</application> e do <application>mod_php</application>, outras linguagens estão disponíveis para a criação de conteúdo dinâmico da web. Estes incluem o <application>Django</application> e o <application>Ruby on Rails</application>.</para>

      <sect3>
	<title>Django</title>

	<indexterm><primary>Python</primary></indexterm>
	<indexterm><primary>Django</primary></indexterm>

	<para>O <application>Django</application> é um framework de licença BSD projetado para permitir que desenvolvedores escrevam aplicações web elegantes e de alto desempenho rapidamente. Ele fornece um mapeador relacional de objeto para que os tipos de dados sejam desenvolvidos como objetos <application>Python</application>. Uma <acronym>API</acronym> rica e dinâmica de acesso ao banco de dados é fornecida para os objetos sem que o desenvolvedor tenha que escrever <acronym>SQL</acronym>. Ele também fornece um sistema de template extensível para que a lógica do aplicativo seja separada da apresentação <acronym>HTML</acronym>.</para>

	<para>Django depende de <filename>mod_python</filename>, e um mecanismo de banco de dados <acronym>SQL</acronym>. No FreeBSD, o port <package>www/py-django</package> instala automaticamente o <filename>mod_python</filename> e suporta os banco de dados <application>PostgreSQL</application>, <application>MySQL</application>, ou <application>SQLite</application>, com o padrão sendo o <application>SQLite</application>. Para trocar o mecanismo de banco de dados, digite <command>make config</command> dentro do diretório <filename>/usr/ports/www/py-django</filename>, então instale o port.</para>

	<para>Uma vez instalado o <application>Django</application>, a aplicação precisará de um diretório de projeto junto com a configuração <application>Apache</application> para usar o interpretador <application>Python</application> incorporado. Este intérprete é usado para chamar o aplicativo para <acronym>URL</acronym>s específicas no site.</para>

	<para>Para configurar o <application>Apache</application> para que passe a fazer solicitações para determinadas <acronym>URL</acronym>s para a aplicação Web, adicione o seguinte ao <filename>httpd.conf</filename>, especificando o caminho completo para o diretório do projeto:</para>

	<programlisting>&lt;Location "/"&gt;
    SetHandler python-program
    PythonPath "['<replaceable>/dir/to/the/django/packages/</replaceable>'] + sys.path"
    PythonHandler django.core.handlers.modpython
    SetEnv DJANGO_SETTINGS_MODULE mysite.settings
    PythonAutoReload On
    PythonDebug On
&lt;/Location&gt;</programlisting>

	<para>Consulte <uri xlink:href="https://docs.djangoproject.com">https://docs.djangoproject.com</uri> para maiores informações sobre como usar o <application>Django</application>.</para>
      </sect3>

      <sect3>
	<title>Ruby on Rails</title>

	<indexterm><primary>Ruby on Rails</primary></indexterm>

	<para>O <application>Ruby on Rails</application> é outro framework de software livre da Web que fornece uma stack de desenvolvimento completa. Ele é otimizado para tornar os desenvolvedores da Web mais produtivos e capazes de criar rapidamente aplicativos poderosos. No FreeBSD, ele pode ser instalado usando o pacote ou port <package>www/rubygem-rails</package>.</para>

	<para>Consulte <uri xlink:href="http://guides.rubyonrails.org">http://guides.rubyonrails.org</uri> para maiores informações sobre como usar o <application>Ruby on Rails</application> .</para>
      </sect3>
    </sect2>
  </sect1>

  <sect1 xml:id="network-ftp">
    <!--
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Murray</firstname>
	  <surname>Stokely</surname>
	  <contrib>Contributed by </contrib>
	</author>
      </authorgroup>
    </sect1info>
    -->
    <title>Protocolo de Transferência de Arquivos (<acronym>FTP</acronym>)</title>

    <indexterm><primary><acronym>FTP</acronym> servers</primary></indexterm>

    <para>O Protocolo de Transferência de Arquivos (<acronym>FTP</acronym>) fornece aos usuários uma maneira simples de transferir arquivos para um servidor <acronym>FTP</acronym>. O FreeBSD inclui o software do servidor <acronym>FTP</acronym>, <application>ftpd</application>, no sistema base.</para>

    <para>O FreeBSD fornece vários arquivos de configuração para controlar o acesso ao servidor <acronym>FTP</acronym>. Esta seção resume esses arquivos. Consulte <citerefentry><refentrytitle>ftpd</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter mais detalhes sobre o servidor <acronym>FTP</acronym> incorporado.</para>

    <sect2>
      <title>Configuração</title>

      <para>A etapa de configuração mais importante é decidir quais contas terão permissão para acessar o servidor <acronym>FTP</acronym>. Um sistema FreeBSD possui várias contas do sistema que não devem ter acesso ao <acronym>FTP</acronym>. A lista de usuários que não permitem acesso <acronym>FTP</acronym> pode ser encontrada em <filename>/etc/ftpusers</filename>. Por padrão, inclui contas do sistema. Usuários adicionais que não devem ter acesso a <acronym>FTP</acronym> podem ser adicionados.</para>

      <para>Em alguns casos, pode ser desejável restringir o acesso de alguns usuários sem impedi-los completamente de usar o <acronym>FTP</acronym>. Isso pode ser feito criando <filename>/etc/ftpchroot</filename> como descrito em <citerefentry><refentrytitle>ftpchroot</refentrytitle><manvolnum>5</manvolnum></citerefentry>. Este arquivo lista usuários e grupos sujeitos a restrições de acesso a <acronym>FTP</acronym>.</para>

      <indexterm><primary><acronym>FTP</acronym></primary> <secondary>anonymous</secondary></indexterm>

      <para>Para permitir acesso anônimo ao servidor <acronym>FTP</acronym>, crie um usuário chamado <systemitem class="username">ftp</systemitem> no sistema FreeBSD. Os usuários poderão então fazer logon no servidor <acronym>FTP</acronym> com um nome de usuário <systemitem class="username">ftp</systemitem> ou <systemitem class="username">anonymous</systemitem> . Quando for solicitada a senha, qualquer entrada será aceita, mas por convenção, um endereço de e-mail deverá ser usado como a senha. O servidor <acronym>FTP</acronym> chamará <citerefentry><refentrytitle>chroot</refentrytitle><manvolnum>2</manvolnum></citerefentry> quando um usuário anônimo efetuar login para restringir o acesso somente ao diretório home do usuário <systemitem class="username">ftp</systemitem>.</para>

      <para>Existem dois arquivos de texto que podem ser criados para especificar mensagens de boas-vindas a serem exibidas para clientes <acronym>FTP</acronym>. O conteúdo de <filename>/etc/ftpwelcome</filename> será exibido aos usuários antes que eles atinjam o prompt de login. Após um login bem sucedido, o conteúdo de <filename>/etc/ftpmotd</filename> será exibido. Observe que o caminho para esse arquivo é relativo ao ambiente de login, portanto, o conteúdo de <filename>~ftp/etc/ftpmotd</filename> seria exibido para usuários anônimos.</para>

      <para>Uma vez configurado o servidor <acronym>FTP</acronym>, defina a variável apropriada em <filename>/etc/rc.conf</filename> para iniciar o serviço durante a inicialização:</para>

      <programlisting>ftpd_enable="YES"</programlisting>

      <para>Para iniciar o serviço agora:</para>

      <screen><prompt>#</prompt> <userinput>service ftpd start</userinput></screen>

      <para>Teste a conexão com o servidor <acronym>FTP</acronym> digitando:</para>

      <screen><prompt>%</prompt> <userinput>ftp localhost</userinput></screen>

      <indexterm><primary>syslog</primary></indexterm>
      <indexterm><primary>log files</primary> <secondary><acronym>FTP</acronym></secondary></indexterm>

      <para>O daemon <application>ftpd</application> usa o <citerefentry> <refentrytitle>syslog</refentrytitle><manvolnum>3</manvolnum></citerefentry> para registrar mensagens. Por padrão, o daemon de log do sistema gravará mensagens relacionadas a <acronym>FTP</acronym> em <filename>/var/log/xferlog</filename>. A localização do log do <acronym>FTP</acronym> pode ser modificada alterando a seguinte linha no <filename>/etc/syslog.conf</filename>:</para>

      <programlisting>ftp.info      /var/log/xferlog</programlisting>

      <indexterm><primary><acronym>FTP</acronym></primary> <secondary>anonymous</secondary></indexterm>

      <note>
	<para>Esteja ciente dos possíveis problemas envolvidos na execução de um servidor <acronym>FTP</acronym> anônimo. Em particular, pense duas vezes antes de permitir que usuários anônimos façam upload de arquivos. Pode acontecer que o site <acronym>FTP</acronym> se torne um fórum para o comércio de software comercial não licenciado ou pior. Se uploads anônimos de <acronym>FTP</acronym> forem necessários, verifique as permissões para que esses arquivos não possam ser lidos por outros usuários anônimos até que sejam revisados por um administrador.</para>
      </note>
    </sect2>
  </sect1>

  <sect1 xml:id="network-samba">
    <!--
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Murray</firstname>
	  <surname>Stokely</surname>
	  <contrib>Contributed by </contrib>
	</author>
      </authorgroup>
    </sect1info>
    -->
    <title>Serviços de arquivos e impressão para clientes <trademark class="registered">Microsoft</trademark> <trademark class="registered">Windows</trademark> Clients (Samba)</title>

    <indexterm><primary>Samba server</primary></indexterm>
    <indexterm><primary>Microsoft Windows</primary></indexterm>
    <indexterm><primary>file server</primary> <secondary>Windows clients</secondary></indexterm>
    <indexterm><primary>print server</primary> <secondary>Windows clients</secondary></indexterm>

    <para><application>Samba</application> é um popular pacote de software de código aberto que fornece serviços de arquivo e impressão usando o protocolo <acronym>SMB/CIFS</acronym>. Este protocolo está incorporado nos sistemas <trademark class="registered">Microsoft</trademark> <trademark class="registered">Windows</trademark>. Ele pode ser adicionado a sistemas não <trademark class="registered">Microsoft</trademark> <trademark class="registered">Windows</trademark> instalando as bibliotecas-cliente <application>Samba</application>. O protocolo permite que os clientes acessem dados e impressoras compartilhadas. Esses compartilhamentos podem ser mapeados como uma unidade de disco local e as impressoras compartilhadas podem ser usadas como se fossem impressoras locais.</para>

    <para>No FreeBSD, as bibliotecas cliente do <application>Samba</application> podem ser instaladas usando o port ou pacote <package>net/samba410</package>. O cliente fornece a capacidade de um sistema FreeBSD acessar compartilhamentos de <acronym>SMB/CIFS</acronym> em uma rede <trademark class="registered">Microsoft</trademark> <trademark class="registered">Windows</trademark>.</para>

    <para>Um sistema FreeBSD também pode ser configurado para atuar como um servidor <application>Samba</application> instalando o port ou pacote <package>net/samba410</package>. Isso permite que o administrador crie compartilhamentos de <acronym>SMB</acronym>/<acronym>CIFS</acronym> no sistema FreeBSD que podem ser acessados por clientes executando <trademark class="registered">Microsoft</trademark> <trademark class="registered">Windows</trademark> ou as bibliotecas do cliente <application>Samba</application>.</para>

    <sect2>
      <title>Configuração do Servidor</title>

      <para>O <application>Samba</application> é configurado em <filename>/usr/local/etc/smb4.conf</filename>. Este arquivo deve ser criado antes que o <application>Samba</application> possa ser usado.</para>

      <para>Um simples <filename>smb4.conf</filename> para compartilhar diretórios e impressoras com clientes <trademark class="registered">Windows</trademark> em um grupo de trabalho é mostrado aqui. Para configurações mais complexas envolvendo LDAP ou Active Directory, é mais fácil usar o <citerefentry><refentrytitle>samba-tool</refentrytitle><manvolnum>8</manvolnum></citerefentry> para criar o <filename>smb4.conf</filename>.</para>

      <programlisting>[global]
workgroup = WORKGROUP
server string = Samba Server Version %v
netbios name = ExampleMachine
wins support = Yes
security = user
passdb backend = tdbsam

# Example: share /usr/src accessible only to 'developer' user
[src]
path = /usr/src
valid users = developer
writable  = yes
browsable = yes
read only = no
guest ok = no
public = no
create mask = 0666
directory mask = 0755</programlisting>

      <sect3>
	<title>Configurações Globais</title>

	<para>As configurações que descrevem a rede são adicionadas em <filename>/usr/local/etc/smb4.conf</filename>:</para>

	<variablelist>
	  <varlistentry>
	    <term><literal>workgroup</literal></term>

	    <listitem>
	      <para>O nome do grupo de trabalho a ser servido.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><literal>netbios name</literal></term>

	    <listitem>
	      <para>O nome NetBIOS pelo qual um servidor <application>Samba</application> é conhecido. Por padrão, é o mesmo que o primeiro componente do nome do <acronym>DNS</acronym> do host.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><literal>server string</literal></term>

	    <listitem>
	      <para>A string que será exibida na saída de <command>net view</command> e algumas outras ferramentas de rede que buscam exibir texto descritivo sobre o servidor.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><literal>wins support</literal></term>

	    <listitem>
	      <para>Se o <application>Samba</application> funcionará como um servidor <acronym>WINS</acronym>. Não habilite o suporte para <acronym>WINS</acronym> em mais de um servidor na rede.</para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </sect3>

      <sect3>
	<title>Configurações de Segurança</title>

	<para>As configurações mais importantes em <filename>/usr/local/etc/smb4.conf</filename> são o modelo de segurança e o formato de senha de backend. Essas diretivas controlam as opções:</para>

	<variablelist>
	  <varlistentry>
	    <term><literal>security</literal></term>

	    <listitem>
	      <para>As configurações mais comuns são <literal>security=share</literal> e <literal>security=user</literal>. Se os clientes usarem nomes de usuários que sejam os mesmos nomes de usuários na máquina do FreeBSD, a segurança no nível do usuário deve ser usada. Essa é a política de segurança padrão e exige que os clientes façam logon pela primeira vez antes de poderem acessar recursos compartilhados.</para>

	      <para>Na segurança em nível de compartilhamento, os clientes não precisam efetuar logon no servidor com um nome de usuário e senha válidos antes de tentar se conectar a um recurso compartilhado. Este era o modelo de segurança padrão para versões mais antigas do <application>Samba</application>.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><literal>passdb backend</literal></term>

	    <listitem>
	      <indexterm><primary>NIS+</primary></indexterm>
	      <indexterm><primary>LDAP</primary></indexterm>
	      <indexterm><primary>SQL database</primary></indexterm>

	      <para>O <application>Samba</application> possui vários modelos de autenticação de backend diferentes. Os clientes podem ser autenticados com LDAP, NIS+, um banco de dados SQL ou um arquivo de senha modificado. O método de autenticação recomendado, <literal>tdbsam</literal>, é ideal para redes simples e é abordado aqui. Para redes maiores ou mais complexas, o <literal>ldapsam</literal> é recomendado. <literal>smbpasswd</literal> foi o padrão anterior e agora está obsoleto.</para>
	    </listitem>
	  </varlistentry>
	</variablelist>

      </sect3>

      <sect3>
	<title>Usuários do <application>Samba</application></title>

	<para>As contas de usuário do FreeBSD devem ser mapeadas para o banco de dados <literal>SambaSAMAccount</literal> para que os clientes <trademark class="registered">Windows</trademark> acessem o compartilhamento. Mapear contas de usuários existentes do FreeBSD usando <citerefentry><refentrytitle>pdbedit</refentrytitle><manvolnum>8</manvolnum></citerefentry>:</para>

	<screen><prompt>#</prompt> <userinput>pdbedit -a <replaceable>username</replaceable></userinput></screen>

	<para>Esta seção mencionou apenas as configurações mais usadas. Consulte a <link xlink:href="https://wiki.samba.org">Wiki Oficial do Samba</link> para obter informações adicionais sobre as opções de configuração disponíveis.</para>
      </sect3>
    </sect2>

    <sect2>
      <title>Iniciando o <application>Samba</application></title>

      <para>Para habilitar o <application>Samba</application> no momento da inicialização, adicione a seguinte linha ao <filename>/etc/rc.conf</filename>:</para>

      <programlisting>samba_server_enable="YES"</programlisting>

      <para>Para iniciar o <application>Samba</application> agora:</para>

      <screen><prompt>#</prompt> <userinput>service samba_server start</userinput>
Performing sanity check on Samba configuration: OK
Starting nmbd.
Starting smbd.</screen>

      <para>O <application>Samba</application> consiste em três daemons separados. Os daemons <application>nmbd</application> e <application>smbd</application> são iniciados por <varname>samba_enable</varname>. Se resolução de nomes winbind também é necessária, defina:</para>

	<programlisting>winbindd_enable="YES"</programlisting>

      <para>O <application>Samba</application> pode ser interrompido a qualquer momento digitando:</para>

      <screen><prompt>#</prompt> <userinput>service samba_server stop</userinput></screen>

      <para>O <application>Samba</application> é um conjunto de software complexo com funcionalidade que permite ampla integração com as redes <trademark class="registered">Microsoft</trademark> <trademark class="registered">Windows</trademark>. Para mais informações sobre a funcionalidade além da configuração básica descrita aqui, consulte <uri xlink:href="https://www.samba.org">https://www.samba.org</uri>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="network-ntp">
    <!--
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Tom</firstname>
	  <surname>Hukins</surname>
	  <contrib>Contributed by </contrib>
	</author>
      </authorgroup>
    </sect1info>
    -->
    <title>Sincronização de Relógio com NTP</title>

    <indexterm><primary>NTP</primary> <secondary>ntpd</secondary></indexterm>

    <para>Com o tempo, o relógio de um computador está propenso a se desviar. Isso é problemático, pois muitos serviços de rede exigem que os computadores em uma rede compartilhem o mesmo tempo exato. Tempo preciso também é necessário para garantir que os registros de data e hora dos arquivos permaneçam consistentes. O protocolo de horário da rede (<acronym>NTP</acronym>) é uma maneira de fornecer precisão de relógio em uma rede.</para>

    <para>O FreeBSD inclui o <citerefentry><refentrytitle>ntpd</refentrytitle><manvolnum>8</manvolnum></citerefentry> o qual pode ser configurado para consultar outros servidores <acronym>NTP</acronym> para sincronizar o relógio nessa máquina ou para fornecer serviços de horário para outros computadores na rede.</para>

    <para>Esta seção descreve como configurar o <application>ntpd</application> no FreeBSD. Mais documentação pode ser encontrada em <filename>/usr/share/doc/ntp/</filename> no formato HTML.</para>

    <sect2>
      <title>Configuração de <acronym>NTP</acronym></title>

      <indexterm><primary>NTP</primary></indexterm>

      <para>No FreeBSD, o <application>ntpd</application> nativo pode ser usado para sincronizar o relógio do sistema. O <application> Ntpd </application> é configurado usando variáveis no <citerefentry><refentrytitle>rc.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry> e  no <filename>/etc/ntp.conf</filename>, conforme detalhado nas seções a seguir.</para>

      <para>O <application>Ntpd</application> se comunica com seus network peers usando pacotes UDP. Quaisquer firewalls entre sua máquina e seus NTP peers devem ser configurados para permitir a entrada e saída de pacotes UDP na porta 123.</para>

      <sect3>
	<title>O arquivo <filename>/etc/ntp.conf</filename></title>

	<indexterm><primary>NTP</primary> <secondary>ntp.conf</secondary></indexterm>

	<para>O <application>Ntpd</application> faz a leitura do <filename>/etc/ntp.conf</filename> para determinar quais servidores <acronym>NTP</acronym> que ele deve consultar. É recomendável escolher vários servidores <acronym>NTP</acronym>, caso um dos servidores se torne inacessível ou seu relógio torne-se não confiável. Como o <application>ntpd</application> recebe respostas, ele favorece servidores confiáveis em vez dos menos confiáveis. Os servidores consultados podem ser locais na rede, fornecidos por um <acronym>ISP</acronym> ou selecionados a partir de uma <link xlink:href="http://support.ntp.org/bin/view/Servers/WebHome"> lista online de servidores <acronym>NTP</acronym> publicamente acessíveis</link>. Ao escolher um servidor <acronym>NTP</acronym> público, selecione um servidor geograficamente próximo e revise sua política de uso. A palavra-chave <literal>pool</literal> de configuração seleciona um ou mais servidores de um pool de servidores. Está disponível uma <link xlink:href="http://support.ntp.org/bin/view/Servers/NTPPoolServers"> lista online de pools <acronym>NTP</acronym> publicamente acessíveis</link>, organizada por área geográfica. Além disso, o FreeBSD fornece um pool patrocinado pelo projeto, <literal>0.freebsd.pool.ntp.org</literal>.</para>

	<example>
	  <title>Exemplo de <filename>/etc/ntp.conf</filename></title>
	  <para>Este é um exemplo simples de um arquivo <filename>ntp.conf</filename>. Ele pode ser usado com segurança como está; ele contém as opções <literal>restrict</literal> recomendadas para operação em uma conexão de rede pública.</para>
	  <programlisting>
# Disallow ntpq control/query access.  Allow peers to be added only
# based on pool and server statements in this file.
restrict default limited kod nomodify notrap noquery nopeer
restrict source  limited kod nomodify notrap noquery

# Allow unrestricted access from localhost for queries and control.
restrict 127.0.0.1
restrict ::1

# Add a specific server.
server ntplocal.example.com iburst

# Add FreeBSD pool servers until 3-6 good servers are available.
tos minclock 3 maxclock 6
pool 0.freebsd.pool.ntp.org iburst

# Use a local leap-seconds file.
leapfile "/var/db/ntpd.leap-seconds.list"</programlisting></example>

	<para>O formato deste arquivo é descrito em <citerefentry><refentrytitle>ntp.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>. As descrições abaixo fornecem uma visão geral rápida apenas das palavras-chave usadas no arquivo de exemplo acima.</para>

	<para>Por padrão, um servidor <acronym>NTP</acronym> pode ser acessado de qualquer host da rede. A palavra-chave <literal>restrict</literal> controla quais sistemas podem acessar o servidor. Múltiplas entradas <literal>restrict</literal> são suportadas, cada uma refinando as restrições fornecidas nas instruções anteriores. Os valores mostrados no exemplo concedem ao sistema local o acesso completo à consulta e controle, enquanto permitem aos sistemas remotos apenas a capacidade de consultar o horário. Para obter mais detalhes, consulte a subseção <literal>Access Control Support</literal> de <citerefentry><refentrytitle>ntp.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>

	<para>A palavra-chave <literal>server</literal> especifica um único servidor para consulta. O arquivo pode conter várias palavras-chave server, com um servidor listado em cada linha. A palavra-chave <literal>pool</literal> especifica um pool de servidores. O <application>Ntpd</application> adicionará um ou mais servidores desse pool, conforme necessário, para atingir o número de peers especificado usando o valor <literal>tos minclock</literal>. A palavra-chave <literal>iburst</literal> direciona o <application>ntpd</application> para executar um burst de oito trocas rápidas de pacotes com um servidor quando o contato é estabelecido pela primeira vez, para ajudar a sincronizar rapidamente a hora do sistema.</para>

	<para>A palavra-chave <literal>leapfile</literal> especifica o local de um arquivo que contém informações sobre segundos bissextos. O arquivo é atualizado automaticamente pelo <citerefentry><refentrytitle>periodic</refentrytitle><manvolnum>8</manvolnum></citerefentry>. O local do arquivo especificado por esta palavra-chave deve corresponder ao local definido na variável <literal>ntp_db_leapfile</literal> em <filename>/etc/rc.conf</filename>.</para>
      </sect3>

      <sect3>
	<title>Entradas NTP no <filename>/etc/rc.conf</filename></title>

	<indexterm><primary>NTP</primary> <secondary>rc.conf</secondary></indexterm>

	<para>Defina <literal>ntpd_enable=YES</literal> para iniciar o <application>ntpd</application> no momento do boot do sistema. Depois que o <literal>ntpd_enable=YES</literal> for adicionado ao <filename>/etc/rc.conf</filename>, o <application>ntpd</application> poderá ser iniciado imediatamente sem reiniciar o sistema, digitando:</para>

	<screen><prompt>#</prompt> <userinput>service ntpd start</userinput></screen>

	<para>Somente <literal>ntpd_enable</literal> deve ser configurado para usar o ntpd. As variáveis <filename>rc.conf</filename> listadas abaixo também podem ser definidas conforme necessário.</para>

	<para>Defina <literal>ntpd_sync_on_start=YES</literal> para permitir que o <application>ntpd</application> adiante o relógio, uma vez na inicialização. Normalmente, o <application>ntpd</application> registra uma mensagem de erro e se finaliza se o relógio estiver dessincronizado por mais de 1000 segundos. Essa opção é especialmente útil em sistemas sem um relógio em tempo real com bateria.</para>

	<para>Defina <literal>ntpd_oomprotect=YES</literal> para proteger o serviço <application>ntpd</application> de ser finalizado pelo sistema quando ele tentar se recuperar de uma condição de Falta de Nemória (<acronym>OOM</acronym>).</para>

        <para>Defina <literal>ntpd_config=</literal> para o local de um arquivo <filename>ntp.conf</filename> alternativo.</para>

	<para>Defina <literal>ntpd_flags=</literal> para conter outras flags <application>ntpd</application> conforme necessário, mas evite usar as flags gerenciadas internamente pelo <filename>/etc/rc.d/ntpd</filename>: <itemizedlist spacing="compact">
	    <listitem><para><literal> -p </literal> (local do arquivo pid)</para></listitem>
	    <listitem><para><literal>-c</literal> (configure <literal>ntpd_config=</literal> como alternativa)</para></listitem>
	  </itemizedlist></para>
      </sect3>

      <sect3>
	<title>O <application>Ntpd</application> e o usuário não privilegiado <literal>ntpd</literal></title>

	<para>O <application>Ntpd</application> no FreeBSD pode ser iniciado e executado como um usuário não privilegiado. Para isso, é necessário o módulo de política <citerefentry><refentrytitle>mac_ntpd</refentrytitle><manvolnum>4</manvolnum></citerefentry>. O script de inicialização <filename>/etc/rc.d/ntpd</filename> examina primeiro a configuração do NTP. Se possível, ele carrega o módulo <literal>mac_ntpd</literal> e inicia o <application>ntpd</application> como um usuário não vinculado <literal>ntpd</literal> (user id 123). Para evitar problemas com o acesso a arquivos e diretórios, o script de inicialização não iniciará automaticamente o <application>ntpd</application> como <literal>ntpd</literal> quando a configuração contiver quaisquer opções relacionadas a arquivos.</para>

	<para>A presença de qualquer um dos itens a seguir em <literal>ntpd_flags</literal> requer configuração manual, conforme descrito abaixo, para ser executada como o usuário <literal>ntpd</literal> user: <itemizedlist spacing="compact">
	    <listitem><para>-f or --driftfile</para></listitem>
	    <listitem><para>-i or --jaildir</para></listitem>
	    <listitem><para>-k or --keyfile</para></listitem>
	    <listitem><para>-l or --logfile</para></listitem>
	    <listitem><para>-s or --statsdir</para></listitem>
	  </itemizedlist></para>

	<para>A presença de qualquer uma das seguintes palavras-chave no <filename>ntp.conf</filename> requer configuração manual, conforme descrito abaixo, para ser executado como usuário <literal>ntpd</literal>: <itemizedlist spacing="compact">
	    <listitem><para>crypto</para></listitem>
	    <listitem><para>driftfile</para></listitem>
	    <listitem><para>key</para></listitem>
	    <listitem><para>logdir</para></listitem>
	    <listitem><para>statsdir</para></listitem>
	    </itemizedlist></para>

	<para>Para configurar manualmente o <application>ntpd</application> para ser executado como usuário <literal>ntpd</literal>, você deve: <itemizedlist mark="none" spacing="compact">
	    <listitem><para>Certifique-se de que o usuário <literal>ntpd</literal> tenha acesso a todos os arquivos e diretórios especificados na configuração.</para></listitem>
	    <listitem><para>Se certifique para que o módulo <literal>mac_ntpd</literal> seja carregado ou compilado no kernel. Consulte <citerefentry><refentrytitle>mac_ntpd</refentrytitle><manvolnum>4</manvolnum></citerefentry> para obter detalhes.</para></listitem>
	    <listitem><para>Defina <literal>ntpd_user="ntpd"</literal> no <filename>/etc/rc.conf</filename></para></listitem>
	  </itemizedlist></para>
      </sect3>
    </sect2>

    <sect2>
      <title>Usando <acronym>NTP</acronym> com uma Conexão <acronym>PPP</acronym></title>

      <para>O <application>ntpd</application> não precisa de uma conexão permanente com a Internet para funcionar corretamente. No entanto, se uma conexão <acronym>PPP</acronym> estiver configurada para discar sob demanda, o tráfego de <acronym>NTP</acronym> deverá ser impedido de disparar uma discagem ou manter a conexão ativa. Isso pode ser configurado com as diretivas <literal>filter</literal> em <filename>/etc/ppp/ppp.conf</filename>. Por exemplo:</para>

      <programlisting>set filter dial 0 deny udp src eq 123
# Prevent NTP traffic from initiating dial out
set filter dial 1 permit 0 0
set filter alive 0 deny udp src eq 123
# Prevent incoming NTP traffic from keeping the connection open
set filter alive 1 deny udp dst eq 123
# Prevent outgoing NTP traffic from keeping the connection open
set filter alive 2 permit 0/0 0/0</programlisting>

      <para>Para mais detalhes, consulte a seção <literal>PACKET FILTERING</literal> em <citerefentry><refentrytitle>ppp</refentrytitle><manvolnum>8</manvolnum></citerefentry> e os exemplos em <filename>/usr/share/examples/ppp/</filename>.</para>

      <note>
	<para>Alguns provedores de acesso à Internet bloqueiam portas de números baixos, impedindo o funcionamento do NTP, pois as respostas nunca chegam à máquina.</para>
      </note>
    </sect2>
  </sect1>

  <sect1 xml:id="network-iscsi">
    <!--
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Edward Tomasz</firstname>
	  <surname>Napierala</surname>
	</author>
      </authorgroup>
    </sect1info>
          -->

    <title>Inicializador <acronym>iSCSI</acronym> e Configuração Alvo</title>

    <para><acronym>iSCSI</acronym> é uma maneira de compartilhar o armazenamento em uma rede. Ao contrário do <acronym>NFS</acronym>, que funciona no nível do sistema de arquivos, o <acronym>iSCSI</acronym> funciona no nível do dispositivo de bloco.</para>

    <para>Na terminologia <acronym>iSCSI</acronym>, o sistema que compartilha o armazenamento é conhecido como <emphasis>alvo</emphasis>. O armazenamento pode ser um disco físico ou uma área representando vários discos ou uma parte de um disco físico. Por exemplo, se os discos estiverem formatados com <acronym>ZFS</acronym>, um zvol poderá ser criado para ser usado como armazenamento <acronym>iSCSI</acronym>.</para>

    <para>Os clientes que acessam o armazenamento do <acronym>iSCSI</acronym> são chamados de <emphasis>iniciadores</emphasis>. Para os iniciadores, o armazenamento disponível por meio do <acronym>iSCSI</acronym> aparece como um disco bruto, não formatado, conhecido como <acronym>LUN</acronym>. Nós de dispositivo para o disco aparecem em <filename>/dev/</filename> e o dispositivo deve ser formatado e montado separadamente.</para>

    <para>O FreeBSD fornece um alvo e iniciador nativo, baseado em kernel <acronym>iSCSI</acronym>. Esta seção descreve como configurar um sistema FreeBSD como um alvo ou um iniciador.</para>

    <sect2 xml:id="network-iscsi-target">
      <title>Configurando um Alvo <acronym>iSCSI</acronym></title>

      <para>Para configurar um alvo <acronym>iSCSI</acronym>, crie o arquivo de configuração <filename>/etc/ctl.conf</filename>, adicione uma linha ao arquivo <filename>/etc/rc.conf</filename> para certificar-se de que o daemon <citerefentry><refentrytitle>ctld</refentrytitle><manvolnum>8</manvolnum></citerefentry> seja iniciado automaticamente na inicialização e, em seguida, inicie-o.</para>

      <para>A seguir, um exemplo de um arquivo de configuração simples <filename>/etc/ctl.conf</filename>. Consulte <citerefentry><refentrytitle>ctl.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry> para obter uma descrição mais completa das opções disponíveis deste arquivo.</para>

      <programlisting>portal-group pg0 {
	discovery-auth-group no-authentication
	listen 0.0.0.0
	listen [::]
}

target iqn.2012-06.com.example:target0 {
	auth-group no-authentication
	portal-group pg0

	lun 0 {
		path /data/target0-0
		size 4G
	}
}</programlisting>

      <para>A primeira entrada define o grupo de portais <literal>pg0</literal>. Grupos de portal definem quais endereços de rede o daemon <citerefentry><refentrytitle>ctld</refentrytitle><manvolnum>8</manvolnum></citerefentry> irá escutar. A entrada <literal>discovery-auth-group no-authentication</literal> indica que qualquer iniciador tem permissão para executar descoberta de alvo <acronym>iSCSI</acronym> sem autenticação. As linhas três e quatro configuram <citerefentry><refentrytitle>ctld</refentrytitle><manvolnum>8</manvolnum></citerefentry> para escutar em todos os endereços <acronym>IPv4</acronym> (<literal>listen 0.0.0.0</literal>) e <acronym>IPv6</acronym> (<literal>listen [::]</literal>) na porta padrão 3260.</para>

      <para>Não é necessário definir um grupo de portais, pois há um grupo de portais interno chamado <literal>default</literal>. Nesse caso, a diferença entre <literal>default</literal> e <literal>pg0</literal> é que com <literal>default</literal>, a descoberta de alvo é sempre negada, enquanto com <literal>pg0</literal>, é sempre permitido.</para>

      <para>A segunda entrada define um único alvo. O alvo tem dois significados possíveis: uma máquina que atende <acronym>iSCSI</acronym> ou um grupo nomeado de <acronym>LUNs</acronym>. Este exemplo usa o último significado, onde <literal>iqn.2012-06.com.example:target0</literal> é o nome do alvo. Este nome de alvo é adequado para fins de teste. Para uso real, altere <literal>com.example</literal> para o nome de domínio real, invertido. O <literal>2012-06</literal> representa o ano e o mês de aquisição do controle desse nome de domínio, e <literal>target0</literal> pode ser qualquer valor. Qualquer número de alvos pode ser definido neste arquivo de configuração.</para>

      <para>A linha <literal>auth-group no-authentication</literal> permite que todos os iniciadores se conectem ao alvo especificado e <literal>portal-group pg0</literal> torna o alvo acessível através do grupo do portal <literal>pg0</literal>.</para>

      <para>A próxima seção define o <acronym>LUN</acronym>. Para o iniciador, cada <acronym>LUN</acronym> será visível como um dispositivo de disco separado. Múltiplos <acronym>LUNs</acronym> podem ser definidos para cada destino. Cada <acronym>LUN</acronym> é identificado por um número, onde <acronym>LUN</acronym> 0 é obrigatório. A linha <literal>path/data/target0-0</literal> define o caminho completo para um arquivo ou zvol que suporta o <acronym>LUN</acronym>. Esse caminho deve existir antes de iniciar <citerefentry><refentrytitle>ctld</refentrytitle><manvolnum>8</manvolnum></citerefentry>. A segunda linha é opcional e especifica o tamanho do <acronym>LUN</acronym>.</para>

      <para>Em seguida, para ter certeza que o daemon <citerefentry><refentrytitle>ctld</refentrytitle><manvolnum>8</manvolnum></citerefentry> foi iniciado no boot, adicione esta linha ao arquivo <filename>/etc/rc.conf</filename>:</para>

      <programlisting>ctld_enable="YES"</programlisting>

      <para>Para iniciar o <citerefentry><refentrytitle>ctld</refentrytitle><manvolnum>8</manvolnum></citerefentry> agora, execute este comando:</para>

      <screen><prompt>#</prompt> <userinput>service ctld start</userinput></screen>

      <para>Quando o daemon <citerefentry><refentrytitle>ctld</refentrytitle><manvolnum>8</manvolnum></citerefentry> é iniciado, ele lê o arquivo <filename>/etc/ctl.conf</filename>. Se este arquivo for editado depois que o daemon iniciar, use este comando para que as mudanças entrem em vigor imediatamente:</para>

      <screen><prompt>#</prompt> <userinput>service ctld reload</userinput></screen>

      <sect3>
	<title>Autenticação</title>

	<para>O exemplo anterior é inerentemente inseguro, pois não usa autenticação, concedendo a qualquer um acesso total a todos os alvos. Para exigir um nome de usuário e senha para acessar os alvos, modifique a configuração da seguinte maneira:</para>

	<programlisting>auth-group ag0 {
	chap username1 secretsecret
	chap username2 anothersecret
}

portal-group pg0 {
	discovery-auth-group no-authentication
	listen 0.0.0.0
	listen [::]
}

target iqn.2012-06.com.example:target0 {
	auth-group ag0
	portal-group pg0
	lun 0 {
		path /data/target0-0
		size 4G
	}
}</programlisting>

	<para>A seção <literal>auth-group</literal> define os pares de nome de usuário e senha. Um inicializador tentando se conectar a <literal>iqn.2012-06.com.example:target0</literal> deve primeiro especificar um nome de usuário e senha definidos. No entanto, a descoberta do alvo ainda é permitida sem autenticação. Para exigir autenticação de descoberta de alvo, defina <literal>discovery-auth-group</literal> como um nome <literal>auth-group</literal> definido em vez de <literal>no-authentication</literal>.</para>

	<para>É comum definir um único alvo exportado para cada inicializador. Como um atalho para a sintaxe acima, o nome de usuário e a senha podem ser especificados diretamente na entrada do alvo:</para>

	<programlisting>target iqn.2012-06.com.example:target0 {
	portal-group pg0
	chap username1 secretsecret

	lun 0 {
		path /data/target0-0
		size 4G
	}
}</programlisting>
      </sect3>
    </sect2>

    <sect2 xml:id="network-iscsi-initiator">
      <title>Configurando um Inicializador <acronym>iSCSI</acronym></title>

      <note>
	<para>O inicializador <acronym>iSCSI</acronym> descrito nesta seção é suportado a partir do FreeBSD 10.0-RELEASE. Para usar o inicializador <acronym>iSCSI</acronym> disponível em versões mais antigas, consulte <citerefentry><refentrytitle>iscontrol</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
      </note>

      <para>O inicializador <acronym>iSCSI</acronym> requer que o daemon <citerefentry><refentrytitle>iscsid</refentrytitle><manvolnum>8</manvolnum></citerefentry> esteja em execução. Este daemon não usa um arquivo de configuração. Para iniciá-lo automaticamente na inicialização, adicione esta linha ao arquivo <filename>/etc/rc.conf</filename>:</para>

      <programlisting>iscsid_enable="YES"</programlisting>

      <para>Para iniciar <citerefentry><refentrytitle>iscsid</refentrytitle><manvolnum>8</manvolnum></citerefentry> agora, execute este comando:</para>

      <screen><prompt>#</prompt> <userinput>service iscsid start</userinput></screen>

      <para>Conectar-se a um alvo pode ser feito com ou sem um arquivo <filename>/etc/iscsi.conf</filename> de configuração. Esta seção demonstra os dois tipos de conexões.</para>

      <sect3>
	<title>Conectando-se a um Alvo sem um Arquivo de Configuração</title>

	<para>Para conectar um inicializador a um único alvo, especifique o endereço <acronym>IP</acronym> do portal e o nome do alvo:</para>

	<screen><prompt>#</prompt> <userinput>iscsictl -A -p <replaceable>10.10.10.10</replaceable> -t <replaceable>iqn.2012-06.com.example:target0</replaceable></userinput></screen>

	<para>Para verificar se a conexão foi bem sucedida, execute <command>iscsictl</command> sem nenhum argumento. A saída deve ser semelhante a esta:</para>

	<programlisting>Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.10     Connected: da0</programlisting>

	<para>Neste exemplo, a sessão <acronym>iSCSI</acronym> foi estabelecida com sucesso, com <filename>/dev/da0</filename> representando o <acronym>LUN</acronym> anexado. Se o destino <literal>iqn.2012-06.com.example:target0</literal> exportar mais de um <acronym>LUN</acronym>, vários nós de dispositivos serão mostrados nessa seção da saída:</para>

	<screen>Connected: da0 da1 da2.</screen>

	<para>Quaisquer erros serão relatados na saída, assim como os logs do sistema. Por exemplo, esta mensagem normalmente significa que o daemon <citerefentry><refentrytitle>iscsid</refentrytitle><manvolnum>8</manvolnum></citerefentry> não está em execução:</para>

	<programlisting>Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.10     Waiting for iscsid(8)</programlisting>

	<para>A mensagem a seguir sugere um problema de rede, como uma porta ou endereço <acronym>IP</acronym> incorreto:</para>

	<programlisting>Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.11     Connection refused</programlisting>

	<para>Esta mensagem significa que o nome do alvo especificado está errado:</para>

	<programlisting>Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.10     Not found</programlisting>

	<para>Esta mensagem significa que o alvo requer autenticação:</para>

	<programlisting>Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.10     Authentication failed</programlisting>

	<para>Para especificar um nome de usuário e uma senha de <acronym>CHAP</acronym>, use esta sintaxe:</para>

	<screen><prompt>#</prompt> <userinput>iscsictl -A -p <replaceable>10.10.10.10</replaceable> -t <replaceable>iqn.2012-06.com.example:target0</replaceable> -u <replaceable>user</replaceable> -s <replaceable>secretsecret</replaceable></userinput></screen>
      </sect3>

      <sect3>
	<title>Conectando-se a um Alvo com um Arquivo de Configuração</title>

	<para>Para se conectar usando um arquivo de configuração, crie o <filename>/etc/iscsi.conf</filename> com o seguinte conteúdo:</para>

	<programlisting>t0 {
	TargetAddress   = 10.10.10.10
	TargetName      = iqn.2012-06.com.example:target0
	AuthMethod      = CHAP
	chapIName       = user
	chapSecret      = secretsecret
}</programlisting>

	<para>O <literal>t0</literal> especifica um nickname para a seção do arquivo de configuração. Ele será usado pelo iniciador para especificar qual configuração usar. As outras linhas especificam os parâmetros a serem usados durante a conexão. O <literal>TargetAddress</literal> e <literal>TargetName</literal> são obrigatórios, enquanto as outras opções são opcionais. Neste exemplo, o nome de usuário e a senha do <acronym>CHAP</acronym> são mostrados.</para>

	<para>Para se conectar ao alvo definido, especifique o apelido:</para>

	<screen><prompt>#</prompt> <userinput>iscsictl -An <replaceable>t0</replaceable></userinput></screen>

	<para>Como alternativa, para conectar-se a todos os alvos definidos no arquivo de configuração, use:</para>

	<screen><prompt>#</prompt> <userinput>iscsictl -Aa</userinput></screen>

	<para>Para fazer com que o inicializador se conecte automaticamente a todos os alvos no arquivo <filename>/etc/iscsi.conf</filename>, adicione o seguinte ao arquivo <filename>/etc/rc.conf</filename>:</para>

	<programlisting>iscsictl_enable="YES"
iscsictl_flags="-Aa"</programlisting>

      </sect3>
    </sect2>
  </sect1>

</chapter>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<chapter version="5.0" xml:id="firewalls">

  <info>
    <title>Firewalls</title>

    <authorgroup>
      <author><personname> <firstname>Joseph J.</firstname> <surname>Barbish</surname> </personname> <contrib>Contribuído por </contrib></author>
    </authorgroup>

    <authorgroup>
      <author><personname> <firstname>Brad</firstname> <surname>Davis</surname> </personname> <contrib>Convertido para SGML e atualizado por </contrib></author>
    </authorgroup>
  </info>

  <indexterm><primary>firewall</primary></indexterm>

  <indexterm><primary>security</primary> <secondary>firewalls</secondary></indexterm>

  <sect1 xml:id="firewalls-intro">
    <title>Sinopse</title>

    <para>Os firewalls permitem filtrar o tráfego de entrada e saída que flui através de um sistema. Um firewall pode usar um ou mais conjuntos de <quote>regras</quote> para inspecionar os pacotes de rede à medida que eles entram ou saem das conexões de rede e assim permitir ou bloquear o tráfego. As regras de um firewall podem inspecionar uma ou mais características dos pacotes, como o tipo de protocolo, o endereço do host de origem ou de destino e a porta de origem ou de destino.</para>

    <para>Os firewalls podem melhorar a segurança de um host ou de uma rede. Eles podem ser usados para fazer um ou mais dos seguintes procedimentos:</para>

    <itemizedlist>
      <listitem>
	<para>Proteger e isolar as aplicações, serviços e máquinas de uma rede interna contra tráfego indesejado da Internet pública.</para>
      </listitem>

      <listitem>
	<para>Limitar ou desabilitar o acesso de hosts da rede interna para serviços da Internet pública.</para>
      </listitem>

      <listitem>
	<para>Suportar a tradução de endereços de rede (<acronym>NAT</acronym>), que possibilita que uma rede interna use endereços <acronym>IP</acronym> privados e compartilhe uma única conexão com a Internet pública usando um único endereço <acronym>IP</acronym> ou um pool compartilhado de endereços públicos atribuídos automaticamente.</para>
      </listitem>
    </itemizedlist>

    <para>O FreeBSD possui três firewalls embutidos no sistema base: <application>PF</application>, <application>IPFW</application> e <application>IPFILTER</application>, também conhecido como <application>IPF</application>. O FreeBSD também fornece dois traffic 
 shapers para controlar o uso da largura de banda: <citerefentry><refentrytitle>altq</refentrytitle><manvolnum>4</manvolnum></citerefentry> e  <citerefentry><refentrytitle>dummynet</refentrytitle><manvolnum>4</manvolnum></citerefentry>. O <application>ALTQ</application> tem sido tradicionalmente vinculado ao <application>PF</application> e o <application>dummynet</application> ao <application>IPFW</application>. Cada firewall usa regras para controlar o acesso de pacotes provenientes e com destino a um sistema FreeBSD, embora eles façam isso de maneiras diferentes e cada um com uma sintaxe de regra diferente.</para>

    <para>O FreeBSD fornece vários firewalls para atender aos diferentes requisitos e preferências para uma ampla variedade de usuários. Cada usuário deve avaliar qual firewall atende melhor às suas necessidades.</para>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>Como definir regras de filtragem de pacotes.</para>
      </listitem>

      <listitem>
	<para>As diferenças entre os firewalls embutidos no FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como usar e configurar o firewall <application>PF</application>.</para>
      </listitem>

      <listitem>
	<para>Como usar e configurar o firewall <application>IPFW</application>.</para>
      </listitem>

      <listitem>
	<para>Como usar e configurar o firewall <application>IPFILTER</application>.</para>
      </listitem>
    </itemizedlist>

    <para>Antes de ler este capítulo, você deve:</para>

    <itemizedlist>
      <listitem>
	<para>Entender os conceitos básicos do FreeBSD e de Internet.</para>
      </listitem>
    </itemizedlist>

    <note>
      <para>Como todos os firewalls são baseados em inspecionar os valores dos campos de controle de pacotes selecionados, o criador do conjunto de regras do firewall deve ter uma compreensão de como funciona o <acronym>TCP/IP</acronym>, quais são os diferentes valores nos campos de controle de pacotes e como esses valores são usados em uma conversa de sessão normal. Para uma boa introdução, consulte <link xlink:href="http://www.ipprimer.com">Daryl's TCP/IP Primer</link>.</para>
    </note>
  </sect1>

  <sect1 xml:id="firewalls-concepts">
    <title>Conceitos de Firewall</title>

    <indexterm><primary>firewall</primary> <secondary>rulesets</secondary></indexterm>

    <para>Um conjunto de regras contém um grupo de regras que liberam ou bloqueiam pacotes com base nos valores contidos no pacote. A troca bidirecional de pacotes entre hosts compreende uma conversa de sessão. O conjunto de regras do firewall processa os pacotes que chegam da Internet pública, bem como os pacotes produzidos pelo sistema como uma resposta aos que chegaram. Cada serviço <acronym>TCP/IP</acronym> é pré-definido pelo seu protocolo e porta de escuta. Os pacotes destinados a um serviço específico são originados do endereço de origem usando uma porta não privilegiada e têm como destino a porta do serviço específica no endereço de destino. Todos os parâmetros acima podem ser usados como critérios de seleção para criar regras que irão liberar ou bloquear serviços.</para>

    <para>Para procurar números de porta desconhecidos, consulte o arquivo <filename>/etc/services</filename>. Alternativamente, visite <uri xlink:href="http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers">http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers</uri> e faça uma pesquisa de número de porta para encontrar a finalidade de um determinado número de porta.</para>

    <para>Confira este link para ver os <uri xlink:href="http://web.archive.org/web/20150803024617/http://www.sans.org/security-resources/idfaq/oddports.php">números de porta usados por Trojans</uri>.</para>

    <para>O FTP possui dois modos: modo ativo e modo passivo. A diferença está em como o canal de dados é adquirido. O modo passivo é mais seguro, pois o canal de dados é adquirido pelo solicitante de sessão ftp. Para obter uma boa explicação sobre o FTP e seus diferentes modos, consulte <uri xlink:href="http://www.slacksite.com/other/ftp.html">http://www.slacksite.com/other/ftp.html</uri>.</para>

    <para>Um conjunto de regras de firewall pode ser <quote>exclusivo</quote> ou <quote>inclusivo</quote>. Um firewall exclusivo libera todo o tráfego, exceto o tráfego correspondente ao conjunto de regras. Um firewall inclusivo faz o inverso, liberando o tráfego que corresponde as regras e bloqueia todo o resto.</para>

    <para>Um firewall inclusivo oferece melhor controle do tráfego de saída, tornando-o uma melhor escolha para sistemas que oferecem serviços à Internet pública. Também controla o tipo de tráfego originado da Internet pública que pode obter acesso a uma rede privada. Todo o tráfego que não corresponde às regras é bloqueado e registrado. Os firewalls inclusivos são geralmente mais seguros do que os firewalls exclusivos, pois reduzem significativamente o risco de permitir tráfego indesejado.</para>

    <note>
      <para>Salvo indicação contrária, todos os conjuntos de regras de configuração e exemplo neste capítulo criam conjuntos de regras de firewall inclusivos.</para>
    </note>

    <para>A segurança pode ser reforçada usando um <quote>firewall stateful</quote>. Esse tipo de firewall registra e acompanha as conexões abertas e libera apenas o tráfego que corresponde a uma conexão existente ou libera e abre uma nova conexão.</para>

    <para>A filtragem stateful trata o tráfego como uma troca bidirecional de pacotes compondo uma sessão. Quando um estado é especificado em uma regra de correspondência, o firewall gera dinamicamente regras internas para cada pacote antecipado sendo trocado durante a sessão. Ele possui recursos de correspondência suficientes para determinar se um pacote é válido para uma sessão. Quaisquer pacotes que não se encaixem corretamente no modelo de sessão serão automaticamente rejeitados.</para>

    <para>Quando a sessão é concluída, ela é removida da tabela de estados dinâmicos.</para>

    <para>A filtragem stateful permite dar foco no bloqueio/liberação de novas sessões. Se a nova sessão for passada, todos os seus pacotes subsequentes serão permitidos automaticamente e todos os pacotes de um impostor serão automaticamente rejeitados. Se uma nova sessão for bloqueada, nenhum dos seus pacotes subsequentes serão permitidos. A filtragem stateful fornece habilidades de correspondência avançadas capazes de se defender contra o flood de diferentes métodos de ataque empregados pelos invasores.</para>

    <para><acronym>NAT</acronym> significa <emphasis>Tradução de Endereços de Rede</emphasis>. A função <acronym>NAT</acronym> permite que a LAN privada por trás do firewall compartilhe um único endereço IP atribuído pelo ISP, mesmo que esse endereço seja atribuído dinamicamente. O NAT permite que cada computador na LAN tenha acesso à Internet, sem ter que pagar ao ISP por várias contas de Internet ou endereços IP.</para>

    <para>O <acronym>NAT</acronym> traduzirá automaticamente o endereço IP da LAN privada de cada sistema na LAN para o único endereço IP público, à medida que os pacotes saem do firewall vinculado à Internet pública. Também executa a conversão inversa para devolver os pacotes.</para>

    <para>De acordo com a RFC 1918, os seguintes intervalos de endereços IP são reservados para redes privadas que nunca serão roteadas diretamente para a Internet pública e, portanto, estão disponíveis para uso com o NAT:</para>

    <itemizedlist>
      <listitem>
	<para><literal>10.0.0.0/8</literal>.</para>
      </listitem>

      <listitem>
	<para><literal>172.16.0.0/12</literal>.</para>
      </listitem>

      <listitem>
	<para><literal>192.168.0.0/16</literal>.</para>
      </listitem>
    </itemizedlist>

    <warning>
      <para>Ao trabalhar com regras de firewall, seja <emphasis>muito cuidadoso</emphasis>. Algumas configurações <emphasis>podem bloquear o administrador</emphasis> do servidor. Para estar seguro, considere executar a configuração inicial do firewall a partir do console local, em vez de fazê-lo remotamente por <application>ssh</application>.</para>
    </warning>
  </sect1>

  <sect1 xml:id="firewalls-pf">
    <info>
      <title>PF</title>

      <authorgroup>
	<author><personname> <firstname>John</firstname> <surname>Ferrell</surname> </personname> <contrib>Revisado e atualizado por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>firewall</primary> <secondary>PF</secondary></indexterm>

    <para>Desde o FreeBSD 5.3, uma versão portada do firewall <application>PF</application> do OpenBSD foi incluída como uma parte integrada do sistema base. O <application>PF</application> é um firewall completo, cheio de recursos que possui suporte opcional para <application>ALTQ</application> (Alternate Queuing), que fornece Qualidade de Serviço (<acronym>QoS</acronym>).</para>

    <para>O Projeto OpenBSD mantém a referência definitiva para <application>PF</application> no <link xlink:href="http://www.openbsd.org/faq/pf/">FAQ do PF</link>. Peter Hansteen mantém um tutorial completo do <application>PF</application> em <link xlink:href="http://home.nuug.no/~peter/pf/">http://home.nuug.no/~peter/pf/</link>.</para>

    <warning>
      <para>Ao ler o <link xlink:href="http://www.openbsd.org/faq/pf/">FAQ do PF</link>, tenha em mente que a versão do <application>PF</application> do FreeBSD divergiu substancialmente da versão inicial do OpenBSD ao longo dos anos. Nem todos os recursos funcionam da mesma maneira no FreeBSD como no OpenBSD e vice-versa.</para>
    </warning>

    <para>A <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pf">lista de emails do packet filter do FreeBSD</link> é um bom lugar para perguntar questões relacionadas a configuração e execução do firewall <application>PF</application>. Verifique os arquivos da lista de email antes de perguntar alguma questão, pois ela já pode ter sido respondida.</para>

    <para>Esta seção do Handbook foca no <application>PF</application> no que se refere ao FreeBSD. Ele demonstra como ativar o <application>PF</application> e <application>ALTQ</application>. Em seguida, ele fornece vários exemplos para criar conjuntos de regras em um sistema FreeBSD.</para>

    <sect2>
      <title>Ativando o <application>PF</application></title>

      <para>Para usar o <application>PF</application>, seu módulo do kernel deve ser carregado primeiro. Esta seção descreve as entradas que podem ser adicionadas ao <filename>/etc/rc.conf</filename> para habilitar o <application>PF</application>.</para>

      <para>Comece adicionando a seguinte linha <literal>pf_enable=yes</literal> ao arquivo <filename>/etc/rc.conf</filename>:</para>

      <screen><prompt>#</prompt> <userinput>sysrc pf_enable=yes</userinput></screen>

      <para>Opções adicionais, descritas em <citerefentry><refentrytitle>pfctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>, podem ser passadas para o <application>PF</application> quando ele é iniciado. Adicione esta entrada ao arquivo <filename>/etc/rc.conf</filename> e especifique quaisquer flags necessárias entre duas aspas (<literal>""</literal>):</para>

      <programlisting>pf_flags=""                     # additional flags for pfctl startup</programlisting>

      <para>O <application>PF</application> não será iniciado se não puder localizar o arquivo de configuração do conjunto de regras. Por padrão, o FreeBSD não vem com um conjunto de regras e não há um <filename>/etc/pf.conf</filename>. Exemplos de regras podem ser encontrados em <filename>/usr/share/examples/pf/</filename>. Se um conjunto de regras personalizado foi salvo em algum outro lugar, adicione uma linha ao arquivo <filename>/etc/rc.conf</filename> que especifica o caminho completo para o arquivo:</para>

      <programlisting>pf_rules="<replaceable>/path/to/pf.conf</replaceable>"</programlisting>

      <para>O suporte de log para o <application>PF</application> é fornecido pelo <citerefentry><refentrytitle>pflog</refentrytitle><manvolnum>4</manvolnum></citerefentry>. Para ativar o suporte aos logs, adicione esta linha ao <filename>/etc/rc.conf</filename>:</para>

      <screen><prompt>#</prompt> <userinput>sysrc pflog_enable=yes</userinput></screen>

      <para>As seguintes linhas também podem ser adicionadas para alterar a localização padrão do arquivo de log ou para especificar quaisquer flags adicionais na inicialização do <citerefentry><refentrytitle>pflog</refentrytitle><manvolnum>4</manvolnum></citerefentry>:</para>

      <programlisting>pflog_logfile="/var/log/pflog"  # where pflogd should store the logfile
pflog_flags=""                  # additional flags for pflogd startup</programlisting>

      <para>Finalmente, se houver uma <acronym>LAN</acronym> atrás do firewall e os pacotes precisarem ser encaminhados para os computadores na <acronym>LAN</acronym>, ou se <acronym>NAT</acronym> for necessário, adicione a seguinte opção:</para>

      <programlisting>gateway_enable="YES"            # Enable as LAN gateway</programlisting>

      <para>Depois de salvar as edições necessárias, o <application>PF</application> pode ser iniciado com o suporte de log, digitando:</para>

      <screen><prompt>#</prompt> <userinput>service pf start</userinput>
<prompt>#</prompt> <userinput>service pflog start</userinput></screen>

<!--
This is no longer true as of 9.x. It also references the CARP section
which doesn't explain how to use it...At some point it should.
     <indexterm>
	<primary>kernel options</primary>
	<secondary>device pf</secondary>
      </indexterm>

      <indexterm>
	<primary>kernel options</primary>
	<secondary>device pflog</secondary>
      </indexterm>

      <indexterm>
	<primary>kernel options</primary>
	<secondary>device pfsync</secondary>
      </indexterm>

      <note>
      <para>While it is not necessary to compile
	<application>PF</application> support into the &os; kernel,
	some advanced features are not included, namely &man.pfsync.4;, which is a
	pseudo-device that exposes certain changes to the state table
	used by <application>PF</application>.  It can be paired with
	&man.carp.4; to create failover firewalls using
	<application>PF</application>.  More information on
	<acronym>CARP</acronym> can be found in <xref linkend="carp"/>.</para>

      <para>The following <application>PF</application> kernel options
	are available:</para>

      <programlisting>device pf
device pflog
device pfsync</programlisting>

      <para>where:</para>

      <para><literal>device pf</literal> enables PF support.</para>

      <para><literal>device pflog</literal> enables the optional
	&man.pflog.4; pseudo network device which can be used to log
	traffic to a &man.bpf.4; descriptor.  The &man.pflogd.8;
	daemon can then be used to store the logging information to
	disk.</para>

      <para><literal>device pfsync</literal> enables the optional
	&man.pfsync.4; pseudo-network device that is used to monitor
	<quote>state changes</quote>.</para>
    </note>
    -->

      <para>Por padrão, o <application>PF</application> lê suas regras de configuração do arquivo <filename>/etc/pf.conf</filename> e modifica, descarta ou libera pacotes de acordo com as regras ou definições especificadas neste arquivo. A instalação do FreeBSD inclui vários arquivos de exemplo localizados em <filename>/usr/share/examples/pf/</filename>. Consulte o <link xlink:href="http://www.openbsd.org/faq/pf/">FAQ do PF</link> para obter uma cobertura completa dos conjuntos de regras do <application>PF</application>.</para>

      <para>Para controlar o <application>PF</application>, use o <command>pfctl</command>. <xref linkend="pfctl"/> resume algumas opções úteis para este comando. Consulte <citerefentry><refentrytitle>pfctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter uma descrição de todas as opções disponíveis:</para>

      <table xml:id="pfctl" frame="none" pgwide="1">
	<title>Opções Úteis do <command>pfctl</command></title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Comando</entry>
	      <entry>Propósito</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><command>pfctl -e</command></entry>
	      <entry>Ativa o <application>PF</application>.</entry>
	    </row>

	    <row>
	      <entry><command>pfctl -d</command></entry>
	      <entry>Desabilita o <application>PF</application>.</entry>
	    </row>

	    <row>
	      <entry><command>pfctl -F all -f /etc/pf.conf</command></entry>
	      <entry>Limpa todas as regras de <acronym>NAT</acronym>, filtro, estado e tabela e recarrega o <filename>/etc/pf.conf</filename>.</entry>
	    </row>

	    <row>
	      <entry><command>pfctl -s [ rules | nat | states ]</command></entry>
	      <entry>Informa as regras de filtragem, de <acronym>NAT</acronym> ou a tabela de estados.</entry>
	    </row>

	    <row>
	      <entry><command>pfctl -vnf /etc/pf.conf</command></entry>
	      <entry>Verifica se tem erros no arquivo <filename>/etc/pf.conf</filename>, mas não carrega o conjunto de regras.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <tip>
	<para><package>security/sudo</package> é útil para executar comandos como <command>pfctl</command> que exigem privilégios elevados. Ele pode ser instalado a partir da Coleção de Ports.</para>
      </tip>

      <para>Para ficar de olho no tráfego que passa pelo firewall <application>PF</application>, considere instalar o pacote ou port <package>sysutils/pftop</package>. Uma vez instalado, o <application>pftop</application> pode ser executado para exibir um snapshot do estado atual do tráfego em um formato semelhante ao <citerefentry><refentrytitle>top</refentrytitle><manvolnum>1</manvolnum></citerefentry>.</para>
    </sect2>

    <sect2 xml:id="pf-tutorial">
      <info>
	<title>Conjuntos de Regras do <application>PF</application></title>

	<authorgroup>
	  <author><personname> <firstname>Peter</firstname> <surname>Hansteen</surname> <othername>N. M.</othername> </personname> <contrib>Contribuído por </contrib></author>
	</authorgroup>
      </info>

      <para>Esta seção demonstra como criar um conjunto de regras personalizado. Ele começa com o mais simples dos conjuntos de regras e baseia-se em seus conceitos usando vários exemplos para demonstrar o uso real dos diversos recursos do <application>PF</application>.</para>

      <para>O conjunto de regras mais simples possível é para uma única máquina que não executa nenhum serviço e que precisa de acesso a uma rede, que pode ser a Internet. Para criar este conjunto de regras mínimo, edite o arquivo <filename>/etc/pf.conf</filename> para que fique assim:</para>

      <programlisting>block in all
pass out all keep state</programlisting>

      <para>A primeira regra nega todo o tráfego de entrada por padrão. A segunda regra permite que as conexões originadas por este sistema sejam liberadas, mantendo as informações de estado nessas conexões. Essas informações de estado permitem que o tráfego de retorno para essas conexões seja liberado e só deve ser usado em máquinas confiáveis. O conjunto de regras pode ser carregado com:</para>

      <screen><prompt>#</prompt> <userinput>pfctl -e ; pfctl -f /etc/pf.conf</userinput></screen>

      <para>Além de manter estados, o <application>PF</application> fornece <firstterm>listas</firstterm> e <firstterm>macros</firstterm> que podem ser definidas para uso ao criar regras. As macros podem incluir listas e precisam ser definidas antes de serem usadas. Como exemplo, insira essas linhas no topo do conjunto de regras:</para>

      <programlisting>tcp_services = "{ ssh, smtp, domain, www, pop3, auth, pop3s }"
udp_services = "{ domain }"</programlisting>

      <para>O <application>PF</application> entende os nomes das portas, assim como os números das portas, desde que os nomes estejam listados em <filename>/etc/services</filename>. Este exemplo cria duas macros. A primeira é uma lista de sete nomes de portas <acronym>TCP</acronym> e a segunda é um nome de porta <acronym>UDP</acronym>. Uma vez definidas, as macros podem ser usadas em regras. Neste exemplo, todo o tráfego é bloqueado, exceto pelas conexões originadas por este sistema para os sete serviços <acronym>TCP</acronym> especificados e para o serviço <acronym>UDP</acronym> especificado:</para>

      <programlisting>tcp_services = "{ ssh, smtp, domain, www, pop3, auth, pop3s }"
udp_services = "{ domain }"
block all
pass out proto tcp to any port $tcp_services keep state
pass proto udp to any port $udp_services keep state</programlisting>

      <para>Embora o <acronym>UDP</acronym> seja considerado um protocolo sem estado, o <application>PF</application> é capaz de rastrear algumas informações de estado. Por exemplo, quando uma solicitação <acronym>UDP</acronym> é liberada perguntando a um servidor de nomes sobre um nome de domínio, o <application>PF</application> irá procurar pela resposta para libera-la.</para>

      <para>Sempre que uma edição é feita em um conjunto de regras, as novas regras devem ser carregadas para que possam ser usadas:</para>

      <screen><prompt>#</prompt> <userinput>pfctl -f /etc/pf.conf</userinput></screen>

      <para>Se não houver erros de sintaxe, o <command>pfctl</command> não exibirá nenhuma mensagem durante o carregamento da regra. As regras também podem ser testadas antes de tentar carregá-las:</para>

      <screen><prompt>#</prompt> <userinput>pfctl -nf /etc/pf.conf</userinput></screen>

      <para>A inclusão de <option>-n</option> faz com que as regras sejam interpretadas apenas, mas não carregadas. Isso fornece uma oportunidade para corrigir quaisquer erros. Em todos os momentos, o último conjunto de regras válido carregado será imposto até que o <application>PF</application> seja desativado ou um novo conjunto de regras seja carregado.</para>

      <tip>
	<para>Adicionando <option>-v</option> ao comando <command>pfctl</command> no carregamento ou checagem de conjuntos de regras, será exibido as regras exatamente da maneira como elas serão carregadas. Isso é extremamente útil ao depurar regras.</para>
      </tip>

      <sect3 xml:id="pftut-gateway">
	<title>Um Gateway Simples com NAT</title>

	<para>Esta seção demonstra como configurar um sistema FreeBSD executando <application>PF</application> para atuar como um gateway para pelo menos uma outra máquina. O gateway precisa de pelo menos duas interfaces de rede, cada uma conectada a uma rede separada. Neste exemplo, <filename>xl1</filename> está conectada à Internet e a <filename>xl0</filename> está conectada à rede interna.</para>

	<para>Primeiro, ative o gateway para permitir que a máquina encaminhe o tráfego de rede que recebe em uma interface para outra interface. Esta configuração do <application>sysctl</application> encaminhará pacotes <acronym>IPv4</acronym>:</para>

	<screen><prompt>#</prompt> <userinput>sysctl net.inet.ip.forwarding=1</userinput></screen>

	<para>Para encaminhar tráfego <acronym>IPv6</acronym>, use:</para>

	<screen><prompt>#</prompt> <userinput>sysctl net.inet6.ip6.forwarding=1</userinput></screen>

	<para>Para ativar essas configurações na inicialização do sistema, use o <citerefentry><refentrytitle>sysrc</refentrytitle><manvolnum>8</manvolnum></citerefentry> para adicioná-las ao <filename>/etc/rc.conf</filename>:</para>

	<screen><prompt>#</prompt> <userinput>sysrc gateway_enable=yes</userinput>
<prompt>#</prompt> <userinput>sysrc ipv6_gateway_enable=yes</userinput></screen>

	<para>Verifique com o <command>ifconfig</command> se ambas as interfaces estão ativadas e em execução.</para>

	<para>Em seguida, crie as regras <application>PF</application> para permitir que o gateway transmita tráfego. Embora a regra a seguir permita que o tráfego stateful de hosts da rede interna passe para o gateway, a palavra-chave <literal>to</literal> não garante a passagem da origem até o destino:</para>

	<programlisting>pass in on xl1 from xl1:network to xl0:network port $ports keep state</programlisting>

	<para>Essa regra só permite que o tráfego passe para o gateway na interface interna. Para deixar os pacotes irem mais longe, é necessária uma regra de correspondência:</para>

	<programlisting>pass out on xl0 from xl1:network to xl0:network port $ports keep state</programlisting>

	<para>Embora essas duas regras funcionem, regras especificadas dessa forma raramente são necessárias. Para um administrador de rede ocupado, um conjunto de regras legível é um conjunto de regras mais seguro. O restante desta seção demonstra como manter as regras o mais simples possível para facilitar a leitura. Por exemplo, essas duas regras podem ser substituídas por uma regra:</para>

	<programlisting>pass from xl1:network to any port $ports keep state</programlisting>

	<para>A notação <literal>interface:network</literal> pode ser substituída por uma macro para tornar o conjunto de regras ainda mais legível. Por exemplo, uma macro <literal>$localnet</literal> pode ser definida como a rede diretamente conectada à interface interna (<literal>$xl1:network</literal>). Alternativamente, a definição de <literal>$localnet</literal> poderia ser alterada para uma notação <emphasis>IP address/netmask</emphasis> para denotar uma rede, como <literal>192.168.100.1/24</literal> para uma sub-rede de endereços privados.</para>

	<para>Se necessário, <literal>$localnet</literal> pode ser definido como uma lista de redes. Quaisquer que sejam as necessidades específicas, uma definição sensata de <literal>$localnet</literal> poderia ser usada em uma regra típica de liberação da seguinte maneira:</para>

	<programlisting>pass from $localnet to any port $ports keep state</programlisting>

	<para>O conjunto de regras de exemplo a seguir libera todo o tráfego originado por máquinas na rede interna. Primeiro define duas macros para representar as interfaces externas e internas 3COM do gateway.</para>

	<note>
	  <para>Para usuários dial-up, a interface externa será <filename>tun0</filename>. Para uma conexão <acronym>ADSL</acronym>, especificamente aquelas que usam <acronym>PPP</acronym> over Ethernet (<acronym>PPPoE</acronym>), a interface externa correta é <filename>tun0</filename>, não a interface física Ethernet.</para>
	</note>

	<programlisting>ext_if = "xl0"	# macro for external interface - use tun0 for PPPoE
int_if = "xl1"	# macro for internal interface
localnet = $int_if:network
# ext_if IP address could be dynamic, hence ($ext_if)
nat on $ext_if from $localnet to any -&gt; ($ext_if)
block all
pass from { lo0, $localnet } to any keep state</programlisting>

	<para>Este conjunto de regras introduz a regra <literal>nat</literal> que é usada para tratar a tradução de endereços de rede dos endereços não roteáveis dentro da rede interna para o endereço <acronym>IP</acronym> atribuído à interface externa. Os parênteses em torno da última parte da regra nat <literal>($ext_if)</literal> são incluídos quando o endereço <acronym>IP</acronym> da interface externa é atribuído dinamicamente. Ele garante que o tráfego de rede seja executado sem interrupções graves, mesmo se o endereço <acronym>IP</acronym> externo for alterado.</para>

	<para>Observe que esse conjunto de regras provavelmente permite que mais tráfego seja transmitido para fora da rede do que o necessário. Uma configuração razoável poderia criar essa macro:</para>

	<programlisting>client_out = "{ ftp-data, ftp, ssh, domain, pop3, auth, nntp, http, \
    https, cvspserver, 2628, 5999, 8000, 8080 }"</programlisting>

	<para>para usar na regra principal de liberação:</para>

	<programlisting>pass inet proto tcp from $localnet to any port $client_out \
    flags S/SA keep state</programlisting>

	<para>Algumas outras regras de aprovação podem ser necessárias. Esta permite ativar o <acronym>SSH</acronym> na interface externa:</para>

	<programlisting>pass in inet proto tcp to $ext_if port ssh</programlisting>

	<para>Esta definição de macro e regra permite <acronym>DNS</acronym> e <acronym>NTP</acronym> para clientes internos:</para>

	<programlisting>udp_services = "{ domain, ntp }"
pass quick inet proto { tcp, udp } to any port $udp_services keep state</programlisting>

	<para>Observe a palavra-chave <literal>quick</literal> nesta regra. Como o conjunto de regras consiste em várias regras, é importante entender as relações entre as regras em um conjunto de regras. As regras são avaliadas de cima para baixo, na sequência em que são escritas. Para cada pacote ou conexão avaliado pelo <application>PF</application>, <emphasis>a última regra correspondente</emphasis> no conjunto de regras é aquela que é aplicada. No entanto, quando um pacote corresponde a uma regra que contém a palavra-chave <literal>quick</literal>, o processamento da regra é interrompido e o pacote é tratado de acordo com essa regra. Isso é muito útil quando é necessária uma exceção às regras gerais.</para>
      </sect3>

      <sect3 xml:id="pftut-ftp">
	<title>Criando um Proxy <acronym>FTP</acronym></title>

	<para>Configurar regras funcionais de <acronym>FTP</acronym> pode ser problemático devido à natureza do protocolo <acronym>FTP</acronym>. O <acronym>FTP</acronym> pré-data os firewalls por várias décadas e é inseguro em seu design. Os pontos mais comuns contra o uso do <acronym>FTP</acronym> incluem:</para>

	<itemizedlist>
	  <listitem>
	    <para>As senhas são transferidas em texto puro.</para>
	  </listitem>

	  <listitem>
	    <para>O protocolo exige o uso de pelo menos duas conexões <acronym>TCP</acronym> (controle e dados) em portas separadas.</para>
	  </listitem>

	  <listitem>
	    <para>Quando uma sessão é estabelecida, os dados são transmitidos usando portas selecionadas aleatoriamente.</para>
	  </listitem>
	</itemizedlist>

	<para>Todos esses pontos apresentam desafios de segurança, mesmo antes de considerar possíveis pontos fracos de segurança no software cliente ou servidor. Há alternativas mais seguras para a transferência de arquivos, como <citerefentry><refentrytitle>sftp</refentrytitle><manvolnum>1</manvolnum></citerefentry> ou <citerefentry><refentrytitle>scp</refentrytitle><manvolnum>1</manvolnum></citerefentry>, que apresentam autenticação e transferência de dados através de conexões criptografadas.</para>

	<para>Para as situações em que o <acronym>FTP</acronym> é necessário, o <application>PF</application> fornece o redirecionamento do tráfego <acronym>FTP</acronym> para um pequeno programa proxy chamado <citerefentry><refentrytitle>ftp-proxy</refentrytitle><manvolnum>8</manvolnum></citerefentry>, que está incluído no sistema base do FreeBSD. O papel do proxy é inserir dinamicamente e excluir regras no conjunto de regras, usando um conjunto de âncoras, para lidar corretamente com o tráfego de <acronym>FTP</acronym>.</para>

	<para>Para habilitar o proxy <acronym>FTP</acronym>, adicione esta linha ao <filename>/etc/rc.conf</filename>:</para>

	<programlisting>ftpproxy_enable="YES"</programlisting>

	<para>Em seguida, inicie o proxy executando <command>service ftp-proxy start</command>.</para>

	<para>Para uma configuração básica, três elementos precisam ser adicionados ao arquivo <filename>/etc/pf.conf</filename>. Primeiro, as âncoras que o proxy usará para inserir as regras que ele gera para as sessões de <acronym>FTP</acronym>:</para>

	<programlisting>nat-anchor "ftp-proxy/*"
rdr-anchor "ftp-proxy/*"</programlisting>

	<para>Em segundo, é necessária uma regra de liberação para permitir o tráfego de <acronym>FTP</acronym> para o proxy.</para>

	<para>Terceiro, as regras de redirecionamento e <acronym>NAT</acronym> precisam ser definidas antes das regras de filtragem. Insira esta regra <literal>rdr</literal> imediatamente após a regra <literal>nat</literal>:</para>

	<programlisting>rdr pass on $int_if proto tcp from any to any port ftp -&gt; 127.0.0.1 port 8021</programlisting>

	<para>Finalmente, permita que o tráfego redirecionado passe:</para>

	<programlisting>pass out proto tcp from $proxy to any port ftp</programlisting>

	<para>onde <literal>$proxy</literal> se expande para o endereço ao qual o daemon proxy está vinculado.</para>

	<para>Salve o arquivo <filename>/etc/pf.conf</filename>, carregue as novas regras e verifique a partir de um cliente se as conexões <acronym>FTP</acronym> estão funcionando:</para>

	<screen><prompt>#</prompt> <userinput>pfctl -f /etc/pf.conf</userinput></screen>

	<para>Este exemplo cobre uma configuração básica em que os clientes na rede local precisam entrar em contato com servidores <acronym>FTP</acronym> em outro lugar. Essa configuração básica deve funcionar bem com a maioria das combinações de clientes e servidores <acronym>FTP</acronym>. Como mostrado em <citerefentry><refentrytitle>ftp-proxy</refentrytitle><manvolnum>8</manvolnum></citerefentry>, o comportamento do proxy pode ser alterado de várias maneiras adicionando opções na linha <literal>ftpproxy_flags=</literal>. Alguns clientes ou servidores podem ter peculiaridades específicas que devem ser compensadas na configuração ou pode ser necessário integrar o proxy de maneiras específicas, como atribuir tráfego <acronym>FTP</acronym> a uma fila específica.</para>

	<para>Para formas de executar um servidor <acronym>FTP</acronym> protegido por <application>PF</application> e <citerefentry><refentrytitle>ftp-proxy</refentrytitle><manvolnum>8</manvolnum></citerefentry>, configure um <command>ftp-proxy</command> separado em modo reverso, usando <option>-R</option>, em uma porta separada com sua própria regra de redirecionamento de passagem.</para>
      </sect3>

      <sect3 xml:id="pftut-icmp">
	<title>Gerenciando <acronym>ICMP</acronym></title>

	<para>Muitas das ferramentas usadas para depurar ou solucionar problemas de uma rede <acronym>TCP/IP</acronym> dependem do Internet Control Message Protocol (<acronym>ICMP</acronym>), o qual foi projetado especificamente para depuração.</para>

	<para>O protocolo <acronym>ICMP</acronym> envia e recebe <emphasis>mensagens de controle</emphasis> entre hosts e gateways, principalmente para fornecer feedback a um remetente sobre quaisquer condições incomuns ou difíceis na rota para o host de destino. Os roteadores usam <acronym>ICMP</acronym> para negociar tamanhos de pacote e outros parâmetros de transmissão em um processo geralmente chamado de descoberta de <emphasis>path <acronym>MTU</acronym></emphasis>.</para>

	<para>Do ponto de vista do firewall, algumas mensagens de controle <acronym>ICMP</acronym> são vulneráveis a vetores de ataque conhecidos. Além disso, deixar todo o tráfego de diagnóstico passar incondicionalmente torna a depuração mais fácil, mas também torna mais fácil para os outros extraírem informações sobre a rede. Por esses motivos, a regra a seguir pode não ser a ideal:</para>

	<programlisting>pass inet proto icmp from any to any</programlisting>

	<para>Uma solução é permitir todo o tráfego de <acronym>ICMP</acronym> originado na rede local e bloquear as chamadas provenientes de fora da rede:</para>

	<programlisting>pass inet proto icmp from $localnet to any keep state
pass inet proto icmp from any to $ext_if keep state</programlisting>

	<para>Opções adicionais estão disponíveis, o que demonstra algumas das flexibilidades do <application>PF</application>. Por exemplo, em vez de liberar todas as mensagens <acronym>ICMP</acronym>, pode-se especificar as mensagens usadas pelo <citerefentry><refentrytitle>ping</refentrytitle><manvolnum>8</manvolnum></citerefentry> e <citerefentry><refentrytitle>traceroute</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Comece definindo uma macro para esse tipo de mensagem:</para>

	<programlisting>icmp_types = "echoreq"</programlisting>

	<para>e uma regra que usa a macro:</para>

	<programlisting>pass inet proto icmp all icmp-type $icmp_types keep state</programlisting>

	<para>Se outros tipos de pacotes <acronym>ICMP</acronym> forem necessários, expanda <literal>icmp_types</literal> para uma lista desses tipos de pacotes. Digite <command>more /usr/src/sbin/pfctl/pfctl_parser.c</command> para ver a lista de tipos de mensagem <acronym>ICMP</acronym> suportados pelo <application>PF</application>. Consulte <link xlink:href="http://www.iana.org/assignments/icmp-parameters/icmp-parameters.xhtml">http://www.iana.org/assignments/icmp-parameters/icmp-parameters.xhtml</link> para uma explicação de cada tipo de mensagem.</para>

	<para>Como o Unix <command>traceroute</command> usa <acronym>UDP</acronym> por padrão, outra regra é necessária para permitir o comando <command>traceroute</command> do Unix:</para>

	<programlisting># allow out the default range for traceroute(8):
pass out on $ext_if inet proto udp from any to any port 33433 &gt;&lt; 33626 keep state</programlisting>

	<para>Como o <command>TRACERT.EXE</command> em sistemas Microsoft Windows usa <acronym>ICMP</acronym> echo request messages, somente a primeira regra é necessária para permitir rastreamentos de rede desses sistemas. O Unix <command>traceroute</command> também pode ser instruído a usar outros protocolos e usará <acronym>ICMP</acronym> echo request messages se <option>-I</option> for usado. Verifique a página de manual <citerefentry><refentrytitle>traceroute</refentrytitle><manvolnum>8</manvolnum></citerefentry> para detalhes.</para>

	<sect4 xml:id="pftut-pathmtudisc">
	  <title>Descoberta de Path <acronym>MTU</acronym></title>

	  <para>Os protocolos de Internet são projetados para serem independentes do dispositivo, e uma consequência da independência do dispositivo é que o tamanho ideal do pacote para uma determinada conexão nem sempre pode ser previsto com segurança. A principal restrição no tamanho do pacote é a <firstterm>Maximum Transmission Unit</firstterm> (<acronym>MTU</acronym>), que define o limite superior do tamanho do pacote para uma interface. Digite <command>ifconfig</command> para exibir os <acronym>MTU</acronym>s para as interfaces de rede do sistema.</para>

	  <para>O <acronym>TCP/IP</acronym> usa um processo conhecido como descoberta de path <acronym>MTU</acronym> para determinar o tamanho correto do pacote para uma conexão. Este processo envia pacotes de tamanhos variados com o conjunto de flag <quote>Não fragmentar</quote>, esperando um pacote de retorno <acronym>ICMP</acronym> de <quote>tipo 3, código 4</quote> quando o limite for alcançado. O tipo 3 significa <quote>destino inacessível</quote>, e o código 4 é uma abreviação para <quote>fragmentação necessária, mas a flag para não fragmentar está definida</quote>. Para permitir que a descoberta de path MTU suporte conexões com outros <acronym>MTU</acronym>s, adicione o tipo <literal>destination unreachable</literal> à macro <literal>icmp_types</literal>:</para>

	  <programlisting>icmp_types = "{ echoreq, unreach }"</programlisting>

	  <para>Como a regra de liberação já usa essa macro, ela não precisa ser modificada para suportar o novo tipo de <acronym>ICMP</acronym>:</para>

	  <programlisting>pass inet proto icmp all icmp-type $icmp_types keep state</programlisting>

	  <para>O <application>PF</application> permite filtrar todas as variações dos tipos e códigos de <acronym>ICMP</acronym>. A lista de tipos e códigos possíveis está documentada em <citerefentry><refentrytitle>icmp</refentrytitle><manvolnum>4</manvolnum></citerefentry> and <citerefentry><refentrytitle>icmp6</refentrytitle><manvolnum>4</manvolnum></citerefentry>.</para>
	</sect4>
      </sect3>

      <sect3 xml:id="pftut-tables">
	<title>Usando Tabelas</title>

	<para>Alguns tipos de dados são relevantes para filtragem e redirecionamento em um determinado momento, mas sua definição é muito longa para ser incluída no arquivo do conjunto de regras. O <application>PF</application> suporta o uso de tabelas, que são listas definidas que podem ser manipuladas sem a necessidade de recarregar todo o conjunto de regras e que podem fornecer pesquisas rápidas. Nomes de tabelas são sempre colocados dentro de <literal>&lt; &gt;</literal>, assim:</para>

	<programlisting>table &lt;clients&gt; { 192.168.2.0/24, !192.168.2.5 }</programlisting>

	<para>Neste exemplo, a rede <literal>192.168.2.0/24</literal> faz parte da tabela, exceto pelo endereço <literal>192.168.2.5</literal>, que é excluído pelo operador <literal>!</literal>. Também é possível carregar tabelas de arquivos onde cada entrada está em uma linha separada. como neste exemplo <filename>/etc/clients</filename>:</para>

	<programlisting>192.168.2.0/24
!192.168.2.5</programlisting>

	<para>Para se referir ao arquivo, defina a tabela da seguinte forma:</para>

	<programlisting>table &lt;clients&gt; persist file "/etc/clients"</programlisting>

	<para>Depois que a tabela é definida, ela pode ser referenciada por uma regra:</para>

	<programlisting>pass inet proto tcp from &lt;clients&gt; to any port $client_out flags S/SA keep state</programlisting>

	<para>O conteúdo de uma tabela pode ser manipulado ao vivo, usando <command>pfctl</command>. Este exemplo adiciona outra rede a tabela:</para>

	<screen><prompt>#</prompt> <userinput>pfctl -t clients -T add 192.168.1.0/16</userinput></screen>

	<para>Observe que quaisquer alterações feitas dessa maneira terão efeito imediato, tornando-as ideais para testes, mas não sobreviverão a uma falha de energia ou reinicialização. Para tornar as alterações permanentes, modifique a definição da tabela no conjunto de regras ou edite o arquivo a que a tabela se refere. É possível manter a cópia em disco da tabela usando uma tarefa <citerefentry><refentrytitle>cron</refentrytitle><manvolnum>8</manvolnum></citerefentry> que copia o conteúdo da tabela para o disco em intervalos de tempo, usando um comando como <command>pfctl -t clients -T show &gt;/etc/clients</command>. Alternativamente, o <filename>/etc/clients</filename> pode ser atualizado com o conteúdo da tabela na memória:</para>

	<screen><prompt>#</prompt> <userinput>pfctl -t clients -T replace -f /etc/clients</userinput></screen>
      </sect3>

      <sect3 xml:id="pftut-overload">
	<title>Usando Tabelas de Sobrecarga para Proteger o <acronym>SSH</acronym></title>

	<para>Aqueles que executam o <acronym>SSH</acronym> em uma interface externa provavelmente já viram algo assim nos logs de autenticação:</para>

	<programlisting>Sep 26 03:12:34 skapet sshd[25771]: Failed password for root from 200.72.41.31 port 40992 ssh2
Sep 26 03:12:34 skapet sshd[5279]: Failed password for root from 200.72.41.31 port 40992 ssh2
Sep 26 03:12:35 skapet sshd[5279]: Received disconnect from 200.72.41.31: 11: Bye Bye
Sep 26 03:12:44 skapet sshd[29635]: Invalid user admin from 200.72.41.31
Sep 26 03:12:44 skapet sshd[24703]: input_userauth_request: invalid user admin
Sep 26 03:12:44 skapet sshd[24703]: Failed password for invalid user admin from 200.72.41.31 port 41484 ssh2</programlisting>

	<para>Isso indica um ataque de força bruta em que alguém ou algum programa está tentando descobrir o nome de usuário e senha que os permitirá entrar no sistema.</para>

	<para>Se o acesso externo ao <acronym>SSH</acronym> for necessário para usuários legítimos, a alteração da porta padrão usada pelo <acronym>SSH</acronym> pode oferecer alguma proteção. No entanto, o <application>PF</application> fornece uma solução mais elegante. As regras de liberação podem conter limites sobre o que os hosts de conexão podem fazer e os violadores podem ser banidos para uma tabela de endereços aos quais é negado algum ou todo o acesso. É até possível descartar todas as conexões existentes de máquinas que excedem os limites.</para>

	<para>Para configurar isso, crie esta tabela na seção de tabelas do conjunto de regras:</para>

	<programlisting>table &lt;bruteforce&gt; persist</programlisting>

	<para>Então, em algum lugar no início do conjunto de regras, adicione regras para bloquear o acesso bruto, permitindo acesso legítimo:</para>

	<programlisting>block quick from &lt;bruteforce&gt;
pass inet proto tcp from any to $localnet port $tcp_services \
    flags S/SA keep state \
    (max-src-conn <replaceable>100</replaceable>, max-src-conn-rate <replaceable>15/5</replaceable>, \
    overload &lt;bruteforce&gt; flush global)</programlisting>

	<para>A parte entre parênteses define os limites e os valores devem ser alterados para atender aos requisitos locais. Isso pode ser lido da \seguinte forma:</para>

	<para><literal>max-src-conn</literal> é o número de conexões simultâneas permitidas de um host.</para>

	<para><literal>max-src-conn-rate</literal> é a taxa de novas conexões permitidas de qualquer host único (<replaceable>15</replaceable>) por número de segundos (<replaceable>5</replaceable>).</para>

	<para><literal>overload &lt;bruteforce&gt;</literal> significa que qualquer host que excede esses limites obtém seu endereço adicionado à tabela <literal>bruteforce</literal>. O conjunto de regras bloqueia todo o tráfego de endereços na tabela <literal>bruteforce</literal>.</para>

	<para>Finalmente, <literal>flush global</literal> diz que quando um host atinge o limite, todo (<literal>global</literal>) das conexões desse host será finalizado (<literal>flush</literal>).</para>

	<note>
	  <para>Estas regras <emphasis>não</emphasis> irão bloquear bruteforcers lentos, como descrito em <link xlink:href="http://home.nuug.no/~peter/hailmary2013/">http://home.nuug.no/~peter/hailmary2013/</link>.</para>
	</note>

	<para>Este conjunto de regras de exemplo é projetado principalmente como uma ilustração. Por exemplo, se um número grande de conexões em geral é desejado, mas o desejo é ser mais restritivo quando se trata de <application>ssh</application>, complemente a regra acima com algo como o abaixo, no início do conjunto de regras:</para>

	<programlisting>pass quick proto { tcp, udp } from any to any port ssh \
    flags S/SA keep state \
    (max-src-conn 15, max-src-conn-rate 5/3, \
    overload &lt;bruteforce&gt; flush global)</programlisting>

	<note>
	  <title>Pode Não ser Necessário Bloquear Todos os Overloaders</title>

	  <para>É importante notar que o mecanismo de sobrecarga é uma técnica geral que não se aplica exclusivamente ao <acronym>SSH</acronym>, e nem sempre é ideal bloquear totalmente todo o tráfego dos infratores.</para>

	  <para>Por exemplo, uma regra de sobrecarga pode ser usada para proteger um serviço de email ou um serviço Web e a tabela de sobrecarga pode ser usada em uma regra para atribuir infratores a uma fila com uma alocação de largura de banda mínima ou redirecionar para uma página Web específica.</para>
	</note>

	<para>Com o tempo, as tabelas serão preenchidas por regras de sobrecarga e seu tamanho crescerá incrementalmente, ocupando mais memória. Às vezes, um endereço de <acronym>IP</acronym> que é bloqueado é atribuído dinamicamente, que já foi atribuído a um host que tem um motivo legítimo para se comunicar com hosts na rede local.</para>

	<para>Para situações como essas, o <application>pfctl</application> fornece a capacidade de expirar as entradas da tabela. Por exemplo, este comando removerá entradas de tabela <literal>&lt;bruteforce&gt;</literal> que não foram referenciadas por <literal>86400</literal> segundos:</para>

	<screen><prompt>#</prompt> <userinput>pfctl -t bruteforce -T expire 86400</userinput></screen>

	<para>Funcionalidade semelhante é fornecida por <package>security/expiretable</package>, que remove entradas de tabela que não foram acessadas por um período de tempo especificado.</para>

	<para>Uma vez instalado, o <application>expiretable</application> pode ser executado para remover entradas de tabela <literal>&lt;bruteforce&gt;</literal> mais antigas que uma tempo especifico. Este exemplo remove todas as entradas com mais de 24 horas:</para>

	<programlisting>/usr/local/sbin/expiretable -v -d -t 24h bruteforce</programlisting>
      </sect3>

      <sect3 xml:id="pftut-spamd">
	<title>Protegendo Contra <acronym>SPAM</acronym></title>

	<para>Não deve ser confundido com o daemon <application>spamd</application> que vem junto com <application>spamassassin</application>, <package>mail/spamd</package> pode ser configurado com o <application>PF</application> para fornecer uma defesa externa contra <acronym>SPAM</acronym>. Esse <application>spamd</application> conecta-se à configuração do <application>PF</application> usando um conjunto de redirecionamentos.</para>

	<para>Os spammers tendem a enviar um grande número de mensagens, e o <acronym>SPAM</acronym> é enviado principalmente de algumas redes amigáveis de spammers e um grande número de máquinas sequestradas, sendo que ambas são reportadas a <firstterm>blacklists</firstterm> bem rápido.</para>

	<para>Quando uma conexão <acronym>SMTP</acronym> de um endereço que está em uma blacklist é recebido, o <application>spamd</application> apresenta seu banner e imediatamente muda para um modo em que ele responde o trágefo <acronym>SMTP</acronym> um byte de cada vez. Esta técnica, que pretende desperdiçar tanto tempo quanto possível do spammer, é chamada de <firstterm>tarpitting</firstterm>. A implementação específica que usa respostas de um byte <acronym>SMTP</acronym> é muitas vezes referenciada como <firstterm>stuttering</firstterm>.</para>

	<para>Este exemplo demonstra o procedimento básico para configurar o <application>spamd</application> com blacklists atualizadas automaticamente. Consulte as páginas de manual que são instaladas com o <package>mail/spamd</package> para mais informações.</para>

	<procedure>
	  <title>Configurando o <application>spamd</application></title>

	  <step>
	    <para>Instale o pacote ou port <package>mail/spamd</package>. Para usar os recursos de greylist do <application>spamd</application>, <citerefentry><refentrytitle>fdescfs</refentrytitle><manvolnum>5</manvolnum></citerefentry> deve ser montado em <filename>/dev/fd</filename>. Adicione a seguinte linha ao arquivo <filename>/etc/fstab</filename>:</para>

	    <programlisting> fdescfs /dev/fd fdescfs rw 0 0</programlisting>

	    <para>Em seguida, monte o sistema de arquivos:</para>

	    <programlisting><prompt>#</prompt> <userinput>mount fdescfs</userinput></programlisting>
	  </step>

	  <step>
	    <para>Em seguida, edite o conjunto de regras do <application>PF</application> para incluir:</para>

	    <programlisting>table &lt;spamd&gt; persist
table &lt;spamd-white&gt; persist
rdr pass on $ext_if inet proto tcp from &lt;spamd&gt; to \
    { $ext_if, $localnet } port smtp -&gt; 127.0.0.1 port 8025
rdr pass on $ext_if inet proto tcp from !&lt;spamd-white&gt; to \
    { $ext_if, $localnet } port smtp -&gt; 127.0.0.1 port 8025</programlisting>

	    <para>As duas tabelas <literal>&lt;spamd&gt;</literal> e <literal>&lt;spamd-white&gt;</literal> são essenciais. O trafego <acronym>SMTP</acronym> de um endereço listado em <literal>&lt;spamd&gt;</literal> mas não em <literal>&lt;spamd-white&gt;</literal> é redirecionado para o daemon <application>spamd</application> ouvindo a porta 8025.</para>
	  </step>

	  <step>
	    <para>O próximo passo é configurar o <application>spamd</application> no arquivo <filename>/usr/local/etc/spamd.conf</filename> e adicionar alguns parâmetros no arquivo <filename>rc.conf</filename>.</para>

	    <para>A instalação do <package>mail/spamd</package> inclui um arquivo de configuração de exemplo (<filename>/usr/local/etc/spamd.conf.sample</filename>) e uma página de manual para o <filename>spamd.conf</filename>. Refira-se a estes para opções adicionais de configuração além daquelas mostradas neste exemplo.</para>

	    <para>Uma das primeiras linhas no arquivo de configuração que não começa com um sinal de comentário <literal>#</literal> contém o bloco que define a lista <literal>all</literal>, que especifica as listas a serem usadas:</para>

	    <programlisting>all:\
    :traplist:whitelist:</programlisting>

	    <para>Esta entrada adiciona as blacklists desejadas, separadas por dois pontos (<literal>:</literal>). Para usar uma whitelist para subtrair endereços de uma blacklist, adicione o nome da whitelist <emphasis>imediatamente</emphasis> após o nome dessa blacklist. Por exemplo: <literal>:blacklist:whitelist:</literal>.</para>

	    <para>Isto é seguido pela definição da blacklist especificada:</para>

	    <programlisting>traplist:\
    :black:\
    :msg="SPAM. Your address %A has sent spam within the last 24 hours":\
    :method=http:\
    :file=www.openbsd.org/spamd/traplist.gz</programlisting>

	    <para>onde a primeira linha é o nome da blacklist e a segunda linha especifica o tipo da lista. O campo <literal>msg</literal> contém a mensagem a ser exibida aos remetentes da blacklist durante a comunicação <acronym>SMTP</acronym>. O campo <literal>method</literal> especifica como o <application>spamd-setup</application> busca os dados da lista; os métodos suportados são <literal>http</literal>, <literal>ftp</literal>, de um <literal>arquivo</literal> em um sistema de arquivos montado e via <literal>exec</literal> de um programa externo. Finalmente, o campo <literal>file</literal> especifica o nome do arquivo que o <application>spamd</application> espera receber.</para>

	    <para>A definição da whitelist especificada é semelhante, mas omite o campo <literal>msg</literal> porque uma mensagem não é necessária:</para>

	    <programlisting>whitelist:\
    :white:\
    :method=file:\
    :file=/var/mail/whitelist.txt</programlisting>

	    <tip>
	      <title>Escolha Fontes de Dados com Cuidado</title>

	      <para>Usar todas as blacklists do arquivo de exemplo <filename>spamd.conf</filename> irá colocar na blacklist grandes blocos da Internet. Os administradores precisam editar o arquivo para criar uma configuração ideal que use fontes de dados aplicáveis e, quando necessário, use listas personalizadas.</para>
	    </tip>

	    <para>Em seguida, adicione esta entrada ao arquivo <filename>/etc/rc.conf</filename>. Flags adicionais são descritas na página  de manual especificada pelo comentário:</para>

	    <programlisting>spamd_flags="-v" # use "" and see spamd-setup(8) for flags</programlisting>

	    <para>Quando terminar, recarregue o conjunto de regras, inicio o <application>spamd</application> digitando <command>service obspamd start</command>, e complete a configuração usando <command>spamd-setup</command>. Finalemente, crie uma tarefa <citerefentry><refentrytitle>cron</refentrytitle><manvolnum>8</manvolnum></citerefentry> que chame <command>spamd-setup</command> para atualizar as tabelas razoáveis.</para>
	  </step>
	</procedure>

	<para>Em um gateway típico na frente de um servidor de email, os hosts logo começam a ficar presos dentro de segundos ou alguns minutos.</para>

	<para><application>PF</application> também suporta <firstterm>greylist</firstterm>, que rejeita temporariamente mensagens de hosts desconhecidos com códigos <replaceable>45n</replaceable>. Conexões de hosts que estão na greylist e que tentam novamente dentro de um tempo razoável de tempo são liberados. O tráfego de remetentes que estão configurados para se comportarem dentro dos limites estabelecidos pela RFC 1123 e pela RFC 2821 é imediatamente permitido.</para>

	<para>Mais informações sobre técnicas de greylist podem ser encontradas no site <link xlink:href="http://www.greylisting.org/">greylisting.org</link>. A coisa mais surpreendente sobre greylist, além de sua simplicidade, é que ainda funciona. Os spammers e os criadores de malware têm sido muito lentos para se adaptar, a fim de contornar essa técnica.</para>

	<para>O procedimento básico para configurar o greylist é o seguinte:</para>

	<procedure>
	  <title>Configurando Greylist</title>

	  <step>
	    <para>Certifique-se de que <citerefentry><refentrytitle>fdescfs</refentrytitle><manvolnum>5</manvolnum></citerefentry> esteja montado conforme descrito na Etapa 1 do Procedimento anterior.</para>
	  </step>

	  <step>
	    <para>Para executar <application>spamd</application> no modo greylist, adicione esta linha ao <filename>/etc/rc.conf</filename>:</para>

	    <programlisting>spamd_grey="YES"  # use spamd greylisting if YES</programlisting>

	    <para>Consulte a página de manual do <application>spamd</application> para obter descrições de parâmetros relacionados adicionais.</para>
	  </step>

	  <step>
	    <para>Para concluir a configuração da greylist:</para>

	    <programlisting><prompt>#</prompt> <userinput>service obspamd restart</userinput>
<prompt>#</prompt> <userinput>service obspamlogd start</userinput></programlisting>
	  </step>
	</procedure>

	<para>Nos bastidores, a ferramenta de banco de dados <application>spamdb</application> e o atualizador de whitelist <application>spamlogd</application> executam funções essenciais para o recurso de greylist. O <application>spamdb</application> é a interface principal do administrador para gerenciar as greylists, blacklists e whitelists por meio do conteúdo do banco de dados <filename>/var/db/spamdb</filename>.</para>
      </sect3>

      <sect3 xml:id="pftut-hygiene">
	<title>Higiene de Rede</title>

	<para>Esta seção descreve como o <literal>block-policy</literal>, <literal>scrub</literal>, e <literal>antispoof</literal> pode ser usado para fazer o conjunto de regras se comportar corretamente.</para>

	<para>O <literal>block-policy</literal> é uma opção que pode ser definida na parte de <literal>opções</literal> do conjunto de regras, que precede as regras de redirecionamento e filtragem. Essa opção determina qual feedback, se houver, que o <application>PF</application> envia para hosts que são bloqueados por uma regra. A opção tem dois valores possíveis: <literal>drop</literal> descarta pacotes bloqueados sem feedback, e <literal>return</literal> retorna um código de status como <computeroutput>Connection refused</computeroutput>.</para>

	<para>Se não definido, a política padrão é <literal>drop</literal>. Para alterar o <literal>block-policy</literal>, especifique o valor desejado:</para>

	<programlisting>set block-policy return</programlisting>

	<para>No <application>PF</application>, <literal>scrub</literal> é uma palavra-chave que permite a normalização do pacote de rede. Esse processo remonta pacotes fragmentados e descarta pacotes TCP que possuem combinações de sinalizadores inválidos. Ativar <literal>scrub</literal> fornece uma medida de proteção contra certos tipos de ataques com base no manuseio incorreto de fragmentos de pacotes. Várias opções estão disponíveis, mas a forma mais simples é adequada para a maioria das configurações:</para>

	<programlisting>scrub in all</programlisting>

	<para>Alguns serviços, como o <acronym>NFS</acronym>, exigem opções específicas de manipulação de fragmentos. Consulte <link xlink:href="https://home.nuug.no/~peter/pf/en/scrub.html">https://home.nuug.no/~peter/pf/en/scrub.html</link> para mais informações.</para>

	<para>Este exemplo remonta fragmentos, limpa o bit <quote>não fragmentar</quote> e define o tamanho máximo do segmento para 1440 bytes:</para>

	<programlisting>scrub in all fragment reassemble no-df max-mss 1440</programlisting>

	<para>O mecanismo <literal>antispoof</literal> protege contra a atividade de endereços <acronym>IP</acronym> falsos ou forjados, principalmente bloqueando pacotes que aparecem em interfaces e em direções que logicamente não são possíveis.</para>

	<para>Essas regras eliminam tráfego falsificado do resto do mundo, bem como qualquer pacote falsificado originado na rede local:</para>

	<programlisting>antispoof for $ext_if
antispoof for $int_if</programlisting>
      </sect3>

      <sect3 xml:id="pftut-unrouteables">
	<title>Manipulando Endereços Não-Roteados</title>

	<para>Mesmo com um gateway configurado adequadamente para lidar com a tradução de endereços de rede, pode ser necessário compensar as configurações incorretas de outras pessoas. Uma configuração incorreta comum é permitir o tráfego com endereços não roteáveis para a Internet. Como o tráfego de endereços não roteados pode desempenhar um papel em várias técnicas de ataque de <acronym>DoS</acronym>, considere bloquear explicitamente o tráfego de endereços não roteáveis de entrar na rede por meio da interface externa.</para>

	<para>Neste exemplo, uma macro contendo endereços não roteáveis é definida e usada em regras de bloqueio. O tráfego de origem e destino para esses endereços é silenciosamente descartado na interface externa do gateway.</para>

	<programlisting>martians = "{ 127.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, \
	      10.0.0.0/8, 169.254.0.0/16, 192.0.2.0/24, \
	      0.0.0.0/8, 240.0.0.0/4 }"

block drop in quick on $ext_if from $martians to any
block drop out quick on $ext_if from any to $martians</programlisting>
      </sect3>
    </sect2>

    <sect2>
      <title>Ativando o <application>ALTQ</application></title>

      <para>No FreeBSD, o <application>ALTQ</application> pode ser usado com <application>PF</application> para fornecer Qualidade de Serviço (<acronym>QOS</acronym>). Depois que o <application>ALTQ</application> é ativado, as filas podem ser definidas no conjunto de regras que determina a prioridade de processamento dos pacotes de saída.</para>

      <para>Antes de ativar o <application>ALTQ</application>, consulte <citerefentry><refentrytitle>altq</refentrytitle><manvolnum>4</manvolnum></citerefentry> para determinar se os drivers das placas de rede instaladas no sistema suportam isto.</para>

      <para><application>ALTQ</application> não está disponível como um módulo de kernel carregável. Se as interfaces do sistema suportarem <application>ALTQ</application>, crie um kernel personalizado usando as instruções em <xref linkend="kernelconfig"/>. As seguintes opções do kernel estão disponíveis. O primeira é necessária para ativar o <application>ALTQ</application>. Pelo menos uma das outras opções é necessária para especificar o algoritmo do scheduler de enfileiramento:</para>

      <programlisting>options         ALTQ
options         ALTQ_CBQ        # Class Based Queuing (CBQ)
options         ALTQ_RED        # Random Early Detection (RED)
options         ALTQ_RIO        # RED In/Out
options         ALTQ_HFSC       # Hierarchical Packet Scheduler (HFSC)
options         ALTQ_PRIQ       # Priority Queuing (PRIQ)</programlisting>

      <para>Os seguintes algoritmos de agendamento estão disponíveis:</para>

      <variablelist>
	<varlistentry>
	  <term>CBQ</term>
	  <listitem>
	    <para>Class Based Queuing (<acronym>CBQ</acronym>) é usado para dividir a largura de banda de uma conexão em diferentes classes ou filas para priorizar o tráfego com base nas regras de filtragem.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>RED</term>
	  <listitem>
	    <para>Random Early Detection (<acronym>RED</acronym>) é usado para evitar o congestionamento da rede, medindo o comprimento da fila e comparando-a com os limites mínimo e máximo da fila. Quando a fila está acima do máximo, todos os novos pacotes são descartados aleatoriamente.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>RIO</term>
	  <listitem>
	    <para>No modo Random Early Detection In and Out (<acronym>RIO</acronym>), <acronym>RED</acronym> mantém vários comprimentos médios de fila e vários valores limite, um para cada nível <acronym>QOS</acronym>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>HFSC</term>
	  <listitem>
	    <para>Hierarchical Fair Service Curve Packet Scheduler (<acronym>HFSC</acronym>) é descrito em <uri xlink:href="http://www-2.cs.cmu.edu/~hzhang/HFSC/main.html">http://www-2.cs.cmu.edu/~hzhang/HFSC/main.html</uri>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>PRIQ</term>
	  <listitem>
	    <para>Priority Queuing (<acronym>PRIQ</acronym>) sempre passa primeiro o tráfego que está em uma fila mais alta.</para>
	  </listitem>
	</varlistentry>
      </variablelist>

      <para>Maiores informações sobre os algoritmos de agendamento e os conjuntos de regras de exemplo estão disponíveis no <uri xlink:href="https://web.archive.org/web/20151109213426/http://www.openbsd.org/faq/pf/queueing.html">arquivo web do OpenBSD</uri>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="firewalls-ipfw">
    <title><application>IPFW</application></title>

    <indexterm><primary>firewall</primary> <secondary>IPFW</secondary></indexterm>

    <para>O <application>IPFW</application> é um firewall stateful para o FreeBSD, que suporta tanto o <acronym>IPv4</acronym> como o <acronym>IPv6</acronym>. Ele é composto de vários componentes: o processador de regras de filtro de firewall do kernel e seu recurso integrado de contabilidade de pacotes, o recurso de registro em log, <acronym>NAT</acronym>, o <citerefentry><refentrytitle>dummynet</refentrytitle><manvolnum>4</manvolnum></citerefentry> traffic shaper, um recurso de forward, um recurso de bridge e uma habilidade ipstealth.</para>

    <para>O FreeBSD fornece um conjunto de regras de exemplo em <filename>/etc/rc.firewall</filename> que define vários tipos de firewall para cenários comuns para ajudar usuários iniciantes a gerar um conjunto de regras apropriado. O <application>IPFW</application> fornece uma poderosa sintaxe que os usuários avançados podem usar para criar conjuntos de regras personalizados que atendam aos requisitos de segurança de um determinado ambiente.</para>

    <para>Esta seção descreve como ativar o <application>IPFW</application>, fornece uma visão geral de sua sintaxe de regra e demonstra vários conjuntos de regras para cenários comuns de configuração.</para>

    <sect2 xml:id="firewalls-ipfw-enable">
      <title>Ativando o <application>IPFW</application></title>

      <indexterm><primary><application>IPFW</application></primary> <secondary>enabling</secondary></indexterm>

      <para>O <application>IPFW</application> está incluído na instalação base do FreeBSD como um módulo carregável do kernel, o que significa que um kernel customizado não é necessário para ativar o <application>IPFW</application>.</para>

      <para>Para aqueles usuários que desejam compilar estaticamente o suporte ao <application>IPFW</application> em um kernel personalizado, veja <xref linkend="firewalls-ipfw-kernelconfig"/>.</para>

      <para>Para configurar o sistema para ativar o <application>IPFW</application> no momento da inicialização, adicione <literal>firewall_enable="YES"</literal> ao <filename>/etc/rc.conf</filename>:</para>

      <screen><prompt>#</prompt> <userinput>sysrc firewall_enable="YES"</userinput></screen>

      <para>Para usar um dos tipos de firewall padrão fornecidos pelo FreeBSD, adicione outra linha que especifique o tipo:</para>

      <screen><prompt>#</prompt> <userinput>sysrc firewall_type="open"</userinput></screen>

      <para>Os tipos disponíveis são:</para>

      <itemizedlist>
	<listitem>
	  <para><literal>open</literal>: passa todo o tráfego.</para>
	</listitem>
	<listitem>
	  <para><literal>client</literal>: protege apenas esta máquina.</para>
	</listitem>
	<listitem>
	  <para><literal>simple</literal>: protege toda a rede.</para>
	</listitem>
	<listitem>
	  <para><literal>closed</literal>: desativa completamente o tráfego IP, exceto na interface de loopback.</para>
	</listitem>
	<listitem>
	  <para><literal>workstation</literal>: protege apenas esta máquina usando regras stateful.</para>
	</listitem>
	<listitem>
	  <para><literal>UNKNOWN</literal>: desativa o carregamento de regras de firewall.</para>
	</listitem>
	<listitem>
	  <para><filename><replaceable>filename</replaceable></filename>: caminho completo do arquivo que contém o conjunto de regras do firewall.</para>
	</listitem>
      </itemizedlist>

      <para>Se <literal>firewall_type</literal> estiver definido como <literal>client</literal> ou <literal>simple</literal>, modifique as regras padrão encontradas em <filename>/etc/rc.firewall</filename> para se adequar a configuração do sistema.</para>

      <para>Observe que o tipo <literal>filename</literal> é usado para carregar um conjunto de regras customizado.</para>

      <para>Uma maneira alternativa de carregar um conjunto de regras personalizado é definir a variável <literal>firewall_script</literal> para o caminho absoluto de um <emphasis>script executável</emphasis> que inclui comandos <application>IPFW</application>. Os exemplos usados nesta seção assumem que o <literal>firewall_script</literal> está definido como <filename>/etc/ipfw.rules</filename>:</para>

      <screen><prompt>#</prompt> <userinput>sysrc firewall_script="/etc/ipfw.rules"</userinput></screen>

      <para>Para habilitar o registro em log por meio do <citerefentry><refentrytitle>syslogd</refentrytitle><manvolnum>8</manvolnum></citerefentry>, inclua esta linha:</para>

      <screen><prompt>#</prompt> <userinput>sysrc firewall_logging="YES"</userinput></screen>

      <warning>
	<para>Somente regras de firewall com opção de <option>log</option> vão ser registradas. As regras padrão não contém essa opção e deve ser adicionada manualmente. Por isso é avisado que o conjunto de regras padrão é editado para logar. Em adição a isso, rotacionamento de log é desejado se os logs estiverem em um arquivo separado.</para>
      </warning>

      <para>Não existe uma variável em <filename>/etc/rc.conf</filename> para definir os limites de log. Para limitar o número de vezes que uma regra é registrada por tentativa de conexão, especifique o número usando esta linha no <filename>/etc/sysctl.conf</filename>:</para>

      <screen><prompt>#</prompt> <userinput>echo "net.inet.ip.fw.verbose_limit=<replaceable>5</replaceable>" &gt;&gt; /etc/sysctl.conf</userinput></screen>

      <para>Para habilitar o registro através de uma interface dedicada chamada <literal>ipfw0</literal>, adicione esta linha ao <filename>/etc/rc.conf</filename> em vez disso:</para>

      <screen><prompt>#</prompt> <userinput>sysrc firewall_logif="YES"</userinput></screen>

      <para>Em seguida, use o <application>tcpdump</application> para ver o que está sendo registrado:</para>

      <screen><prompt>#</prompt> <userinput>tcpdump -t -n -i ipfw0</userinput></screen>

      <tip>
	<para>Não há sobrecarga devido ao log, a menos que o <application>tcpdump</application> esteja anexado.</para>
      </tip>

      <para>Depois de salvar as edições necessárias, inicie o firewall. Para ativar os limites de log agora, defina também o valor <command>sysctl</command> especificado acima:</para>

      <screen><prompt>#</prompt> <userinput>service ipfw start</userinput>
<prompt>#</prompt> <userinput>sysctl net.inet.ip.fw.verbose_limit=<replaceable>5</replaceable></userinput></screen>
    </sect2>

    <sect2 xml:id="firewalls-ipfw-rules">
      <title>Sintaxe de Regras <application>IPFW</application></title>

      <indexterm><primary><application>IPFW</application></primary> <secondary>rule processing order</secondary></indexterm>

      <para>Quando um pacote entra no firewall <application>IPFW</application>, ele é comparado com a primeira regra no conjunto de regras e avança uma regra por vez, movendo-se de cima para baixo em sequência. Quando o pacote corresponde aos parâmetros de seleção de uma regra, a ação da regra é executada e a pesquisa do conjunto de regras termina para esse pacote. Isto é conhecido como <quote>primeira combinação vence</quote>. Se o pacote não corresponder a nenhuma das regras, ele será pego pela  regra padrão obrigatória <application>IPFW</application> de número 65535, que bloqueia todos os pacotes e os descarta silenciosamente. No entanto, se o pacote corresponder a uma regra que contenha as palavras-chave <literal>count</literal>, <literal>skipto</literal> ou <literal>tee</literal>, a pesquisa continuará. Consulte <citerefentry><refentrytitle>ipfw</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter detalhes sobre como essas palavras-chave afetam o processamento de regras.</para>

      <indexterm><primary><application>IPFW</application></primary> <secondary>rule syntax</secondary></indexterm>

      <para>Ao criar uma regra <application>IPFW</application>, as palavras-chave devem ser escritas na seguinte ordem. Algumas palavras-chave são obrigatórias, enquanto outras são opcionais. As palavras mostradas em maiúsculas representam uma variável e as palavras mostradas em minúsculas devem preceder a variável que a segue. O símbolo <literal>#</literal> é usado para marcar o início de um comentário e pode aparecer no final de uma regra ou em sua própria linha. Linhas em branco são ignoradas.</para>

      <para><replaceable>CMD RULE_NUMBER set SET_NUMBER ACTION log LOG_AMOUNT PROTO from SRC SRC_PORT to DST DST_PORT OPTIONS</replaceable></para>

      <para>Esta seção fornece uma visão geral dessas palavras-chave e suas opções. Não é uma lista exaustiva de todas as opções possíveis. Consulte <citerefentry><refentrytitle>ipfw</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter uma descrição completa da sintaxe de regra que pode ser usada ao criar regras <application>IPFW</application>.</para>

      <variablelist>
	<varlistentry>
	  <term>CMD</term>
	  <listitem>
	    <para>Toda regra deve começar com <parameter>ipfw add</parameter>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>RULE_NUMBER</term>
	  <listitem>
	    <para>Cada regra é associada a um número de <literal>1</literal> até <literal>65534</literal>. O número é usado para indicar a ordem do processamento da regra. Várias regras podem ter o mesmo número e, nesse caso, elas são aplicadas de acordo com a ordem em que foram adicionadas.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>SET_NUMBER</term>
	  <listitem>
	    <para>Cada regra é associada a um número definido de <literal>0</literal> até <literal>31</literal>. Os conjuntos podem ser desativados ou ativados individualmente, possibilitando adicionar ou excluir rapidamente um conjunto de regras. Se um SET_NUMBER não for especificado, a regra será adicionada no conjunto <literal>0</literal>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>ACTION</term>
	  <listitem>
	    <para>Uma regra pode ser associada a uma das ações a seguir. A ação especificada será executada quando o pacote corresponder ao critério de seleção da regra.</para>

	    <para><parameter>allow | accept | pass | permit</parameter>: essas palavras-chave são equivalentes e permitem pacotes que correspondem à regra.</para>

	    <para><parameter>check-state</parameter>: verifica o pacote em relação à tabela de estados dinâmicos. Se uma correspondência for encontrada, execute a ação associada à regra que gerou essa regra dinâmica, caso contrário, vá para a próxima regra. Uma regra <literal>check-state</literal> não possui critério de seleção. Se nenhuma regra <literal>check-state</literal> estiver presente no conjunto de regras, a tabela de regras dinâmicas será verificada na primeira regra <literal>keep-state</literal> ou <literal>limit</literal>.</para>

	    <para><parameter>count</parameter>: atualiza os contadores de todos os pacotes que correspondem à regra. A pesquisa continua com a próxima regra.</para>

	    <para><parameter>deny | drop</parameter>: qualquer das duas palavras descarta silenciosamente os pacotes que correspondem a essa regra.</para>

	    <para>Ações adicionais estão disponíveis. Consulte <citerefentry><refentrytitle>ipfw</refentrytitle><manvolnum>8</manvolnum></citerefentry> para detalhes.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>LOG_AMOUNT</term>
	  <listitem>
	    <para>Quando um pacote corresponde a uma regra com a palavra-chave <literal>log</literal>, uma mensagem será registrada no <citerefentry><refentrytitle>syslogd</refentrytitle><manvolnum>8</manvolnum></citerefentry> com nome <literal>SECURITY</literal>. O registro somente ocorre se o número de pacotes registrados para essa regra específica não exceder um LOG_AMOUNT especificado. Se nenhum LOG_AMOUNT for especificado, o limite será retirado do valor de <varname>net.inet.ip.fw.verbose_limit</varname>. Um valor de zero remove o limite de registro. Quando o limite for atingido, o registro em log poderá ser reativado, limpando o contador de registro ou o contador de pacotes para essa regra, usando <command>ipfw resetlog</command>.</para>

	    <note>
	      <para>O registro é feito depois que todas as outras condições de correspondência de pacote foram atendidas e antes de executar a ação final no pacote. O administrador decide quais regras habilitar o log.</para>
	    </note>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>PROTO</term>
	  <listitem>
	    <para>Este valor opcional pode ser usado para especificar qualquer nome ou número de protocolo encontrado no arquivo <filename>/etc/protocols</filename>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>SRC</term>
	  <listitem>
	    <para>A palavra-chave <literal>from</literal> deve ser seguida pelo endereço de origem ou por uma palavra-chave que represente o endereço de origem. Um endereço pode ser representado por <literal>any</literal>, <literal>me</literal> (qualquer endereço configurado em uma interface neste sistema), <literal>me6</literal>, (qualquer endereço <acronym>IPv6</acronym> configurado em uma interface neste sistema), ou <literal>table</literal> seguido pelo número de uma tabela de consulta que contém uma lista de endereços. Ao especificar um endereço <acronym>IP</acronym>, ele pode ser seguido opcionalmente pela máscara ou pela máscara de sub-rede do <acronym>CIDR</acronym>. Por exemplo, <literal>1.2.3.4/25</literal> ou <literal>1.2.3.4:255.255.255.128</literal>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>SRC_PORT</term>
	  <listitem>
	    <para>Uma porta de origem opcional pode ser especificada usando o número da porta ou um nome de <filename>/etc/services</filename>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>DST</term>
	  <listitem>
	    <para>A palavra-chave <literal>to</literal> deve ser seguida pelo endereço de destino ou por uma palavra-chave que represente o endereço de destino. As mesmas palavras-chave e endereços descritos na seção SRC podem ser usados para descrever o destino.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>DST_PORT</term>
	  <listitem>
	    <para>Uma porta de destino opcional pode ser especificada usando o número da porta ou um nome de <filename>/etc/services</filename>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>OPTIONS</term>
	  <listitem>
	    <para>Várias palavras-chave podem seguir a origem e o destino. Como o nome sugere, OPTIONS são opcionais. As opções comumente usadas incluem <literal>in</literal> ou <literal>out</literal>, que especificam a direção do fluxo de pacotes, <literal>icmptypes</literal> seguido pelo tipo de mensagem <acronym>ICMP</acronym> e <literal>keep-state</literal>.</para>

	    <para>Quando uma regra <parameter>keep-state</parameter> é correspondida, o firewall criará uma regra dinâmica que corresponda ao tráfego bidirecional entre os endereços e portas de origem e destino usando o mesmo protocolo.</para>

	    <para>O recurso de regras dinâmicas é vulnerável ao esgotamento de recursos de um ataque SYN-flood, o que abriria um grande número de regras dinâmicas. Para combater esse tipo de ataque com <application>IPFW</application>, use <literal>limit</literal>. Esta opção limita o número de sessões simultâneas verificando as regras dinâmicas abertas, contando o número de vezes que esta regra e a combinação de endereços <acronym>IP</acronym> ocorreram. Se essa contagem for maior que o valor especificado por <literal>limit</literal>, o pacote será descartado.</para>

	    <para>Dezenas de OPTIONS estão disponíveis. Consulte <citerefentry><refentrytitle>ipfw</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter uma descrição de cada opção disponível.</para>
	  </listitem>
	</varlistentry>
      </variablelist>
    </sect2>

    <sect2>
      <title>Exemplo de Conjunto de Regras</title>

      <para>Esta seção demonstra como criar um exemplo de script de conjunto de regras de firewall stateful chamado <filename>/etc/ipfw.rules</filename>. Neste exemplo, todas as regras de conexão usam <literal>in</literal> ou <literal>out</literal> para esclarecer a direção. Eles também usam <literal>via</literal> <replaceable>nome-da-interface</replaceable> para especificar a interface que o pacote está percorrendo.</para>

      <note>
	<para>Ao criar ou testar um conjunto de regras de firewall, considere esta configuração temporária:</para>

	<programlisting>net.inet.ip.fw.default_to_accept="1"</programlisting>

	<para>Isso define a política padrão do <citerefentry><refentrytitle>ipfw</refentrytitle><manvolnum>8</manvolnum></citerefentry> para ser mais permissiva do que o padrão <literal>deny ip from any to any</literal>, tornando um pouco mais difícil ficar bloqueado fora do sistema logo após a reinicialização.</para>
      </note>

      <para>O script de firewall começa indicando que é um script Bourne shell e limpa quaisquer regras existentes. Em seguida, ele cria a variável <literal>cmd</literal> para que <literal>ipfw add</literal> não precise ser digitado no início de cada regra. Ele também define a variável <literal>pif</literal> que representa o nome da interface que está conectada à Internet.</para>

      <programlisting>#!/bin/sh
# Flush out the list before we begin.
ipfw -q -f flush

# Set rules command prefix
cmd="ipfw -q add"
pif="dc0"     # interface name of NIC attached to Internet</programlisting>

      <para>As duas primeiras regras permitem todo o tráfego na interface interna e na interface de loopback:</para>

      <programlisting># Change xl0 to LAN NIC interface name
$cmd 00005 allow all from any to any via xl0

# No restrictions on Loopback Interface
$cmd 00010 allow all from any to any via lo0</programlisting>

      <para>A próxima regra permite que o pacote passe se corresponder a uma entrada existente na tabela de regras dinâmicas:</para>

      <programlisting>$cmd 00101 check-state</programlisting>

      <para>O próximo conjunto de regras define quais conexões stateful os sistemas internos podem criar para hosts na Internet:</para>

      <programlisting># Allow access to public DNS
# Replace x.x.x.x with the IP address of a public DNS server
# and repeat for each DNS server in /etc/resolv.conf
$cmd 00110 allow tcp from any to x.x.x.x 53 out via $pif setup keep-state
$cmd 00111 allow udp from any to x.x.x.x 53 out via $pif keep-state

# Allow access to ISP's DHCP server for cable/DSL configurations.
# Use the first rule and check log for IP address.
# Then, uncomment the second rule, input the IP address, and delete the first rule
$cmd 00120 allow log udp from any to any 67 out via $pif keep-state
#$cmd 00120 allow udp from any to x.x.x.x 67 out via $pif keep-state

# Allow outbound HTTP and HTTPS connections
$cmd 00200 allow tcp from any to any 80 out via $pif setup keep-state
$cmd 00220 allow tcp from any to any 443 out via $pif setup keep-state

# Allow outbound email connections
$cmd 00230 allow tcp from any to any 25 out via $pif setup keep-state
$cmd 00231 allow tcp from any to any 110 out via $pif setup keep-state

# Allow outbound ping
$cmd 00250 allow icmp from any to any out via $pif keep-state

# Allow outbound NTP
$cmd 00260 allow udp from any to any 123 out via $pif keep-state

# Allow outbound SSH
$cmd 00280 allow tcp from any to any 22 out via $pif setup keep-state

# deny and log all other outbound connections
$cmd 00299 deny log all from any to any out via $pif</programlisting>

      <para>O próximo conjunto de regras controla conexões de hosts da Internet para a rede interna. Ele começa negando pacotes tipicamente associados a ataques e, em seguida, permite explicitamente tipos específicos de conexões. Todos os serviços autorizados originados da Internet usam <literal>limit</literal> para evitar ataques de flood.</para>

      <programlisting># Deny all inbound traffic from non-routable reserved address spaces
$cmd 00300 deny all from 192.168.0.0/16 to any in via $pif     #RFC 1918 private IP
$cmd 00301 deny all from 172.16.0.0/12 to any in via $pif      #RFC 1918 private IP
$cmd 00302 deny all from 10.0.0.0/8 to any in via $pif         #RFC 1918 private IP
$cmd 00303 deny all from 127.0.0.0/8 to any in via $pif        #loopback
$cmd 00304 deny all from 0.0.0.0/8 to any in via $pif          #loopback
$cmd 00305 deny all from 169.254.0.0/16 to any in via $pif     #DHCP auto-config
$cmd 00306 deny all from 192.0.2.0/24 to any in via $pif       #reserved for docs
$cmd 00307 deny all from 204.152.64.0/23 to any in via $pif    #Sun cluster interconnect
$cmd 00308 deny all from 224.0.0.0/3 to any in via $pif        #Class D &amp; E multicast

# Deny public pings
$cmd 00310 deny icmp from any to any in via $pif

# Deny ident
$cmd 00315 deny tcp from any to any 113 in via $pif

# Deny all Netbios services.
$cmd 00320 deny tcp from any to any 137 in via $pif
$cmd 00321 deny tcp from any to any 138 in via $pif
$cmd 00322 deny tcp from any to any 139 in via $pif
$cmd 00323 deny tcp from any to any 81 in via $pif

# Deny fragments
$cmd 00330 deny all from any to any frag in via $pif

# Deny ACK packets that did not match the dynamic rule table
$cmd 00332 deny tcp from any to any established in via $pif

# Allow traffic from ISP's DHCP server.
# Replace x.x.x.x with the same IP address used in rule 00120.
#$cmd 00360 allow udp from any to x.x.x.x 67 in via $pif keep-state

# Allow HTTP connections to internal web server
$cmd 00400 allow tcp from any to me 80 in via $pif setup limit src-addr 2

# Allow inbound SSH connections
$cmd 00410 allow tcp from any to me 22 in via $pif setup limit src-addr 2

# Reject and log all other incoming connections
$cmd 00499 deny log all from any to any in via $pif</programlisting>

      <para>A última regra registra todos os pacotes que não correspondem a nenhuma das regras do conjunto de regras:</para>

      <programlisting># Everything else is denied and logged
$cmd 00999 deny log all from any to any</programlisting>
    </sect2>

    <sect2 xml:id="in-kernel-nat">
      <info>
	<title><acronym>NAT</acronym> no Kernel</title>

	<authorgroup>
	  <author><personname> <firstname>Chern</firstname> <surname>Lee</surname> </personname> <contrib>Contribuído por</contrib></author>
	</authorgroup>

	<authorgroup>
	  <author><personname> <firstname>Dries</firstname> <surname>Michiels</surname> </personname> <contrib>Revisado e atualizado por </contrib></author>
	</authorgroup>
      </info>

      <indexterm><primary>NAT</primary> <secondary>and <application>IPFW</application></secondary></indexterm>

      <para>O firewall <application>IPFW</application> do FreeBSD possui duas implementações de <acronym>NAT</acronym>: a implementação do sistema base <citerefentry><refentrytitle>natd</refentrytitle><manvolnum>8</manvolnum></citerefentry> e a implementação de <acronym>NAT</acronym> interno do <application>IPFW</application>. Ambos trabalham em conjunto com o <application>IPFW</application> para fornecer tradução de endereço de rede. Isso pode ser usado para fornecer uma solução de compartilhamento de conexão com a Internet, para que vários computadores internos possam se conectar à Internet usando um único endereço <acronym>IP</acronym> público.</para>

      <para>Para isso, a maquina FreeBSD conectada na internet deve atuar como um gateway. Esse sistema deve ter duas <acronym>NIC</acronym>s, onde uma é conectada a internet e a outra conectada a <acronym>LAN</acronym> interna. Cada maquina conectada com a <acronym>LAN</acronym> deve estar associada a um endereço <acronym>IP</acronym> no espaço de rede privado, como definido pela <link xlink:href="https://www.ietf.org/rfc/rfc1918.txt">RFC 1918</link>.</para>

      <para>Algumas configuração adicionais são necessárias para ativar a funcionalidade in-kernel <acronym>NAT</acronym> do <application>IPFW</application>. Para ativar o suporte ao in-kernel <acronym>NAT</acronym> no momento da inicialização do sistema, o seguinte deve ser definido em <filename>/etc/rc.conf</filename>:</para>

      <programlisting>gateway_enable="YES"
firewall_enable="YES"
firewall_nat_enable="YES"</programlisting>

      <note>
	<para>Quando <literal>firewall_nat_enable</literal> estiver definido, mas <literal>firewall_enable</literal> não estiver, ele não terá efeito e não fará nada. Isso ocorre porque a implementação do in-kernel <acronym>NAT</acronym> é compatível apenas com o <application>IPFW</application>.</para></note>

      <para>Quando o conjunto de regras contém regras stateful, o posicionamento da regra <acronym>NAT</acronym> é crítico e a ação <literal>skipto</literal> é usada. A ação <literal>skipto</literal> requer um número de regra para que ele saiba para qual regra saltar. O exemplo abaixo se baseia no conjunto de regras do firewall mostrado na seção anterior. Ele adiciona algumas entradas adicionais e modifica algumas regras existentes para configurar o firewall com in-kernel <acronym>NAT</acronym>. Ele começa adicionando algumas variáveis adicionais que representam o número da regra para pular para, a opção <literal>keep-state</literal> e uma lista de portas <acronym>TCP</acronym> que serão usadas para reduzir o número de regras.</para>

      <programlisting>#!/bin/sh
ipfw -q -f flush
cmd="ipfw -q add"
skip="skipto 1000"
pif=dc0
ks="keep-state"
good_tcpo="22,25,37,53,80,443,110"</programlisting>

      <para>Com o in-kernel <acronym>NAT</acronym> é necessário desativar o descarregamento da segmentação TCP (<acronym>TSO</acronym>) devido à arquitetura do <citerefentry><refentrytitle>libalias</refentrytitle><manvolnum>3</manvolnum></citerefentry>, uma biblioteca implementada como um módulo do kernel para fornecer o in-kernel <acronym>NAT</acronym> do <application>IPFW</application>. O <acronym>TSO</acronym> pode ser desativado em uma interface de rede usando <citerefentry><refentrytitle>ifconfig</refentrytitle><manvolnum>8</manvolnum></citerefentry> ou em todo o sistema usando <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Para desativar o <acronym>TSO</acronym> em todo o sistema, deve-se definir o seguinte em <filename>/etc/sysctl.conf</filename>:</para>

      <programlisting>net.inet.tcp.tso="0"</programlisting>

      <para>Uma instância <acronym>NAT</acronym> também será configurada.  É possível ter várias instâncias de <acronym>NAT</acronym>, cada uma com sua própria configuração. Para este exemplo, apenas uma instância <acronym>NAT</acronym> é necessária; Instância <acronym>NAT</acronym> número 1. A configuração pode receber algumas opções, como: <option>if</option>, que indica a interface pública, <option>same_ports</option>, que cuida para que as portas mapeadas e o números das portas locais sejam mapeados da mesma maneira, <option>unreg_only</option> resultará em apenas espaços de endereço não registrados (privados) a serem processados pela instância <acronym>NAT</acronym> e <option>reset</option>, que ajudará a manter uma instância <acronym>NAT</acronym> em funcionamento, mesmo quando o endereço de <acronym>IP</acronym> público da máquina <application>IPFW</application> for alterado. Para todas as opções possíveis que podem ser passadas para uma única configuração de instância <acronym>NAT</acronym>, consulte <citerefentry><refentrytitle>ipfw</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Ao configurar um firewall <acronym>NAT</acronym> stateful, é necessário permitir que pacotes traduzidos sejam reinjetados no firewall para processamento subsequente. Isso pode ser obtido desativando o comportamento <option>one_pass</option> no início do script do firewall.</para>

      <programlisting>ipfw disable one_pass
ipfw -q nat 1 config if $pif same_ports unreg_only reset</programlisting>

      <para>A regra <acronym>NAT</acronym> de entrada é inserida <emphasis>após</emphasis> as duas regras que permitem todo o tráfego nas interfaces interna e de loopback e após a regra de remontagem, mas <emphasis>antes</emphasis> da regra <literal>check-state</literal> . É importante que o número da regra selecionada para esta regra <acronym>NAT</acronym>, neste exemplo <literal>100</literal>, seja maior que as três primeiras regras e menor que a regra <literal>check-state</literal>. Além disso, devido ao comportamento do in-kernel <acronym>NAT</acronym>, é recomendável colocar uma regra de remontagem pouco antes da primeira regra <acronym>NAT</acronym> e depois das regras que permitem tráfego nas interfaces. Normalmente, a fragmentação <acronym>IP</acronym> não deve ocorrer, mas ao lidar com o tráfego de tunelamento com <acronym>IPSEC/ESP/GRE</acronym>, isso pode ocorrer e a recomposição de fragmentos é necessária antes de entregar o pacote completo para o mecanismo de in-kernel <acronym>NAT</acronym>.</para>

      <note>
	<para>A regra de remontagem não era necessária com o <citerefentry><refentrytitle>natd</refentrytitle><manvolnum>8</manvolnum></citerefentry> do sistema base porque o recurso interno de <literal>divert</literal> no <application>IPFW</application> já cuida disso, remontando os pacotes antes da entrega no socket, também informado em <citerefentry><refentrytitle>ipfw</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>

	<para>A instância <acronym>NAT</acronym> e o número da regra usados neste exemplo não coincidem com a instância <acronym>NAT</acronym> e o número da regra padrão criados por <filename>rc.firewall</filename>. <filename>rc.firewall</filename> é um script que configura as regras de firewall padrão presentes no FreeBSD.</para></note>

      <programlisting>$cmd 005 allow all from any to any via xl0  # exclude LAN traffic
$cmd 010 allow all from any to any via lo0  # exclude loopback traffic
$cmd 099 reass all from any to any in       # reassemble inbound packets
$cmd 100 nat 1 ip from any to any in via $pif # NAT any inbound packets
# Allow the packet through if it has an existing entry in the dynamic rules table
$cmd 101 check-state</programlisting>

      <para>As regras de saída são modificadas para substituir a ação <literal>allow</literal> com a variável <literal>$skip</literal>, indicando que o processamento da regra continuará na regra <literal>1000</literal>. As sete regras <literal>tcp</literal> foram substituídas pela regra <literal>125</literal> porque a variável <literal>$good_tcpo</literal> contém as sete portas de saída permitidas.</para>

      <note>
	<para>Lembre-se de que o desempenho do <application>IPFW</application> é amplamente determinado pelo número de regras presentes no conjunto de regras.</para></note>

      <programlisting># Authorized outbound packets
$cmd 120 $skip udp from any to x.x.x.x 53 out via $pif $ks
$cmd 121 $skip udp from any to x.x.x.x 67 out via $pif $ks
$cmd 125 $skip tcp from any to any $good_tcpo out via $pif setup $ks
$cmd 130 $skip icmp from any to any out via $pif $ks</programlisting>

      <para>As regras de entrada permanecem as mesmas, exceto a ultima regra que remove <literal>via $pif</literal> com intenção de casar com ambas regras de entrada e saida. A regra de <acronym>NAT</acronym> deve seguir essa ultima regra de saida, deve ter um numero maior que a ultima regra, e o numero da regra deve referenciar a ação <literal>skipto</literal>. Nesse conjunto de regras, o numero de regra <literal>1000</literal> lida com a passagem de todos os pacotes para nossa instância configurada para processamento <acronym>NAT</acronym>. A próxima regra permite que qualquer pacote submetido ao processamento <acronym>NAT</acronym> seja liberado.</para>

      <programlisting>$cmd 999 deny log all from any to any
$cmd 1000 nat 1 ip from any to any out via $pif # skipto location for outbound stateful rules
$cmd 1001 allow ip from any to any</programlisting>

      <para>Neste exemplo, as regras <literal>100</literal>, <literal>101</literal>, <literal>125</literal>, <literal>1000</literal> e <literal>1001</literal> controlam a tradução de endereços dos pacotes de saída e de entrada para que as entradas na tabela de estado dinâmico sempre registrem o endereço de <acronym>IP</acronym> privado da <acronym>LAN </acronym>.</para>

      <para>Considere um navegador Web interno que inicialize uma nova sessão <acronym>HTTP</acronym> pela porta 80. Quando o primeiro pacote de saída entra no firewall, ele não corresponde à regra <literal>100</literal> porque ele está saindo e não entrando. Ele pula a regra <literal>101</literal> porque este é o primeiro pacote e ainda não foi inserido na tabela de estados dinâmicos. O pacote finalmente corresponde à regra <literal>125</literal> pois é uma conexão de saída em uma porta permitida e tem um endereço <acronym>IP</acronym> de origem da <acronym>LAN</acronym> interna. Ao combinar essa regra, duas ações ocorrem. Primeiro, a ação <literal>keep-state</literal> adiciona uma entrada à tabela de estados dinâmicos e a ação especificada, <literal>skipto rule 1000</literal>, é executada. Em seguida, o pacote passa pelo <acronym>NAT</acronym> e é enviado para a Internet. Este pacote faz o seu caminho para o servidor web de destino, onde um pacote de resposta é gerado e enviado de volta. Este novo pacote entra no topo do conjunto de regras. Ele corresponde à regra <literal>100</literal> e tem seu endereço de destino <acronym>IP</acronym> mapeado de volta para o endereço interno original. Em seguida, ele é processado pela regra <literal>check-state</literal>, é encontrado na tabela como uma sessão existente e é liberado para a <acronym>LAN</acronym>.</para>

      <para>No lado da entrada, o conjunto de regras deve negar pacotes inválidos e permitir apenas serviços autorizados. Um pacote que corresponde a uma regra de entrada é postado na tabela de estados dinâmicos e o pacote é liberado para a <acronym>LAN</acronym>. O pacote gerado como resposta é reconhecido pela regra <literal>check-state</literal> como pertencente a uma sessão existente. Em seguida, ele é enviado para a regra <literal>1000</literal>  para passar pelo <acronym>NAT</acronym> antes de ser liberado para a interface de saída.</para>

      <note>
	<para>A transição do <citerefentry><refentrytitle>natd</refentrytitle><manvolnum>8</manvolnum></citerefentry> do sistema base para o in-kernel <acronym>NAT</acronym> pode parecer fácil no início, mas há algumas particularidades. Ao usar o kernel GENERIC, o <application>IPFW</application> carregará o módulo <filename>libalias.ko</filename> do kernel, quando o <literal>firewall_nat_enable</literal> estiver ativado no <filename>rc.conf</filename>. O módulo do kernel <filename>libalias.ko</filename> fornece apenas a funcionalidade básica de <acronym>NAT</acronym>, enquanto a implementação do <citerefentry><refentrytitle>natd</refentrytitle><manvolnum>8</manvolnum></citerefentry> do sistema base possui todas as funcionalidades de <acronym>NAT</acronym> disponível na userland sem nenhuma configuração extra. Toda funcionalidade refere-se aos seguintes módulos do kernel que podem ser carregados adicionalmente quando necessário, além do módulo do kernel padrão <filename>libalias.ko</filename>: <filename>alias_cuseeme.ko</filename>, <filename>alias_ftp.ko</filename>, <filename>alias_bbt.ko</filename>, <filename>skinny.ko</filename>, <filename>irc.ko</filename>, <filename>alias_pptp.ko</filename> and <filename>alias_smedia.ko</filename> usando a diretiva <literal>kld_list</literal> em <filename>rc.conf</filename>. Se um kernel personalizado for usado, a funcionalidade completa do sistema base poderá ser compilada no kernel, usando a opção <option>options LIBALIAS</option>.</para></note>

      <sect3>
	<title>Redirecionamento de Portas</title>

	<para>A desvantagem com <acronym>NAT</acronym> em geral é que os clientes da <acronym>LAN</acronym> não estão acessíveis na Internet. Os clientes na <acronym>LAN</acronym> podem fazer conexões de saída para o mundo, mas não podem receber conexões diretas. Isso é um problema ao tentar executar serviços de Internet em uma das máquinas clientes da <acronym>LAN</acronym>. Uma forma simples de contornar isso é redirecionar as portas selecionadas da Internet na máquina <acronym>NAT</acronym> para um cliente da <acronym>LAN</acronym>.</para>

	<para>Por exemplo, um servidor <acronym>IRC</acronym> é executado no cliente <systemitem>A</systemitem> e um servidor Web é executado no cliente <systemitem>B</systemitem>. Para que isso funcione corretamente, as conexões recebidas nas portas 6667 (<acronym>IRC</acronym>) e 80 (<acronym>HTTP</acronym>) devem ser redirecionadas para as respectivas máquinas.</para>

	<para>Com o in-kernel <acronym>NAT</acronym>, toda a configuração é feita na configuração da instância <acronym>NAT</acronym>. Para obter uma lista completa de opções que uma instância in-kernel <acronym>NAT</acronym> pode usar, consulte <citerefentry><refentrytitle>ipfw</refentrytitle><manvolnum>8</manvolnum></citerefentry>. A sintaxe <application>IPFW</application> segue a sintaxe do <application>natd</application>. A sintaxe para <option>redirect_port</option> é a seguinte:</para>

	<programlisting>redirect_port proto targetIP:targetPORT[-targetPORT]
  [aliasIP:]aliasPORT[-aliasPORT]
  [remoteIP[:remotePORT[-remotePORT]]]</programlisting>

	<para>Para configurar o exemplo de instalação acima, os argumentos devem ser:</para>

	<programlisting>redirect_port tcp 192.168.0.2:6667 6667
redirect_port tcp 192.168.0.3:80 80</programlisting>

	<para>Depois de adicionar esses argumentos à configuração da instância 1 de <acronym>NAT</acronym> no conjunto de regras acima, as portas <acronym>TCP</acronym> serão encaminhadas para as máquinas clientes da <acronym>LAN</acronym> que rodam os serviços <acronym>IRC</acronym> e <acronym>HTTP</acronym>.</para>

	<programlisting>ipfw -q nat 1 config if $pif same_ports unreg_only reset \
  redirect_port tcp 192.168.0.2:6667 6667 \
  redirect_port tcp 192.168.0.3:80 80</programlisting>

	<para>Intervalos de portas podem ser indicados com <option>redirect_port</option>. Por exemplo, <replaceable>tcp 192.168.0.2:2000-3000 2000-3000</replaceable> redirecionaria todas as conexões recebidas entre as portas 2000 e 3000 para as portas 2000 a 3000 no cliente <systemitem>A</systemitem>.</para>
      </sect3>

      <sect3>
	<title>Redirecionamento de Endereços</title>

	<para>Redirecionamento de endereços é útil se mais de um endereço <acronym>IP</acronym> estiver disponível. Cada cliente da <acronym>LAN</acronym> pode receber seu próprio endereço <acronym>IP</acronym> externo pelo <citerefentry><refentrytitle>ipfw</refentrytitle><manvolnum>8</manvolnum></citerefentry>, que reescreverá os pacotes de saída dos clientes da <acronym>LAN</acronym> com o endereço <acronym>IP</acronym> externo apropriado e redirecionará todo o tráfego recebido naquele endereço <acronym>IP</acronym> específico de volta para o cliente da <acronym>LAN</acronym> específico. Isso também é conhecido como <acronym>NAT</acronym> estático. Por exemplo, se o endereço <acronym>IP</acronym> <systemitem class="ipaddress">128.1.1.1</systemitem>, <systemitem class="ipaddress">128.1.1.2</systemitem>, e <systemitem class="ipaddress">128.1.1.3</systemitem> estiverem disponíveis, <systemitem class="ipaddress">128.1.1.1</systemitem> pode ser usado pelo <citerefentry><refentrytitle>ipfw</refentrytitle><manvolnum>8</manvolnum></citerefentry> como o endereço <acronym>IP</acronym> de saída externa, enquanto <systemitem class="ipaddress">128.1.1.2</systemitem> e <systemitem class="ipaddress">128.1.1.3</systemitem> são encaminhados de volta para os clientes da <acronym>LAN</acronym> <systemitem>A</systemitem> e <systemitem>B</systemitem>.</para>

	<para>A sintaxe <option>redirect_address</option> é a seguinte, onde <literal>localIP</literal> é o endereço <acronym>IP</acronym> interno do cliente da <acronym>LAN</acronym> e <literal>publicIP</literal> é o endereço <acronym>IP</acronym> externo que corresponde ao cliente da <acronym> LAN </acronym>.</para>

	<programlisting>redirect_address localIP publicIP</programlisting>

	<para>No exemplo, os argumentos seriam:</para>

	<programlisting>redirect_address 192.168.0.2 128.1.1.2
redirect_address 192.168.0.3 128.1.1.3</programlisting>

	<para>Como o <option>redirect_port</option>, esses argumentos são inseridos na configuração da instância <acronym>NAT</acronym>. Com o redirecionamento de endereço, não há necessidade de redirecionamento de porta, pois todos os dados recebidos em um determinado endereço <acronym>IP</acronym> são redirecionados.</para>

	<para>Os endereços <acronym>IP</acronym> externos na máquina <citerefentry><refentrytitle>ipfw</refentrytitle><manvolnum>8</manvolnum></citerefentry> devem estar ativos e com alias na interface externa. Consulte <citerefentry><refentrytitle>rc.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry> para mais informações.</para>
      </sect3>

      <sect3>
	<title><acronym>NAT</acronym> do espaço do usuário</title>

	<para>Vamos começar com uma declaração: a implementação de <acronym>NAT</acronym> do sistema base: <citerefentry><refentrytitle>natd</refentrytitle><manvolnum>8</manvolnum></citerefentry>, tem mais sobrecarga do que no in-kernel <acronym>NAT</acronym>. Para que o <citerefentry><refentrytitle>natd</refentrytitle><manvolnum>8</manvolnum></citerefentry> traduza pacotes, os pacotes precisam ser copiados do kernel para o espaço do usuário e vice-versa, o que gera uma sobrecarga extra que não está presente com o in-kernel <acronym>NAT</acronym>.</para>

	<para>Para ativar o daemon de <acronym>NAT</acronym> do sistema base , <citerefentry><refentrytitle>natd</refentrytitle><manvolnum>8</manvolnum></citerefentry>, no momento da inicialização do sistema, é necessário a seguinte configuração mínima em <filename>/etc/rc.conf</filename>. Onde <option>natd_interface</option> é definido com o nome da interface <acronym>NIC</acronym> conectada à Internet. O script <citerefentry><refentrytitle>rc</refentrytitle><manvolnum>8</manvolnum></citerefentry> do <citerefentry><refentrytitle>natd</refentrytitle><manvolnum>8</manvolnum></citerefentry> verifica automaticamente se um endereço <acronym>IP</acronym> dinâmico é usado e configura-se para lidar com isso.</para>

	<programlisting>gateway_enable="YES"
natd_enable="YES"
natd_interface="rl0"</programlisting>

	<para>Em geral, o conjunto de regras acima, conforme explicado para o in-kernel <acronym>NAT</acronym>, também pode ser usado junto com <citerefentry><refentrytitle>natd</refentrytitle><manvolnum>8</manvolnum></citerefentry>. As exceções são a configuração da instância in-kernel <acronym>NAT</acronym> <literal> (ipfw -q nat 1 config ...) </literal> que não é necessária junto com a regra de remontagem 99 porque sua funcionalidade é incluída na ação <option>divert</option>. As regras número 100 e 1000 terão que mudar ligeiramente, como mostrado abaixo.</para>

	<programlisting>$cmd 100 divert natd ip from any to any in via $pif
$cmd 1000 divert natd ip from any to any out via $pif</programlisting>

	<para>Para configurar o redirecionamento de porta ou endereço, é usada uma sintaxe semelhante à do in-kernel <acronym>NAT</acronym>. Embora agora, em vez de especificar a configuração em nosso script de conjunto de regras, como no in-kernel <acronym>NAT</acronym>, a configuração do <citerefentry><refentrytitle>natd</refentrytitle><manvolnum>8</manvolnum></citerefentry> é melhor realizada em um arquivo de configuração. Para fazer isso, uma flag extra deve ser passado através do <filename>/etc/rc.conf</filename>, que especifica o caminho do arquivo de configuração.</para>

	<programlisting>natd_flags="-f /etc/natd.conf"</programlisting>

	<note>
	  <para>O arquivo especificado deve conter uma lista de opções de configuração, uma por linha. Para obter mais informações sobre esse arquivo de configuração e possíveis variáveis, consulte <citerefentry><refentrytitle>natd</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Abaixo estão dois exemplos de valores, um por linha:</para>

	  <programlisting>redirect_port tcp 192.168.0.2:6667 6667
redirect_address 192.168.0.3 128.1.1.3</programlisting></note>
      </sect3>
    </sect2>

    <sect2 xml:id="firewalls-ipfw-cmd">
      <title>O Comando <application>IPFW</application></title>

      <indexterm><primary><command>ipfw</command></primary></indexterm>

      <para>O <command>ipfw</command> pode ser usado para adicionar ou excluir regras únicas e manuais ao firewall ativo enquanto ele estiver em execução. O problema com o uso desse método é que todas as alterações são perdidas quando o sistema é reinicializado. Recomenda-se, em vez disso, gravar todas as regras em um arquivo e usar esse arquivo para carregar as regras no momento da inicialização e substituir as regras de firewall em execução no momento em que o arquivo for alterado.</para>

      <para>O <command>ipfw</command> é uma maneira útil para se exibir as regras de firewall em execução na tela do console. O recurso de contabilidade <application>IPFW</application> cria dinamicamente um contador para cada regra que case com cada pacote que corresponde à regra. Durante o processo de teste de uma regra, listar a regra com seu contador é uma maneira de determinar se a regra está funcionando conforme o esperado.</para>

      <para>Para listar todas as regras em execução em sequência:</para>

      <screen><prompt>#</prompt> <userinput>ipfw list</userinput></screen>

      <para>Para listar todas as regras em execução com um registro de data e hora de quando a última vez em que a regra foi utilizada:</para>

      <screen><prompt>#</prompt> <userinput>ipfw -t list</userinput></screen>

      <para>O próximo exemplo lista as informações contábeis e a contagem de pacotes das regras correspondentes, junto com as próprias regras. A primeira coluna é o número da regra, seguido pelo número de pacotes e bytes correspondidos, seguidos pela própria regra.</para>

      <screen><prompt>#</prompt> <userinput>ipfw -a list</userinput></screen>

      <para>Para listar regras dinâmicas além das regras estáticas:</para>

      <screen><prompt>#</prompt> <userinput>ipfw -d list</userinput></screen>

      <para>Para mostrar também as regras dinâmicas expiradas:</para>

      <screen><prompt>#</prompt> <userinput>ipfw -d -e list</userinput></screen>

      <para>Para zerar os contadores:</para>

      <screen><prompt>#</prompt> <userinput>ipfw zero</userinput></screen>

      <para>Para zerar os contadores apenas para a regra com o número <replaceable>NUM</replaceable>:</para>

      <screen><prompt>#</prompt> <userinput>ipfw zero <replaceable>NUM</replaceable></userinput></screen>

      <sect3>
	<title>Mensagens de Log do Firewall</title>

	<indexterm><primary><application>IPFW</application></primary> <secondary>logging</secondary></indexterm>

	<para>Mesmo com o recurso de geração de log ativado, o <application>IPFW</application> não irá gerar nenhum log de regras por conta própria. O administrador do firewall decide quais regras no conjunto de regras serão logadas e adiciona a palavra-chave <literal>log</literal> a essas regras. Normalmente, apenas as regras de bloqueio são logadas. É costume duplicar a regra <quote>ipfw default deny everything</quote> com a palavra-chave <literal>log</literal> incluída como a última regra no conjunto de regras. Dessa forma, é possível ver todos os pacotes que não correspondem a nenhuma das regras do conjunto de regras.</para>

	<para>O log é uma espada de dois gumes. Se não houver cuidado, uma abundância de dados de log ou um ataque DoS pode encher o disco com arquivos de log. As mensagens de log não são gravadas apenas no <application>syslogd</application>, mas também são exibidas na tela do console do root e logo se tornam irritantes.</para>

	<para>A opção do kernel <literal>IPFIREWALL_VERBOSE_LIMIT=5</literal> limita o número de mensagens consecutivas enviadas para o <citerefentry><refentrytitle>syslogd</refentrytitle><manvolnum>8</manvolnum></citerefentry>, referente à correspondência de pacotes de uma regra dada. Quando esta opção está ativada no kernel, o número de mensagens consecutivas relativas a uma regra específica é limitado ao número especificado. Não há nada a ganhar com 200 mensagens de log idênticas. Com essa opção definida como cinco, cinco mensagens consecutivas referentes a uma regra específica seriam registradas no <application>syslogd</application> e as mensagens consecutivas idênticas restantes seriam contadas e postadas no <application>syslogd</application> com uma frase assim:</para>

	<programlisting>last message repeated 45 times</programlisting>

	<para>Todas os pacotes logados são escritos por padrão no arquivo <filename>/var/log/security</filename>, que é definido no <filename>/etc/syslog.conf</filename>.</para>
      </sect3>

      <sect3 xml:id="firewalls-ipfw-rules-script">
	<title>Criando um Script de Regras</title>

	<para>Os usuários mais experientes do <application>IPFW</application> criam um arquivo contendo as regras e as codificam de maneira compatível com sua execução como um script. A principal vantagem de fazer isso é que as regras de firewall podem ser atualizadas em massa sem a necessidade de reinicializar o sistema para ativá-las. Este método é conveniente para testar novas regras, pois o procedimento pode ser executado quantas vezes forem necessárias. Sendo um script, a substituição simbólica pode ser usada para valores usados frequentemente para serem substituídos em várias regras.</para>

	<para>Este script de exemplo tem a sintaxe compatível com shells <citerefentry><refentrytitle>sh</refentrytitle><manvolnum>1</manvolnum></citerefentry>, <citerefentry><refentrytitle>csh</refentrytitle><manvolnum>1</manvolnum></citerefentry>, e <citerefentry><refentrytitle>tcsh</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Campos de substituição simbólicos são prefixados com um sinal de dólar ($). Campos simbólicos não possuem o prefixo $. O valor para preencher o campo simbólico deve ser colocado entre aspas duplas ("").</para>

	<para>Inicie o arquivo de regras assim:</para>

	<programlisting>############### start of example ipfw rules script #############
#
ipfw -q -f flush       # Delete all rules
# Set defaults
oif="tun0"             # out interface
odns="192.0.2.11"      # ISP's DNS server IP address
cmd="ipfw -q add "     # build rule prefix
ks="keep-state"        # just too lazy to key this each time
$cmd 00500 check-state
$cmd 00502 deny all from any to any frag
$cmd 00501 deny tcp from any to any established
$cmd 00600 allow tcp from any to any 80 out via $oif setup $ks
$cmd 00610 allow tcp from any to $odns 53 out via $oif setup $ks
$cmd 00611 allow udp from any to $odns 53 out via $oif $ks
################### End of example ipfw rules script ############</programlisting>

	<para>As regras não são importantes, pois o foco deste exemplo é como os campos de substituição simbólica são preenchidos.</para>

	<para>Se o exemplo acima estiver no arquivo <filename>/etc/ipfw.rules</filename>, as regras podem ser recarregadas pelo seguinte comando:</para>

	<screen><prompt>#</prompt> <userinput>sh /etc/ipfw.rules</userinput></screen>

	<para><filename>/etc/ipfw.rules</filename> pode estar localizado em qualquer lugar e o arquivo pode ter qualquer nome.</para>

	<para>A mesma coisa pode ser realizada executando esses comandos manualmente:</para>

	<screen><prompt>#</prompt> <userinput>ipfw -q -f flush</userinput>
<prompt>#</prompt> <userinput>ipfw -q add check-state</userinput>
<prompt>#</prompt> <userinput>ipfw -q add deny all from any to any frag</userinput>
<prompt>#</prompt> <userinput>ipfw -q add deny tcp from any to any established</userinput>
<prompt>#</prompt> <userinput>ipfw -q add allow tcp from any to any 80 out via tun0 setup keep-state</userinput>
<prompt>#</prompt> <userinput>ipfw -q add allow tcp from any to 192.0.2.11 53 out via tun0 setup keep-state</userinput>
<prompt>#</prompt> <userinput>ipfw -q add 00611 allow udp from any to 192.0.2.11 53 out via tun0 keep-state</userinput></screen>
      </sect3>
    </sect2>

    <sect2 xml:id="firewalls-ipfw-kernelconfig">
      <title>Opções do Kerne para o <application>IPFW</application></title>

      <indexterm><primary>kernel options</primary> <secondary>IPFIREWALL</secondary></indexterm>

      <indexterm><primary>kernel options</primary> <secondary>IPFIREWALL_VERBOSE</secondary></indexterm>

      <indexterm><primary>kernel options</primary> <secondary>IPFIREWALL_VERBOSE_LIMIT</secondary></indexterm>

      <indexterm><primary><application>IPFW</application></primary> <secondary>kernel options</secondary></indexterm>
      <para>Para compilar estaticamente o suporte ao <application>IPFW</application> em um kernel personalizado, consulte as instruções em <xref linkend="kernelconfig"/>. As seguintes opções estão disponíveis para o arquivo de configuração do kernel personalizado:</para>

      <programlisting>options    IPFIREWALL			# enables IPFW
options    IPFIREWALL_VERBOSE		# enables logging for rules with log keyword to syslogd(8)
options    IPFIREWALL_VERBOSE_LIMIT=5	# limits number of logged packets per-entry
options    IPFIREWALL_DEFAULT_TO_ACCEPT # sets default policy to pass what is not explicitly denied
options    IPFIREWALL_NAT		# enables basic in-kernel NAT support
options    LIBALIAS			# enables full in-kernel NAT support
options    IPFIREWALL_NAT64		# enables in-kernel NAT64 support
options    IPFIREWALL_NPTV6		# enables in-kernel IPv6 NPT support
options    IPFIREWALL_PMOD		# enables protocols modification module support
options    IPDIVERT			# enables NAT through natd(8)</programlisting>

      <note>
	<para>O <application>IPFW</application> pode ser carregado como um módulo do kernel: as opções acima são compiladas por padrão como módulos ou podem ser configuradas em tempo de execução usando parâmetros configuráveis.</para>
      </note>
    </sect2>
  </sect1>

  <sect1 xml:id="firewalls-ipf">
    <title>IPFILTER (IPF)</title>

    <indexterm><primary>firewall</primary> <secondary><application>IPFILTER</application></secondary></indexterm>

    <para>O <application>IPFILTER</application>, também conhecido como <application>IPF</application>, é um firewall cross-platform de código aberto que foi portado para vários sistemas operacionais, incluindo FreeBSD, NetBSD, OpenBSD e <trademark>Solaris</trademark>.</para>

    <para>O <application>IPFILTER</application> é um firewall kernel-side e um mecanismo <acronym>NAT</acronym> que pode ser controlado e monitorado por programas da área de usuário. As regras de firewall podem ser definidas ou excluídas usando <application>ipf</application>, as regras <acronym>NAT</acronym> podem ser definidas ou excluídas usando <application>ipnat</application>, estatísticas em tempo de execução para as partes do kernel <application>IPFILTER</application> podem ser informadas usando <application>ipfstat</application>, e <application>ipmon</application> pode ser usado para logar ações do <application>IPFILTER</application> nos arquivos de log do sistema.</para>

    <para>O <application>IPF</application> foi originalmente escrito usando uma lógica de processamento de regra de que <quote>a última regra que corresponder, ganha</quote> e era utilizado apenas regras stateless. Desde então, <application>IPF</application> foi aprimorado para incluir as opções <literal>quick</literal> e <literal>keep state</literal>.</para>

    <para>O FAQ <application>IPF</application> está em <uri xlink:href="http://www.phildev.net/ipf/index.html">http://www.phildev.net/ipf/index.html</uri>. Um arquivo liberado para buscas da lista de discussão IPFilter está disponível em <uri xlink:href="http://marc.info/?l=ipfilter">http://marc.info/?l=ipfilter</uri>.</para>

    <para>Esta seção do Handbook foca no <application>IPF</application> no que se refere ao FreeBSD. Ele fornece exemplos de regras que contêm as opções <literal>quick</literal> e <literal>keep state</literal>.</para>

    <sect2>
      <title>Ativando o <application>IPF</application></title>

      <indexterm><primary><application>IPFILTER</application></primary> <secondary>enabling</secondary></indexterm>

      <para>O <application>IPF</application> está incluído na instalação base do FreeBSD como um módulo carregável do kernel, o que significa que um kernel personalizado não é necessário para habilitar o <application>IPF</application>.</para>

      <indexterm><primary>kernel options</primary> <secondary><application>IPFILTER</application></secondary></indexterm>

      <indexterm><primary>kernel options</primary> <secondary>IPFILTER_LOG</secondary></indexterm>

      <indexterm><primary>kernel options</primary> <secondary>IPFILTER_DEFAULT_BLOCK</secondary></indexterm>

      <indexterm><primary><application>IPFILTER</application></primary> <secondary>kernel options</secondary></indexterm>

      <para>Para usuários que preferem compilar estaticamente o suporte ao <application>IPF</application> em um kernel personalizado, consulte as instruções em <xref linkend="kernelconfig"/>. As seguintes opções do kernel estão disponíveis:</para>

      <programlisting>options IPFILTER
options IPFILTER_LOG
options IPFILTER_LOOKUP
options IPFILTER_DEFAULT_BLOCK</programlisting>

      <para>onde <literal>options IPFILTER</literal> ativa o suporte para o <application>IPFILTER</application>, <literal>options IPFILTER_LOG</literal> ativa o log do <application>IPF</application> usando o pseudo-dispositivo de log <filename>ipl</filename> para cada regra que tenha a palavra-chave <literal>log</literal>, <literal>IPFILTER_LOOKUP</literal> ativa as pools <acronym>IP</acronym> para acelerar <acronym>IP</acronym> lookups, e <literal>options IPFILTER_DEFAULT_BLOCK</literal> altera o comportamento padrão para que qualquer pacote que não corresponda a uma regra <literal>pass</literal> do firewall seja bloqueado.</para>

      <para>Para configurar o sistema para ativar o <application>IPF</application> no momento da inicialização, adicione as seguintes entradas ao <filename>/etc/rc.conf</filename>. Essas entradas também ativarão o log e o <literal>default pass all</literal>. Para alterar a política padrão para <literal>block all</literal> sem compilar um kernel personalizado, lembre-se de adicionar uma regra <literal>block all</literal> no final do conjunto de regras.</para>

      <programlisting>ipfilter_enable="YES"             # Start ipf firewall
ipfilter_rules="/etc/ipf.rules"   # loads rules definition text file
ipv6_ipfilter_rules="/etc/ipf6.rules" # loads rules definition text file for IPv6
ipmon_enable="YES"                # Start IP monitor log
ipmon_flags="-Ds"                 # D = start as daemon
                                  # s = log to syslog
                                  # v = log tcp window, ack, seq
                                  # n = map IP &amp; port to names</programlisting>

      <para>Se a funcionalidade <acronym>NAT</acronym> for necessária, adicione também estas linhas:</para>

      <programlisting>gateway_enable="YES"              # Enable as LAN gateway
ipnat_enable="YES"                # Start ipnat function
ipnat_rules="/etc/ipnat.rules"    # rules definition file for ipnat</programlisting>

      <para>Então, inicie o <application>IPF</application>:</para>

      <programlisting><prompt>#</prompt> <userinput>service ipfilter start</userinput></programlisting>

      <para>Para carregar as regras de firewall, especifique o nome do arquivo do conjunto de regras usando <command>ipf</command>. O comando a seguir pode ser usado para substituir as regras de firewall que está em execução:</para>

      <screen><prompt>#</prompt> <userinput>ipf -Fa -f /etc/ipf.rules</userinput></screen>

      <para>onde <option>-Fa</option> limpa todas as tabelas de regras internas e <option>-f</option> especifica o arquivo que contém as regras a serem carregadas.</para>

      <para>Isso fornece a capacidade de fazer alterações em um conjunto de regras personalizado e atualizar o firewall em execução com uma nova cópia das regras sem precisar reinicializar o sistema. Esse método é conveniente para testar novas regras, pois o procedimento pode ser executado quantas vezes forem necessárias.</para>

      <para>Consulte <citerefentry><refentrytitle>ipf</refentrytitle><manvolnum>8</manvolnum></citerefentry> para detalhes sobre as outras flags disponíveis com este comando.</para>
    </sect2>

    <sect2>
      <title>Sintaxe de Regras <application>IPF</application></title>

      <indexterm><primary><application>IPFILTER</application></primary> <secondary>rule syntax</secondary></indexterm>

      <para>Esta seção descreve a sintaxe de regras <application>IPF</application> usada para criar regras stateful. Ao criar regras, lembre-se de que, a menos que a palavra-chave <literal>quick</literal> apareça em uma regra, todas as regras são lidas em ordem, com a <emphasis>última regra correspondente </emphasis> sendo a aplicada. Isso significa que, mesmo que a primeira regra que corresponder a um pacote seja <literal>pass</literal>, se houver uma regra de correspondência posterior que seja <literal>block</literal>, o pacote será descartado. Os conjuntos de regras de exemplo podem ser encontrados em <filename>/usr/share/examples/ipfilter</filename>.</para>

      <para>Ao criar regras, um caractere <literal>#</literal> é usado para marcar o início de um comentário e pode aparecer no final de uma regra, para explicar a função dessa regra ou em sua própria linha. Todas as linhas em branco são ignoradas.</para>

      <para>As palavras-chave usadas nas regras devem ser escritas em uma ordem específica, da esquerda para a direita. Algumas palavras-chave são obrigatórias, enquanto outras são opcionais. Algumas palavras-chave têm sub-opções que podem ser palavras-chave e também incluem mais sub-opções. A ordem das palavras-chave é a seguinte, em que as palavras mostradas em maiúsculas representam uma variável e as palavras mostradas em minúsculas devem preceder a variável que a segue:</para>

      <para><replaceable>ACTION DIRECTION OPTIONS proto PROTO_TYPE from SRC_ADDR SRC_PORT to DST_ADDR DST_PORT TCP_FLAG|ICMP_TYPE keep state STATE</replaceable></para>

      <para>Esta seção descreve cada uma dessas palavras-chave e suas opções. Não é uma lista exaustiva de todas as opções possíveis. Consulte <citerefentry><refentrytitle>ipf</refentrytitle><manvolnum>5</manvolnum></citerefentry> para obter uma descrição completa da sintaxe de regra que pode ser usada ao criar regras <application>IPF</application> e exemplos para usar de cada palavra-chave.</para>

      <variablelist>
	<varlistentry>
	  <term>ACTION</term>
	  <listitem>
	    <para>A palavra-chave action indica o que fazer com o pacote se corresponder a essa regra. Toda regra <emphasis>deve</emphasis> ter uma ação. As seguintes ações são reconhecidas:</para>

	    <para><literal>block</literal>: descarta o pacote.</para>

	    <para><literal>pass</literal>: permite o pacote.</para>

	    <para><literal>log</literal>: gera um registro de log.</para>

	    <para><literal>count</literal>: conta o número de pacotes e bytes que podem fornecer uma indicação da frequência com que uma regra é usada.</para>

	    <para><literal>auth</literal>: enfileira o pacote para processamento adicional por outro programa.</para>

	    <para><literal>call</literal>: fornece acesso a funções embutidas no <application>IPF</application> que permitem ações mais complexas.</para>

	    <para><literal>decapsulate</literal>: remove quaisquer cabeçalhos para processar o conteúdo do pacote.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>DIRECTION</term>
	  <listitem>
	    <para>Em seguida, cada regra deve indicar explicitamente a direção do tráfego usando uma dessas palavras-chave:</para>

	    <para><literal>in</literal>: a regra é aplicada em um pacote de entrada.</para>

	    <para><literal>out</literal>: a regra é aplicada em um pacote de saída.</para>

	    <para><literal>all</literal>: a regra se aplica em qualquer direção.</para>

	    <para>Se o sistema tiver várias interfaces, a interface pode ser especificada junto com a direção. Um exemplo seria <literal>in on fxp0</literal>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>OPTIONS</term>
	  <listitem>
	    <para>Opções são opcionais. No entanto, se várias opções forem especificadas, elas deverão ser usadas na ordem apresentada aqui.</para>

	    <para><literal>log</literal>: ao executar a ACTION especificada, o conteúdo dos cabeçalhos do pacote será gravado no pseudo-dispositivo de log <citerefentry><refentrytitle>ipl</refentrytitle><manvolnum>4</manvolnum></citerefentry>.</para>

	    <para><literal>quick</literal>: se um pacote corresponder a essa regra, a ACTION especificada pela regra ocorrerá e nenhum processamento adicional das regras a seguir ocorrerá para este pacote.</para>

	    <para><literal>on</literal>: deve ser seguido pelo nome da interface conforme exibido pelo <citerefentry><refentrytitle>ifconfig</refentrytitle><manvolnum>8</manvolnum></citerefentry>. A regra corresponderá somente se o pacote estiver passando pela interface especificada na direção especificada.</para>

	    <para>Ao usar a palavra-chave <literal>log</literal>, os seguintes qualificadores podem ser usados nesta ordem:</para>

	    <para><literal>body</literal>: indica que os primeiros 128 bytes do conteúdo do pacote serão registrados após os cabeçalhos.</para>

	    <para><literal>first</literal>: se a palavra-chave <literal>log</literal> estiver sendo usada em conjunto com uma opção <literal>keep state</literal>, esta opção é recomendada para que somente o pacote acionador seja logado e não todos os pacotes que corresponde à conexão stateful.</para>

	    <para>Opções adicionais estão disponíveis para especificar mensagens de retorno de erro. Consulte <citerefentry><refentrytitle>ipf</refentrytitle><manvolnum>5</manvolnum></citerefentry> para mais detalhes.</para>

	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>PROTO_TYPE</term>
	  <listitem>
	    <para>O tipo de protocolo é opcional. No entanto, é obrigatório se a regra precisar especificar um SRC_PORT ou um DST_PORT, uma vez que isso requer o tipo de protocolo. Ao especificar o tipo de protocolo, use a palavra-chave <literal>proto</literal> seguida de um número de protocolo ou nome de <filename>/etc/protocols</filename>. Exemplos de nomes de protocolos incluem <literal>tcp</literal>, <literal>udp</literal> ou <literal>icmp</literal>. Se PROTO_TYPE for especificado, mas nenhum SRC_PORT ou DST_PORT for especificado, todos os números de porta desse protocolo corresponderão a essa regra.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>SRC_ADDR</term>
	  <listitem>
	    <para>A palavra-chave <literal>from</literal> é obrigatória e é seguida por uma palavra-chave que representa a origem do pacote. A origem pode ser um nome de host, um endereço <acronym>IP</acronym> seguido pela máscara <acronym>CIDR</acronym>, um pool de endereços ou a palavra-chave <literal>all</literal>. Consulte <citerefentry><refentrytitle>ipf</refentrytitle><manvolnum>5</manvolnum></citerefentry> para exemplos.</para>

	    <para>Não há como definir intervalos de endereços de <acronym>IP</acronym> que não se expressam facilmente usando a notação de formato numérico com ponto / máscara. O pacote ou port <package>net-mgmt/ipcalc</package> pode ser usado para facilitar o cálculo da máscara <acronym>CIDR</acronym>. Informações adicionais estão disponíveis na página web da ferramenta: <uri xlink:href="http://jodies.de/ipcalc">http://jodies.de/ipcalc</uri>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>SRC_PORT</term>
	  <listitem>
	    <para>O número da porta da origem é opcional. No entanto, se for usado, ela exige que o PROTO_TYPE seja definido primeiramente na regra. O número da porta também deve ser precedido pela palavra-chave <literal>proto</literal>.</para>

	    <para>Diferentes operadores de comparação são suportados: <literal>=</literal> (igual a), <literal>!=</literal> (diferente de), <literal>&lt;</literal> (menor que), <literal>&gt;</literal> (maior que), <literal>&lt;=</literal> (menor ou igual a) e <literal>&gt;=</literal> (maior que ou igual a).</para>

	    <para>Para especificar intervalos de porta, coloque os dois números de porta entre <literal>&lt;&gt;</literal> (menor que e maior que), <literal>&gt;&lt;</literal> (maior que e menor que) ou <literal>:</literal> (maior que ou igual a e menor que ou igual a).</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>DST_ADDR</term>
	  <listitem>
	    <para>A palavra-chave <literal>to</literal> é obrigatória e é seguida por uma palavra-chave que representa o destino do pacote. Semelhante ao SRC_ADDR, ela pode ser um nome de host, um endereço <acronym>IP</acronym> seguido pela máscara <acronym>CIDR</acronym>, um pool de endereços ou a palavra-chave <literal>all</literal>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>DST_PORT</term>
	  <listitem>
	    <para>Semelhante ao SRC_PORT, o número da porta do destino é opcional. No entanto, se for usada, ela exige que o PROTO_TYPE seja definido primeiramente na regra. O número da porta também deve ser precedido pela palavra-chave <literal>proto</literal>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>TCP_FLAG|ICMP_TYPE</term>
	  <listitem>
	    <para>Se <literal>tcp</literal> for especificado como o PROTO_TYPE, flags poderão ser especificadas como letras, onde cada letra representa uma das possíveis flags <acronym>TCP</acronym> utilizadas para determinar o estado de uma conexão. Os valores possíveis são: <literal>S</literal> (SYN), <literal>A</literal> (ACK), <literal>P</literal> (PSH), <literal>F</literal> (FIN), <literal>U</literal> (URG), <literal>R</literal> (RST), <literal>C</literal> (CWN), e <literal>E</literal> (ECN).</para>

	    <para>Se o <literal>icmp</literal> for especificado como o PROTO_TYPE, o tipo <acronym>ICMP</acronym> para correspondência pode ser especificado. Consulte o <citerefentry><refentrytitle>ipf</refentrytitle><manvolnum>5</manvolnum></citerefentry> para os tipos permitidos.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>STATE</term>
	  <listitem>
	    <para>Se uma regra <literal>pass</literal> contiver <literal>keep state</literal>, o <application>IPF</application> incluirá uma entrada em sua tabela de estados dinâmicos e permitirá o tráfego os pacotes subsequentes que correspondam à conexão. O <application>IPF</application> pode rastrear o estado das sessões <acronym>TCP</acronym>, <acronym>UDP</acronym> e <acronym>ICMP</acronym>. Qualquer pacote que o <application>IPF</application> tenha certeza de que faz parte de uma sessão ativa, mesmo que seja um protocolo diferente, será liberado.</para>

	    <para>No <application>IPF</application>, os pacotes destinados a sair pela interface conectada à Internet pública são verificados primeiro na tabela de estados dinâmicos. Se o pacote corresponder ao próximo pacote esperado, compreendendo uma sessão ativa, ele sairá do firewall e o estado do fluxo da sessão será atualizado na tabela de estados dinâmicos. Os pacotes que não pertencem a uma sessão já ativa são verificados no conjunto de regras de saída. Os pacotes vindos da interface conectada à Internet pública são verificados primeiro na tabela de estados dinâmicos. Se o pacote corresponder ao próximo pacote esperado que compreende uma sessão ativa, ele sairá do firewall e o estado do fluxo da sessão será atualizado na tabela de estados dinâmicos. Os pacotes que não pertencem a uma sessão já ativa são verificados no conjunto de regras de entrada.</para>

	    <para>Várias palavras-chave podem ser adicionadas depois de <literal>keep state</literal>. Se usadas, essas palavras-chave definem várias opções que controlam a filtragem stateful, como a configuração de limites de conexão ou o tempo de vida da conexão. Consulte <citerefentry><refentrytitle>ipf</refentrytitle><manvolnum>5</manvolnum></citerefentry> para obter a lista de opções disponíveis e suas descrições.</para>
	  </listitem>
	</varlistentry>
      </variablelist>
    </sect2>

    <sect2>
      <title>Exemplo de Conjunto de Regras</title>

      <para>Esta seção demonstra como criar um conjunto de regras de exemplo que permite apenas serviços que correspondam às regras <literal>pass</literal> e bloqueie todo o resto.</para>

      <para>O FreeBSD usa a interface de loopback (<filename>lo0</filename>) e o endereço <acronym>IP</acronym> <systemitem class="ipaddress">127.0.0.1</systemitem> para comunicação interna. O conjunto de regras do firewall deve conter regras para permitir o livre movimento desses pacotes usados internamente:</para>

      <programlisting># no restrictions on loopback interface
pass in quick on lo0 all
pass out quick on lo0 all</programlisting>

      <para>A interface pública conectada à Internet é usada para autorizar e controlar o acesso de todas as conexões de entrada e saída. Se uma ou mais interfaces forem cabeadas para redes privadas, essas interfaces internas poderão exigir regras para permitir que os pacotes originados da <acronym>LAN</acronym> fluam entre as redes internas ou para a interface conectada à Internet. O conjunto de regras deve ser organizado em três seções principais: quaisquer interfaces internas confiáveis, conexões de saída por meio da interface pública e conexões de entrada por meio da interface pública.</para>

      <para>Essas duas regras permitem que todo o tráfego passe por uma interface confiável <acronym>LAN</acronym> chamada <filename>xl0</filename>:</para>

      <programlisting># no restrictions on inside LAN interface for private network
pass out quick on xl0 all
pass in quick on xl0 all</programlisting>

      <para>As regras para as seções de saída e entrada da interface pública devem ter as regras correspondidas com mais frequência antes das regras menos comuns, com a última regra na seção bloqueando e registrando todos os pacotes para essa interface e direção.</para>

      <para>Este conjunto de regras define a seção de saída da interface pública denominada <filename>dc0</filename>. Essas regras mantêm o estado e identificam os serviços específicos que os sistemas internos estão autorizados para acesso público à Internet. Todas as regras usam <literal>quick</literal> e especificam os números de porta apropriados e, quando aplicável, os endereços de destino.</para>

      <programlisting># interface facing Internet (outbound)
# Matches session start requests originating from or behind the
# firewall, destined for the Internet.

# Allow outbound access to public DNS servers.
# Replace x.x.x. with address listed in /etc/resolv.conf.
# Repeat for each DNS server.
pass out quick on dc0 proto tcp from any to x.x.x. port = 53 flags S keep state
pass out quick on dc0 proto udp from any to xxx port = 53 keep state

# Allow access to ISP's specified DHCP server for cable or DSL networks.
# Use the first rule, then check log for the IP address of DHCP server.
# Then, uncomment the second rule, replace z.z.z.z with the IP address,
# and comment out the first rule
pass out log quick on dc0 proto udp from any to any port = 67 keep state
#pass out quick on dc0 proto udp from any to z.z.z.z port = 67 keep state

# Allow HTTP and HTTPS
pass out quick on dc0 proto tcp from any to any port = 80 flags S keep state
pass out quick on dc0 proto tcp from any to any port = 443 flags S keep state

# Allow email
pass out quick on dc0 proto tcp from any to any port = 110 flags S keep state
pass out quick on dc0 proto tcp from any to any port = 25 flags S keep state

# Allow NTP
pass out quick on dc0 proto tcp from any to any port = 37 flags S keep state

# Allow FTP
pass out quick on dc0 proto tcp from any to any port = 21 flags S keep state

# Allow SSH
pass out quick on dc0 proto tcp from any to any port = 22 flags S keep state

# Allow ping
pass out quick on dc0 proto icmp from any to any icmp-type 8 keep state

# Block and log everything else
block out log first quick on dc0 all</programlisting>

      <para>Neste exemplo de regras na seção de entrada da interface pública todos os pacotes indesejáveis são bloqueados primeiro. Isso reduz o número de pacotes registrados pela última regra.</para>

      <programlisting># interface facing Internet (inbound)
# Block all inbound traffic from non-routable or reserved address spaces
block in quick on dc0 from 192.168.0.0/16 to any    #RFC 1918 private IP
block in quick on dc0 from 172.16.0.0/12 to any     #RFC 1918 private IP
block in quick on dc0 from 10.0.0.0/8 to any        #RFC 1918 private IP
block in quick on dc0 from 127.0.0.0/8 to any       #loopback
block in quick on dc0 from 0.0.0.0/8 to any         #loopback
block in quick on dc0 from 169.254.0.0/16 to any    #DHCP auto-config
block in quick on dc0 from 192.0.2.0/24 to any      #reserved for docs
block in quick on dc0 from 204.152.64.0/23 to any   #Sun cluster interconnect
block in quick on dc0 from 224.0.0.0/3 to any       #Class D &amp; E multicast

# Block fragments and too short tcp packets
block in quick on dc0 all with frags
block in quick on dc0 proto tcp all with short

# block source routed packets
block in quick on dc0 all with opt lsrr
block in quick on dc0 all with opt ssrr

# Block OS fingerprint attempts and log first occurrence
block in log first quick on dc0 proto tcp from any to any flags FUP

# Block anything with special options
block in quick on dc0 all with ipopts

# Block public pings and ident
block in quick on dc0 proto icmp all icmp-type 8
block in quick on dc0 proto tcp from any to any port = 113

# Block incoming Netbios services
block in log first quick on dc0 proto tcp/udp from any to any port = 137
block in log first quick on dc0 proto tcp/udp from any to any port = 138
block in log first quick on dc0 proto tcp/udp from any to any port = 139
block in log first quick on dc0 proto tcp/udp from any to any port = 81</programlisting>

      <para>Sempre que houver mensagens de log em uma regra com a opção <literal>log first</literal>, execute <command>ipfstat -hio</command> para saber quantas vezes a regra foi correspondida. Um grande número de correspondências pode indicar que o sistema está sob ataque.</para>

      <para>O restante das regras na seção de entrada define quais conexões podem ser iniciadas a partir da Internet. A última regra nega todas as conexões que não foram explicitamente permitidas pelas regras anteriores desta seção.</para>

      <programlisting># Allow traffic in from ISP's DHCP server. Replace z.z.z.z with
# the same IP address used in the outbound section.
pass in quick on dc0 proto udp from z.z.z.z to any port = 68 keep state

# Allow public connections to specified internal web server
pass in quick on dc0 proto tcp from any to x.x.x.x port = 80 flags S keep state

# Block and log only first occurrence of all remaining traffic.
block in log first quick on dc0 all</programlisting>
    </sect2>

    <sect2>
      <title>Configurando o <acronym>NAT</acronym></title>

      <indexterm><primary>NAT</primary></indexterm>

      <indexterm><primary>IP masquerading</primary> <see>NAT</see></indexterm>

      <indexterm><primary>network address translation</primary> <see>NAT</see></indexterm>

      <indexterm><primary><command>ipnat</command></primary></indexterm>

      <para>Para ativar o <acronym>NAT</acronym>, adicione estas instruções ao arquivo <filename>/etc/rc.conf</filename> e especifique o nome do arquivo que contém as regras de <acronym>NAT</acronym>:</para>

      <programlisting>gateway_enable="YES"
ipnat_enable="YES"
ipnat_rules="/etc/ipnat.rules"</programlisting>

      <para>As regras de <acronym>NAT</acronym> são flexíveis e podem realizar muitas coisas diferentes para atender às necessidades dos usuários comerciais e domésticos. A sintaxe da regra apresentada aqui foi simplificada para demonstrar um uso comum. Para obter uma descrição completa da sintaxe da regra, consulte <citerefentry><refentrytitle>ipnat</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>

      <para>A sintaxe básica para uma regra <acronym>NAT</acronym> é a seguinte, onde <literal>map</literal> inicia a regra e <replaceable>IF</replaceable> deve ser substituído pelo nome da interface externa:</para>

      <programlisting>map <replaceable>IF</replaceable> <replaceable>LAN_IP_RANGE</replaceable> -&gt; <replaceable>PUBLIC_ADDRESS</replaceable></programlisting>

      <para>O <replaceable>LAN_IP_RANGE</replaceable> é o intervalo de endereços <acronym>IP</acronym> usados pelos clientes internos. Geralmente, é um intervalo de endereços privados, como <systemitem class="ipaddress">192.168.1.0/24</systemitem>. O <replaceable>PUBLIC_ADDRESS</replaceable> pode ser o endereço <acronym>IP</acronym> externo estático ou a palavra-chave <literal>0/32</literal> que representa o endereço <acronym>IP</acronym> atribuído para <replaceable>IF</replaceable>.</para>

      <para>No <application>IPF</application>, quando um pacote chega ao firewall a partir da <acronym>LAN</acronym> com um destino público, ele primeiro passa pelas regras de saída do conjunto de regras do firewall. Em seguida, o pacote é passado para o conjunto de regras <acronym>NAT</acronym>, o qual é lido de cima para baixo, onde a primeira regra correspondente ganha. O <application>IPF</application> testa cada regra de <acronym>NAT</acronym> em relação ao nome da interface e ao endereço <acronym>IP</acronym> de origem do pacote. Quando o nome da interface de um pacote corresponde a uma regra <acronym>NAT</acronym>, o endereço <acronym>IP</acronym> de origem do pacote na <acronym>LAN</acronym> privada é verificado para ver se ele está dentro do intervalo de endereços <acronym>IP</acronym> especificado em <replaceable>LAN_IP_RANGE</replaceable>. Se corresponder, o pacote tem seu endereço <acronym>IP</acronym> de origem reescrito com o endereço <acronym>IP</acronym> público especificado por <replaceable>PUBLIC_ADDRESS</replaceable>. O <application>IPF</application> adiciona uma entrada em sua tabela <acronym>NAT</acronym> interna para que, quando o pacote retornar da Internet, possa ser mapeado de volta para seu endereço <acronym>IP</acronym> privado original antes de ser passado para as regras de firewall para processamento adicional.</para>

      <para>Para redes que possuem um grande número de sistemas internos ou várias sub-redes, o processo de afunilar todo endereço <acronym>IP</acronym> em um único endereço <acronym>IP</acronym> público se torna um problema de recursos. Dois métodos estão disponíveis para aliviar esse problema.</para>

      <para>O primeiro método é atribuir um intervalo de portas para usar como portas de origem. Adicionando a palavra-chave <literal>portmap</literal>, o <acronym>NAT</acronym> pode ser direcionado para usar apenas portas de origem no intervalo especificado:</para>

      <programlisting>map dc0 192.168.1.0/24 -&gt; 0/32 portmap tcp/udp 20000:60000</programlisting>

      <para>Como alternativa, use a palavra-chave <literal>auto</literal> que informa ao <acronym>NAT</acronym> para determinar as portas que estão disponíveis para uso:</para>

      <programlisting>map dc0 192.168.1.0/24 -&gt; 0/32 portmap tcp/udp auto</programlisting>

      <para>O segundo método é usar um pool de endereços públicos. Isso é útil quando existem muitos clientes na <acronym>LAN</acronym> para para usar um único endereço público e um bloco de endereços públicos de <acronym>IP</acronym> está disponível. Esses endereços públicos podem ser usados como um pool do qual o <acronym>NAT</acronym> seleciona um endereço <acronym>IP</acronym> à medida que o endereço de um pacote é mapeado ao sair.</para>

      <para>O intervalo de endereços <acronym>IP</acronym> públicos pode ser especificado usando uma notação de netmask ou <acronym>CIDR</acronym>. Essas duas regras são equivalentes:</para>

      <programlisting>map dc0 192.168.1.0/24 -&gt; 204.134.75.0/255.255.255.0
map dc0 192.168.1.0/24 -&gt; 204.134.75.0/24</programlisting>

      <para>Uma prática comum é ter um servidor web ou servidor de email publicamente acessível isolado a um segmento de rede interno. O tráfego desses servidores ainda precisa passar por <acronym>NAT</acronym>, mas o redirecionamento de porta é necessário para direcionar o tráfego de entrada para o servidor correto. Por exemplo, para mapear um servidor web usando o endereço interno <systemitem class="ipaddress">10.0.10.25</systemitem> para seu endereço <acronym>IP</acronym> público <systemitem class="ipaddress">20.20.20.5</systemitem>, use esta regra:</para>

      <programlisting>rdr dc0 20.20.20.5/32 port 80 -&gt; 10.0.10.25 port 80</programlisting>

      <para>Se for o único servidor web, essa regra também funcionará, pois redirecionará todas as solicitações <acronym>HTTP</acronym> externas para <literal>10.0.10.25</literal>:</para>

      <programlisting>rdr dc0 0.0.0.0/0 port 80 -&gt; 10.0.10.25 port 80</programlisting>

      <para>O <application>IPF</application> possui um proxy <acronym>FTP</acronym> embutido que pode ser usado com o <acronym>NAT</acronym>. Ele monitora todo o tráfego de saída de conexões ativa ou passiva de <acronym>FTP</acronym> e cria dinamicamente regras de filtro temporário contendo o número de porta usado pelo canal de dados <acronym>FTP</acronym>. Isso elimina a necessidade de abrir grandes intervalos de portas altas para conexões de <acronym>FTP</acronym>.</para>

      <para>Neste exemplo, a primeira regra chama o proxy no tráfego de saída <acronym>FTP</acronym> da <acronym>LAN</acronym> interna. A segunda regra passa o tráfego de <acronym>FTP</acronym> do firewall para a Internet, e a terceira regra lida com todo o tráfego não <acronym>FTP</acronym> da <acronym>LAN</acronym> interna:</para>

      <programlisting>map dc0 10.0.10.0/29 -&gt; 0/32 proxy port 21 ftp/tcp
map dc0 0.0.0.0/0 -&gt; 0/32 proxy port 21 ftp/tcp
map dc0 10.0.10.0/29 -&gt; 0/32</programlisting>

      <para>As regras <literal>map</literal> de <acronym>FTP</acronym> vem antes da regra <acronym>NAT</acronym>, de modo que quando um pacote corresponder a uma regra <acronym>FTP</acronym>, o proxy <acronym>FTP</acronym> crie regras temporárias de filtragem para permitir que os pacotes da sessão <acronym>FTP</acronym> sejam liberados e que passem pelo <acronym>NAT</acronym>. Todos os pacotes de rede local que não sejam <acronym>FTP</acronym> não corresponderão às regras de <acronym>FTP</acronym>, mas serão liberados pelo <acronym>NAT</acronym> se corresponderem à terceira regra.</para>

      <para>Sem o proxy <acronym>FTPem</acronym>, as seguintes regras de firewall seriam necessárias. Note que sem o proxy, todas as portas acima de <literal>1024</literal> precisam ser permitidas:</para>

      <programlisting># Allow out LAN PC client FTP to public Internet
# Active and passive modes
pass out quick on rl0 proto tcp from any to any port = 21 flags S keep state

# Allow out passive mode data channel high order port numbers
pass out quick on rl0 proto tcp from any to any port &gt; 1024 flags S keep state

# Active mode let data channel in from FTP server
pass in quick on rl0 proto tcp from any to any port = 20 flags S keep state</programlisting>

      <para>Sempre que o arquivo contendo as regras de <acronym>NAT</acronym> for editado, execute <command>ipnat</command> com <option>-CF</option> para excluir as regras atuais de <acronym>NAT</acronym> e liberar o conteúdo da tabela de tradução dinâmica. Inclua <option>-f</option> e especifique o nome do conjunto de regras <acronym>NAT</acronym> para carregar:</para>

      <screen><prompt>#</prompt> <userinput>ipnat -CF -f /etc/ipnat.rules</userinput></screen>

      <para>Para exibir as estatísticas de <acronym>NAT</acronym>:</para>

      <screen><prompt>#</prompt> <userinput>ipnat -s</userinput></screen>

      <para>Para listar os mapeamentos atuais da tabela <acronym>NAT</acronym>:</para>

      <screen><prompt>#</prompt> <userinput>ipnat -l</userinput></screen>

      <para>Para ativar o modo verbose e exibir informações relacionadas ao processamento de regras, regras ativas e registros nas tabelas:</para>

      <screen><prompt>#</prompt> <userinput>ipnat -v</userinput></screen>
    </sect2>
<!--
This section is confusing and may no longer be needed with new syntax.
    <sect2 xml:id="firewalls-ipf-rules-script">
      <title>Building the Rule Script with Symbolic
	Substitution</title>

      <para>Some experienced IPF users create a file containing the
	rules and code them in a manner compatible with running them
	as a script with symbolic substitution.  The major benefit
	of doing this is that only the value associated with the
	symbolic name needs to be changed, and when the script is
	run all the rules containing the symbolic name will have the
	value substituted in the rules.  Being a script, symbolic
	substitution can be used to code frequently used values and
	substitute them in multiple rules.  This can be seen in the
	following example.</para>

      <para>The script syntax used here is compatible with the
	&man.sh.1;, &man.csh.1;, and &man.tcsh.1; shells.</para>

      <para>Symbolic substitution fields are prefixed with a
	<literal>&dollar;</literal>.</para>

      <para>Symbolic fields do not have the &dollar; prefix.</para>

      <para>The value to populate the symbolic field must be enclosed
	between double quotes (<literal>"</literal>).</para>

      <para>Start the rule file with something like this:</para>

      <programlisting>############# Start of IPF rules script ########################

oif="dc0"            # name of the outbound interface
odns="192.0.2.11"    # ISP's DNS server IP address
myip="192.0.2.7"     # my static IP address from ISP
ks="keep state"
fks="flags S keep state"

# You can choose between building /etc/ipf.rules file
# from this script or running this script "as is".
#
# Uncomment only one line and comment out another.
#
# 1) This can be used for building /etc/ipf.rules:
#cat &gt; /etc/ipf.rules &lt;&lt; EOF
#
# 2) This can be used to run script "as is":
/sbin/ipf -Fa -f - &lt;&lt; EOF

# Allow out access to my ISP's Domain name server.
pass out quick on &dollar;oif proto tcp from any to &dollar;odns port = 53 &dollar;fks
pass out quick on &dollar;oif proto udp from any to &dollar;odns port = 53 &dollar;ks

# Allow out non-secure standard www function
pass out quick on &dollar;oif proto tcp from &dollar;myip to any port = 80 &dollar;fks

# Allow out secure www function https over TLS SSL
pass out quick on &dollar;oif proto tcp from &dollar;myip to any port = 443 &dollar;fks
EOF
################## End of IPF rules script ########################</programlisting>

      <para>The rules are not important in this example as it instead
	focuses on how the symbolic substitution fields are populated.
	If this example was in a file named
	<filename>/etc/ipf.rules.script</filename>, these rules could
	be reloaded by running:</para>

      <screen>&prompt.root; <userinput>sh /etc/ipf.rules.script</userinput></screen>

      <para>There is one problem with using a rules file with embedded
	symbolics: IPF does not understand symbolic substitution, and
	cannot read such scripts directly.</para>

      <para>This script can be used in one of two ways:</para>

      <itemizedlist>
	<listitem>
	  <para>Uncomment the line that begins with
	    <literal>cat</literal>, and comment out the line that
	    begins with <literal>/sbin/ipf</literal>.  Place
	    <literal>ipfilter_enable="YES"</literal> into
	    <filename>/etc/rc.conf</filename>, and run the script
	    once after each modification to create or update
	    <filename>/etc/ipf.rules</filename>.</para>
	</listitem>

	<listitem>
	  <para>Disable <application>IPFILTER</application> in the
	    system startup scripts by adding
	    <literal>ipfilter_enable="NO"</literal>to
	    <filename>/etc/rc.conf</filename>.</para>

	  <para>Then, add a script like the following to
	    <filename>/usr/local/etc/rc.d/</filename>.  The script
	    should have an obvious name like
	    <filename>ipf.loadrules.sh</filename>, where the
	    <filename>.sh</filename> extension is mandatory.</para>

	  <programlisting>#!/bin/sh
sh /etc/ipf.rules.script</programlisting>

	  <para>The permissions on this script file must be read,
	    write, execute for owner
	    <systemitem class="username">root</systemitem>:</para>

	  <screen>&prompt.root; <userinput>chmod 700 /usr/local/etc/rc.d/ipf.loadrules.sh</userinput></screen>
	</listitem>
      </itemizedlist>

      <para>Now, when the system boots, the IPF rules will be
	loaded.</para>
    </sect2>
    -->
    <sect2>
      <title>Visualizando Estatísticas do <application>IPF</application></title>

      <indexterm><primary><command>ipfstat</command></primary></indexterm>

      <indexterm><primary><application>IPFILTER</application></primary> <secondary>statistics</secondary></indexterm>

      <para>O <application>IPF</application> inclui o <citerefentry><refentrytitle>ipfstat</refentrytitle><manvolnum>8</manvolnum></citerefentry> que pode ser usado para recuperar e exibir estatísticas das regras sendo utilizadas enquanto os pacotes passam pelo firewall. As estatísticas são acumuladas desde que o firewall foi iniciado pela última vez ou desde a última vez que foram redefinidas para zero usando <command>ipf -Z</command>.</para>

      <para>A saída padrão do <command>ipfstat</command> é semelhante a esta:</para>

      <screen>input packets: blocked 99286 passed 1255609 nomatch 14686 counted 0
 output packets: blocked 4200 passed 1284345 nomatch 14687 counted 0
 input packets logged: blocked 99286 passed 0
 output packets logged: blocked 0 passed 0
 packets logged: input 0 output 0
 log failures: input 3898 output 0
 fragment state(in): kept 0 lost 0
 fragment state(out): kept 0 lost 0
 packet state(in): kept 169364 lost 0
 packet state(out): kept 431395 lost 0
 ICMP replies: 0 TCP RSTs sent: 0
 Result cache hits(in): 1215208 (out): 1098963
 IN Pullups succeeded: 2 failed: 0
 OUT Pullups succeeded: 0 failed: 0
 Fastroute successes: 0 failures: 0
 TCP cksum fails(in): 0 (out): 0
 Packet log flags set: (0)</screen>

      <para>Várias opções estão disponíveis. Quando executado com <option>-i</option> para entrada ou <option>-o</option> para saída, o comando recuperará e exibirá a lista apropriada de regras de filtro atualmente instaladas e em uso pelo kernel. Para também ver os números das regras, inclua <option>-n</option>. Por exemplo, <command>ipfstat -on</command> exibe a tabela de regras de saída com os números de regra:</para>

      <screen>@1 pass out on xl0 from any to any
@2 block out on dc0 from any to any
@3 pass out quick on dc0 proto tcp/udp from any to any keep state</screen>

      <para>Inclua <option>-h</option> para prefixar cada regra com uma contagem de quantas vezes a regra foi utilizada. Por exemplo, <command>ipfstat -oh</command> exibe a tabela de regras internas de saída, prefixando cada regra com sua contagem de uso:</para>

      <screen>2451423 pass out on xl0 from any to any
354727 block out on dc0 from any to any
430918 pass out quick on dc0 proto tcp/udp from any to any keep state</screen>

      <para>Para exibir a tabela de estados em um formato similar ao <citerefentry><refentrytitle>top</refentrytitle><manvolnum>1</manvolnum></citerefentry>, use <command>ipfstat -t</command>. Quando o firewall está sob ataque, essa opção fornece a capacidade de identificar e ver os pacotes de ataque. As sub-flags opcionais dão a possibilidade de selecionar o <acronym>IP</acronym> destino ou origem, porta ou protocolo a ser monitorado em tempo real. Consulte <citerefentry><refentrytitle>ipfstat</refentrytitle><manvolnum>8</manvolnum></citerefentry> para detalhes.</para>
    </sect2>

    <sect2>
      <title>Log do <application>IPF</application></title>

      <indexterm><primary><command>ipmon</command></primary></indexterm>

      <indexterm><primary><application>IPFILTER</application></primary> <secondary>logging</secondary></indexterm>

      <para>O <application>IPF</application> fornece o <command>ipmon</command>, que pode ser usado para gravar as informações de log do firewall em um formato legível por humanos. Isso requer que as opções <literal>IPFILTER_LOG</literal> sejam primeiramente adicionadas a um kernel personalizado usando as instruções em <xref linkend="kernelconfig"/>.</para>

      <para>Esse comando geralmente é executado no modo daemon para fornecer um arquivo de log contínuo do sistema para que o registro de eventos passados possa ser revisado. Como o FreeBSD possui um recurso <citerefentry><refentrytitle>syslogd</refentrytitle><manvolnum>8</manvolnum></citerefentry> integrado para rotacionar automaticamente os logs do sistema, a instrução <literal>ipmon_flags</literal> no arquivo <filename>rc.conf</filename> por padrão utiliza <option>-Ds</option>:</para>

      <programlisting>ipmon_flags="-Ds" # D = start as daemon
                  # s = log to syslog
                  # v = log tcp window, ack, seq
                  # n = map IP &amp; port to names</programlisting>

      <para>O registro em log fornece a capacidade de revisar, após o fato, informações como quais pacotes foram descartados, de que endereços eles vieram e para onde estavam indo. Esta informação é útil para rastrear invasores.</para>

      <para>Uma vez que o recurso de criação de log esteja ativado no arquivo <filename>rc.conf</filename> e iniciado com o serviço <command>ipmon start</command>, o <application>IPF</application> irá registrar apenas as regras que contêm a palavra-chave <literal>log</literal>. O administrador do firewall decide quais regras no conjunto de regras devem ser logadas e normalmente apenas as regras de negação são registradas. É costume incluir a palavra-chave <literal>log</literal> na última regra do conjunto de regras. Isso possibilita ver todos os pacotes que não correspondem a nenhuma das regras do conjunto de regras.</para>

      <para>Por padrão, o modo <command>ipmon -Ds</command> usa <literal>local0</literal> como o recurso de log. Os níveis de registro a seguir podem ser usados para separar ainda mais os dados logados:</para>

      <screen>LOG_INFO - pacotes logados usando a palavra-chave "log" ao invés da ação  pass ou block.
LOG_NOTICE - pacotes logados que também são liberados
LOG_WARNING - pacotes logados que também são bloqueados
LOG_ERR - pacotes que foram logados e que podem ser considerados insuficientes devido a um cabeçalho incompleto</screen>

      <para>Para configurar o <application>IPF</application> para logar todos os dados em <filename>/var/log/ipfilter.log</filename>, primeiro crie o arquivo vazio:</para>

       <screen><prompt>#</prompt> <userinput>touch /var/log/ipfilter.log</userinput></screen>

      <para>Em seguida, para gravar todas as mensagens de log no arquivo especificado, inclua a seguinte instrução no arquivo <filename>/etc/syslog.conf</filename>:</para>

      <programlisting>local0.* /var/log/ipfilter.log</programlisting>

      <para>Para ativar as alterações e instruir o <citerefentry><refentrytitle>syslogd</refentrytitle><manvolnum>8</manvolnum></citerefentry> para ler o arquivo modificado <filename>/etc/syslog.conf</filename>, execute <command>service syslogd reload</command>.</para>

      <para>Não se esqueça de editar o <filename>/etc/newsyslog.conf</filename> para rotacionar o novo arquivo de log.</para>

      <para>As mensagens geradas pelo <command>ipmon</command> consistem em campos de dados separados por espaços em branco. Campos comuns a todas as mensagens são:</para>

      <orderedlist>
	<listitem>
	  <para>A data do recebimento do pacote.</para>
	</listitem>

	<listitem>
	  <para>O horário do recebimento do pacote. Isto está no formato HH:MM:SS.F, para horas, minutos, segundos e frações de segundo.</para>
	</listitem>

	<listitem>
	  <para>O nome da interface que processou o pacote.</para>
	</listitem>

	<listitem>
	  <para>O grupo e o número da regra no formato <literal>@0:17</literal>.</para>
	</listitem>

	<listitem>
	  <para>A ação: <literal>p</literal> para liberado (pass), <literal>b</literal> para bloqueado, <literal>S</literal> para um pacote com problema (short), <literal>n</literal> não corresponde a nenhuma regra e <literal>L</literal> para uma regra de log.</para>
	</listitem>

	<listitem>
	  <para>Os endereços escritos em três campos: o endereço de origem e porta separados por uma vírgula, o símbolo -&gt; , e o endereço e porta de destino. Por exemplo: <literal>209.53.17.22,80 -&gt; 198.73.220.17,1722</literal>.</para>
	</listitem>

	<listitem>
	  <para><literal>PR</literal> seguido pelo nome ou número do protocolo: por exemplo, <literal>PR tcp</literal>.</para>
	</listitem>

	<listitem>
	  <para><literal>len</literal> seguido pelo tamanho do cabeçalho e comprimento total do pacote: por exemplo, <literal>len 20 40</literal>.</para>
	</listitem>
      </orderedlist>

      <para>Se o pacote for um pacote <acronym>TCP</acronym>, haverá um campo adicional começando com um hífen seguido por letras correspondentes a quaisquer flags que foram configuradas. Consulte <citerefentry><refentrytitle>ipf</refentrytitle><manvolnum>5</manvolnum></citerefentry> para obter uma lista de letras e suas flags.</para>

      <para>Se o pacote for um pacote <acronym>ICMP</acronym>, haverá dois campos no final: o primeiro sempre sendo <quote>icmp</quote> e o próximo sendo a mensagem <acronym>ICMP</acronym> e sub-tipo de mensagem, separados por uma barra. Por exemplo: <literal>icmp 3/3</literal> para uma mensagem port unreachable.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="firewalls-blacklistd">
    <title>Blacklistd</title>

    <para>O Blacklistd é um daemon que escuta sockets para receber notificações de outros daemons sobre tentativas de conexão que falharam ou foram bem-sucedidas. É mais amplamente utilizado no bloqueio de muitas tentativas de conexão em portas abertas. Um exemplo excelente é o <application>SSH</application>, executado na Internet, recebendo muitas solicitações de conexão de bots ou scripts tentando adivinhar senhas e obter acesso. Utilizando <application>blacklistd</application>, o daemon pode notificar o firewall para criar uma regra de filtro para bloquear tentativas excessivas de conexão de uma única origem após várias tentativas. O Blacklistd foi desenvolvido pela primeira vez no NetBSD e apareceu na versão 7. O FreeBSD 11 importou o blacklistd do NetBSD.</para>

    <para>Este capítulo descreve como instalar o blacklistd, configurá-lo e fornece exemplos de como usá-la. Os leitores devem estar familiarizados com os conceitos básicos de firewall, como regras. Para detalhes, consulte o capítulo sobre firewall. O PF é usado nos exemplos, mas outros firewalls disponíveis no FreeBSD também devem funcionar com o blacklistd.</para>

    <sect2>
      <title>Habilitando a Blacklistd</title>

      <para>A configuração principal do blacklistd é armazenada em <citerefentry><refentrytitle>blacklistd.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>. Várias opções de linha de comando também estão disponíveis para alterar o comportamento em tempo de execução do blacklistd. Para persistir as configurações em uma reinicialização do sistema, deve se armazenar as opções em <filename>/etc/blacklistd.conf</filename>. Para ativar o daemon durante a inicialização do sistema, adicione a linha <literal>blacklistd_enable</literal> no <filename>/etc/rc.conf</filename> assim:</para>

	<screen><prompt>#</prompt> <userinput>sysrc blacklistd_enable=yes</userinput></screen>

	<para>Para iniciar o serviço manualmente, execute este comando:</para>

	<screen><prompt>#</prompt> <userinput>service blacklistd start</userinput></screen>
    </sect2>

    <sect2>
      <title>Criando um conjunto de regras no Blacklistd</title>

      <para>As regras do blacklistd são configuradas em <citerefentry><refentrytitle>blacklistd.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry> com uma opção por linha. Cada regra contém uma tupla separada por espaços ou tabulações. As regras pertencem a um <literal>local</literal> ou a um <literal>remote</literal>, que se aplica à máquina em que o blacklistd está sendo executado ou a uma origem externa, respectivamente.</para>

      <sect3>
	<title>Regras Locais</title>

	<para>Um exemplo de entrada blacklistd.conf para uma regra local se parece com isso:</para>

	<programlisting>[local]
ssh             stream  *       *               *       3       24h</programlisting>

	<para>Todas as regras que seguem a seção <literal>[local]</literal> são tratadas como regras locais (que é o padrão), aplicadas à máquina local. Quando uma seção <literal>[remote]</literal> é encontrada, todas as regras a seguir são tratadas como regras de máquina remota.</para>

	<para>Sete campos definem uma regra separada por tabulações ou espaços. Os quatro primeiros campos identificam o tráfego que deve estar na lista negra. Os três campos a seguir definem o comportamento do backlistd. Os curingas são indicados como asteriscos (<literal>*</literal>), correspondendo a qualquer coisa nesse campo. O primeiro campo define a localização. Nas regras locais, essas são as portas de rede. A sintaxe para o campo local é a seguinte:</para>

	  <programlisting>[<replaceable>address</replaceable>|<replaceable>interface</replaceable>][/<replaceable>mask</replaceable>][:<replaceable>port</replaceable>]</programlisting>

	  <para>Os endereços podem ser especificados como IPv4 no formato numérico ou IPv6 entre colchetes. Um nome de interface como <literal><replaceable>em0</replaceable></literal> também pode ser usado.</para>

	  <para>O tipo de socket é definido pelo segundo campo. Os socket TCP são do tipo <literal>stream</literal>, enquanto UDP é indicado como <literal>dgram</literal>. O exemplo acima usa TCP, pois o SSH está usando esse protocolo.</para>

	  <para>Um protocolo pode ser usado no terceiro campo de uma regra de lista negra. Os seguintes protocolos podem ser usados: <literal>tcp</literal>, <literal>udp</literal>, <literal>tcp6</literal>, <literal>udp6</literal> ou numérico. Um curinga, como no exemplo, geralmente é usado para corresponder a todos os protocolos, a menos que haja um motivo para distinguir o tráfego por um determinado protocolo.</para>

	  <para>No quarto campo, o usuário ou proprietário efetivo do processo daemon que está reportando o evento é definido. O nome de usuário ou o <acronym>UID</acronym> pode ser usado aqui, bem como um curinga (veja a regra de exemplo acima).</para>

	  <para>O nome da regra do packet filter é declarado pelo quinto campo, que inicia a parte de comportamento da regra. Por padrão, blacklistd coloca todos os blocos sob uma âncora pf chamada <literal>blacklistd</literal> em <filename>pf.conf</filename> assim:</para>

	  <programlisting>anchor "blacklistd/*" in on $ext_if
block in
pass out</programlisting>

	  <para>Para blacklists separadas, um nome de âncora pode ser usado neste campo. Em outros casos, o curinga será suficiente. Quando um nome começa com um hífen (<literal>-</literal>), significa que uma âncora com o nome de regra padrão precedido deve ser usada. Uma modificação do exemplo acima usando o hífen ficaria assim:</para>

	  <programlisting>ssh             stream  *       *               -ssh       3       24h</programlisting>

	  <para>Com essa regra, quaisquer novas regras de blacklist são adicionadas a uma âncora chamada <literal>blacklistd-ssh</literal>.</para>

	  <para>Para bloquear sub-redes inteiras para uma única violação de regra, um <literal>/</literal> no nome da regra pode ser usado. Isso faz com que a parte restante do nome seja interpretada como a máscara a ser aplicada ao endereço especificado na regra. Por exemplo, esta regra bloquearia todos os endereços adjacentes a <literal>/24</literal>.</para>

	  <programlisting>22              stream  tcp       *               */24    3       24h</programlisting>

	  <note>
	    <para>É importante especificar o protocolo apropriado aqui. O IPv4 e o IPv6 tratam o /24 de maneira diferente, é por isso que <literal>*</literal> não pode ser usado no terceiro campo para esta regra.</para>
	  </note>

	  <para>Esta regra define que, se qualquer host dessa rede estiver se comportando mal, todo o resto da rede também será bloqueado.</para>

	  <para>O sexto campo, chamado <literal>nfail</literal>, define o número de falhas de login necessárias para colocar na blacklist o IP remoto em questão. Quando um curinga é usado nessa posição, isso significa que o bloqueio nunca irá acontecer. Na regra de exemplo acima, um limite de três é definido, o que significa que, após três tentativas de logon no <application>SSH</application> em uma conexão, o IP é bloqueado.</para>

	  <para>O último campo em uma definição de regra do blacklistd especifica por quanto tempo um host ficará na lista negra. A unidade padrão é segundos, mas sufixos como <literal>m</literal>, <literal>h</literal> e <literal>d</literal> também podem ser especificados por minutos, horas e dias, respectivamente.</para>

	  <para>A regra de exemplo na íntegra significa que, após três vezes a autenticação no <application>SSH</application>, resultará em uma nova regra de bloqueio de PF para esse host. As correspondências de regras são realizadas verificando primeiro as regras locais, uma após a outra, da mais específica à menos específica. Quando ocorre uma correspondência, as regras <literal>remote</literal> são aplicadas e o nome <literal>nfail</literal> e os campos de desativação são alterados pela regra <literal>remote</literal> correspondente.</para>
	</sect3>

	<sect3>
	  <title>Regras Remotas</title>

	  <para>As regras remotas são usadas para especificar como o blacklistd muda seu comportamento, dependendo do host remoto que está sendo avaliado no momento. Cada campo em uma regra remota é o mesmo que em uma regra local. A única diferença está na maneira como o blacklistd os usa. Para explicar, esta regra de exemplo é usada:</para>

	  <programlisting>[remote]
203.0.113.128/25 *      *       *               =/25    =       48h</programlisting>

	  <para>O campo de endereço pode ser um endereço IP (v4 ou v6), uma porta ou ambas. Isso permite definir regras especiais para um intervalo de endereços remotos específico, como neste exemplo. Os campos para tipo, protocolo e proprietário são identicamente interpretados como na regra local.</para>

	  <para>Porém, os campos de nome são diferentes: o sinal de igual (<literal>=</literal>) em uma regra remota diz ao blacklistd para usar o valor da regra local correspondente. Isso significa que a entrada da regra de firewall é obtida e o prefixo <systemitem class="netmask">/25</systemitem> (uma máscara de rede <systemitem class="netmask">255.255.255.128</systemitem>) é adicionada. Quando uma conexão desse intervalo de endereços é colocada na lista negra, toda a sub-rede é afetada. Um nome de âncora PF também pode ser usado aqui; nesse caso, o blacklisted adicionará regras para esse bloco de endereços à âncora desse nome. A tabela padrão é usada quando um curinga é especificado.</para>

	  <para>Um número personalizado de falhas na coluna <literal>nfail</literal> pode ser definido para um endereço. Isso é útil para exceções a uma regra específica, talvez para permitir a alguém uma aplicação menos rigorosa de regras ou um pouco mais de clemência nas tentativas de login. O bloqueio é desativado quando um asterisco é usado neste sexto campo.</para>

	  <para>As regras remotas permitem uma aplicação mais rigorosa dos limites das tentativas de logon, em comparação com as tentativas provenientes de uma rede local como um escritório.</para>
	</sect3>
      </sect2>

      <sect2>
	<title>Configuração do cliente no Blacklistd</title>

	<para>Existem alguns pacotes de software no FreeBSD que podem utilizar a funcionalidade do blacklistd. Os dois mais proeminentes são <citerefentry><refentrytitle>ftpd</refentrytitle><manvolnum>8</manvolnum></citerefentry> e <citerefentry><refentrytitle>sshd</refentrytitle><manvolnum>8</manvolnum></citerefentry> para bloquear tentativas excessivas de conexão. Para ativar o blacklistd no daemon SSH, adicione a seguinte linha ao <filename>/etc/ssh/sshd_config</filename>:</para>

	<programlisting>UseBlacklist yes</programlisting>

	<para>Reinicie o sshd posteriormente para que essas alterações entrem em vigor.</para>

	<para>A lista negra do <citerefentry><refentrytitle>ftpd</refentrytitle><manvolnum>8</manvolnum></citerefentry> é ativada usando <literal>-B</literal>, em <filename>/etc/inetd.conf</filename> ou como uma flag no <filename>/etc/rc.conf</filename> assim:</para>

	<programlisting>ftpd_flags="-B"</programlisting>

	<para>Isso é tudo o que é necessário para que esses programas conversem com o blacklistd.</para>
      </sect2>

      <sect2>
	<title>Gerenciamento do Blacklistd</title>

	<para>O Blacklistd fornece ao usuário um utilitário de gerenciamento chamado <citerefentry><refentrytitle>blacklistctl</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Ele exibe endereços e redes bloqueados que estão na lista negra pelas regras definidas em <citerefentry><refentrytitle>blacklistd.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>. Para ver a lista de hosts atualmente bloqueados, use <command>dump</command> combinado com <option>-b</option> assim.</para>

	<screen><prompt>#</prompt> <userinput>blacklistctl dump -b</userinput>
      address/ma:port id      nfail   last access
213.0.123.128/25:22   OK      6/3     2019/06/08 14:30:19</screen>

	<para>Este exemplo mostra que houve 6 de três tentativas permitidas na porta 22 provenientes do intervalo de endereços <systemitem class="netmask">213.0.123.128/25</systemitem>. Há mais tentativas listadas do que são permitidas porque o SSH permite que um cliente tente vários logins em uma única conexão TCP. Uma conexão que está em andamento no momento não é interrompida pelo blacklistd. A última tentativa de conexão está listada na coluna <literal>last access</literal> da saída.</para>

	<para>Para ver o tempo restante em que esse host estará na lista negra, adicione <option>-r</option> ao comando anterior.</para>

	<screen><prompt>#</prompt> <userinput>blacklistctl dump -br</userinput>
      address/ma:port id      nfail   remaining time
213.0.123.128/25:22   OK      6/3     36s</screen>

	<para>Neste exemplo, restam 36 segundos para que este host não seja mais bloqueado.</para>
      </sect2>

      <sect2>
	<title>Removendo hosts da lista de bloqueios</title>

	<para>Às vezes, é necessário remover um host da lista de bloqueios antes que o tempo restante expire. Infelizmente, não há funcionalidade no blacklistd para fazer isso. No entanto, é possível remover o endereço da tabela PF usando pfctl. Para cada porta bloqueada, existe uma âncora filha dentro da âncora do blacklistd definida em <filename>/etc/pf.conf</filename>. Por exemplo, se houver uma âncora filha para bloquear a porta 22, ela será chamada <literal>blacklistd/22</literal>. Há uma tabela dentro dessa âncora filha que contém os endereços bloqueados. Essa tabela é chamada de port seguida pelo número da porta. Neste exemplo, ele seria chamada de <literal>port22</literal>. Com essas informações em mãos, agora é possível usar o <citerefentry><refentrytitle>pfctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> para exibir todos os endereços listados desta maneira:</para>

	<screen><prompt>#</prompt> <userinput>pfctl -a <replaceable>blacklistd/22</replaceable> -t <replaceable>port22</replaceable> -T show</userinput>
...
213.0.123.128/25
...</screen>

	<para>Depois de identificar o endereço a ser desbloqueado da lista, o seguinte comando o remove da lista:</para>

	    <screen><prompt>#</prompt> <userinput>pfctl -a <replaceable>blacklistd/22</replaceable> -t <replaceable>port22</replaceable> -T delete <replaceable>213.0.123.128/25</replaceable></userinput></screen>

	<para>O endereço agora foi removido do PF, mas ainda será exibido no blacklistctl, pois ele não conhece nenhuma alteração feita no PF. A entrada no banco de dados do blacklistd expirará e será removida de sua saída eventualmente. A entrada será adicionada novamente se o host estiver correspondendo a uma das regras de bloqueio no blacklistd novamente.</para>
      </sect2>
    </sect1>
</chapter>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<chapter version="5.0" xml:id="advanced-networking">
  <title>Rede Avançada</title>

  <sect1 xml:id="advanced-networking-synopsis">
    <title>Sinopse</title>

    <para>Este capítulo aborda vários tópicos avançados de rede.</para>

    <para>Depois de ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>O básico de gateways e rotas.</para>
      </listitem>

      <listitem>
	<para>Como configurar o USB tethering.</para>
      </listitem>

      <listitem>
	<para>Como configurar os dispositivos <trademark class="registered">IEEE</trademark> 802.11 e <trademark class="registered">Bluetooth</trademark>.</para>
      </listitem>

      <listitem>
	<para>Como fazer o FreeBSD atuar como uma Bridge.</para>
      </listitem>

      <listitem>
	<para>Como configurar a inicialização via <acronym>PXE</acronym> na rede.</para>
      </listitem>

      <listitem>
	<para>Como configurar o <acronym>IPv6</acronym> em uma máquina FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como habilitar e utilizar os recursos do Protocolo <acronym>CARP</acronym> (Common Address Redundancy Protocol) no FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como configurar múltiplas <acronym>VLANs</acronym> no FreeBSD.</para>
      </listitem>

      <listitem>
	<para>Como configurar um fone de ouvido bluetooth.</para>
      </listitem>
    </itemizedlist>

    <para>Antes de ler este capítulo, você deve:</para>

    <itemizedlist>
      <listitem>
	<para>Entender os fundamentos dos scripts <filename>/etc/rc</filename>.</para>
      </listitem>

      <listitem>
	<para>Estar familiarizado com a terminologia básica de rede.</para>
      </listitem>

      <listitem>
	<para>Saber como configurar e instalar um novo kernel do FreeBSD (<xref linkend="kernelconfig"/>).</para>
      </listitem>

      <listitem>
	<para>Saber como instalar software adicional de terceiros (<xref linkend="ports"/>).</para>
      </listitem>

    </itemizedlist>
  </sect1>

  <sect1 xml:id="network-routing">
    <info>
      <title>Gateways e Rotas</title>

      <authorgroup>
	<author><personname> <firstname>Coranth</firstname> <surname>Gryphon</surname> </personname> <contrib>Contribuição de</contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>routing</primary></indexterm>
    <indexterm><primary>gateway</primary></indexterm>
    <indexterm><primary>subnet</primary></indexterm>

    <para>O <firstterm>roteamento</firstterm> é o mecanismo que permite que um sistema encontre o caminho da rede para outro sistema. Uma <firstterm>rota</firstterm> é um par definido de endereços que representam o <quote>destino</quote> e um <quote>gateway</quote>. A rota indica que, ao tentar chegar ao destino especificado, você deverá enviar os pacotes pelo gateway especificado. Existem três tipos de destinos: hosts individuais, sub-redes e <quote>padrão</quote>. A <quote>rota padrão</quote> é usada se nenhuma outra rota for aplicada. Existem também três tipos de gateways: hosts individuais, interfaces, também chamados de links, e endereços de hardware Ethernet (<acronym>MAC</acronym>). Rotas conhecidas são armazenadas em uma tabela de roteamento.</para>

    <para>Esta seção fornece uma visão geral dos fundamentos de roteamento. Em seguida, ele demonstra como configurar um sistema FreeBSD como um roteador e oferece algumas dicas de solução de problemas.</para>

    <sect2 xml:id="network-routing-default">
      <title>Fundamentos de roteamento</title>

      <para>Para ver a tabela de roteamento de um sistema FreeBSD, use <citerefentry><refentrytitle>netstat</refentrytitle><manvolnum>1</manvolnum></citerefentry>:</para>

      <screen><prompt>%</prompt> <userinput>netstat -r</userinput>
Routing tables

Internet:
Destination      Gateway            Flags     Refs     Use     Netif Expire
default          outside-gw         UGS        37      418       em0
localhost        localhost          UH          0      181       lo0
test0            0:e0:b5:36:cf:4f   UHLW        5    63288       re0     77
10.20.30.255     link#1             UHLW        1     2421
example.com      link#1             UC          0        0
host1            0:e0:a8:37:8:1e    UHLW        3     4601       lo0
host2            0:e0:a8:37:8:1e    UHLW        0        5       lo0 =&gt;
host2.example.com link#1            UC          0        0
224              link#1             UC          0        0</screen>

      <para>As entradas neste exemplo são as seguintes:</para>

      <variablelist>
	<varlistentry>
	  <term>padrão</term>
	  <listitem>
	    <para>A primeira rota nesta tabela especifica a rota <literal>padrão</literal>. Quando o sistema local precisa estabelecer uma conexão com um host remoto, ele verifica a tabela de roteamento para determinar se existe um caminho conhecido. Se o host remoto corresponder a uma entrada na tabela, o sistema verificará se pode se conectar usando a interface especificada nessa entrada.</para>

	    <para>Se o destino não corresponder a uma entrada ou se todos os caminhos conhecidos falharem, o sistema usará a entrada para a rota padrão. Para hosts em uma rede local, o campo <literal>Gateway</literal> na rota padrão é definido para o sistema que possui uma conexão direta com a internet. Ao ler esta entrada, verifique se a coluna <literal>Flags</literal> indica que o gateway é utilizável (<literal>UG</literal>).</para>

	    <para>A rota padrão para uma máquina que está funcionando como gateway para o mundo externo será a máquina de gateway no provedor de serviços de Internet (<acronym>ISP</acronym>).</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>localhost</term>
	  <listitem>
	    <para>A segunda rota é a <literal>localhost</literal>. A interface especificada na coluna <literal>Netif</literal> para <literal>localhost</literal> é <filename>lo0</filename>, também conhecido como o dispositivo de loopback. Isso indica que todo o tráfego para esse destino deve ser interno, em vez de enviá-lo pela rede.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>Endereço MAC</term>
	  <listitem>
	    <para>Os endereços que começam com <systemitem class="etheraddress">0:e0:</systemitem> são endereços de <acronym>MAC</acronym>. O FreeBSD irá identificar automaticamente quaisquer hosts, <systemitem>test0</systemitem> no exemplo, na Ethernet local e adicionará uma rota para aquele host através da interface Ethernet, <filename>re0</filename>. Esse tipo de rota tem um tempo limite, visto na coluna <literal>Expire</literal>, que é usada se o host não responder em um período de tempo específico. Quando isso acontecer, a rota para esse host será automaticamente excluída. Esses hosts são identificados usando o protocolo de informações de roteamento (<acronym>RIP</acronym>), que calcula rotas para hosts locais com base em uma determinação de caminho mais curto.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>sub-rede</term>
	  <listitem>
	    <para>O FreeBSD irá adicionar automaticamente rotas de sub-rede para a sub-rede local. Neste exemplo, <systemitem class="ipaddress">10.20.30.255</systemitem> é o endereço de broadcast da sub-rede <systemitem class="ipaddress">10.20.30</systemitem> e <systemitem class="fqdomainname">example.com</systemitem> é o nome de domínio associado a essa sub-rede. A designação <literal>link#1</literal> refere-se à primeira placa Ethernet na máquina.</para>

	    <para>Hosts de rede local e sub-redes locais têm suas rotas configuradas automaticamente por um daemon chamado <citerefentry><refentrytitle>routed</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Se ele não estiver em execução, somente as rotas definidas estaticamente pelo administrador existirão.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>host</term>
	  <listitem>
	    <para>A linha <literal>host1</literal> refere-se ao host pelo seu endereço Ethernet. Como é o host de envio, o FreeBSD sabe usar a interface de loopback (<filename>lo0</filename>) em vez da interface Ethernet.</para>

	    <para>As duas linhas <literal>host2</literal> representam os aliases que foram criados usando <citerefentry><refentrytitle>ifconfig</refentrytitle><manvolnum>8</manvolnum></citerefentry>. O símbolo <literal>=&gt;</literal> após a interface <filename>lo0</filename> diz que um alias foi definido além do endereço de loopback. Tais rotas só aparecem no host que suporta o alias e todos os outros hosts na rede local terão uma linha <literal>link#1</literal> para tais rotas.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>224</term>
	  <listitem>
	    <para>A linha final (destino subnet <systemitem class="ipaddress">224</systemitem>) lida com multicasting.</para>
	  </listitem>
	</varlistentry>
      </variablelist>

      <para>Vários atributos de cada rota podem ser vistos na coluna <literal>Flags</literal>. A <xref linkend="routeflags"/> resume algumas destas flags e seus significados:</para>

      <table xml:id="routeflags" frame="none" pgwide="1">
	<title>Flags da Tabela de Roteamento Frequentemente Observados</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Comando</entry>
	      <entry>Propósito</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry>U</entry>
	      <entry>A rota está ativa (up).</entry>
	    </row>

	    <row>
	      <entry>H</entry>
	      <entry>O destino da rota é um único host.</entry>
	    </row>

	    <row>
	      <entry>G</entry>
	      <entry>Envie qualquer coisa para este destino por este gateway, que ele irá descobrir a partir daí para onde enviá-lo.</entry>
	    </row>

	    <row>
	      <entry>S</entry>
	      <entry>Esta rota foi configurada estaticamente.</entry>
	    </row>

	    <row>
	      <entry>C</entry>
	      <entry>Clona uma nova rota baseada nessa rota para as máquinas se conectarem. Esse tipo de rota é normalmente usado para redes locais.</entry>
	    </row>

	    <row>
	      <entry>W</entry>
	      <entry>A rota foi configurada automaticamente com base em uma rota de rede local (clone).</entry>
	    </row>

	    <row>
	      <entry>L</entry>
	      <entry>A rota envolve referências a um hardware Ethernet (link).</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Em um sistema FreeBSD, a rota padrão pode ser definida no <filename>/etc/rc.conf</filename> especificando o endereço <acronym>IP</acronym> do gateway padrão:</para>

      <programlisting>defaultrouter="10.20.30.1"</programlisting>

      <para>Também é possível adicionar manualmente a rota usando o comando <command>route</command>:</para>

      <screen><prompt>#</prompt> <userinput>route add default 10.20.30.1</userinput></screen>

      <para>Observe que as rotas adicionadas manualmente não sobreviverão a uma reinicialização. Para obter mais informações sobre a manipulação manual das tabelas de roteamento de rede, consulte <citerefentry><refentrytitle>route</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
    </sect2>

    <sect2 xml:id="network-static-routes">
      <info>
	<title>Configurando um roteador com rotas estáticas</title>

	<authorgroup>
	  <author><personname> <firstname>Al</firstname> <surname>Hoang</surname> </personname> <contrib> Contribuído por </contrib></author>
	</authorgroup>
      </info>
      <!-- Feb 2004 -->

      <indexterm><primary>dual homed hosts</primary></indexterm>

      <para>Um sistema FreeBSD pode ser configurado como o gateway padrão, ou roteador, para uma rede se for um sistema dual-homed. Um sistema dual-homed é um host que reside em pelo menos duas redes diferentes. Normalmente, cada rede é conectada a uma interface de rede separada, embora o aliasing <acronym>IP</acronym> possa ser usado para vincular vários endereços, cada um em uma sub-rede diferente, a uma interface física.</para>

      <indexterm><primary>router</primary></indexterm>

      <para>Para que o sistema encaminhe os pacotes entre as interfaces, o FreeBSD deve ser configurado como um roteador. Padrões da Internet e boas práticas de engenharia impedem o Projeto FreeBSD de habilitar esse recurso por padrão, mas ele pode ser configurado para iniciar na inicialização adicionando esta linha ao <filename>/etc/rc.conf</filename>:</para>

      <programlisting>gateway_enable="YES"          # Set to YES if this host will be a gateway</programlisting>

      <para>Para habilitar o roteamento agora, defina a variável <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> <varname>net.inet.ip.forwarding</varname> para <literal>1</literal>. Para parar o roteamento, redefina essa variável para <literal>0</literal>.</para>

      <indexterm><primary>BGP</primary></indexterm>
      <indexterm><primary>RIP</primary></indexterm>
      <indexterm><primary>OSPF</primary></indexterm>

      <para>A tabela de roteamento de um roteador precisa de rotas adicionais para saber como acessar outras redes. Rotas podem ser adicionadas manualmente usando rotas estáticas ou rotas podem ser aprendidas automaticamente usando um protocolo de roteamento. As rotas estáticas são apropriadas para redes pequenas e esta seção descreve como adicionar uma entrada de roteamento estático para uma rede pequena.</para>

      <note>
	<para>Para grandes redes, as rotas estáticas se tornam não escaláveis rapidamente. O FreeBSD vem com o daemon de roteamento <acronym>BSD</acronym> padrão <citerefentry><refentrytitle>routed</refentrytitle><manvolnum>8</manvolnum></citerefentry>, que fornece os protocolos de roteamento <acronym>RIP</acronym>, versões 1 e 2 e <acronym>IRDP</acronym>. O suporte para os protocolos de roteamento <acronym>BGP</acronym> e <acronym>OSPF</acronym> pode ser instalado usando o pacote ou port <package>net/zebra</package>.</para>
      </note>

      <para>Considere a seguinte rede:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="advanced-networking/static-routes"/>
	</imageobject>

	<textobject>
	<literallayout class="monospaced">
    INTERNET
      | (10.0.0.1/24) Default Router to Internet
      |
      |Interface xl0
      |10.0.0.10/24
   +------+
   |      | RouterA
   |      | (FreeBSD gateway)
   +------+
      | Interface xl1
      | 192.168.1.1/24
      |
  +--------------------------------+
   Internal Net 1      | 192.168.1.2/24
                       |
                   +------+
                   |      | RouterB
                   |      |
                   +------+
                       | 192.168.2.1/24
                       |
                     Internal Net 2</literallayout>
	</textobject>
      </mediaobject>

      <para>Neste cenário, o <systemitem>RouterA</systemitem> é uma máquina FreeBSD que está agindo como um roteador para o resto da Internet. Ele tem uma rota padrão definida como <systemitem class="ipaddress">10.0.0.1</systemitem>, que permite a conexão com o mundo externo. O <systemitem> RouterB </systemitem> já está configurado para usar <systemitem class="ipaddress">192.168.1.1</systemitem> como seu gateway padrão.</para>

      <para>Antes de adicionar rotas estáticas, a tabela de roteamento no <systemitem>RouterA</systemitem> se parece com:</para>

      <screen><prompt>%</prompt> <userinput>netstat -nr</userinput>
Routing tables

Internet:
Destination        Gateway            Flags    Refs      Use  Netif  Expire
default            10.0.0.1           UGS         0    49378    xl0
127.0.0.1          127.0.0.1          UH          0        6    lo0
10.0.0.0/24        link#1             UC          0        0    xl0
192.168.1.0/24     link#2             UC          0        0    xl1</screen>

      <para>Com a tabela de roteamento atual, o <systemitem>RouterA</systemitem> não tem uma rota para a rede <systemitem class="ipaddress">192.168.2.0/24</systemitem>. O comando a seguir adiciona a rede <literal>Internal Net 2</literal> à tabela de roteamento do <systemitem>RouterA</systemitem> usando <systemitem class="ipaddress">192.168.1.2</systemitem> como o próximo salto:</para>

      <screen><prompt>#</prompt> <userinput>route add -net 192.168.2.0/24 192.168.1.2</userinput></screen>

      <para>Agora, o <systemitem>RouterA</systemitem> pode alcançar qualquer host na rede <systemitem class="ipaddress">192.168.2.0/24</systemitem>. No entanto, as informações de roteamento não persistirão se o sistema FreeBSD for reinicializado. Se uma rota estática precisar ser persistente, adicione-a ao <filename>/etc/rc.conf</filename>:</para>

      <programlisting># Add Internal Net 2 as a persistent static route
static_routes="internalnet2"
route_internalnet2="-net 192.168.2.0/24 192.168.1.2"</programlisting>

      <para>A variável de configuração <literal>static_routes</literal> é uma lista de strings separadas por um espaço, onde cada string faz referência a um nome de rota. A variável <literal>route_<replaceable>internalnet2</replaceable></literal> contém a rota estática para esse nome de rota.</para>

      <para>Usar mais de uma string em <literal>static_routes</literal> cria várias rotas estáticas. A seguir, é mostrado um exemplo de adição de rotas estáticas para as redes <systemitem class="ipaddress">192.168.0.0/24</systemitem> e <systemitem class="ipaddress">192.168.1.0/24</systemitem>:</para>

      <programlisting>static_routes="net1 net2"
route_net1="-net 192.168.0.0/24 192.168.0.1"
route_net2="-net 192.168.1.0/24 192.168.1.1"</programlisting>
    </sect2>

    <sect2 xml:id="network-routing-troubleshooting">
      <title>Solução de problemas</title>

      <para>Quando um espaço de endereçamento é atribuído a uma rede, o provedor de serviços configura suas tabelas de roteamento para que todo o tráfego da rede seja enviado para o link do site. Mas como os sites externos sabem enviar seus pacotes para a rede do <acronym>ISP</acronym>?</para>

      <para>Existe um sistema que rastreia todos os espaços de endereçamento e define seu ponto de conexão com o backbone da Internet, ou as principais linhas que transportam o tráfego da Internet pelo país e pelo mundo. Cada máquina de backbone possui uma cópia de um conjunto mestre de tabelas, que direciona o tráfego de uma rede específica para uma portadora de backbone específica e, a partir daí, desce a cadeia de provedores de serviços até alcançar uma determinada rede.</para>

      <para>É tarefa do provedor de serviços anunciar aos sites de backbone que eles são o ponto de conexão e, assim, o caminho para dentro de um site. Isso é conhecido como propagação de rota.</para>

      <indexterm><primary><citerefentry><refentrytitle>traceroute</refentrytitle><manvolnum>8</manvolnum></citerefentry></primary></indexterm>

      <para>Às vezes, há um problema com a propagação de rotas e alguns sites não conseguem se conectar. Talvez o comando mais útil para tentar descobrir onde o roteamento está quebrando seja o <command>traceroute</command>. Ele é  útil quando o <command>ping</command> falha.</para>

      <para>Ao usar o <command>traceroute </command>, inclua o endereço do host remoto para se conectar. A saída mostrará os gateway ao longo do caminho da tentativa, eventualmente atingindo o host de destino ou encerrando devido à falta de conexão. Para mais informações, consulte <citerefentry><refentrytitle>traceroute</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
    </sect2>

    <sect2 xml:id="network-routing-multicast">
      <title>Considerações sobre Multicast</title>

      <indexterm><primary>multicast routing</primary></indexterm>
      <indexterm><primary>kernel options</primary> <secondary>MROUTING</secondary></indexterm>

      <para>O FreeBSD suporta nativamente tanto aplicativos multicast e quanto roteamento multicast. Os aplicativos multicast não exigem nenhuma configuração especial para serem executados no FreeBSD. O suporte ao roteamento multicast requer que a seguinte opção seja compilada em um kernel personalizado:</para>

      <programlisting>options MROUTING</programlisting>

      <para>O daemon de roteamento multicast, <application>mrouted</application>, pode ser instalado usando o pacote ou port <package>net/mrouted</package>. Este daemon implementa o protocolo de roteamento multicast <acronym>DVMRP</acronym> e é configurado editando o <filename>/usr/local/etc/mrouted.conf</filename> para configurar os túneis e o <acronym>DVMRP</acronym>. A instalação do <application>mrouted</application> também instala o <application>map-mbone</application> e o <application>mrinfo</application>, bem como suas páginas de manual associadas. Consulte estes documentos para exemplos de configuração.</para>

      <note>
	<para>O <acronym>DVMRP</acronym> foi amplamente substituído pelo protocolo <acronym>PIM</acronym> em muitas instalações multicast. Consulte <citerefentry><refentrytitle>pim</refentrytitle><manvolnum>4</manvolnum></citerefentry> para obter maiores informações.</para>
      </note>
    </sect2>
  </sect1>

  <sect1 xml:id="network-wireless">
    <info>
      <title>Rede sem fio</title>

      <authorgroup>
	<author><personname> <othername>Loader</othername> </personname></author>
	<author><personname> <firstname>Marc</firstname> <surname>Fonvieille</surname> </personname></author>
	<author><personname> <firstname>Murray</firstname> <surname>Stokely</surname> </personname></author>
      </authorgroup>
    </info>

    <indexterm><primary>wireless networking</primary></indexterm>
    <indexterm><primary>802.11</primary> <see>wireless networking</see></indexterm>

    <sect2>
      <title>Noções básicas sobre redes sem fio</title>

      <para>A maioria das redes sem fio é baseada nos padrões <trademark class="registered">IEEE</trademark>802.11. Uma rede sem fio básica consiste em várias estações que se comunicam com rádios que transmitem na banda de 2,4 GHz ou 5 GHz, embora isso varie de acordo com a localidade e também esteja mudando para permitir a comunicação nas faixas de 2,3 GHz e 4,9 GHz.</para>

      <para>As redes 802.11 são organizadas de duas maneiras. No <emphasis>modo de infra-estrutura</emphasis>, uma estação atua como mestre para todas as outras estações que se associam a ela, a rede é conhecida como <acronym>BSS</acronym> e a estação mestre é denominada ponto de acesso. (<acronym>AP</acronym>). Em um <acronym>BSS</acronym>, toda a comunicação passa pelo <acronym>AP</acronym>; mesmo quando uma estação deseja se comunicar com outra estação sem fio, as mensagens devem passar pelo <acronym>AP</acronym>. Na segunda forma de rede, não há mestre e as estações se comunicam diretamente. Esta forma de rede é denominada <acronym>IBSS</acronym> e é comumente conhecida como uma <emphasis>rede ad-hoc</emphasis>.</para>

      <para>As redes 802.11 foram implantadas pela primeira vez na banda de 2,4 GHz usando protocolos definidos pelo padrão 802.11 e 802.11b da <trademark class="registered">IEEE</trademark>. Essas especificações incluem as frequências operacionais e as características da camada <acronym>MAC</acronym>, incluindo as taxas de enquadramento e transmissão, pois a comunicação pode ocorrer em várias taxas. Posteriormente, o padrão 802.11a definiu a operação na faixa de 5GHz, incluindo diferentes mecanismos de sinalização e taxas de transmissão mais altas. Mais tarde, o padrão 802.11g definiu o uso de mecanismos de sinalização e transmissão 802.11a na banda de 2,4 GHz de modo a ser compatível com redes 802.11b.</para>

      <para>Separadas das técnicas de transmissão básicas, as redes 802.11 possuem uma variedade de mecanismos de segurança. As especificações originais do 802.11 definiam um protocolo de segurança simples chamado <acronym>WEP</acronym>. Este protocolo usa uma chave pré-compartilhada fixa e a criptografia criptográfica RC4 para codificar dados transmitidos em uma rede. Todas as estações devem concordar com a chave fixa para se comunicar. Esse esquema mostrou-se de fácil quebra e agora raramente é usado, exceto para desencorajar usuários transitórios a se juntarem a uma rede. A prática atual de segurança é dada pela especificação 802.11i do <trademark class="registered">IEEE</trademark> que define novas cifras criptográficas e um protocolo adicional para autenticar estações para um ponto de acesso e para trocar chaves para comunicação de dados. As chaves criptográficas são atualizadas periodicamente e existem mecanismos para detectar e combater tentativas de invasão. Outra especificação de protocolo de segurança comumente usada em redes sem fio é denominada <acronym>WPA</acronym>, que foi um precursor do 802.11i. O <acronym>WPA</acronym> especifica um subconjunto dos requisitos encontrados no 802.11i e foi projetado para implementação em hardware legado. Especificamente, o <acronym>WPA</acronym> requer apenas a codificação <acronym>TKIP</acronym> derivada da codificação original <acronym>WEP</acronym>. O 802.11i permite o uso do <acronym>TKIP</acronym>, mas também requer suporte para uma criptografia mais forte, o AES-CCM, para criptografar os dados. A codificação 
<acronym>AES</acronym> não era exigida no <acronym>WPA</acronym> porque foi considerada demasiadamente  cara computacionalmente para ser executada em hardware legado.</para>

      <para>Um outro padrão a se ter em conta é o 802.11e. Ele define protocolos para a implantação de aplicativos multimídia, como streaming de vídeo e voz sobre IP (<acronym>VoIP</acronym>), em uma rede 802.11. Como o 802.11i, o 802.11e também tem uma especificação de precursor denominada <acronym>WME</acronym> (posteriormente renomeada como <acronym>WMM</acronym>) que foi definida por um grupo industrial como um subconjunto do 802.11e que pode ser implantado agora para habilitar aplicativos multimídia enquanto aguarda a ratificação final do 802.11e. O mais importante a saber sobre o 802.11e e o <acronym>WME</acronym>/<acronym>WMM</acronym> é que ele permite o tráfego prioritário através de uma rede sem fio através de protocolos de Qualidade de Serviço (<acronym>QoS</acronym>) e protocolos de acesso de mídia aprimorados. A implementação adequada desses protocolos permite o aumento rápido de dados e o fluxo de tráfego priorizado.</para>

      <para>O FreeBSD suporta redes que operam usando 802.11a, 802.11b e 802.11g. Os protocolos de segurança <acronym>WPA</acronym> e 802.11i também são suportados (em conjunto com qualquer um dos 11a, 11b e 11g) e o <acronym>QoS</acronym> e priorização de tráfego exigidos pelo protocolo  <acronym>WME</acronym>/<acronym>WMM</acronym> são suportados por um conjunto limitado de dispositivos sem fio.</para>
    </sect2>

    <sect2 xml:id="network-wireless-quick-start">
      <title>Inicio Rápido</title>

      <para>Conectar um computador a uma rede sem fio existente é uma situação muito comum. Este procedimento mostra as etapas necessárias.</para>

      <procedure>
	<step>
	  <para>Obtenha o <acronym>SSID</acronym> (identificador de conjunto de serviços) e <acronym>PSK</acronym> (chave pré-compartilhada) para a rede sem fio do administrador da rede.</para>
	</step>

	<step>
	  <para>Identifique o adaptador sem fio. O kernel <filename>GENERIC</filename> do FreeBSD  inclui drivers para muitos adaptadores sem fio comuns. Se o adaptador sem fio for um desses modelos, ele será mostrado na saída do <citerefentry><refentrytitle>ifconfig</refentrytitle><manvolnum>8</manvolnum></citerefentry>:</para>

	  <screen><prompt>%</prompt> <userinput>ifconfig | grep -B3 -i wireless</userinput></screen>

	  <para>No FreeBSD 11 ou superior, use este comando:</para>

	  <screen><prompt>%</prompt> <userinput>sysctl net.wlan.devices</userinput></screen>

	  <para>Se um adaptador sem fio não estiver listado, um módulo adicional do kernel pode ser necessário, ou pode ser um modelo não suportado pelo FreeBSD.</para>
	  <!-- WB: refer to section that shows how to identify a
	  wireless adapter and load the kernel modules for it. -->

	  <para>Este exemplo mostra o adaptador wireless Atheros <literal>ath0</literal>.</para>
	</step>

	<step>
	  <para>Adicione uma entrada para esta rede ao <filename>/etc/wpa_supplicant.conf </filename>. Se o arquivo não existir, crie-o. Substitua <replaceable>myssid</replaceable> e <replaceable>mypsk</replaceable> pelo <acronym>SSID</acronym> e <acronym>PSK</acronym> fornecidos pelo administrador da rede.</para>

	  <programlisting>network={
	ssid="<replaceable>myssid</replaceable>"
	psk="<replaceable>mypsk</replaceable>"
}</programlisting>
	</step>

	<step>
	  <para>Adicione entradas ao <filename>/etc/rc.conf</filename> para configurar a rede na inicialização:</para>

	  <programlisting>wlans_<replaceable>ath0</replaceable>="wlan0"
ifconfig_wlan0="WPA SYNCDHCP"</programlisting>
	</step>

	<step>
	  <para>Reinicie o computador ou reinicie o serviço de rede para conectar-se à rede:</para>

	  <screen><prompt>#</prompt> <userinput>service netif restart</userinput></screen>
	</step>
      </procedure>
    </sect2>

    <sect2 xml:id="network-wireless-basic">
      <title>Configuração básica</title>

      <sect3>
	<title>Configuração do Kernel</title>

	<para>Para usar a rede sem fio, uma placa de rede sem fio é necessária e o kernel precisa ser configurado com o suporte de rede sem fio apropriado. O kernel é separado em vários módulos para que apenas o suporte necessário precise ser configurado.</para>

	<para>Os dispositivos sem fio mais comumente usados são aqueles que usam peças fabricadas pela Atheros. Estes dispositivos são suportados pelo <citerefentry><refentrytitle>ath</refentrytitle><manvolnum>4</manvolnum></citerefentry> e requerem que a seguinte linha seja adicionada ao <filename>/boot/loader.conf</filename> :</para>

	<programlisting>if_ath_load="YES"</programlisting>

	<para>O driver Atheros é dividido em três partes separadas: o driver (<citerefentry><refentrytitle>ath</refentrytitle><manvolnum>4</manvolnum></citerefentry>), a camada de suporte de hardware que lida com funções específicas do chip (<citerefentry><refentrytitle>ath_hal</refentrytitle><manvolnum>4</manvolnum></citerefentry>) e um algoritmo para selecionar a taxa de transmissão de quadros. Quando este suporte é carregado como módulo do kernel, quaisquer dependências são tratadas automaticamente. Para carregar o suporte para um tipo diferente de dispositivo sem fio, especifique o módulo para esse dispositivo. Este exemplo é para dispositivos baseados no driver Intersil Prism parts (<citerefentry><refentrytitle>wi</refentrytitle><manvolnum>4</manvolnum></citerefentry>):</para>

	<programlisting>if_wi_load="YES"</programlisting>

	<note>
	  <para>Os exemplos nesta seção usam um dispositivo<citerefentry><refentrytitle>ath</refentrytitle><manvolnum>4</manvolnum></citerefentry> e o nome do dispositivo nos exemplos deve ser alterado de acordo com a configuração. Uma lista de drivers sem fio disponíveis e adaptadores suportados pode ser encontrada nas Notas de Hardware do FreeBSD, disponíveis nas <link xlink:href="https://www.FreeBSD.org/releases/index.html">Informações de Release</link> da página do site do FreeBSD. Se um driver nativo do FreeBSD para o dispositivo sem fio não existir, pode ser possível usar o driver <trademark class="registered">Windows</trademark> com a ajuda do wrapper de driver <link linkend="config-network-ndis">NDIS</link>.</para>
	</note>

	<para>Além disso, os módulos que implementam o suporte criptográfico para os protocolos de segurança devem ser carregados. Estes destinam-se a ser dinamicamente carregados sob demanda pelo módulo <citerefentry> <refentrytitle> wlan </refentrytitle> <manvolnum> 4 </manvolnum> </citerefentry>, mas por enquanto eles devem ser configurados manualmente. Os seguintes módulos estão disponíveis: <citerefentry><refentrytitle>wlan_wep</refentrytitle><manvolnum>4</manvolnum></citerefentry>, <citerefentry><refentrytitle>wlan_ccmp</refentrytitle><manvolnum>4</manvolnum></citerefentry>, e <citerefentry><refentrytitle>wlan_tkip</refentrytitle><manvolnum>4</manvolnum></citerefentry>. Os drivers <citerefentry><refentrytitle>wlan_ccmp</refentrytitle><manvolnum>4</manvolnum></citerefentry> e <citerefentry><refentrytitle>wlan_tkip</refentrytitle><manvolnum>4</manvolnum></citerefentry> são necessário apenas ao usar os protocolos de segurança <acronym>WPA</acronym> ou 802.11i. Se a rede não usar criptografia, o suporte a <citerefentry><refentrytitle>wlan_wep</refentrytitle><manvolnum>4</manvolnum></citerefentry> não será necessário. Para carregar estes módulos no momento da inicialização, adicione as seguintes linhas ao <filename>/boot/loader.conf</filename>:</para>

	<programlisting>wlan_wep_load="YES"
wlan_ccmp_load="YES"
wlan_tkip_load="YES"</programlisting>

	<para>Uma vez que esta informação tenha sido adicionada ao <filename>/boot/loader.conf</filename>, reinicie a caixa FreeBSD. Como alternativa, carregue os módulos manualmente usando <citerefentry><refentrytitle>kldload</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>

	<note>
	  <para>Para usuários que não querem usar módulos, é possível compilar esses drivers no kernel adicionando as seguintes linhas a um arquivo de configuração de kernel personalizado:</para>

	  <programlisting>device wlan              # 802.11 support
device wlan_wep          # 802.11 WEP support
device wlan_ccmp         # 802.11 CCMP support
device wlan_tkip         # 802.11 TKIP support
device wlan_amrr         # AMRR transmit rate control algorithm
device ath               # Atheros pci/cardbus NIC's
device ath_hal           # pci/cardbus chip support
options AH_SUPPORT_AR5416 # enable AR5416 tx/rx descriptors
device ath_rate_sample   # SampleRate tx rate control for ath</programlisting>

	  <para>Com esta informação no arquivo de configuração do kernel, recompile o kernel e reinicie a máquina do FreeBSD.</para>
	</note>

	<para>Informações sobre o dispositivo sem fio devem aparecer nas mensagens de inicialização, assim:</para>

	<screen>ath0: &lt;Atheros 5212&gt; mem 0x88000000-0x8800ffff irq 11 at device 0.0 on cardbus1
ath0: [ITHREAD]
ath0: AR2413 mac 7.9 RF2413 phy 4.5</screen>
      </sect3>

      <sect3>
	<title>Definindo a Região Correta</title>

	<para>Como a situação regulatória é diferente em várias partes do mundo, é necessário definir corretamente os domínios que se aplicam à sua localização para obter as informações corretas sobre quais canais podem ser usados.</para>

	<para>As definições de região disponíveis podem ser encontradas em <filename>/etc/regdomain.xml</filename>. Para definir os dados em tempo de execução, use o <command>ifconfig</command>:</para>

	<screen><prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> regdomain <replaceable>ETSI</replaceable> country <replaceable>AT</replaceable></userinput></screen>

	<para>Para persistir as configurações, adicione-o ao <filename>/etc/rc.conf</filename>:</para>

	  <screen><prompt>#</prompt> <userinput>sysrc create_args_wlan0="country <replaceable>AT</replaceable> regdomain <replaceable>ETSI</replaceable>"</userinput></screen>
      </sect3>
    </sect2>

    <sect2>
      <title>Modo de Infraestrutura</title>

      <para>O modo de infra-estrutura (<acronym>BSS</acronym>) é o modo normalmente usado. Neste modo, vários pontos de acesso sem fio são conectados a uma rede com fio. Cada rede sem fio tem seu próprio nome, chamado de <acronym>SSID</acronym>. Os clientes sem fio se conectam aos pontos de acesso sem fio.</para>

      <sect3>
	<title>Clientes do FreeBSD</title>

	<sect4>
	  <title>Como encontrar pontos de acesso</title>

	  <para>Para procurar redes disponíveis, use <citerefentry><refentrytitle>ifconfig</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Essa solicitação pode demorar alguns instantes para ser concluída, pois exige que o sistema alterne para cada frequência sem fio disponível e sonde os pontos de acesso disponíveis. Apenas o superusuário pode iniciar uma varredura:</para>

	  <screen><prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> create wlandev <replaceable>ath0</replaceable></userinput>
<prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> up scan</userinput>
SSID/MESH ID    BSSID              CHAN RATE   S:N     INT CAPS
dlinkap         00:13:46:49:41:76   11   54M -90:96   100 EPS  WPA WME
freebsdap       00:11:95:c3:0d:ac    1   54M -83:96   100 EPS  WPA</screen>

	  <note>
	    <para>A interface deve estar <option>up</option> antes de poder efetuar a busca. Pedidos de varredura subsequentes não exigem que a interface seja marcada como up novamente.</para>
	  </note>

	  <para>A saída de uma solicitação de varredura lista cada rede <acronym>BSS</acronym>/<acronym>IBSS</acronym> encontrada. Além de listar o nome da rede, o <literal>SSID</literal>, a saída também mostra o <literal>BSSID</literal>, que é o endereço <acronym>MAC</acronym> do ponto de acesso. O campo <literal>CAPS</literal> identifica o tipo de cada rede e os recursos das estações que operam lá:</para>

	  <table frame="none" pgwide="0">
	    <title>Códigos de capacidade da estação</title>

	    <tgroup cols="2">
	      <thead>
		<row>
		  <entry>Código de capacidade</entry>
		  <entry>Significado</entry>
		</row>
	      </thead>

	      <tbody>
		<row>
		  <entry><literal>E</literal></entry>
		  <entry>Conjunto de serviços estendidos (<acronym>ESS</acronym>). Indica que a estação faz parte de uma rede de infraestrutura em vez de uma rede <acronym>IBSS</acronym>/ad-hoc.</entry>
		</row>

		<row>
		  <entry><literal>I</literal></entry>
		  <entry>Rede <acronym>IBSS</acronym>/ad-hoc. Indica que a estação faz parte de uma rede ad-hoc em vez de uma rede <acronym>ESS</acronym>.</entry>
		</row>

		<row>
		  <entry><literal>P</literal></entry>
		  <entry>Privacidade. A criptografia é necessária para todos os quadros de dados trocados dentro do <acronym>BSS</acronym> usando meios criptográficos como o <acronym>WEP</acronym>, o <acronym>TKIP</acronym> ou o <acronym>AES</acronym>-<acronym>CCMP</acronym>.</entry>
		</row>

		<row>
		  <entry><literal>S</literal></entry>
		  <entry>Preâmbulo Curto. Indica que a rede está usando preâmbulos curtos, definidos em 802.11b de Alta Taxa/DSSS PHYS, e utiliza um campo de sincronização de 56 bits em vez do campo de 128 bits usado no modo de preâmbulo longo.</entry>
		</row>

		<row>
		  <entry><literal>s</literal></entry>
		  <entry>Tempo de slot curto. Indica que a rede 802.11g está usando um tempo de slot curto porque não há estações legadas  (802.11b) presentes.</entry>
		</row>
	      </tbody>
	    </tgroup>
	  </table>

	  <para>Pode-se também exibir a lista atual de redes conhecidas com:</para>

	  <screen><prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> list scan</userinput></screen>

	  <para>Essas informações podem ser atualizadas automaticamente pelo adaptador ou manualmente com uma solicitação de <option>scan</option>. Dados antigos são automaticamente removidos do cache, então com o tempo essa lista pode diminuir a menos que mais varreduras sejam feitas.</para>
	</sect4>

	<sect4>
	  <title>Configurações básicas</title>

	  <para>Esta seção fornece um exemplo simples de como fazer com que o adaptador de rede sem fio funcione no FreeBSD sem criptografia. Uma vez familiarizado com esses conceitos, é altamente recomendável usar o <link linkend="network-wireless-wpa">WPA</link> para configurar a rede sem fio.</para>

	  <para>Existem três etapas básicas para configurar uma rede sem fio: selecionar um ponto de acesso, autenticar a estação e configurar um endereço <acronym>IP</acronym>. As seções a seguir discutem cada etapa.</para>

	  <sect5>
	    <title>Selecionando um ponto de acesso</title>

	    <para>Na maioria das vezes, é suficiente deixar o sistema escolher um ponto de acesso usando a heurística integrada. Este é o comportamento padrão quando uma interface é marcada como up ou está listada em <filename>/etc/rc.conf</filename>:</para>

	    <programlisting>wlans_ath0="wlan0"
ifconfig_wlan0="DHCP"</programlisting>

	    <para>Se houver vários pontos de acesso, um específico pode ser selecionado pelo seu <acronym>SSID</acronym>:</para>

	    <programlisting>wlans_ath0="wlan0"
ifconfig_wlan0="ssid <replaceable>your_ssid_here</replaceable> DHCP"</programlisting>

	    <para>Em um ambiente em que há vários pontos de acesso com o mesmo <acronym>SSID</acronym>, o que geralmente é feito para simplificar o roaming, talvez seja necessário associá-lo a um dispositivo específico. Neste caso, o <acronym>BSSID</acronym> do ponto de acesso pode ser especificado, com ou sem o <acronym>SSID</acronym>:</para>

	    <programlisting>wlans_ath0="wlan0"
ifconfig_wlan0="ssid <replaceable>your_ssid_here</replaceable> bssid <replaceable>xx:xx:xx:xx:xx:xx</replaceable> DHCP"</programlisting>

	    <para>Existem outras maneiras de restringir a escolha de um ponto de acesso, como limitar o conjunto de freqüências que o sistema fará a varredura. Isso pode ser útil para uma placa sem fio de banda múltipla, pois a varredura de todos os canais possíveis pode consumir muito tempo. Para limitar a operação a uma banda específica, use o parâmetro <option>mode</option>:</para>

	    <programlisting>wlans_ath0="wlan0"
ifconfig_wlan0="mode <replaceable>11g</replaceable> ssid <replaceable>your_ssid_here</replaceable> DHCP"</programlisting>

	    <para>Este exemplo forçará a placa a operar em 802.11g, que é definido apenas para freqüências de 2.4GHz, portanto, qualquer canal de 5GHz não será considerado. Isso também pode ser obtido com o parâmetro <option>channel</option>, que bloqueia a operação para uma frequência específica, e o parâmetro <option>chanlist</option>, para especificar uma lista de canais para varredura. Maiores informações sobre esses parâmetros podem ser encontradas em <citerefentry><refentrytitle>ifconfig</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
	  </sect5>

	  <sect5>
	    <title>Autenticação</title>

	    <para>Quando um ponto de acesso é selecionado, a estação precisa se autenticar antes de poder transmitir dados. A autenticação pode acontecer de várias maneiras. O esquema mais comum, autenticação aberta, permite que qualquer estação entre na rede e se comunique. Essa é a autenticação a ser usada para fins de teste na primeira vez em que uma rede sem fio é configurada. Outros esquemas exigem que os handshakes criptográficos sejam concluídos antes que o tráfego de dados possa fluir, usando chaves ou segredos pré-compartilhados ou esquemas mais complexos que envolvam serviços de back-end, como o <acronym>RADIUS</acronym>. Autenticação aberta é a configuração padrão. A próxima configuração mais comum é o <acronym>WPA-PSK</acronym>, também conhecido como <acronym>WPA</acronym> Pessoal, que é descrito em <xref linkend="network-wireless-wpa-wpa-psk"/>.</para>

	    <note>
	      <para>Se estiver usando uma estação base Extreme <trademark class="registered">AirPort</trademark> da <trademark class="registered">Apple</trademark> para um ponto de acesso, a autenticação de chave compartilhada juntamente com um <acronym>WEP</acronym> chave precisa ser configurada. Isto pode ser configurado em <filename>/etc/rc.conf</filename> ou usando <citerefentry><refentrytitle>wpa_supplicant</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Para uma única estação base <trademark class="registered">AirPort</trademark>, o acesso pode ser configurado com:</para>

	      <programlisting>wlans_ath0="wlan0"
ifconfig_wlan0="authmode shared wepmode on weptxkey <replaceable>1</replaceable> wepkey <replaceable>01234567</replaceable> DHCP"</programlisting>

	      <para>Em geral, a autenticação de chave compartilhada deve ser evitada porque ela usa o material de chave <acronym>WEP</acronym> de uma maneira altamente restrita, facilitando ainda mais a quebra da chave. Se o <acronym>WEP</acronym> deve ser usado para compatibilidade com dispositivos legados, é melhor usar o <acronym>WEP</acronym> com a autenticação <literal>open</literal>. Mais informações sobre o <acronym>WEP</acronym> podem ser encontradas em <xref linkend="network-wireless-wep"/>.</para>
	    </note>
	  </sect5>

	  <sect5>
	    <title>Obtendo um endereço <acronym>IP</acronym> com <acronym>DHCP</acronym></title>

	    <para>Quando um ponto de acesso é selecionado e os parâmetros de autenticação são definidos, um endereço <acronym>IP</acronym> deve ser obtido para se comunicar. Na maioria das vezes, o endereço <acronym>IP</acronym> é obtido através do <acronym>DHCP</acronym>. Para isso, edite o <filename>/etc/rc.conf</filename> e adicione o <literal>DHCP</literal> à configuração do dispositivo:</para>

	    <programlisting>wlans_ath0="wlan0"
ifconfig_wlan0="DHCP"</programlisting>

	    <para>A interface sem fio está agora pronta para subir:</para>

	    <screen><prompt>#</prompt> <userinput>service netif start</userinput></screen>

	    <para>Quando a interface estiver rodando, use o <citerefentry><refentrytitle>ifconfig</refentrytitle><manvolnum>8</manvolnum></citerefentry> para ver o status da interface <filename>ath0</filename>:</para>

	    <screen><prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable></userinput>
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
        ether 00:11:95:d5:43:62
        inet 192.168.1.100 netmask 0xffffff00 broadcast 192.168.1.255
        media: IEEE 802.11 Wireless Ethernet OFDM/54Mbps mode 11g
        status: associated
        ssid dlinkap channel 11 (2462 Mhz 11g) bssid 00:13:46:49:41:76
        country US ecm authmode OPEN privacy OFF txpower 21.5 bmiss 7
        scanvalid 60 bgscan bgscanintvl 300 bgscanidle 250 roam:rssi 7
        roam:rate 5 protmode CTS wme burst</screen>

	    <para>A linha <literal>status: associated</literal> significa que está conectada à rede sem fio. O <literal>bssid 00:13:46:49:41:76</literal> é o endereço <acronym>MAC</acronym> do ponto de acesso e o <literal>authmode OPEN</literal> indica que a comunicação é não criptografada.</para>
	  </sect5>

	  <sect5>
	    <title>Endereço <acronym>IP</acronym> estático</title>

	    <para>Se um endereço <acronym>IP</acronym> não puder ser obtido de um servidor <acronym>DHCP</acronym>, defina um endereço de <acronym>IP</acronym> fixo. Substitua a palavra-chave <literal>DHCP</literal> mostrada acima pelas informações do endereço. Certifique-se de reter quaisquer outros parâmetros para selecionar o ponto de acesso:</para>

	    <programlisting>wlans_ath0="wlan0"
ifconfig_wlan0="inet <replaceable>192.168.1.100</replaceable> netmask <replaceable>255.255.255.0</replaceable> ssid <replaceable>your_ssid_here</replaceable>"</programlisting>
	  </sect5>
	</sect4>

	<sect4 xml:id="network-wireless-wpa">
	  <title><acronym>WPA</acronym></title>

	  <para>O Wi-Fi Protected Access (<acronym>WPA</acronym>) é um protocolo de segurança usado em conjunto com redes 802.11 para resolver a falta de autenticação adequada e a fraqueza do <acronym>WEP</acronym>. O WPA utiliza o protocolo de autenticação 802.1X e usa uma das várias codificações disponíveis em vez do <acronym>WEP</acronym> para integridade de dados. A única codificação exigida pelo <acronym>WPA</acronym> é o protocolo de integridade de chave temporária (<acronym>TKIP</acronym>). O <acronym>TKIP</acronym> é uma codificação que estende a codificação básica RC4 usada pelo <acronym>WEP</acronym>, adicionando verificação de integridade, detecção de adulteração e medidas para responder a intrusões detectadas. O <acronym>TKIP</acronym> foi projetado para funcionar em hardware legado apenas com uma modificação de software. Ele representa um compromisso que melhora a segurança, mas ainda não é totalmente imune a ataques. O <acronym>WPA</acronym> também especifica a codificação <acronym>AES-CCMP</acronym> como uma alternativa para o <acronym>TKIP</acronym>, e é preferível quando possível. Para esta especificação, o termo <acronym>WPA2</acronym> ou <acronym>RSN</acronym> é comumente usado.</para>

	  <para>O <acronym>WPA</acronym> define protocolos de autenticação e criptografia. A autenticação é mais comumente feita usando uma de duas técnicas: por 802.1X e um serviço de autenticação backend, como o <acronym>RADIUS</acronym>, ou por um handshake mínimo entre a estação e o ponto de acesso usando um segredo pré-compartilhado. O primeiro é comumente chamado de <acronym>WPA</acronym> Enterprise e o último é conhecido como <acronym>WPA</acronym> Pessoal. Como a maioria das pessoas não configurará um servidor backend <acronym>RADIUS</acronym> para sua rede sem fio, o <acronym>WPA-PSK</acronym> é de longe a configuração mais comumente encontrada para o <acronym>WPA</acronym> .</para>

	  <para>O controle da conexão sem fio e a negociação ou autenticação de chave com um servidor é feito usando o <citerefentry><refentrytitle>wpa_supplicant</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Este programa requer um arquivo de configuração, o <filename>/etc/wpa_supplicant.conf</filename>, para ser executado. Maiores informações sobre este arquivo podem ser encontradas em <citerefentry><refentrytitle>wpa_supplicant.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>

	  <sect5 xml:id="network-wireless-wpa-wpa-psk">
	    <title><acronym>WPA-PSK</acronym></title>

	    <para>O <acronym>WPA-PSK</acronym>, também conhecido como <acronym>WPA</acronym> Pessoal, é baseado em uma chave pré-compartilhada (<acronym>PSK</acronym>) que é gerada a partir de uma determinada senha e usado como chave mestra na rede sem fio. Isso significa que todos os usuários sem fio compartilharão a mesma chave. O <acronym>WPA-PSK</acronym> destina-se a redes pequenas em que o uso de um servidor de autenticação não é possível ou desejado.</para>

	    <warning>
	      <para>Sempre use senhas fortes que sejam suficientemente longas e feitas de um alfabeto rico para que elas não sejam facilmente adivinhadas ou atacadas.</para>
	    </warning>

	    <para>O primeiro passo é a configuração do <filename>/etc/wpa_supplicant.conf</filename> com o <acronym>SSID</acronym> e a chave pré-compartilhada da rede:</para>

	    <programlisting>network={
  ssid="freebsdap"
  psk="freebsdmall"
}</programlisting>

	    <para>Então, em <filename>/etc/rc.conf</filename>, indique que a configuração do dispositivo sem fio será feita com o  <acronym>WPA</acronym> e o endereço <acronym>IP</acronym> será obtido com o <acronym>DHCP</acronym>:</para>

	    <programlisting>wlans_ath0="wlan0"
ifconfig_wlan0="WPA DHCP"</programlisting>

	    <para>Então, suba a interface:</para>

	    <screen><prompt>#</prompt> <userinput>service netif start</userinput>
Starting wpa_supplicant.
DHCPDISCOVER on wlan0 to 255.255.255.255 port 67 interval 5
DHCPDISCOVER on wlan0 to 255.255.255.255 port 67 interval 6
DHCPOFFER from 192.168.0.1
DHCPREQUEST on wlan0 to 255.255.255.255 port 67
DHCPACK from 192.168.0.1
bound to 192.168.0.254 -- renewal in 300 seconds.
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet OFDM/36Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</screen>

	    <para>Ou, tente configurar a interface manualmente usando as informações em <filename>/etc/wpa_supplicant.conf</filename>:</para>

	    <screen><prompt>#</prompt> <userinput>wpa_supplicant -i <replaceable>wlan0</replaceable> -c /etc/wpa_supplicant.conf</userinput>
Trying to associate with 00:11:95:c3:0d:ac (SSID='freebsdap' freq=2412 MHz)
Associated with 00:11:95:c3:0d:ac
WPA: Key negotiation completed with 00:11:95:c3:0d:ac [PTK=CCMP GTK=CCMP]
CTRL-EVENT-CONNECTED - Connection to 00:11:95:c3:0d:ac completed (auth) [id=0 id_str=]</screen>

	    <para>A próxima operação é iniciar o  <citerefentry><refentrytitle>dhclient</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter o endereço <acronym>IP</acronym> do servidor <acronym>DHCP</acronym>:</para>

	    <screen><prompt>#</prompt> <userinput>dhclient <replaceable>wlan0</replaceable></userinput>
DHCPREQUEST on wlan0 to 255.255.255.255 port 67
DHCPACK from 192.168.0.1
bound to 192.168.0.254 -- renewal in 300 seconds.
<prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable></userinput>
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet OFDM/36Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</screen>

	    <note>
	      <para>Se o <filename>/etc/rc.conf</filename> tiver uma entrada <literal>ifconfig_wlan0="DHCP"</literal>, <citerefentry><refentrytitle>dhclient</refentrytitle><manvolnum>8</manvolnum></citerefentry> será iniciado automaticamente após o <citerefentry><refentrytitle>wpa_supplicant</refentrytitle><manvolnum>8</manvolnum></citerefentry> associar-se ao ponto de acesso.</para>
	    </note>

	    <para>Se o <acronym>DHCP</acronym> não for possível ou desejado, defina um endereço <acronym>IP</acronym> estático após o <citerefentry><refentrytitle>wpa_supplicant</refentrytitle><manvolnum>8</manvolnum></citerefentry> autenticar a estação:</para>

	    <screen><prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> inet <replaceable>192.168.0.100</replaceable> netmask <replaceable>255.255.255.0</replaceable></userinput>
<prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable></userinput>
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.100 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet OFDM/36Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</screen>

	    <para>Quando o <acronym>DHCP</acronym> não é usado, o gateway padrão e o servidor de nomes também precisam ser definidos manualmente:</para>

	    <screen><prompt>#</prompt> <userinput>route add default <replaceable>your_default_router</replaceable></userinput>
<prompt>#</prompt> <userinput>echo "nameserver <replaceable>your_DNS_server</replaceable>" &gt;&gt; /etc/resolv.conf</userinput></screen>
	  </sect5>

	  <sect5 xml:id="network-wireless-wpa-eap-tls">
	    <title><acronym>WPA</acronym> com <acronym>EAP-TLS</acronym></title>

	    <para>A segunda maneira de usar o <acronym>WPA</acronym> é com um servidor de autenticação de backend 802.1X. Neste caso, o <acronym>WPA</acronym> é chamado de <acronym>WPA</acronym> Enterprise para diferenciá-lo do <acronym>WPA</acronym> Pessoal menos seguro. A autenticação no <acronym>WPA</acronym> Enterprise é baseada no protocolo de autenticação extensível (<acronym>EAP</acronym>).</para>

	    <para>O <acronym>EAP</acronym> não vem com um método de criptografia. Em vez disso, o <acronym>EAP</acronym> é incorporado dentro de um túnel criptografado. Existem muitos métodos de autenticação <acronym>EAP</acronym>, mas o <acronym>EAP-TLS</acronym>, o <acronym>EAP-TTLS</acronym> e o  <acronym>EAP-PEAP</acronym> são os mais comum.</para>

	    <para>O EAP com Segurança da Camada de Transporte (<acronym>EAP-TLS</acronym>) é um protocolo de autenticação sem fio bem suportado, já que foi o primeiro método <acronym>EAP</acronym> a ser certificado pela <link xlink:href="http://www.wi-fi.org/">WiFi Alliance</link>. O <acronym>EAP-TLS</acronym> requer três certificados para executar: o certificado da Autoridade de Certificação (<acronym>CA</acronym>) instalado em todas as máquinas, o certificado do servidor para o servidor de autenticação e um certificado de cliente para cada cliente sem fio. Nesse método <acronym>EAP</acronym>, o servidor de autenticação e o cliente sem fio autenticam um ao outro apresentando seus respectivos certificados e, em seguida, verificam se esses certificados foram assinados pela <acronym>CA</acronym> da organização.</para>

	    <para>Como anteriormente, a configuração é feita através do <filename>/etc/wpa_supplicant.conf</filename>:</para>

	    <programlisting>network={
  ssid="freebsdap" <co xml:id="co-tls-ssid"/>
  proto=RSN  <co xml:id="co-tls-proto"/>
  key_mgmt=WPA-EAP <co xml:id="co-tls-kmgmt"/>
  eap=TLS <co xml:id="co-tls-eap"/>
  identity="loader" <co xml:id="co-tls-id"/>
  ca_cert="/etc/certs/cacert.pem" <co xml:id="co-tls-cacert"/>
  client_cert="/etc/certs/clientcert.pem" <co xml:id="co-tls-clientcert"/>
  private_key="/etc/certs/clientkey.pem" <co xml:id="co-tls-pkey"/>
  private_key_passwd="freebsdmallclient" <co xml:id="co-tls-pwd"/>
}</programlisting>

	    <calloutlist>
	      <callout arearefs="co-tls-ssid">
		<para>Este campo indica o nome da rede (<acronym>SSID</acronym>).</para>
	      </callout>

	      <callout arearefs="co-tls-proto">
		<para>Este exemplo usa o protocolo 802.11i <acronym>RSN</acronym> <trademark class="registered">IEEE</trademark>, também conhecido como <acronym>WPA2</acronym>.</para>
	      </callout>

	      <callout arearefs="co-tls-kmgmt">
		<para>A linha <literal>key_mgmt</literal> refere-se ao protocolo de gerenciamento de chaves a ser usado. Neste exemplo, é o <acronym>WPA</acronym> usando a autenticação <acronym>EAP</acronym>.</para>
	      </callout>

	      <callout arearefs="co-tls-eap">
		<para>Este campo indica o método <acronym>EAP</acronym> para a conexão.</para>
	      </callout>

	      <callout arearefs="co-tls-id">
		<para>O campo <literal>identity</literal> contém a sequência de identidade para <acronym>EAP</acronym>.</para>
	      </callout>

	      <callout arearefs="co-tls-cacert">
		<para>O campo <literal>ca_cert</literal> indica o nome do caminho do arquivo de certificado <acronym>CA</acronym>. Este arquivo é necessário para verificar o certificado do servidor.</para>
	      </callout>

	      <callout arearefs="co-tls-clientcert">
		<para>A linha <literal>client_cert</literal> fornece o nome do caminho para o arquivo de certificado do cliente. Este certificado é exclusivo para cada cliente sem fio da rede.</para>
	      </callout>

	      <callout arearefs="co-tls-pkey">
		<para>O campo <literal>private_key</literal> é o nome do caminho para o arquivo de chave privada do certificado do cliente.</para>
	      </callout>

	      <callout arearefs="co-tls-pwd">
		<para>O campo <literal>private_key_passwd</literal> contém a frase secreta para a chave privada.</para>
	      </callout>
	    </calloutlist>

	    <para>Em seguida, adicione as seguintes linhas ao <filename>/etc/rc.conf</filename>:</para>

	    <programlisting>wlans_ath0="wlan0"
ifconfig_wlan0="WPA DHCP"</programlisting>

	    <para>O próximo passo é subir a interface:</para>

	    <screen><prompt>#</prompt> <userinput>service netif start</userinput>
Starting wpa_supplicant.
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 7
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 15
DHCPACK from 192.168.0.20
bound to 192.168.0.254 -- renewal in 300 seconds.
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet DS/11Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</screen>

	    <para>Também é possível subir a interface manualmente usando <citerefentry><refentrytitle>wpa_supplicant</refentrytitle><manvolnum>8</manvolnum></citerefentry> e <citerefentry><refentrytitle>ifconfig</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
	  </sect5>

	  <sect5 xml:id="network-wireless-wpa-eap-ttls">
	    <title><acronym>WPA</acronym> com <acronym>EAP-TTLS</acronym></title>

	    <para>Com o <acronym>EAP-TLS</acronym>, o servidor de autenticação e o cliente precisam de um certificado. Com o <acronym>EAP-TTLS</acronym>, um certificado de cliente é opcional. Esse método é semelhante a um servidor da Web que cria um túnel seguro <acronym>SSL</acronym>, mesmo se os visitantes não tiverem certificados do lado do cliente. O <acronym>EAP-TTLS</acronym> usa um túnel <acronym>TLS</acronym> criptografado para o transporte seguro dos dados de autenticação.</para>

	    <para>A configuração necessária pode ser adicionada ao <filename>/etc/wpa_supplicant.conf</filename>:</para>

	    <programlisting>network={
  ssid="freebsdap"
  proto=RSN
  key_mgmt=WPA-EAP
  eap=TTLS <co xml:id="co-ttls-eap"/>
  identity="test" <co xml:id="co-ttls-id"/>
  password="test" <co xml:id="co-ttls-passwd"/>
  ca_cert="/etc/certs/cacert.pem" <co xml:id="co-ttls-cacert"/>
  phase2="auth=MD5" <co xml:id="co-ttls-pha2"/>
}</programlisting>

	    <calloutlist>
	      <callout arearefs="co-ttls-eap">
		<para>Este campo especifica o método <acronym>EAP</acronym> para a conexão.</para>
	      </callout>

	      <callout arearefs="co-ttls-id">
		<para>O campo <literal>identity</literal> contém a sequência de identidade para a autenticação <acronym>EAP</acronym> dentro do túnel <acronym>TLS</acronym> criptografado.</para>
	      </callout>

	      <callout arearefs="co-ttls-passwd">
		<para>O campo <literal>password</literal> contém a senha para a autenticação <acronym>EAP</acronym>.</para>
	      </callout>

	      <callout arearefs="co-ttls-cacert">
		<para>O campo <literal>ca_cert</literal> indica o nome do caminho do arquivo de certificado <acronym>CA</acronym>. Este arquivo é necessário para verificar o certificado do servidor.</para>
	      </callout>

	      <callout arearefs="co-ttls-pha2">
		<para>Este campo especifica o método de autenticação usado no túnel <acronym>TLS</acronym> criptografado. Neste exemplo, o <acronym>EAP</acronym> com desafio MD5 é usado. A fase de <quote>inner authentication</quote> é freqüentemente chamada de <quote>phase2</quote>.</para>
	      </callout>
	    </calloutlist>

	    <para>Em seguida, adicione as seguintes linhas ao <filename>/etc/rc.conf</filename>:</para>

	    <programlisting>wlans_ath0="wlan0"
ifconfig_wlan0="WPA DHCP"</programlisting>

	    <para>O próximo passo é subir a interface:</para>

	    <screen><prompt>#</prompt> <userinput>service netif start</userinput>
Starting wpa_supplicant.
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 7
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 15
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 21
DHCPACK from 192.168.0.20
bound to 192.168.0.254 -- renewal in 300 seconds.
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet DS/11Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</screen>
	  </sect5>

	  <sect5 xml:id="network-wireless-wpa-eap-peap">
	    <title><acronym>WPA</acronym> com <acronym>EAP-PEAP</acronym></title>

	    <note>
	      <para>O <acronym>PEAPv0/EAP-MSCHAPv2</acronym> é o método <acronym>PEAP</acronym> mais comum. Neste capítulo, o termo <acronym>PEAP</acronym> é usado para se referir a esse método.</para>
	    </note>

	    <para>O EAP protegido (<acronym>PEAP</acronym>) foi criado como uma alternativa ao <acronym>EAP-TTLS</acronym> e é o padrão mais usado do <acronym>EAP</acronym> após o <acronym>EAP-TLS</acronym>. Em uma rede com sistemas operacionais mistos, o <acronym>PEAP</acronym> deve ser o padrão mais suportado após o <acronym>EAP-TLS</acronym>.</para>

	    <para>O <acronym>PEAP</acronym> é semelhante ao <acronym>EAP-TTLS</acronym>, pois usa um certificado do lado do servidor para autenticar clientes criando um túnel <acronym>TLS</acronym> criptografado entre o cliente e o servidor de autenticação, que protege a troca subsequente das informações de autenticação. A autenticação <acronym>PEAP</acronym> difere do <acronym>EAP-TTLS</acronym>, pois transmite o nome de usuário em texto aberto e somente a senha é enviada no túnel <acronym>TLS</acronym> criptografado. O <acronym>EAP-TTLS</acronym> usará o túnel <acronym>TLS</acronym> para o nome de usuário e para a senha.</para>

	    <para>Adicione as seguintes linhas ao <filename>/etc/wpa_supplicant.conf</filename> para ajustar as configurações relacionadas ao <acronym>EAP-PEAP</acronym>:</para>

	    <programlisting>network={
  ssid="freebsdap"
  proto=RSN
  key_mgmt=WPA-EAP
  eap=PEAP <co xml:id="co-peap-eap"/>
  identity="test" <co xml:id="co-peap-id"/>
  password="test" <co xml:id="co-peap-passwd"/>
  ca_cert="/etc/certs/cacert.pem" <co xml:id="co-peap-cacert"/>
  phase1="peaplabel=0" <co xml:id="co-peap-pha1"/>
  phase2="auth=MSCHAPV2" <co xml:id="co-peap-pha2"/>
}</programlisting>

	    <calloutlist>
	      <callout arearefs="co-peap-eap">
		<para>Este campo especifica o método <acronym>EAP</acronym> para a conexão.</para>
	      </callout>

	      <callout arearefs="co-peap-id">
		<para>O campo <literal>identity</literal> contém a sequência de identidade para a autenticação <acronym>EAP</acronym> dentro do túnel <acronym>TLS</acronym> criptografado.</para>
	      </callout>

	      <callout arearefs="co-peap-passwd">
		<para>O campo <literal>password</literal> contém a senha para a autenticação <acronym>EAP</acronym>.</para>
	      </callout>

	      <callout arearefs="co-peap-cacert">
		<para>O campo <literal>ca_cert</literal> indica o nome do caminho do arquivo de certificado <acronym>CA</acronym>. Este arquivo é necessário para verificar o certificado do servidor.</para>
	      </callout>

	      <callout arearefs="co-peap-pha1">
		<para>Este campo contém os parâmetros para a primeira fase de autenticação, o túnel <acronym>TLS</acronym>. De acordo com o servidor de autenticação usado, especifique um label específico para autenticação. Na maioria das vezes, o label será <quote>client <acronym>EAP</acronym> encryption</quote> que é definido usando <literal>peaplabel=0</literal>. Maiores informações podem ser encontradas em <citerefentry><refentrytitle>wpa_supplicant.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>
	      </callout>

	      <callout arearefs="co-peap-pha2">
		<para>Este campo especifica o protocolo de autenticação usado no túnel <acronym>TLS</acronym> criptografado. No caso do <acronym>PEAP</acronym>, é <literal>auth=MSCHAPV2</literal>.</para>
	      </callout>
	    </calloutlist>

	    <para>Adicione o seguinte ao <filename>/etc/rc.conf</filename>:</para>

	    <programlisting>wlans_ath0="wlan0"
ifconfig_wlan0="WPA DHCP"</programlisting>

	    <para>Então, suba a interface:</para>

	    <screen><prompt>#</prompt> <userinput>service netif start</userinput>
Starting wpa_supplicant.
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 7
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 15
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 21
DHCPACK from 192.168.0.20
bound to 192.168.0.254 -- renewal in 300 seconds.
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet DS/11Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</screen>
	  </sect5>
	</sect4>

	<sect4 xml:id="network-wireless-wep">
	  <title><acronym>WEP</acronym></title>

	  <para>A privacidade equivalente com fio (<acronym>WEP</acronym>) faz parte do padrão 802.11 original. Não há mecanismo de autenticação, apenas uma forma fraca de controle de acesso que é facilmente quebrada.</para>

	  <para>O <acronym>WEP</acronym> pode ser configurado usando o <citerefentry><refentrytitle>ifconfig</refentrytitle><manvolnum>8</manvolnum></citerefentry>:</para>

	  <screen><prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> create wlandev <replaceable>ath0</replaceable></userinput>
<prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> inet <replaceable>192.168.1.100</replaceable> netmask <replaceable>255.255.255.0</replaceable> \
	    ssid <replaceable>my_net</replaceable> wepmode on weptxkey <replaceable>3</replaceable> wepkey <replaceable>3:0x3456789012</replaceable></userinput></screen>

	  <itemizedlist>
	    <listitem>

	      <para>O <literal>weptxkey</literal> especifica qual chave <acronym>WEP</acronym> será usada na transmissão. Este exemplo usa a terceira chave. Isso deve corresponder à configuração no ponto de acesso. Quando não tiver certeza de qual chave é usada pelo ponto de acesso, tente <literal>1</literal> (a primeira chave) para esse valor.</para>
	    </listitem>

	    <listitem>
	      <para>O <literal>wepkey</literal> seleciona uma das chaves <acronym>WEP</acronym>. Deve estar no formato <replaceable>index:key</replaceable>. A chave <literal>1</literal> é usada por padrão; o índice só precisa ser definido ao usar uma chave diferente da primeira.</para>

	      <note>
		<para>Substitua o <literal>0x3456789012</literal> com a chave configurada para uso no ponto de acesso.</para>
	      </note>
	    </listitem>
	  </itemizedlist>

	  <para>Consulte o <citerefentry><refentrytitle>ifconfig</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter maiores informações.</para>

	  <para>O recurso <citerefentry><refentrytitle>wpa_supplicant</refentrytitle><manvolnum>8</manvolnum></citerefentry>  pode ser usado para configurar uma interface sem fio com o <acronym>WEP</acronym>. O exemplo acima pode ser configurado adicionando as seguintes linhas ao <filename>/etc/wpa_supplicant.conf</filename>:</para>

	  <programlisting>network={
  ssid="my_net"
  key_mgmt=NONE
  wep_key3=3456789012
  wep_tx_keyidx=3
}</programlisting>

	  <para>Então:</para>

	  <screen><prompt>#</prompt> <userinput>wpa_supplicant -i <replaceable>wlan0</replaceable> -c /etc/wpa_supplicant.conf</userinput>
Trying to associate with 00:13:46:49:41:76 (SSID='dlinkap' freq=2437 MHz)
Associated with 00:13:46:49:41:76</screen>
	</sect4>
      </sect3>
    </sect2>

    <sect2>
      <title>Modo Ad-hoc</title>

      <para>O modo <acronym>IBSS</acronym>, também chamado de modo ad-hoc, é projetado para conexões ponto a ponto. Por exemplo, para estabelecer uma rede ad-hoc entre as máquinas <systemitem>A</systemitem> e <systemitem>B</systemitem>, escolha dois endereços <acronym>IP</acronym> e um <acronym>SSID</acronym>.</para>

      <para>Em <systemitem>A</systemitem>:</para>

      <screen><prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> create wlandev <replaceable>ath0</replaceable> wlanmode adhoc</userinput>
<prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> inet <replaceable>192.168.0.1</replaceable> netmask <replaceable>255.255.255.0</replaceable> ssid <replaceable>freebsdap</replaceable></userinput>
<prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable></userinput>
  wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:c3:0d:ac
	  inet 192.168.0.1 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet autoselect mode 11g &lt;adhoc&gt;
	  status: running
	  ssid freebsdap channel 2 (2417 Mhz 11g) bssid 02:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy OFF txpower 21.5 scanvalid 60
	  protmode CTS wme burst</screen>

      <para>O parâmetro <literal>adhoc</literal> indica que a interface está sendo executada no modo <acronym>IBSS</acronym>.</para>

      <para><systemitem>B</systemitem> deve ser capaz de detectar <systemitem>A</systemitem>:</para>

      <screen><prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> create wlandev <replaceable>ath0</replaceable> wlanmode adhoc</userinput>
<prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> up scan</userinput>
  SSID/MESH ID    BSSID              CHAN RATE   S:N     INT CAPS
  freebsdap       02:11:95:c3:0d:ac    2   54M -64:-96  100 IS   WME</screen>

      <para>O <literal>I</literal> na saída confirma que <systemitem>A</systemitem> está no modo ad-hoc. Agora, configure <systemitem>B</systemitem> com um endereço <acronym>IP</acronym> diferente:</para>

      <screen><prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> inet <replaceable>192.168.0.2</replaceable> netmask <replaceable>255.255.255.0</replaceable> ssid <replaceable>freebsdap</replaceable></userinput>
<prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable></userinput>
  wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:d5:43:62
	  inet 192.168.0.2 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet autoselect mode 11g &lt;adhoc&gt;
	  status: running
	  ssid freebsdap channel 2 (2417 Mhz 11g) bssid 02:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy OFF txpower 21.5 scanvalid 60
	  protmode CTS wme burst</screen>

      <para>Ambos <systemitem>A</systemitem> e <systemitem>B</systemitem> agora estão prontos para trocar informações.</para>
    </sect2>

    <sect2 xml:id="network-wireless-ap">
      <title>Pontos de Acesso com um host FreeBSD</title>

      <para>O FreeBSD pode atuar como um Access Point (<acronym>AP</acronym>), o que elimina a necessidade de comprar um hardware <acronym>AP</acronym> ou executar uma rede ad-hoc. Isso pode ser particularmente útil quando uma máquina FreeBSD está atuando como um gateway para outra rede, como a Internet.</para>

      <sect3 xml:id="network-wireless-ap-basic">
	<title>Configurações básicas</title>

	<para>Antes de configurar uma máquina FreeBSD como um <acronym>AP</acronym>, o kernel deve ser configurado com o suporte de rede apropriado para a placa wireless assim como os protocolos de segurança que estão sendo usados. Para maiores detalhes, veja <xref linkend="network-wireless-basic"/>.</para>

	<note>
	  <para>O wrapper do driver <acronym>NDIS</acronym> para os drivers <trademark class="registered">Windows</trademark> não suporta atualmente a operação <acronym>AP</acronym>. Somente os drivers nativos de rede sem fio do FreeBSD suportam o modo <acronym>AP</acronym>.</para>
	</note>

	<para>Quando o suporte à rede sem fio estiver carregado, verifique se o dispositivo sem fio oferece suporte ao modo de ponto de acesso baseado em host, também conhecido como modo hostap:</para>

	<screen><prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> create wlandev <replaceable>ath0</replaceable></userinput>
<prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> list caps</userinput>
drivercaps=6f85edc1&lt;STA,FF,TURBOP,IBSS,HOSTAP,AHDEMO,TXPMGT,SHSLOT,SHPREAMBLE,MONITOR,MBSS,WPA1,WPA2,BURST,WME,WDS,BGSCAN,TXFRAG&gt;
cryptocaps=1f&lt;WEP,TKIP,AES,AES_CCM,TKIPMIC&gt;</screen>

	<para>Esta saída exibe os recursos da placa. A palavra <literal>HOSTAP</literal> confirma que esta placa sem fio pode atuar como um <acronym>AP</acronym>. Diversas cifras suportadas também são listadas: <acronym>WEP</acronym>, <acronym>TKIP</acronym> e <acronym>AES</acronym>. Esta informação indica quais protocolos de segurança podem ser usados no <acronym>AP</acronym>.</para>

	<para>O dispositivo sem fio só pode ser colocado no modo hostap durante a criação do pseudo-dispositivo de rede, portanto, um dispositivo criado anteriormente deve ser destruído primeiro:</para>

	<screen><prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> destroy</userinput></screen>

	<para>e então regenerado com a opção correta antes de configurar os outros parâmetros:</para>

	<screen><prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> create wlandev <replaceable>ath0</replaceable> wlanmode hostap</userinput>
<prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> inet <replaceable>192.168.0.1</replaceable> netmask <replaceable>255.255.255.0</replaceable> ssid <replaceable>freebsdap</replaceable> mode 11g channel 1</userinput></screen>

	<para>Use o <citerefentry><refentrytitle>ifconfig</refentrytitle><manvolnum>8</manvolnum></citerefentry> novamente para ver o status da interface <filename>wlan0</filename>:</para>

	<screen><prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable></userinput>
  wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:c3:0d:ac
	  inet 192.168.0.1 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet autoselect mode 11g &lt;hostap&gt;
	  status: running
	  ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy OFF txpower 21.5 scanvalid 60
	  protmode CTS wme burst dtimperiod 1 -dfs</screen>

	<para>O parâmetro <literal>hostap</literal> indica que a interface está sendo executada no modo de ponto de acesso baseado em host.</para>

	<para>A configuração da interface pode ser feita automaticamente no momento da inicialização, adicionando as seguintes linhas ao <filename>/etc/rc.conf</filename>:</para>

	<programlisting>wlans_ath0="wlan0"
create_args_wlan0="wlanmode hostap"
ifconfig_wlan0="inet <replaceable>192.168.0.1</replaceable> netmask <replaceable>255.255.255.0</replaceable> ssid <replaceable>freebsdap</replaceable> mode 11g channel <replaceable>1</replaceable>"</programlisting>
      </sect3>

      <sect3>
	<title>Ponto de acesso baseado em host sem autenticação ou criptografia</title>

	<para>Embora não seja recomendado executar um <acronym>AP</acronym> sem nenhuma autenticação ou criptografia, esta é uma maneira simples de verificar se o <acronym>AP</acronym> está funcionando. Essa configuração também é importante para depurar problemas do cliente.</para>

	<para>Quando o <acronym>AP</acronym> estiver configurado, inicie uma verificação de outra máquina sem fio para encontrar o <acronym>AP</acronym>:</para>

	<screen><prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> create wlandev <replaceable>ath0</replaceable></userinput>
<prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> up scan</userinput>
SSID/MESH ID    BSSID              CHAN RATE   S:N     INT CAPS
freebsdap       00:11:95:c3:0d:ac    1   54M -66:-96  100 ES   WME</screen>

	<para>A máquina cliente encontrou o <acronym>AP</acronym> e pode ser associado a ele:</para>

	<screen><prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> inet <replaceable>192.168.0.2</replaceable> netmask <replaceable>255.255.255.0</replaceable> ssid <replaceable>freebsdap</replaceable></userinput>
<prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable></userinput>
  wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:d5:43:62
	  inet 192.168.0.2 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet OFDM/54Mbps mode 11g
	  status: associated
	  ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy OFF txpower 21.5 bmiss 7
	  scanvalid 60 bgscan bgscanintvl 300 bgscanidle 250 roam:rssi 7
	  roam:rate 5 protmode CTS wme burst</screen>
      </sect3>

      <sect3 xml:id="network-wireless-ap-wpa">
	<title>Ponto de acesso baseado em host com <acronym>WPA2</acronym></title>

	<para>Esta seção se concentra na configuração de um ponto de acesso do FreeBSD usando o protocolo de segurança <acronym>WPA2</acronym>. Maiores detalhes sobre <acronym>WPA</acronym> e a configuração de clientes sem fio baseados em <acronym>WPA</acronym> podem ser encontrados em <xref linkend="network-wireless-wpa"/>.</para>

	<para>O daemon <citerefentry><refentrytitle>hostapd</refentrytitle><manvolnum>8</manvolnum></citerefentry> é usado para lidar com a autenticação de clientes e o gerenciamento de chaves no <acronym>AP</acronym> com <acronym>WPA2</acronym> habilitado.</para>

	<para>As seguintes operações de configuração são executadas na máquina FreeBSD atuando como o <acronym>AP</acronym>. Uma vez que o <acronym>AP</acronym> esteja funcionando corretamente, o  <citerefentry><refentrytitle>hostapd</refentrytitle><manvolnum>8</manvolnum></citerefentry> pode ser iniciado automaticamente na inicialização com essa linha em <filename>/etc/rc.conf</filename>:</para>

	<programlisting>hostapd_enable="YES"</programlisting>

	<para>Antes de tentar configurar o <citerefentry><refentrytitle>hostapd</refentrytitle><manvolnum>8</manvolnum></citerefentry>, primeiro defina as configurações básicas introduzidas em <xref linkend="network-wireless-ap-basic"/> .</para>

	<sect4>
	  <title><acronym>WPA2-PSK</acronym></title>

	  <para>O <acronym>WPA2-PSK</acronym> destina-se a redes pequenas em que o uso de um servidor de autenticação backend não é possível ou desejado.</para>

	  <para>A configuração é feita em <filename>/etc/hostapd.conf</filename>:</para>

	  <programlisting>interface=wlan0                  <co xml:id="co-ap-wpapsk-iface"/>
debug=1                          <co xml:id="co-ap-wpapsk-dbug"/>
ctrl_interface=/var/run/hostapd  <co xml:id="co-ap-wpapsk-ciface"/>
ctrl_interface_group=wheel       <co xml:id="co-ap-wpapsk-cifacegrp"/>
ssid=freebsdap                   <co xml:id="co-ap-wpapsk-ssid"/>
wpa=2                            <co xml:id="co-ap-wpapsk-wpa"/>
wpa_passphrase=freebsdmall       <co xml:id="co-ap-wpapsk-pass"/>
wpa_key_mgmt=WPA-PSK             <co xml:id="co-ap-wpapsk-kmgmt"/>
wpa_pairwise=CCMP                <co xml:id="co-ap-wpapsk-pwise"/></programlisting>

	  <calloutlist>
	    <callout arearefs="co-ap-wpapsk-iface">
	      <para>Interface sem fio usada para o ponto de acesso.</para>
	    </callout>

	    <callout arearefs="co-ap-wpapsk-dbug">
	      <para>Nível de detalhamento usado durante a execução de <citerefentry><refentrytitle>hostapd</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Um valor de <literal>1</literal> representa o nível mínimo.</para>
	    </callout>

	    <callout arearefs="co-ap-wpapsk-ciface">
	      <para>Nome do caminho de diretório usado pelo <citerefentry><refentrytitle>hostapd</refentrytitle><manvolnum>8</manvolnum></citerefentry> para armazenar arquivos de soquete de domínio para comunicação com programas externos, como <citerefentry><refentrytitle>hostapd_cli</refentrytitle><manvolnum>8</manvolnum></citerefentry>. O valor padrão é usado neste exemplo.</para>
	    </callout>

	    <callout arearefs="co-ap-wpapsk-cifacegrp">
	      <para>O grupo permitiu acessar os arquivos da interface de controle.</para>
	    </callout>

	    <callout arearefs="co-ap-wpapsk-ssid">
	      <para>O nome da rede sem fio, ou <acronym>SSID</acronym>, que aparecerá nas varreduras sem fio.</para>
	    </callout>

	    <callout arearefs="co-ap-wpapsk-wpa">
	      <para>Ative o <acronym>WPA</acronym> e especifique qual protocolo de autenticação <acronym>WPA</acronym> será necessário. Um valor de <literal>2</literal> configura o <acronym>AP</acronym> para <acronym>WPA2</acronym> e é recomendado. Defina como <literal>1</literal> apenas se o <acronym>WPA</acronym> obsoleto for necessário.</para>
	    </callout>

	    <callout arearefs="co-ap-wpapsk-pass">
	      <para>Senha ASCII para autenticação <acronym>WPA</acronym>.</para>

	      <warning>
		<para>Sempre use senhas fortes com pelo menos 8 caracteres de comprimento e feitas de um alfabeto rico, para que elas não sejam facilmente adivinhadas ou atacadas.</para>
	      </warning>
	    </callout>

	    <callout arearefs="co-ap-wpapsk-kmgmt">
	      <para>O protocolo de gerenciamento de chaves a ser usado. Este exemplo define o <acronym>WPA-PSK</acronym>.</para>
	    </callout>

	    <callout arearefs="co-ap-wpapsk-pwise">
	      <para>Algoritmos de criptografia aceitos pelo ponto de acesso. Neste exemplo, apenas a codificação <acronym>CCMP</acronym> (<acronym>AES</acronym>) é aceita. O <acronym>CCMP</acronym> é uma alternativa ao <acronym>TKIP</acronym> e é fortemente preferido quando possível. O <acronym>TKIP</acronym> só deve ser permitido quando houver estações incapazes de usar o <acronym>CCMP</acronym>.</para>
	    </callout>
	  </calloutlist>

	  <para>O próximo passo é iniciar <citerefentry><refentrytitle>hostapd</refentrytitle><manvolnum>8</manvolnum></citerefentry>:</para>

	  <screen><prompt>#</prompt> <userinput>service hostapd forcestart</userinput></screen>

	  <screen><prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable></userinput>
wlan0: flags=8943&lt;UP,BROADCAST,RUNNING,PROMISC,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	ether 04:f0:21:16:8e:10
	inet6 fe80::6f0:21ff:fe16:8e10%wlan0 prefixlen 64 scopeid 0x9
	nd6 options=21&lt;PERFORMNUD,AUTO_LINKLOCAL&gt;
	media: IEEE 802.11 Wireless Ethernet autoselect mode 11na &lt;hostap&gt;
	status: running
	ssid No5ignal channel 36 (5180 MHz 11a ht/40+) bssid 04:f0:21:16:8e:10
	country US ecm authmode WPA2/802.11i privacy MIXED deftxkey 2
	AES-CCM 2:128-bit AES-CCM 3:128-bit txpower 17 mcastrate 6 mgmtrate 6
	scanvalid 60 ampdulimit 64k ampdudensity 8 shortgi wme burst
	dtimperiod 1 -dfs
	groups: wlan</screen>

	  <para>Quando o <acronym>AP</acronym> está em execução, os clientes podem associar-se a ele. Veja <xref linkend="network-wireless-wpa"/> para maiores detalhes. É possível ver as estações associadas ao <acronym>AP</acronym> usando o <command>ifconfig <replaceable>wlan0</replaceable> list sta</command>.</para>
	</sect4>
      </sect3>

      <sect3>
	<title>Ponto de acesso baseado em host <acronym>WEP</acronym></title>

	<para>Não é recomendado o uso do <acronym>WEP</acronym> para configurar um <acronym>AP</acronym>, já que não há mecanismo de autenticação e a criptografia é facilmente quebrada. Algumas placas sem fio legadas suportam apenas o <acronym>WEP</acronym> e essas placas suportarão apenas um <acronym>AP</acronym> sem autenticação ou criptografia.</para>

	<para>O dispositivo sem fio agora pode ser colocado no modo hostap e configurado com o endereço <acronym>SSID</acronym> e <acronym>IP</acronym> corretos:</para>

	<screen><prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> create wlandev <replaceable>ath0</replaceable> wlanmode hostap</userinput>
<prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> inet <replaceable>192.168.0.1</replaceable> netmask <replaceable>255.255.255.0</replaceable> \
	ssid <replaceable>freebsdap</replaceable> wepmode on weptxkey <replaceable>3</replaceable> wepkey <replaceable>3:0x3456789012</replaceable> mode 11g</userinput></screen>

	<itemizedlist>
	  <listitem>
	    <para>O <literal>weptxkey</literal> indica qual a chave <acronym>WEP</acronym> será usada na transmissão. Este exemplo usa a terceira chave, pois a numeração de chaves começa com <literal>1</literal>. Esse parâmetro deve ser especificado para criptografar os dados.</para>
	  </listitem>

	  <listitem>
	    <para>O <literal>wepkey</literal> define a chave <acronym>WEP</acronym> selecionada. Ela deve estar no formato <replaceable>index:key</replaceable>. Se o índice não for fornecido, a chave <literal>1</literal> será configurada. O índice precisa ser definido ao usar chaves diferentes da primeira chave.</para>
	  </listitem>
	</itemizedlist>

	<para>Use o <citerefentry><refentrytitle>ifconfig</refentrytitle><manvolnum>8</manvolnum></citerefentry> para ver o status da interface <filename>wlan0</filename>:</para>

	<screen><prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable></userinput>
  wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:c3:0d:ac
	  inet 192.168.0.1 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet autoselect mode 11g &lt;hostap&gt;
	  status: running
	  ssid freebsdap channel 4 (2427 Mhz 11g) bssid 00:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy ON deftxkey 3 wepkey 3:40-bit
	  txpower 21.5 scanvalid 60 protmode CTS wme burst dtimperiod 1 -dfs</screen>

	<para>De uma outra máquina sem fio, agora é possível iniciar uma varredura para encontrar o <acronym>AP</acronym>:</para>

	<screen><prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> create wlandev <replaceable>ath0</replaceable></userinput>
<prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> up scan</userinput>
SSID            BSSID              CHAN RATE  S:N   INT CAPS
freebsdap       00:11:95:c3:0d:ac    1   54M 22:1   100 EPS</screen>

	<para>Neste exemplo, a máquina cliente encontrou o <acronym>AP</acronym> e pode associá-lo usando os parâmetros corretos. Veja <xref linkend="network-wireless-wep"/> para maiores detalhes.</para>
      </sect3>
    </sect2>

    <sect2>
      <title>Usando conexões com fio e sem fio</title>

      <para>Uma conexão com fio oferece melhor desempenho e confiabilidade, enquanto uma conexão sem fio fornece flexibilidade e mobilidade. Os usuários de laptop normalmente querem se movimentar perfeitamente entre os dois tipos de conexão.</para>

      <para>No FreeBSD, é possível combinar duas ou mais interfaces de rede em um <quote>failover</quote>. Esse tipo de configuração usa a conexão mais prioritária e disponível de um grupo de interfaces de rede, e o sistema operacional alterna automaticamente quando o estado do link é alterado.</para>

      <para>A agregação de links e o failover são cobertos em <xref linkend="network-aggregation"/> e um exemplo para usar conexões com e sem fio é fornecido em <xref linkend="networking-lagg-wired-and-wireless"/>.</para>
    </sect2>

    <sect2>
      <title>Solução de problemas</title>

      <para>Esta seção descreve várias etapas para ajudar a solucionar problemas comuns de rede sem fio.</para>

      <itemizedlist>
	<listitem>
	  <para>Se o ponto de acesso não estiver listado durante a verificação, verifique se a configuração não limitou o dispositivo sem fio a um conjunto limitado de canais.</para>
	</listitem>

	<listitem>
	  <para>Se o dispositivo não puder se associar a um ponto de acesso, verifique se a configuração corresponde às configurações no ponto de acesso. Isso inclui o esquema de autenticação e qualquer protocolo de segurança. Simplifique a configuração tanto quanto possível. Se estiver usando um protocolo de segurança, como o <acronym>WPA</acronym> ou o <acronym>WEP</acronym>, configure o ponto de acesso para autenticação aberta e nenhuma segurança para ver se o tráfego irá passar.</para>

	  <para>O suporte a depuração é fornecido pelo <citerefentry><refentrytitle>wpa_supplicant</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Tente executar este utilitário manualmente com a opção <option>-dd</option> e examine os logs do sistema.</para>
	</listitem>

	<listitem>
	  <para>Uma vez que o sistema possa se associar com o ponto de acesso, diagnostique a configuração da rede usando ferramentas como o <citerefentry><refentrytitle>ping</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
	</listitem>

	<listitem>
	  <para>Existem muitas ferramentas de depuração de nível inferior. As mensagens de depuração podem ser ativadas na camada de suporte do protocolo 802.11 usando o <citerefentry><refentrytitle>wlandebug</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Por exemplo, para habilitar mensagens do console relacionadas à varredura de pontos de acesso e aos handshakes do protocolo 802.11 necessários para organizar a comunicação:</para>

	  <screen><prompt>#</prompt> <userinput>wlandebug -i <replaceable>wlan0</replaceable> +scan+auth+debug+assoc</userinput>
  net.wlan.0.debug: 0 =&gt; 0xc80000&lt;assoc,auth,scan&gt;</screen>

	  <para>Muitas estatísticas úteis são mantidas pela camada 802.11 e o <command>wlanstats</command>, encontrado em <filename>/usr/src/tools/tools/net80211</filename>, vai despejar esta informação. Essas estatísticas devem exibir todos os erros identificados pela camada 802.11. No entanto, alguns erros são identificados nos drivers de dispositivo que estão abaixo da camada 802.11, portanto eles podem não aparecer. Para diagnosticar problemas específicos do dispositivo, consulte a documentação do driver.</para>
	</listitem>
      </itemizedlist>

      <para>Se as informações acima não ajudarem a esclarecer o problema, envie um relatório de problemas e inclua a saída das ferramentas acima.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="network-usb-tethering">
    <info>
      <title>USB Tethering</title>
    </info>

    <indexterm><primary>tether</primary></indexterm>

    <para>Muitos telefones celulares oferecem a opção de compartilhar sua conexão de dados sobre o USB (muitas vezes chamado de "tethering"). Este recurso usa o <acronym>RNDIS</acronym>, <acronym>CDC</acronym> ou um protocolo personalizado <trademark class="registered">Apple</trademark> <trademark class="registered">iPhone</trademark>/<trademark class="registered">iPad</trademark>.</para>

    <itemizedlist>
      <listitem>
	<para>Os dispositivos <trademark>Android</trademark> geralmente utilizam o driver <citerefentry><refentrytitle>urndis</refentrytitle><manvolnum>4</manvolnum></citerefentry>.</para>
      </listitem>

      <listitem>
	<para>Os dispositivos <trademark class="registered">Apple</trademark> utilizam o driver <citerefentry><refentrytitle>ipheth</refentrytitle><manvolnum>4</manvolnum></citerefentry>.</para>
      </listitem>

      <listitem>
	<para>Dispositivos mais antigos geralmente utilizam o driver <citerefentry><refentrytitle>cdce</refentrytitle><manvolnum>4</manvolnum></citerefentry>.</para>
      </listitem>
    </itemizedlist>

    <para>Antes de conectar um dispositivo, carregue o driver apropriado no kernel:</para>

    <screen><prompt>#</prompt> <userinput>kldload if_urndis</userinput>
<prompt>#</prompt> <userinput>kldload if_cdce</userinput>
<prompt>#</prompt> <userinput>kldload if_ipheth</userinput></screen>

    <para>Uma vez que o dispositivo esteja conectado, <literal>ue</literal><replaceable>0</replaceable> estará disponível para uso como um dispositivo de rede normal. Certifique-se de que a opção <quote>USB Tethering</quote> esteja ativada no dispositivo.</para>

    <para>Para tornar essa alteração permanente e carregar o driver como um módulo no momento da inicialização, coloque a linha apropriada abaixo em <filename>/boot/loader.conf</filename>:</para>

    <screen><userinput>if_urndis_load="YES"
if_cdce_load="YES"
if_ipheth_load="YES"</userinput></screen>
  </sect1>

  <sect1 xml:id="network-bluetooth">
    <info>
      <title>Bluetooth</title>

      <authorgroup>
	<author><personname> <firstname> Pav </firstname> <surname> Lucistnik </surname> </personname> <contrib> Escrito por </contrib> <email> pav@FreeBSD.org </email></author>
      </authorgroup>
    </info>

    <indexterm><primary>Bluetooth</primary></indexterm>

    <para>O bluetooth é uma tecnologia sem fio para a criação de redes pessoais que operam na faixa não licenciada de 2,4 GHz, com um alcance de 10 metros. As redes geralmente são formadas em modo ad-hoc a partir de dispositivos portáteis, como telefones celulares, computadores de mão e laptops. Ao contrário da tecnologia sem fio Wi-Fi, o Bluetooth oferece perfis de serviços de nível superior, como servidores de arquivos semelhantes ao <acronym>FTP</acronym>, envio de arquivos, transporte de voz, emulação de linha serial e muito mais.</para>

    <para>Esta seção descreve o uso de um dongle Bluetooth <acronym>USB</acronym> em um sistema FreeBSD. Em seguida, descreve os vários protocolos e utilitários Bluetooth.</para>

    <sect2>
      <title>Carregando o Suporte Bluetooth</title>

      <para>A pilha Bluetooth no FreeBSD é implementada usando o framework <citerefentry><refentrytitle>netgraph</refentrytitle><manvolnum>4</manvolnum></citerefentry>. Uma ampla variedade de dongles Bluetooth <acronym>USB</acronym> é suportada pelo <citerefentry><refentrytitle>ng_ubt</refentrytitle><manvolnum>4</manvolnum></citerefentry>. Os dispositivos Bluetooth baseados no Broadcom BCM2033 são suportados pelos drivers <citerefentry><refentrytitle>ubtbcmfw</refentrytitle><manvolnum>4</manvolnum></citerefentry> e <citerefentry><refentrytitle>ng_ubt</refentrytitle><manvolnum>4</manvolnum></citerefentry>. A placa 3Com Bluetooth PC Card 3CRWB60-A é suportada pelo driver <citerefentry><refentrytitle>ng_bt3c</refentrytitle><manvolnum>4</manvolnum></citerefentry>. Dispositivos Bluetooth baseados em Portas Seriais e UART são suportados por <citerefentry><refentrytitle>sio</refentrytitle><manvolnum>4</manvolnum></citerefentry>, <citerefentry><refentrytitle>ng_h4</refentrytitle><manvolnum>4</manvolnum></citerefentry>, e <citerefentry><refentrytitle>hcseriald</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>

      <para>Antes de conectar um dispositivo, determine qual dos drivers acima ele usa e, em seguida, carregue o driver. Por exemplo, se o dispositivo usar o driver <citerefentry><refentrytitle>ng_ubt</refentrytitle><manvolnum>4</manvolnum></citerefentry>:</para>

      <screen><prompt>#</prompt> <userinput>kldload ng_ubt</userinput></screen>

      <para>Se o dispositivo Bluetooth for conectado ao sistema durante a inicialização do sistema, o sistema pode ser configurado para carregar o módulo no momento da inicialização, adicionando o driver ao <filename>/boot/loader.conf</filename>:</para>

      <programlisting>ng_ubt_load="YES"</programlisting>

      <para>Quando o driver estiver carregado, conecte o dongle <acronym>USB</acronym>. Se a carga do driver tiver sido bem-sucedida, uma saída semelhante à seguinte deve aparecer no console e em <filename>/var/log/messages</filename>:</para>

      <screen>ubt0: vendor 0x0a12 product 0x0001, rev 1.10/5.25, addr 2
ubt0: Interface 0 endpoints: interrupt=0x81, bulk-in=0x82, bulk-out=0x2
ubt0: Interface 1 (alt.config 5) endpoints: isoc-in=0x83, isoc-out=0x3,
      wMaxPacketSize=49, nframes=6, buffer size=294</screen>

      <para>Para iniciar e parar a stack Bluetooth, use seu script de inicialização. É uma boa ideia parar a stack antes de desconectar o dispositivo. Iniciar a stack bluetooth pode exigir que o <citerefentry><refentrytitle>hcsecd</refentrytitle><manvolnum>8</manvolnum></citerefentry> seja iniciado. Ao iniciar a stack, a saída deve ser semelhante à seguinte:</para>

      <screen><prompt>#</prompt> <userinput>service bluetooth start ubt0</userinput>
BD_ADDR: 00:02:72:00:d4:1a
Features: 0xff 0xff 0xf 00 00 00 00 00
&lt;3-Slot&gt; &lt;5-Slot&gt; &lt;Encryption&gt; &lt;Slot offset&gt;
&lt;Timing accuracy&gt; &lt;Switch&gt; &lt;Hold mode&gt; &lt;Sniff mode&gt;
&lt;Park mode&gt; &lt;RSSI&gt; &lt;Channel quality&gt; &lt;SCO link&gt;
&lt;HV2 packets&gt; &lt;HV3 packets&gt; &lt;u-law log&gt; &lt;A-law log&gt; &lt;CVSD&gt;
&lt;Paging scheme&gt; &lt;Power control&gt; &lt;Transparent SCO data&gt;
Max. ACL packet size: 192 bytes
Number of ACL packets: 8
Max. SCO packet size: 64 bytes
Number of SCO packets: 8</screen>
    </sect2>

    <sect2>
      <title>Encontrando outros dispositivos Bluetooth</title>

      <indexterm><primary>HCI</primary></indexterm>

      <para>A Interface do Controlador do Host (<acronym>HCI</acronym>) fornece um método uniforme para acessar os recursos de banda básica do Bluetooth. No FreeBSD, um nó netgraph <acronym>HCI</acronym> é criado para cada dispositivo Bluetooth. Para mais detalhes, consulte <citerefentry><refentrytitle>ng_hci</refentrytitle><manvolnum>4</manvolnum></citerefentry>.</para>

      <para>Uma das tarefas mais comuns é a descoberta de dispositivos Bluetooth dentro da proximidade <acronym>RF</acronym>. Esta operação é chamada <emphasis>inquiry</emphasis>. Investigação e outras operações relacionadas a <acronym>HCI</acronym> são feitas usando <citerefentry><refentrytitle>hccontrol</refentrytitle><manvolnum>8</manvolnum></citerefentry>. O exemplo abaixo mostra como descobrir quais dispositivos Bluetooth estão ao alcance. A lista de dispositivos deve ser exibida em alguns segundos. Note que um dispositivo remoto só irá responder a pergunta se estiver configurado para o modo <emphasis>detectável</emphasis>.</para>

      <screen><prompt>%</prompt> <userinput>hccontrol -n ubt0hci inquiry</userinput>
Inquiry result, num_responses=1
Inquiry result #0
       BD_ADDR: 00:80:37:29:19:a4
       Page Scan Rep. Mode: 0x1
       Page Scan Period Mode: 00
       Page Scan Mode: 00
       Class: 52:02:04
       Clock offset: 0x78ef
Inquiry complete. Status: No error [00]</screen>

      <para>O <literal>BD_ADDR</literal> é o endereço exclusivo de um dispositivo Bluetooth, semelhante ao endereço <acronym>MAC</acronym> de uma placa de rede. Este endereço é necessário para uma comunicação posterior com um dispositivo e é possível atribuir um nome legível a um <literal>BD_ADDR</literal>. Informações sobre os hosts Bluetooth conhecidos estão contidas em <filename>/etc/bluetooth/hosts</filename>. O exemplo a seguir mostra como obter o nome legível que foi atribuído ao dispositivo remoto:</para>

      <screen><prompt>%</prompt> <userinput>hccontrol -n ubt0hci remote_name_request 00:80:37:29:19:a4</userinput>
BD_ADDR: 00:80:37:29:19:a4
Name: Pav's T39</screen>

      <para>Se uma consulta for realizada em um dispositivo Bluetooth remoto, ele encontrará o computador como <quote>your.host.name (ubt0)</quote>. O nome atribuído ao dispositivo local pode ser alterado a qualquer momento.</para>

      <para>Dispositivos remotos podem receber aliases em <filename>/etc/bluetooth/hosts</filename>. Maiores informações sobre o arquivo <filename>/etc/bluetooth/hosts</filename> podem ser encontradas em <citerefentry><refentrytitle>bluetooth.hosts</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>

      <para>O sistema Bluetooth fornece uma conexão ponta-a-ponto entre duas unidades Bluetooth ou uma conexão ponto-a-multiponto que é compartilhada entre vários dispositivos Bluetooth. O exemplo a seguir mostra como criar uma conexão a um dispositivo remoto:</para>

      <screen><prompt>%</prompt> <userinput>hccontrol -n ubt0hci create_connection <replaceable>BT_ADDR</replaceable></userinput></screen>

      <para>O <literal>create_connection</literal> aceita <literal>BT_ADDR</literal>, bem como aliases de host em <filename>/etc/bluetooth/hosts</filename>.</para>

      <para>O exemplo a seguir mostra como obter a lista de conexões de banda base ativas para o dispositivo local:</para>

      <screen><prompt>%</prompt> <userinput>hccontrol -n ubt0hci read_connection_list</userinput>
Remote BD_ADDR    Handle Type Mode Role Encrypt Pending Queue State
00:80:37:29:19:a4     41  ACL    0 MAST    NONE       0     0 OPEN</screen>

      <para>Um <emphasis>identificador de conexão</emphasis> é útil quando a finalização da conexão de banda base é necessária, embora normalmente não seja necessário fazer isso manualmente. A stack terminará automaticamente as conexões de banda básica inativas.</para>

      <screen><prompt>#</prompt> <userinput>hccontrol -n ubt0hci disconnect 41</userinput>
Connection handle: 41
Reason: Connection terminated by local host [0x16]</screen>

      <para>Digite <command>hccontrol help</command> para obter uma lista completa dos comandos <acronym>HCI</acronym> disponíveis. A maioria dos comandos <acronym>HCI</acronym> não requer privilégios de superusuário.</para>
    </sect2>

    <sect2>
      <title>Emparelhamento de dispositivos</title>

      <para>Por padrão, a comunicação Bluetooth não é autenticada e qualquer dispositivo pode conversar com qualquer outro dispositivo. Um dispositivo Bluetooth, como um telefone celular, pode optar por exigir autenticação para fornecer um serviço específico. A autenticação Bluetooth é normalmente feita com um <emphasis><acronym>PIN</acronym> code</emphasis>, uma string ASCII com até 16 caracteres de comprimento. O usuário é obrigado a digitar o mesmo código de <acronym>PIN</acronym> em ambos os dispositivos. Depois que o usuário inserir o código de <acronym>PIN</acronym>, ambos os dispositivos gerarão uma <emphasis>chave de link</emphasis>. Depois disso, a chave de link pode ser armazenada nos dispositivos ou em um armazenamento persistente. Na próxima vez, os dois dispositivos usarão a chave de link gerada anteriormente. Este procedimento é chamado de <emphasis>emparelhamento</emphasis>. Observe que, se a chave de link for perdida por um dos dispositivos, o emparelhamento deverá ser repetido.</para>

      <para>O daemon <citerefentry><refentrytitle>hcsecd</refentrytitle><manvolnum>8</manvolnum></citerefentry> é responsável por tratar os pedidos de autenticação Bluetooth. O arquivo de configuração padrão é o <filename>/etc/bluetooth/hcsecd.conf</filename>. Uma seção de exemplo para um telefone celular com o código <acronym>PIN</acronym> definido como <literal>1234</literal> é mostrada abaixo:</para>

      <programlisting>device {
        bdaddr  00:80:37:29:19:a4;
        name    "Pav's T39";
        key     nokey;
        pin     "1234";
      }</programlisting>

      <para>A única limitação nos códigos de <acronym>PIN</acronym> é o comprimento. Alguns dispositivos, como fones de ouvido Bluetooth, podem ter um código <acronym>PIN</acronym> integrado fixo. A opção <option>-d</option> força o  <citerefentry><refentrytitle>hcsecd</refentrytitle><manvolnum>8</manvolnum></citerefentry> a ficar em primeiro plano, então é fácil ver o que está acontecendo. Configure o dispositivo remoto para receber o emparelhamento e inicie a conexão Bluetooth ao dispositivo remoto. O dispositivo remoto deve indicar que o pareamento foi aceito e solicitar o código de <acronym>PIN</acronym>. Digite o mesmo código de <acronym>PIN</acronym> listado em <filename>hcsecd.conf</filename>. Agora o computador e o dispositivo remoto estão emparelhados. Alternativamente, o emparelhamento pode ser iniciado no dispositivo remoto.</para>

      <para>A seguinte linha pode ser adicionada ao <filename>/etc/rc.conf</filename> para configurar o <citerefentry><refentrytitle>hcsecd</refentrytitle><manvolnum>8</manvolnum></citerefentry> para iniciar automaticamente quando o sistema inicializar:</para>

      <programlisting>hcsecd_enable="YES"</programlisting>

      <para>A seguir, um exemplo da saída do daemon <citerefentry><refentrytitle>hcsecd</refentrytitle><manvolnum>8</manvolnum></citerefentry>:</para>

      <programlisting>hcsecd[16484]: Got Link_Key_Request event from 'ubt0hci', remote bdaddr 0:80:37:29:19:a4
hcsecd[16484]: Found matching entry, remote bdaddr 0:80:37:29:19:a4, name 'Pav's T39', link key doesn't exist
hcsecd[16484]: Sending Link_Key_Negative_Reply to 'ubt0hci' for remote bdaddr 0:80:37:29:19:a4
hcsecd[16484]: Got PIN_Code_Request event from 'ubt0hci', remote bdaddr 0:80:37:29:19:a4
hcsecd[16484]: Found matching entry, remote bdaddr 0:80:37:29:19:a4, name 'Pav's T39', PIN code exists
hcsecd[16484]: Sending PIN_Code_Reply to 'ubt0hci' for remote bdaddr 0:80:37:29:19:a4</programlisting>
    </sect2>

    <sect2>
      <title>Acesso à rede com perfis <acronym>PPP</acronym></title>

      <para>Um perfil de rede dial-up (<acronym>DUN</acronym>) pode ser usado para configurar um telefone celular como um modem sem fio para a conexão a um servidor de acesso à Internet dial-up. Também pode ser usado para configurar um computador para receber chamadas de dados de um telefone celular.</para>

      <para>O acesso à rede com um perfil <acronym>PPP</acronym> pode ser usado para fornecer acesso <acronym>LAN</acronym> a um único dispositivo Bluetooth ou a vários dispositivos Bluetooth. Ele também pode fornecer uma conexão <acronym>PC</acronym> para <acronym>PC</acronym> usando uma rede <acronym>PPP</acronym> sobre uma emulação de cabo serial.</para>

      <para>No FreeBSD, esses perfis são implementados com o <citerefentry><refentrytitle>ppp</refentrytitle><manvolnum>8</manvolnum></citerefentry> e o wrapper <citerefentry><refentrytitle>rfcomm_pppd</refentrytitle><manvolnum>8</manvolnum></citerefentry> que converte uma conexão Bluetooth em algo que o <acronym>PPP</acronym> pode usar. Antes que um perfil possa ser usado, um novo label <acronym>PPP</acronym> deve ser criado em <filename>/etc/ppp/ppp.conf</filename>. Consulte <citerefentry><refentrytitle>rfcomm_pppd</refentrytitle><manvolnum>8</manvolnum></citerefentry> para exemplos.</para>

      <para>Neste exemplo, o <citerefentry><refentrytitle>rfcomm_pppd</refentrytitle><manvolnum>8</manvolnum></citerefentry> é usado para abrir uma conexão com um dispositivo remoto com um <literal>BD_ADDR</literal> de <literal>00:80:37:29:19:a4</literal> em um canal <acronym>DUN</acronym> <acronym>RFCOMM</acronym>:</para>

      <screen><prompt>#</prompt> <userinput>rfcomm_pppd -a 00:80:37:29:19:a4 -c -C dun -l rfcomm-dialup</userinput></screen>

      <para>O número real do canal será obtido a partir do dispositivo remoto usando o protocolo <acronym>SDP</acronym>. É possível especificar manualmente o canal <acronym>RFCOMM</acronym> e, nesse caso, o <citerefentry><refentrytitle>rfcomm_pppd</refentrytitle><manvolnum>8</manvolnum></citerefentry> não executará a consulta <acronym>SDP</acronym>. Use o <citerefentry><refentrytitle>sdpcontrol</refentrytitle><manvolnum>8</manvolnum></citerefentry> para descobrir o canal <acronym>RFCOMM</acronym> no dispositivo remoto.</para>

      <para>Para fornecer acesso à rede com o serviço <acronym>PPP</acronym> <acronym>LAN</acronym>, o <citerefentry><refentrytitle>sdpd</refentrytitle><manvolnum>8</manvolnum></citerefentry> precisa estar sendo executado e uma nova entrada para clientes <acronym>LAN</acronym> deve ser criada em <filename>/etc/ppp/ppp.conf</filename>. Consulte <citerefentry><refentrytitle>rfcomm_pppd</refentrytitle><manvolnum>8</manvolnum></citerefentry> para exemplos. Por fim, inicie o servidor <acronym>RFCOMM</acronym> <acronym>PPP</acronym> em um número de canal <acronym>RFCOMM</acronym> válido. O servidor <acronym>RFCOMM</acronym> <acronym>PPP</acronym> registrará automaticamente o serviço Bluetooth <acronym>LAN</acronym> com o daemon local <acronym>SDP</acronym>. O exemplo abaixo mostra como iniciar o servidor <acronym>RFCOMM</acronym> <acronym>PPP</acronym>.</para>

      <screen><prompt>#</prompt> <userinput>rfcomm_pppd -s -C 7 -l rfcomm-server</userinput></screen>
    </sect2>

    <sect2>
      <title>Protocolos Bluetooth</title>

      <para>Esta seção fornece uma visão geral dos vários protocolos Bluetooth, suas funções e utilitários associados.</para>

      <sect3>
	<title>Controle de Link Lógico e Protocolo de Adaptação (<acronym>L2CAP</acronym>)</title>

	<indexterm><primary>L2CAP</primary></indexterm>

	<para>O Protocolo de Adaptação e Controle de Link Lógico (<acronym>L2CAP</acronym>) fornece serviços de dados orientados a conexão e sem conexão para protocolos de camada superior. O <acronym>L2CAP</acronym> permite que protocolos e aplicativos de alto nível transmitam e recebam pacotes de dados <acronym>L2CAP</acronym> de até 64 kilobytes de comprimento.</para>

	<para>O <acronym>L2CAP</acronym> é baseado no conceito de <emphasis>canais</emphasis>. Um canal é uma conexão lógica em cima de uma conexão de banda base, na qual cada canal é vinculado a um único protocolo de maneira many-to-one. Vários canais podem ser vinculados ao mesmo protocolo, mas um canal não pode ser vinculado a vários protocolos. Cada pacote <acronym>L2CAP</acronym> recebido em um canal é direcionado para o protocolo apropriado de nível superior. Vários canais podem compartilhar a mesma conexão de banda base.</para>

	<para>No FreeBSD, um nó netgraph <acronym>L2CAP</acronym> é criado para cada dispositivo Bluetooth. Esse nó é normalmente conectado ao nó Bluetooth <acronym>HCI</acronym> downstream e aos nós de soquete Bluetooth upstream. O nome padrão para o nó <acronym>L2CAP</acronym> é <quote>devicel2cap</quote>. Para mais detalhes, consulte <citerefentry><refentrytitle>ng_l2cap</refentrytitle><manvolnum>4</manvolnum></citerefentry>.</para>

	<para>Um comando útil é o <citerefentry><refentrytitle>l2ping</refentrytitle><manvolnum>8</manvolnum></citerefentry>, que pode ser usado para executar ping em outros dispositivos. Algumas implementações Bluetooth podem não retornar todos os dados enviados para elas, portanto, a saída <literal>0 bytes</literal> no exemplo a seguir é normal.</para>

	<screen><prompt>#</prompt> <userinput>l2ping -a 00:80:37:29:19:a4</userinput>
0 bytes from 0:80:37:29:19:a4 seq_no=0 time=48.633 ms result=0
0 bytes from 0:80:37:29:19:a4 seq_no=1 time=37.551 ms result=0
0 bytes from 0:80:37:29:19:a4 seq_no=2 time=28.324 ms result=0
0 bytes from 0:80:37:29:19:a4 seq_no=3 time=46.150 ms result=0</screen>

	<para>O utilitário <citerefentry><refentrytitle>l2control</refentrytitle><manvolnum>8</manvolnum></citerefentry> é usado para executar várias operações em nós <acronym>L2CAP</acronym>. Este exemplo mostra como obter a lista de conexões lógicas (canais) e a lista de conexões de banda base para o dispositivo local:</para>

	<screen><prompt>%</prompt> <userinput>l2control -a 00:02:72:00:d4:1a read_channel_list</userinput>
L2CAP channels:
Remote BD_ADDR     SCID/ DCID   PSM  IMTU/ OMTU State
00:07:e0:00:0b:ca    66/   64     3   132/  672 OPEN
<prompt>%</prompt> <userinput>l2control -a 00:02:72:00:d4:1a read_connection_list</userinput>
L2CAP connections:
Remote BD_ADDR    Handle Flags Pending State
00:07:e0:00:0b:ca     41 O           0 OPEN</screen>

	<para>Outra ferramenta de diagnóstico é o <citerefentry><refentrytitle>btsockstat</refentrytitle><manvolnum>1</manvolnum></citerefentry>. Ele é semelhante ao <citerefentry><refentrytitle>netstat</refentrytitle><manvolnum>1</manvolnum></citerefentry>, mas para estruturas de dados relacionadas à rede Bluetooth. O exemplo abaixo mostra a mesma conexão lógica que <citerefentry><refentrytitle>l2control</refentrytitle><manvolnum>8</manvolnum></citerefentry> acima.</para>

	<screen><prompt>%</prompt> <userinput>btsockstat</userinput>
Active L2CAP sockets
PCB      Recv-Q Send-Q Local address/PSM       Foreign address   CID   State
c2afe900      0      0 00:02:72:00:d4:1a/3     00:07:e0:00:0b:ca 66    OPEN
Active RFCOMM sessions
L2PCB    PCB      Flag MTU   Out-Q DLCs State
c2afe900 c2b53380 1    127   0     Yes  OPEN
Active RFCOMM sockets
PCB      Recv-Q Send-Q Local address     Foreign address   Chan DLCI State
c2e8bc80      0    250 00:02:72:00:d4:1a 00:07:e0:00:0b:ca 3    6    OPEN</screen>
      </sect3>

      <sect3>
	<title>Comunicação por radiofrequência (<acronym>RFCOMM</acronym>)</title>

	<para>O protocolo <acronym>RFCOMM</acronym> fornece emulação de portas seriais sobre o protocolo <acronym>L2CAP</acronym>. O <acronym>RFCOMM</acronym> é um protocolo de transporte simples, com disposições adicionais para emular os 9 circuitos das portas seriais RS-232 (EIATIA-232-E). Suporta até 60 conexões simultâneas (canais <acronym>RFCOMM</acronym>) entre dois dispositivos Bluetooth.</para>

	<para>Para fins do <acronym>RFCOMM</acronym>, um caminho de comunicação completo envolve dois aplicativos em execução nos terminais de comunicação com um segmento de comunicação entre eles. O <acronym>RFCOMM</acronym> destina-se a abranger aplicativos que fazem uso das portas seriais dos dispositivos em que residem. O segmento de comunicação é um link Bluetooth de conexão direta de um dispositivo para outro.</para>

	<para>O <acronym>RFCOMM</acronym> está relacionado apenas com a conexão entre os dispositivos no caso de conexão direta ou entre o dispositivo e um modem no caso de rede. O <acronym>RFCOMM</acronym> pode suportar outras configurações, como módulos que se comunicam via tecnologia sem fio Bluetooth de um lado e fornecem uma interface com fio no outro lado.</para>

	<para>No FreeBSD, o <acronym>RFCOMM</acronym> é implementado na camada de sockets do Bluetooth.</para>
      </sect3>

      <sect3>
	<title>Protocolo de Descoberta de Serviços (<acronym>SDP</acronym>)</title>

	<indexterm><primary>SDP</primary></indexterm>

	<para>O Protocolo de Descoberta de Serviços (<acronym>SDP</acronym>) fornece os meios para os aplicativos clientes descobrirem a existência de serviços fornecidos por aplicativos de servidor, bem como os atributos desses serviços. Os atributos de um serviço incluem o tipo ou classe de serviço oferecido e as informações de mecanismo ou protocolo necessárias para utilizar o serviço.</para>

	<para>O <acronym>SDP</acronym> envolve a comunicação entre um servidor <acronym>SDP</acronym> e um cliente <acronym>SDP</acronym>. O servidor mantém uma lista de registros de serviço que descrevem as características dos serviços associados ao servidor. Cada registro de serviço contém informações sobre um único serviço. Um cliente pode recuperar informações de um registro de serviço mantido pelo servidor <acronym>SDP</acronym> emitindo uma solicitação <acronym>SDP</acronym>. Se o cliente, ou um aplicativo associado ao cliente, decidir usar um serviço, ele deverá abrir uma conexão separada com o provedor de serviços para utilizar o serviço. O <acronym>SDP</acronym> fornece um mecanismo para descobrir serviços e seus atributos, mas não fornece um mecanismo para utilizar esses serviços.</para>

	<para>Normalmente, um cliente <acronym>SDP</acronym> procura serviços baseados em algumas características desejadas dos serviços. No entanto, há momentos em que é desejável descobrir quais tipos de serviços são descritos pelos registros de serviço de um servidor <acronym>SDP</acronym>, sem qualquer informação prévia sobre os serviços. Este processo de procurar por qualquer serviço oferecido é chamado de <emphasis>navegação</emphasis>.</para>

	<para>O servidor Bluetooth <acronym>SDP</acronym>, <citerefentry><refentrytitle>sdpd</refentrytitle><manvolnum>8</manvolnum></citerefentry> e o cliente de linha de comandos, <citerefentry><refentrytitle>sdpcontrol</refentrytitle><manvolnum>8</manvolnum></citerefentry>, estão incluídos na instalação padrão do FreeBSD. O exemplo a seguir mostra como executar uma consulta de navegação <acronym>SDP</acronym>.</para>

	<screen><prompt>%</prompt> <userinput>sdpcontrol -a 00:01:03:fc:6e:ec browse</userinput>
Record Handle: 00000000
Service Class ID List:
        Service Discovery Server (0x1000)
Protocol Descriptor List:
        L2CAP (0x0100)
                Protocol specific parameter #1: u/int/uuid16 1
                Protocol specific parameter #2: u/int/uuid16 1

Record Handle: 0x00000001
Service Class ID List:
        Browse Group Descriptor (0x1001)

Record Handle: 0x00000002
Service Class ID List:
        LAN Access Using PPP (0x1102)
Protocol Descriptor List:
        L2CAP (0x0100)
        RFCOMM (0x0003)
                Protocol specific parameter #1: u/int8/bool 1
Bluetooth Profile Descriptor List:
        LAN Access Using PPP (0x1102) ver. 1.0</screen>

	<para>Observe que cada serviço tem uma lista de atributos, como o canal <acronym>RFCOMM</acronym>. Dependendo do serviço, o usuário pode precisar anotar alguns dos atributos. Algumas implementações Bluetooth não suportam a navegação de serviço e podem retornar uma lista vazia. Nesse caso, é possível procurar pelo serviço específico. O exemplo abaixo mostra como pesquisar o serviço <acronym>OBEX</acronym> Object Push (<acronym>OPUSH</acronym>) :</para>

	<screen><prompt>%</prompt> <userinput>sdpcontrol -a 00:01:03:fc:6e:ec search OPUSH</userinput></screen>

	<para>A oferta de serviços no FreeBSD para clientes Bluetooth é feita com o servidor <citerefentry><refentrytitle>sdpd</refentrytitle><manvolnum>8</manvolnum></citerefentry>. A seguinte linha pode ser adicionada ao <filename>/etc/rc.conf</filename>:</para>

	<programlisting>sdpd_enable="YES"</programlisting>

	<para>Então o daemon <citerefentry><refentrytitle>sdpd</refentrytitle><manvolnum>8</manvolnum></citerefentry> pode ser iniciado com:</para>

	<screen><prompt>#</prompt> <userinput>service sdpd start</userinput></screen>

	<para>O aplicativo de servidor local que deseja fornecer um serviço Bluetooth a clientes remotos registrará o serviço com o daemon <acronym>SDP</acronym> local . Um exemplo de tal aplicativo é o <citerefentry><refentrytitle>rfcomm_pppd</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Uma vez iniciado, ele registrará o serviço LAN Bluetooth com o daemon local <acronym>SDP</acronym>.</para>

	<para>A lista de serviços registrados no servidor <acronym>SDP</acronym>local pode ser obtida através da emissão de uma consulta de navegação <acronym> SDP </acronym> através do canal de controle local:</para>

	<screen><prompt>#</prompt> <userinput>sdpcontrol -l browse</userinput></screen>
      </sect3>

      <sect3>
	<title><acronym>OBEX</acronym> Object Push (<acronym>OPUSH</acronym>)</title>

	<indexterm><primary>OBEX</primary></indexterm>

	<para>Object Exchange (<acronym>OBEX</acronym>) é um protocolo amplamente utilizado para transferências de arquivos simples entre dispositivos móveis. Seu principal uso é na comunicação por infravermelho, onde é usado para transferências de arquivos genéricos entre notebooks ou <acronym>PDA</acronym>s, e para enviar cartões de visita ou entradas de calendário entre telefones celulares e outros dispositivos com Personal Information Manager (<acronym>PIM</acronym>).</para>

	<para>O servidor e o cliente <acronym>OBEX</acronym> são implementados pelo <application>obexapp</application>, que pode ser instalado usando o pacote ou port <package>comms/obexapp</package>.</para>

	<para>O cliente <acronym>OBEX</acronym> é usado para empurrar e/ou puxar objetos do servidor <acronym>OBEX</acronym>. Um exemplo de objeto é um cartão de visita ou um compromisso. O cliente <acronym>OBEX</acronym> pode obter o número do canal <acronym>RFCOMM</acronym> do dispositivo remoto via <acronym>SDP</acronym>. Isso pode ser feito especificando o nome do serviço em vez do número do canal <acronym>RFCOMM</acronym>. Os nomes de serviços suportados são: <literal>IrMC</literal>, <literal>FTRN</literal> e <literal>OPUSH</literal>. Também é possível especificar o canal <acronym>RFCOMM</acronym> como um número. Abaixo está um exemplo de uma sessão <acronym>OBEX</acronym> em que o objeto de informações do dispositivo é extraído do telefone celular e um novo objeto, o cartão de visita, é inserido no diretório do telefone.</para>

	<screen><prompt>%</prompt> <userinput>obexapp -a 00:80:37:29:19:a4 -C IrMC</userinput>
obex&gt; get telecom/devinfo.txt devinfo-t39.txt
Success, response: OK, Success (0x20)
obex&gt; put new.vcf
Success, response: OK, Success (0x20)
obex&gt; di
Success, response: OK, Success (0x20)</screen>

	<para>Para fornecer o serviço <acronym>OPUSH</acronym>, o <citerefentry><refentrytitle>sdpd</refentrytitle><manvolnum>8</manvolnum></citerefentry> deve estar em execução e uma pasta raiz, onde todos os objetos recebidos serão armazenados, deve ser criado. O caminho padrão para a pasta raiz é <filename>/var/spool/obex</filename>. Por fim, inicie o servidor <acronym>OBEX</acronym> em um número de canal <acronym>RFCOMM</acronym> válido. O servidor <acronym>OBEX</acronym> registrará automaticamente o serviço <acronym>OPUSH</acronym> com o daemon <acronym>SDP</acronym> local. O exemplo abaixo mostra como iniciar o servidor <acronym>OBEX</acronym>.</para>

	<screen><prompt>#</prompt> <userinput>obexapp -s -C 10</userinput></screen>
      </sect3>

      <sect3>
	<title>Perfil de porta serial (<acronym>SPP</acronym>)</title>

	<para>O perfil de porta serial (<acronym>SPP</acronym>) permite que dispositivos Bluetooth executem emulação de cabo serial. Este perfil permite que aplicativos legados usem o Bluetooth como um substituto de cabos, através de uma abstração de porta serial virtual.</para>

	<para>No FreeBSD, o <citerefentry><refentrytitle>rfcomm_sppd</refentrytitle><manvolnum>1</manvolnum></citerefentry> implementa o <acronym>SPP</acronym> e uma pseudo tty é usada como uma abstração de porta serial virtual. O exemplo abaixo mostra como se conectar ao serviço de porta serial de um dispositivo remoto. Um canal <acronym>RFCOMM</acronym> não precisa ser especificado uma vez que o <citerefentry><refentrytitle>rfcomm_sppd</refentrytitle><manvolnum>1</manvolnum></citerefentry> pode obtê-lo a partir do dispositivo remoto via <acronym>SDP</acronym>. Para sobrescrever isso, especifique um canal <acronym>RFCOMM</acronym> na linha de comando.</para>

	<screen><prompt>#</prompt> <userinput>rfcomm_sppd -a 00:07:E0:00:0B:CA -t</userinput>
rfcomm_sppd[94692]: Starting on /dev/pts/6...
/dev/pts/6</screen>

	<para>Uma vez conectado, o pseudo-tty pode ser usado como porta serial:</para>

	<screen><prompt>#</prompt> <userinput>cu -l /dev/pts/6</userinput></screen>

	<para>A pseudo-tty é impressa no stdout e pode ser lida por scripts de wrapper:</para>

	<programlisting>PTS=`rfcomm_sppd -a 00:07:E0:00:0B:CA -t`
cu -l $PTS</programlisting>
      </sect3>
    </sect2>

    <sect2>
      <title>Solução de problemas</title>

      <para>Por padrão, quando o FreeBSD está aceitando uma nova conexão, ele tenta executar uma troca de função e se tornar o mestre. Alguns dispositivos Bluetooth mais antigos que não suportam a troca de função não poderão se conectar. Como a troca de função é executada quando uma nova conexão está sendo estabelecida, não é possível perguntar ao dispositivo remoto se ele suporta a troca de função. No entanto, há uma opção <acronym>HCI</acronym> para desativar a alternância de funções no lado local:</para>

      <screen><prompt>#</prompt> <userinput>hccontrol -n ubt0hci write_node_role_switch 0</userinput></screen>

      <para>Para exibir pacotes Bluetooth, use o pacote de terceiros <application>hcidump</application>, que pode ser instalado usando o pacote ou port <package>comms/hcidump</package>. Este utilitário é semelhante ao <citerefentry><refentrytitle>tcpdump</refentrytitle><manvolnum>1</manvolnum></citerefentry> e pode ser usado para exibir o conteúdo dos pacotes Bluetooth no terminal e para descarregar os pacotes Bluetooth para um arquivo.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="network-bridging">
    <info>
      <title>Bridging</title>

      <authorgroup>
	<author><personname> <firstname> André </firstname> <surname> Thompson </surname> </personname> <contrib> Escrito por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary><acronym>IP</acronym> subnet</primary></indexterm>
    <indexterm><primary>bridge</primary></indexterm>

    <para>Às vezes, é útil dividir uma rede, como um segmento Ethernet, em segmentos de rede sem precisar criar subnets <acronym>IP</acronym> e usar um roteador para conectar os segmentos. Um dispositivo que conecta duas redes dessa maneira é chamado de <quote>bridge</quote>.</para>

    <para>Uma bridge funciona aprendendo os endereços <acronym>MAC</acronym> dos dispositivos em cada uma das suas interfaces de rede. Ele encaminha o tráfego entre as redes somente quando os endereços de origem e destino <acronym>MAC</acronym> estão em redes diferentes. Em muitos aspectos, uma brifge é como um switch Ethernet com poucas portas. Um sistema FreeBSD com múltiplas interfaces de rede pode ser configurado para atuar como uma bridge.</para>

    <para>Construir uma bridge pode ser útil nas seguintes situações:</para>

    <variablelist>
      <varlistentry>
	<term>Conectar Redes</term>
	<listitem>
	  <para>A operação básica de uma bridge é unir dois ou mais segmentos de rede. Existem muitas razões para usar uma bridge baseada em host em vez de equipamentos de rede, tais como restrições de cabeamento ou firewall. Uma bridge também pode conectar uma interface sem fio em execução no modo hostap a uma rede com fio e atuar como um ponto de acesso.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Firewall de Filtragem / Limitação de Trafego</term>
	<listitem>
	  <para>Uma bridge pode ser usada quando a funcionalidade de firewall é necessária sem a realização de roteamento ou conversão de endereços de rede (<acronym>NAT</acronym>).</para>

	  <para>Um exemplo é uma pequena empresa conectada via <acronym>DSL</acronym> ou <acronym>ISDN</acronym> a um <acronym>ISP</acronym>. Existem treze endereços <acronym>IP</acronym> públicos do <acronym>ISP</acronym> e dez computadores na rede. Nessa situação, é difícil usar um firewall baseado em roteador devido a problemas de sub-rede. Um firewall baseado em bridge pode ser configurado sem qualquer problema de endereçamento <acronym>IP</acronym>.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Inspeção de Rede</term>
	<listitem>
	  <para>Uma bridge pode unir dois segmentos de rede para inspecionar todos os pacotes Ethernet que passam entre elas usando <citerefentry><refentrytitle>bpf</refentrytitle><manvolnum>4</manvolnum></citerefentry> e <citerefentry><refentrytitle>tcpdump</refentrytitle><manvolnum>1</manvolnum></citerefentry> na interface de bridge ou enviando uma cópia de todos os frames para uma interface adicional conhecida como span port.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><acronym>VPN</acronym> de Camada 2</term>
	<listitem>
	  <para>Duas redes Ethernet podem ser unidas através de um link <acronym>IP</acronym> ligando as redes a um túnel EtherIP ou a uma solução baseada no <citerefentry><refentrytitle>tap</refentrytitle><manvolnum>4</manvolnum></citerefentry> tal como o <application>OpenVPN</application>.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Redundância de Camada 2</term>
	<listitem>
	  <para>Uma rede pode ser conectada com vários links e usar o protocolo Spanning Tree (<acronym>STP</acronym>) para bloquear caminhos redundantes.</para>
	</listitem>
      </varlistentry>
    </variablelist>

    <para>Esta seção descreve como configurar um sistema FreeBSD como uma bridge usando o <citerefentry><refentrytitle>if_bridge</refentrytitle><manvolnum>4</manvolnum></citerefentry>. Um driver de bridge netgraph também está disponível e é descrito em <citerefentry><refentrytitle>ng_bridge</refentrytitle><manvolnum>4</manvolnum></citerefentry>.</para>

    <note>
      <para>A filtragem de pacotes pode ser usada com qualquer pacote de firewall que se conecte ao framework <citerefentry><refentrytitle>pfil</refentrytitle><manvolnum>9</manvolnum></citerefentry>. A bridge pode ser usada como um modelador de tráfego com o  <citerefentry><refentrytitle>altq</refentrytitle><manvolnum>4</manvolnum></citerefentry> ou <citerefentry><refentrytitle>dummynet</refentrytitle><manvolnum>4</manvolnum></citerefentry>.</para>
    </note>

    <sect2>
      <title>Habilitando a Bridge</title>

      <para>No FreeBSD, o <citerefentry><refentrytitle>if_bridge</refentrytitle><manvolnum>4</manvolnum></citerefentry> é um módulo do kernel que é carregado automaticamente pelo <citerefentry><refentrytitle>ifconfig</refentrytitle><manvolnum>8</manvolnum></citerefentry> ao criar uma interface de bridge. Também é possível compilar o suporte de bridge em um kernel customizado adicionando <literal>device if_bridge</literal> ao arquivo de configuração do kernel personalizado.</para>

      <para>A bridge é criada usando clonagem de interface. Para criar a interface da bridge:</para>

      <screen><prompt>#</prompt> <userinput>ifconfig bridge create</userinput>
bridge0
<prompt>#</prompt> <userinput>ifconfig bridge0</userinput>
bridge0: flags=8802&lt;BROADCAST,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        ether 96:3d:4b:f1:79:7a
        id 00:00:00:00:00:00 priority 32768 hellotime 2 fwddelay 15
        maxage 20 holdcnt 6 proto rstp maxaddr 100 timeout 1200
        root id 00:00:00:00:00:00 priority 0 ifcost 0 port 0</screen>

      <para>Quando uma interface de bridge é criada, ela recebe automaticamente um endereço Ethernet gerado aleatoriamente. Os parâmetros <literal>maxaddr</literal> e <literal>timeout</literal> controlam quantos endereços <acronym>MAC</acronym> a bridge manterá em sua tabela de encaminhamento e quantos segundos o sistema irá esperar antes de cada entrada ser removida após um endereço <acronym>MAC</acronym> ser visto pela última vez. Os outros parâmetros controlam como o <acronym>STP</acronym> opera.</para>

      <para>Em seguida, especifique quais interfaces de rede adicionar como membros da bridge. Para a bridge encaminhar pacotes, todas as interfaces de membros e a bridge precisam estar ativas:</para>

      <screen><prompt>#</prompt> <userinput>ifconfig bridge0 addm fxp0 addm fxp1 up</userinput>
<prompt>#</prompt> <userinput>ifconfig fxp0 up</userinput>
<prompt>#</prompt> <userinput>ifconfig fxp1 up</userinput></screen>

      <para>A bridge agora pode encaminhar quadros Ethernet entre <filename>fxp0</filename> e <filename>fxp1</filename>. Adicione as seguintes linhas ao <filename>/etc/rc.conf</filename> para que a bridge seja criada na inicialização:</para>

      <programlisting>cloned_interfaces="bridge0"
ifconfig_bridge0="addm fxp0 addm fxp1 up"
ifconfig_fxp0="up"
ifconfig_fxp1="up"</programlisting>

      <para>Se o host de ponte precisar de um endereço <acronym>IP</acronym>, defina-o na interface de bridge, não nas interfaces de membro. O endereço pode ser definido estaticamente ou via <acronym>DHCP</acronym>. Este exemplo define um endereço <acronym>IP</acronym> estático:</para>

      <screen><prompt>#</prompt> <userinput>ifconfig bridge0 inet 192.168.0.1/24</userinput></screen>

      <para>Também é possível atribuir um endereço <acronym>IPv6</acronym> a uma interface de bridge. Para tornar as mudanças permanentes, adicione as informações de endereçamento ao <filename>/etc/rc.conf</filename>.</para>

      <note>
	<para>Quando a filtragem de pacotes está habilitada, os pacotes passarão pela entrada do filtro na interface de origem na interface da bridge e na saída nas interfaces apropriadas. Qualquer estágio pode ser desativado. Quando a direção do fluxo de pacotes é importante, é melhor usar o firewall nas interfaces de membros, em vez da própria bridge.</para>

	<para>A bridge tem várias opções configuráveis para o trafego de pacotes <acronym>IP</acronym> e não-<acronym>IP</acronym>, e a filtragem de pacotes layer2 com o <citerefentry><refentrytitle>ipfw</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Veja <citerefentry><refentrytitle>if_bridge</refentrytitle><manvolnum>4</manvolnum></citerefentry> para maiores informações.</para>
      </note>
    </sect2>

    <sect2>
      <title>Ativando o Spanning Tree</title>

      <para>Para que uma rede Ethernet funcione corretamente, somente um caminho ativo pode existir entre dois dispositivos. O protocolo <acronym>STP</acronym> detecta loops e coloca links redundantes em um estado bloqueado. Se um dos links ativos falhar, o <acronym>STP</acronym> calcula uma árvore diferente e habilita um dos caminhos bloqueados para restaurar a conectividade a todos os pontos da rede.</para>

      <para>O protocolo Rapid Spanning Tree (<acronym>RSTP</acronym> ou 802.1w) fornece compatibilidade retroativa com o <acronym>STP</acronym> legado. O <acronym>RSTP</acronym> fornece uma convergência mais rápida e troca informações com os switches vizinhos para fazer a transição rápida para o modo de encaminhamento sem criar loops. O FreeBSD suporta o <acronym>RSTP</acronym> e o <acronym>STP</acronym> como modos de operação, com o <acronym>RSTP</acronym> sendo o modo padrão.</para>

      <para>O <acronym>STP</acronym> pode ser ativado nas interfaces de membro usando o <citerefentry><refentrytitle>ifconfig</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Para uma bridge com <filename>fxp0</filename> e <filename>fxp1</filename> como as interfaces atuais, ative o <acronym>STP</acronym> com:</para>

      <screen><prompt>#</prompt> <userinput>ifconfig bridge0 stp fxp0 stp fxp1</userinput>
bridge0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        ether d6:cf:d5:a0:94:6d
        id 00:01:02:4b:d4:50 priority 32768 hellotime 2 fwddelay 15
        maxage 20 holdcnt 6 proto rstp maxaddr 100 timeout 1200
        root id 00:01:02:4b:d4:50 priority 32768 ifcost 0 port 0
        member: fxp0 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 3 priority 128 path cost 200000 proto rstp
                role designated state forwarding
        member: fxp1 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 4 priority 128 path cost 200000 proto rstp
                role designated state forwarding</screen>

      <para>Essa ponte possui um spanning tree ID de <literal>00:01:02:4b:d4:50</literal> e uma prioridade de <literal>32768</literal>. Como o <literal>root id</literal> é o mesmo, indica que esta é a bridge raiz para a árvore.</para>

      <para>Outra bridge na rede também tem o <acronym>STP</acronym> ativado:</para>

      <screen>bridge0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        ether 96:3d:4b:f1:79:7a
        id 00:13:d4:9a:06:7a priority 32768 hellotime 2 fwddelay 15
        maxage 20 holdcnt 6 proto rstp maxaddr 100 timeout 1200
        root id 00:01:02:4b:d4:50 priority 32768 ifcost 400000 port 4
        member: fxp0 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 4 priority 128 path cost 200000 proto rstp
                role root state forwarding
        member: fxp1 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 5 priority 128 path cost 200000 proto rstp
                role designated state forwarding</screen>

      <para>A linha <literal>root id 00:01:02:4b:d4:50 priority 32768 ifcost 400000 port 4</literal>  mostra que a bridge raiz é <literal>00:01:02:4b:d4:50</literal> e tem um custo de caminho de <literal>400000</literal> desta bridge. O caminho para a bridge raiz é via <literal>port 4</literal>, que é <filename>fxp0</filename>.</para>
    </sect2>

    <sect2>
      <title>Parâmetros da Interface de Bridge</title>

      <para>Vários parâmetros do <command>ifconfig</command> são exclusivos para interligar interfaces. Esta seção resume alguns usos comuns para esses parâmetros. A lista completa de parâmetros disponíveis é descrita em <citerefentry><refentrytitle>ifconfig</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>

      <variablelist>
	<varlistentry>
	  <term>privado</term>
	  <listitem>
	    <para>Uma interface privada não encaminha qualquer tráfego para qualquer outra porta que também seja designada como uma interface privada. O tráfego é bloqueado incondicionalmente para que nenhum quadro Ethernet seja encaminhado, incluindo pacotes <acronym>ARP</acronym>. Se o tráfego precisar ser bloqueado seletivamente, um firewall deve ser usado no lugar.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>span</term>
	  <listitem>
	    <para>Uma porta span transmite uma cópia de cada quadro Ethernet recebido pela bridge. O número de portas de span configuradas em uma bridge é ilimitado, mas se uma interface for designada como uma porta de span, ela também não poderá ser usada como uma porta de bridge comum. Isso é mais útil para espionar passivamente uma rede em bridge a partir de outro host conectado a uma das portas da bridge. Por exemplo, para enviar uma cópia de todos os quadros para fora da interface denominada <filename>fxp4</filename>:</para>

	    <screen><prompt>#</prompt> <userinput>ifconfig bridge0 span fxp4</userinput></screen>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>sticky</term>
	  <listitem>
	    <para>Se uma interface de membro de uma bridge estiver marcada como fixa, as entradas de endereço aprendidas dinamicamente serão tratadas como entradas estáticas no cache de encaminhamento. Entradas fixas nunca são eliminadas do cache ou substituídas, mesmo que o endereço seja visto em uma interface diferente. Isso oferece o benefício de entradas de endereço estático sem a necessidade de preencher previamente a tabela de encaminhamento. Os clientes aprendidos em um segmento específico da bridge não podem se deslocar para outro segmento.</para>

	    <para>Um exemplo do uso de endereços fixos é combinar a bridge com <acronym>VLAN</acronym>s para isolar redes de clientes sem desperdiçar espaço de endereço <acronym>IP</acronym>. Considere que <systemitem class="fqdomainname">CustomerA</systemitem> está em <literal>vlan100</literal>, <systemitem class="fqdomainname">CustomerB</systemitem> está em <literal>vlan101</literal>, e a bridge tem o endereço <systemitem class="ipaddress">192.168.0.1</systemitem>:</para>

	    <screen><prompt>#</prompt> <userinput>ifconfig bridge0 addm vlan100 sticky vlan100 addm vlan101 sticky vlan101</userinput>
<prompt>#</prompt> <userinput>ifconfig bridge0 inet 192.168.0.1/24</userinput></screen>

	    <para>Neste exemplo, os dois clientes vêem <systemitem class="ipaddress">192.168.0.1</systemitem> como seu gateway padrão. Como o cache da bridge é fixo, um host não pode falsificar o endereço <acronym>MAC</acronym> do outro cliente para interceptar o tráfego.</para>

	    <para>Qualquer comunicação entre as <acronym>VLAN</acronym>s pode ser bloqueada usando um firewall ou, como visto neste exemplo, interfaces privadas:</para>

	    <screen><prompt>#</prompt> <userinput>ifconfig bridge0 private vlan100 private vlan101</userinput></screen>

	    <para>Os clientes são completamente isolados uns dos outros e o intervalo completo de endereços <systemitem class="netmask">/24</systemitem> pode ser alocado sem criação de sub-redes.</para>

	    <para>O número de endereços <acronym>MAC</acronym> de origem exclusivos por trás de uma interface pode ser limitado. Quando o limite é atingido, os pacotes com endereços de origem desconhecidos são descartados até que uma entrada de cache do host existente expire ou seja removida.</para>

	    <para>O exemplo a seguir define o número máximo de dispositivos Ethernet para <systemitem class="fqdomainname">CustomerA</systemitem> em <literal>vlan100</literal> para 10:</para>

	    <screen><prompt>#</prompt> <userinput>ifconfig bridge0 ifmaxaddr vlan100 10</userinput></screen>
	  </listitem>
	</varlistentry>
      </variablelist>

      <para>As interfaces de bridge também suportam o modo monitor, onde os pacotes são descartados após processamento do <citerefentry><refentrytitle>bpf</refentrytitle><manvolnum>4</manvolnum></citerefentry> e não são processados ou encaminhados. Isso pode ser usado para multiplexar a entrada de duas ou mais interfaces em um único fluxo <citerefentry><refentrytitle>bpf</refentrytitle><manvolnum>4</manvolnum></citerefentry>. Isso é útil para reconstruir o tráfego de taps de rede que transmitem os sinais RX/TX através de duas interfaces separadas. Por exemplo, para ler a entrada de quatro interfaces de rede como um fluxo:</para>

      <screen><prompt>#</prompt> <userinput>ifconfig bridge0 addm fxp0 addm fxp1 addm fxp2 addm fxp3 monitor up</userinput>
<prompt>#</prompt> <userinput>tcpdump -i bridge0</userinput></screen>
    </sect2>

    <sect2>
      <title>Monitoramento <acronym>SNMP</acronym></title>

      <para>A interface de bridge e os parâmetros de <acronym>STP</acronym> podem ser monitorados via o <citerefentry><refentrytitle>bsnmpd</refentrytitle><manvolnum>1</manvolnum></citerefentry> o qual está incluído no sistema básico do FreeBSD. A <acronym>MIB</acronym> exportada da bridge está em conformidade com os padrões <acronym>IETF</acronym>, portanto, qualquer cliente ou pacote de monitoramento <acronym>SNMP</acronym> pode ser usado para recuperar os dados.</para>

      <para>Para ativar o monitoramento na bridge, descomente esta linha em <filename>/etc/snmpd.config</filename> removendo o símbolo inicial <literal>#</literal>:</para>

      <programlisting>begemotSnmpdModulePath."bridge" = "/usr/lib/snmp_bridge.so"</programlisting>

      <para>Outras configurações, como nomes de comunidades e listas de acesso, podem precisar ser modificadas nesse arquivo. Consulte <citerefentry><refentrytitle>bsnmpd</refentrytitle><manvolnum>1</manvolnum></citerefentry> e <citerefentry><refentrytitle>snmp_bridge</refentrytitle><manvolnum>3</manvolnum></citerefentry> para maiores informações. Depois que essas edições forem salvas, adicione esta linha ao <filename>/etc/rc.conf</filename>:</para>

      <programlisting>bsnmpd_enable="YES"</programlisting>

      <para>Em seguida, inicie o <citerefentry><refentrytitle>bsnmpd</refentrytitle><manvolnum>1</manvolnum></citerefentry>:</para>

      <screen><prompt>#</prompt> <userinput>service bsnmpd start</userinput></screen>

      <para>Os exemplos a seguir usam o software <application>Net-SNMP</application> (<package>net-mgmt/net-snmp</package>) para consultar uma bridge a partir de um sistema cliente. O port <package>net-mgmt/bsnmptools</package> também pode ser usado. Do cliente <acronym>SNMP</acronym> que está executando o <application>Net-SNMP</application>, adicione as seguintes linhas ao <filename>$HOME/.snmp/snmp.conf</filename> para importar as definições da bridge <acronym>MIB</acronym>:</para>

      <programlisting>mibdirs +/usr/share/snmp/mibs
mibs +BRIDGE-MIB:RSTP-MIB:BEGEMOT-MIB:BEGEMOT-BRIDGE-MIB</programlisting>

      <para>Para monitorar uma única bridge usando o IETF BRIDGE-MIB (RFC4188):</para>

      <screen><prompt>%</prompt> <userinput>snmpwalk -v 2c -c public bridge1.example.com mib-2.dot1dBridge</userinput>
BRIDGE-MIB::dot1dBaseBridgeAddress.0 = STRING: 66:fb:9b:6e:5c:44
BRIDGE-MIB::dot1dBaseNumPorts.0 = INTEGER: 1 ports
BRIDGE-MIB::dot1dStpTimeSinceTopologyChange.0 = Timeticks: (189959) 0:31:39.59 centi-seconds
BRIDGE-MIB::dot1dStpTopChanges.0 = Counter32: 2
BRIDGE-MIB::dot1dStpDesignatedRoot.0 = Hex-STRING: 80 00 00 01 02 4B D4 50
...
BRIDGE-MIB::dot1dStpPortState.3 = INTEGER: forwarding(5)
BRIDGE-MIB::dot1dStpPortEnable.3 = INTEGER: enabled(1)
BRIDGE-MIB::dot1dStpPortPathCost.3 = INTEGER: 200000
BRIDGE-MIB::dot1dStpPortDesignatedRoot.3 = Hex-STRING: 80 00 00 01 02 4B D4 50
BRIDGE-MIB::dot1dStpPortDesignatedCost.3 = INTEGER: 0
BRIDGE-MIB::dot1dStpPortDesignatedBridge.3 = Hex-STRING: 80 00 00 01 02 4B D4 50
BRIDGE-MIB::dot1dStpPortDesignatedPort.3 = Hex-STRING: 03 80
BRIDGE-MIB::dot1dStpPortForwardTransitions.3 = Counter32: 1
RSTP-MIB::dot1dStpVersion.0 = INTEGER: rstp(2)</screen>

      <para>O valor <literal>dot1dStpTopChanges.0</literal> é dois, indicando que a topologia da bridge <acronym>STP</acronym> foi alterada duas vezes. Uma alteração de topologia significa que um ou mais links na rede foram alterados ou falharam e uma nova árvore foi calculada. O valor de <literal>dot1dStpTimeSinceTopologyChange.0</literal> será exibido quando isso acontecer.</para>

      <para>Para monitorar várias interfaces de bridge, o BEGEMOT-BRIDGE-MIB privado pode ser usado:</para>

      <screen><prompt>%</prompt> <userinput>snmpwalk -v 2c -c public bridge1.example.com</userinput>
enterprises.fokus.begemot.begemotBridge
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseName."bridge0" = STRING: bridge0
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseName."bridge2" = STRING: bridge2
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseAddress."bridge0" = STRING: e:ce:3b:5a:9e:13
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseAddress."bridge2" = STRING: 12:5e:4d:74:d:fc
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseNumPorts."bridge0" = INTEGER: 1
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseNumPorts."bridge2" = INTEGER: 1
...
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTimeSinceTopologyChange."bridge0" = Timeticks: (116927) 0:19:29.27 centi-seconds
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTimeSinceTopologyChange."bridge2" = Timeticks: (82773) 0:13:47.73 centi-seconds
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTopChanges."bridge0" = Counter32: 1
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTopChanges."bridge2" = Counter32: 1
BEGEMOT-BRIDGE-MIB::begemotBridgeStpDesignatedRoot."bridge0" = Hex-STRING: 80 00 00 40 95 30 5E 31
BEGEMOT-BRIDGE-MIB::begemotBridgeStpDesignatedRoot."bridge2" = Hex-STRING: 80 00 00 50 8B B8 C6 A9</screen>

      <para>Para alterar a interface da bridge que está sendo monitorada através da subárvore <literal>mib-2.dot1dBridge</literal>:</para>

      <screen><prompt>%</prompt> <userinput>snmpset -v 2c -c private bridge1.example.com</userinput>
BEGEMOT-BRIDGE-MIB::begemotBridgeDefaultBridgeIf.0 s bridge2</screen>
    </sect2>
  </sect1>

  <sect1 xml:id="network-aggregation">
    <info>
      <title>Agregação de links e failover</title>

      <authorgroup>
	<author><personname> <firstname> André </firstname> <surname> Thompson </surname> </personname> <contrib> Escrito por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>lagg</primary></indexterm>
    <indexterm><primary>failover</primary></indexterm>
    <indexterm><primary><acronym>FEC</acronym></primary></indexterm>
    <indexterm><primary><acronym>LACP</acronym></primary></indexterm>
    <indexterm><primary>loadbalance</primary></indexterm>
    <indexterm><primary>roundrobin</primary></indexterm>

    <para>O FreeBSD fornece a interface <citerefentry><refentrytitle>lagg</refentrytitle><manvolnum>4</manvolnum></citerefentry> que pode ser usada para agregar várias interfaces de rede em uma interface virtual para fornecer failover e agregação de links. O failover permite que o tráfego continue a fluir, desde que pelo menos uma interface de rede agregada tenha um link estabelecido. A agregação de links funciona melhor em switches compatíveis com <acronym>LACP</acronym>, pois esse protocolo distribui o tráfego bidirecionalmente ao responder à falha de links individuais.</para>

    <para>Os protocolos de agregação suportados pela interface lagg determinam quais portas são usadas para o tráfego de saída e se uma porta específica aceita tráfego de entrada. Os seguintes protocolos são suportados pelo <citerefentry><refentrytitle>lagg</refentrytitle><manvolnum>4</manvolnum></citerefentry>:</para>

    <variablelist>
      <varlistentry>
	<term>failover</term>
	<listitem>
	  <para>Este modo envia e recebe tráfego somente através da porta principal. Se a porta principal ficar indisponível, a próxima porta ativa será usada. A primeira interface adicionada à interface virtual é a porta principal e todas as interfaces adicionadas posteriormente são usadas como dispositivos de failover. Se ocorrer um failover em uma porta não mestre, a porta original se tornará a principal quando estiver disponível novamente.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>fec / loadbalance</term>
	<listitem>
	  <para><trademark class="registered">Cisco</trademark> Fast <trademark class="registered">EtherChannel</trademark> (<acronym>FEC</acronym>) é encontrado em versões anteriores de switches <trademark class="registered">Cisco </trademark>. Ele fornece uma configuração estática e não negocia a agregação com o par ou troca quadros para monitorar o link. Se o switch suportar <acronym>LACP</acronym>, isso deve ser usado em seu lugar.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><acronym>lacp</acronym></term>
	<listitem>
	  <para>O protocolo de controle de agregação de links <trademark class="registered">IEEE</trademark> 802.3ad (<acronym>LACP</acronym>) negocia um conjunto de links agregáveis com o peer em um ou mais grupos agregados de links (<acronym>LAG</acronym>s). Cada <acronym>LAG</acronym> é composto de portas da mesma velocidade, configuradas para operação full-duplex e o tráfego é balanceado entre as portas no <acronym>LAG</acronym> com a maior velocidade total. Normalmente, há apenas um <acronym>LAG</acronym> que contém todas as portas. No caso de alterações na conectividade física, o <acronym>LACP</acronym>  convergirá rapidamente para uma nova configuração.</para>

	  <para>O <acronym>LACP</acronym> equilibra o tráfego de saída nas portas ativas com base nas informações de hash do cabeçalho do protocolo e aceita tráfego de entrada de qualquer porta ativa. O hash inclui o endereço Ethernet de origem e destino e, se disponível, a tag <acronym>VLAN</acronym> e o endereço de origem e destino <acronym>IPv4</acronym> ou <acronym>IPv6</acronym>.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>roundrobin</term>
	<listitem>
	  <para>Esse modo distribui o tráfego de saída usando um agendador round-robin por meio de todas as portas ativas e aceita tráfego de entrada de qualquer porta ativa. Como esse modo viola a ordenação de quadros Ethernet, ele deve ser usado com cautela.</para>
	</listitem>
      </varlistentry>
    </variablelist>

    <sect2>
      <title>Exemplos de configuração</title>

      <para>Esta seção demonstra como configurar um switch <trademark class="registered">Cisco</trademark> e um sistema FreeBSD para balanceamento de carga <acronym>LACP</acronym>. Em seguida, ele mostra como configurar duas interfaces Ethernet no modo de failover, além de como configurar o modo de failover entre uma Ethernet e uma interface sem fio.</para>

      <example xml:id="networking-lacp-aggregation-cisco">
	<title>Agregação <acronym>LACP</acronym> com um switch <trademark class="registered">Cisco</trademark></title>

	<para>Este exemplo conecta duas interfaces Ethernet <citerefentry><refentrytitle>fxp</refentrytitle><manvolnum>4</manvolnum></citerefentry> em uma máquina FreeBSD às duas primeiras portas Ethernet em um switch <trademark class="registered">Cisco</trademark> como um link de carga única balanceada e tolerante a falhas. Mais interfaces podem ser adicionadas para aumentar o rendimento e a tolerância a falhas. Substitua os nomes das portas <trademark class="registered">Cisco</trademark>, dos dispositivos Ethernet, do número do grupo de canais e do endereço <acronym>IP</acronym> mostrado no exemplo para corresponder à configuração local.</para>

	<para>A ordenação de quadros é obrigatória em links Ethernet e qualquer tráfego entre duas estações sempre flui pelo mesmo link físico, limitando a velocidade máxima àquela de uma interface. O algoritmo de transmissão tenta usar o máximo de informações possível para distinguir diferentes fluxos de tráfego e equilibrar os fluxos entre as interfaces disponíveis.</para>

	<para>No switch <trademark class="registered">Cisco</trademark>, adicione as interfaces <replaceable>FastEthernet0/1</replaceable> e <replaceable>FastEthernet0/2</replaceable> ao grupo de canais <replaceable>1</replaceable>:</para>

	<screen><userinput>interface <replaceable>FastEthernet0/1</replaceable>
 channel-group <replaceable>1</replaceable> mode active
 channel-protocol lacp</userinput>
!
<userinput>interface <replaceable>FastEthernet0/2</replaceable>
 channel-group <replaceable>1</replaceable> mode active
 channel-protocol lacp</userinput></screen>

	<para>No sistema FreeBSD, crie a interface <citerefentry><refentrytitle>lagg</refentrytitle><manvolnum>4</manvolnum></citerefentry> usando as interfaces físicas <replaceable>fxp0</replaceable> e <replaceable>fxp1</replaceable> e suba as interfaces com o endereço <acronym>IP</acronym> de <replaceable>10.0.0.3/24</replaceable>:</para>

	<screen><prompt>#</prompt> <userinput>ifconfig <replaceable>fxp0</replaceable> up</userinput>
<prompt>#</prompt> <userinput>ifconfig <replaceable>fxp1</replaceable> up</userinput>
<prompt>#</prompt> <userinput>ifconfig <literal>lagg<replaceable>0</replaceable></literal> create </userinput>
<prompt>#</prompt> <userinput>ifconfig <literal>lagg<replaceable>0</replaceable></literal> up laggproto lacp laggport <replaceable>fxp0</replaceable> laggport <replaceable>fxp1</replaceable> <replaceable>10.0.0.3/24</replaceable></userinput></screen>

	<para>Em seguida, verifique o status da interface virtual:</para>

	<screen><prompt>#</prompt> <userinput>ifconfig <literal>lagg<replaceable>0</replaceable></literal></userinput>
lagg0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=8&lt;VLAN_MTU&gt;
        ether 00:05:5d:71:8d:b8
        inet 10.0.0.3 netmask 0xffffff00 broadcast 10.0.0.255
        media: Ethernet autoselect
        status: active
        laggproto lacp
        laggport: fxp1 flags=1c&lt;ACTIVE,COLLECTING,DISTRIBUTING&gt;
        laggport: fxp0 flags=1c&lt;ACTIVE,COLLECTING,DISTRIBUTING&gt;</screen>

	<para>Portas marcadas como <literal>ACTIVE</literal> fazem parte do <acronym>LAG</acronym> que foi negociado com o switch remoto. O tráfego será transmitido e recebido através dessas portas ativas. Adicione <option>-v</option> ao comando acima para ver os identificadores <acronym>LAG</acronym>.</para>

	<para>Para ver o status da porta no switch <trademark class="registered">Cisco</trademark>:</para>

	<screen>switch# <userinput>show lacp neighbor</userinput>
Flags:  S - Device is requesting Slow LACPDUs
        F - Device is requesting Fast LACPDUs
        A - Device is in Active mode       P - Device is in Passive mode

Channel group 1 neighbors

Partner's information:

                  LACP port                        Oper    Port     Port
Port      Flags   Priority  Dev ID         Age     Key     Number   State
Fa0/1     SA      32768     0005.5d71.8db8  29s    0x146   0x3      0x3D
Fa0/2     SA      32768     0005.5d71.8db8  29s    0x146   0x4      0x3D</screen>

	<para>Para mais detalhes, digite <userinput>show lacp neighbor detail</userinput>.</para>

	<para>Para manter esta configuração através de reinicializações, adicione as seguintes entradas ao <filename>/etc/rc.conf</filename> no sistema FreeBSD:</para>

	<programlisting>ifconfig_<replaceable>fxp0</replaceable>="up"
ifconfig_<replaceable>fxp1</replaceable>="up"
cloned_interfaces="<literal>lagg<replaceable>0</replaceable></literal>"
ifconfig_<literal>lagg<replaceable>0</replaceable></literal>="laggproto lacp laggport <replaceable>fxp0</replaceable> laggport <replaceable>fxp1</replaceable> <replaceable>10.0.0.3/24</replaceable>"</programlisting>
      </example>

      <example xml:id="networking-lagg-failover">
	<title>Modo de Failover</title>

	<para>O modo de failover pode ser usado para alternar para uma interface secundária se o link for perdido na interface principal. Para configurar o failover, certifique-se de que as interfaces físicas subjacentes estejam ativadas e crie a interface <citerefentry><refentrytitle>lagg</refentrytitle><manvolnum>4</manvolnum></citerefentry>. Neste exemplo, <replaceable>fxp0</replaceable> é a interface principal, <replaceable>fxp1</replaceable> é a interface secundária e a interface virtual recebeu um endereço <acronym>IP</acronym> de <replaceable>10.0.0.15/24</replaceable>:</para>

	<screen><prompt>#</prompt> <userinput>ifconfig <replaceable>fxp0</replaceable> up</userinput>
<prompt>#</prompt> <userinput>ifconfig <replaceable>fxp1</replaceable> up</userinput>
<prompt>#</prompt> <userinput>ifconfig <literal>lagg<replaceable>0</replaceable></literal> create</userinput>
<prompt>#</prompt> <userinput>ifconfig <literal>lagg<replaceable>0</replaceable></literal> up laggproto failover laggport <replaceable>fxp0</replaceable> laggport <replaceable>fxp1</replaceable> <replaceable>10.0.0.15/24</replaceable></userinput></screen>

	<para>A interface virtual deve ser algo como isto:</para>

	<screen><prompt>#</prompt> <userinput>ifconfig <literal>lagg<replaceable>0</replaceable></literal></userinput>
lagg0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=8&lt;VLAN_MTU&gt;
        ether 00:05:5d:71:8d:b8
        inet 10.0.0.15 netmask 0xffffff00 broadcast 10.0.0.255
        media: Ethernet autoselect
        status: active
        laggproto failover
        laggport: fxp1 flags=0&lt;&gt;
        laggport: fxp0 flags=5&lt;MASTER,ACTIVE&gt;</screen>

	<para>O tráfego será transmitido e recebido em <replaceable>fxp0</replaceable>. Se o link for perdido em <replaceable>fxp0</replaceable>, <replaceable>fxp1</replaceable> se tornará o link ativo. Se o link for restaurado na interface principal, ele se tornará novamente o link ativo.</para>

	<para>Para manter essa configuração através de reinicializações, adicione as seguintes entradas ao <filename>/etc/rc.conf</filename>:</para>

	<programlisting>ifconfig_<replaceable>fxp0</replaceable>="up"
ifconfig_<replaceable>fxp1</replaceable>="up"
cloned_interfaces="<literal>lagg<replaceable>0</replaceable></literal>"
ifconfig_<literal>lagg<replaceable>0</replaceable></literal>="laggproto failover laggport <replaceable>fxp0</replaceable> laggport <replaceable>fxp1</replaceable> <replaceable>10.0.0.15/24</replaceable>"</programlisting>
      </example>

      <example xml:id="networking-lagg-wired-and-wireless">
	<title>Modo de failover entre interfaces Ethernet e sem fio</title>

	<para>Para usuários de laptop, geralmente é desejável configurar o dispositivo sem fio como secundário, que é usado somente quando a conexão Ethernet não está disponível. Com <citerefentry><refentrytitle>lagg</refentrytitle><manvolnum>4</manvolnum></citerefentry>, é possível configurar um failover que preferia a conexão Ethernet por motivos de desempenho e de segurança, mantendo a capacidade de transferência dados através da conexão sem fio.</para>

	<para>Isso é obtido substituindo o endereço <acronym>MAC</acronym> da interface Ethernet com o da interface wireless.</para>

	<note>
	  <para>Em teoria, o endereço MAC da Ethernet ou da wireless pode ser alterado para corresponder ao outro. No entanto, algumas interfaces wireless populares não têm suporte para substituir o endereço MAC. Portanto, recomendamos substituir o endereço MAC da Ethernet para esse fim.</para>
	</note>

	<note>
	  <para>Se o driver para a interface wireless não estiver carregado no kernel <literal>GENERIC</literal> ou customizado, e o computador estiver rodando o FreeBSD 12.1, carregue o <filename>.ko</filename> correspondente no arquivo <filename>/boot/loader.conf</filename> adicionando <userinput><replaceable>driver</replaceable>_load="YES"</userinput> e reiniciando a maquina. Outra forma melhor, é carregar o driver no arquivo <filename>/etc/rc.conf</filename> adicionando a variável <varname>kld_list</varname> (veja <citerefentry><refentrytitle>rc.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry> para maiores detalhes) nesse arquivo e reiniciar. Isso é necessário porque de outra forma o driver não estará carregado no tempo em que a interface <citerefentry><refentrytitle>lagg</refentrytitle><manvolnum>4</manvolnum></citerefentry> for configurada.</para>
	</note>

	<para>Neste exemplo, a interface Ethernet, <replaceable>re0</replaceable>, é a interface principal e a interface sem fio, <replaceable>wlan0</replaceable>, é o failover. A interface <replaceable>wlan0</replaceable> foi criada a partir da interface wireless <replaceable>ath0</replaceable>, e a interface Ethernet será configurada com o endereço <acronym>MAC</acronym> da interface wireless. Primeiro, determine o endereço <acronym>MAC</acronym> da interface wireless:</para>

	<screen><prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable></userinput>
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	ether b8:ee:65:5b:32:59
	groups: wlan
	ssid Bbox-A3BD2403 channel 6 (2437 MHz 11g ht/20) bssid 00:37:b7:56:4b:60
	regdomain ETSI country FR indoor ecm authmode WPA2/802.11i privacy ON
	deftxkey UNDEF AES-CCM 2:128-bit txpower 30 bmiss 7 scanvalid 60
	protmode CTS ampdulimit 64k ampdudensity 8 shortgi -stbctx stbcrx
	-ldpc wme burst roaming MANUAL
	media: IEEE 802.11 Wireless Ethernet MCS mode 11ng
	status: associated
	nd6 options=29&lt;PERFORMNUD,IFDISABLED,AUTO_LINKLOCAL&gt;</screen>

	<para>Substitua <replaceable>wlan0</replaceable> para corresponder ao nome da interface wireless do sistema. A linha <literal>ether</literal> conterá o endereço <acronym>MAC</acronym> da interface especificada. Agora, altere o endereço <acronym>MAC</acronym> da interface Ethernet subjacente:</para>

	<screen><prompt>#</prompt> <userinput>ifconfig <replaceable>re0</replaceable> ether <replaceable>b8:ee:65:5b:32:59</replaceable></userinput></screen>

	<para>Suba a interface sem fio (substituindo <replaceable>FR</replaceable> pelo seu próprio código de país com duas letras), mas não defina um endereço <acronym>IP</acronym>:</para>

	<screen><prompt>#</prompt> <userinput>ifconfig <replaceable>wlan0</replaceable> create wlandev <replaceable>ath0</replaceable> country <replaceable>FR</replaceable> ssid <replaceable>my_router</replaceable> up</userinput></screen>

	<para>Certifique-se de que a interface <replaceable>re0</replaceable> esteja ativa, então crie a interface <citerefentry><refentrytitle>lagg</refentrytitle><manvolnum>4</manvolnum></citerefentry> com a <replaceable>re0</replaceable> como master com failover para a<replaceable>wlan0</replaceable>:</para>

	<screen><prompt>#</prompt> <userinput>ifconfig <replaceable>re0</replaceable> up</userinput>
<prompt>#</prompt> <userinput>ifconfig <literal>lagg<replaceable>0</replaceable></literal> create</userinput>
<prompt>#</prompt> <userinput>ifconfig <literal>lagg<replaceable>0</replaceable></literal> up laggproto failover laggport <replaceable>re0</replaceable> laggport <replaceable>wlan0</replaceable></userinput></screen>

	<para>A interface virtual deve ser algo como isto:</para>

	<screen><prompt>#</prompt> <userinput>ifconfig <literal>lagg<replaceable>0</replaceable></literal></userinput>
lagg0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=8&lt;VLAN_MTU&gt;
        ether b8:ee:65:5b:32:59
        laggproto failover lagghash l2,l3,l4
        laggport: re0 flags=5&lt;MASTER,ACTIVE&gt;
        laggport: wlan0 flags=0&lt;&gt;
        groups: lagg
        media: Ethernet autoselect
        status: active</screen>

	<para>Em seguida, inicie o cliente <acronym>DHCP</acronym> para obter um endereço <acronym>IP</acronym>:</para>

	<screen><prompt>#</prompt> <userinput>dhclient <literal>lagg<replaceable>0</replaceable></literal></userinput></screen>

	<para>Para manter essa configuração através de reinicializações, adicione as seguintes entradas ao <filename>/etc/rc.conf</filename>:</para>

	<programlisting>ifconfig_<replaceable>re0</replaceable>="ether <replaceable>b8:ee:65:5b:32:59</replaceable>"
wlans_<replaceable>ath0</replaceable>="wlan0"
ifconfig_wlan0="WPA"
create_args_wlan0="country <replaceable>FR</replaceable>"
cloned_interfaces="<literal>lagg<replaceable>0</replaceable></literal>"
ifconfig_<literal>lagg<replaceable>0</replaceable></literal>="up laggproto failover laggport <replaceable>re0</replaceable> laggport wlan0 DHCP"</programlisting>
      </example>
    </sect2>
  </sect1>

  <sect1 xml:id="network-diskless">
    <info>
      <title>Operação Diskless com <acronym>PXE</acronym></title>

      <authorgroup>
	<author><personname> <firstname> Jean-François </firstname> <surname> Dockès </surname> </personname> <contrib> Atualizado por </contrib></author>
      </authorgroup>
      <authorgroup>
	<author><personname> <firstname> Alex </firstname> <surname> Dupre </surname> </personname> <contrib> Reorganizado e aprimorado por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary>diskless workstation</primary></indexterm>
    <indexterm><primary>diskless operation</primary></indexterm>

    <para>O Ambiente de execução de pré-inicialização da <trademark class="registered">Intel</trademark> (<acronym>PXE</acronym>) permite que um sistema operacional inicialize pela rede. Por exemplo, um sistema FreeBSD pode inicializar através da rede e operar sem um disco local, usando sistemas de arquivos montados a partir de um servidor <acronym>NFS</acronym>. O suporte para <acronym>PXE</acronym> geralmente está disponível no <acronym>BIOS</acronym>. Para usar o <acronym>PXE</acronym> quando a máquina iniciar, selecione a opção <literal>Inicialização da rede</literal> na configuração do <acronym>BIOS</acronym> ou digite uma tecla de função durante a inicialização do sistema.</para>

    <para>Para fornecer os arquivos necessários para um sistema operacional inicializar pela rede, uma configuração do  <acronym>PXE</acronym> também requer o <acronym>DHCP</acronym>, <acronym>TFTP</acronym> configurado corretamente e Servidores <acronym>NFS</acronym>, onde:</para>

    <itemizedlist>
      <listitem>
	<para>Parâmetros iniciais, como endereço de <acronym>IP</acronym>, nome e localização do arquivo de inicialização executável, nome do servidor e caminho do root são obtidos do servidor <acronym>DHCP</acronym>.</para>
      </listitem>

      <listitem>
	<para>O arquivo do carregador do sistema operacional é inicializado usando <acronym>TFTP</acronym>.</para>
      </listitem>

      <listitem>
	<para>Os sistemas de arquivos são carregados usando o <acronym>NFS</acronym>.</para>
      </listitem>
    </itemizedlist>

    <para>Quando um computador <acronym>PXE</acronym> inicializa, ele recebe informações por meio do <acronym>DHCP</acronym> sobre onde obter o arquivo inicial do carregador de boot. Depois que o computador host recebe essa informação, ele faz o download do carregador de boot via <acronym>TFTP</acronym> e, em seguida, executa o carregador de boot. No FreeBSD, o arquivo do gerenciador de boot é o <filename>/boot/pxeboot</filename>. Depois que o <filename>/boot/pxeboot</filename> é executado, o kernel do FreeBSD é carregado e o resto da seqüência de inicialização do FreeBSD continua, como descrito em <xref linkend="boot"/>.</para>

    <para>Esta seção descreve como configurar estes serviços em um sistema FreeBSD para que outros sistemas possam inicializar o <acronym>PXE</acronym> a partir do FreeBSD. Consulte <citerefentry><refentrytitle>diskless</refentrytitle><manvolnum>8</manvolnum></citerefentry> para obter maiores informações.</para>

    <caution>
      <para>Conforme descrito, o sistema que fornece esses serviços é inseguro. Ele deve ficar em uma área protegida de uma rede e não deve ser considerado confiável por outros hosts.</para>
    </caution>

    <sect2 xml:id="network-pxe-nfs">
      <info>
	<title>Configurando o ambiente <acronym>PXE</acronym></title>

	<authorgroup>
	  <author><personname> <firstname> Craig </firstname> <surname> Rodrigues </surname> </personname> <affiliation> <address>rodrigc@FreeBSD.org</address> </affiliation> <contrib> Escrito por </contrib></author>
	</authorgroup>
      </info>

      <para>As etapas mostradas nesta seção configuram os servidores internos de <acronym>NFS</acronym> e <acronym>TFTP</acronym>. A próxima seção demonstra como instalar e configurar o servidor <acronym>DHCP</acronym>. Neste exemplo, o diretório que conterá os arquivos usados pelos usuários do <acronym>PXE</acronym> é o <filename>/b/tftpboot/FreeBSD/install</filename>. É importante que este diretório exista e que o mesmo nome de diretório seja configurado no <filename>/etc/inetd.conf</filename> e no <filename>/usr/local/etc/dhcpd.conf</filename>.</para>

      <note>
       <para xml:lang="en">The command examples below assume use of the <citerefentry><refentrytitle>sh</refentrytitle><manvolnum>1</manvolnum></citerefentry> shell.
       <citerefentry><refentrytitle>csh</refentrytitle><manvolnum>1</manvolnum></citerefentry> and <citerefentry><refentrytitle>tcsh</refentrytitle><manvolnum>1</manvolnum></citerefentry> users will need to start a
       <citerefentry><refentrytitle>sh</refentrytitle><manvolnum>1</manvolnum></citerefentry> shell or adapt the commands to <citerefentry><refentrytitle>csh</refentrytitle><manvolnum>1</manvolnum></citerefentry> syntax.</para>
      </note>

      <procedure>
	<step>
	  <para>Crie o diretório raiz que irá conter uma instalação do FreeBSD para ser montado por <acronym>NFS</acronym>:</para>

	  <screen><prompt>#</prompt> <userinput>export NFSROOTDIR=/b/tftpboot/FreeBSD/install</userinput>
<prompt>#</prompt> <userinput>mkdir -p ${NFSROOTDIR}</userinput></screen>
	</step>

	<step>
	  <para>Ative o servidor <acronym>NFS</acronym> adicionando esta linha ao <filename>/etc/rc.conf</filename>:</para>

	  <programlisting>nfs_server_enable="YES"</programlisting>
	</step>

	<step>
	  <para>Exporte o diretório raiz sem disco via <acronym>NFS</acronym> adicionando o seguinte ao <filename>/etc/exports</filename>:</para>

	  <programlisting>/b -ro -alldirs -maproot=root</programlisting>
	</step>

	<step>
	  <para>Inicie o servidor <acronym>NFS</acronym>:</para>

	  <screen><prompt>#</prompt> <userinput>service nfsd start</userinput></screen>
	</step>

	<step>
	  <para>Ative o  <citerefentry><refentrytitle>inetd</refentrytitle><manvolnum>8</manvolnum></citerefentry> adicionando a seguinte linha ao <filename>/etc/rc.conf</filename>:</para>

	  <programlisting>inetd_enable="YES"</programlisting>
	</step>

	<step>
	  <para>Descomente a seguinte linha no <filename>/etc/inetd.conf</filename> certificando-se de que ela não comece com um símbolo <literal>#</literal>:</para>

	  <programlisting>tftp dgram udp wait root /usr/libexec/tftpd tftpd -l -s /b/tftpboot</programlisting>

	  <note>
	    <para>Algumas versões do <acronym>PXE</acronym> exigem a versão <acronym>TCP</acronym> do <acronym>TFTP</acronym>. Neste caso, remova o comentário da segunda linha <literal>tftp</literal> que contém <literal>stream tcp</literal>.</para>
	  </note>
	</step>

	<step>
	  <para>Inicie o <citerefentry><refentrytitle>inetd</refentrytitle><manvolnum>8</manvolnum></citerefentry>:</para>

	  <screen><prompt>#</prompt> <userinput>service inetd start</userinput></screen>
	</step>

	<step>
	  <para>Instale o sistema básico em <filename>${NFSROOTDIR}</filename>, seja descompactando os arquivos oficiais ou recompilando o kernel do FreeBSD e o userland (consulte <xref linkend="makeworld"/> para instruções mais detalhadas, mas não esqueça de adicionar <option>DESTDIR=<replaceable>${NFSROOTDIR}</replaceable></option> ao executar os comandos <command>make installkernel</command> e <command>make installworld</command>.</para>
	</step>

	<step>
	  <para>Teste que o servidor <acronym>TFTP</acronym> funciona e que pode baixar o gerenciador de boot que será obtido via <acronym>PXE</acronym>:</para>

	  <screen><prompt>#</prompt> <userinput>tftp localhost</userinput>
tftp&gt; <userinput>get FreeBSD/install/boot/pxeboot</userinput>
Received 264951 bytes in 0.1 seconds</screen>
	</step>

	<step>
	  <para>Edite o <filename>${NFSROOTDIR}/etc/fstab</filename> e crie uma entrada para montar o sistema de arquivos raiz por meio do <acronym>NFS</acronym>:</para>

	  <programlisting># Device                                         Mountpoint    FSType   Options  Dump Pass
<replaceable>myhost.example.com</replaceable>:/b/tftpboot/FreeBSD/install       /         nfs      ro        0    0</programlisting>

	  <para>Substitua <replaceable>myhost.example.com</replaceable> pelo nome do host ou pelo endereço <acronym>IP</acronym> do servidor <acronym>NFS</acronym>. Neste exemplo, o sistema de arquivos raiz é montado como somente leitura para evitar que os clientes do <acronym>NFS</acronym> excluam potencialmente o conteúdo do sistema de arquivos raiz.</para>
	</step>

	<step>
	  <para>Defina a senha de root no ambiente <acronym>PXE</acronym> para as máquinas clientes que serão inicializadas por  <acronym>PXE</acronym>:</para>

	  <screen><prompt>#</prompt> <userinput>chroot ${NFSROOTDIR}</userinput>
<prompt>#</prompt> <userinput>passwd</userinput></screen>
	</step>

	<step>
	  <para>Se necessário, ative o login do root via <citerefentry><refentrytitle>ssh</refentrytitle><manvolnum>1</manvolnum></citerefentry> para as máquinas clientes que estão inicializando por <acronym>PXE</acronym> editando o <filename>${NFSROOTDIR}/etc/ssh/sshd_config</filename> e habilitando o <literal>PermitRootLogin</literal>. Esta opção está documentada em <citerefentry><refentrytitle>sshd_config</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>
	</step>

	<step>
	  <para>Execute qualquer outra customização necessária do ambiente <acronym>PXE</acronym> no <filename>${NFSROOTDIR}</filename>. Estas customizações podem incluir coisas como instalar pacotes ou editar o arquivo de senha com o <citerefentry><refentrytitle>vipw</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
	</step>
      </procedure>

      <para>Ao inicializar de um volume raiz <acronym>NFS</acronym>, o <filename>/etc/rc</filename> detecta a inicialização do <acronym>NFS</acronym> e executa o <filename>/etc/rc.initdiskless</filename>. Neste caso, o <filename>/etc</filename> e <filename>/var</filename> precisam ser sistemas de arquivos montados em memória para que estes diretórios sejam graváveis mas o diretório raiz <acronym>NFS</acronym> seja apenas de leitura:</para>

      <screen><prompt>#</prompt> <userinput>chroot ${NFSROOTDIR}</userinput>
<prompt>#</prompt> <userinput>mkdir -p conf/base</userinput>
<prompt>#</prompt> <userinput>tar -c -v -f conf/base/etc.cpio.gz --format cpio --gzip etc</userinput>
<prompt>#</prompt> <userinput>tar -c -v -f conf/base/var.cpio.gz --format cpio --gzip var</userinput></screen>

      <para>Quando o sistema inicializar, os sistemas de arquivos em memória para o <filename>/etc</filename> e o <filename>/var</filename> serão criados e montados e o conteúdo dos arquivos <filename>cpio.gz</filename> será 
copiado para eles. Por padrão, esses sistemas de arquivos têm uma capacidade máxima de 5 megabytes. Se seus arquivos não couberem, o que geralmente é o caso do <filename>/var</filename> quando pacotes binários foram instalados, solicite um tamanho maior colocando o número de setores de 512 bytes necessários (por exemplo, 5 megabytes é 10240 setores) nos arquivos <filename>${NFSROOTDIR}/conf/base/etc/md_size</filename> e <filename>${NFSROOTDIR}/conf/base/var/md_size</filename> para os sistemas de arquivos  <filename>/etc</filename> e o <filename>/var</filename> respectivamente.</para>
    </sect2>

    <sect2 xml:id="network-pxe-setting-up-dhcp">
      <title>Configurando o servidor <acronym>DHCP</acronym></title>

      <indexterm><primary>DHCP</primary> <secondary>diskless operation</secondary></indexterm>

      <para>O servidor <acronym>DHCP</acronym> não precisa ser a mesma máquina que o servidor <acronym>TFTP</acronym> e <acronym>NFS</acronym>, mas ele precisa estar acessível na rede.</para>

      <para>O <acronym>DHCP</acronym> não faz parte do sistema básico do FreeBSD, mas pode ser instalado usando o port ou pacote <package>net/isc-dhcp43-server</package>.</para>

      <para>Uma vez instalado, edite o arquivo de configuração, <filename>/usr/local/etc/dhcpd.conf</filename>. Configure as diretivas <literal>next-server</literal>, <literal>filename</literal> e <literal>root-path</literal> conforme mostrado neste exemplo:</para>

      <programlisting>subnet 192.168.0.0 netmask 255.255.255.0 {
   range 192.168.0.2 192.168.0.3 ;
   option subnet-mask 255.255.255.0 ;
   option routers 192.168.0.1 ;
   option broadcast-address 192.168.0.255 ;
   option domain-name-servers 192.168.35.35, 192.168.35.36 ;
   option domain-name "example.com";

   # IP address of TFTP server
   next-server <replaceable>192.168.0.1</replaceable> ;

   # path of boot loader obtained via tftp
   filename "<replaceable>FreeBSD/install/boot/pxeboot</replaceable>" ;

   # pxeboot boot loader will try to NFS mount this directory for root FS
   option root-path "<replaceable>192.168.0.1:/b/tftpboot/FreeBSD/install/</replaceable>" ;

}</programlisting>

<!--
 This option still needed?
 host corbieres {
      <para>This option tells <application>dhcpd</application>
	to send the value in the <literal>host</literal>
	declarations as the hostname for the diskless host.
	An alternate way would be to add an <literal>option
	host-name <replaceable>corbieres</replaceable></literal>
	inside the <literal>host</literal> declarations.</para>
-->

      <para>A diretiva <literal>next-server</literal> é usada para especificar o endereço <acronym>IP</acronym> do servidor <acronym>TFTP</acronym>.</para>

      <para>A diretiva <literal>filename</literal> define o caminho para o <filename>/boot/pxeboot</filename>. Um nome de arquivo relativo é usado, significando que <filename>/b/tftpboot</filename> não está incluído no caminho.</para>

      <para>A diretiva <literal>root-path</literal> define o caminho para o sistema de arquivos raiz  a ser montado por <acronym>NFS</acronym>.</para>

      <para>Depois que as edições forem salvas, ative o <acronym>DHCP</acronym> no momento da inicialização adicionando a seguinte linha ao <filename>/etc/rc.conf</filename>:</para>

      <programlisting>dhcpd_enable="YES"</programlisting>

      <para>Então inicie o serviço <acronym>DHCP</acronym>:</para>

      <screen><prompt>#</prompt> <userinput>service isc-dhcpd start</userinput></screen>
    </sect2>
<!--
Are these sections still needed?
    <sect2>
      <title>Preparing the Root File System</title>

      <indexterm>
	<primary>diskless operation</primary>
	<secondary>kernel configuration</secondary>
      </indexterm>

      <para>When using <acronym>PXE</acronym>, building a custom
	kernel with the following options is not strictly necessary.
	These options cause more <acronym>DHCP</acronym> requests
	to be issued during kernel startup, with a small risk of
	inconsistency between the new values and those retrieved
	by &man.pxeboot.8; in some special cases.  The advantage
	is that the host name will be set.  Otherwise, set the
	host name in a client-specific
	<filename>/etc/rc.conf</filename>.</para>

      <programlisting>options     BOOTP          # Use BOOTP to obtain IP address/hostname
options     BOOTP_NFSROOT  # NFS mount root file system using BOOTP info</programlisting>

      <para>The custom kernel can also include
	<literal>BOOTP_NFSV3</literal>,
	<literal>BOOT_COMPAT</literal> and
	<literal>BOOTP_WIRED_TO</literal>.  Refer to
	<filename>NOTES</filename> for descriptions of these
	options.</para>

      <para>These option names are historical and slightly
	misleading as they actually enable indifferent use of
	<acronym>DHCP</acronym> and <acronym>BOOTP</acronym>
	inside the kernel.</para>

      <para>Build the custom kernel, using the instructions in
	<xref linkend="kernelconfig"/>, and copy it to the place
	specified in
	<filename>/usr/local/etc/dhcpd.conf</filename>.</para>

      <indexterm>
	<primary>root file system</primary>
	<secondary>diskless operation</secondary>
      </indexterm>

      <para>Create a root file system for the diskless
	workstations in the location listed as
	<literal>root-path</literal> in
	<filename>/usr/local/etc/dhcpd.conf</filename>.</para>

      <para>Using <command>make world</command> to populate root is
	quick and will install a complete virgin system, not just
	the root file system, into <envar>DESTDIR</envar>.  Execute
	the following script:</para>

      <programlisting>#!/bin/sh
export DESTDIR=/data/misc/diskless
mkdir -p ${DESTDIR}
cd /usr/src; make buildworld &amp;&amp; make buildkernel
make installworld &amp;&amp; make installkernel
cd /usr/src/etc; make distribution</programlisting>

      <para>Once done, customize
	<filename>/etc/rc.conf</filename> and
	<filename>/etc/fstab</filename> placed into
	<envar>DESTDIR</envar> according to the system's
	requirements.</para>
    </sect2>

    <sect2>
      <title>Configuring Swap</title>

      <para>If needed, a swap file located on the server can be
	accessed via <acronym>NFS</acronym>.</para>

      <para>The kernel does not support enabling
	<acronym>NFS</acronym> swap at boot time.  Swap must be
	enabled by the startup scripts, by mounting a writable
	file system and creating and enabling a swap file.  To
	create a swap file:</para>

      <screen>&prompt.root; <userinput>dd if=/dev/zero of=<replaceable>/path/to/swapfile</replaceable> bs=1k count=1 oseek=<replaceable>100000</replaceable></userinput></screen>

      <para>To enable the swap file, add the following line to
	<filename>/etc/rc.conf</filename>:</para>

      <programlisting>swapfile=<replaceable>/path/to/swapfile</replaceable></programlisting>
    </sect2>

    <sect2>
      <title>Miscellaneous Issues</title>

      <indexterm>
	<primary>diskless operation</primary>
	<secondary>/usr read-only</secondary>
      </indexterm>

      <para>If the diskless workstation is configured to run
	<application>&xorg;</application> and is running with a
	read-only <filename>/usr</filename>, adjust the
	<application>XDM</application> configuration file as it puts
	the error log on <filename>/usr</filename> by
	default.</para>

      <para>When the server for the root file system is not
	running &os;, create the root file system on a &os;
	machine, then copy it to its destination, using
	&man.tar.1; or &man.cpio.1;.</para>

      <para>In this situation, there are sometimes problems with
	the special files in <filename>/dev</filename>, due to
	differing major/minor integer sizes.  A solution to this
	problem is to export a directory from the non-&os; server,
	mount this directory onto a &os; machine, and use
	&man.devfs.5; to allocate device nodes transparently for
	the user.</para>
    </sect2>
-->

    <sect2>
      <title>Depurando problemas de <acronym>PXE</acronym></title>

      <para>Uma vez que todos os serviços estejam configurados e iniciados, os clientes de <acronym>PXE</acronym> devem poder carregar automaticamente o FreeBSD pela rede. Se um determinado cliente não conseguir se conectar, quando a máquina cliente inicializar, entre no menu de configuração da <acronym>BIOS</acronym> e confirme se ela está configurada para inicializar a partir da rede.</para>

      <para>Esta seção descreve algumas dicas de solução de problemas para isolar a origem do problema de configuração, caso nenhum cliente seja capaz de inicializar o <acronym>PXE</acronym>.</para>

      <procedure>
	<step>
	  <para>Use o pacote ou port <package>net/wireshark</package> para depurar o tráfego de rede envolvido durante o processo de inicialização do <acronym>PXE</acronym>, que está ilustrado no diagrama abaixo.</para>

	  <figure>
	    <title>Processo de inicialização <acronym>PXE</acronym> com o sistema de arquivos raiz montado por <acronym>NFS</acronym></title>

	    <mediaobject>
	      <imageobjectco>
		<areaspec units="calspair">
		  <area xml:id="co-pxenfs1" coords="2873,8133 3313,7266"/>
		  <area xml:id="co-pxenfs2" coords="3519,6333 3885,5500"/>
		  <area xml:id="co-pxenfs3" coords="4780,5866 5102,5200"/>
		  <area xml:id="co-pxenfs4" coords="4794,4333 5102,3600"/>
		  <area xml:id="co-pxenfs5" coords="3108,2666 3519,1800"/>
		</areaspec>
		<imageobject>
		  <imagedata fileref="advanced-networking/pxe-nfs"/>
		</imageobject>
		<calloutlist>
		  <callout arearefs="co-pxenfs1">
		    <para>O cliente transmite uma mensagem <literal>DHCPDISCOVER</literal>.</para>
		  </callout>
		  <callout arearefs="co-pxenfs2">
		    <para>O servidor <acronym>DHCP</acronym> responde com as informações de endereço <acronym>IP</acronym>, <literal>next-server</literal>, <literal>filename</literal> e <literal>root-path</literal>.</para>
		  </callout>
		  <callout arearefs="co-pxenfs3">
		    <para>O cliente envia uma solicitação <acronym>TFTP</acronym> para o <literal>next-server</literal>, solicitando acesso ao <literal>filename</literal>.</para>
		  </callout>
		  <callout arearefs="co-pxenfs4">
		    <para>O servidor <acronym>TFTP</acronym> responde e envia o <literal>filename</literal> para o cliente.</para>
		  </callout>
		  <callout arearefs="co-pxenfs5">
		    <para>O cliente executa o <literal>filename</literal>, que é o <citerefentry><refentrytitle>pxeboot</refentrytitle><manvolnum>8</manvolnum></citerefentry>, o qual então carrega o kernel. Quando o kernel é executado, o sistema de arquivos raiz especificado por <literal>root-path</literal> é montado sobre o <acronym>NFS</acronym>.</para>
		  </callout>
		</calloutlist>
	      </imageobjectco>
	    </mediaobject>
	  </figure>
	</step>

	<step>
	  <para>No servidor <acronym>TFTP</acronym>, leia o <filename>/var/log/xferlog</filename> para garantir que o <filename>pxeboot</filename> esteja sendo recuperado do local correto. Para testar esta configuração de exemplo:</para>

	  <screen><prompt>#</prompt> <userinput>tftp 192.168.0.1</userinput>
tftp&gt; <userinput>get FreeBSD/install/boot/pxeboot</userinput>
Received 264951 bytes in 0.1 seconds</screen>

	  <para>As seções de <literal>BUGS</literal> do <citerefentry><refentrytitle>tftpd</refentrytitle><manvolnum>8</manvolnum></citerefentry> e <citerefentry><refentrytitle>tftp</refentrytitle><manvolnum>1</manvolnum></citerefentry> documenta algumas limitações com o <acronym>TFTP</acronym>.</para>
	</step>

	<step>
	  <para>Certifique-se de que o sistema de arquivos raiz possa ser montado via <acronym>NFS</acronym>. Para testar esta configuração de exemplo:</para>

	  <screen><prompt>#</prompt> <userinput>mount -t nfs 192.168.0.1:/b/tftpboot/FreeBSD/install /mnt</userinput></screen>
	</step>
      </procedure>
    </sect2>
  </sect1>

  <sect1 xml:id="network-ipv6">
    <info>
      <title><acronym>IPv6</acronym></title>

      <authorgroup>
	<author><personname> <firstname> Aaron </firstname> <surname> Kaplan </surname> </personname> <contrib> Originalmente escrito por </contrib></author>
      </authorgroup>
      <authorgroup>
	<author><personname> <firstname> Tom </firstname> <surname> Rhodes </surname> </personname> <contrib> Reestruturado e adicionado por </contrib></author>
      </authorgroup>
      <authorgroup>
	<author><personname> <firstname> Brad </firstname> <surname> Davis </surname> </personname> <contrib> estendido por </contrib></author>
      </authorgroup>
    </info>

    <para>O <acronym>IPv6</acronym> é a nova versão do conhecido protocolo <acronym>IP</acronym>, também conhecido como <acronym>IPv4</acronym>. O <acronym>IPv6</acronym> oferece várias vantagens sobre o <acronym>IPv4</acronym>, além de muitos recursos novos:</para>

    <itemizedlist>
      <listitem>
	<para>Seu espaço de endereços de 128 bits permite 340.282.366.920.938.463.463.374.607.431.768.211.456 endereços. Isso corrige a falta de endereços do <acronym>IPv4</acronym> e o eventual esgotamento do endereço de <acronym>IPv4</acronym>.</para>
      </listitem>

      <listitem>
	<para>Os roteadores armazenam apenas endereços de agregação de rede em suas tabelas de roteamento, reduzindo assim o espaço médio de uma tabela de roteamento para 8192 entradas. Isso resolve os problemas de escalabilidade associados ao <acronym>IPv4</acronym>, que exigia que cada bloco alocado de endereços <acronym>IPv4</acronym> fossem trocados entre roteadores da Internet, fazendo com que suas tabelas de roteamento ficassem muito grandes para permitir um roteamento eficiente .</para>
      </listitem>
    </itemizedlist>

    <itemizedlist>
      <listitem>
	<para>Autoconfiguração de endereço (<link xlink:href="http://www.ietf.org/rfc/rfc2462.txt">RFC2462</link>).</para>
      </listitem>

      <listitem>
	<para>Endereços multicast obrigatórios.</para>
      </listitem>

      <listitem>
	<para><acronym>IPsec</acronym> Embutido (Segurança <acronym>IP</acronym>).</para>
      </listitem>

      <listitem>
	<para>Estrutura simplificada do cabeçalho.</para>
      </listitem>

      <listitem>
	<para>Suporte para mobile <acronym>IP</acronym>.</para>
      </listitem>

      <listitem>
	<para>Mecanismos de transição <acronym>IPv6</acronym>-to-<acronym>IPv4</acronym>.</para>
      </listitem>
    </itemizedlist>

    <para>O FreeBSD inclui a implementação de referência do <link xlink:href="http://www.kame.net/">http://www.kame.net/</link> <acronym>IPv6</acronym> e vem com tudo necessário usar o <acronym>IPv6</acronym>. Esta seção se concentra em configurar e executar o <acronym>IPv6</acronym>.</para>

    <sect2>
      <title>Informações sobre endereços de <acronym>IPv6</acronym></title>

      <para>Existem três tipos diferentes de endereços de <acronym>IPv6</acronym>:</para>

      <variablelist>
	<varlistentry>
	  <term>Unicast</term>
	  <listitem>
	    <para>Um pacote enviado para um endereço unicast chega à interface pertencente ao endereço.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>Anycast</term>
	  <listitem>
	    <para>Esses endereços são sintaticamente indistinguíveis dos endereços unicast, mas eles tratam de um grupo de interfaces. O pacote destinado a um endereço anycast chegará à interface do roteador mais próxima. Endereços anycast são usados apenas por roteadores.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>Multicast</term>
	  <listitem>
	    <para>Esses endereços identificam um grupo de interfaces. Um pacote destinado a um endereço multicast chegará a todas as interfaces pertencentes ao grupo multicast. O endereço de broadcast <acronym>IPv4 </acronym>, geralmente <systemitem class="ipaddress">xxx.xxx.xxx.255</systemitem>, é expresso por endereços multicast em <acronym>IPv6</acronym>.</para>
	  </listitem>
	</varlistentry>
      </variablelist>

      <para>Ao ler um endereço <acronym>IPv6</acronym>, a forma canônica é representada como <systemitem>x:x:x:x:x:x:x:x</systemitem>, onde cada <literal>x</literal> representa um valor hexadecimal de 16 bits. Um exemplo é <systemitem>FEBC:A574:382B:23C1:AA49:4592:4EFE:9982</systemitem>.</para>

      <para>Muitas vezes, um endereço terá substrings longas apenas com zeros. Um <literal>::</literal> (dois-pontos duplos) pode ser usado para substituir uma subcadeia por endereço. Além disso, até três valores <literal>0</literal>s iniciais por valor hexadecimal podem ser omitidos. Por exemplo, <systemitem>fe80::1</systemitem> corresponde à forma canônica <systemitem>fe80:0000:0000:0000:0000:0000:0000:0001</systemitem>.</para>

      <para>Uma terceira forma é escrever os últimos 32 bits usando a conhecida notação <acronym>IPv4</acronym>. Por exemplo, <systemitem>2002::10.0.0.1</systemitem> corresponde à representação canônica hexadecimal <systemitem>2002:0000:0000:0000:0000:0000:0a00:0001</systemitem>, que por sua vez é equivalente a <systemitem>2002::a00:1</systemitem>.</para>

      <para>Para visualizar o endereço <acronym>IPv6</acronym> do sistema FreeBSD, use <citerefentry><refentrytitle>ifconfig</refentrytitle><manvolnum>8</manvolnum></citerefentry>:</para>

      <screen><prompt>#</prompt> <userinput>ifconfig</userinput></screen>

      <programlisting>rl0: flags=8943&lt;UP,BROADCAST,RUNNING,PROMISC,SIMPLEX,MULTICAST&gt; mtu 1500
         inet 10.0.0.10 netmask 0xffffff00 broadcast 10.0.0.255
         inet6 fe80::200:21ff:fe03:8e1%rl0 prefixlen 64 scopeid 0x1
         ether 00:00:21:03:08:e1
         media: Ethernet autoselect (100baseTX )
         status: active</programlisting>

      <para>Neste exemplo, a interface <filename>rl0</filename> está usando <systemitem>fe80::200:21ff:fe03:8e1%rl0</systemitem>, um endereço local de link auto-configurado que foi gerado automaticamente a partir do endereço <acronym>MAC</acronym>.</para>

      <para>Alguns endereços do <acronym>IPv6</acronym> são reservados. Um resumo destes endereços reservados é visto em <xref linkend="reservedip6"/>:</para>

      <table xml:id="reservedip6" frame="none">
	<title>Endereços <acronym>IPv6</acronym> reservados</title>

	<tgroup cols="4">
	  <thead>
	    <row>
	      <entry>endereço <acronym>IPv6</acronym></entry>
	      <entry>Prefixlength (Bits)</entry>
	      <entry>Descrição</entry>
	      <entry>Notas</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><systemitem>::</systemitem></entry>
	      <entry>128 bits</entry>
	      <entry>não especificado</entry>
	      <entry>Equivalente a <systemitem class="ipaddress">0.0.0.0</systemitem> em <acronym>IPv4</acronym>.</entry>
	    </row>

	    <row>
	      <entry><systemitem>::1</systemitem></entry>
	      <entry>128 bits</entry>
	      <entry>endereço de loopback</entry>
	      <entry>Equivalente ao <systemitem class="ipaddress">127.0.0.1</systemitem> no <acronym>IPv4</acronym>.</entry>
	    </row>

	    <row>
	      <entry><systemitem>::00:xx:xx:xx:xx</systemitem></entry>
	      <entry>96 bits</entry>
	      <entry><acronym>IPv4</acronym> Embarcado</entry>
	      <entry>Os 32 bits inferiores são o endereço <acronym>IPv4</acronym> compatível.</entry>
	    </row>

	    <row>
	      <entry><systemitem>::ff:xx:xx:xx:xx</systemitem></entry>
	      <entry>96 bits</entry>
	      <entry>O endereço <acronym>IPv4</acronym> mapeado do endereço <acronym>IPv6</acronym></entry>
	      <entry>Os 32 bits mais baixos são o endereço <acronym>IPv4</acronym> para hosts que não suportam o <acronym>IPv6</acronym>.</entry>
	    </row>

	    <row>
	      <entry><systemitem>fe80::/10</systemitem></entry>
	      <entry>10 bits</entry>
	      <entry>link-local</entry>
	      <entry>Equivalente a 169.254.0.0/16 em <acronym>IPv4</acronym>.</entry>
	    </row>

	    <row>
	      <entry><systemitem>fc00::/7</systemitem></entry>
	      <entry>7 bits</entry>
	      <entry>unique-local</entry>
	      <entry>Endereços locais exclusivos são destinados à comunicação local e só podem ser roteados dentro de um conjunto de sites cooperantes.</entry>
	    </row>

	    <row>
	      <entry><systemitem>ff00::</systemitem></entry>
	      <entry>8 bits</entry>
	      <entry>multicast</entry>
	      <entry> </entry>
	    </row>

	    <row>
	      <entry><systemitem>2000::-3fff:: </systemitem></entry>
	      <entry>3 bits</entry>
	      <entry>unicast global</entry>
	      <entry>Todos os endereços unicast globais são atribuídos a partir desse pool. Os primeiros 3 bits são <literal>001</literal>.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Para maiores informações sobre a estrutura dos endereços do <acronym>IPv6</acronym>, consulte a <link xlink:href="http://www.ietf.org/rfc/rfc3513.txt">RFC3513</link>.</para>
    </sect2>

    <sect2>
      <title>Configurando o <acronym>IPv6</acronym></title>

      <para>Para configurar um sistema FreeBSD como um cliente <acronym>IPv6</acronym>, adicione estas duas linhas ao <filename>rc.conf</filename>:</para>

      <programlisting>ifconfig_<replaceable>rl0</replaceable>_ipv6="inet6 accept_rtadv"
rtsold_enable="YES"</programlisting>

      <para>A primeira linha permite que a interface especificada receba mensagens de solicitação do roteador. A segunda linha ativa o daemon de solicitação do roteador, <citerefentry><refentrytitle>rtsol</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>

      <para>Se a interface precisar de um endereço <acronym>IPv6</acronym> atribuído estaticamente, adicione uma entrada para especificar o endereço estático e o comprimento do prefixo associado:</para>

      <programlisting>ifconfig_<replaceable>rl0</replaceable>_ipv6="inet6 <replaceable>2001:db8:4672:6565:2026:5043:2d42:5344</replaceable> prefixlen <replaceable>64</replaceable>"</programlisting>

      <para>Para atribuir um roteador padrão, especifique seu endereço:</para>

      <programlisting>ipv6_defaultrouter="<replaceable>2001:db8:4672:6565::1</replaceable>"</programlisting>
    </sect2>

    <sect2>
      <title>Conectando-se a um provedor</title>

      <para>Para se conectar a outras redes <acronym>IPv6</acronym>, é necessário ter um provedor ou um túnel que suporte <acronym>IPv6</acronym>:</para>

      <itemizedlist>
	<listitem>
	  <para>Entre em contato com um provedor de serviços de Internet para saber se eles oferecem <acronym>IPv6</acronym>.</para>
	</listitem>

	<listitem>
	  <para>O <link xlink:href="http://www.tunnelbroker.net">Hurricane Electric</link> oferece túneis com endpoints em todo o mundo.</para>
	</listitem>
      </itemizedlist>

      <note>
	<para>Instale o pacote ou port <package>net/freenet6</package> para uma conexão dial-up.</para>
      </note>

      <para>Esta seção demonstra como obter as direções de um provedor de túneis e convertê-las em configurações do  <filename>/etc/rc.conf</filename> que persistirão durante as reinicializações.</para>

      <para>A primeira entrada <filename>/etc/rc.conf</filename> cria a interface de encapsulamento genérica <filename><replaceable>gif0</replaceable></filename>:</para>

      <programlisting>cloned_interfaces="gif<replaceable>0</replaceable>"</programlisting>

      <para>Em seguida, configure essa interface com os endereços <acronym>IPv4</acronym> dos pontos de extremidade locais e remotos. Substitua <replaceable>MY_IPv4_ADDR</replaceable> e <replaceable>REMOTE_IPv4_ADDR</replaceable> pelos endereços atuais de <acronym>IPv4</acronym>:</para>

      <programlisting>create_args_gif0="tunnel <replaceable>MY_IPv4_ADDR REMOTE_IPv4_ADDR</replaceable>"</programlisting>

      <para>Para aplicar o endereço <acronym>IPv6</acronym> que foi atribuído para uso como o ponto final do túnel <acronym>IPv6</acronym>, adicione esta linha, substituindo <replaceable>MY_ASSIGNED_IPv6_TUNNEL_ENDPOINT_ADDR</replaceable> pelo endereço atribuído:</para>

      <programlisting>ifconfig_gif0_ipv6="inet6 <replaceable>MY_ASSIGNED_IPv6_TUNNEL_ENDPOINT_ADDR</replaceable>"</programlisting>

      <para>Em seguida, defina a rota padrão para o outro lado do túnel <acronym>IPv6</acronym>. Substitua <replaceable>MY_IPv6_REMOTE_TUNNEL_ENDPOINT_ADDR</replaceable> pelo endereço do gateway padrão atribuído pelo provedor:</para>

      <programlisting>ipv6_defaultrouter="<replaceable>MY_IPv6_REMOTE_TUNNEL_ENDPOINT_ADDR</replaceable>"</programlisting>

      <para>Se o sistema FreeBSD irá rotear pacotes <acronym>IPv6</acronym> entre o resto da rede e o mundo, habilite o gateway usando esta linha:</para>

      <programlisting>ipv6_gateway_enable="YES"</programlisting>
    </sect2>

    <sect2>
      <title>Anúncio do roteador e configuração automática do host</title>

      <para>Esta seção demonstra como configurar o <citerefentry><refentrytitle>rtadvd</refentrytitle><manvolnum>8</manvolnum></citerefentry> para anunciar a rota padrão de <acronym>IPv6</acronym>.</para>

      <para>Para ativar <citerefentry><refentrytitle>rtadvd</refentrytitle><manvolnum>8</manvolnum></citerefentry>, inclua o seguinte no <filename>/etc/rc.conf</filename>:</para>

      <programlisting>rtadvd_enable="YES"</programlisting>

      <para>É importante especificar a interface na qual fazer a solicitação do roteador <acronym>IPv6</acronym>. Por exemplo, para informar o <citerefentry><refentrytitle>rtadvd</refentrytitle><manvolnum>8</manvolnum></citerefentry> para usar <filename>rl0</filename>:</para>

      <programlisting>rtadvd_interfaces="rl0"</programlisting>

      <para>Em seguida, crie o arquivo de configuração, <filename>/etc/rtadvd.conf</filename> como visto neste exemplo:</para>

      <programlisting>rl0:\
	:addrs#1:addr="2001:db8:1f11:246::":prefixlen#64:tc=ether:</programlisting>

      <para>Substitua <filename>rl0</filename> com a interface a ser usada e <systemitem>2001:db8:1f11:246::</systemitem> com o prefixo da alocação.</para>

      <para>Para uma sub-rede <systemitem class="netmask">/64</systemitem> dedicada, nada mais precisa ser alterado. Caso contrário, altere o <literal>prefixlen#</literal> para o valor correto.</para>
    </sect2>

    <sect2>
      <title><acronym>IPv6</acronym> e o mapeamento de endereços <acronym>IPv6</acronym></title>

      <para>Quando o <acronym>IPv6</acronym> está habilitado em um servidor, pode ser necessário ativar a comunicação de endereços <acronym>IPv4</acronym> mapeados para <acronym>IPv6</acronym>. Esta opção de compatibilidade permite que endereços <acronym>IPv4</acronym> sejam representados como endereços de <acronym>IPv6</acronym>. Permitir que aplicativos <acronym>IPv6</acronym> se comuniquem com <acronym>IPv4</acronym> e vice-versa pode ser um problema de segurança.</para>

      <para>Essa opção pode não ser necessária na maioria dos casos e está disponível apenas para compatibilidade. Esta opção permitirá que os aplicativos que suportam apenas o <acronym>IPv6</acronym> funcionem com <acronym>IPv4</acronym> em um ambiente de pilha dupla. Isso é mais útil para aplicativos de terceiros que podem não suportar um ambiente somente de <acronym>IPv6</acronym>. Para habilitar esse recurso, adicione o seguinte ao <filename>/etc/rc.conf</filename>:</para>

      <programlisting>ipv6_ipv4mapping="YES"</programlisting>

      <para>Revisar as informações da <acronym>RFC</acronym> 3493, seção 3.6 e 3.7, bem como da <acronym>RFC</acronym> 4038 seção 4.2, pode ser útil para alguns administradores.</para>
    </sect2>
  </sect1>
<!--
  <sect1 xml:id="network-atm">
    <info><title>Asynchronous Transfer Mode (<acronym>ATM</acronym>)</title>
      <authorgroup>
	<author>
	  <personname>
	    <firstname>Harti</firstname>
	    <surname>Brandt</surname>
	  </personname>
	  <contrib>Contributed by </contrib>
	</author>
      </authorgroup>
    </info>
    <sect2>
      <title>Configuring Classical <acronym>IP</acronym> over
	<acronym>ATM</acronym></title>

      <para>Classical <acronym>IP</acronym> over
	<acronym>ATM</acronym> (<acronym>CLIP</acronym>) is the
	simplest method to use Asynchronous Transfer Mode
	(<acronym>ATM</acronym>) with <acronym>IP</acronym>.  It can
	be used with Switched Virtual Circuits
	(<acronym>SVC</acronym>s) and with Permanent Virtual Circuits
	(<acronym>PVC</acronym>s).  This section describes how to
	set up a network based on <acronym>PVC</acronym>s.</para>

      <sect3>
	<title>Fully Meshed Configurations</title>

	<para>The first method to set up a <acronym>CLIP</acronym>
	  with <acronym>PVC</acronym>s is to connect each machine
	  to each other machine in the network via a dedicated
	  <acronym>PVC</acronym>.  While this is simple to
	  configure, it becomes impractical for a large number of
	  machines.  The following example supposes four machines in
	  the network, each connected to the <acronym role="Asynchronous Transfer Mode">ATM</acronym> network
	  with an <acronym role="Asynchronous Transfer Mode">ATM</acronym> adapter
	  card.  The first step is the planning of the
	  <acronym>IP</acronym> addresses and the <acronym role="Asynchronous Transfer Mode">ATM</acronym>
	  connections between the machines.  This example uses the
	  following:</para>

	<informaltable frame="none" pgwide="1">
	  <tgroup cols="2">
	    <colspec colwidth="1*"/>
	    <colspec colwidth="1*"/>
	    <thead>
	      <row>
		<entry>Host</entry>
		<entry><acronym>IP</acronym> Address</entry>
	      </row>
	    </thead>

	    <tbody>
	      <row>
		<entry><systemitem>hostA</systemitem></entry>
		<entry><systemitem class="ipaddress">192.168.173.1</systemitem></entry>
	      </row>

	      <row>
		<entry><systemitem>hostB</systemitem></entry>
		<entry><systemitem class="ipaddress">192.168.173.2</systemitem></entry>
	      </row>

	      <row>
		<entry><systemitem>hostC</systemitem></entry>
		<entry><systemitem class="ipaddress">192.168.173.3</systemitem></entry>
	      </row>

	      <row>
		<entry><systemitem>hostD</systemitem></entry>
		<entry><systemitem class="ipaddress">192.168.173.4</systemitem></entry>
	      </row>
	    </tbody>
	  </tgroup>
	</informaltable>

	<para>To build a fully meshed net, one <acronym>ATM</acronym>
	  connection is needed between each pair of machines:</para>

	<informaltable frame="none" pgwide="1">
	  <tgroup cols="2">
	    <colspec colwidth="1*"/>
	    <colspec colwidth="1*"/>
	    <thead>
	      <row>
		<entry>Machines</entry>
		<entry>VPI.VCI couple</entry>
	      </row>
	    </thead>

	    <tbody>
	      <row>
		<entry><systemitem>hostA</systemitem> -
		  <systemitem>hostB</systemitem></entry>
		<entry>0.100</entry>
	      </row>

	      <row>
		<entry><systemitem>hostA</systemitem> -
		  <systemitem>hostC</systemitem></entry>
		<entry>0.101</entry>
	      </row>

	      <row>
		<entry><systemitem>hostA</systemitem> -
		  <systemitem>hostD</systemitem></entry>
		<entry>0.102</entry>
	      </row>

	      <row>
		<entry><systemitem>hostB</systemitem> -
		  <systemitem>hostC</systemitem></entry>
		<entry>0.103</entry>
	      </row>

	      <row>
		<entry><systemitem>hostB</systemitem> -
		  <systemitem>hostD</systemitem></entry>
		<entry>0.104</entry>
	      </row>

	      <row>
		<entry><systemitem>hostC</systemitem> -
		  <systemitem>hostD</systemitem></entry>
		<entry>0.105</entry>
	      </row>
	    </tbody>
	  </tgroup>
	</informaltable>

	<para>The Virtual Path Identifier <acronym>VPI</acronym> and
	  Virtual Channel Identifier <acronym>VCI</acronym> values
	  at each end of the connection may differ, but for
	  simplicity, this example assumes they are the same.  Next,
	  configure the <acronym>ATM</acronym> interfaces on each
	  host:</para>

	<screen>hostA&prompt.root; <userinput>ifconfig hatm0 192.168.173.1 up</userinput>
hostB&prompt.root; <userinput>ifconfig hatm0 192.168.173.2 up</userinput>
hostC&prompt.root; <userinput>ifconfig hatm0 192.168.173.3 up</userinput>
hostD&prompt.root; <userinput>ifconfig hatm0 192.168.173.4 up</userinput></screen>

	<para>This example assumes that the <acronym>ATM</acronym>
	  interface is <filename>hatm0</filename> on all hosts.
	  Next, the <acronym>PVC</acronym>s need to be configured on
	  <systemitem>hostA</systemitem>.  This should already be
	  configured on the <acronym>ATM</acronym> switch; consult the
	  manual for the switch on how to do this.</para>

	<screen>hostA&prompt.root; <userinput>atmconfig natm add 192.168.173.2 hatm0 0 100 llc/snap ubr</userinput>
hostA&prompt.root; <userinput>atmconfig natm add 192.168.173.3 hatm0 0 101 llc/snap ubr</userinput>
hostA&prompt.root; <userinput>atmconfig natm add 192.168.173.4 hatm0 0 102 llc/snap ubr</userinput>

hostB&prompt.root; <userinput>atmconfig natm add 192.168.173.1 hatm0 0 100 llc/snap ubr</userinput>
hostB&prompt.root; <userinput>atmconfig natm add 192.168.173.3 hatm0 0 103 llc/snap ubr</userinput>
hostB&prompt.root; <userinput>atmconfig natm add 192.168.173.4 hatm0 0 104 llc/snap ubr</userinput>

hostC&prompt.root; <userinput>atmconfig natm add 192.168.173.1 hatm0 0 101 llc/snap ubr</userinput>
hostC&prompt.root; <userinput>atmconfig natm add 192.168.173.2 hatm0 0 103 llc/snap ubr</userinput>
hostC&prompt.root; <userinput>atmconfig natm add 192.168.173.4 hatm0 0 105 llc/snap ubr</userinput>

hostD&prompt.root; <userinput>atmconfig natm add 192.168.173.1 hatm0 0 102 llc/snap ubr</userinput>
hostD&prompt.root; <userinput>atmconfig natm add 192.168.173.2 hatm0 0 104 llc/snap ubr</userinput>
hostD&prompt.root; <userinput>atmconfig natm add 192.168.173.3 hatm0 0 105 llc/snap ubr</userinput></screen>

	<para>Other traffic contracts besides <literal>ubr</literal>
	  can be used if the <acronym>ATM</acronym> adapter supports
	  it.  In this case, the name of the traffic contract is
	  followed by the parameters of the traffic.  Help for the
	  &man.atmconfig.8; tool can be obtained with:</para>

	<screen>&prompt.root; <userinput>atmconfig help natm add</userinput></screen>

	<para>Refer to &man.atmconfig.8; for more information.</para>

	<para>The same configuration can also be done via
	  <filename>/etc/rc.conf</filename>.  These lines configure
	  <systemitem>hostA</systemitem>:</para>

	<programlisting>network_interfaces="lo0 hatm0"
ifconfig_hatm0="inet 192.168.173.1 up"
natm_static_routes="hostB hostC hostD"
route_hostB="192.168.173.2 hatm0 0 100 llc/snap ubr"
route_hostC="192.168.173.3 hatm0 0 101 llc/snap ubr"
route_hostD="192.168.173.4 hatm0 0 102 llc/snap ubr"</programlisting>

	<para>The current state of all <acronym>CLIP</acronym> routes
	  can be obtained with:</para>

	<screen>hostA&prompt.root; <userinput>atmconfig natm show</userinput></screen>
      </sect3>
    </sect2>
  </sect1>
  -->
  <sect1 xml:id="carp">
    <info>
      <title>Protocolo Comum de Redundância de Endereços (<acronym>CARP</acronym>)</title>

      <authorgroup>
	<author><personname> <firstname>Tom</firstname> <surname>Rhodes</surname> </personname> <contrib>Contribuído por </contrib></author>
      </authorgroup>
      <authorgroup>
	<author><personname> <firstname> Allan </firstname> <surname> Jude </surname> </personname> <contrib> Atualizado por </contrib></author>
      </authorgroup>
    </info>

    <indexterm><primary><acronym>CARP</acronym></primary></indexterm>
    <indexterm><primary>Common Address Redundancy Protocol</primary></indexterm>

    <para>O Protocolo Comum de Redundância de Endereços (<acronym>CARP</acronym>) permite que vários hosts compartilhem o mesmo endereço <acronym>IP</acronym> e ID de Host Virtual (<acronym>VHID</acronym>) para fornecer <firstterm>alta disponibilidade</firstterm> para um ou mais serviços. Isso significa que um ou mais hosts podem falhar e os outros hosts assumem o controle de modo transparente, de modo que os usuários não percebam uma falha de serviço.</para>

    <para>Além do endereço <acronym>IP</acronym> compartilhado, cada host tem seu próprio endereço <acronym>IP</acronym> para gerenciamento e configuração. Todas as máquinas que compartilham um endereço <acronym>IP</acronym> têm o mesmo <acronym>VHID</acronym>. O <acronym>VHID</acronym> para cada endereço virtual de <acronym>IP</acronym> deve ser exclusivo no domínio de broadcast da interface de rede.</para>

    <para>A alta disponibilidade usando o <acronym>CARP</acronym> é nativa no FreeBSD, embora os passos para configurá-lo variem um pouco dependendo da versão do FreeBSD. Esta seção fornece a mesma configuração de exemplo para versões anteriores, iguais ou posteriores ao FreeBSD 10.</para>

    <para>Este exemplo configura o suporte a failover com três hosts, todos com endereços exclusivos de <acronym>IP</acronym>, mas que fornecem o mesmo conteúdo da web. Ele tem dois mestres diferentes chamados <systemitem>hosta.example.org</systemitem> e <systemitem>hostb.example.org</systemitem>, com um backup compartilhado chamado <systemitem>hostc.example.org</systemitem>.</para>

    <para>O balanceamento de carga destas máquinas é feito por meio de uma configuração de <acronym>DNS</acronym> Round Robin. As máquinas principais e de backup são configuradas de forma idêntica, exceto por seus nomes de host e endereços de gerenciamento <acronym>IP</acronym>. Esses servidores devem ter a mesma configuração e executar os mesmos serviços. Quando o failover ocorre, as solicitações para o serviço no endereço <acronym>IP</acronym> compartilhado só podem ser respondidas corretamente se o servidor de backup tiver acesso ao mesmo conteúdo. A máquina de backup tem duas interfaces <acronym>CARP</acronym> adicionais, uma para cada endereço <acronym>IP</acronym> do servidor de conteúdo mestre. Quando ocorre uma falha, o servidor de backup selecionará o endereço <acronym>IP</acronym> da máquina mestre com falha.</para>

    <sect2 xml:id="carp-10x">
      <title>Usando <acronym>CARP</acronym> no FreeBSD 10 e Posteriores</title>

      <para>Ative o suporte para <acronym>CARP</acronym> na inicialização do sistema, adicionando uma entrada para o módulo do kernel <filename>carp.ko</filename> em <filename>/boot/loader.conf</filename>:</para>

      <programlisting>carp_load="YES"</programlisting>

      <para>Para carregar o módulo agora sem reiniciar:</para>

      <screen><prompt>#</prompt> <userinput>kldload carp</userinput></screen>

      <para>Para usuários que preferem usar um kernel personalizado, inclua a seguinte linha no arquivo de configuração do kernel personalizado e compile o kernel como descrito em <xref linkend="kernelconfig"/>:</para>

      <programlisting>device	carp</programlisting>

      <para>O nome do host, o endereço <acronym>IP</acronym> de gerenciamento  e a máscara de sub-rede, o endereço <acronym>IP</acronym> compartilhado e o <acronym>VHID</acronym> são definidos adicionando entradas ao <filename>/etc/rc.conf</filename>. Este exemplo é para o <systemitem>hosta.example.org</systemitem>:</para>

      <programlisting>hostname="<replaceable>hosta.example.org</replaceable>"
ifconfig_<replaceable>em0</replaceable>="inet <replaceable>192.168.1.3</replaceable> netmask <replaceable>255.255.255.0</replaceable>"
ifconfig_<replaceable>em0</replaceable>_alias0="inet vhid <replaceable>1</replaceable> pass <replaceable>testpass</replaceable> alias <replaceable>192.168.1.50</replaceable>/32"</programlisting>

      <para>O próximo conjunto de entradas é para o <systemitem>hostb.example.org</systemitem>. Como ele representa um segundo mestre, ele usa um endereço <acronym>IP</acronym> compartilhado diferente e <acronym>VHID</acronym>. No entanto, as senhas especificadas com <option>pass</option> devem ser idênticas, pois o <acronym>CARP</acronym> somente ouvirá e aceitará anúncios de máquinas com a senha correta.</para>

      <programlisting>hostname="<replaceable>hostb.example.org</replaceable>"
ifconfig_<replaceable>em0</replaceable>="inet <replaceable>192.168.1.4</replaceable> netmask <replaceable>255.255.255.0</replaceable>"
ifconfig_<replaceable>em0</replaceable>_alias0="inet vhid <replaceable>2</replaceable> pass <replaceable>testpass</replaceable> alias <replaceable>192.168.1.51</replaceable>/32"</programlisting>

      <para>A terceira máquina, <systemitem>hostc.example.org</systemitem>, é configurada para lidar com o failover de um dos mestres. Esta máquina é configurada com dois <acronym>CARP</acronym> <acronym>VHID</acronym>s, um para manipular o endereço <acronym>IP</acronym> virtual para cada um dos hosts principais. O desvio de publicidade <acronym>CARP</acronym>, <option>advskew</option>, é definida para garantir que o host de backup seja anunciado depois do mestre, pois <option>advskew</option> controla a ordem de precedência quando existem vários servidores de backup.</para>

      <programlisting>hostname="hostc.example.org"
ifconfig_<replaceable>em0</replaceable>="inet <replaceable>192.168.1.5</replaceable> netmask <replaceable>255.255.255.0</replaceable>"
ifconfig_<replaceable>em0</replaceable>_alias0="inet vhid <replaceable>1</replaceable> advskew <replaceable>100</replaceable> pass <replaceable>testpass</replaceable> alias <replaceable>192.168.1.50</replaceable>/32"
ifconfig_<replaceable>em0</replaceable>_alias1="inet vhid <replaceable>2</replaceable> advskew <replaceable>100</replaceable> pass <replaceable>testpass</replaceable> alias <replaceable>192.168.1.51</replaceable>/32"</programlisting>

      <para>Ter dois <acronym>CARP</acronym> <acronym>VHID</acronym>s configurados significa que o <systemitem>hostc.example.org</systemitem> notará se um dos servidores principais ficar indisponível. Se um mestre falhar em anunciar antes do servidor de backup, o servidor de backup selecionará o endereço <acronym>IP</acronym> compartilhado até que o mestre se torne disponível novamente.</para>

      <note>
	<para>Se o servidor mestre original se tornar disponível novamente, o <systemitem>hostc.example.org</systemitem> não liberará o endereço virtual <acronym>IP</acronym> de volta a ele automaticamente. Para que isso aconteça, a preempção deve ser ativada. O recurso está desabilitado por padrão, ele é controlado por meio da variável <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> <varname>net.inet.carp.preempt</varname>. O administrador pode forçar o servidor de backup a retornar o endereço <acronym>IP</acronym> para o mestre:</para>

	<screen><prompt>#</prompt> <userinput>ifconfig em0 vhid 1 state backup</userinput></screen>
      </note>

      <para>Quando a configuração estiver concluída, reinicie a rede ou reinicie cada um dos sistemas. A alta disponibilidade está agora ativada.</para>

      <para>A funcionalidade <acronym>CARP</acronym> pode ser controlada através de diversas variáveis <citerefentry><refentrytitle>sysctl</refentrytitle><manvolnum>8</manvolnum></citerefentry> documentadas nas páginas de manual do <citerefentry><refentrytitle>carp</refentrytitle><manvolnum>4</manvolnum></citerefentry>. Outras ações podem ser acionadas a partir de eventos <acronym>CARP</acronym> usando <citerefentry><refentrytitle>devd</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
    </sect2>

    <sect2 xml:id="carp-9x">
      <title>Usando <acronym>CARP</acronym> no FreeBSD 9 e Anteriores</title>

      <para>A configuração para estas versões do FreeBSD é similar àquela descrita na seção anterior, exceto que o dispositivo <acronym>CARP</acronym> deve ser criado primeiro e referenciado na configuração.</para>

      <para>Ative o suporte de tempo de inicialização para o <acronym>CARP</acronym> carregando o módulo do kernel <filename>if_carp.ko</filename> no <filename>/boot/loader.conf</filename>:</para>

      <programlisting>if_carp_load="YES"</programlisting>

     <para>Para carregar o módulo agora sem reiniciar:</para>

      <screen><prompt>#</prompt> <userinput>kldload carp</userinput></screen>

      <para>Para usuários que preferem usar um kernel personalizado, inclua a seguinte linha no arquivo de configuração do kernel personalizado e compile o kernel como descrito em <xref linkend="kernelconfig"/>:</para>

      <programlisting>device	carp</programlisting>

      <para>Em seguida, em cada host, crie um dispositivo <acronym>CARP</acronym>:</para>

      <screen><prompt>#</prompt> <userinput>ifconfig carp0 create</userinput></screen>

      <para>Defina o nome do host, o endereço <acronym>IP</acronym> de gerenciamento, o endereço <acronym>IP</acronym> compartilhado e o <acronym>VHID</acronym> adicionando as linhas necessárias ao <filename>/etc/rc.conf</filename>. Como um dispositivo virtual <acronym>CARP</acronym> é usado em vez de um alias, uma máscara de subrede real <literal>/24</literal> é usada em vez de uma <literal>/32</literal>. Aqui estão as entradas para o <systemitem>hosta.example.org</systemitem>:</para>

      <programlisting>hostname="<replaceable>hosta.example.org</replaceable>"
ifconfig_<replaceable>fxp0</replaceable>="inet <replaceable>192.168.1.3</replaceable> netmask <replaceable>255.255.255.0</replaceable>"
cloned_interfaces="carp0"
ifconfig_carp0="vhid <replaceable>1</replaceable> pass <replaceable>testpass</replaceable> <replaceable>192.168.1.50/24</replaceable>"</programlisting>

      <para>Em <systemitem>hostb.example.org</systemitem>:</para>

      <programlisting>hostname="<replaceable>hostb.example.org</replaceable>"
ifconfig_<replaceable>fxp0</replaceable>="inet <replaceable>192.168.1.4</replaceable> netmask <replaceable>255.255.255.0</replaceable>"
cloned_interfaces="carp0"
ifconfig_carp0="vhid <replaceable>2</replaceable> pass <replaceable>testpass</replaceable> <replaceable>192.168.1.51/24</replaceable>"</programlisting>

      <para>A terceira máquina, <systemitem>hostc.example.org</systemitem>, está configurada para lidar com o failover de qualquer um dos hosts principais:</para>

      <programlisting>hostname="<replaceable>hostc.example.org</replaceable>"
ifconfig_<replaceable>fxp0</replaceable>="inet <replaceable>192.168.1.5</replaceable> netmask <replaceable>255.255.255.0</replaceable>"
cloned_interfaces="carp0 carp1"
ifconfig_carp0="vhid <replaceable>1</replaceable> advskew <replaceable>100</replaceable> pass <replaceable>testpass</replaceable> <replaceable>192.168.1.50/24</replaceable>"
ifconfig_carp1="vhid <replaceable>2</replaceable> advskew <replaceable>100</replaceable> pass <replaceable>testpass</replaceable> <replaceable>192.168.1.51/24</replaceable>"</programlisting>

      <note>
	<para>A preempção está desabilitada no kernel <filename>GENERIC</filename> do FreeBSD. Se a preempção tiver sido ativada com um kernel personalizado, o <systemitem>hostc.example.org</systemitem> poderá não liberar o endereço <acronym>IP</acronym> de volta ao servidor de conteúdo original. O administrador pode forçar o servidor de backup a retornar o endereço <acronym>IP</acronym> para o mestre com o comando:</para>

	<screen><prompt>#</prompt> <userinput>ifconfig carp0 down &amp;&amp; ifconfig carp0 up</userinput></screen>

	<para>Isso deve ser feito na interface <filename>carp</filename>, que corresponde ao host correto.</para>
      </note>

      <para>Quando a configuração estiver concluída, reinicie a rede ou reinicie cada um dos sistemas. A alta disponibilidade está agora ativada.</para>
    </sect2>
  </sect1>
  <sect1 xml:id="network-vlan">
    <info>
      <title>VLANs</title>
    </info>

    <indexterm><primary><acronym>VLANs</acronym></primary></indexterm>
    <indexterm><primary>Virtual LANs</primary></indexterm>

    <para>As <acronym>VLANs</acronym> são uma forma de dividir virtualmente uma rede em várias sub-redes diferentes, também conhecida como segmentação. Cada segmento terá seu próprio domínio de broadcast e será isolado de outras <acronym>VLANs</acronym>.</para>

    <para>No FreeBSD, as <acronym>VLANs</acronym> devem ser suportadas pelo driver da placa de rede. Para ver quais drivers suportam vlans, consulte a página de manual <citerefentry><refentrytitle>vlan</refentrytitle><manvolnum>4</manvolnum></citerefentry>.</para>

    <para>Ao configurar uma <acronym>VLAN</acronym>, algumas informações devem ser conhecidas. Primeiro, qual a interface de rede? Segundo, qual é a tag da <acronym>VLAN</acronym>?</para>

    <para>Para configurar uma <acronym>VLANs</acronym> em tempo de execução, com uma <acronym>NIC</acronym> <literal>em0</literal> e uma tag <acronym>VLAN</acronym> de <systemitem>5</systemitem> o comando ficaria assim:</para>

    <screen><prompt>#</prompt> <userinput>ifconfig <replaceable>em0.5</replaceable> create vlan <replaceable>5</replaceable> vlandev <replaceable>em0</replaceable> inet 192.168.20.20/24</userinput></screen>

    <note>
      <para>Viu como o nome da interface inclui o nome do driver da <acronym>NIC</acronym> e a tag <acronym>VLAN</acronym>, separados por um ponto final? Essa é uma prática recomendada para facilitar a manutenção da configuração de <acronym>VLAN</acronym> quando muitas <acronym>VLANs</acronym> estiverem presentes em uma máquina.</para>
    </note>

    <para>Para configurar uma <acronym>VLANs</acronym> no momento da inicialização, o <filename>/etc/rc.conf</filename> deve ser atualizado. Para duplicar a configuração acima, será necessário adicionar o seguinte:</para>

    <programlisting>vlans_<replaceable>em0</replaceable>="<replaceable>5</replaceable>"
ifconfig_<replaceable>em0</replaceable>_<replaceable>5</replaceable>="inet 192.168.20.20/24"</programlisting>

    <para><acronym>VLANs</acronym> adicionais podem ser inseridas, simplesmente adicionando a tag ao campo <literal>vlans_<replaceable>em0</replaceable></literal> e incrementando uma linha de configuração da rede nessa  interface da tag <acronym>VLAN</acronym>.</para>

    <para>É útil atribuir um nome simbólico a uma interface para que, quando o hardware associado for alterado, apenas algumas variáveis de configuração precisem ser atualizadas. Por exemplo, câmeras de segurança precisam ser executadas pela VLAN 1 em <literal>em0</literal>. Posteriormente, se a placa <literal>em0</literal> for substituída por uma placa que use o driver <citerefentry><refentrytitle>ixgb</refentrytitle><manvolnum>4</manvolnum></citerefentry>, todas as referências a <literal>em0.1</literal> não precisarão ser alterado para <literal>ixgb0.1</literal>.</para>

    <para>Para configurar a <acronym>VLAN</acronym> <systemitem>5</systemitem>, na <acronym>NIC</acronym> <literal>em0</literal>, atribua o nome de interface <literal>cameras</literal>, e atribua à interface um endereço IP de <systemitem class="ipaddress"><replaceable>192.168.20.20</replaceable></systemitem> com um prefixo <systemitem class="netmask">24</systemitem>-bit, use este comando:</para>

    <screen><prompt>#</prompt> <userinput>ifconfig <replaceable>em0.5</replaceable> create vlan <replaceable>5</replaceable> vlandev <replaceable>em0</replaceable> name <replaceable>cameras</replaceable> inet <replaceable>192.168.20.20/24</replaceable></userinput></screen>

    <para>Para uma interface denominada <literal>video</literal>, use o seguinte:</para>

    <screen><prompt>#</prompt> <userinput>ifconfig <replaceable>video.5</replaceable> create vlan <replaceable>5</replaceable> vlandev <replaceable>video</replaceable> name <replaceable>cameras inet 192.168.20.20/24</replaceable></userinput></screen>

  <para>Para aplicar as mudanças no momento da inicialização, adicione as seguintes linhas ao <filename>/etc/rc.conf</filename>:</para>

  <programlisting>vlans_<replaceable>video</replaceable>="<replaceable>cameras</replaceable>"
create_args_<replaceable>cameras</replaceable>="vlan <replaceable>5</replaceable>"
ifconfig_<replaceable>cameras</replaceable>="inet <replaceable>192.168.20.20/24</replaceable>"</programlisting>

  </sect1>
</chapter>

  </part>

  <part xml:id="appendices">
    <title>Apêndices</title>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<appendix version="5.0" xml:id="mirrors">
  <title>Obtendo o FreeBSD</title>

  <sect1 xml:id="mirrors-cdrom">
    <title><acronym>CD</acronym> and <acronym>DVD</acronym> Sets</title>

    <para>Os conjuntos de <acronym>CD</acronym> and <acronym>DVD</acronym> do FreeBSD  estão disponíveis em vários varejistas on-line:</para>

    <itemizedlist>
      <listitem>
	<address>FreeBSD Mall, Inc.
	  <street>2420 Sand Creek Rd C-1 #347</street>
	  <city>Brentwood</city>, <state>CA</state>
	  <postcode>94513</postcode>
	  <country>USA</country>
	  Phone: <phone>+1 925 240-6652</phone>
	  Fax: <fax>+1 925 674-0821</fax>
	  Email: <email>info@freebsdmall.com</email>
	  WWW: <otheraddr xlink:href="https://www.freebsdmall.com">https://www.freebsdmall.com</otheraddr>
	</address>
      </listitem>

      <listitem>
	<address>Getlinux
	  <street>78 Rue de la Croix Rochopt</street>
	  <city>Épinay-sous-Sénart</city>
	  <postcode>91860</postcode>
	  <country>France</country>
	  Email: <email>contact@getlinux.fr</email>
	  WWW: <otheraddr xlink:href="http://www.getlinux.fr">http://www.getlinux.fr/</otheraddr>
	</address>
      </listitem>

      <listitem>
	<address>Dr. Hinner EDV
	  <street>Kochelseestr. 11</street>
	  <postcode>D-81371</postcode> <city>München</city>
	  <country>Germany</country>
	  Phone: <phone>(0177) 428 419 0</phone>
	  Email: <email>infow@hinner.de</email>
	  WWW: <otheraddr xlink:href="http://www.hinner.de/linux/freebsd.html">http://www.hinner.de/linux/freebsd.html</otheraddr>
	</address>
      </listitem>

      <listitem>
	<address>Linux Center
	  <street>Galernaya Street, 55</street>
	  <city>Saint-Petersburg</city>
	  <postcode>190000</postcode>
	  <country>Russia</country>
	  Phone: <phone>+7-812-309-06-86</phone>
	  Email: <email>info@linuxcenter.ru</email>
	  WWW: <otheraddr xlink:href="http://linuxcenter.ru/shop/freebsd">http://linuxcenter.ru/shop/freebsd</otheraddr>
	</address>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="mirrors-ftp">
    <title>Sites de <acronym>FTP</acronym></title>

    <para>As fontes oficiais do FreeBSD estão disponíveis no <acronym>FTP</acronym> anônimo de um conjunto mundial de sites espelho. O site <uri xlink:href="ftp://ftp.FreeBSD.org/pub/FreeBSD/">ftp://ftp.FreeBSD.org/pub/FreeBSD/</uri> está disponível via <acronym>HTTP</acronym> e <acronym>FTP</acronym>. Ele é composto de muitas máquinas operadas pelos administradores de cluster do projeto e fica atrás de uma estrutura de GeoDNS que direciona os usuários para o espelho disponível mais próximo.</para>

    <para>Adicionalmente, o FreeBSD está disponível via <acronym>FTP</acronym> anônimo a partir dos seguintes sites espelho. Ao obter o FreeBSD via <acronym>FTP</acronym> anônimo, por favor tente usar um site próximo. Os sites espelhos listados como <quote>Sites Espelhos Primários</quote> geralmente possuem o arquivo completo do FreeBSD (todas as versões atualmente disponíveis para cada uma das arquiteturas), mas velocidades de download mais rápidas provavelmente estão disponíveis em um site que esteja em seu país ou região. Os sites regionais carregam as versões mais recentes para a(s) arquitetura(s) mais populare(s), mas podem não carregar o arquivo completo do FreeBSD. Todos os sites fornecem acesso via <acronym>FTP</acronym> anônimo, mas alguns sites também fornecem acesso por meio de outros métodos. Os métodos de acesso disponíveis para cada site são fornecidos entre parênteses após o nome do host.</para>

    
<para><link linkend="central-ftp">Servidores Centrais</link>, <link linkend="mirrors-primary-ftp">Sites Espelhos Primários</link>, <link linkend="mirrors-am-ftp">Armenia</link>, <link linkend="mirrors-au-ftp">Australia</link>, <link linkend="mirrors-at-ftp">Austria</link>, <link linkend="mirrors-br-ftp">Brazil</link>, <link linkend="mirrors-cz-ftp">Czech Republic</link>, <link linkend="mirrors-dk-ftp">Denmark</link>, <link linkend="mirrors-ee-ftp">Estonia</link>, <link linkend="mirrors-fi-ftp">Finland</link>, <link linkend="mirrors-fr-ftp">France</link>, <link linkend="mirrors-de-ftp">Germany</link>, <link linkend="mirrors-gr-ftp">Greece</link>, <link linkend="mirrors-hk-ftp">Hong Kong</link>, <link linkend="mirrors-ie-ftp">Ireland</link>, <link linkend="mirrors-jp-ftp">Japan</link>, <link linkend="mirrors-kr-ftp">Korea</link>, <link linkend="mirrors-lv-ftp">Latvia</link>, <link linkend="mirrors-lt-ftp">Lithuania</link>, <link linkend="mirrors-nl-ftp">Netherlands</link>, <link linkend="mirrors-nz-ftp">New Zealand</link>, <link linkend="mirrors-no-ftp">Norway</link>, <link linkend="mirrors-pl-ftp">Poland</link>, <link linkend="mirrors-ru-ftp">Russia</link>, <link linkend="mirrors-sa-ftp">Saudi Arabia</link>, <link linkend="mirrors-si-ftp">Slovenia</link>, <link linkend="mirrors-za-ftp">South Africa</link>, <link linkend="mirrors-es-ftp">Spain</link>, <link linkend="mirrors-se-ftp">Sweden</link>, <link linkend="mirrors-ch-ftp">Switzerland</link>, <link linkend="mirrors-tw-ftp">Taiwan</link>, <link linkend="mirrors-ua-ftp">Ukraine</link>, <link linkend="mirrors-uk-ftp">United Kingdom</link>, <link linkend="mirrors-us-ftp">USA</link>.</para>


    
<para>(a partir de UTC)</para>


    
<variablelist>
  <varlistentry>
    <term><anchor xml:id="central-ftp"/> Servidores centrais</term>
    <listitem>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.FreeBSD.org/pub/FreeBSD/">ftp://ftp.FreeBSD.org/pub/FreeBSD/</link> (ftp / ftpv6 / <link xlink:href="http://ftp.FreeBSD.org/pub/FreeBSD/">http://ftp.FreeBSD.org/pub/FreeBSD/</link> / <link xlink:href="http://ftp.FreeBSD.org/pub/FreeBSD/">http://ftp.FreeBSD.org/pub/FreeBSD/</link>)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-primary-ftp"/> Sites Espelhos Primários</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email>mirror-admin@FreeBSD.org</email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp1.FreeBSD.org/pub/FreeBSD/">ftp://ftp1.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp2.FreeBSD.org/pub/FreeBSD/">ftp://ftp2.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp3.FreeBSD.org/pub/FreeBSD/">ftp://ftp3.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp4.FreeBSD.org/pub/FreeBSD/">ftp://ftp4.FreeBSD.org/pub/FreeBSD/</link> (ftp / ftpv6 / <link xlink:href="http://ftp4.FreeBSD.org/pub/FreeBSD/">http://ftp4.FreeBSD.org/pub/FreeBSD/</link> / <link xlink:href="http://ftp4.FreeBSD.org/pub/FreeBSD/">http://ftp4.FreeBSD.org/pub/FreeBSD/</link>)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp5.FreeBSD.org/pub/FreeBSD/">ftp://ftp5.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp6.FreeBSD.org/pub/FreeBSD/">ftp://ftp6.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp7.FreeBSD.org/pub/FreeBSD/">ftp://ftp7.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp10.FreeBSD.org/pub/FreeBSD/">ftp://ftp10.FreeBSD.org/pub/FreeBSD/</link> (ftp / ftpv6 / <link xlink:href="http://ftp10.FreeBSD.org/pub/FreeBSD/">http://ftp10.FreeBSD.org/pub/FreeBSD/</link> / <link xlink:href="http://ftp10.FreeBSD.org/pub/FreeBSD/">http://ftp10.FreeBSD.org/pub/FreeBSD/</link>)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp11.FreeBSD.org/pub/FreeBSD/">ftp://ftp11.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp13.FreeBSD.org/pub/FreeBSD/">ftp://ftp13.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp14.FreeBSD.org/pub/FreeBSD/">ftp://ftp14.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="http://ftp14.FreeBSD.org/pub/FreeBSD/">http://ftp14.FreeBSD.org/pub/FreeBSD/</link>)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-am-ftp"/> Armênia</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@am.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp1.am.FreeBSD.org/pub/FreeBSD/">ftp://ftp1.am.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="http://ftp1.am.FreeBSD.org/pub/FreeBSD/">http://ftp1.am.FreeBSD.org/pub/FreeBSD/</link> / rsync)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-au-ftp"/> Austrália</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@au.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.au.FreeBSD.org/pub/FreeBSD/">ftp://ftp.au.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp2.au.FreeBSD.org/pub/FreeBSD/">ftp://ftp2.au.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp3.au.FreeBSD.org/pub/FreeBSD/">ftp://ftp3.au.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-at-ftp"/>Austria</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@at.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.at.FreeBSD.org/pub/FreeBSD/">ftp://ftp.at.FreeBSD.org/pub/FreeBSD/</link> (ftp / ftpv6 / <link xlink:href="http://ftp.at.FreeBSD.org/pub/FreeBSD/">http://ftp.at.FreeBSD.org/pub/FreeBSD/</link> / <link xlink:href="http://ftp.at.FreeBSD.org/pub/FreeBSD/">http://ftp.at.FreeBSD.org/pub/FreeBSD/</link>)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-br-ftp"/> Brasil</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@br.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp2.br.FreeBSD.org/FreeBSD/">ftp://ftp2.br.FreeBSD.org/FreeBSD/</link> (ftp / <link xlink:href="http://ftp2.br.FreeBSD.org/">http://ftp2.br.FreeBSD.org/</link>)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp3.br.FreeBSD.org/pub/FreeBSD/">ftp://ftp3.br.FreeBSD.org/pub/FreeBSD/</link> (ftp / rsync)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp4.br.FreeBSD.org/pub/FreeBSD/">ftp://ftp4.br.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-cz-ftp"/> República Checa</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@cz.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.cz.FreeBSD.org/pub/FreeBSD/">ftp://ftp.cz.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="ftp://ftp.cz.FreeBSD.org/pub/FreeBSD/">ftp://ftp.cz.FreeBSD.org/pub/FreeBSD/</link> / <link xlink:href="http://ftp.cz.FreeBSD.org/pub/FreeBSD/">http://ftp.cz.FreeBSD.org/pub/FreeBSD/</link> / <link xlink:href="http://ftp.cz.FreeBSD.org/pub/FreeBSD/">http://ftp.cz.FreeBSD.org/pub/FreeBSD/</link> / rsync / rsyncv6)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp2.cz.FreeBSD.org/pub/FreeBSD/">ftp://ftp2.cz.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="http://ftp2.cz.FreeBSD.org/pub/FreeBSD/">http://ftp2.cz.FreeBSD.org/pub/FreeBSD/</link>)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-dk-ftp"/> Dinamarca</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@dk.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.dk.FreeBSD.org/pub/FreeBSD/">ftp://ftp.dk.FreeBSD.org/pub/FreeBSD/</link> (ftp / ftpv6 / <link xlink:href="http://ftp.dk.FreeBSD.org/pub/FreeBSD/">http://ftp.dk.FreeBSD.org/pub/FreeBSD/</link> / <link xlink:href="http://ftp.dk.FreeBSD.org/pub/FreeBSD/">http://ftp.dk.FreeBSD.org/pub/FreeBSD/</link>)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-ee-ftp"/> Estônia</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@ee.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.ee.FreeBSD.org/pub/FreeBSD/">ftp://ftp.ee.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-fi-ftp"/> Finlândia</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@fi.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.fi.FreeBSD.org/pub/FreeBSD/">ftp://ftp.fi.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-fr-ftp"/> França</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@fr.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.fr.FreeBSD.org/pub/FreeBSD/">ftp://ftp.fr.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp1.fr.FreeBSD.org/pub/FreeBSD/">ftp://ftp1.fr.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="http://ftp1.fr.FreeBSD.org/pub/FreeBSD/">http://ftp1.fr.FreeBSD.org/pub/FreeBSD/</link> / rsync)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp3.fr.FreeBSD.org/pub/FreeBSD/">ftp://ftp3.fr.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp5.fr.FreeBSD.org/pub/FreeBSD/">ftp://ftp5.fr.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp6.fr.FreeBSD.org/pub/FreeBSD/">ftp://ftp6.fr.FreeBSD.org/pub/FreeBSD/</link> (ftp / rsync)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp7.fr.FreeBSD.org/pub/FreeBSD/"> ftp://ftp7.fr.FreeBSD.org/pub/FreeBSD/ </link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp8.fr.FreeBSD.org/pub/FreeBSD/">ftp://ftp8.fr.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-de-ftp"/> Alemanha</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> de-bsd-hubs@de.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.de.FreeBSD.org/pub/FreeBSD/">ftp://ftp.de.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp1.de.FreeBSD.org/freebsd/">ftp://ftp1.de.FreeBSD.org/freebsd/</link> (ftp / <link xlink:href="http://www1.de.FreeBSD.org/freebsd/">http://www1.de.FreeBSD.org/freebsd/</link> / <link xlink:href="rsync://rsync3.de.FreeBSD.org/freebsd/">rsync://rsync3.de.FreeBSD.org/freebsd/</link>)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp2.de.FreeBSD.org/pub/FreeBSD/">ftp://ftp2.de.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="http://ftp2.de.FreeBSD.org/pub/FreeBSD/">http://ftp2.de.FreeBSD.org/pub/FreeBSD/</link> / rsync)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp4.de.FreeBSD.org/FreeBSD/">ftp://ftp4.de.FreeBSD.org/FreeBSD/</link> (ftp / <link xlink:href="http://ftp4.de.FreeBSD.org/pub/FreeBSD/">http://ftp4.de.FreeBSD.org/pub/FreeBSD/</link>)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp5.de.FreeBSD.org/pub/FreeBSD/">ftp://ftp5.de.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp7.de.FreeBSD.org/pub/FreeBSD/">ftp://ftp7.de.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="http://ftp7.de.FreeBSD.org/pub/FreeBSD/">http://ftp7.de.FreeBSD.org/pub/FreeBSD/</link>)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp8.de.FreeBSD.org/pub/FreeBSD/">ftp://ftp8.de.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-gr-ftp"/> Grécia</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@gr.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.gr.FreeBSD.org/pub/FreeBSD/">ftp://ftp.gr.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp2.gr.FreeBSD.org/pub/FreeBSD/">ftp://ftp2.gr.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-hk-ftp"/> Hong Kong</term>
    <listitem>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.hk.FreeBSD.org/pub/FreeBSD/">ftp://ftp.hk.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-ie-ftp"/> Irlanda</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@ie.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp3.ie.FreeBSD.org/pub/FreeBSD/">ftp://ftp3.ie.FreeBSD.org/pub/FreeBSD/</link> (ftp / rsync)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-jp-ftp"/>Japan</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@jp.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.jp.FreeBSD.org/pub/FreeBSD/">ftp://ftp.jp.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp2.jp.FreeBSD.org/pub/FreeBSD/">ftp://ftp2.jp.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp3.jp.FreeBSD.org/pub/FreeBSD/">ftp://ftp3.jp.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp4.jp.FreeBSD.org/pub/FreeBSD/">ftp://ftp4.jp.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp5.jp.FreeBSD.org/pub/FreeBSD/">ftp://ftp5.jp.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp6.jp.FreeBSD.org/pub/FreeBSD/">ftp://ftp6.jp.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp7.jp.FreeBSD.org/pub/FreeBSD/"> ftp://ftp7.jp.FreeBSD.org/pub/FreeBSD/ </link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp8.jp.FreeBSD.org/pub/FreeBSD/">ftp://ftp8.jp.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp9.jp.FreeBSD.org/pub/FreeBSD/">ftp://ftp9.jp.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-kr-ftp"/> Coreia</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@kr.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.kr.FreeBSD.org/pub/FreeBSD/">ftp://ftp.kr.FreeBSD.org/pub/FreeBSD/</link> (ftp / rsync)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp2.kr.FreeBSD.org/pub/FreeBSD/">ftp://ftp2.kr.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="http://ftp2.kr.FreeBSD.org/pub/FreeBSD/">http://ftp2.kr.FreeBSD.org/pub/FreeBSD/</link>)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-lv-ftp"/> Letônia</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@lv.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.lv.FreeBSD.org/pub/FreeBSD/">ftp://ftp.lv.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="http://ftp.lv.FreeBSD.org/pub/FreeBSD/">http://ftp.lv.FreeBSD.org/pub/FreeBSD/</link>)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-lt-ftp"/> Lituânia</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@lt.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.lt.FreeBSD.org/pub/FreeBSD/">ftp://ftp.lt.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="http://ftp.lt.FreeBSD.org/pub/FreeBSD/">http://ftp.lt.FreeBSD.org/pub/FreeBSD/</link>)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-nl-ftp"/> Países Baixos</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@nl.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.nl.FreeBSD.org/pub/FreeBSD/">ftp://ftp.nl.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="http://ftp.nl.FreeBSD.org/os/FreeBSD/">http://ftp.nl.FreeBSD.org/os/FreeBSD/</link> / rsync)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp2.nl.FreeBSD.org/pub/FreeBSD/">ftp://ftp2.nl.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-nz-ftp"/> Nova Zelândia</term>
    <listitem>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.nz.FreeBSD.org/pub/FreeBSD/">ftp://ftp.nz.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="http://ftp.nz.FreeBSD.org/pub/FreeBSD/">http://ftp.nz.FreeBSD.org/pub/FreeBSD/</link>)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-no-ftp"/> Noruega</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@no.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.no.FreeBSD.org/pub/FreeBSD/">ftp://ftp.no.FreeBSD.org/pub/FreeBSD/</link> (ftp / rsync)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-pl-ftp"/> Polônia</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@pl.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.pl.FreeBSD.org/pub/FreeBSD/">ftp://ftp.pl.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-ru-ftp"/> Rússia</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@ru.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.ru.FreeBSD.org/pub/FreeBSD/">ftp://ftp.ru.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="http://ftp.ru.FreeBSD.org/FreeBSD/">http://ftp.ru.FreeBSD.org/FreeBSD/</link> / rsync)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp2.ru.FreeBSD.org/pub/FreeBSD/">ftp://ftp2.ru.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="http://ftp2.ru.FreeBSD.org/pub/FreeBSD/">http://ftp2.ru.FreeBSD.org/pub/FreeBSD/</link> / rsync)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp4.ru.FreeBSD.org/pub/FreeBSD/">ftp://ftp4.ru.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp5.ru.FreeBSD.org/pub/FreeBSD/">ftp://ftp5.ru.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="http://ftp5.ru.FreeBSD.org/pub/FreeBSD/">http://ftp5.ru.FreeBSD.org/pub/FreeBSD/</link> / rsync)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp6.ru.FreeBSD.org/pub/FreeBSD/">ftp://ftp6.ru.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-sa-ftp"/> Arábia Saudita</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> ftpadmin@isu.net.sa </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.isu.net.sa/pub/ftp.freebsd.org/">ftp://ftp.isu.net.sa/pub/ftp.freebsd.org/</link> (ftp)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-si-ftp"/> Eslovénia</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@si.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.si.FreeBSD.org/pub/FreeBSD/">ftp://ftp.si.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-za-ftp"/> África do Sul</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@za.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.za.FreeBSD.org/pub/FreeBSD/">ftp://ftp.za.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp2.za.FreeBSD.org/pub/FreeBSD/">ftp://ftp2.za.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp4.za.FreeBSD.org/pub/FreeBSD/">ftp://ftp4.za.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-es-ftp"/> Espanha</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@es.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.es.FreeBSD.org/pub/FreeBSD/">ftp://ftp.es.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="http://ftp.es.FreeBSD.org/pub/FreeBSD/">http://ftp.es.FreeBSD.org/pub/FreeBSD/</link>)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp3.es.FreeBSD.org/pub/FreeBSD/">ftp://ftp3.es.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-se-ftp"/> Suécia</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@se.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.se.FreeBSD.org/pub/FreeBSD/">ftp://ftp.se.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp2.se.FreeBSD.org/pub/FreeBSD/">ftp://ftp2.se.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="rsync://ftp2.se.FreeBSD.org/">rsync://ftp2.se.FreeBSD.org/</link>)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp3.se.FreeBSD.org/pub/FreeBSD/">ftp://ftp3.se.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp4.se.FreeBSD.org/pub/FreeBSD/">ftp://ftp4.se.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="ftp://ftp4.se.FreeBSD.org/pub/FreeBSD/">ftp://ftp4.se.FreeBSD.org/pub/FreeBSD/</link> / <link xlink:href="http://ftp4.se.FreeBSD.org/pub/FreeBSD/">http://ftp4.se.FreeBSD.org/pub/FreeBSD/</link> / <link xlink:href="http://ftp4.se.FreeBSD.org/pub/FreeBSD/">http://ftp4.se.FreeBSD.org/pub/FreeBSD/</link> / <link xlink:href="rsync://ftp4.se.FreeBSD.org/pub/FreeBSD/">rsync://ftp4.se.FreeBSD.org/pub/FreeBSD/</link> / <link xlink:href="rsync://ftp4.se.FreeBSD.org/pub/FreeBSD/">rsync://ftp4.se.FreeBSD.org/pub/FreeBSD/</link>)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp6.se.FreeBSD.org/pub/FreeBSD/">ftp://ftp6.se.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="http://ftp6.se.FreeBSD.org/pub/FreeBSD/">http://ftp6.se.FreeBSD.org/pub/FreeBSD/</link>)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-ch-ftp"/> Suíça</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@ch.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.ch.FreeBSD.org/pub/FreeBSD/">ftp://ftp.ch.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="http://ftp.ch.FreeBSD.org/pub/FreeBSD/">http://ftp.ch.FreeBSD.org/pub/FreeBSD/</link>)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-tw-ftp"/> Taiwan</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@tw.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.tw.FreeBSD.org/pub/FreeBSD/">ftp://ftp.tw.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="ftp://ftp.tw.FreeBSD.org/pub/FreeBSD/">ftp://ftp.tw.FreeBSD.org/pub/FreeBSD/</link> / rsync / rsyncv6)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp2.tw.FreeBSD.org/pub/FreeBSD/">ftp://ftp2.tw.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="ftp://ftp2.tw.FreeBSD.org/pub/FreeBSD/">ftp://ftp2.tw.FreeBSD.org/pub/FreeBSD/</link> / <link xlink:href="http://ftp2.tw.FreeBSD.org/pub/FreeBSD/">http://ftp2.tw.FreeBSD.org/pub/FreeBSD/</link> / <link xlink:href="http://ftp2.tw.FreeBSD.org/pub/FreeBSD/">http://ftp2.tw.FreeBSD.org/pub/FreeBSD/</link> / rsync / rsyncv6)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp4.tw.FreeBSD.org/pub/FreeBSD/">ftp://ftp4.tw.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp5.tw.FreeBSD.org/pub/FreeBSD/">ftp://ftp5.tw.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp6.tw.FreeBSD.org/pub/FreeBSD/">ftp://ftp6.tw.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="http://ftp6.tw.FreeBSD.org/">http://ftp6.tw.FreeBSD.org/</link> / rsync)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp7.tw.FreeBSD.org/pub/FreeBSD/">ftp://ftp7.tw.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp8.tw.FreeBSD.org/pub/FreeBSD/">ftp://ftp8.tw.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp11.tw.FreeBSD.org/pub/FreeBSD/">ftp://ftp11.tw.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="http://ftp11.tw.FreeBSD.org/FreeBSD/">http://ftp11.tw.FreeBSD.org/FreeBSD/</link>)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp12.tw.FreeBSD.org/pub/FreeBSD/">ftp://ftp12.tw.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp13.tw.FreeBSD.org/pub/FreeBSD/">ftp://ftp13.tw.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp14.tw.FreeBSD.org/pub/FreeBSD/">ftp://ftp14.tw.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp15.tw.FreeBSD.org/pub/FreeBSD/">ftp://ftp15.tw.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-ua-ftp"/> Ucrânia</term>
    <listitem>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.ua.FreeBSD.org/pub/FreeBSD/">ftp://ftp.ua.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="http://ftp.ua.FreeBSD.org/pub/FreeBSD/">http://ftp.ua.FreeBSD.org/pub/FreeBSD/</link>)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp6.ua.FreeBSD.org/pub/FreeBSD/">ftp://ftp6.ua.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="http://ftp6.ua.FreeBSD.org/pub/FreeBSD">http://ftp6.ua.FreeBSD.org/pub/FreeBSD</link> / <link xlink:href="rsync://ftp6.ua.FreeBSD.org/FreeBSD/">rsync://ftp6.ua.FreeBSD.org/FreeBSD/</link>)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp7.ua.FreeBSD.org/pub/FreeBSD/">ftp://ftp7.ua.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-uk-ftp"/> Reino Unido</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@uk.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp.uk.FreeBSD.org/pub/FreeBSD/">ftp://ftp.uk.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp2.uk.FreeBSD.org/pub/FreeBSD/">ftp://ftp2.uk.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="rsync://ftp2.uk.FreeBSD.org/ftp.freebsd.org/pub/FreeBSD/">rsync://ftp2.uk.FreeBSD.org/ftp.freebsd.org/pub/FreeBSD/</link>)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp3.uk.FreeBSD.org/pub/FreeBSD/">ftp://ftp3.uk.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp4.uk.FreeBSD.org/pub/FreeBSD/">ftp://ftp4.uk.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp5.uk.FreeBSD.org/pub/FreeBSD/">ftp://ftp5.uk.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><anchor xml:id="mirrors-us-ftp"/>USA</term>
    <listitem>
      <para>Em caso de problemas, entre em contato com o hostmaster <email> hostmaster@us.FreeBSD.org </email> para este domínio.</para>
      <itemizedlist>
        <listitem>
          <para><link xlink:href="ftp://ftp1.us.FreeBSD.org/pub/FreeBSD/">ftp://ftp1.us.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp2.us.FreeBSD.org/pub/FreeBSD/">ftp://ftp2.us.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp3.us.FreeBSD.org/pub/FreeBSD/">ftp://ftp3.us.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp4.us.FreeBSD.org/pub/FreeBSD/">ftp://ftp4.us.FreeBSD.org/pub/FreeBSD/</link> (ftp / ftpv6 / <link xlink:href="http://ftp4.us.FreeBSD.org/pub/FreeBSD/">http://ftp4.us.FreeBSD.org/pub/FreeBSD/</link> / <link xlink:href="http://ftp4.us.FreeBSD.org/pub/FreeBSD/">http://ftp4.us.FreeBSD.org/pub/FreeBSD/</link>)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp5.us.FreeBSD.org/pub/FreeBSD/">ftp://ftp5.us.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp6.us.FreeBSD.org/pub/FreeBSD/">ftp://ftp6.us.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp8.us.FreeBSD.org/pub/FreeBSD/">ftp://ftp8.us.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp10.us.FreeBSD.org/pub/FreeBSD/">ftp://ftp10.us.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp11.us.FreeBSD.org/pub/FreeBSD/">ftp://ftp11.us.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp13.us.FreeBSD.org/pub/FreeBSD/">ftp://ftp13.us.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="http://ftp13.us.FreeBSD.org/pub/FreeBSD/">http://ftp13.us.FreeBSD.org/pub/FreeBSD/</link> / rsync)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp14.us.FreeBSD.org/pub/FreeBSD/">ftp://ftp14.us.FreeBSD.org/pub/FreeBSD/</link> (ftp / <link xlink:href="http://ftp14.us.FreeBSD.org/pub/FreeBSD/">http://ftp14.us.FreeBSD.org/pub/FreeBSD/</link>)</para>
        </listitem>
        <listitem>
          <para><link xlink:href="ftp://ftp15.us.FreeBSD.org/pub/FreeBSD/">ftp://ftp15.us.FreeBSD.org/pub/FreeBSD/</link> (ftp)</para>
        </listitem>
      </itemizedlist>
    </listitem>
  </varlistentry>
</variablelist>

  </sect1>

  <sect1 xml:id="svn">
    <title>Usando o <application>Subversion</application></title>

    <indexterm><primary>Subversion</primary></indexterm>

    <sect2 xml:id="svn-intro">
      <title>Introdução</title>

      <para>Desde de julho de 2012, o FreeBSD usa o <application>Subversion</application> como o único sistema de controle de versão para armazenar todo o código-fonte do FreeBSD, a documentação e a coleção de ports.</para>

      <note>
	<para>O <application> Subversion </application> é geralmente uma ferramenta de desenvolvimento. Os usuários podem preferir usar o <command>freebsd-update</command> (<xref linkend="updating-upgrading-freebsdupdate"/>) para atualizar o sistema básico do FreeBSD, e o <command>portsnap</command> (<xref linkend="ports-using"/>) para atualizar a coleção de ports do FreeBSD.</para>
      </note>

      <para>Esta seção demonstra como instalar o <application>Subversion</application> em um sistema FreeBSD e usá-lo para criar uma cópia local de um repositório do FreeBSD. Informações adicionais sobre o uso de <application>Subversion</application> estão incluídas.</para>
    </sect2>

    <sect2 xml:id="svn-ssl-certificates">
      <title>Certificados Raiz <acronym>SSL</acronym></title>

      <para>A instalação do <package role="port">security/ca_root_nss</package> permite que o <application>Subversion</application> verifique a identidade dos servidores de repositório <acronym>HTTPS</acronym>. Os certificados raiz <acronym>SSL</acronym> podem ser instalados a partir de um port:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/security/ca_root_nss</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>

      <para>ou como um pacote:</para>

      <screen><prompt>#</prompt> <userinput>pkg install ca_root_nss</userinput></screen>
    </sect2>

    <sect2 xml:id="svn-svnlite">
      <title><application>Svnlite</application></title>

      <para>Uma versão leve do <application>Subversion</application> já está instalada no FreeBSD como <command>svnlite</command>. A versão do port ou pacote do <application>Subversion</application> é necessária apenas se a <acronym>API</acronym> do Python ou do Perl for necessária, ou se uma versão posterior do Subversion for desejada.</para>

      <para>A única diferença do uso normal do <application>Subversion</application> é que o nome do comando é <literal>svnlite</literal>.</para>
    </sect2>

    <sect2 xml:id="svn-install">
      <title>Instalação</title>

      <para>Se o <command>svnlite</command> não estiver disponível ou a versão completa do <application>Subversion</application> for necessária, ele deverá ser instalado.</para>

      <para>O <application>Subversion</application> pode ser instalado a partir da coleção de ports:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/ports/devel/subversion</userinput>
<prompt>#</prompt> <userinput>make install clean</userinput></screen>

      <para>O <application>Subversion</application> também pode ser instalado como um pacote:</para>

      <screen><prompt>#</prompt> <userinput>pkg install subversion</userinput></screen>
    </sect2>

    <sect2 xml:id="svn-usage">
      <title>Executando o <application>Subversion</application></title>

      <para>Para obter uma cópia limpa do código-fonte em um diretório local, use <command>svn</command>. Os arquivos neste diretório são chamados de <emphasis>cópia de trabalho local</emphasis>.</para>

      <warning>
	<para>Mova ou exclua o diretório de destino existente antes de usar o <command>checkout</command> pela primeira vez.</para>

	<para>O checkout em cima de um diretório não-<command>svn </command> existente pode causar conflitos entre os arquivos existentes e aqueles trazidos do repositório.</para>
      </warning>

      <para>O <application>Subversion</application> usa <acronym>URL</acronym>s para designar um repositório, sob a forma de <replaceable>protocol://hostname/path</replaceable>. O primeiro componente do caminho é o repositório do FreeBSD para acessar. Existem três repositórios diferentes, <literal>base</literal> para o código-fonte do sistema básico do FreeBSD, <literal>ports</literal> para a coleção de ports, e <literal>doc</literal> para a documentação. Por exemplo, o URL <literal>https://svn.FreeBSD.org/ports/head/</literal> especifica a ramificação principal do repositório de ports, usando o protocolo <literal>https</literal>.</para>

      <para>Um checkout de um determinado repositório é executado com um comando como este:</para>

      <screen><prompt>#</prompt> <userinput>svn checkout https://svn.FreeBSD.org/<replaceable>repository</replaceable>/<replaceable>branch</replaceable> <replaceable>lwcdir</replaceable></userinput></screen>

      <para>Onde:</para>

      <itemizedlist>
	<listitem>
	  <para>O <replaceable>repository</replaceable> é um dos repositórios do Projecto: <literal>base</literal>, <literal>ports</literal>, ou <literal>doc</literal>.</para>
	</listitem>

	<listitem>
	  <para>A <replaceable> branch </replaceable> depende do repositório usado. O <literal>ports</literal> e o <literal>doc</literal> são normalmente atualizados na ramificação <literal>head</literal>, enquanto <literal>base</literal> mantém a última versão de -CURRENT em <literal>head</literal> e as respectivas versões mais recentes das ramificações -STABLE em <literal>stable/9</literal> (9.<replaceable>x</replaceable>) e <literal>stable/10</literal> (10.<replaceable>x</replaceable>).</para>
	</listitem>

	<listitem>
	  <para>O <replaceable>lwcdir</replaceable> é o diretório de destino onde o conteúdo do ramo especificado deve ser colocado. Isso geralmente é <filename>/usr/ports</filename> para o <literal>ports</literal>, <filename>/usr/src</filename> para a <literal>base</literal>, e <filename>/usr/doc</filename> para o <literal>doc</literal>.</para>
	</listitem>
      </itemizedlist>

      <para>Este exemplo obtém a coleção de ports do repositório do FreeBSD usando o protocolo <acronym>HTTPS</acronym>, colocando a cópia de trabalho local em <filename>/usr/ports</filename>. Se o <filename>/usr/ports</filename> já estiver presente, mas não tiver sido criado pelo <command>svn</command>, lembre-se de renomeá-lo ou excluí-lo antes do checkout.</para>

      <screen><prompt>#</prompt> <userinput>svn checkout https://svn.FreeBSD.org/ports/head /usr/ports</userinput></screen>

      <para>Como o checkout inicial deve fazer o download da ramificação completa do repositório remoto, isso pode demorar um pouco. Por favor, seja paciente.</para>

      <para>Após o checkout inicial, a cópia de trabalho local pode ser atualizada executando:</para>

      <screen><prompt>#</prompt> <userinput>svn update <replaceable>lwcdir</replaceable></userinput></screen>

      <para>Para atualizar o <filename>/usr/ports</filename> criado no exemplo acima, use:</para>

      <screen><prompt>#</prompt> <userinput>svn update /usr/ports</userinput></screen>

      <para>O update é muito mais rápido do que um checkout, transferindo apenas os arquivos que foram alterados.</para>

      <para>Uma maneira alternativa de atualizar a cópia de trabalho local após o checkout é fornecida pelo <filename>Makefile</filename> existente em <filename>/usr/ports</filename>, <filename>/usr/src</filename>, e <filename>/usr/doc</filename>. Configure o <varname>SVN_UPDATE</varname> e use o destino <buildtarget>atualizar</buildtarget>. Por exemplo, para atualizar <filename>/usr/src</filename>:</para>

      <screen><prompt>#</prompt> <userinput>cd /usr/src</userinput>
<prompt>#</prompt> <userinput>make update SVN_UPDATE=yes</userinput></screen>
    </sect2>

    <sect2 xml:id="svn-mirrors">
      <title>Sites Espelho do <application>Subversion</application></title>

      <indexterm><primary>Subversion Repository</primary> <secondary>Mirror Sites</secondary></indexterm>

      <para>O repositório <application>Subversion</application> do FreeBSD é:</para>

      <programlisting>svn.FreeBSD.org</programlisting>

      <para>Essa é uma rede de espelhos acessível publicamente a qual usa o GeoDNS para selecionar um servidor de backend apropriado. Para visualizar os repositórios <application>Subversion</application> do FreeBSD através de um navegador, use <link xlink:href="https://svnweb.FreeBSD.org/">https://svnweb.FreeBSD.org/</link>.</para>

      <para>O HTTPS é o protocolo preferido, mas o pacote <filename role="package">security/ca_root_nss</filename> precisará ser instalado para validar os certificados automaticamente.</para>
    </sect2>

    <sect2>
      <title>Para Maiores Informações</title>

      <para>Para outras informações sobre o uso do <application>Subversion</application>, por favor veja o <quote>Subversion Book</quote>, intitulado <link xlink:href="http://svnbook.red-bean.com/">Version Controle com Subversion</link>, ou o <link xlink:href="http://subversion.apache.org/docs/">Documentação do Subversion</link>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="mirrors-rsync">
    <title>Usando o <application>rsync</application></title>

    <para>Estes sites disponibilizam o FreeBSD através do protocolo rsync. O utilitário <application>rsync</application> transfere apenas as diferenças entre dois conjuntos de arquivos. Isto é útil para sites espelho do servidor de <acronym>FTP</acronym> do FreeBSD . O pacote <application>rsync</application> está disponível para muitos sistemas operacionais, no FreeBSD, veja o port <package>net/rsync</package> ou use o pacote.</para>

    <variablelist>
      <varlistentry>
	<term>República Checa</term>

	<listitem>
	  <para>rsync://ftp.cz.FreeBSD.org/</para>

	  <para>Coleções disponíveis:</para>
	  <itemizedlist>
	    <listitem>
	      <para>ftp: Um espelho parcial do servidor de <acronym>FTP</acronym> do FreeBSD.</para>
	    </listitem>

	    <listitem>
	      <para>FreeBSD: Um espelho completo do servidor de <acronym>FTP</acronym> do FreeBSD.</para>
	    </listitem>
	  </itemizedlist>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Países Baixos</term>

	<listitem>
	  <para>rsync://ftp.nl.FreeBSD.org/</para>

	  <para>Coleções disponíveis:</para>
	  <itemizedlist>
	    <listitem>
	      <para>FreeBSD: Um espelho completo do servidor de <acronym>FTP</acronym> do FreeBSD.</para>
	    </listitem>
	  </itemizedlist>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Rússia</term>

	<listitem>
	  <para>rsync://ftp.mtu.ru/</para>

	  <para>Coleções disponíveis:</para>

	  <itemizedlist>
	    <listitem>
	      <para>FreeBSD: Um espelho completo do servidor de <acronym>FTP</acronym> do FreeBSD.</para>
	    </listitem>

	    <listitem>
	      <para>FreeBSD-Archive: Um espelho do servidor de <acronym>FTP</acronym> do FreeBSD Archive.</para>
	    </listitem>
	  </itemizedlist>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Suécia</term>

	<listitem>
	  <para>rsync://ftp4.se.freebsd.org/</para>

	  <para>Coleções disponíveis:</para>
	  <itemizedlist>
	    <listitem>
	      <para>FreeBSD: Um espelho completo do servidor de <acronym>FTP</acronym> do FreeBSD.</para>
	    </listitem>
	  </itemizedlist>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Taiwan</term>

	<listitem>
	  <para>rsync://ftp.tw.FreeBSD.org/</para>

	  <para>rsync://ftp2.tw.FreeBSD.org/</para>

	  <para>rsync://ftp6.tw.FreeBSD.org/</para>

	  <para>Coleções disponíveis:</para>
	  <itemizedlist>
	    <listitem>
	      <para>FreeBSD: Um espelho completo do servidor de <acronym>FTP</acronym> do FreeBSD.</para>
	    </listitem>
	  </itemizedlist>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Reino Unido</term>

	<listitem>
	  <para>rsync://rsync.mirrorservice.org/</para>

	  <para>Coleções disponíveis:</para>
	  <itemizedlist>
	    <listitem>
	      <para>ftp.freebsd.org: Um espelho completo do servidor de <acronym>FTP</acronym> do FreeBSD.</para>
	    </listitem>
	  </itemizedlist>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Estados Unidos da America</term>

	<listitem>
	  <para>rsync://ftp-master.FreeBSD.org/</para>

	  <para>Este servidor só pode ser usado por sites espelhos primários do FreeBSD.</para>

	  <para>Coleções disponíveis:</para>

	  <itemizedlist>
	    <listitem>
	      <para>FreeBSD: O arquivo master do servidor de <acronym>FTP</acronym> do FreeBSD.</para>
	    </listitem>

	    <listitem>
	      <para>acl: A lista do ACL mestre do FreeBSD.</para>
	    </listitem>
	  </itemizedlist>

	  <para>rsync://ftp13.FreeBSD.org/</para>

	  <para>Coleções disponíveis:</para>

	  <itemizedlist>
	    <listitem>
	      <para>FreeBSD: Um espelho completo do servidor de <acronym>FTP</acronym> do FreeBSD.</para>
	    </listitem>
	  </itemizedlist>
	</listitem>
      </varlistentry>
    </variablelist>
  </sect1>
</appendix>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<appendix version="5.0" xml:id="bibliography">

  <title>Bibliografia</title>

  <para>Enquanto páginas manuais fornecem uma referência definitiva para partes individuais do sistema operacional FreeBSD, elas raramente ilustram como juntar as peças para fazer todo o sistema operacional rodar sem problemas. Para isso, não há substituto para um bom livro ou manual do usuário na administração do sistema <trademark class="registered">UNIX</trademark>.</para>

  <sect1 xml:id="bibliography-freebsd">
    <title>Livros específicos para o FreeBSD</title>

    <para>Livros internacionais:</para>

    <itemizedlist>
      <listitem>
	<para><link xlink:href="http://jdli.tw.FreeBSD.org/publication/book/freebsd2/index.htm">Using FreeBSD</link> (in Traditional Chinese), published by <link xlink:href="http://www.drmaster.com.tw/">Drmaster</link>, 1997. ISBN 9-578-39435-7.</para>
      </listitem>

      <listitem>

	<para>FreeBSD Unleashed (Simplified Chinese translation), published by <link xlink:href="http://www.hzbook.com/">China Machine Press</link>. ISBN 7-111-10201-0.</para>
      </listitem>

      <listitem>
	<para>FreeBSD From Scratch Second Edition (in Simplified Chinese), published by China Machine Press. ISBN 7-111-10286-X.</para>
      </listitem>

      <listitem>
	<para>FreeBSD Handbook Second Edition (Simplified Chinese translation), published by <link xlink:href="http://www.ptpress.com.cn/">Posts &amp; Telecom Press</link>. ISBN 7-115-10541-3.</para>
      </listitem>

      <listitem>
	<para>FreeBSD &amp; Windows (in Simplified Chinese), published by <link xlink:href="http://www.tdpress.com/">China Railway Publishing House</link>. ISBN 7-113-03845-X</para>
      </listitem>

      <listitem>
	<para>FreeBSD Internet Services HOWTO (in Simplified Chinese), published by China Railway Publishing House. ISBN 7-113-03423-3</para>
      </listitem>

      <listitem>
	<para>FreeBSD (in Japanese), published by CUTT. ISBN 4-906391-22-2 C3055 P2400E.</para>
      </listitem>

      <listitem>
	<para><link xlink:href="http://www.shoeisha.com/book/Detail.asp?bid=650">Complete Introduction to FreeBSD</link> (in Japanese), published by <link xlink:href="http://www.shoeisha.co.jp/">Shoeisha Co., Ltd</link>. ISBN 4-88135-473-6 P3600E.</para>
      </listitem>

      <listitem>
	<para><link xlink:href="http://www.ascii.co.jp/pb/book1/shinkan/detail/1322785.html">Personal UNIX Starter Kit FreeBSD</link> (in Japanese), published by <link xlink:href="http://www.ascii.co.jp/">ASCII</link>. ISBN 4-7561-1733-3 P3000E.</para>
      </listitem>

      <listitem>
	<para>FreeBSD Handbook (Japanese translation), published by <link xlink:href="http://www.ascii.co.jp/">ASCII</link>. ISBN 4-7561-1580-2 P3800E.</para>
      </listitem>

      <listitem>
	<para>FreeBSD mit Methode (in German), published by <link xlink:href="http://www.cul.de">Computer und Literatur Verlag</link>/Vertrieb Hanser, 1998. ISBN 3-932311-31-0.</para>
      </listitem>

      <listitem>
	<para><link xlink:href="http://www.mitp.de/vmi/mitp/detail/pWert/1343/"> FreeBSD de Luxe</link> (in German), published by <link xlink:href="http://www.mitp.de">Verlag Modere Industrie</link>, 2003. ISBN 3-8266-1343-0.</para>
      </listitem>

      <listitem>
	<para><link xlink:href="http://www.pc.mycom.co.jp/FreeBSD/install-manual.html">FreeBSD Install and Utilization Manual</link> (in Japanese), published by <link xlink:href="http://www.pc.mycom.co.jp/">Mainichi Communications Inc.</link>, 1998. ISBN 4-8399-0112-0.</para>
      </listitem>

      <listitem>
	<para>Onno W Purbo, Dodi Maryanto, Syahrial Hubbany, Widjil Widodo <emphasis><link xlink:href="http://maxwell.itb.ac.id/">Building Internet Server with FreeBSD</link></emphasis> (in Indonesia Language), published by <link xlink:href="http://www.elexmedia.co.id/">Elex Media Komputindo</link>.</para>
      </listitem>

      <listitem>
	<para>Absolute BSD: The Ultimate Guide to FreeBSD (Traditional Chinese translation), published by <link xlink:href="http://www.grandtech.com.tw/">GrandTech Press</link>, 2003. ISBN 986-7944-92-5.</para>
      </listitem>

      <listitem>
	<para><link xlink:href="http://www.twbsd.org/cht/book/">The FreeBSD 6.0 Book</link> (in Traditional Chinese), published by Drmaster, 2006. ISBN 9-575-27878-X.</para>
      </listitem>
    </itemizedlist>

    <para>Livros de língua inglesa:</para>

    <itemizedlist>
      <listitem>
	<para><link xlink:href="http://www.absoluteFreeBSD.com/">Absolute FreeBSD, 2nd Edition: The Complete Guide to FreeBSD</link>, published by <link xlink:href="http://www.nostarch.com/">No Starch Press</link>, 2007. ISBN: 978-1-59327-151-0</para>
      </listitem>

      <listitem>
	<para><link xlink:href="http://www.freebsdmall.com/cgi-bin/fm/bsdcomp"> The Complete FreeBSD</link>, published by <link xlink:href="http://www.oreilly.com/">O'Reilly</link>, 2003. ISBN: 0596005164</para>
      </listitem>

      <listitem>
	<para><link xlink:href="http://www.freebsd-corp-net-guide.com/">The FreeBSD Corporate Networker's Guide</link>, published by <link xlink:href="http://www.awl.com/aw/">Addison-Wesley</link>, 2000. ISBN: 0201704811</para>
      </listitem>

      <listitem>
	<para><link xlink:href="http://andrsn.stanford.edu/FreeBSD/introbook/"> FreeBSD: An Open-Source Operating System for Your Personal Computer</link>, published by The Bit Tree Press, 2001. ISBN: 0971204500</para>
      </listitem>

      <listitem>
	<para>Teach Yourself FreeBSD in 24 Hours, published by <link xlink:href="http://www.samspublishing.com/">Sams</link>, 2002. ISBN: 0672324245</para>
      </listitem>

      <listitem>
	<para>FreeBSD 6 Unleashed, published by <link xlink:href="http://www.samspublishing.com/">Sams</link>, 2006. ISBN: 0672328755</para>
      </listitem>

      <listitem>
	<para>FreeBSD: The Complete Reference, published by <link xlink:href="http://books.mcgraw-hill.com">McGrawHill</link>, 2003. ISBN: 0072224096</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="bibliography-userguides">
    <title>Guias de usuários</title>

    <itemizedlist>
      <listitem>
	<para>Ohio State University has written a <link xlink:href="http://www.cs.duke.edu/csl/docs/unix_course/">UNIX Introductory Course</link> which is available online in HTML and PostScript format.</para>

	<para>An Italian <link xlink:href="@@URL_RELPREFIX@@/doc/it_IT.ISO8859-15/books/unix-introduction/index.html">translation</link> of this document is available as part of the FreeBSD Italian Documentation Project.</para>
      </listitem>

      <listitem>
	<para><link xlink:href="http://www.jp.FreeBSD.org/">Jpman Project, Japan FreeBSD Users Group</link>. FreeBSD User's Reference Manual (Japanese translation). <link xlink:href="http://www.pc.mycom.co.jp/">Mainichi Communications Inc.</link>, 1998. ISBN4-8399-0088-4 P3800E.</para>
      </listitem>

      <listitem>
	<para><link xlink:href="http://www.ed.ac.uk/">Edinburgh University</link> has written an <link xlink:href="http://www.ed.ac.uk/information-services/help-consultancy/is-skills/catalogue/program-op-sys-catalogue/unix1">Online Guide</link> for newcomers to the UNIX environment.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="bibliography-adminguides">
    <title>Guias de Administradores</title>

    <itemizedlist>
      <listitem>
	<para><link xlink:href="http://www.jp.FreeBSD.org/">Jpman Project, Japan FreeBSD Users Group</link>. FreeBSD System Administrator's Manual (Japanese translation). <link xlink:href="http://www.pc.mycom.co.jp/">Mainichi Communications Inc.</link>, 1998. ISBN4-8399-0109-0 P3300E.</para>
      </listitem>

      <listitem>
	<para>Dreyfus, Emmanuel. <link xlink:href="http://www.eyrolles.com/Informatique/Livre/9782212114638/">Cahiers de l'Admin: BSD</link> 2nd Ed. (in French), Eyrolles, 2004. ISBN 2-212-11463-X</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="bibliography-programmers">
    <title>Guias de programadores</title>

    <itemizedlist>
      <listitem>
	<para>Computer Systems Research Group, UC Berkeley. <emphasis>4.4BSD Programmer's Reference Manual</emphasis>. O'Reilly &amp; Associates, Inc., 1994. ISBN 1-56592-078-3</para>
      </listitem>

      <listitem>
	<para>Computer Systems Research Group, UC Berkeley. <emphasis>4.4BSD Programmer's Supplementary Documents</emphasis>. O'Reilly &amp; Associates, Inc., 1994. ISBN 1-56592-079-1</para>
      </listitem>

      <listitem>
	<para>Harbison, Samuel P. and Steele, Guy L. Jr. <emphasis>C: A Reference Manual</emphasis>. 4th Ed. Prentice Hall, 1995. ISBN 0-13-326224-3</para>
      </listitem>

      <listitem>
	<para>Kernighan, Brian and Dennis M. Ritchie. <emphasis>The C Programming Language</emphasis>. 2nd Ed. PTR Prentice Hall, 1988. ISBN 0-13-110362-8</para>
      </listitem>

      <listitem>
	<para>Lehey, Greg. <emphasis>Porting UNIX Software</emphasis>. O'Reilly &amp; Associates, Inc., 1995. ISBN 1-56592-126-7</para>
      </listitem>

      <listitem>
	<para>Plauger, P. J. <emphasis>The Standard C Library</emphasis>. Prentice Hall, 1992. ISBN 0-13-131509-9</para>
      </listitem>

      <listitem>
	<para>Spinellis, Diomidis. <link xlink:href="http://www.spinellis.gr/codereading/"><emphasis>Code Reading: The Open Source Perspective</emphasis></link>. Addison-Wesley, 2003. ISBN 0-201-79940-5</para>
      </listitem>

      <listitem>
	<para>Spinellis, Diomidis. <link xlink:href="http://www.spinellis.gr/codequality/"><emphasis>Code Quality: The Open Source Perspective</emphasis></link>. Addison-Wesley, 2006. ISBN 0-321-16607-8</para>
      </listitem>

      <listitem>
	<para>Stevens, W. Richard and Stephen A. Rago. <emphasis>Advanced Programming in the UNIX Environment</emphasis>. 2nd Ed. Reading, Mass. : Addison-Wesley, 2005. ISBN 0-201-43307-9</para>
      </listitem>

      <listitem>
	<para>Stevens, W. Richard. <emphasis>UNIX Network Programming</emphasis>. 2nd Ed, PTR Prentice Hall, 1998. ISBN 0-13-490012-X</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="bibliography-osinternals">
    <title>Internals do sistema operacional</title>

    <itemizedlist>
      <listitem>
	<para>Andleigh, Prabhat K. <emphasis>UNIX System Architecture</emphasis>. Prentice-Hall, Inc., 1990. ISBN 0-13-949843-5</para>
      </listitem>

      <listitem>
	<para>Jolitz, William. <quote>Porting UNIX to the 386</quote>. <emphasis>Dr. Dobb's Journal</emphasis>. January 1991-July 1992.</para>
      </listitem>

      <listitem>
	<para>Leffler, Samuel J., Marshall Kirk McKusick, Michael J Karels and John Quarterman <emphasis>The Design and Implementation of the 4.3BSD UNIX Operating System</emphasis>. Reading, Mass. : Addison-Wesley, 1989. ISBN 0-201-06196-1</para>
      </listitem>

      <listitem>
	<para>Leffler, Samuel J., Marshall Kirk McKusick, <emphasis>The Design and Implementation of the 4.3BSD UNIX Operating System: Answer Book</emphasis>. Reading, Mass. : Addison-Wesley, 1991. ISBN 0-201-54629-9</para>
      </listitem>

      <listitem>
	<para>McKusick, Marshall Kirk, Keith Bostic, Michael J Karels, and John Quarterman. <emphasis>The Design and Implementation of the 4.4BSD Operating System</emphasis>. Reading, Mass. : Addison-Wesley, 1996. ISBN 0-201-54979-4</para>

	<para>(Chapter 2 of this book is available <link xlink:href="@@URL_RELPREFIX@@/doc/en_US.ISO8859-1/books/design-44bsd/book.html">online</link> as part of the FreeBSD Documentation Project.)</para>
      </listitem>

      <listitem>
	<para>Marshall Kirk McKusick, George V. Neville-Neil <emphasis>The Design and Implementation of the FreeBSD Operating System</emphasis>. Boston, Mass. : Addison-Wesley, 2004. ISBN 0-201-70245-2</para>
      </listitem>

      <listitem>
	<para>Marshall Kirk McKusick, George V. Neville-Neil, Robert N. M. Watson <emphasis>The Design and Implementation of the FreeBSD Operating System, 2nd Ed.</emphasis>. Westford, Mass. : Pearson Education, Inc., 2014. ISBN 0-321-96897-2</para>
      </listitem>

      <listitem>
	<para>Stevens, W. Richard. <emphasis>TCP/IP Illustrated, Volume 1: The Protocols</emphasis>. Reading, Mass. : Addison-Wesley, 1996. ISBN 0-201-63346-9</para>
      </listitem>

      <listitem>
	<para>Schimmel, Curt. <emphasis>Unix Systems for Modern Architectures</emphasis>. Reading, Mass. : Addison-Wesley, 1994. ISBN 0-201-63338-8</para>
      </listitem>

      <listitem>
	<para>Stevens, W. Richard. <emphasis>TCP/IP Illustrated, Volume 3: TCP for Transactions, HTTP, NNTP and the UNIX Domain Protocols</emphasis>. Reading, Mass. : Addison-Wesley, 1996. ISBN 0-201-63495-3</para>
      </listitem>

      <listitem>
	<para>Vahalia, Uresh. <emphasis>UNIX Internals -- The New Frontiers</emphasis>. Prentice Hall, 1996. ISBN 0-13-101908-2</para>
      </listitem>

      <listitem>
	<para>Wright, Gary R. and W. Richard Stevens. <emphasis>TCP/IP Illustrated, Volume 2: The Implementation</emphasis>. Reading, Mass. : Addison-Wesley, 1995. ISBN 0-201-63354-X</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="bibliography-security">
    <title>Referências de segurança</title>

    <itemizedlist>
      <listitem>
	<para>Cheswick, William R. and Steven M. Bellovin. <emphasis>Firewalls and Internet Security: Repelling the Wily Hacker</emphasis>. Reading, Mass. : Addison-Wesley, 1995. ISBN 0-201-63357-4</para>
      </listitem>

      <listitem>
	<para>Garfinkel, Simson. <emphasis>PGP Pretty Good Privacy</emphasis> O'Reilly &amp; Associates, Inc., 1995. ISBN 1-56592-098-8</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="bibliography-hardware">
    <title>Referências de Hardware</title>

    <itemizedlist>
      <listitem>
	<para>Anderson, Don and Tom Shanley. <emphasis>Pentium Processor System Architecture</emphasis>. 2nd Ed. Reading, Mass. : Addison-Wesley, 1995. ISBN 0-201-40992-5</para>
      </listitem>

      <listitem>
	<para>Ferraro, Richard F. <emphasis>Programmer's Guide to the EGA, VGA, and Super VGA Cards</emphasis>. 3rd ed. Reading, Mass. : Addison-Wesley, 1995. ISBN 0-201-62490-7</para>
      </listitem>

      <listitem>
	<para>Intel Corporation publishes documentation on their CPUs, chipsets and standards on their <link xlink:href="http://developer.intel.com/">developer web site</link>, usually as PDF files.</para>
      </listitem>

      <listitem>
	<para>Shanley, Tom. <emphasis>80486 System Architecture</emphasis>. 3rd Ed. Reading, Mass. : Addison-Wesley, 1995. ISBN 0-201-40994-1</para>
      </listitem>

      <listitem>
	<para>Shanley, Tom. <emphasis>ISA System Architecture</emphasis>. 3rd Ed. Reading, Mass. : Addison-Wesley, 1995. ISBN 0-201-40996-8</para>
      </listitem>

      <listitem>
	<para>Shanley, Tom. <emphasis>PCI System Architecture</emphasis>. 4th Ed. Reading, Mass. : Addison-Wesley, 1999. ISBN 0-201-30974-2</para>
      </listitem>

      <listitem>
	<para>Van Gilluwe, Frank. <emphasis>The Undocumented PC</emphasis>, 2nd Ed. Reading, Mass: Addison-Wesley Pub. Co., 1996. ISBN 0-201-47950-8</para>
      </listitem>

      <listitem>
	<para>Messmer, Hans-Peter. <emphasis>The Indispensable PC Hardware Book</emphasis>, 4th Ed. Reading, Mass : Addison-Wesley Pub. Co., 2002. ISBN 0-201-59616-4</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="bibliography-history">
    <title>História do <trademark class="registered">UNIX</trademark></title>

    <itemizedlist>
      <listitem>
	<para>Lion, John <emphasis>Lion's Commentary on UNIX, 6th Ed. With Source Code</emphasis>. ITP Media Group, 1996. ISBN 1573980137</para>
      </listitem>

      <listitem>
	<para>Raymond, Eric S. <emphasis>The New Hacker's Dictionary, 3rd edition</emphasis>. MIT Press, 1996. ISBN 0-262-68092-0. Also known as the <link xlink:href="http://www.catb.org/~esr/jargon/html/index.html">Jargon File</link></para>
      </listitem>

      <listitem>
	<para>Salus, Peter H. <emphasis>A quarter century of UNIX</emphasis>. Addison-Wesley Publishing Company, Inc., 1994. ISBN 0-201-54777-5</para>
      </listitem>

      <listitem>
	<para>Simon Garfinkel, Daniel Weise, Steven Strassmann. <emphasis>The UNIX-HATERS Handbook</emphasis>. IDG Books Worldwide, Inc., 1994. ISBN 1-56884-203-1. Out of print, but available <link xlink:href="http://www.simson.net/ref/ugh.pdf">online</link>.</para>
      </listitem>

      <listitem>
	<para>Don Libes, Sandy Ressler <emphasis>Life with UNIX</emphasis> — special edition. Prentice-Hall, Inc., 1989. ISBN 0-13-536657-7</para>
      </listitem>

      <listitem>
	<para><emphasis>The BSD family tree</emphasis>. <uri xlink:href="https://svnweb.freebsd.org/base/head/share/misc/bsd-family-tree?view=co">https://svnweb.freebsd.org/base/head/share/misc/bsd-family-tree?view=co</uri> or <link xlink:href="file://localhost/usr/share/misc/bsd-family-tree"><filename>/usr/share/misc/bsd-family-tree</filename></link> on a FreeBSD machine.</para>
      </listitem>

      <listitem>
	<para><emphasis>Networked Computer Science Technical Reports Library</emphasis>.</para>
      </listitem>

      <listitem>
	<para><emphasis>Old BSD releases from the Computer Systems Research group (CSRG)</emphasis>. <uri xlink:href="http://www.mckusick.com/csrg/">http://www.mckusick.com/csrg/</uri>: The 4CD set covers all BSD versions from 1BSD to 4.4BSD and 4.4BSD-Lite2 (but not 2.11BSD, unfortunately). The last disk also holds the final sources plus the SCCS files.</para>
      </listitem>

      <listitem>
	<para>Kernighan, Brian <emphasis>Unix: A History and a Memoir</emphasis>. Kindle Direct Publishing, 2020. ISBN 978-169597855-3</para>
      </listitem>

    </itemizedlist>
  </sect1>

  <sect1 xml:id="bibliography-journals">
    <title>Periódicos, Jornais e Revistas</title>

    <itemizedlist>
      <listitem>
	<para><link xlink:href="http://www.admin-magazin.de/">Admin Magazin</link> (in German), published by Medialinx AG. ISSN: 2190-1066</para>
      </listitem>

      <listitem>
	<para><link xlink:href="http://www.bsdmag.org/">BSD Magazine</link>, published by Software Press Sp. z o.o. SK. ISSN: 1898-9144</para>
      </listitem>

      <listitem>
	<para><link xlink:href="http://www.bsdnow.tv/">BSD Now — Video Podcast</link>, published by Jupiter Broadcasting LLC</para>
      </listitem>

      <listitem>
	<para><link xlink:href="http://bsdtalk.blogspot.com/">BSD Talk Podcast</link>, by Will Backman</para>
      </listitem>

      <listitem>
	<para><link xlink:href="http://freebsdjournal.com/">FreeBSD Journal</link>, published by S&amp;W Publishing, sponsored by The FreeBSD Foundation. ISBN: 978-0-615-88479-0</para>
      </listitem>
    </itemizedlist>
  </sect1>
</appendix>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<appendix version="5.0" xml:id="eresources">

  <title>Recursos na Internet</title>

  <para>O ritmo acelerado do progresso do FreeBSD torna a mídia impressa impraticável como um meio de acompanhar os desenvolvimentos mais recentes. Os recursos eletrônicos são a melhor maneira, se não a única, de se manter informado sobre os últimos avanços. Como o FreeBSD é um esforço voluntário, a própria comunidade de usuários geralmente serve como um <quote>departamento de suporte técnico</quote>, com o correio eletrônico, fóruns na web e notícias da USENET sendo a maneira mais eficaz de alcançar essa comunidade.</para>

  <para>Os pontos mais importantes de contato com a comunidade de usuários do FreeBSD são descritos abaixo. Por favor, envie outros recursos não mencionados aqui para a <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-doc">lista de discussão do projeto de documentação do FreeBSD</link> para que eles também possam ser incluídos.</para>

  <sect1 xml:id="eresources-www">
    <title>Websites</title>

    <itemizedlist>
      <listitem>
	<para><link xlink:href="https://forums.FreeBSD.org/">The FreeBSD Forums</link> fornecem um fórum de discussão baseado na web para questões sobre o FreeBSD e para discussão técnica.</para>
      </listitem>

      <listitem>
	<para>O <link xlink:href="http://www.youtube.com/bsdconferences">Canal do YouTube BSDConferences</link> oferece uma coleção de vídeos de alta qualidade de conferências sobre o BSD em todo o mundo. Esta é uma ótima maneira de assistir desenvolvedores-chave fazerem apresentações sobre novos trabalhos no FreeBSD.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="eresources-mail">
    <title>Listas de Discussão</title>

    <para>As listas de discussão são a maneira mais direta de abordar questões ou abrir uma discussão técnica para um público concentrado do FreeBSD. Há uma grande variedade de listas em vários tópicos diferentes do FreeBSD. Enviar perguntas para a lista de discussão mais adequada invariavelmente garantirá uma resposta mais rápida e precisa.</para>

    <para>Os charters das várias listas são dadas na parte inferior deste documento. <emphasis>Por favor, leia o regulamento antes de se cadastrar ou enviar e-mails para qualquer lista</emphasis>. A maioria dos assinantes de listas recebe muitas centenas de mensagens relacionadas ao FreeBSD todos os dias, e os charters e regras de uso visam manter a relação sinal-ruído das listas altas. Para fazer menos, as listas de discussão acabarão por falhar como um meio de comunicação eficaz para o Projeto.</para>

    <note>
      <para><emphasis>Para testar a capacidade de enviar email para as listas do FreeBSD, envie uma mensagem de teste para <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-test">freebsd-test</link>.</emphasis>Por favor, não envie mensagens de teste para qualquer outra lista.</para>
    </note>

    <para>Em caso de dúvida sobre a lista para colocar uma pergunta, consulte <link xlink:href="@@URL_RELPREFIX@@/doc/en_US.ISO8859-1/articles/freebsd-questions">Como obter os melhores resultados da lista de discussão FreeBSD-questions</link>.</para>

    <para>Antes de postar em qualquer lista, aprenda sobre a melhor forma de usar as listas de discussão, por exemplo, como ajudar a evitar discussões repetidas com frequência, lendo o documento de  <link xlink:href="@@URL_RELPREFIX@@/doc/en_US.ISO8859-1/articles/mailing-list-faq">Perguntas Frequentes das Mailing Lists</link> (FAQ).</para>

    <para>Os arquivos são mantidos para todas as listas de discussão e podem ser pesquisados usando o <link xlink:href="@@URL_RELPREFIX@@/search/index.html">servidor da World Wide Web do FreeBSD</link>. A busca por palavras-chaves no arquivo oferece uma excelente maneira de encontrar respostas para perguntas freqüentes e deve ser consultada antes de postar uma pergunta. Note que isso também significa que as mensagens enviadas para as listas de discussão do FreeBSD são arquivadas perpetuamente. Se a proteção da sua privacidade é uma preocupação, considere usar um endereço de e-mail secundário descartável e postar apenas informações públicas.</para>

    <sect2 xml:id="eresources-summary">
      <title>Sumário</title>

      <para><emphasis>Listas gerais:</emphasis> A seguir, listas gerais das quais qualquer pessoa é livre (e incentivada) a participar:</para>

      <informaltable frame="none" pgwide="1">
	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Lista</entry>
	      <entry>Propósito</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-advocacy">freebsd-advocacy</link></entry>
	      <entry>Evangelismo do FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-announce">freebsd-announce</link></entry>
	      <entry>Eventos importantes e marcos do projeto (moderado)</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-arch">freebsd-arch</link></entry>
	      <entry>Discussões de arquitetura e design</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-bugbusters">freebsd-bugbusters</link></entry>
	      <entry>Discussões relativas à manutenção do banco de dados de relatórios de problemas do FreeBSD e ferramentas relacionadas</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-bugs">freebsd-bugs</link></entry>
	      <entry>Relatório de erros</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-chat">freebsd-chat</link></entry>
	      <entry>Itens não técnicos relacionados à comunidade FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-chromium">freebsd-chromium</link></entry>
	      <entry>Problemas do Chromium específicos do FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current">freebsd-current</link></entry>
	      <entry>Discussão sobre o uso do FreeBSD-CURRENT</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-isp">freebsd-isp</link></entry>
	      <entry>Problemas para provedores de serviços de Internet usando o FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-jobs">freebsd-jobs</link></entry>
	      <entry>Vagas de empregos para trabalhar com FreeBSD e oportunidades de consultoria</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-quarterly-calls">freebsd-quarterly-calls</link></entry>
	      <entry>Chamadas para relatórios de status trimestrais (moderado)</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions">freebsd-questions</link></entry>
	      <entry>Perguntas de usuários e suporte técnico</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-security-notifications">freebsd-security-notifications</link></entry>
	      <entry>Notificações de segurança (moderadas)</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-stable">freebsd-stable</link></entry>
	      <entry>Discussão sobre o uso do FreeBSD-STABLE</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-test">freebsd-test</link></entry>
	      <entry>Lista para qual enviar mensagens de teste em vez de para uma das listas reais</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-women">freebsd-women</link></entry>
	      <entry>Defesa do FreeBSD para mulheres</entry>
	    </row>
	  </tbody>
	</tgroup>
      </informaltable>

      <para><emphasis> Listas técnicas: </emphasis> As listas a seguir são para discussão técnica. Leia atentamente o regulamento de cada lista antes de aderir ou enviar e-mails para uma, pois há diretrizes firmes para seu uso e conteúdo.</para>

      <informaltable frame="none" pgwide="1">
	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Lista</entry>
	      <entry>Propósito</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi">freebsd-acpi</link></entry>
	      <entry>ACPI e desenvolvimento de gerenciamento de energia</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-amd64">freebsd-amd64</link></entry>
	      <entry>Portando FreeBSD para sistemas AMD64 (moderado)</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-apache">freebsd-apache</link></entry>
	      <entry>Discussão sobre ports relacionados ao <application> Apache </application></entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-arm">freebsd-arm</link></entry>
	      <entry>Portando o FreeBS para processadores <trademark class="registered"> ARM </trademark></entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-atm">freebsd-atm</link></entry>
	      <entry>Usando a rede ATM com o FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-bluetooth">freebsd-bluetooth</link></entry>
	      <entry>Usando a tecnologia <trademark class="registered"> Bluetooth </trademark> no FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-cloud">freebsd-cloud</link></entry>
	      <entry>FreeBSD em plataformas em nuvem (EC2, GCE, Azure, etc.)</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-cluster">freebsd-cluster</link></entry>
	      <entry>Usando o FreeBSD em um ambiente clusterizado</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-database">freebsd-database</link></entry>
	      <entry>Discutindo o uso e desenvolvimento do banco de dados no FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-desktop">freebsd-desktop</link></entry>
	      <entry>Usando e melhorando o FreeBSD na área de trabalho</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/dev-ci">dev-ci</link></entry>
	      <entry>Construa e teste relatórios dos servidores de integração contínua</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/dev-reviews">dev-reviews</link></entry>
	      <entry>Notificações do sistema de revisão do FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-doc">freebsd-doc</link></entry>
	      <entry>Criando documentos relacionados ao FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-drivers">freebsd-drivers</link></entry>
	      <entry>Escrevendo drivers de dispositivos para o FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-dtrace">freebsd-dtrace</link></entry>
	      <entry>Usando e trabalhando no DTrace no FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-eclipse">freebsd-eclipse</link></entry>
	      <entry>Usuários FreeBSD do Eclipse IDE, ferramentas, aplicativos rich client e ports.</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-elastic">freebsd-elastic</link></entry>
	      <entry>Discussões específicas sobre ElasticSearch no FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-embedded">freebsd-embedded</link></entry>
	      <entry>Usando o FreeBSD em aplicativos embarcados</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-eol">freebsd-eol</link></entry>
	      <entry>Peer suporte a softwares relacionados ao FreeBSD que não são mais suportado pelo Projeto FreeBSD.</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-emulation">freebsd-emulation</link></entry>
	      <entry>Emulação de outros sistemas como o Linux/<trademark class="registered">MS-DOS</trademark>/<trademark class="registered">Windows</trademark></entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-enlightenment">freebsd-enlightenment</link></entry>
	      <entry>Portando o <application>Enlightenment</application> e aplicativos <application>Enlightenment</application></entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-erlang">freebsd-erlang</link></entry>
	      <entry>Discussões específicas sobre Erlang no FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-firewire">freebsd-firewire</link></entry>
	      <entry>Discussão técnica do FreeBSD <trademark class="registered">FireWire</trademark> (iLink, IEEE 1394)</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-fortran">freebsd-fortran</link></entry>
	      <entry>Fortran no FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-fs">freebsd-fs</link></entry>
	      <entry>Sistemas de arquivos</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-games">freebsd-games</link></entry>
	      <entry>Suporte para jogos no FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-gecko">freebsd-gecko</link></entry>
	      <entry>Problemas do <application>Gecko Rendering Engine</application></entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-geom">freebsd-geom</link></entry>
	      <entry>Discussões e implementações específicas do GEOM</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-git">freebsd-git</link></entry>
	      <entry>Discussão sobre o uso do git no projeto FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-gnome">freebsd-gnome</link></entry>
	      <entry>Portando aplicativos <application> GNOME </application> e o <application> GNOME </application></entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hackers">freebsd-hackers</link></entry>
	      <entry>Discussão técnica geral</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-haskell">freebsd-haskell</link></entry>
	      <entry>Questões e discussões sobre o Haskell específicas do FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hardware">freebsd-hardware</link></entry>
	      <entry>Discussão geral de hardware para executar o FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-i18n">freebsd-i18n</link></entry>
	      <entry>Internacionalização do FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-infiniband">freebsd-infiniband</link></entry>
	      <entry>Infiniband no FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ipfw">freebsd-ipfw</link></entry>
	      <entry>Discussão técnica sobre o redesenho do código de firewall de IP</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-isdn">freebsd-isdn</link></entry>
	      <entry>Desenvolvedores ISDN</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-jail">freebsd-jail</link></entry>
	      <entry>Discussões sobre <citerefentry><refentrytitle>jail</refentrytitle><manvolnum>8</manvolnum></citerefentry></entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-java">freebsd-java</link></entry>
	      <entry>Desenvolvedores  <trademark>Java</trademark> e pessoas trabalhando no port dos <trademark>JDK</trademark>s para o FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="https://mail.kde.org/mailman/listinfo/kde-freebsd">freebsd-kde</link></entry>
	      <entry>Portando aplicativos <application>KDE</application> e o <application>KDE</application></entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-lfs">freebsd-lfs</link></entry>
	      <entry>Portando o LFS para o FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-mips">freebsd-mips</link></entry>
	      <entry>Portando o FreeBS para <trademark class="registered"> MIPS </trademark></entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-mono">freebsd-mono</link></entry>
	      <entry>Aplicativos Mono e C # no FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-multimedia">freebsd-multimedia</link></entry>
	      <entry>Aplicações multimídia</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-new-bus">freebsd-new-bus</link></entry>
	      <entry>Discussões técnicas sobre arquitetura de barramento</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-net">freebsd-net</link></entry>
	      <entry>Discussão de rede e código-fonte TCP/IP</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-numerics">freebsd-numerics</link></entry>
	      <entry>Discussões sobre a implementação de alta qualidade de funções libm</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ocaml">freebsd-ocaml</link></entry>
	      <entry>Discussões específicas sobre OCaml no FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-office">freebsd-office</link></entry>
	      <entry>Aplicativos do Office no FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-performance">freebsd-performance</link></entry>
	      <entry>Perguntas de ajuste de desempenho para instalações de alto desempenho/carga</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-perl">freebsd-perl</link></entry>
	      <entry>Manutenção de vária\os ports relacionados ao Perl</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pf">freebsd-pf</link></entry>
	      <entry>Discussão e perguntas sobre o sistema de firewall de filtro de pacotes</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pkg">freebsd-pkg</link></entry>
	      <entry>Gerenciamento de pacotes binários e discussão de ferramentas de pacote</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pkg-fallout">freebsd-pkg-fallout</link></entry>
	      <entry>Registros de fallout da construção de pacotes</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pkgbase">freebsd-pkgbase</link></entry>
	      <entry>Empacotando o sistema básico do FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-platforms">freebsd-platforms</link></entry>
	      <entry>No que diz respeito ao port para plataformas de arquitetura não <trademark class="registered">Intel</trademark></entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports">freebsd-ports</link></entry>
	      <entry>Discussão da Coleção de Ports</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports-announce">freebsd-ports-announce</link></entry>
	      <entry>Notícias e instruções importantes sobre a coleção de ports (moderada)</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports-bugs">freebsd-ports-bugs</link></entry>
	      <entry>Discussão dos bugs/PRs dos ports</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ppc">freebsd-ppc</link></entry>
	      <entry>Portando o FreeBSD para o <trademark class="registered"> PowerPC </trademark></entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-proliant">freebsd-proliant</link></entry>
	      <entry>Discussão técnica do FreeBSD em plataformas de servidores HP ProLiant</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-python">freebsd-python</link></entry>
	      <entry>Problemas específicos do Python para FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-rc">freebsd-rc</link></entry>
	      <entry>Discussão relacionada ao sistema <filename> rc.d </filename> e seu desenvolvimento</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-realtime">freebsd-realtime</link></entry>
	      <entry>Desenvolvimento de extensões em tempo real para o FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-riscv">freebsd-riscv</link></entry>
	      <entry>Portando o FreeBSD para sistemas <trademark class="registered">RISC-V</trademark></entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ruby">freebsd-ruby</link></entry>
	      <entry>Discussões específicas sobre o Ruby no FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-scsi">freebsd-scsi</link></entry>
	      <entry>O subsistema SCSI</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-security">freebsd-security</link></entry>
	      <entry>Problemas de segurança que afetam o FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-snapshots">freebsd-snapshots</link></entry>
	      <entry>Anúncios de Snapshots dos ramos de Desenvolvimento do FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-sparc64">freebsd-sparc64</link></entry>
	      <entry>Portando o FreeBSD para sistemas baseados em <trademark class="registered"> SPARC </trademark></entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-standards">freebsd-standards</link></entry>
	      <entry>Conformidade do FreeBSD com os padrões C99 e <trademark class="registered"> POSIX </trademark></entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-sysinstall">freebsd-sysinstall</link></entry>
	      <entry>Desenvolvimento do <citerefentry><refentrytitle>sysinstall</refentrytitle><manvolnum>8</manvolnum></citerefentry></entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-tcltk">freebsd-tcltk</link></entry>
	      <entry>Discussões Tcl / Tk específicas do FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-testing">freebsd-testing</link></entry>
	      <entry>Testando no FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-tex">freebsd-tex</link></entry>

	      <entry>Portando o <application> TeX </application> e seus aplicativos para o FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-threads">freebsd-threads</link></entry>
	      <entry>Threads no FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-tilera">freebsd-tilera</link></entry>
	      <entry>Portando o FreeBSD para a família Tilera de CPUs</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-tokenring">freebsd-tokenring</link></entry>
	      <entry>Suporte Token Ring no FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-toolchain">freebsd-toolchain</link></entry>
	      <entry>Manutenção do toolchain integrado do FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-translators">freebsd-translators</link></entry>
	      <entry>Traduzindo documentos e programas do FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-transport">freebsd-transport</link></entry>
	      <entry>Discussões de protocolos de rede em nível de transporte no FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-usb">freebsd-usb</link></entry>
	      <entry>Discutindo o suporte do FreeBSD para USB</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-virtualization">freebsd-virtualization</link></entry>
	      <entry>Discussão de várias técnicas de virtualização suportadas pelo FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-vuxml">freebsd-vuxml</link></entry>
	      <entry>Discussão sobre a infraestrutura VuXML</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-x11">freebsd-x11</link></entry>
	      <entry>Manutenção e suporte do X11 no FreeBSD</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-xen">freebsd-xen</link></entry>
	      <entry>Discussão do port do FreeBSD para o <trademark>Xen</trademark> - implementação e uso</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-xfce">freebsd-xfce</link></entry>
	      <entry><application> XFCE </application> para o FreeBSD - portando e mantendo</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-zope">freebsd-zope</link></entry>
	      <entry><application> Zope </application> para o FreeBSD - portando e mantendo</entry>
	    </row>
	  </tbody>
	</tgroup>
      </informaltable>

      <para><emphasis> Listas limitadas: </emphasis> As listas a seguir são para públicos mais especializados (e exigentes) e provavelmente não são de interesse para o público em geral. Também é uma boa ideia estabelecer uma presença nas listas técnicas antes de entrar em uma dessas listas limitadas para entender a etiqueta de comunicação envolvida.</para>

      <informaltable frame="none" pgwide="1">
	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Lista</entry>
	      <entry>Propósito</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hubs">freebsd-hubs</link></entry>
	      <entry>Pessoas executando sites espelho (suporte infraestrutural)</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-user-groups">freebsd-user-groups</link></entry>
	      <entry>Coordenação de grupo de usuários</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-wip-status">freebsd-wip-status</link></entry>
	      <entry>FreeBSD Work-In-Progress Status</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-wireless">freebsd-wireless</link></entry>
	      <entry>Discussões da pilha 802.11, ferramentas, desenvolvimento de drivers de dispositivos</entry>
	    </row>
	  </tbody>
	</tgroup>
      </informaltable>

      <para><emphasis> Listas de resumo: </emphasis> Todas as listas acima estão disponíveis em formato resumido. Uma vez inscrito em uma lista, as opções de resumo podem ser alteradas na seção de opções da conta.</para>

      <para><emphasis> Listas de SVN: </emphasis> As listas a seguir são para pessoas interessadas em ver as mensagens de log para alterações em várias áreas da árvore de código-fonte. Elas são listas de <emphasis>somente leitura</emphasis> e não devem ter correio enviado para elas.</para>

      <informaltable frame="none" pgwide="1">
	<tgroup cols="3">
	  <thead>
	    <row>
	      <entry>Lista</entry>
	      <entry>Área do Fonte</entry>
	      <entry>Descrição da área (fonte para)</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-doc-all">svn-doc-all</link></entry>
	      <entry><filename>/usr/doc</filename></entry>
	      <entry>Todas as alterações no repositório Subversion do doc (exceto para <filename>user</filename>, <filename>projects</filename> e <filename>translations</filename>)</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-doc-head">svn-doc-head</link></entry>
	      <entry><filename>/usr/doc</filename></entry>
	      <entry>Todas as alterações na ramificação <quote>head</quote> do repositório do Subversion do doc</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-doc-projects">svn-doc-projects</link></entry>
	      <entry><filename>/usr/doc/projects</filename></entry>
	      <entry>Todas as alterações na área <filename>projects</filename> do repositório Subversion do doc</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-doc-svnadmin">svn-doc-svnadmin</link></entry>
	      <entry><filename>/usr/doc</filename></entry>
	      <entry>Todas as mudanças nos scripts administrativos, hooks e outros dados de configuração do repositório do Subversion do doc</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-ports-all">svn-ports-all</link></entry>
	      <entry><filename>/usr/ports</filename></entry>
	      <entry>Todas as mudanças no repositório do Subversion do ports</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-ports-head">svn-ports-head</link></entry>
	      <entry><filename>/usr/ports</filename></entry>
	      <entry>Todas as mudanças na ramificação <quote> head </quote> do repositório do Subversion do ports</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-ports-svnadmin">svn-ports-svnadmin</link></entry>
	      <entry><filename>/usr/ports</filename></entry>
	      <entry>Todas as mudanças nos scripts administrativos, hooks e outros dados de configuração do repositório Subversion das portas</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-all">svn-src-all</link></entry>
	      <entry><filename>/usr/src</filename></entry>
	      <entry>Todas as mudanças no repositório src Subversion (exceto para <filename>user</filename> e <filename>projects</filename>)</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-head">svn-src-head</link></entry>
	      <entry><filename>/usr/src</filename></entry>
	      <entry>Todas as mudanças na ramificação <quote> head </quote> do repositório src Subversion (a ramificação FreeBSD-CURRENT)</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-projects">svn-src-projects</link></entry>
	      <entry><filename>/usr/projects</filename></entry>
	      <entry>Todas as mudanças na área <filename> projects </filename> do repositório src do Subversion</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-release">svn-src-release</link></entry>
	      <entry><filename>/usr/src</filename></entry>
	      <entry>Todas as mudanças na área <filename>releases</filename> do repositório src do Subversion</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-releng">svn-src-releng</link></entry>
	      <entry><filename>/usr/src</filename></entry>
	      <entry>Todas as mudanças nas ramificações <filename> releng </filename> do repositório src Subversion (as ramificações de engenharia de segurança/release)</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable">svn-src-stable</link></entry>
	      <entry><filename>/usr/src</filename></entry>
	      <entry>Todas as mudanças para todos os ramos estáveis do repositório src Subversion</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-6">svn-src-stable-6</link></entry>
	      <entry><filename>/usr/src</filename></entry>
	      <entry>Todas as alterações na ramificação <filename>stable/6</filename> do repositório src Subversion</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-7">svn-src-stable-7</link></entry>
	      <entry><filename>/usr/src</filename></entry>
	      <entry>Todas as alterações na ramificação <filename>stable/7</filename> do repositório src Subversion</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-8">svn-src-stable-8</link></entry>
	      <entry><filename>/usr/src</filename></entry>
	      <entry>Todas as mudanças na ramificação <filename>stable/8</filename> do repositório src Subversion</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-9">svn-src-stable-9</link></entry>
	      <entry><filename>/usr/src</filename></entry>
	      <entry>Todas as alterações na ramificação <filename>stable/9</filename> do repositório src Subversion</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-10">svn-src-stable-10</link></entry>
	      <entry><filename>/usr/src</filename></entry>
	      <entry>Todas as mudanças na ramificação <filename>stable/10</filename> do repositório src do Subversion</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-11">svn-src-stable-11</link></entry>
	      <entry><filename>/usr/src</filename></entry>
	      <entry>Todas as alterações na ramificação <filename>stable/11</filename> do repositório src Subversion</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-12">svn-src-stable-12</link></entry>
	      <entry><filename>/usr/src</filename></entry>
	      <entry>Todas as mudanças na ramificação <filename>stable/12</filename> do repositório src do Subversion</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-other">svn-src-stable-other</link></entry>
	      <entry><filename>/usr/src</filename></entry>
	      <entry>Todas as mudanças para os ramos mais antigos <filename>stable</filename> do repositório src Subversion</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-svnadmin">svn-src-svnadmin</link></entry>
	      <entry><filename>/usr/src</filename></entry>
	      <entry>Todas as mudanças nos scripts administrativos, hooks e outros dados de configuração do repositório src do Subversion</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-user">svn-src-user</link></entry>
	      <entry><filename>/usr/src</filename></entry>
	      <entry>Todas as mudanças na área experimental <filename>user</filename> do repositório src do Subversion</entry>
	    </row>

	    <row>
	      <entry><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-vendor">svn-src-vendor</link></entry>
	      <entry><filename>/usr/src</filename></entry>
	      <entry>Todas as mudanças na área de trabalho do fornecedor do repositório src Subversion</entry>
	    </row>
	  </tbody>
	</tgroup>
      </informaltable>
    </sect2>

    <sect2 xml:id="eresources-subscribe">
      <title>Como se inscrever</title>

      <para>Para se inscrever em uma lista, clique no nome da lista em <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo">http://lists.FreeBSD.org/mailman/listinfo</link> . A página exibida deve conter todas as instruções de inscrição necessárias para essa lista.</para>

      <para>Para realmente postar em uma determinada lista, envie um email para <email><replaceable>listname</replaceable>@FreeBSD.org</email>. Ele será então redistribuído para membros da lista de discussão em todo o mundo.</para>

      <para>Para cancelar a inscrição em uma lista, clique no URL encontrado na parte inferior de todos os e-mails recebidos da lista. Também é possível enviar um email para <email><replaceable>listname</replaceable>-unsubscribe@FreeBSD.org</email> para cancelar a inscrição.</para>

      <para>É importante manter a discussão nas listas de discussão técnicas em uma trilha técnica. Para receber apenas os anúncios importantes, junte-se à <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-announce"> lista de discussão de anúncios do FreeBSD</link>, que é destinada a tráfego pouco frequente .</para>
    </sect2>

    <sect2 xml:id="eresources-charters">
      <title>Estatutos das Listas</title>

      <para><emphasis>Todas</emphasis> as listas de discussão do FreeBSD possuem certas regras básicas que devem ser seguidas por qualquer pessoa que as utilize. O não cumprimento destas diretrizes resultará em dois (2) avisos escritos do Postmaster do FreeBSD <email>postmaster@FreeBSD.org</email>, após o que, em uma terceira ofensa, o usuário será removido de todas as listas de discussão do FreeBSD e filtrados de postagem posterior para elas. Lamentamos que tais regras e medidas sejam absolutamente necessárias, mas a Internet de hoje é um ambiente bastante hostil, ao que parece, e muitos não conseguem perceber o quão frágeis são alguns de seus mecanismos.</para>

      <para>Regras Básicas:</para>

      <itemizedlist>
	<listitem>
	  <para>O tópico de qualquer postagem deve estar de acordo com o regulamento básico da lista para a qual ele é postado. Se a lista for sobre questões técnicas, a mensagem deve conter discussão técnica. Conversa irrelevante em curso ou provocações apenas prejudicam o valor da lista de discussão para todos e não será tolerado. Para discussões de forma livre sobre um tópico em particular, a <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-chat"> lista de discussão do chat do FreeBSD</link> está disponível gratuitamente e deve ser usada para isso.</para>
	</listitem>

	<listitem>
	  <para>Nenhuma postagem deve ser feita para mais de 2 listas de discussão, e apenas para 2 quando houver necessidade clara e óbvia de postar nas duas listas. Para a maioria das listas, já existe uma grande quantidade de sobreposições de assinantes e, exceto pelas mixagens mais esotéricas (digamos <quote> -stable &amp; -scsi </quote>), não há motivo para postar em mais de uma lista ao mesmo tempo. Se uma mensagem for recebida com várias listas de discussão na linha <literal>Cc</literal>, ajuste a linha <literal>Cc</literal> antes de responder. <emphasis>A pessoa que responde ainda é responsável por postagens cruzadas, independentemente de quem tenha sido o remetente. </emphasis></para>
	</listitem>

	<listitem>
	  <para>Ataques pessoais e palavrões (no contexto de um argumento) não são permitidos, e isso inclui usuários e desenvolvedores. Violações brutais da netiqueta, como a extração ou repostagem de correspondência privada quando a permissão para fazer isso não existe, são desaprovadas, mas não especificamente forçadas. <emphasis>No entanto</emphasis>, também existem muito poucos casos em que tal conteúdo se encaixaria no estatuto de uma lista e, portanto, provavelmente ele geraria uma advertência (ou proibição).</para>
	</listitem>

	<listitem>
	  <para>A publicidade de produtos ou serviços não relacionados ao FreeBSD é estritamente proibida e resultará em uma proibição imediata se for claro que o ofensor está anunciando por spam.</para>
	</listitem>
      </itemizedlist>

      <para><emphasis>Estatutos individuais das listas:</emphasis></para>

      <variablelist>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi">freebsd-acpi</link></term>

	  <listitem>
	    <para><emphasis> ACPI e desenvolvimento de gestão de energia </emphasis></para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-announce">freebsd-announce</link></term>

	  <listitem>
	    <para><emphasis> Eventos / marcos importantes </emphasis></para>

	    <para>Esta é a lista de discussão para pessoas interessadas apenas em anúncios ocasionais de eventos significativos do FreeBSD. Isso inclui anúncios sobre snapshots e outros releases. Ela contém anúncios de novos recursos do FreeBSD. Pode conter chamadas para voluntários, etc. Esta é uma lista de discussão de baixo volume, estritamente moderada.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-arch">freebsd-arch</link></term>

	  <listitem>
	    <para><emphasis> Discussão sobre arquitetura e design </emphasis></para>

	    <para>Esta lista é para discussão da arquitetura do FreeBSD. As mensagens serão principalmente mantidas estritamente de natureza técnica. Exemplos de tópicos adequados são:</para>

	    <itemizedlist>
	      <listitem>
		<para>Como fazer um re-vamp do sistema de compilação para ter várias compilações personalizadas em execução ao mesmo tempo.</para>
	      </listitem>

	      <listitem>
		<para>O que precisa ser corrigido com o VFS para fazer com que as camadas Heidemann funcionem.</para>
	      </listitem>

	      <listitem>
		<para>Como podemos mudar a interface do driver de dispositivo para poder usar os mesmos drivers de forma limpa em muitos barramentos e arquiteturas.</para>
	      </listitem>

	      <listitem>
		<para>Como escrever um driver de rede.</para>
	      </listitem>
	    </itemizedlist>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-bluetooth">freebsd-bluetooth</link></term>

	  <listitem>
	    <para><emphasis> <trademark class="registered"> Bluetooth </trademark> no FreeBSD </emphasis></para>

	    <para>Este é o fórum onde os usuários de <trademark class="registered">Bluetooth</trademark> no FreeBSD se reúnem. Problemas de design, detalhes de implementação, patches, relatórios de bugs, relatórios de status, solicitações de recursos e todos os assuntos relacionados a <trademark class="registered"> Bluetooth </trademark> são bem vindos.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-bugbusters">freebsd-bugbusters</link></term>

	  <listitem>
	    <para><emphasis> Coordenação sobre o esforço de manuseio dos Relatórios de Problemas </emphasis></para>

	    <para>O objetivo desta lista é servir como um fórum de coordenação e discussão para o Bugmeister, seus Bugbusters e quaisquer outras partes que tenham interesse genuíno no banco de dados de RP. Esta lista não é para discussões sobre bugs específicos, patches ou PRs.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-bugs">freebsd-bugs</link></term>

	  <listitem>
	    <para><emphasis> Relatórios de bugs </emphasis></para>

	    <para>Esta é a lista de discussão para reportar bugs no FreeBSD. Sempre que possível, os bugs devem ser submetidos usando a <link xlink:href="https://bugs.freebsd.org/bugzilla/enter_bug.cgi"> interface web </link>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-chat">freebsd-chat</link></term>

	  <listitem>
	    <para><emphasis> Itens não técnicos relacionados à comunidade FreeBSD </emphasis></para>

	    <para>Esta lista contém o overflow de outras listas sobre informações sociais não técnicas. Ela inclui discussões sobre se Jordan se parece com um furão ou não, se deve ou não digitar em maiúsculas, quem está tomando muito café, onde a melhor cerveja é preparada, quem está fazendo cerveja no porão, e assim por diante. Anúncios ocasionais de eventos importantes (como festas, casamentos, nascimentos, novos empregos, etc) podem ser feitos para as listas técnicas, mas os acompanhamentos devem ser direcionados para esta lista de bate-papo.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-chromium">freebsd-chromium</link></term>

	  <listitem>
	    <para><emphasis> Questões específicas sobre o Chromium no FreeBSD </emphasis></para>

	    <para>Esta é uma lista para a discussão do suporte ao Chromium no FreeBSD. Esta é uma lista técnica para discutir o desenvolvimento e a instalação do Chromium.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-cloud">freebsd-cloud</link></term>

	  <listitem>
	    <para><emphasis> Executando o FreeBSD em várias plataformas de nuvem </emphasis></para>

	    <para>Esta lista discute a execução do FreeBSD no Amazon EC2, no Google Compute Engine, no Microsoft Azure e em outras plataformas de computação em nuvem.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>freebsd-core</term>

	  <listitem>
	    <para><emphasis>FreeBSD core team</emphasis></para>

	    <para>Esta é uma lista de discussão interna para uso pelos membros do core team. Mensagens podem ser enviadas quando um assunto sério relacionado ao FreeBSD requer arbitragem ou escrutínio de alto nível.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current">freebsd-current</link></term>

	  <listitem>
	    <para><emphasis>Discussões sobre o uso do FreeBSD-CURRENT</emphasis></para>

	    <para>Esta é a lista de discussão para usuários do FreeBSD-CURRENT. Ela inclui avisos sobre novos recursos que estão sendo lançados no -CURRENT que afetarão os usuários e instruções sobre as etapas que devem ser seguidas para permanecer no -CURRENT. Qualquer um que esteja executando o <quote>CURRENT</quote> deve se inscrever nesta lista. Esta é uma lista de discussão técnica para a qual é esperado conteúdo estritamente técnico.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-desktop">freebsd-desktop</link></term>

	  <listitem>
	    <para><emphasis>Usando e melhorando o FreeBSD no desktop</emphasis></para>

	    <para>Este é um fórum para discussão do FreeBSD no desktop. É principalmente um lugar para portadores de desktop e usuários discutirem problemas e melhorarem o suporte do FreeBSD para desktops.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/dev-ci">dev-ci</link></term>
	  <listitem>
	    <para><emphasis>Coordenação do Relatório de Problemas sobre o esforço de manuseio</emphasis></para>

	    <para>Todos os relatórios de integração contínua, resultados de compilação e testes</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/dev-reviews">dev-reviews</link></term>
	  <listitem>
	    <para><emphasis>Notificações do trabalho em andamento na ferramenta de revisão do FreeBSD</emphasis></para>

	    <para>Notificações automatizadas de trabalhos em andamento para revisão nas ferramentas de revisão do FreeBSD, incluindo patches.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-doc">freebsd-doc</link></term>

	  <listitem>
	    <para><emphasis>Projeto de Documentação</emphasis></para>

	    <para>Esta lista de discussão é para a discussão de questões e projetos relacionados à criação de documentação para o FreeBSD. Os membros desta lista são coletivamente referidos como <quote>The FreeBSD Documentation Project</quote>. É uma lista aberta; sinta-se à vontade para participar e contribuir!</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-drivers">freebsd-drivers</link></term>

	  <listitem>
	    <para><emphasis>Escrevendo drivers de dispositivos para o FreeBSD</emphasis></para>

	    <para>Este é um fórum para discussões técnicas relacionadas a drivers de dispositivos no FreeBSD. É principalmente um lugar para os criadores de drivers de dispositivo fazerem perguntas sobre como escreverem drivers de dispositivo usando as APIs no kernel do FreeBSD.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-dtrace">freebsd-dtrace</link></term>

	  <listitem>
	    <para><emphasis>Usando e trabalhando no DTrace no FreeBSD</emphasis></para>

	    <para>O DTrace é um componente integrado do FreeBSD que fornece uma estrutura para entender o kernel, bem como programas de espaço do usuário em tempo de execução. A lista de discussão é uma discussão arquivada para desenvolvedores do código, bem como aqueles que a usam.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-eclipse">freebsd-eclipse</link></term>

	  <listitem>
	    <para><emphasis>Usuários FreeBSD do IDE Eclipse, ferramentas, aplicativos e ports rich clients.</emphasis></para>

	    <para>A intenção desta lista é fornecer suporte mútuo para tudo relacionado com a escolha, instalação, uso, desenvolvimento e manutenção do IDE Eclipse, ferramentas, aplicativos rich client na plataforma FreeBSD e para assistência na portabilidade do IDE Eclipse e seus plugins para o ambiente FreeBSD.</para>

	    <para>A intenção é também facilitar a troca de informações entre a comunidade Eclipse e a comunidade FreeBSD para benefício mútuo de ambas.</para>

	    <para>Embora essa lista esteja focada principalmente nas necessidades dos usuários do Eclipse, ela também fornecerá um fórum para aqueles que gostariam de desenvolver aplicativos específicos para o FreeBSD usando o Framework do Eclipse.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-embedded">freebsd-embedded</link></term>

	  <listitem>
	    <para><emphasis>Usando o FreeBSD em aplicações embarcadas</emphasis></para>

	    <para>Esta lista discute tópicos relacionados ao uso do FreeBSD em sistemas embarcados. Esta é uma lista de discussão técnica para a qual é esperado conteúdo estritamente técnico. Para o propósito desta lista, os sistemas embarcados são aqueles dispositivos de computação que não são desktops e que geralmente servem a um único propósito, ao invés de serem ambientes de computação geral. Os exemplos incluem, mas não estão limitados a, todos os tipos de aparelhos telefônicos, equipamentos de rede, como roteadores, switches e PBXs, equipamentos de medição remota, PDAs, sistemas Point Of Sale e assim por diante.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-emulation">freebsd-emulation</link></term>

	  <listitem>
	    <para><emphasis>Emulação de outros sistemas como o Linux/<trademark class="registered">MS-DOS</trademark>/<trademark class="registered">Windows</trademark></emphasis></para>

	    <para>Este é um fórum para discussões técnicas relacionadas à execução no FreeBSD de programas escritos para outros sistemas operacionais.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-enlightenment">freebsd-enlightenment</link></term>

	  <listitem>
	    <para><emphasis>Enlightenment</emphasis></para>

	    <para>Discussões sobre o Ambiente de Desktop <application>Enlightenment</application> para sistemas FreeBSD. Esta é uma lista de discussão técnica para a qual é esperado conteúdo estritamente técnico.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-eol">freebsd-eol</link></term>

	  <listitem>
	    <para><emphasis>Suporte de pares para softwares relacionados ao FreeBSD que não são mais suportados pelo Projeto FreeBSD.</emphasis></para>

	    <para>Esta lista é para aqueles interessados em fornecer ou fazer uso de suporte de software relacionado ao FreeBSD para o qual o Projeto FreeBSD não fornece mais suporte oficial na forma de avisos e patches de segurança.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-firewire">freebsd-firewire</link></term>

	  <listitem>
	    <para><emphasis><trademark class="registered">FireWire</trademark> (iLink, IEEE 1394)</emphasis></para>

	    <para>Esta é uma lista para discussão do design e implementação de um subsistema <trademark class="registered">FireWire</trademark> (também conhecido como IEEE 1394 aka iLink) para o FreeBSD. Tópicos relevantes incluem especificamente os padrões, dispositivos de barramento e seus protocolos, placas adaptadoras / placas / chips sets e a arquitetura e implementação de código para seu suporte adequado.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-fortran">freebsd-fortran</link></term>

	  <listitem>
	    <para><emphasis>Fortran no FreeBSD</emphasis></para>

	    <para>Esta é a lista para discussão de ports relacionados ao Fortran no FreeBSD: compiladores, bibliotecas, aplicativos científicos e de engenharia, de laptops a clusters de HPC.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-fs">freebsd-fs</link></term>

	  <listitem>
	    <para><emphasis>Sistemas de arquivos</emphasis></para>

	    <para>Discussões sobre os sistemas de arquivos do FreeBSD. Esta é uma lista de discussão técnica para a qual é esperado conteúdo estritamente técnico.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-games">freebsd-games</link></term>

	  <listitem>
	    <para><emphasis>Jogos no FreeBSD</emphasis></para>

	    <para>Esta é uma lista técnica para discussões relacionadas a trazer jogos para o FreeBSD. É para indivíduos trabalhando ativamente em portar jogos para o FreeBSD, para trazer problemas ou discutir soluções alternativas. Indivíduos interessados em acompanhar a discussão técnica também são bem vindos.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-gecko">freebsd-gecko</link></term>

	  <listitem>
	    <para><emphasis>Motor Gecko de Renderização</emphasis></para>

	    <para>Este é um fórum sobre aplicativos <application>Gecko</application> usando o FreeBSD.</para>

	    <para>Discussão em torno dos Ports dos aplicativos Gecko, sua instalação, seu desenvolvimento e seu suporte dentro do FreeBSD.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-geom">freebsd-geom</link></term>

	  <listitem>
	    <para><emphasis>GEOM</emphasis></para>

	    <para>Discussões específicas sobre o GEOM e implementações relacionadas. Esta é uma lista de discussão técnica para a qual é esperado conteúdo estritamente técnico.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-git">freebsd-git</link></term>

	  <listitem>
	    <para><emphasis> Uso do git no projeto FreeBSD </emphasis></para>

	    <para>Discussões sobre como usar o git na infra-estrutura do FreeBSD, incluindo o espelho do github e outros usos do git para colaboração no projeto. Área de discussão para pessoas usando o git no espelho do FreeBSD no github. Pessoas que querem começar com o espelho ou o git em geral no FreeBSD podem fazer perguntas aqui.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-gnome">freebsd-gnome</link></term>

	  <listitem>
	    <para><emphasis>GNOME</emphasis></para>

	    <para>Discussões relativas ao ambiente de trabalho <application>GNOME</application> para sistemas FreeBSD. Esta é uma lista de discussão técnica para a qual é esperado conteúdo estritamente técnico.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-infiniband">freebsd-infiniband</link></term>

	  <listitem>
	    <para><emphasis>Infiniband no FreeBSD</emphasis></para>

	    <para>Lista técnica para discutir Infiniband, OFED e OpenSM no FreeBSD.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ipfw">freebsd-ipfw</link></term>

	  <listitem>
	    <para><emphasis>Firewall IP</emphasis></para>

	    <para>Este é o fórum para discussões técnicas sobre o redesenho do código de firewall IP no FreeBSD. Esta é uma lista de discussão técnica para a qual é esperado conteúdo estritamente técnico.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-isdn">freebsd-isdn</link></term>

	  <listitem>
	    <para><emphasis>Comunicações ISDN</emphasis></para>

	    <para>Esta é a lista de discussão para pessoas discutindo o desenvolvimento do suporte a ISDN para o FreeBSD.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-java">freebsd-java</link></term>

	  <listitem>
	    <para><emphasis>Desenvolvimento <trademark>Java</trademark></emphasis></para>

	    <para>Esta é a lista de discussão para as pessoas que discutem o desenvolvimento de aplicações <trademark>Java</trademark> para o FreeBSD e a portabilidade e manutenção de <trademark>JDK</trademark>s.</para>
	  </listitem>
	</varlistentry>

	<varlistentry xml:id="eresources-charters-jobs">
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-jobs">freebsd-jobs</link></term>

	  <listitem>
	    <para><emphasis>Ofertas e Procura de Emprego</emphasis></para>

	    <para>Este é um fórum para postar avisos de emprego especificamente relacionados ao FreeBSD e currículos daqueles que buscam emprego relacionado ao FreeBSD. Esta <emphasis>não</emphasis> é uma lista de discussão para questões gerais de emprego, já que fóruns adequados para isso já existem em outros lugares.</para>

	    <para>Note que esta lista, como as demais listas de discussão do <systemitem class="fqdomainname">FreeBSD.org</systemitem>, é distribuída em todo o mundo. Seja claro sobre a localização geográfica e até que ponto o trabalho remoto ou a assistência à realocação estão disponíveis.</para>

	    <para>O email deve usar somente formatos abertos - preferencialmente texto puro, mas o formato básico de documento portátil (<acronym>PDF</acronym>), HTML e alguns outros são aceitáveis para muitos leitores. Formatos fechados como <trademark class="registered">Microsoft</trademark> Word (<filename>.doc</filename>) serão rejeitados pelo servidor da lista de discussão.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="https://mail.kde.org/mailman/listinfo/kde-freebsd">freebsd-kde</link></term>

	  <listitem>
	    <para><emphasis>KDE</emphasis></para>

	    <para>Discussões sobre o <application>KDE</application> em sistemas FreeBSD. Esta é uma lista de discussão técnica para a qual é esperado conteúdo estritamente técnico.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hackers">freebsd-hackers</link></term>

	  <listitem>
	    <para><emphasis>Discussões técnicas</emphasis></para>

	    <para>Este é um fórum para discussões técnicas relacionadas ao FreeBSD. Esta é a principal lista de discussão técnica. É para indivíduos trabalhando ativamente no FreeBSD, para trazer problemas ou discutir soluções alternativas. Indivíduos interessados em acompanhar a discussão técnica também são bem vindos. Esta é uma lista de discussão técnica para a qual é esperado conteúdo estritamente técnico.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hardware">freebsd-hardware</link></term>

	  <listitem>
	    <para><emphasis>Discussão geral sobre hardware no FreeBSD</emphasis></para>

	    <para>Discussão geral sobre os tipos de hardware em que o FreeBSD executa, vários problemas e sugestões sobre o que comprar ou evitar.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hubs">freebsd-hubs</link></term>

	  <listitem>
	    <para><emphasis>Sites Espelhos</emphasis></para>

	    <para>Anúncios e discussões para pessoas que executam sites espelho do FreeBSD.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-isp">freebsd-isp</link></term>

	  <listitem>
	    <para><emphasis>Problemas para provedores de serviços de Internet</emphasis></para>

	    <para>Esta lista de discussão é para discutir tópicos relevantes para provedores de serviços de Internet (ISPs) usando o FreeBSD. Esta é uma lista de discussão técnica para a qual é esperado conteúdo estritamente técnico.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-mono">freebsd-mono</link></term>

	  <listitem>
	    <para><emphasis>Aplicações Mono e C# no FreeBSD</emphasis></para>

	    <para>Esta é uma lista de discussões relacionadas ao framework de desenvolvimento Mono no FreeBSD. Esta é uma lista de discussão técnica. É para indivíduos trabalhando ativamente na portabilidade de aplicativos Mono ou C# para o FreeBSD, para trazer problemas ou discutir soluções alternativas. Indivíduos interessados em acompanhar a discussão técnica também são bem vindos.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ocaml">freebsd-ocaml</link></term>

	  <listitem>
	    <para><emphasis>Discussões específicas sobre OCaml no FreeBSD</emphasis></para>

	    <para>Esta é uma lista para discussões relacionadas ao suporte OCaml no FreeBSD. Esta é uma lista de discussão técnica. É para pessoas que trabalham com ports OCaml, bibliotecas de terceiros e frameworks. Indivíduos interessados na discussão técnica também são bem vindos.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-office">freebsd-office</link></term>

	  <listitem>
	    <para><emphasis>Aplicativos de Escritório no FreeBSD</emphasis></para>

	    <para>Discussão em torno de aplicativos de escritório, sua instalação, seu desenvolvimento e seu suporte dentro do FreeBSD.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ops-announce">freebsd-ops-announce</link></term>

	  <listitem>
	    <para><emphasis>Anúncios de infra-estrutura do projeto</emphasis></para>

	    <para>Esta é a lista de discussão para pessoas interessadas em mudanças e questões relacionadas à infra-estrutura do Projeto FreeBSD.org.</para>

	    <para>Esta lista moderada é estritamente para anúncios: sem respostas, pedidos, discussões ou opiniões.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-performance">freebsd-performance</link></term>

	  <listitem>
	    <para><emphasis>Discussões sobre o tunning ou aceleração do FreeBSD</emphasis></para>

	    <para>Esta lista de discussão existe para fornecer um local para hackers, administradores e/ou partes interessadas discutirem tópicos relacionados ao desempenho do FreeBSD. Temas aceitáveis incluem falar sobre instalações do FreeBSD que estão sob alta carga, que estão tendo problemas de desempenho ou que estão forçando os limites do FreeBSD. Partes interessadas que estejam dispostas a trabalhar para melhorar o desempenho do FreeBSD são altamente encorajadas a assinar esta lista. Esta é uma lista altamente técnica destinada para usuários experientes do FreeBSD, hackers ou administradores interessados em manter o FreeBSD rápido, robusto e escalável. Essa lista não é uma lista de perguntas e respostas que substitui a leitura da documentação, mas é um local para fazer contribuições ou perguntar sobre tópicos não respondidos relacionados ao desempenho.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pf">freebsd-pf</link></term>

	  <listitem>
	    <para><emphasis>Discussão sobre o sistema de firewall de filtro de pacotes</emphasis></para>

	    <para>Discussão sobre o sistema de firewall de filtro de pacotes (pf) no FreeBSD. A discussão técnica e as perguntas dos usuários são bem-vindas. Esta lista também é um lugar para discutir o framework ALTQ QoS.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pkg">freebsd-pkg</link></term>

	  <listitem>
	    <para><emphasis>Discussão sobre o gerenciamento de pacotes binários e as ferramentas de pacotes</emphasis></para>

	    <para>Discussão de todos os aspectos de gerenciamento de sistemas FreeBSD usando pacotes binários para instalar software, incluindo toolkits e formatos de pacotes binários, seu desenvolvimento e suporte dentro do FreeBSD, gerenciamento de repositórios de pacotes e pacotes de terceiros.</para>

	    <para>Observe que a discussão de ports que não conseguem gerar pacotes corretamente geralmente deve ser considerada como um problema do port e, portanto, é inadequada para essa lista.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pkg-fallout">freebsd-pkg-fallout</link></term>

	  <listitem>
	    <para><emphasis> Registros de fallout da construção de pacotes </emphasis></para>

	    <para>Todos os logs de falha na compilação de pacotes nos clusters de compilação de pacotes</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pkgbase">freebsd-pkgbase</link></term>

	  <listitem>
	    <para><emphasis>Empacotando do sistema básico do FreeBSD.</emphasis></para>

	    <para>Discussões sobre a implementação e questões relacionadas ao empacotamento do sistema base do FreeBSD.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-platforms">freebsd-platforms</link></term>

	  <listitem>
	    <para><emphasis>Portando para plataformas não <trademark class="registered">Intel</trademark></emphasis></para>

	    <para>Problemas de plataforma cruzada do FreeBSD, discussão geral e propostas para ports do FreeBSD para plataformas não <trademark class="registered">Intel</trademark>. Esta é uma lista de discussão técnica para a qual é esperado conteúdo estritamente técnico.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports">freebsd-ports</link></term>

	  <listitem>
	    <para><emphasis>Discussão dos <quote>ports</quote></emphasis></para>

	    <para>Discussões relativas à coleção de <quote>ports</quote> (<filename>/usr/ports</filename>) do FreeBSD, infra-estrutura de ports e esforços gerais de coordenação de ports. Esta é uma lista de discussão técnica para a qual é esperado conteúdo estritamente técnico.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports-announce">freebsd-ports-announce</link></term>

	  <listitem>
	    <para><emphasis>Notícias e instruções importantes sobre a <quote>Coleção de Ports</quote> do FreeBSD</emphasis></para>

	    <para>Notícias importantes para desenvolvedores, porters e usuários da <quote>Coleção de Ports</quote> (<filename>/usr/ports</filename>), incluindo alterações de arquitetura / infraestrutura, novos recursos, instruções críticas de upgrade e informações sobre a engenharia de releases. Esta é uma lista de discussão de baixo volume, destinada a anúncios.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports-bugs">freebsd-ports-bugs</link></term>

	  <listitem>
	    <para><emphasis>Discussão de bugs dos <quote>ports</quote></emphasis></para>

	    <para>Discussões sobre relatórios de problemas para a <quote>coleção de ports</quote> do FreeBSD (<filename>/usr/ports</filename>), ports propostos ou modificações nos ports. Esta é uma lista de discussão técnica para a qual é esperado conteúdo estritamente técnico.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-proliant">freebsd-proliant</link></term>

	  <listitem>
	    <para><emphasis> Discussão técnica do FreeBSD nas plataformas de servidores HP ProLiant </emphasis></para>

	    <para>Esta lista de discussão deve ser usada para a discussão técnica do uso do FreeBSD em servidores HP ProLiant, incluindo a discussão de drivers específicos do ProLiant, software de gerenciamento, ferramentas de configuração e atualizações do BIOS. Como tal, este é o principal local para discutir os módulos hpasmd, hpasmcli e hpacucli.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-python">freebsd-python</link></term>

	  <listitem>
	    <para><emphasis> Python no FreeBSD </emphasis></para>

	    <para>Esta é uma lista de discussões relacionadas à melhoria do suporte ao Python no FreeBSD. Esta é uma lista de discussão técnica. É para indivíduos que estão trabalhando na portabilidade do Python, seus módulos de terceiros e coisas do <application>Zope</application> para o FreeBSD. Indivíduos interessados em acompanhar a discussão técnica também são bem vindos.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions">freebsd-questions</link></term>

	  <listitem>
	    <para><emphasis>Questões do usuário</emphasis></para>

	    <para>Esta é a lista de discussão para questões sobre o FreeBSD. Não envie perguntas do tipo <quote>how to</quote> para as listas técnicas, a menos que a questão seja bastante técnica.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ruby">freebsd-ruby</link></term>

	  <listitem>
	    <para><emphasis>Discussões sobre Ruby específicas para o FreeBSD</emphasis></para>

	    <para>Esta é uma lista para discussões relacionadas ao suporte Ruby no FreeBSD. Esta é uma lista de discussão técnica. É para pessoas que trabalham com ports Ruby, bibliotecas de terceiros e frameworks.</para>

	    <para>Indivíduos interessados na discussão técnica também são bem vindos.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-scsi">freebsd-scsi</link></term>

	  <listitem>
	    <para><emphasis>Subsistema SCSI</emphasis></para>

	    <para>Esta é a lista de discussão para pessoas que trabalham no subsistema SCSI do FreeBSD. Esta é uma lista de discussão técnica para a qual é esperado conteúdo estritamente técnico.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-security">freebsd-security</link></term>

	  <listitem>
	    <para><emphasis> Questões de segurança </emphasis></para>

	    <para>Problemas de segurança do FreeBSD (DES, Kerberos, falhas de segurança conhecidas e correções, etc). Esta é uma lista de discussão técnica para a qual se espera uma discussão estritamente técnica. Note que esta não é uma lista de perguntas e respostas, mas as contribuições (ambas as perguntas e respostas) para o FAQ são bem-vindas.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-security-notifications">freebsd-security-notifications</link></term>

	  <listitem>
	    <para><emphasis> Notificações de segurança </emphasis></para>

	    <para>Notificações de problemas de segurança e correções do FreeBSD. Esta não é uma lista de discussão. A lista de discussão é a FreeBSD-security.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-snapshots">freebsd-snapshots</link></term>

	  <listitem>
	    <para><emphasis> Anúncios de Snapshots de Desenvolvimento do FreeBSD </emphasis></para>

	    <para>Esta lista fornece notificações sobre a disponibilidade de novos snapshots de desenvolvimento do FreeBSD para head/ e stable/ branches.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-stable">freebsd-stable</link></term>

	  <listitem>
	    <para><emphasis> Discussões sobre o uso do FreeBSD-STABLE </emphasis></para>

	    <para>Esta é a lista de discussão para usuários do FreeBSD-STABLE. O <quote>STABLE</quote> é o ramo onde o desenvolvimento continua depois de um RELEASE, incluindo correções de bugs e novos recursos. O ABI é mantido estável para compatibilidade binária. Ela inclui avisos sobre novos recursos que estarão sendo incorporados no -STABLE e que afetarão os usuários e instruções sobre as etapas que devem ser seguidas para permanecer -STABLE. Qualquer um que esteja executando o <quote>STABLE</quote> deve assinar esta lista. Esta é uma lista de discussão técnica para a qual é esperado conteúdo estritamente técnico.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-standards">freebsd-standards</link></term>

	  <listitem>
	    <para><emphasis> Conformidade  C99 &amp; POSIX </emphasis></para>

	    <para>Este é um fórum para discussões técnicas relacionadas à Conformidade do FreeBSD com os padrões C99 e POSIX.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-teaching">freebsd-teaching</link></term>

	  <listitem>
	    <para><emphasis> Ensinando com o FreeBSD </emphasis></para>

	    <para>Lista de discussão não técnica para discutir o ensino com o FreeBSD.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-testing">freebsd-testing</link></term>

	  <listitem>
	    <para><emphasis>Testando no FreeBSD</emphasis></para>

	    <para>Lista de discussão técnica discutindo testes no FreeBSD, incluindo ATF/Kyua, infraestrutura de testes, testes de port para o FreeBSD de outros sistemas operacionais (NetBSD, ...), etc.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-tex">freebsd-tex</link></term>

	  <listitem>
	    <para><emphasis> Portando o <application>TeX</application> e seus aplicativos para o FreeBSD</emphasis></para>

	    <para>Esta é uma lista de discussão técnica para discussões relacionadas ao TeX e suas aplicações no FreeBSD. É destinada aos indivíduos que estão trabalhando ativamente na portabilidade do TeX para o FreeBSD, para trazer problemas ou discutir soluções alternativas. Indivíduos interessados em acompanhar a discussão técnica também são bem vindos.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-toolchain">freebsd-toolchain</link></term>

	  <listitem>
	    <para><emphasis> Manutenção do toolchain integrado do FreeBSD </emphasis></para>

	    <para>Esta é a lista para discussões relacionadas à manutenção do conjunto de ferramentas fornecido com o FreeBSD. Isso pode incluir o estado do Clang e do GCC, mas também partes de software, como assemblers, vinculadores e depuradores.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-transport">freebsd-transport</link></term>

	  <listitem>
	    <para><emphasis> Discussões de protocolos de rede em nível de transporte no FreeBSD </emphasis></para>

	    <para>A lista de discussão de transporte existe para a discussão de problemas e projetos em torno dos protocolos de nível de transporte na pilha de rede do FreeBSD, incluindo TCP, SCTP e UDP. Outros tópicos de rede, incluindo questões específicas de driver e protocolos de rede, devem ser discutidos na <link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-net">lista de discussão FreeBSD networking</link> .</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-translators">freebsd-translators</link></term>

	  <listitem>
	    <para><emphasis> Traduzindo documentos e programas do FreeBSD </emphasis></para>

	    <para>Uma lista de discussão em que tradutores de documentos do FreeBSD do inglês para outros idiomas podem falar sobre métodos e ferramentas de tradução. Novos membros são convidados a se apresentar e mencionar os idiomas em que estão interessados em traduzir.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-usb">freebsd-usb</link></term>

	  <listitem>
	    <para><emphasis> Discutindo o suporte do FreeBSD para USB </emphasis></para>

	    <para>Esta é uma lista de discussão para discussões técnicas relacionadas ao suporte do FreeBSD para USB.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-user-groups">freebsd-user-groups</link></term>

	  <listitem>
	    <para><emphasis> Lista de Coordenação do Grupo de Usuários </emphasis></para>

	    <para>Esta é a lista de discussão dos coordenadores de cada um dos Grupos de Usuários da área local para discutir assuntos entre si e um indivíduo designado do Core Team. Essa lista de e-mail deve se limitar a atender a sinopse e a coordenação de projetos que abranjam Grupos de usuários.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-virtualization">freebsd-virtualization</link></term>

	  <listitem>
	    <para><emphasis> Discussão de várias técnicas de virtualização suportadas pelo FreeBSD </emphasis></para>

	    <para>Uma lista para discutir as várias técnicas de virtualização suportadas pelo FreeBSD. Por um lado, o foco estará na implementação da funcionalidade básica, bem como na adição de novos recursos. Por outro lado, os usuários terão um fórum para pedir ajuda em caso de problemas ou para discutir seus casos de uso.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-wip-status">freebsd-wip-status</link></term>

	  <listitem>
	    <para><emphasis> Status do andamento do trabalho no FreeBSD </emphasis></para>

	    <para>Esta lista de discussão pode ser usada pelos desenvolvedores para anunciar a criação e o progresso do trabalho relacionado ao FreeBSD. As mensagens serão moderadas. Sugere-se enviar a mensagem "Para:" uma lista mais atual do FreeBSD e apenas "BCC:" esta lista. Dessa forma, o WIP também pode ser discutido na lista de tópicos, já que nenhuma discussão é permitida nesta lista.</para>

	    <para>Olhe dentro dos arquivos para exemplos de mensagens adequadas.</para>

	    <para>Um resumo editorial das mensagens para esta lista pode ser postado no site do FreeBSD todos os meses como parte dos Relatórios de Status <footnote><para><uri xlink:href="https://www.freebsd.org/news/status/">https://www.freebsd.org/news/status/</uri></para></footnote>. Relatórios anteriores são arquivados.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-wireless">freebsd-wireless</link></term>

	  <listitem>
	    <para><emphasis> Discussões da pilha 802.11, desenvolvimento de driver de dispositivo de ferramentas </emphasis></para>

	    <para>A lista FreeBSD-wireless se concentra na pilha 802.11 (sys/net80211), no driver do dispositivo e no desenvolvimento de ferramentas. Isso inclui bugs, novos recursos e manutenção.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-xen">freebsd-xen</link></term>

	  <listitem>
	    <para><emphasis>Discussão do port do FreeBSD para <trademark> Xen </trademark> - implementação e uso </emphasis></para>

	    <para>Uma lista focada no port do <trademark>Xen</trademark> para o FreeBSD. O nível de tráfego previsto é pequeno o suficiente para servir como um fórum para discussões técnicas sobre os detalhes de implementação e design, bem como problemas administrativos de implantação.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-xfce">freebsd-xfce</link></term>

	  <listitem>
	    <para><emphasis>XFCE</emphasis></para>

	    <para>Este é um fórum para discussões relacionadas a trazer o ambiente <application>XFCE</application> para o FreeBSD. Esta é uma lista de discussão técnica. É para indivíduos que trabalham ativamente portando o <application>XFCE</application> para o FreeBSD, para trazer problemas ou discutir soluções alternativas. Indivíduos interessados em acompanhar a discussão técnica também são bem vindos.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><link xlink:href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-zope">freebsd-zope</link></term>

	  <listitem>
	    <para><emphasis>Zope</emphasis></para>

	    <para>Este é um fórum para discussões relacionadas a trazer o ambiente <application>Zope</application> para o FreeBSD. Esta é uma lista de discussão técnica. É para indivíduos que trabalham ativamente portando o <application>Zope</application> para o FreeBSD, para trazer problemas ou discutir soluções alternativas. Indivíduos interessados em acompanhar a discussão técnica também são bem vindos.</para>
	  </listitem>
	</varlistentry>
      </variablelist>
    </sect2>

    <sect2 xml:id="eresources-mailfiltering">
      <title>Filtros nas Listas de Discussão</title>

      <para>As listas de discussão do FreeBSD são filtradas de várias maneiras para evitar a distribuição de spam, vírus e outros e-mails indesejados. As ações de filtragem descritas nesta seção não incluem todas aquelas usadas para proteger as listas de discussão.</para>

      <para>Apenas determinados tipos de anexos são permitidos nas listas de discussão. Todos os anexos com um tipo de conteúdo MIME não encontrado na lista abaixo serão removidos antes que um email seja distribuído nas listas de discussão.</para>

      <itemizedlist>
	<listitem>
	  <para>application/octet-stream</para>
	</listitem>

	<listitem>
	  <para>application/pdf</para>
	</listitem>

	<listitem>
	  <para>application/pgp-signature</para>
	</listitem>

	<listitem>
	  <para>application/x-pkcs7-signature</para>
	</listitem>

	<listitem>
	  <para>message/rfc822</para>
	</listitem>

	<listitem>
	  <para>multipart/alternative</para>
	</listitem>

	<listitem>
	  <para>multipart/related</para>
	</listitem>

	<listitem>
	  <para>multipart/signed</para>
	</listitem>

	<listitem>
	  <para>text/html</para>
	</listitem>

	<listitem>
	  <para>text/plain</para>
	</listitem>

	<listitem>
	  <para>text/x-diff</para>
	</listitem>

	<listitem>
	  <para>text/x-patch</para>
	</listitem>
      </itemizedlist>

      <note>
	<para>Algumas das listas de discussão podem permitir anexos de outros tipos de conteúdo MIME, mas a lista acima deve ser aplicável para a maioria das listas de discussão.</para>
      </note>

      <para>Se um email contiver uma versão em HTML e uma em texto simples, a versão em HTML será removida. Se um email contiver somente uma versão em HTML, ele será convertido em texto simples.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="eresources-news">
    <title>Grupos de Notícias Usenet</title>

    <para>Além de dois grupos de noticias específicos sobre FreeBSD, existem muitos outros em que o FreeBSD é discutido ou que são relevantes para usuários do FreeBSD.</para>

    <sect2>
      <title>Grupos de notícias específicos do BSD</title>

      <itemizedlist>
	<listitem>
	  <para><link xlink:href="news:comp.unix.bsd.freebsd.announce">comp.unix.bsd.freebsd.announce</link></para>
	</listitem>

	<listitem>
	  <para><link xlink:href="news:comp.unix.bsd.freebsd.misc">comp.unix.bsd.freebsd.misc</link></para>
	</listitem>

	<listitem>
	  <para><link xlink:href="news:de.comp.os.unix.bsd">de.comp.os.unix.bsd</link> (German)</para>
	</listitem>

	<listitem>
	  <para><link xlink:href="news:fr.comp.os.bsd">fr.comp.os.bsd</link> (French)</para>
	</listitem>
      </itemizedlist>
    </sect2>

    <sect2>
      <title>Outros Newsgroups de interesse sobre <trademark class="registered">UNIX</trademark></title>

      <itemizedlist>
	<listitem>
	  <para><link xlink:href="news:comp.unix">comp.unix</link></para>
	</listitem>

	<listitem>
	  <para><link xlink:href="news:comp.unix.questions">comp.unix.questions</link></para>
	</listitem>

	<listitem>
	  <para><link xlink:href="news:comp.unix.admin">comp.unix.admin</link></para>
	</listitem>

	<listitem>
	  <para><link xlink:href="news:comp.unix.programmer">comp.unix.programmer</link></para>
	</listitem>

	<listitem>
	  <para><link xlink:href="news:comp.unix.shell">comp.unix.shell</link></para>
	</listitem>

	<listitem>
	  <para><link xlink:href="news:comp.unix.misc">comp.unix.misc</link></para>
	</listitem>

	<listitem>
	  <para><link xlink:href="news:comp.unix.bsd">comp.unix.bsd</link></para>
	</listitem>
      </itemizedlist>
    </sect2>

    <sect2>
      <title>X Window System</title>

      <itemizedlist>
	<listitem>
	  <para><link xlink:href="news:comp.windows.x">comp.windows.x</link></para>
	</listitem>
      </itemizedlist>
    </sect2>
  </sect1>

  <sect1 xml:id="eresources-web">
    <title>Espelhos Oficiais</title>

    
<para><link linkend="central-www">Servidores Centrais</link>, <link linkend="mirrors-am-www">Armenia</link>, <link linkend="mirrors-au-www">Australia</link>, <link linkend="mirrors-at-www">Austria</link>, <link linkend="mirrors-cz-www">Czech Republic</link>, <link linkend="mirrors-dk-www">Denmark</link>, <link linkend="mirrors-fi-www">Finland</link>, <link linkend="mirrors-fr-www">France</link>, <link linkend="mirrors-de-www">Germany</link>, <link linkend="mirrors-hk-www">Hong Kong</link>, <link linkend="mirrors-ie-www">Ireland</link>, <link linkend="mirrors-jp-www">Japan</link>, <link linkend="mirrors-lv-www">Latvia</link>, <link linkend="mirrors-lt-www">Lithuania</link>, <link linkend="mirrors-nl-www">Netherlands</link>, <link linkend="mirrors-no-www">Norway</link>, <link linkend="mirrors-ru-www">Russia</link>, <link linkend="mirrors-si-www">Slovenia</link>, <link linkend="mirrors-za-www">South Africa</link>, <link linkend="mirrors-es-www">Spain</link>, <link linkend="mirrors-se-www">Sweden</link>, <link linkend="mirrors-ch-www">Switzerland</link>, <link linkend="mirrors-tw-www">Taiwan</link>, <link linkend="mirrors-uk-www">United Kingdom</link>, <link linkend="mirrors-us-www">USA</link>.</para>


    
<para>(a partir de UTC)</para>


    
<itemizedlist>
  <listitem>
    <anchor xml:id="central-www"/>
    <para>Servidores Centrais</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="https://www.FreeBSD.org/">https://www.FreeBSD.org/</link></para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-am-www"/>
    <para>Armênia</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www1.am.FreeBSD.org/">http://www1.am.FreeBSD.org/</link> (IPv6)</para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-au-www"/>
    <para>Austrália</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.au.FreeBSD.org/">http://www.au.FreeBSD.org/</link></para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://www2.au.FreeBSD.org/">http://www2.au.FreeBSD.org/</link></para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-at-www"/>
    <para>Áustria</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.at.FreeBSD.org/">http://www.at.FreeBSD.org/</link> (IPv6)</para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-cz-www"/>
    <para>República Checa</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.cz.FreeBSD.org/">http://www.cz.FreeBSD.org/</link> (IPv6)</para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-dk-www"/>
    <para>Dinamarca</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.dk.FreeBSD.org/">http://www.dk.FreeBSD.org/</link> (IPv6)</para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-fi-www"/>
    <para>Finlândia</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.fi.FreeBSD.org/">http://www.fi.FreeBSD.org/</link></para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-fr-www"/>
    <para>França</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www1.fr.FreeBSD.org/">http://www1.fr.FreeBSD.org/</link></para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-de-www"/>
    <para>Alemanha</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.de.FreeBSD.org/">http://www.de.FreeBSD.org/</link></para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-hk-www"/>
    <para>Hong Kong</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.hk.FreeBSD.org/">http://www.hk.FreeBSD.org/</link></para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-ie-www"/>
    <para>Irlanda</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.ie.FreeBSD.org/">http://www.ie.FreeBSD.org/</link></para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-jp-www"/>
    <para>Japão</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.jp.FreeBSD.org/www.FreeBSD.org/">http://www.jp.FreeBSD.org/www.FreeBSD.org/</link> (IPv6)</para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-lv-www"/>
    <para>Letônia</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.lv.FreeBSD.org/">http://www.lv.FreeBSD.org/</link></para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-lt-www"/>
    <para>Lituânia</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.lt.FreeBSD.org/">http://www.lt.FreeBSD.org/</link></para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-nl-www"/>
    <para>Países Baixos</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.nl.FreeBSD.org/">http://www.nl.FreeBSD.org/</link></para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-no-www"/>
    <para>Noruega</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.no.FreeBSD.org/">http://www.no.FreeBSD.org/</link></para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-ru-www"/>
    <para>Rússia</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.ru.FreeBSD.org/">http://www.ru.FreeBSD.org/</link> (IPv6)</para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-si-www"/>
    <para>Eslovênia</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.si.FreeBSD.org/">http://www.si.FreeBSD.org/</link></para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-za-www"/>
    <para>África do Sul</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.za.FreeBSD.org/">http://www.za.FreeBSD.org/</link></para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-es-www"/>
    <para>Espanha</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.es.FreeBSD.org/">http://www.es.FreeBSD.org/</link></para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://www2.es.FreeBSD.org/">http://www2.es.FreeBSD.org/</link></para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-se-www"/>
    <para>Suécia</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.se.FreeBSD.org/">http://www.se.FreeBSD.org/</link></para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-ch-www"/>
    <para>Suíça</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.ch.FreeBSD.org/">http://www.ch.FreeBSD.org/</link> (IPv6)</para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://www2.ch.FreeBSD.org/">http://www2.ch.FreeBSD.org/</link> (IPv6)</para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-tw-www"/>
    <para>Taiwan</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www.tw.FreeBSD.org/">http://www.tw.FreeBSD.org/</link></para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://www2.tw.FreeBSD.org/">http://www2.tw.FreeBSD.org/</link></para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://www4.tw.FreeBSD.org/">http://www4.tw.FreeBSD.org/</link></para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://www5.tw.FreeBSD.org/">http://www5.tw.FreeBSD.org/</link> (IPv6)</para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-uk-www"/>
    <para>Reino Unido</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www1.uk.FreeBSD.org/">http://www1.uk.FreeBSD.org/</link></para>
      </listitem>
      <listitem>
        <para><link xlink:href="http://www3.uk.FreeBSD.org/">http://www3.uk.FreeBSD.org/</link></para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <anchor xml:id="mirrors-us-www"/>
    <para>EUA</para>
    <itemizedlist>
      <listitem>
        <para><link xlink:href="http://www5.us.FreeBSD.org/">http://www5.us.FreeBSD.org/</link> (IPv6)</para>
      </listitem>
    </itemizedlist>
  </listitem>
</itemizedlist>

  </sect1>
</appendix>

    
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<!--

  Do not edit this file except as instructed by the addkey.sh script.

  See the README file in head/share/pgpkeys for instructions.

  Note that only officer keys are shown here now.  All of the keys are
  shown in en_US.ISO8859-1/articles/pgpkeys/article.xml.

-->
<appendix version="5.0" xml:id="pgpkeys">
  <title>Chaves Open<acronym>PGP</acronym></title>

  <indexterm><primary>pgp keys</primary></indexterm>

  <para>As chaves Open<acronym>PGP</acronym> dos Administradores do <systemitem class="fqdomainname">FreeBSD.org</systemitem> são mostradas aqui. Essas chaves podem ser usadas para verificar uma assinatura ou para enviar um email criptografado para um dos administradores. A lista completa das chaves Open<acronym>PGP</acronym> do FreeBSD está disponível no artigo <link xlink:href="@@URL_RELPREFIX@@/doc/en_US.ISO8859-1/articles/pgpkeys">Chaves <acronym>PGP</acronym></link>. O keyring completo pode ser baixado em <link xlink:href="https://www.FreeBSD.org/doc/pgpkeyring.txt">https://www.FreeBSD.org/doc/pgpkeyring.txt</link> .</para>

  <sect1 xml:id="pgpkeys-officers">
    <title>Administradores</title>

    <!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->

    <sect2 xml:id="pgpkey-security-officer">
      <title>Security Officer Team <email>security-officer@FreeBSD.org</email></title>
      <!-- $FreeBSD$ -->
<!--
sh addkey.sh security-officer D39792F49EA7E5C2 ;
-->
<programlisting role="pgpfingerprint"><![CDATA[
pub   rsa4096/D39792F49EA7E5C2 2017-08-16 [SC] [expires: 2023-01-02]
      Key fingerprint = FC0E 878A E5AF E788 028D  6355 D397 92F4 9EA7 E5C2
uid                            FreeBSD Security Officer <security-officer@FreeBSD.org>
sub   rsa4096/6DD0A349F26ADEFD 2017-08-16 [E] [expires: 2023-01-02]

]]></programlisting>
<programlisting role="pgpkey"><![CDATA[
-----BEGIN PGP PUBLIC KEY BLOCK-----

mQINBFmT2+ABEACrTVJ7Z/MuDeyKFqoTFnm5FrGG55k66RLeKivzQzq/tT/6RKO9
K8DaEvSIqD9b0/xgK02KgLSdp0Bucq8HLDFYUk3McFa6Z3YwjobNCWkxc72ipvVl
uAOGN4H6fuoYOpeg4cLK1H9pktUIrzONTCixaZzc/Bu6X+aX4ywGeCfsuu8g5v03
fLCPBLLgf3Bm5wsyZ6ZaGmsmILrWzd+d/rbr35Mcc5BekdgywUI4R191qo1bdrw9
mEJP1V7Ik3jpExOsNnuhMTvm5OQMeCTfUvVEOtBU15QtbT+1LXF5FIOgML0LwS5v
RHZN+5w/xvzSnEULpj24UuMKLDs/u9rj8U/zET8QaE+oG7m/mr4jJWZEmdX8HKdO
WrpnVj6UAppk72qdBIEfLsOW2xB/NOjJpppbCQH3+sw7DRYA2UnKE9Mptj/KKiE4
cs4c8Cupo2WSu93lEZDC5rCrULpT2lFeEXnRYlC/5oIgY5w9sFide9VI4CzHkkWX
Z2NPW/i1w3mFhoXjvnNLGOYMfAMKPxsRC2/Bn3bY0IhKvuIZ4rAeu7FTmKDDqFKQ
YEcrUOW74ZVng17AB29xzjWr4zNJVvp/CybFiUb8JoKkwtVWRqAVZIEgenAjU40d
G5+W4e+ccL0mfTQfEBbXRjnL2BL2tnaoBR42cTfbZGRucPHz7MrlKBEeZQARAQAB
tDdGcmVlQlNEIFNlY3VyaXR5IE9mZmljZXIgPHNlY3VyaXR5LW9mZmljZXJARnJl
ZUJTRC5vcmc+iQJUBBMBCgA+FiEE/A6HiuWv54gCjWNV05eS9J6n5cIFAlmT2+AC
GwMFCQoek4AFCwkIBwMFFQoJCAsFFgIDAQACHgECF4AACgkQ05eS9J6n5cKd9A/9
Fz3uGjNy28D0ALT1d/JJGzdQ2R3YwspHk9KHBr1LePkog9wf1WRalwCeNtPmA+g5
cn24psuzOeh1tRElImTZ2eE2ENPZ9XzK/J0ok0nK42MvmIwmMCyz+CaWv9GXW+FK
0oXnFmHi4YaQUVN3p+45TGkD9T+O5biVww7P47n/NnWsTfhLx0bzC7LyjPKXINai
/LgPgtlcOgY65/YhW/qhADCkoU7qMp9is41jMjTu1WB3OBPJkUkNpHfu6r15y8FN
Wqsk7K4W6Obr/WQ6VKGGXgh/a5mTcaEoFGMO16uHijAY4nXeb2HGZlBKxgmPH9Ur
aT4A9Pz/n+rIRMrK+rs+msFPemQHHNBYxy+x99uBpRBNyT2Su6GouZIxu5J16aIM
V0ZyOy/dy7m/uJ4sMhJPqKkd8a+MoQs/2L1M1y1EAzsO/QZqIrKrCluaftNN9k/B
qU0XClSDqB6sRMF7HFzYqb+f+M6cwSL/3Cp1Yx4rZ/onEE/MdWp64+3R87dETTXd
5tWXQw04qOhfPri5cBTI7r3t/qMO1iNXCGSG5RJbGkas6N6t6Mj83L4ItjI8doLf
aSIWZjj1XP3/me2hFJ6h2G5y5A+khO4ZwhC0ATFSq1fYbVGHw5AtfthIgNn8FoWu
+Sb8h7/RqTr7F6LgWagAoAh0GtVj02SVABZjcNZz/AKJAjcEEAEKACEWIQQc9/9v
rfXKn74bjLLtZ+zWXc9q5wUCWZPcTAMFAngACgkQ7Wfs1l3PauflkRAAgYcaBX0Y
ic4btxKoP/eOVpgUciOPPKEhDCiloQDyf4XQnZFDoMfjgcHpbLTBZ6kiAz2UzDGr
fJ4yUqrD+xfixUfCd5YpwzsaSpCGzDzSxOBcP/SpuAFhe40awSOIf5MruQar9Mlf
33JyslDLULXXeewAq2pcGk0/WrrOragI6Cs2vPGy9XP96VvLxyhjrWjlKmnO+//w
UF8oIO5hhKoqbtoxxlcqJgsWVyHch0mnPzvr6GWwoPhFXocnh1oPdbLjX1AwmGm9
ltEYMge4QxONIXlXJR0TvuDuJOaLNvTOC3OI8L97fdBcZS7eNJrG5FAYR5Ft3ISf
KJowIsSLGDt/cYApqpyP2pv7FpCvnwHgXHYar7/q4zhngCFRxQ2DPUx1cIJQ3Bgh
HZolKyK1X7XE5ZVDfZ3s3gcHSVKS89pipgHHZNr4sSmOanA8rXHcyHS4o2zSi1ie
r4iBwnOk6cCd6UNzEIiq0y/XhP/sc7xeL0mn3wDuV7jDBP9sp65sexL1qtIAfnzL
pLQevm0z41ifrUH5nNeL6RdbXpaoXc8M4PJJeQKJDu04KzLcQpZdUdCJsbS6QO9w
srWR8enQXPEhz2CO4L77bM9TgYO29222jTqEPcbXcmxF/klxO1rpssTTHUnHHi1Z
LUGYCbZPjt+laTJ2YPHTjUtN1Jw85vSKCEuJATMEEAEKAB0WIQS7KNQLNg7uk2rt
FW/l97zLo73d+AUCWjSYRwAKCRDl97zLo73d+JKyB/9N5Ytao12nD5QzMLvceGh5
otCLN99TUryYiDVDLoNkBivq3jHQA/hOX2rwEueFq0+LF8/2DnglJuUICNtCxIzL
WXXf/Hr5iWBUQ0JxYNPQzzjdMSXGE0WMwYVpAbCGxHpIsetKLdHUCwneYhaywe3I
KzmRJSDJGV1IJB0sAfoFtgybZXHgIR61jQjtnNmmyYXliYCd0wmIhXQDFN91tzzG
+EZdJ3Fao9JsMC+x55jO6EOLVySZgRF5E8vCeKUWemQciKFC7EhKcljILPYAA21u
NmHCAgRHKWU9JMdFK0w9lQuN2HQaNfkahjarTNM/Q6LwxY0dLG0vVYifE085WFAf
uQINBFmT2+ABEACxi39m5nQZexzY3c9sg/w5mUYCD89ZNSkj427gduQMYYGn7YW6
jSPfVJ/V3+PDK824c0a0XasyDapQFY1CPTZYrReRPoyjb8tJjsSVGXXCTFpJZlFU
br6kS9mgcx58Sypke2PMVk73+W1N1Yco+nahfTECRuM2/T2zHHr0AdKuBPF28U+H
TxyLatKoIgQwHDs4E/f4ZTbAoHvu3PixAl7XHVXCgz0cHaLhRljXizbZDXngOdGm
lqdFlAIpL6/l8E3m1Er0m3IfFo6qSzWRHg/KaBGIL4YKetJ6ACjlkCe5qbatDpmk
gWlg3Ux4RBVjyCK834Xh7eZpEcNf2iwpm28glWh7XMHGUplTHkU3PWQ4vGfNxXB8
HBOd9r02/cHL6MiHwhCAfIzZGVtqR0i9Ira57TMdXTpJWNXUcgsCMsi/Bg2a+hsn
aiYLrZc18uNL5nqOqsqKG3c1TcmeN7nbxVgnrNST4AjteulkhmB9p8tNOXA3u979
OO0T5LPwdqIpobdZ0lfw4URnAGw4Wd4Sm9PtRw0RvuAk2M2e5KXNyxPWAuMVkoRR
a7wG6h/R8pki54Gexyc+JkfB4ZcOrzHNLurw6DhxroyfRs8WEgX0wNIGmJvCXSBG
54jb5w9qudYwzIg4YPfvuX8sfeY8MTNhal3rF0tvVloGj3l709wlaWlBYwARAQAB
iQI8BBgBCgAmFiEE/A6HiuWv54gCjWNV05eS9J6n5cIFAlmT2+ACGwwFCQoek4AA
CgkQ05eS9J6n5cKhWw/+PT0R4r2gPAxI8ESEe380BYOmneNAH24MFOgWXqWCj4zX
Uz992BVnW2aL5nH4O5d822LGeCrYUC7SCpQvlifdHZHjobgtizLTwuu40bc3gSOz
cxWlx2jKfx3Ezn6QQz2mhhK6fZ1AO0ObiQxQq25ldURep95L78E/C8XkCe11YlUR
ng3wQKeHM7awZWRw/QBC92haHuVtU3cx7At+zQL7jTBKSZqd34zzs0uoXIhk2h94
O07MMDZ8z8MeU337vdL+RKYtD2bljLwpf7/kqg1D/q44RJ4ZpZcha9G0GvtLaQg2
+MAPlLg1vOWZ8wOTLaQHm+uzYRpkqxkIV8OuVd4UikCd8t3VNjNG5rG/YRNIAX0A
UEzs6oMF5YOFE8LmykesbUHAbC07Vcb0AsT5u3XKixDiIpPdnYSwGlkvoOVVLdeh
q/aXLK9V8BpViG5+a8xP2fdF1eMqdnrKAsiO4GEiq193PN/FA049VeIs3fd0izAa
x7+ag1MGtoF5Pij5iTVJm6phH5SUd1P3FY3OmclxWj/MbL4ba/G/6FWcy5NXxdw9
L1bRqaM2KEHJ67aF6NZz7UMldwExAWzFbUon1LUpKysAukxVf0EnntydBeVOQ+JO
HdqEpirrVLMpxPttUB2xxbo947nMj7/Bnme2gvb0vxaC9xSGVxrpW9cg5iCwSdc=
=8rds
-----END PGP PUBLIC KEY BLOCK-----
]]></programlisting>

    </sect2>

    <sect2 xml:id="pgpkey-secteam-secretary">
      <title>Security Team Secretary <email>secteam-secretary@FreeBSD.org</email></title>
      <!-- $FreeBSD$ -->
<!--
sh addkey.sh secteam-secretary 3CB2EAFCC3D6C666;
-->
<programlisting role="pgpfingerprint"><![CDATA[
pub   4096R/3CB2EAFCC3D6C666 2013-09-24 [expires: 2018-01-01]
      Key fingerprint = FA97 AA04 4DF9 0969 D5EF  4ADA 3CB2 EAFC C3D6 C666
uid                          FreeBSD Security Team Secretary <secteam-secretary@FreeBSD.org>
sub   4096R/509B26612335EB65 2013-09-24 [expires: 2018-01-01]
]]></programlisting>
<programlisting role="pgpkey"><![CDATA[
-----BEGIN PGP PUBLIC KEY BLOCK-----

mQINBFJBjIIBEADadvvpXSkdnBOGV2xcsFwBBcSwAdryWuLk6v2VxjwsPcY6Lwqz
NAZr2Ox1BaSgX7106Psa6v9si8nxoOtMc5BCM/ps/fmedFU48YtqOTGF+utxvACg
Ou6SKintEMUa1eoPcww1jzDZ3mxx49bQaNAJLjVxeiAZoYHe9loTe1fxsprCONnx
Era1hrI+YA2KjMWDORcwa0sSXRCI3V+b4PUnbMUOQa3fFVUriM4QjjUBU6hW0Ub0
GDPcZq45nd7PoPPtb3/EauaYfk/zdx8Xt0OmuKTi9/vMkvB09AEUyShbyzoebaKH
dKtXlzyAPCZoH9dihFM67rhUg4umckFLc8vc5P2tNblwYrnhgL8ymUaOIjZB/fOi
Z2OZLVCiDeHNjjK3VZ6jLAiPyiYTG1Hrk9E8NaZDeUgIb9X/K06JXVBQIKNSGfX5
LLp/j2wr+Kbg3QtEBkcStlUGBOzfcbhKpE2nySnuIyspfDb/6JbhD/qYqMJerX0T
d5ekkJ1tXtM6aX2iTXgZ8cqv+5gyouEF5akrkLi1ySgZetQfjm+zhy/1x/NjGd0u
35QbUye7sTbfSimwzCXKIIpy06zIO4iNA0P/vgG4v7ydjMvXsW8FRULSecDT19Gq
xOZGfSPVrSRSAhgNxHzwUivxJbr05NNdwhJSbx9m57naXouLfvVPAMeJYwARAQAB
tD9GcmVlQlNEIFNlY3VyaXR5IFRlYW0gU2VjcmV0YXJ5IDxzZWN0ZWFtLXNlY3Jl
dGFyeUBGcmVlQlNELm9yZz6JAj0EEwEKACcFAlJBjIICGwMFCQgH7b8FCwkIBwMF
FQoJCAsFFgIDAQACHgECF4AACgkQPLLq/MPWxmYt8Q/+IfFhPIbqglh4rwFzgR58
8YonMZcq+5Op3qiUBh6tE6yRz6VEqBqTahyCQGIk4xGzrHSIOIj2e6gEk5a4zYtf
0jNJprk3pxu2Og05USJmd8lPSbyBF20FVm5W0dhWMKHagL5dGS8zInlwRYxr6mMi
UuJjj+2Hm3PoUNGAwL1SH2BVOeAeudtzu80vAlbRlujYVmjIDn/dWVjqnWgEBNHT
SD+WpA3yW4mBJyxWil0sAJQbTlt5EM/XPORVZ2tvETxJIrXea/Sda9mFwvJ02pJn
gHi6TGyOYydmbu0ob9Ma9AvUrRlxv8V9eN7eZUtvNa6n+IT8WEJj2+snJlO4SpHL
D3Z+l7zwfYeM8FOdzGZdVFgxeyBU7t3AnPjYfHmoneqgLcCO0nJDKq/98ohz5T9i
FbNR/vtLaEiYFBeX3C9Ee96pP6BU26BXhw+dRSnFeyIhD+4g+/AZ0XJ1CPF19D+5
z0ojanJkh7lZn4JL+V6+mF1eOExiGrydIiiSXDA/p5FhavMMu8Om4S0sn5iaQ2aX
wRUv2SUKhbHDqhIILLeQKlB3X26obx1Vg0nRhy47qNQn/xc9oSWLAQSVOgsShQeC
6DSzrKIBdKB3V8uWOmuM7lWAoCP53bDRW+XIOu9wfpSaXN2VTyqzU7zpTq5BHX1a
+XRw8KNHZGnCSAOCofZWnKyJAhwEEAEKAAYFAlJBjYgACgkQ7Wfs1l3PaudFcQ//
UiM7EXsIHLwHxez32TzA/0uNMPWFHQN4Ezzg4PKB6Cc4amva5qbgbhoeCPuP+XPI
2ELfRviAHbmyZ/zIgqplDC4nmyisMoKlpK0Yo1w4qbix9EVVZr2ztL8F43qN3Xe/
NUSMTBgt/Jio7l5lYyhuVS3JQCfDlYGbq6NPk0xfYoYOMOZASoPhEquCxM5D4D0Z
3J3CBeAjyVzdF37HUw9rVQe2IRlxGn1YAyMb5EpR2Ij612GFad8c/5ikzDh5q6JD
tB9ApdvLkr0czTBucDljChSpFJ7ENPjAgZuH9N5Dmx2rRUj2mdBmi7HKqxAN9Kdm
+pg/6vZ3vM18rBlXmw1poQdc3srAL+6MHmIfHHrq49oksLyHwyeL8T6BO4d4nTZU
xObP7PLAeWrdrd1Sb3EWlZJ9HB/m2UL9w9Om1c6cb6X2DoCzQAStVypAE6SQCMBK
pxkWRj90L41BS62snja+BlZTELuuLTHULRkWqS3fFkUxlDSMUn96QksWlwZLcxCv
hKxJXOX+pHAiUuMIImaPQ0TBDBWWf5d8zOQlNPsyhSGFR5Skwzlg+m9ErQ+jy7Uz
UmNCNztlYgRKeckXuvr73seoKoNXHrn7vWQ6qB1IRURj2bfphsqlmYuITmcBhfFS
Dw0fdYXSDXrmG9wad98g49g4HwCJhPAl0j55f93gHLGIRgQQEQoABgUCUkGO5gAK
CRAV1ogEymzfsol4AKCI7rOnptuoXgwYx2Z9HkUKuugSRwCgkyW9pxa5EovDijEF
j1jG/cdxTOaJAhwEEAEKAAYFAlJBkdUACgkQkshDRW2mpm6aLxAAzpWNHMZVFt7e
wQnCJnf/FMLTjduGTEhVFnVCkEtI+YKarveE6pclqKJfSRFDxruZ6PHGG2CDfMig
J6mdDdmXCkN//TbIlRGowVgsxpIRg4jQVh4S3D0Nz50h+Zb7CHbjp6WAPVoWZz7b
Myp+pN7qx/miJJwEiw22Eet4Hjj1QymKwjWyY146V928BV/wDBS/xiwfg3xIVPZr
RqtiOGN/AGpMGeGQKKplkeITY7AXiAd+mL4H/eNf8b+o0Ce2Z9oSxSsGPF3DzMTL
kIX7sWD3rjy3Xe2BM20stIDrJS2a1fbnIwFvqszS3Z3sF5bLc6W0iyPJdtbQ0pt6
nekRl9nboAdUs0R+n/6QNYBkj4AcSh3jpZKe82NwnD/6WyzHWtC0SDRTVkcQWXPW
EaWLmv8VqfzdBiw6aLcxlmXQSAr0cUA6zo6/bMQZosKwiCfGl3tR4Pbwgvbyjoii
pF+ZXfz7rWWUqZ2C79hy3YTytwIlVMOnp3MyOV+9ubOsFhLuRDxAksIMaRTsO7ii
5J4z1d+jzWMW4g1B50CoQ8W+FyAfVp/8qGwzvGN7wxN8P1iR+DZjtpCt7J+Xb9Pt
L+lRKSO/aOgOfDksyt2fEKY4yEWdzq9A3VkRo1HCdUQY6SJ/qt7IyQHumxvL90F6
vbB3edrR/fVGeJsz4vE10hzy7kI1QT65Ag0EUkGMggEQAMTsvyKEdUsgEehymKz9
MRn9wiwfHEX5CLmpJAvnX9MITgcsTX8MKiPyrTBnyY/QzA0rh+yyhzkY/y55yxMP
INdpL5xgJCS1SHyJK85HOdN77uKDCkwHfphlWYGlBPuaXyxkiWYXJTVUggSjuO4b
jeKwDqFl/4Xc0XeZNgWVjqHtKF91wwgdXXgAzUL1/nwN3IglxiIR31y10GQdOQEG
4T3ufx6gv73+qbFc0RzgZUQiJykQ3tZK1+Gw6aDirgjQYOc90o2Je0RJHjdObyZQ
aQc4PTZ2DC7CElFEt2EHJCXLyP/taeLq+IdpKe6sLPckwakqtbqwunWVoPTbgkxo
Q1eCMzgrkRu23B2TJaY9zbZAFP3cpL65vQAVJVQISqJvDL8K5hvAWJ3vi92qfBcz
jqydAcbhjkzJUI9t44v63cIXTI0+QyqTQhqkvEJhHZkbb8MYoimebDVxFVtQ3I1p
EynOYPfn4IMvaItLFbkgZpR/zjHYau5snErR9NC4AOIfNFpxM+fFFJQ7W88JP3cG
JLl9dcRGERq28PDU/CTDH9rlk1kZ0xzpRDkJijKDnFIxT2ajijVOZx7l2jPL1njx
s4xa1jK0/39kh6XnrCgK49WQsJM5IflVR2JAi8BLi2q/e0NQG2pgn0QL695Sqbbp
NbrrJGRcRJD9sUkQTpMsLlQTABEBAAGJAiUEGAEKAA8FAlJBjIICGwwFCQgH7b8A
CgkQPLLq/MPWxmZAew//et/LToMVR3q6/qP/pf9ob/QwQ3MgejkC0DY3Md7JBRl/
6GWfySYnO0Vm5IoJofcv1hbhc/y3OeZTvK4s+BOQsNokYe34mCxZG4dypNaepkQi
x0mLujeU/n4Y0p0LTLjhGLVdKina2dM9HmllgYr4KumT58g6eGjxs2oZD6z5ty0L
viU5tx3lz3o0c3I9soH2RN2zNHVjXNW0EvWJwFLxFeLJbk/Y3UY1/kXCtcyMzLua
S5L5012eUOEvaZr5iYDKjy+wOxY4SUCNYf0GPmSej8CBbwHOF2XCwXytSzm6hNb3
5TRgCGbOSFTIy9MxfV5lpddQcdzijmuFSl8LySkL2yuJxjlI7uKNDN+NlfODIPMg
rdH0hBSyKci6Uz7Nz/Up3qdE+aISq68k+Hk1fiKJG1UcBRJidheds29FCzj3hoyZ
VDmf6OL60hL0YI1/4GjIkJyetlPzjMp8J7K3GweOUkfHcFihYZlbiMe7z+oIWEc7
0fNScrAGF/+JN3L6mjXKB6Pv+ER5ztzpfuhBJ/j7AV5BaNMmDXAVO4aTphWl7Dje
iecENuGTpkK8Ugv5cMJc4QJaWDkj/9sACc0EFgigPo68KjegvKg5R8jUPwb8E7T6
lIjBtlclVhaUrE2uLx/yTz2Apbm+GAmD8M0dQ7IYsOFlZNBW9zjgLLCtWDW+p1A=
=5gJ7
-----END PGP PUBLIC KEY BLOCK-----
]]></programlisting>

    </sect2>

    <sect2 xml:id="pgpkey-core-secretary">
      <title>Core Team Secretary <email>core-secretary@FreeBSD.org</email></title>
      <!-- $FreeBSD$ -->
<!--
sh addkey.sh core-secretary D8C8C83B49F26F17 ;
-->
<programlisting role="pgpfingerprint"><![CDATA[
pub   rsa4096/D8C8C83B49F26F17 2020-06-26 [SC] [expires: 2022-06-30]
      Key fingerprint = 4B64 E9E0 BDE9 B3EC C06B  5C66 D8C8 C83B 49F2 6F17
uid                            FreeBSD Core Team Secretary <core-secretary@freebsd.org>
sub   rsa4096/377C937536E4821B 2020-06-26 [E] [expires: 2022-06-30]

]]></programlisting>
<programlisting role="pgpkey"><![CDATA[
-----BEGIN PGP PUBLIC KEY BLOCK-----

mQINBF72HwABEAC5hl4kfh8DyRpp0WE5rwbnuS+wQ51EVTGs1vLho8OZ2XruzlQT
AezCnKLsqMgD/UEaBcn9kbKoeqp2sIwuEUX+P79KhRc4C8RJ8TMfDH0OtC091QVp
MYWbIsvZYCO04K+rN1Dbk2En3BOJVgTowqbZzR3hPvzeU2/P+Y3zMtpQGea2DB5d
24Q/tIuPMh89evEXOx0K5eM/4P2awSmA3J+h+r09UYjKejJ5OBUJQsMervWAHgCA
TxJQHoPXw+ZKpJB3dzyHKTMukVZhdCjK6Zt2tih/rO/CHDsitMgYRIl3w2X6pDfV
JOpvOBlzg7nooIw94v6Uxr2y/JWgOGh2qy07u4qE//y6uSl55s+Vq5TrFr79VSwB
GhY9As/0Dk1lyFisKp1/yiet2W7Pu4c99Z5dsrQPSTLFvkvonVRX8wgxRZwk6gWA
LEYklwoR0NXiqlrpBT10Tsnsa4aoUvZW6eyOWZrKsdsVn05sgRmvlfpiqBbwqldJ
0EeF/MztPuhmq4Hgn+DmmYnx/P85pZpThcfJx16VxS8nB7ExYljeC9LF8V8/1d7e
tfgAj8ezzNtr2TXSZ5gblQtYLjKdgBiBZqsxHPYHzfG8Zx3eYs2Myklf9p4lt7nv
atTroDt8pUGXfhGfoqSHSLXODfYAO9/7DOPqTy5Pan4i7aWBPP+gfK0kgQARAQAB
tDhGcmVlQlNEIENvcmUgVGVhbSBTZWNyZXRhcnkgPGNvcmUtc2VjcmV0YXJ5QGZy
ZWVic2Qub3JnPokCVAQTAQoAPhYhBEtk6eC96bPswGtcZtjIyDtJ8m8XBQJe9h8A
AhsDBQkDx60ABQsJCAcDBRUKCQgLBRYDAgEAAh4BAheAAAoJENjIyDtJ8m8XQFwP
/RqHPMSsLlTcq5NfK2MAVGmdtpL5wf84bchVWtcXUUEwXW1wI2cdDwu9SoqudDbP
2lrbMpxWeUWAgCpPCF/vCVo4Nzd0zb1cEGKRKFiZe/4EQ8dfvqr03YyupSQvx6+P
oY+8y3kl7iHJKBkwrASraB2p+N9XDAJDgqz+1M2Xbo7rcJx64wBOCyPAxd9JWsge
d8mXyAqZlrLihsTjLbhuYbJxpKM5YjGubVaQZaNIDxUduqc8Pt9VgHvWJBc9VPPA
3B6E9/PUFZYZeZQSROkYniN9NE7keitxj/rvZkpzcaXfAoDMC7CSoLBzlP+CJZ+i
Kk7IWz4JpxiYkE/IY4VvMMYms9tRP8fVv0+R7r7yKEA9SSlH+e9qC++OoWg4b+wV
OrWtVIWvaJCtj5ZAPCutGZxBdvXEbHd/Gv6uCzG86n4huz23U+Y4iLzoAlVelnQs
Hqu1wSAUBNpplyeZ1TvrGg2pufxLh8iXfh0npDP/6J+u0GUfeX4JoAzvxlatXMYI
fBmqmcZI6ShJN8qQtCUa5OMqbnieo7Fmpf8BsLegjAsQ+8w21ATD2boinStntLzF
/yoL/z9WYxmoOdHYcQ8bildjCvtbAKrZie8sI4SgWQz2UX6KX9sc/WOmWUEtjdqB
WfGratZNoxuQLUvEDftt7r9ts1jKVUl3dMPTCfU4wcj5iQIzBBABCgAdFiEEVbCT
pybDiFVxIrrVNqQMg7DW754FAl72J74ACgkQNqQMg7DW756LaA//Z3CCF5fQ08tx
RLeqHNsS5xCYS97TjZxY6xAMBjebkS+ABkgdbedSH+YNGfdaGSD/SMtvMAmnx55t
18DDdA4pqC5x2USaHjXFdbDdxKuKMAoSAtOpipVASVmW0FkZI5C5FDe3MF8+mfGb
EPhVPwKbo7R5tk4jUPyX8wUaOAyUX9fyQnwDxN+zTHvKwnX/+qwpoKaY2N4ZOI0w
rOF1kkczibbfwvjVYcpPovGALmTccnWo1Xvpkhllg93Y21mH+T2Ub/BK3GhvgJQi
WwiDtMwelUnPLp4W1451OU1OyGzeT/XwuMPH9dsKz5Iw4/g1zqQEtZj2Gc0DP5we
HM50doTn+dVIF+WCFLhPYm0RSf8Zj8ngbX/HV2UYLB5k+uNT9YTnBVEdKVydx7Cp
IplC7XApJEfTUk7wl7YCGn5P5YolC7DSJlwcAjxdbffXLowBhgyOq+EJJgnqerZl
r4db58h2epIHRKgnSl5z4KoAGW1O5dFShBz1UYPj4cZdeE+twpcgEg3/7LMzPzF/
xQAQZ89axxXBaCPl+YVsuMJSerbNdPp1SjCs9e8Vev91tLFmt/sY4IpvbPHZavGl
/4ealh8E1zPgf8lVW9TPrUY6mjN/uDI2y39tk2EoFzOcSQhlEM6gRW8uV4q92cWM
V55hu7Vs2RrKA7fve9y+YBi3DdTwwHSJATMEEAEKAB0WIQSfAoNvUNOtWrdaxYgM
tAPk6VuW7AUCXvY98wAKCRAMtAPk6VuW7CDLB/9PSUSMV/pnC+X4ougpjpqfSJf8
5bozjkKSkNqXZmt2vJVImc/oSK13awq46FC4rAhk59lT3kaH6EKvDHQ5G8Twi07u
VotcOdtfMjXgPV6RLmo6Hps0E1nzmbsum6xeemRDf3D3n1kAdUteXNBxHTIdAbeY
p4Wxu46CC/SqD6HbnUF2o+/6dXXyV1lTnViIj6m5eFD2OQ4Jdq7GPsSjSS2XL4f9
jHZUOUJyyA0aFWjJ+SCzMkXSUnyiOCl4uUHdCgivLIRyZ/giWoQpr8sAgHXCh82h
T3BmbHgmcMgMh+wNxH878IPwUU0CKRd2dL5kOSZVCFuMnFsc9eIie5kMEJwPuQIN
BF72HwABEADT9l4GIYiFaYg2QbQ3wsmmFnP/pAZiHDxXI6wL6xCKj6o2sc1/b5j3
ILEiAoqZ5ZenXX6T7Epjal0ASkfsGo/n3vF18grSudIkXJPQXcb61fXU7xfmGAEU
HWABQG+OD/HTvUPAITVckl4LxVFkz3oqRnq13rxDk1XZYvLVWeBn8vfWF4/glz9k
etfLw71Pk9f86BuNb0vCPnWpOpZaOxKlabdGpMKDD+1RYC/L+ZEwKiLBfgXTzK3g
IWAX3kTrQjKBZzsQ0s5TFWkm+z80GVUq8HKlXUOuF8s7cX+KXGU2kYcC8DQrxPdL
jYm6N8axOn4RR8eP5ZFA0W7qMieFSHAjqCs4srdN1bGC3nS0zGsQCvtTRBbu0nen
O6uwzWQgTzWVfV+dqaEH2crnhn5CUI0A8jdbFBGDiBbWJz/QfRray1CEc8q+hZFM
OLBsVXrDVe6hUXTveGc9xAnXC+0o3nnc7WhWr1caTbbhnzlEbME8u2oLif7rkhc7
FanuQEyKa76J1zou08ZeLK/pUFXTbRCoyUEVL+VIxLESCWi1ptkDpiZey3l6fe0Q
WWRMLFMpbu3WTNl21bEwfRL03+fP1q+yGAV5hyJv/EMldd76v577dAolIsTh+aDP
PMJ7mJ5NwOuiC20HIlCjuVT5A2pBIzFfraZY/v4dzoaOpXZjEz9wIwARAQABiQI8
BBgBCgAmFiEES2Tp4L3ps+zAa1xm2MjIO0nybxcFAl72HwACGwwFCQPHrQAACgkQ
2MjIO0nybxcflQ/9FYvM/lBSzy4VFOjNsUkRtjmPtyw2dJmQOCbWoSHmibRCG26a
Upt5lp1n4LG/qEtDlus5mDETL+/TnYhCG+hhnHADc87goLwBwl37yK1NAYvOy2rm
TddjDT5vZW0yzHjHqIJlNxQ4OjMi/XjyHIzb0PGNayFVi3XkLVxWZI+lWON1btWk
gpFfEgqRqQbJxM2cSEQimkfrrE+b2/M4cGX9rThpTtpfpbyHjTsS6juo4/eIdnBA
UXpKce4Q9LB5zxDaakKoDVxxkc9R0HAAoIH4u+Fu8az+CuH2sJcVJWK7Nxct++N8
Xhj+FUS+Ay8siu+ScQjsOHOHRwr6a+6NT58eylwR5hwotmnzJHLZReqknoAjLEGT
d33jzKM/y6OqPe/oPGj2b13RkA2vRnCPm33+T57sLMonNe6hhlXs9VTgXxSAzfMa
cmVOdP+nxUsoc3MtqjE2z2BcI9WMmmJFeEgE2BOj703CQuot+8jcZFXGUW+i6V1a
k7dZEMDsbALNzxaRNGeJC6HiM1+dXFGLNHEIgBLGwdvFAxTfNauvK0p7skDWEx44
giaUjZYpQ21+SHjVKTUnFQiiIDORvs3jdZDaxK/Y/vSoLRUiLBiHZWa6mxQY4uc6
5nAzLZB2BiBRfdL8fEO154nWjAZBLbKhK+ke2DBoPvSWubLPJqZyh+GmZAE=
=3AI7
-----END PGP PUBLIC KEY BLOCK-----
]]></programlisting>

    </sect2>

    <sect2 xml:id="pgpkey-portmgr-secretary">
      <title>Ports Management Team Secretary <email>portmgr-secretary@FreeBSD.org</email></title>
      <!-- $FreeBSD$ -->
<!--
sh addkey.sh portmgr-secretary D8294EC3BBC4D7D5 ;
-->
<programlisting role="pgpfingerprint"><![CDATA[
pub   rsa2048/D8294EC3BBC4D7D5 2012-07-24 [SC]
      Key fingerprint = FB37 45C8 6F15 E8ED AC81  32FC D829 4EC3 BBC4 D7D5
uid                            FreeBSD Ports Management Team Secretary <portmgr-secretary@FreeBSD.org>
sub   rsa2048/5CC117965F65CFE7 2012-07-24 [E]

]]></programlisting>
<programlisting role="pgpkey"><![CDATA[
-----BEGIN PGP PUBLIC KEY BLOCK-----

mQENBFAOzqYBCACYd+KGv0/DduIRpSEKWZG2yfDILStzWfdaQMD+8zdWihB0x7dd
JDBUpV0o0Ixzt9mvu5CHybx+9lOHeFRhZshFXc+bIJOPyi+JrSs100o7Lo6jg6+c
Si2vME0ixG4x9YjCi8DisXIGJ1kZiDXhmVWwCvL+vLInpeXrtJnK8yFkmszCOr4Y
Q3GXuvdU0BF2tL/Wo/eCbSf+3U9syopVS2L2wKcP76bbYU0ioO35Y503rJEK6R5G
TchwYvYjSXuhv4ec7N1/j3thrMC9GNpoqjVninTynOk2kn+YZuMpO3c6b/pfoNcq
MxoizGlTu8VT4OO/SF1y52OkKjpAsENbFaNTABEBAAG0R0ZyZWVCU0QgUG9ydHMg
TWFuYWdlbWVudCBUZWFtIFNlY3JldGFyeSA8cG9ydG1nci1zZWNyZXRhcnlARnJl
ZUJTRC5vcmc+iQE4BBMBAgAiBQJQDs6mAhsDBgsJCAcDAgYVCAIJCgsEFgIDAQIe
AQIXgAAKCRDYKU7Du8TX1QW2B/0coHe8utbTfGKpeM4BY9IyC+PFgkE58Hq50o8d
shoB9gfommcUaK9PNwJPxTEJNlwiKPZy+VoKs/+dO8gahovchbRdSyP1ejn3CFy+
H8pol0hDDU4n7Ldc50q54GLuZijdcJZqlgOloZqWOYtXFklKPZjdUvYN8KHAntgf
u361rwM4DZ40HngYY9fdGc4SbXurGA5m+vLAURLzPv+QRQqHfaI1DZF6gzMgY49x
qS1JBF4kPoicpgvs3o6CuX8MD9ewGFSAMM3EdzV6ZdC8pnpXC8+8Q+p6FjNqmtjk
GpW39Zq/p8SJVg1RortCH6qWLe7dW7TaFYov7gF1V/DYwDN5iEYEEBECAAYFAlN2
WksACgkQtzkaJjSHbFtuMwCg0MXdQTcGMMOma7LC3L5b4MEoZ+wAn0WyUHpHwHnn
pn2oYDlfAbwTloWIiQEcBBABAgAGBQJQDuVrAAoJENk3EJekc8mQ3KwIAImNDMXA
F8ajPwCZFpM6KDi3F/jpwyBPISGY1oWuYPEi1zN94k5jS90aZb3W8Y8x4JTh35Ew
b6XODi3uGLSLCmnlqu2a80yPfXf5IuWmIQdFNQxvosj9UHrg+icZGFmm+f0hPJxM
TsZREv3AvivQfnb/N3xIICxW4SjKSYXQcq4hr4ObhUx7GKnjayq+ofU2cRlujr87
uOH0fO3xhOJG4+cX5mI1HGK38k0Csc1zqYa/66Qe5dnIZz+sNXpEPMLAHIt1a45U
B967igJdZSDFN33bPl1QWmf3aUXU3d1VttiSyHkpm4kb9KgsDkUk1IJ5nUe9OXyd
WtoqNW5afDa5N0aIRgQQEQIABgUCUA7lwwAKCRB59uBxdBRinNh2AJ41+zfsaQSR
HWvSkqOXGcP/fgOduwCfUJDT+M1eXe2udmKof/9yzGYMirKJASIEEAECAAwFAlAa
IT8FAwASdQAACgkQlxC4m8pXrXwCHAf+J7l+L7AvRpqlQcezjnjFS/zG1098qkDf
lThHZlpVnrBMJZaXdvL6LzVgiIYVWZC5CSSazW9EWFjp9VjM7FBHdWFZNMV7GAuU
t0jzx6gGXOWwi+/v/hs1P11RyDZN5hICHdPNmyZVupciDxe+sIEP9aEbVxcaiccq
zM/pFzIVIMMP5tCiA42q6Mz3h0hy6hntUKptS8Uon6sje5cDVcVlKAUj1wO2cphC
qkYlwMQfZV5J9f/hcW5ODriD3cBwK8SocA2Cq5JYF8kYDL1+pXnUutGnvAHUYt87
RWvQdKmfXjzBcMFJ2LlPUB1+IFvwQ13V9R8j9B/EdLmSWQYT9qRA2okCHAQTAQoA
BgUCV1XMpwAKCRCtu/hhCjeJt2CyD/9JLe+Ck23CJkeRSF8oC+4SFOUdSAmejSzn
klPwmEClffABYd/kckO1T6um+2FUcXuJZQE1nKKUNvZ8pBWwsm1RDHsyroKi/XB1
0a1Tdx/rvlU88ytbeLfUCLzoCrf6pkMQWoU6/3qS6elV0WwOlDufk+XjD1sja2wu
sshG8y+1WCA5JjP3rZdD9NVdzo5DgkotTRUfuYN1LJIN4zlDgHj7FVP7wW7+R0cZ
FoOiNsLJCA0FN8SiyU98UysjawLiIY9dTJz6XVA0DgB0TZWO3mWiDjITeKrdGcqf
PNiJhmvUKBkn07YpTPNfkoTT/p/q5ChYmu0ubGeyS1ELKjmklJ+DzynfZLzvnXYX
Ngo5ckeuqEqUNxM0J63v8lmfhDRROFveqHWdp0XMxXVmR5bMunSldg5EZsoLyQbN
+ScIPnDTAEPGrCtf0t84RQxNQeET6/WBbZfzeSeAFmpBFCdicsZ6Mjwtwjr4+o15
n1QMTZco1NaTqf8vXwzl9wM4aYtg1OkF4z8HdHuy50CHCet4mT5eJgwZUfFvXdbM
pHXprEI0Y9OOL4aMinC1egF3dXt/0n57i6CE+E2k3UJPNvMrtp0HaDEnKZ8cfkBU
EBzkUYi5wwqntHV2JRisqoRnHdvJT7ImlHMe7WaJsifBK874PnToaKg8P6K1Tph+
FyLxULaYjYkCHAQSAQgABgUCVBg2zwAKCRDqsDxYv9xHj1klEADXYJdHC3zsdx7w
DsJsttWdykcZoOd/VUKUdN0BAU72nLV0tLn4uFjETA6MhHZVxzwIDTeLB8kqyEpc
fZnoVbqJIUJz1sJXMdOty7CwZzlZlAwmUaIfFiazJY1p398JbyYfSrVKNOpw9wCm
Db7WP9dBritwvjaLzu8HQsiztO0S/5ha/EDfTU3qocBUTjbCtGR9LqAmPE4X8+li
F2EfZMEoJd3rJWsYv2y/k6pSgC/MpQewnyr6f+JQ/781UoZB6PpxCxfu4D6xlOyd
ERBUg+FfDAWYR+KX+DGOalRlUyaSz8Nvxl8/b0Im/AQhx9afqyEZxIDpg52zt8jJ
t3wx23YP8EQGUgwF8pIrj3wFSBSG3a/cskiBNUIhChIR9hQrVPUahN/jx7DGAGxk
/Ka9qsRGYTHfSr9jjTUQ+htfeFBRDR0nkZKMo5+Wk/cAcBKVbPlBpwvnzT3fh+wL
cF3ErBbx5jp+BoFee8D6ATeUvQxMcgVbDPUkgMsy3EtKMVO10jhIoXoVV+Sg9GZ8
zMEy1tORKn0zsd2ZgXC2sRJOm5ttCSdYQ4ddbM1A9jg6tiRx4hES16GDywvkL8P2
M9+qyIfjQxjGU33f/r8zp9DyNT1VlrtwhFxtOoMdmrsbYOCTja4Xg14hK1hRac0k
GB7bj6w97p8uMrQT3PlSMtoyrRyo7bkBDQRQDs6mAQgAzNxJYpf5PrqV8pdRXkn3
6Fe45q671YtbZ2WrT7D0CVZ8Z+AZsxnP/tiY1SrM2MepCeA2xBAhKGsWBWo1aRk5
mfZOksKsiXsi2XeBVhdZlCkrOMKBTVian7I1lH59ZnNIMX0Nl0tlj3L1IjeWWNvf
ej43URV81S9EmSwpjaWboatr2A+1oJku5m7nPD9JIOckE1TzBsyhx7zIUN9w6MKr
7gFw8DCzypwUKyYgKYToVm8QlkT/L3B0fuQHWhT6ROGk4o8SC71ia5tc1TzUzGEZ
1AQO8bbnbmJLBDKveWHCoaeAkRzINzoD9wAn9z4pnilze59QtKC1cOqUksTvBSDh
6wARAQABiQEfBBgBAgAJBQJQDs6mAhsMAAoJENgpTsO7xNfVOHoH/i5VyggVdwpq
PX8YBmN5mXQziYZNQoiON8IhOsxpX4W2nXCj5m6MACV6nJDVV6wyUH8/VvDQC9nH
arCe1oaNsHXJz0HamYt5gHJ0G1bYuBcuJp/FEjLa48XFI7nXQjJHn8rlwZMjK/PW
j1lw2WZiekviuzTEDH8c3YStGJSa+gYe8Eyq3XJVAe2VQOhImoWgGDR3tWfgrya/
IdEFb/jmjHSG5XUfbI0vNwqlf832BqSQKPG/Zix4MmBJgvAz4R71PH8WBmbmNFjD
elxVyfz80+iMgEb9aL91MfeBNC2KB1pFmg91mQTsiq7ajwVLVJK8NplHAkdLmkBC
O8MgMjzGhlE=
=iw7d
-----END PGP PUBLIC KEY BLOCK-----
]]></programlisting>

    </sect2>

    <sect2 xml:id="pgpkey-doceng-secretary">
      <title><email>doceng-secretary@FreeBSD.org</email></title>
      <!-- $FreeBSD$ -->
<!--
sh addkey.sh doceng-secretary E1C03580AEB45E58 ;
-->
<programlisting role="pgpfingerprint"><![CDATA[
pub   rsa2048/E1C03580AEB45E58 2019-10-31 [SC] [expires: 2022-10-30]
      Key fingerprint = F24D 7B32 B864 625E 5541  A0E4 E1C0 3580 AEB4 5E58
uid                            FreeBSD Doceng Team Secretary <doceng-secretary@freebsd.org>
sub   rsa2048/9EA8D713509472FC 2019-10-31 [E] [expires: 2022-10-30]

]]></programlisting>
<programlisting role="pgpkey"><![CDATA[
-----BEGIN PGP PUBLIC KEY BLOCK-----

mQENBF27FFcBCADeoSsIgyQUY8vREwkTikwFFlNg31MVy5s/Nq1cNK1PRfRMnprS
yfB62KqbYuz16bmQKaA9zHN4FGfiTvR6tl66LVHm1s/5HPiLv8sP14GsruLro9zN
v72dO7a9i68bMw+jarPOnu9dGiDFEI0dACOkdCGEYKEUapQeNpmWRrQ46BeXyFwF
JcNx76bJJUkwk6fWC0W63D762e6lCEX6ndoaPjjLBnFvtx13heNGUc8RukBwe2mA
U5pSGHj47J05bdWiRSwZaXa8PcW+20zTWaP755w7zWe4h60GANY7OsT9nuOqsioJ
QonxTrJuZweKRV8fNQ1EfDws3HZr7/7iXvO3ABEBAAG0PEZyZWVCU0QgRG9jZW5n
IFRlYW0gU2VjcmV0YXJ5IDxkb2Nlbmctc2VjcmV0YXJ5QGZyZWVic2Qub3JnPokB
VAQTAQoAPhYhBPJNezK4ZGJeVUGg5OHANYCutF5YBQJduxRXAhsDBQkFo5qABQsJ
CAcDBRUKCQgLBRYDAgEAAh4BAheAAAoJEOHANYCutF5YB2IIALw+EPYmOz9qlqIn
oTFmk/5MrcdzC5iLEfxubbF6TopDWsWPiOh5mAuvfEmROSGf6ctvdYe9UtQV3VNY
KeeyskeFrIBOFo2KG/dFqKPAWef6IfhbW3HWDWo5uOBg01jHzQ/pB1n6SMKiXfsM
idL9wN+UQKxF3Y7S/bVrZTV0isRUolO9+8kQeSYT/NMojVM0H2fWrTP/TaNEW4fY
JBDAl5hsktzdl8sdbNqdC0GiX3xb4GvgVzGGQELagsxjfuXk6PfOyn6Wx2d+yRcI
FrKojmhihBp5VGFQkntBIXQkaW0xhW+WBGxwXdaAl0drQlZ3W+edgdOl705x73kf
Uw3Fh2a5AQ0EXbsUVwEIANEPAsltM4vFj2pi5xEuHEcZIrIX/ZJhoaBtZkqvkB+H
4pu3/eQHK5hg0Dw12ugffPMz8mi57iGNI9TXd8ZYMJxAdvEZSDHCKZTX9G+FcxWa
/AzKNiG25uSISzz7rMB/lV1gofCdGtpHFRFTiNxFcoacugTdlYDiscgJZMJSg/hC
GXBdEKXR5WRAgAGandcL8llCToOt1lZEOkd5vJM861w6evgDhAZ2HGhRuG8/NDxG
r4UtlnYGUCFof/Q4oPNbDJzmZXF+8OQyTNcEpVD3leEOWG1Uv5XWS2XKVHcHZZ++
ISo/B5Q6Oi3SJFCVV9f+g09YF+PgfP/mVMBgif2fT20AEQEAAYkBPAQYAQoAJhYh
BPJNezK4ZGJeVUGg5OHANYCutF5YBQJduxRXAhsMBQkFo5qAAAoJEOHANYCutF5Y
kecIAMTh2VHQqjXHTszQMsy3NjiTVVITI3z+pzY0u2EYmLytXQ2pZMzLHMcklmub
5po0X4EvL6bZiJcLMI2mSrOs0Gp8P3hyMI40IkqoLMp7VA2LFlPgIJ7K5W4oVwf8
khY6lw7qg2l69APm/MM3xAyiL4p6MU8tpvWg5AncZ6lxyy27rxVflzEtCrKQuG/a
oVaOlMjH3uxvOK6IIxlhvWD0nKs/e2h2HIAZ+ILE6ytS5ZEg2GXuigoQZdEnv71L
xyvE9JANwGZLkDxnS5pgN2ikfkQYlFpJEkrNTQleCOHIIIp8vgJngEaP51xOIbQM
CiG/y3cmKQ/ZfH7BBvlZVtZKQsI=
=MQKT
-----END PGP PUBLIC KEY BLOCK-----
]]></programlisting>

    </sect2>

  </sect1>
</appendix>

  </part>
  
<!--
    $FreeBSD$

    FreeBSD Glossary Terms
	Please keep this file sorted alphabetically/ASCIIly by glossterm.

	glossterms that are acronyms should have two entries - one for
	the expanded acronym and another for the acronym itself.  The
	second of these should reference the entry for the expanded acronym
	via a glosssee element.  For example:

	<glossentry>
	  <glossterm>FUBAR</glossterm>
	  <glosssee otherterm="fubar-glossary">
	</glossentry>

	<glossentry id="fubar-glossary">
	  <glossterm>Fuc... Up Beyond All Recognition</glossterm>
	  <acronym>FUBAR</acronym>
	  <glossdef>
	    <para>Broken.</para>
	  </glossdef>
	</glossentry>

	Note that in this instance, the expanded acronym sorts below the
	unexpanded acronym.  That's OK.

	Finally, id attribute values should end in the string
	"-glossary" to avoid conflicting with id attribute values in
	the main text.

-->
<glossary version="5.0" status="draft" xml:id="freebsd-glossary">
  <title>Glossário do FreeBSD</title>
  <para>Este glossário contém termos e acrônimos usados na comunidade e na documentação do FreeBSD.</para>

  <glossdiv>
    <title>UMA</title>

    <glossentry>
      <glossterm>ACL</glossterm>
      <glosssee otherterm="acl-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>ACPI</glossterm>
      <glosssee otherterm="acpi-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>AMD</glossterm>
      <glosssee otherterm="amd-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>AML</glossterm>
      <glosssee otherterm="aml-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>API</glossterm>
      <glosssee otherterm="api-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>APIC</glossterm>
      <glosssee otherterm="apic-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>APM</glossterm>
      <glosssee otherterm="apm-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>APOP</glossterm>
      <glosssee otherterm="apop-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>ASL</glossterm>
      <glosssee otherterm="asl-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>ATA</glossterm>
      <glosssee otherterm="ata-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>ATM</glossterm>
      <glosssee otherterm="atm-glossary"/>
    </glossentry>

    <glossentry xml:id="aml-glossary">
      <glossterm>Linguagem de máquina <acronym> ACPI </acronym></glossterm>
      <acronym>AML</acronym>
      <glossdef>
        <para>Pseudocódigo, interpretado por uma máquina virtual dentro de um sistema operacional compatível com <acronym>ACPI</acronym>, fornecendo uma camada entre o hardware subjacente e a interface documentada apresentada ao <acronym>SO</acronym>.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="asl-glossary">
      <glossterm><acronym>ACPI</acronym> Source Language</glossterm>
      <acronym>ASL</acronym>
      <glossdef>
        <para>A linguagem de programação <acronym>AML</acronym> está escrita em.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="acl-glossary">
      <glossterm>Lista de Controle de Acesso</glossterm>
      <acronym>ACL</acronym>
      <glossdef>
        <para>Uma lista de permissões anexadas a um objeto, geralmente um arquivo ou um dispositivo de rede.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="acpi-glossary">
      <glossterm>Configuração avançada e interface de energia</glossterm>
      <acronym>ACPI</acronym>
      <glossdef>
        <para>Uma especificação que fornece uma abstração da interface que o hardware apresenta ao sistema operacional, de modo que o sistema operacional não precise saber nada sobre o hardware subjacente para aproveitá-lo ao máximo. O <acronym>ACPI</acronym> evolui e substitui a funcionalidade fornecida anteriormente pelo <acronym>APM</acronym>, <acronym>PNPBIOS</acronym> e outras tecnologias e fornece recursos para controlar o consumo de energia, suspensão da máquina, e para habilitar e desabilitar dispositivos, etc.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="api-glossary">
      <glossterm>Interface de programação de aplicativos</glossterm>
      <acronym>API</acronym>
      <glossdef>
        <para>Um conjunto de procedimentos, protocolos e ferramentas que especificam a interação canônica de uma ou mais partes do programa; como, quando e por que trabalham juntos e quais dados compartilham ou operam.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="apm-glossary">
      <glossterm>Gerenciamento avançado de energia</glossterm>
      <acronym>APM</acronym>
      <glossdef>
        <para>Uma <acronym>API</acronym> que permite que o sistema operacional funcione em conjunto com o <acronym>BIOS</acronym> para obter o gerenciamento de energia. O <acronym> APM </acronym> foi substituído pela especificação muito mais genérica e poderosa <acronym>ACPI</acronym> para a maioria das aplicações.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="apic-glossary">
      <glossterm>Controlador Avançado de Interrupção Programável</glossterm>
      <acronym>APIC</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="ata-glossary">
      <glossterm>Anexo de Tecnologia Avançada</glossterm>
      <acronym>ATA</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="atm-glossary">
      <glossterm>Modo Assíncrono de transferência</glossterm>
      <acronym>ATM</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="apop-glossary">
      <glossterm>Protocolo autenticado do correio</glossterm>
      <acronym>APOP</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="amd-glossary">
      <glossterm>Daemon de Montagem Automática</glossterm>
      <acronym>AMD</acronym>
      <glossdef>
        <para>Um daemon que monta automaticamente um sistema de arquivos quando um arquivo ou diretório dentro desse sistema de arquivos é acessado.</para>
      </glossdef>
    </glossentry>
  </glossdiv>

  <glossdiv>
    <title>B</title>

    <glossentry>
      <glossterm>BARRA</glossterm>
      <glosssee otherterm="bar-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>VINCULAR</glossterm>
      <glosssee otherterm="bind-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>BIOS</glossterm>
      <glosssee otherterm="bios-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>BSD</glossterm>
      <glosssee otherterm="bsd-glossary"/>
    </glossentry>

    <glossentry xml:id="bar-glossary">
      <glossterm>Registo Base de Endereços</glossterm>
      <acronym>BARRA</acronym>
      <glossdef>
        <para>Os registros que determinam em qual intervalo de endereços um dispositivo <acronym>PCI</acronym> irá responder.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="bios-glossary">
      <glossterm>Sistema Básico de Entrada e Saída</glossterm>
      <acronym>BIOS</acronym>
      <glossdef>
        <para>A definição de <acronym>BIOS</acronym> depende um pouco do contexto. Algumas pessoas se referem a ele como o chip <acronym>ROM</acronym> com um conjunto básico de rotinas para fornecer uma interface entre software e hardware. Outros se referem a ele como o conjunto de rotinas contidas no chip que ajudam na inicialização do sistema. Alguns também podem se referir a ele como a tela usada para configurar o processo de bootstrapping. O <acronym>BIOS</acronym> é específico do PC, mas outros sistemas têm algo semelhante.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="bind-glossary">
      <glossterm>Berkeley Internet Name Domain</glossterm>
      <acronym>VINCULAR</acronym>
      <glossdef>
	<para>Uma implementação dos protocolos <acronym>DNS</acronym>.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="bsd-glossary">
      <glossterm>Berkeley Software Distribution</glossterm>
      <acronym>BSD</acronym>
      <glossdef>
	<para>Esse é o nome que o CSRG (Computer Systems Research Group) da <link xlink:href="http://www.berkeley.edu">Universidade da Califórnia em Berkeley</link> deu a suas melhorias e modificações para AT &amp; ; T's 32V <trademark class="registered"> UNIX </trademark>. O FreeBSD é um descendente do trabalho do CSRG.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="bikeshed-glossary">
      <glossterm>Bikeshed Building</glossterm>
      <glossdef subject="FreeBSD">
	<para>Um fenômeno pelo qual muitas pessoas opinarão sobre um tópico simples, enquanto um tópico complexo recebe pouca ou nenhuma discussão. Consulte a <link xlink:href="@@URL_RELPREFIX@@/doc/en_US.ISO8859-1/books/faq/misc.html#BIKESHED-PAINTING">FAQ</link> para a origem do termo.</para>
      </glossdef>
    </glossentry>
  </glossdiv>

  <glossdiv>
    <title>C</title>

    <glossentry>
      <glossterm>CD</glossterm>
      <glosssee otherterm="cd-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>CHAP</glossterm>
      <glosssee otherterm="chap-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>CLIP</glossterm>
      <glosssee otherterm="clip-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>COFF</glossterm>
      <glosssee otherterm="coff-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>CPU</glossterm>
      <glosssee otherterm="cpu-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>CTS</glossterm>
      <glosssee otherterm="cts-glossary"/>
    </glossentry>

    <glossentry xml:id="cd-glossary">
      <glossterm>Carrier Detect</glossterm>
      <acronym>CD</acronym>
      <glossdef>
	<para>Um sinal <acronym>RS232C</acronym> indicando que uma portadora foi detectada.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="cpu-glossary">
      <glossterm>Unidade central de processamento</glossterm>
      <acronym>CPU</acronym>
      <glossdef>
        <para>Também conhecido como processador. Este é o cérebro do computador onde todos os cálculos ocorrem. Existem várias arquiteturas diferentes com conjuntos de instruções diferentes. Entre os mais conhecidos estão o Intel-x86 e derivados, Arm e PowerPC.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="chap-glossary">
      <glossterm>Protocolo de autenticação de handshake de desafio</glossterm>
      <acronym>CHAP</acronym>
      <glossdef>
        <para>Um método de autenticação de um usuário, baseado em um segredo compartilhado entre o cliente e o servidor.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="clip-glossary">
      <glossterm>Clássico <acronym>IP</acronym> sobre  <acronym>ATM</acronym></glossterm>
      <acronym>CLIP</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="cts-glossary">
      <glossterm>Clear To Send</glossterm>
      <acronym>CTS</acronym>
      <glossdef>
	<para>Um sinal <acronym>RS232C</acronym> que permite ao sistema remoto enviar dados.</para>
	<glossseealso otherterm="rts-glossary"/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="coff-glossary">
      <glossterm>Formato de arquivo de objeto comum</glossterm>
      <acronym>COFF</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>
  </glossdiv>

  <glossdiv>
    <title>D</title>

    <glossentry>
      <glossterm>DAC</glossterm>
      <glosssee otherterm="dac-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>DDB</glossterm>
      <glosssee otherterm="ddb-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>DES</glossterm>
      <glosssee otherterm="des-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>DHCP</glossterm>
      <glosssee otherterm="dhcp-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>DNS</glossterm>
      <glosssee otherterm="dns-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>DSDT</glossterm>
      <glosssee otherterm="dsdt-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>DSR</glossterm>
      <glosssee otherterm="dsr-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>DTR</glossterm>
      <glosssee otherterm="dtr-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>DVMRP</glossterm>
      <glosssee otherterm="dvmrp-glossary"/>
    </glossentry>

    <glossentry xml:id="dac-glossary">
      <glossterm>Controle de Acesso Discricionário</glossterm>
      <acronym>DAC</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="des-glossary">
      <glossterm>Padrão de Criptografia de Dados</glossterm>
      <acronym>DES</acronym>
      <glossdef>
	<para>Um método de criptografar informações, tradicionalmente usado como método de criptografia para senhas <trademark class="registered">UNIX</trademark> e para a função <citerefentry><refentrytitle>crypt</refentrytitle><manvolnum>3</manvolnum></citerefentry>.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="dsr-glossary">
      <glossterm>Data Set Ready</glossterm>
      <acronym>DSR</acronym>
      <glossdef>
	<para>Um sinal <acronym>RS232C</acronym> enviado do modem para o computador ou terminal, indicando prontidão para enviar e receber dados.</para>
	<glossseealso otherterm="dtr-glossary"/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="dtr-glossary">
      <glossterm>Data Terminal Ready</glossterm>
      <acronym>DTR</acronym>
      <glossdef>
	<para>Um sinal <acronym>RS232C</acronym> enviado do computador ou terminal para o modem, indicando uma prontidão para enviar e receber dados.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="ddb-glossary">
      <glossterm>Depurador</glossterm>
      <acronym>DDB</acronym>
      <glossdef>
	<para>Um recurso interativo do kernel para examinar o status de um sistema, geralmente usado depois que um sistema falhou para estabelecer os eventos que cercam a falha.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="dsdt-glossary">
      <glossterm>Tabela de descrição de sistema diferenciada</glossterm>
      <acronym>DSDT</acronym>
      <glossdef>
        <para>Uma tabela <acronym>ACPI</acronym>, que fornece informações básicas de configuração sobre o sistema base.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="dvmrp-glossary">
      <glossterm>Protocolo de roteamento de multidifusão de vetor de distância</glossterm>
      <acronym>DVMRP</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="dns-glossary">
      <glossterm>Sistema de nomes de domínio</glossterm>
      <acronym>DNS</acronym>
      <glossdef>
	<para>O sistema que converte nomes de host legíveis humanamente (ou seja, mail.example.net) em endereços da Internet e vice-versa.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="dhcp-glossary">
      <glossterm>Protocolo de configuração dinâmica de hosts</glossterm>
      <acronym>DHCP</acronym>
      <glossdef>
	<para>Um protocolo que atribui dinamicamente endereços IP a um computador (host) quando ele solicita um do servidor. A atribuição de endereço é chamada de <quote>lease</quote>.</para>
      </glossdef>
    </glossentry>
  </glossdiv>

  <glossdiv>
    <title>E</title>

    <glossentry>
      <glossterm>ECOFF</glossterm>
      <glosssee otherterm="ecoff-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>ELF</glossterm>
      <glosssee otherterm="elf-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>ESP</glossterm>
      <glosssee otherterm="esp-glossary"/>
    </glossentry>

    <glossentry xml:id="esp-glossary">
      <glossterm>Encapsulated Security Payload</glossterm>
      <acronym>ESP</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="elf-glossary">
      <glossterm>Executable and Linking Format</glossterm>
      <acronym>ELF</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="ecoff-glossary">
      <glossterm>Extensão <acronym>COFF</acronym></glossterm>
      <acronym>ECOFF</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>
  </glossdiv>

  <glossdiv>
    <title>F</title>

    <glossentry>
      <glossterm>FADT</glossterm>
      <glosssee otherterm="fadt-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>FAT</glossterm>
      <glosssee otherterm="fat-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>FAT16</glossterm>
      <glosssee otherterm="fat16-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>FTP</glossterm>
      <glosssee otherterm="ftp-glossary"/>
    </glossentry>

    <glossentry xml:id="fat-glossary">
      <glossterm>Tabela de alocação de arquivos</glossterm>
      <acronym>FAT</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="fat16-glossary">
      <glossterm>Tabela de alocação de arquivos (16 bits)</glossterm>
      <acronym>FAT16</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="ftp-glossary">
      <glossterm>Protocolo de transferência de arquivos</glossterm>
      <acronym>FTP</acronym>
      <glossdef>
	<para>Um membro da família de protocolos de alto nível implementados em cima do <acronym>TCP</acronym>, que pode ser usado para transferir arquivos em uma rede <acronym>TCP/IP </acronym>.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="fadt-glossary">
      <glossterm>Tabela de descrição fixa <acronym>ACPI</acronym></glossterm>
      <acronym>FADT</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>
  </glossdiv>

  <glossdiv>
    <title>G</title>

    <glossentry>
      <glossterm>GUI</glossterm>
      <glosssee otherterm="gui-glossary"/>
    </glossentry>

    <glossentry xml:id="giant-glossary">
      <glossterm>Giant</glossterm>
      <glossdef subject="FreeBSD">
	<para>O nome de um mecanismo de exclusão mútua (um <literal> sleep mutex </literal>) que protege um grande conjunto de recursos do kernel. Embora um mecanismo de bloqueio simples tenha sido adequado nos dias em que uma máquina podia ter apenas algumas dezenas de processos, uma placa de rede e, certamente, apenas um processador, nos tempos atuais isso é um gargalo de desempenho inaceitável. Os desenvolvedores do FreeBSD estão trabalhando ativamente para substituí-lo por bloqueios que protegem os recursos individuais, o que permitirá um grau muito maior de paralelismo para máquinas de processador único e multiprocessador.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="gui-glossary">
      <glossterm>Interface gráfica do usuário</glossterm>
      <acronym>GUI</acronym>
      <glossdef>
        <para>Um sistema em que o usuário e o computador interagem com gráficos.</para>
      </glossdef>
    </glossentry>
  </glossdiv>

  <glossdiv>
    <title>H</title>

    <glossentry>
      <glossterm>HTML</glossterm>
      <glosssee otherterm="html-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>HUP</glossterm>
      <glosssee otherterm="hup-glossary"/>
    </glossentry>

    <glossentry xml:id="hup-glossary">
      <glossterm>HangUp</glossterm>
      <acronym>HUP</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="html-glossary">
      <glossterm>Linguagem de marcação de hipertexto</glossterm>
      <acronym>HTML</acronym>
      <glossdef>
        <para>A linguagem de marcação usada para criar páginas da web.</para>
      </glossdef>
    </glossentry>
  </glossdiv>

  <glossdiv>
    <title>I</title>

    <glossentry>
      <glossterm>I/O</glossterm>
      <glosssee otherterm="io-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>IASL</glossterm>
      <glosssee otherterm="iasl-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>IMAP</glossterm>
      <glosssee otherterm="imap-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>IP</glossterm>
      <glosssee otherterm="ip-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>IPFW</glossterm>
      <glosssee otherterm="ipfw-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>IPP</glossterm>
      <glosssee otherterm="ipp-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>IPv4</glossterm>
      <glosssee otherterm="ipv4-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>IPv6</glossterm>
      <glosssee otherterm="ipv6-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>ISP</glossterm>
      <glosssee otherterm="isp-glossary"/>
    </glossentry>

    <glossentry xml:id="ipfw-glossary">
      <glossterm><acronym>IP</acronym> Firewall</glossterm>
      <acronym>IPFW</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="ipv4-glossary">
      <glossterm><acronym>IP</acronym> Versão 4</glossterm>
      <acronym>IPv4</acronym>
      <glossdef>
	<para>A versão 4 do protocolo <acronym>IP</acronym>, que usa 32 bits para endereçamento. Esta versão ainda é a mais usada, mas está sendo lentamente substituída pelo <acronym> IPv6 </acronym>.</para>
	<glossseealso otherterm="ipv6-glossary"/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="ipv6-glossary">
      <glossterm><acronym> IP </acronym> Versão 6</glossterm>
      <acronym>IPv6</acronym>
      <glossdef>
	<para>O novo protocolo <acronym>IP</acronym>. Inventado porque o espaço de endereço em <acronym>IPv4</acronym> está acabando. Usa 128 bits para endereçamento.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="io-glossary">
      <glossterm>Input/Output</glossterm>
      <acronym>I/O</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="iasl-glossary">
      <glossterm>Compilador Intel’s <acronym>ASL</acronym></glossterm>
      <acronym>IASL</acronym>
      <glossdef>
        <para>Compilador da Intel para converter <acronym>ASL</acronym> em <acronym>AML</acronym>.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="imap-glossary">
      <glossterm>Internet Message Access Protocol</glossterm>
      <acronym>IMAP</acronym>
      <glossdef>
	<para>Um protocolo para acessar mensagens de email em um servidor de email, caracterizado por as mensagens normalmente serem mantidas no servidor, em vez de serem baixadas para o cliente do leitor de email.</para>
	<glossseealso otherterm="pop3-glossary"/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="ipp-glossary">
      <glossterm>Protocolo de impressão na Internet</glossterm>
      <acronym>IPP</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="ip-glossary">
      <glossterm>protocolo de internet</glossterm>
      <acronym>IP</acronym>
      <glossdef>
	<para>O protocolo de transmissão de pacotes que é o protocolo básico na Internet. Originalmente desenvolvido no Departamento de Defesa dos EUA e uma parte extremamente importante da pilha do <acronym>TCP/IP </acronym>. Sem o Internet Protocol, a Internet não teria se tornado o que é hoje. Para maiores informações, consulte <link xlink:href="ftp://ftp.rfc-editor.org/in-notes/rfc791.txt">RFC 791</link>.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="isp-glossary">
      <glossterm>Provedor de internet</glossterm>
      <acronym>ISP</acronym>
      <glossdef>
	<para>Uma empresa que fornece acesso à Internet.</para>
      </glossdef>
    </glossentry>
  </glossdiv>

  <glossdiv>
    <title>K</title>

    <glossentry xml:id="kame-glossary">
      <glossterm>KAME</glossterm>
      <glossdef>
        <para>Japonês para <quote>tartaruga</quote>, o termo KAME é usado em círculos de computação para se referir ao <link xlink:href="http://www.kame.net/">Projeto KAME</link>, eles trabalham em uma implementação de <acronym>IPv6</acronym>.</para>
      </glossdef>
    </glossentry>

    <glossentry>
      <glossterm>KDC</glossterm>
      <glosssee otherterm="kdc-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>KLD</glossterm>
      <glosssee otherterm="kld-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>KSE</glossterm>
      <glosssee otherterm="kse-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>KVA</glossterm>
      <glosssee otherterm="kva-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>Kbps</glossterm>
      <glosssee otherterm="kbps-glossary"/>
    </glossentry>

    <glossentry xml:id="kld-glossary">
      <glossterm>Kernel <citerefentry><refentrytitle>ld</refentrytitle><manvolnum>1</manvolnum></citerefentry></glossterm>
      <acronym>KLD</acronym>
      <glossdef>
	<para>Um método de carregar dinamicamente a funcionalidade em um kernel do FreeBSD sem reiniciar o sistema.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="kse-glossary">
      <glossterm>Entidades do Agendador do Kernel</glossterm>
      <acronym>KSE</acronym>
      <glossdef>
	<para>Um sistema de thread suportado pelo kernel. Veja a <link xlink:href="http://www.FreeBSD.org/kse">página inicial do projeto</link> para maiores detalhes.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="kva-glossary">
      <glossterm>Endereço Virtual do Kernel</glossterm>
      <acronym>KVA</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="kdc-glossary">
      <glossterm>Centro de distribuição de chaves</glossterm>
      <acronym>KDC</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="kbps-glossary">
      <glossterm>Kilo Bits Per Second</glossterm>
      <acronym>Kbps</acronym>
      <glossdef>
	<para>Usado para medir a largura de banda (quantos dados podem passar por um determinado ponto em um período de tempo especificado). Alternativas ao prefixo Kilo incluem Mega, Giga, Tera e assim por diante.</para>
      </glossdef>
    </glossentry>
  </glossdiv>

  <glossdiv>
    <title>L</title>

    <glossentry>
      <glossterm>LAN</glossterm>
      <glosssee otherterm="lan-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>LOR</glossterm>
      <glosssee otherterm="lor-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>LPD</glossterm>
      <glosssee otherterm="lpd-glossary"/>
    </glossentry>

    <glossentry xml:id="lpd-glossary">
      <glossterm>Line Printer Daemon</glossterm>
      <acronym>LPD</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="lan-glossary">
      <glossterm>Rede local</glossterm>
      <acronym>LAN</acronym>
      <glossdef>
	<para>Uma rede usada em uma área local, por exemplo escritório, casa ou assim por diante.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="lor-glossary">
      <glossterm>Reversão de ordem de bloqueio</glossterm>
      <acronym>LOR</acronym>
      <glossdef>
	<para>O kernel do FreeBSD usa diversos bloqueios de recursos para arbitrar contenção para esses recursos. Um sistema de diagnóstico de trava em tempo de execução encontrado nos kernels FreeBSD-CURRENT (mas removido para releases), chamado <citerefentry><refentrytitle>witness</refentrytitle><manvolnum>4</manvolnum></citerefentry>, detecta o potencial de deadlocks devido a erros de bloqueio. (O <citerefentry><refentrytitle>witness</refentrytitle><manvolnum>4</manvolnum></citerefentry> é na verdade um pouco conservador, por isso é possível obter falsos positivos.) Um relatório positivo verdadeiro indica que <quote>se você foi azarado, um deadlock teria acontecido aqui</quote>.</para>

	<para>LORs positivos verdadeiros tendem a ser corrigidos rapidamente, então verifique http://lists.FreeBSD.org/mailman/listinfo/freebsd-current e a página <link xlink:href="http://sources.zabbadoz.net/freebsd/lor.html">LORs Vistos</link> antes de postar nas listas de discussão.</para>
      </glossdef>
    </glossentry>
  </glossdiv>

  <glossdiv>
    <title>M</title>

    <glossentry>
      <glossterm>MAC</glossterm>
      <glosssee otherterm="mac-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>MADT</glossterm>
      <glosssee otherterm="madt-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>MFC</glossterm>
      <glosssee otherterm="mfc-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>MFH</glossterm>
      <glosssee otherterm="mfh-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>MFS</glossterm>
      <glosssee otherterm="mfs-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>MFV</glossterm>
      <glosssee otherterm="mfv-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>MIT</glossterm>
      <glosssee otherterm="mit-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>MLS</glossterm>
      <glosssee otherterm="mls-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>MOTD</glossterm>
      <glosssee otherterm="motd-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>MTA</glossterm>
      <glosssee otherterm="mta-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>MUA</glossterm>
      <glosssee otherterm="mua-glossary"/>
    </glossentry>

    <glossentry xml:id="mta-glossary">
      <glossterm>Mail Transfer Agent</glossterm>
      <acronym>MTA</acronym>
      <glossdef>
	<para>Um aplicativo usado para transferir e-mail. Um <acronym>MTA</acronym> tem sido tradicionalmente parte do sistema básico do BSD. Hoje, o Sendmail está incluído no sistema básico, mas existem muitos outros <acronym>MTA</acronym>s, como o postfix, o qmail e o Exim.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="mua-glossary">
      <glossterm>Mail User Agent</glossterm>
      <acronym>MUA</acronym>
      <glossdef>
	<para>Um aplicativo usado pelos usuários para exibir e escrever e-mail.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="mac-glossary">
      <glossterm>Controle de acesso obrigatório</glossterm>
      <acronym>MAC</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="mit-glossary">
      <glossterm>Instituto de Tecnologia de Massachusetts</glossterm>
      <acronym>MIT</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="mfc-glossary">
      <glossterm>Merge From Current</glossterm>
      <acronym>MFC</acronym>
      <glossdef subject="FreeBSD">
	<para>Para mesclar funcionalidade ou um patch do ramo -CURRENT para outro, na maioria das vezes -STABLE.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="mfh-glossary">
      <glossterm>Merge From Head</glossterm>
      <acronym>MFH</acronym>
      <glossdef subject="FreeBSD">
	<para>Para mesclar funcionalidade ou um patch de um repositório HEAD para um branch anterior.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="mfs-glossary">
      <glossterm>Merge From Stable</glossterm>
      <acronym>MFS</acronym>
      <glossdef subject="FreeBSD">
	<para>No curso normal de desenvolvimento do FreeBSD, uma mudança será enviada para a ramificação -CURRENT para teste antes de ser mesclada com -STABLE. Em raras ocasiões, uma alteração entrará primeiro na -STABLE e depois será mesclada na -CURRENT.</para>

	<para>Esse termo também é usado quando um patch é mesclado de -STABLE para um ramo de segurança.</para>
	<glossseealso otherterm="mfc-glossary"/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="mfv-glossary">
      <glossterm>Merge From Vendor</glossterm>
      <acronym>MFV</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="motd-glossary">
      <glossterm>Message Of The Day</glossterm>
      <acronym>MOTD</acronym>
      <glossdef>
        <para>Uma mensagem, geralmente mostrada no login, geralmente usada para distribuir informações aos usuários do sistema.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="mls-glossary">
      <glossterm>Segurança multinível</glossterm>
      <acronym>MLS</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="madt-glossary">
      <glossterm>Tabela de descrição múltipla <acronym>APIC</acronym></glossterm>
      <acronym>MADT</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>
  </glossdiv>

  <glossdiv>
    <title>N</title>

    <glossentry>
      <glossterm>NAT</glossterm>
      <glosssee otherterm="nat-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>NDISulator</glossterm>
      <glosssee otherterm="projectevil-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>NFS</glossterm>
      <glosssee otherterm="nfs-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>NTFS</glossterm>
      <glosssee otherterm="ntfs-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>NTP</glossterm>
      <glosssee otherterm="ntp-glossary"/>
    </glossentry>

    <glossentry xml:id="nat-glossary">
      <glossterm>Network Address Translation</glossterm>
      <acronym>NAT</acronym>
      <glossdef>
        <para>Uma técnica em que os pacotes <acronym>IP</acronym> são reescritos no caminho através de um gateway, permitindo que muitas máquinas atrás do gateway compartilhem efetivamente um único endereço <acronym>IP</acronym>.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="nfs-glossary">
      <glossterm>Network File System</glossterm>
      <acronym>NFS</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="ntfs-glossary">
      <glossterm>New Technology File System</glossterm>
      <acronym>NTFS</acronym>
      <glossdef>
        <para>Um sistema de arquivos desenvolvido pela Microsoft e disponível em seus sistemas operacionais <quote>New Technology</quote>, como <trademark class="registered">Windows</trademark> 2000, <trademark class="registered">Windows NT</trademark> e <trademark class="registered">Windows</trademark> XP.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="ntp-glossary">
      <glossterm>Network Time Protocol</glossterm>
      <acronym>NTP</acronym>
      <glossdef>
        <para>Um meio de sincronizar relógios através de uma rede.</para>
      </glossdef>
    </glossentry>
  </glossdiv>

  <glossdiv>
    <title>O</title>

    <glossentry>
      <glossterm>OBE</glossterm>
      <glosssee otherterm="obe-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>ODMR</glossterm>
      <glosssee otherterm="odmr-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>OS</glossterm>
      <glosssee otherterm="os-glossary"/>
    </glossentry>

    <glossentry xml:id="odmr-glossary">
      <glossterm>On-Demand Mail Relay</glossterm>
      <acronym>ODMR</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="os-glossary">
      <glossterm>Sistema operacional</glossterm>
      <acronym>OS</acronym>
      <glossdef>
	<para>Um conjunto de programas, bibliotecas e ferramentas que fornecem acesso aos recursos de hardware de um computador. Atualmente, os sistemas operacionais variam de projetos simplistas que suportam apenas um programa em execução, acessando apenas um dispositivo para sistemas totalmente multiusuários, multitarefa e multiprocessos que podem atender a milhares de usuários simultaneamente, cada um executando dúzias de diferentes aplicações.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="obe-glossary">
      <glossterm>Overtaken By Events</glossterm>
      <acronym>OBE</acronym>
      <glossdef>
	<para>Indica uma alteração sugerida (como um Relatório de Problema ou uma solicitação de recurso) que não é mais relevante ou aplicável devido a mudanças posteriores no FreeBSD, mudanças nos padrões de rede, o hardware afetado desde então se tornou obsoleto e assim por diante.</para>
      </glossdef>
    </glossentry>
  </glossdiv>

  <glossdiv>
    <title>P</title>

    <glossentry>
      <glossterm>PAE</glossterm>
      <glosssee otherterm="pae-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>PAM</glossterm>
      <glosssee otherterm="pam-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>PAP</glossterm>
      <glosssee otherterm="pap-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>PC</glossterm>
      <glosssee otherterm="pc-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>PCNSFD</glossterm>
      <glosssee otherterm="pcnfsd-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>PDF</glossterm>
      <glosssee otherterm="pdf-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>PID</glossterm>
      <glosssee otherterm="pid-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>POLA</glossterm>
      <glosssee otherterm="pola-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>POP</glossterm>
      <glosssee otherterm="pop-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>POP3</glossterm>
      <glosssee otherterm="pop3-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>PPD</glossterm>
      <glosssee otherterm="ppd-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>PPP</glossterm>
      <glosssee otherterm="ppp-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>PPPoA</glossterm>
      <glosssee otherterm="pppoa-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>PPPoE</glossterm>
      <glosssee otherterm="pppoe-glossary"/>
    </glossentry>

    <glossentry xml:id="pppoa-glossary">
      <glossterm><acronym>PPP</acronym> over <acronym>ATM</acronym></glossterm>
      <acronym>PPPoA</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="pppoe-glossary">
      <glossterm><acronym>PPP</acronym> over <acronym>Ethernet</acronym></glossterm>
      <acronym>PPPoE</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry>
      <glossterm>PR</glossterm>
      <glosssee otherterm="pr-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>PXE</glossterm>
      <glosssee otherterm="pxe-glossary"/>
    </glossentry>

    <glossentry xml:id="pap-glossary">
      <glossterm>Password Authentication Protocol</glossterm>
      <acronym>PAP</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="pc-glossary">
      <glossterm>Computador pessoal</glossterm>
      <acronym>PC</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="pcnfsd-glossary">
      <glossterm>Daemon do sistema de arquivos da rede de computadores pessoais</glossterm>
      <acronym>PCNFSD</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="pae-glossary">
      <glossterm>Physical Address Extensions</glossterm>
      <acronym>PAE</acronym>
      <glossdef>
        <para>Um método para permitir acesso a até 64 GB de <acronym>RAM</acronym> em sistemas que possuem apenas um espaço de endereçamento amplo de 32 bits (e, portanto, seriam limitados a 4 GB sem PAE).</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="pam-glossary">
      <glossterm>Pluggable Authentication Modules</glossterm>
      <acronym>PAM</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="ppp-glossary">
      <glossterm>Point-to-Point Protocol</glossterm>
      <acronym>PPP</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="pointyhat">
      <glossterm>Pointy Hat</glossterm>
      <glossdef subject="FreeBSD">
	<para>Um pedaço mítico de equipamento de cabeça, muito parecido com um <literal>dunce cap</literal>, concedido a qualquer committer do FreeBSD que quebre a compilação, faz os números de revisão retrocederem ou cria qualquer outro tipo de confusão na base de código-fonte. Qualquer committer que valha a pena em breve acumulará uma grande coleção. O uso é (quase sempre?) Bem-humorado.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="pdf-glossary">
      <glossterm>Portable Document Format</glossterm>
      <acronym>PDF</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="pop-glossary">
      <glossterm>Post Office Protocol</glossterm>
      <acronym>POP</acronym>
      <glossdef>
        <para/>
	<glossseealso otherterm="pop3-glossary"/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="pop3-glossary">
      <glossterm>Post Office Protocol Version 3</glossterm>
      <acronym>POP3</acronym>
      <glossdef>
	<para>Um protocolo para acessar mensagens de e-mail em um servidor de e-mail, caracterizado por as mensagens serem geralmente baixadas do servidor para o cliente, em vez de permanecerem no servidor.</para>
	<glossseealso otherterm="imap-glossary"/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="ppd-glossary">
      <glossterm>PostScript Printer Description</glossterm>
      <acronym>PPD</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="pxe-glossary">
      <glossterm>Ambiente de execução de pré-inicialização</glossterm>
      <acronym>PXE</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="pola-glossary">
      <glossterm>Principle Of Least Astonishment</glossterm>
      <acronym>POLA</acronym>
      <glossdef>
	<para>À medida que o FreeBSD evolui, as mudanças visíveis para o usuário devem ser mantidas como não surpreendentes quanto possível. Por exemplo, rearranjar arbitrariamente variáveis de inicialização do sistema em <filename>/etc/defaults/rc.conf</filename> viola a <acronym>POLA</acronym>. Os desenvolvedores consideram o <acronym>POLA</acronym> ao contemplar alterações no sistema visíveis ao usuário.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="pr-glossary">
      <glossterm>Relatório de Problemas</glossterm>
      <acronym>PR</acronym>
      <glossdef>
        <para>Uma descrição de algum tipo de problema encontrado na fonte ou documentação do FreeBSD. Veja o artigo <link xlink:href="@@URL_RELPREFIX@@/doc/en_US.ISO8859-1/articles/problem-reports/index.html">Escrevendo Relatórios de Problemas do FreeBSD</link>.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="pid-glossary">
      <glossterm>Process ID</glossterm>
      <acronym>PID</acronym>
      <glossdef>
        <para>Um número, exclusivo para um processo específico em um sistema, que o identifica e permite que ações sejam tomadas contra ele.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="projectevil-glossary">
      <glossterm>Project Evil</glossterm>
      <glossdef subject="FreeBSD">
	<para>O título provisório para o <acronym> NDISulator </acronym>, escrito por Bill Paul, que o denominou referindo-se a quão horrível é (do ponto de vista filosófico) precisar ter algo assim em primeiro lugar. O <acronym> NDISulator </acronym> é um módulo de compatibilidade especial para permitir que os drivers de rede de miniport do Microsoft Windows ™ NDIS sejam usados com o FreeBSD/i386. Esta é geralmente a única maneira de usar cartões onde o driver é de código fechado. Veja <filename>src/sys/compat/ndis/subr_ndis.c</filename>.</para>
      </glossdef>
    </glossentry>
  </glossdiv>

  <glossdiv>
    <title>R</title>

    <glossentry>
      <glossterm>RA</glossterm>
      <glosssee otherterm="ra-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>RAID</glossterm>
      <glosssee otherterm="raid-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>RAM</glossterm>
      <glosssee otherterm="ram-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>RD</glossterm>
      <glosssee otherterm="rd-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>RFC</glossterm>
      <glosssee otherterm="rfc-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>RISC</glossterm>
      <glosssee otherterm="risc-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>RPC</glossterm>
      <glosssee otherterm="rpc-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>RS232C</glossterm>
      <glosssee otherterm="rs232c-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>RTS</glossterm>
      <glosssee otherterm="rts-glossary"/>
    </glossentry>

    <glossentry xml:id="ram-glossary">
      <glossterm>Memória de acesso aleatório</glossterm>
      <acronym>RAM</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="rcs-glossary">
      <glossterm>Sistema de Controle de Revisão</glossterm>
      <acronym>RCS</acronym>
      <glossdef>
        <para>O <emphasis>Sistema de Controle de Revisão</emphasis> (<acronym> RCS </acronym>) é um dos conjuntos de software mais antigos que implementam o <quote>controle de revisão</quote> para arquivos simples. Ele permite o armazenamento, recuperação, arquivamento, registro, identificação e fusão de várias revisões para cada arquivo. O RCS consiste em muitas ferramentas pequenas que funcionam juntas. Ele não possui alguns dos recursos encontrados em sistemas de controle de revisão mais modernos, como o Git, mas é muito simples de instalar, configurar e começar a usar para um pequeno conjunto de arquivos.</para>

	<glossseealso otherterm="svn-glossary"/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="rd-glossary">
      <glossterm>Received Data</glossterm>
      <acronym>RD</acronym>
      <glossdef>
	<para>Um pino ou fio <acronym>RS232C</acronym> no qual os dados são recebidos.</para>
	<glossseealso otherterm="td-glossary"/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="rs232c-glossary">
      <glossterm>Padrão recomendado 232C</glossterm>
      <acronym>RS232C</acronym>
      <glossdef>
        <para>Um padrão para comunicações entre dispositivos seriais.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="risc-glossary">
      <glossterm>Computador de conjunto de instruções reduzido</glossterm>
      <acronym>RISC</acronym>
      <glossdef>
	<para>Uma abordagem ao design do processador, em que as operações que o hardware pode executar, são simplificadas, mas feitas da forma mais geral possível. Isso pode levar a um menor consumo de energia, menos transistores e, em alguns casos, melhor desempenho e maior densidade de código. Exemplos de processadores RISC incluem o Alpha, <trademark class="registered"> SPARC </trademark>, <trademark class="registered"> ARM </trademark> e <trademark class="registered"> PowerPC </trademark>.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="raid-glossary">
      <glossterm>Matriz Redundante de Discos Econômicos</glossterm>
      <acronym>RAID</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="rpc-glossary">
      <glossterm>Chamada de Procedimento Remoto</glossterm>
      <acronym>RPC</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="rfc-glossary">
      <glossterm>Request For Comments</glossterm>
      <acronym>RFC</acronym>
      <glossdef>
	<para>Um conjunto de documentos definindo padrões da Internet, protocolos e assim por diante. Veja <link xlink:href="http://www.rfc-editor.org/">www.rfc-editor.org</link>.</para>

	<para>Também usado como um termo geral quando alguém tem uma alteração sugerida e deseja feedback.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="rts-glossary">
      <glossterm>Pedido para enviar</glossterm>
      <acronym>RTS</acronym>
      <glossdef>
	<para>Um sinal <acronym>RS232C</acronym> solicitando que o sistema remoto inicie a transmissão de dados.</para>
	<glossseealso otherterm="cts-glossary"/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="ra-glossary">
      <glossterm>Router Advertisement</glossterm>
      <acronym>RA</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>
  </glossdiv>

  <glossdiv>
    <title>S</title>

    <glossentry>
      <glossterm>SCI</glossterm>
      <glosssee otherterm="sci-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>SCSI</glossterm>
      <glosssee otherterm="scsi-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>SG</glossterm>
      <glosssee otherterm="sg-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>SMB</glossterm>
      <glosssee otherterm="smb-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>SMP</glossterm>
      <glosssee otherterm="smp-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>SMTP</glossterm>
      <glosssee otherterm="smtp-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>SMTP AUTH</glossterm>
      <glosssee otherterm="smtpauth-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>SSH</glossterm>
      <glosssee otherterm="ssh-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>STR</glossterm>
      <glosssee otherterm="str-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>SVN</glossterm>
      <glosssee otherterm="svn-glossary"/>
    </glossentry>

    <glossentry xml:id="smtpauth-glossary">
      <glossterm>Autenticação <acronym>SMTP</acronym></glossterm>
      <acronym>SMTP AUTH</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="smb-glossary">
      <glossterm>Server Message Block</glossterm>
      <acronym>SMB</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="sg-glossary">
      <glossterm>Signal Ground</glossterm>
      <acronym>SG</acronym>
      <glossdef>
	<para>Um pino ou fio <acronym> RS232 </acronym> que é a referência de terra para o sinal.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="smtp-glossary">
      <glossterm>Simple Mail Transfer Protocol</glossterm>
      <acronym>SMTP</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="ssh-glossary">
      <glossterm>Secure Shell</glossterm>
      <acronym>SSH</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="scsi-glossary">
      <glossterm>Small Computer System Interface</glossterm>
      <acronym>SCSI</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="svn-glossary">
      <glossterm>Subversion</glossterm>
      <acronym>SVN</acronym>
      <glossdef>
	<para>Subversion é um sistema de controle de versão atualmente usado pelo projeto FreeBSD.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="str-glossary">
      <glossterm>Suspender para <acronym>RAM</acronym></glossterm>
      <acronym>STR</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="smp-glossary">
      <glossterm>Multiprocessador Simétrico</glossterm>
      <acronym>SMP</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="sci-glossary">
      <glossterm>Interrupção de controle do sistema</glossterm>
      <acronym>SCI</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>
  </glossdiv>

  <glossdiv>
    <title>T</title>

    <glossentry>
      <glossterm>TCP</glossterm>
      <glosssee otherterm="tcp-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>TCP / IP</glossterm>
      <glosssee otherterm="tcpip-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>TD</glossterm>
      <glosssee otherterm="td-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>TFTP</glossterm>
      <glosssee otherterm="tftp-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>TGT</glossterm>
      <glosssee otherterm="tgt-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>TSC</glossterm>
      <glosssee otherterm="tsc-glossary"/>
    </glossentry>

    <glossentry xml:id="tgt-glossary">
      <glossterm>Ticket-Granting Ticket</glossterm>
      <acronym>TGT</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="tsc-glossary">
      <glossterm>Time Stamp Counter</glossterm>
      <acronym>TSC</acronym>
      <!-- From dg@, 20040814125503.GF40460@nexus.dglawrence.com -->
      <glossdef>
	<para>Um contador de criação de perfil interno dos modernos processadores <trademark class="registered">Pentium</trademark> que conta os pulsos de clock de freqüência do núcleo.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="tcp-glossary">
      <glossterm>Transmission Control Protocol</glossterm>
      <acronym>TCP</acronym>
      <glossdef>
        <para>Um protocolo que fica no topo (por exemplo) do protocolo <acronym>IP</acronym> e garante que os pacotes sejam entregues de forma confiável e ordenada.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="tcpip-glossary">
      <glossterm>Transmission Control Protocol/Internet Protocol</glossterm>
      <acronym>TCP / IP</acronym>
      <glossdef>
        <para>O termo para a combinação do protocolo <acronym>TCP</acronym> executado sobre o protocolo <acronym>IP</acronym>. Grande parte da Internet roda sobre <acronym>TCP/IP</acronym>.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="td-glossary">
      <glossterm>Transmitted Data</glossterm>
      <acronym>TD</acronym>
      <glossdef>
	<para>Um pino ou cabo <acronym>RS232C</acronym> no qual os dados são transmitidos.</para>
	<glossseealso otherterm="rd-glossary"/>
      </glossdef>
    </glossentry>

    <glossentry xml:id="tftp-glossary">
      <glossterm>Trivial <acronym>FTP</acronym></glossterm>
      <acronym>TFTP</acronym>
      <glossdef>
        <para/>
      </glossdef>
    </glossentry>
  </glossdiv>

  <glossdiv>
    <title>U</title>

    <glossentry>
      <glossterm>UDP</glossterm>
      <glosssee otherterm="udp-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>UFS1</glossterm>
      <glosssee otherterm="ufs1-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>UFS2</glossterm>
      <glosssee otherterm="ufs2-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>UID</glossterm>
      <glosssee otherterm="uid-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>URL</glossterm>
      <glosssee otherterm="url-glossary"/>
    </glossentry>

    <glossentry>
      <glossterm>USB</glossterm>
      <glosssee otherterm="usb-glossary"/>
    </glossentry>

    <glossentry xml:id="url-glossary">
      <glossterm>Uniform Resource Locator</glossterm>
      <acronym>URL</acronym>
      <glossdef>
	<para>Um método de localizar um recurso, como um documento na Internet e um meio para identificar esse recurso.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="ufs1-glossary">
      <glossterm>Versão 1 do sistema de arquivos Unix</glossterm>
      <acronym>UFS1</acronym>
      <glossdef>
	<para>O sistema de arquivos original do <trademark class="registered">UNIX</trademark>, as vezes chamado de Berkeley Fast File System.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="ufs2-glossary">
      <glossterm>Versão 2 do sistema de arquivos Unix</glossterm>
      <acronym>UFS2</acronym>
      <glossdef>
	<para>Uma extensão para o <acronym>UFS1</acronym>, introduzida no FreeBSD 5-CURRENT. O <acronym>UFS2</acronym> adiciona ponteiros de bloco de 64 bits (quebrando a barreira de 1T), suporte para armazenamento de arquivos estendido e outras funcionalidades.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="usb-glossary">
      <glossterm>Universal Serial Bus</glossterm>
      <acronym>USB</acronym>
      <glossdef>
	<para>Um padrão de hardware usado para conectar uma grande variedade de periféricos de computador a uma interface universal.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="uid-glossary">
      <glossterm>ID do Usuário</glossterm>
      <acronym>UID</acronym>
      <glossdef>
        <para>Um número exclusivo atribuído a cada usuário de um computador, pelo qual os recursos e as permissões atribuídos a este usuário podem ser identificados.</para>
      </glossdef>
    </glossentry>

    <glossentry xml:id="udp-glossary">
      <glossterm>User Datagram Protocol</glossterm>
      <acronym>UDP</acronym>
      <glossdef>
	<para>Um protocolo de datagrama simples e não confiável que é usado para trocar dados em uma rede TCP/IP. <acronym>UDP</acronym> não fornece verificação de erros e correção como o <acronym>TCP</acronym>.</para>
      </glossdef>
    </glossentry>
  </glossdiv>

  <glossdiv>
    <title>V</title>

    <glossentry>
      <glossterm>VPN</glossterm>
      <glosssee otherterm="vpn-glossary"/>
    </glossentry>

    <glossentry xml:id="vpn-glossary">
      <glossterm>Virtual Private Network</glossterm>
      <acronym>VPN</acronym>
      <glossdef>
	<para>Um método de usar um meio de telecomunicação pública, como a Internet, para fornecer acesso remoto a uma rede localizada, como uma <acronym>LAN corporativa</acronym>.</para>
      </glossdef>
    </glossentry>
  </glossdiv>
</glossary>

  <index/>
  
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<colophon version="5.0" xml:id="colophon">

  <para>Este livro é o trabalho combinado de centenas de colaboradores para o <quote>Projeto de Documentação do FreeBSD</quote>. O texto é criado em XML de acordo com o DocBook DTD e é formatado a partir do XML para muitos formatos de apresentação diferentes usando o XSLT. A versão impressa deste documento não seria possível sem a linguagem tipográfica <application>TeX</application> de Donald Knuth, o <application>LaTeX</application> de Leslie Lamport, ou o pacote de macro <application>JadeTeX</application> de Sebastian Rahtz.</para>
</colophon>

</book>
